const w=e=>e.replace(/\s+/g," "),I=(e,{startIndex:g,startOffset:a,endIndex:r,endOffset:c})=>{const i=e[g],s=e[r],d=i===s?i.slice(a,c):i.slice(a)+e.slice(i+1,s).join("")+s.slice(0,c),u=w(i.slice(0,a)).trimStart(),t=w(s.slice(c)).trimEnd(),n=u.length<50?"":"…",o=t.length<50?"":"…",l=`${n}${u.slice(-50)}`,h=`${t.slice(0,50)}${o}`;return{pre:l,match:d,post:h}},T=function*(e,g,a={}){const{locales:r="en",sensitivity:c}=a,i=c==="variant",s=e.join(""),d=i?s:s.toLocaleLowerCase(r),u=i?g:g.toLocaleLowerCase(r),t=u.length;let n=-1,o=-1,l=0;do if(n=d.indexOf(u,n+1),n>-1){for(;l<=n;)l+=e[++o].length;const h=o,m=n-(l-e[o].length),f=n+t;for(;l<=f;)l+=e[++o].length;const x=o,y=f-(l-e[o].length),p={startIndex:h,startOffset:m,endIndex:x,endOffset:y};yield{range:p,excerpt:I(e,p)}}while(n>-1)},E=function*(e,g,a={}){const{locales:r="en",granularity:c="word",sensitivity:i="base"}=a;let s,d;try{s=new Intl.Segmenter(r,{usage:"search",granularity:c}),d=new Intl.Collator(r,{sensitivity:i})}catch(l){console.warn(l),s=new Intl.Segmenter("en",{usage:"search",granularity:c}),d=new Intl.Collator("en",{sensitivity:i})}const u=Array.from(s.segment(g)).length,t=[];let n=0,o=s.segment(e[n])[Symbol.iterator]();e:for(;n<e.length;){for(;t.length<u;){const{done:h,value:m}=o.next();if(h)if(n++,n<e.length){o=s.segment(e[n])[Symbol.iterator]();continue}else break e;const{index:f,segment:x}=m;if(/[^\p{Format}]/u.test(x)){if(/\s/u.test(x)){/\s/u.test(t[t.length-1]?.segment)||t.push({strIndex:n,index:f,segment:" "});continue}m.strIndex=n,t.push(m)}}const l=t.map(h=>h.segment).join("");if(d.compare(g,l)===0){const h=n,m=t[t.length-1],f=m.index+m.segment.length,x=t[0].strIndex,y=t[0].index,p={startIndex:x,startOffset:y,endIndex:h,endOffset:f};yield{range:p,excerpt:I(e,p)}}t.shift()}},L=(e,g,a)=>{const{granularity:r="grapheme",sensitivity:c="base"}=a;return!Intl?.Segmenter||r==="grapheme"&&(c==="variant"||c==="accent")?T(e,g,a):E(e,g,a)},C=(e,g)=>{const{defaultLocale:a,matchCase:r,matchDiacritics:c,matchWholeWords:i}=g;return function*(s,d){const u=e(s,function*(t,n){for(const o of L(t,d,{locales:s.body.lang||s.documentElement.lang||a||"en",granularity:i?"word":"grapheme",sensitivity:c&&r?"variant":c&&!r?"accent":!c&&r?"case":"base"})){const{startIndex:l,startOffset:h,endIndex:m,endOffset:f}=o.range;o.range=n(l,h,m,f),yield o}});for(const t of u)yield t}};export{L as search,C as searchMatcher};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/epub-BBoX9gK7.js","assets/index.web-FTW_35KT.js","assets/index-CnE4FZjI.css","assets/overlayer-CvcsrVD0.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./index.web-FTW_35KT.js";import{Overlayer as A}from"./overlayer-CvcsrVD0.js";const G=(n,t)=>n.map((e,s,o)=>t(e,s,o)?s:null).filter(e=>e!=null),z=(n,t)=>[-1,...t,n.length].reduce(({xs:e,a:s},o)=>({xs:e?.concat([n.slice(s+1,o)])??[],a:o}),{}).xs,q=(n,t)=>n.slice(0,-1).concat([n[n.length-1].concat(t[0])]).concat(t.slice(1)),x=/\d/,_=/^epubcfi\((.*)\)$/,L=n=>n.replace(/[\^[\](),;=]/g,"^$&"),k=n=>_.test(n)?n:`epubcfi(${n})`,X=n=>n.match(_)?.[1]??n,Q=n=>(...t)=>`epubcfi(${n(...t.map(e=>e.match(_)?.[1]??e))})`,Y=Q((...n)=>n.join("!")),tt=n=>{const t=[];let e,s,o="";const i=r=>(t.push(r),e=null,o=""),a=r=>(o+=r,s=!1);for(const r of Array.from(n.trim()).concat("")){if(r==="^"&&!s){s=!0;continue}if(e==="!")i(["!"]);else if(e===",")i([","]);else if(e==="/"||e===":")if(x.test(r)){a(r);continue}else i([e,parseInt(o)]);else if(e==="~")if(x.test(r)||r==="."){a(r);continue}else i(["~",parseFloat(o)]);else if(e==="@"){if(r===":"){i(["@",parseFloat(o)]),e="@";continue}if(x.test(r)||r==="."){a(r);continue}else i(["@",parseFloat(o)])}else if(e==="["){r===";"&&!s?(i(["[",o]),e=";"):r===","&&!s?(i(["[",o]),e="["):r==="]"&&!s?i(["[",o]):a(r);continue}else if(e?.startsWith(";")){r==="="&&!s?(e=`;${o}`,o=""):r===";"&&!s?(i([e,o]),e=";"):r==="]"&&!s?i([e,o]):a(r);continue}(r==="/"||r===":"||r==="~"||r==="@"||r==="["||r==="!"||r===",")&&(e=r)}return t},B=(n,t)=>G(n,([e])=>e===t),et=n=>{const t=[];let e;for(const[s,o]of n){if(s==="/")t.push({index:o});else{const i=t[t.length-1];if(s===":")i.offset=o;else if(s==="~")i.temporal=o;else if(s==="@")i.spatial=(i.spatial??[]).concat(o);else if(s===";s")i.side=o;else if(s==="[")if(e==="/"&&o)i.id=o;else{i.text=(i.text??[]).concat(o);continue}}e=s}return t},S=n=>z(n,B(n,"!")).map(et),E=n=>{const t=tt(X(n)),e=B(t,",");if(!e.length)return S(t);const[s,o,i]=z(t,e).map(S);return{parent:s,start:o,end:i}},st=({index:n,id:t,offset:e,temporal:s,spatial:o,text:i,side:a})=>{const r=a?`;s=${a}`:"";return`/${n}`+(t?`[${L(t)}${r}]`:"")+(e!=null&&n%2?`:${e}`:"")+(s?`~${s}`:"")+(o?`@${o.join(":")}`:"")+(i||!t&&a?"["+(i?.map(L)?.join(",")??"")+r+"]":"")},D=n=>n.parent?[n.parent,n.start,n.end].map(D).join(","):n.map(t=>t.map(st).join("")).join("!"),b=n=>k(D(n)),p=(n,t)=>typeof n=="string"?b(p(E(n),t)):n.parent?q(n.parent,n[t?"end":"start"]):n,nt=(n,t)=>{typeof n=="string"&&(n=E(n)),typeof t=="string"&&(t=E(t)),n=p(n),t=p(t,!0);const e=n[n.length-1],s=t[t.length-1],o=[],i=[],a=[];let r=!0;const c=Math.max(e.length,s.length);for(let h=0;h<c;h++){const d=e[h],f=s[h];r&&=d?.index===f?.index&&!d?.offset&&!f?.offset,r?o.push(d):(d&&i.push(d),f&&a.push(f))}const l=n.slice(0,-1).concat([o]);return b({parent:l,start:[i],end:[a]})},I=({nodeType:n})=>n===3||n===4,v=({nodeType:n})=>n===1,M=(n,t)=>{const e=Array.from(n.childNodes).filter(s=>I(s)||v(s));return t?e.map(s=>{const o=t(s);return o===NodeFilter.FILTER_REJECT?null:o===NodeFilter.FILTER_SKIP?M(s,t):s}).flat().filter(s=>s):e},P=(n,t)=>{const e=M(n,t).reduce((s,o)=>{let i=s[s.length-1];return i?I(o)?Array.isArray(i)?i.push(o):I(i)?s[s.length-1]=[i,o]:s.push(o):v(i)?s.push(null,o):s.push(o):s.push(o),s},[]);return v(e[0])&&e.unshift("first"),v(e[e.length-1])&&e.push("last"),e.unshift("before"),e.push("after"),e},F=(n,t,e)=>{const{id:s}=t[t.length-1];if(s){const a=n.ownerDocument.getElementById(s);if(a)return{node:a,offset:0}}for(const{index:a}of t){const r=n?P(n,e)[a]:null;if(r==="first")return{node:n.firstChild??n};if(r==="last")return{node:n.lastChild??n};if(r==="before")return{node:n,before:!0};if(r==="after")return{node:n,after:!0};n=r}const{offset:o}=t[t.length-1];if(!Array.isArray(n))return{node:n,offset:o};let i=0;for(const a of n){const{length:r}=a.nodeValue;if(i+r>=o)return{node:a,offset:o-i};i+=r}},T=(n,t,e)=>{const{parentNode:s,id:o}=n,i=P(s,e),a=i.findIndex(l=>Array.isArray(l)?l.some(h=>h===n):l===n),r=i[a];if(Array.isArray(r)){let l=0;for(const h of r)if(h===n){l+=t;break}else l+=h.nodeValue.length;t=l}const c={id:o,index:a,offset:t};return(s!==n.ownerDocument.documentElement?T(s,null,e).concat(c):[c]).filter(l=>l.index!==-1)},ot=(n,t)=>{const{startContainer:e,startOffset:s,endContainer:o,endOffset:i}=n,a=T(e,s,t);if(n.collapsed)return b([a]);const r=T(o,i,t);return nt([a],[r])},it=(n,t,e)=>{const s=p(t),o=p(t,!0),i=n.documentElement,a=F(i,s[0],e),r=F(i,o[0],e),c=n.createRange();return a.before?c.setStartBefore(a.node):a.after?c.setStartAfter(a.node):c.setStart(a.node,a.offset),r.before?c.setEndBefore(r.node):r.after?c.setEndAfter(r.node):c.setEnd(r.node,r.offset),c},bt=n=>{const t=[],{parentNode:e}=n[0],s=T(e);for(const[o,i]of P(e).entries()){const a=n[t.length];i===a&&t.push(b([s.concat({id:a.id,index:o})]))}return t},xt=(n,t)=>F(n.documentElement,p(t)).node,O={fromIndex:n=>k(`/6/${(n+1)*2}`),toIndex:n=>n?.at(-1).index/2-1},rt=n=>{let t=0;const e=s=>{if(s.id=t++,s.subitems)for(const o of s.subitems)e(o)};for(const s of n)e(s);return n},W=n=>n.map(t=>t.subitems?.length?[t,W(t.subitems)].flat():t).flat();class R{async init({toc:t,ids:e,splitHref:s,getFragment:o}){rt(t);const i=W(t),a=new Map;for(const[c,l]of i.entries()){const[h,d]=await s(l?.href)??[],f={fragment:d,item:l};a.has(h)?a.get(h).items.push(f):a.set(h,{prev:i[c-1],items:[f]})}const r=new Map;for(const[c,l]of e.entries())a.has(l)?r.set(l,a.get(l)):r.set(l,r.get(e[c-1]));this.ids=e,this.map=r,this.getFragment=o}getProgress(t,e){if(!this.ids)return;const s=this.ids[t],o=this.map.get(s);if(!o)return null;const{prev:i,items:a}=o;if(!a)return i;if(!e||a.length===1&&!a[0].fragment)return a[0].item;const r=e.startContainer.getRootNode();for(const[c,{fragment:l}]of a.entries()){const h=this.getFragment(r,l);if(h&&e.comparePoint(h,0)>0)return a[c-1]?.item??i}return a[a.length-1].item}}class at{constructor(t,e,s){this.sizes=t.map(o=>o.linear!="no"&&o.size>0?o.size:0),this.sizePerLoc=e,this.sizePerTimeUnit=s,this.sizeTotal=this.sizes.reduce((o,i)=>o+i,0),this.sectionFractions=this.#e()}#e(){const{sizeTotal:t}=this,e=[0];let s=0;for(const o of this.sizes)e.push((s+=o)/t);return e}getProgress(t,e,s=0){const{sizes:o,sizePerLoc:i,sizePerTimeUnit:a,sizeTotal:r}=this,c=o[t]??0,h=o.slice(0,t).reduce((m,w)=>m+w,0)+e*c,d=h+s*c,f=r-h,u=(1-e)*c;return{fraction:d/r,section:{current:t,total:o.length},location:{current:Math.floor(h/i),next:Math.floor(d/i),total:Math.ceil(r/i)},time:{section:u/a,total:f/a}}}getSection(t){if(t<=0)return[0,0];if(t>=1)return[this.sizes.length-1,1];t=t+Number.EPSILON;const{sizeTotal:e}=this;let s=this.sectionFractions.findIndex(i=>i>t)-1;if(s<0)return[0,0];for(;!this.sizes[s];)s++;const o=(t-this.sectionFractions[s])/(this.sizes[s]/e);return[s,o]}}const ct=(n,t)=>{const e=[];for(let s=t.currentNode;s;s=t.nextNode()){const o=n.comparePoint(s,0);if(o===0)e.push(s);else if(o>0)break}return e},lt=(n,t)=>{const e=[];for(let s=t.nextNode();s;s=t.nextNode())e.push(s);return e},ht=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_CDATA_SECTION,dt=n=>{if(n.nodeType===1){const t=n.tagName.toLowerCase();return t==="script"||t==="style"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT},N=function*(n,t){const e=n.commonAncestorContainer??n.body??n,s=document.createTreeWalker(e,ht,{acceptNode:dt}),i=(n.commonAncestorContainer?ct:lt)(n,s),a=i.map(c=>c.nodeValue??""),r=(c,l,h,d)=>{const f=document.createRange();return f.setStart(i[c],l),f.setEnd(i[h],d),f};for(const c of t(a,r))yield c},y="foliate-search:",ut=async n=>{const t=new Uint8Array(await n.slice(0,4).arrayBuffer());return t[0]===80&&t[1]===75&&t[2]===3&&t[3]===4},ft=({name:n,type:t})=>t==="application/vnd.comicbook+zip"||n.endsWith(".cbz"),gt=({name:n,type:t})=>t==="application/x-fictionbook+xml"||n.endsWith(".fb2"),mt=({name:n,type:t})=>t==="application/x-zip-compressed-fb2"||n.endsWith(".fb2.zip")||n.endsWith(".fbz"),pt=async n=>{const{configure:t,ZipReader:e,BlobReader:s,TextWriter:o,BlobWriter:i}=await g(async()=>{const{configure:u,ZipReader:m,BlobReader:w,TextWriter:J,BlobWriter:K}=await import("./zip-Y2spjjw9.js");return{configure:u,ZipReader:m,BlobReader:w,TextWriter:J,BlobWriter:K}},[]);t({useWebWorkers:!1});const r=await new e(new s(n)).getEntries(),c=new Map(r.map(u=>[u.filename,u])),l=u=>(m,...w)=>c.has(m)?u(c.get(m),...w):null,h=l(u=>u.getData(new o)),d=l((u,m)=>u.getData(new i(m)));return{entries:r,loadText:h,loadBlob:d,getSize:u=>c.get(u)?.uncompressedSize??0}},$=async n=>n.isFile?n:(await Promise.all(Array.from(await new Promise((t,e)=>n.createReader().readEntries(s=>t(s),s=>e(s))),$))).flat(),wt=async n=>{const t=await $(n),e=await Promise.all(t.map(h=>new Promise((d,f)=>h.file(u=>d([u,h.fullPath]),u=>f(u))))),s=new Map(e.map(([h,d])=>[d.replace(n.fullPath+"/",""),h])),o=new TextDecoder,i=h=>h?o.decode(h):null,a=h=>s.get(h)?.arrayBuffer()??null;return{loadText:async h=>i(await a(h)),loadBlob:h=>s.get(h),getSize:h=>s.get(h)?.size??0}};class V extends Error{}class j extends Error{}class H extends Error{}const yt=async n=>{const t=await fetch(n);if(!t.ok)throw new V(`${t.status} ${t.statusText}`,{cause:t});return new File([await t.blob()],new URL(t.url).pathname)},U=async n=>{typeof n=="string"&&(n=await yt(n));let t;if(n.isDirectory){const e=await wt(n),{EPUB:s}=await g(async()=>{const{EPUB:o}=await import("./epub-BBoX9gK7.js");return{EPUB:o}},__vite__mapDeps([0,1,2,3]));t=await new s(e).init()}else if(n.size)if(await ut(n)){const e=await pt(n);if(ft(n)){const{makeComicBook:s}=await g(async()=>{const{makeComicBook:o}=await import("./comic-book-bOB0jkeu.js");return{makeComicBook:o}},[]);t=s(e,n)}else if(mt(n)){const{makeFB2:s}=await g(async()=>{const{makeFB2:r}=await import("./fb2-BI95Dv4-.js");return{makeFB2:r}},[]),{entries:o}=e,i=o.find(r=>r.filename.endsWith(".fb2")),a=await e.loadBlob((i??o[0]).filename);t=await s(a)}else{const{EPUB:s}=await g(async()=>{const{EPUB:o}=await import("./epub-BBoX9gK7.js");return{EPUB:o}},__vite__mapDeps([0,1,2,3]));t=await new s(e).init()}}else{const{isMOBI:e,MOBI:s}=await g(async()=>{const{isMOBI:o,MOBI:i}=await import("./mobi-Du_U6_-5.js");return{isMOBI:o,MOBI:i}},[]);if(await e(n)){const o=await g(()=>import("./fflate-CtUkkcu7.js"),[]);t=await new s({unzlib:o.unzlibSync}).open(n)}else if(gt(n)){const{makeFB2:o}=await g(async()=>{const{makeFB2:i}=await import("./fb2-BI95Dv4-.js");return{makeFB2:i}},[]);t=await o(n)}}else throw new j("File not found");if(!t)throw new H("File type not supported");return t};class C{#e;#t;#n;#s;constructor(t,e,s={}){this.#t=t,this.#n=e,this.#s=s,this.#s.hidden&&this.hide(),this.#t.addEventListener("mousemove",({screenX:o,screenY:i})=>{o===this.#s.x&&i===this.#s.y||(this.#s.x=o,this.#s.y=i,this.show(),this.#e&&clearTimeout(this.#e),e()&&(this.#e=setTimeout(this.hide.bind(this),1e3)))},!1)}cloneFor(t){return new C(t,this.#n,this.#s)}hide(){this.#t.style.cursor="none",this.#s.hidden=!0}show(){this.#t.style.removeProperty("cursor"),this.#s.hidden=!1}}class vt extends EventTarget{#e=[];#t=-1;pushState(t){const e=this.#e[this.#t];e===t||e?.fraction&&e.fraction===t.fraction||(this.#e[++this.#t]=t,this.#e.length=this.#t+1,this.dispatchEvent(new Event("index-change")))}replaceState(t){const e=this.#t;this.#e[e]=t}back(){const t=this.#t;if(t<=0)return;const e={state:this.#e[t-1]};this.#t=t-1,this.dispatchEvent(new CustomEvent("popstate",{detail:e})),this.dispatchEvent(new Event("index-change"))}forward(){const t=this.#t;if(t>=this.#e.length-1)return;const e={state:this.#e[t+1]};this.#t=t+1,this.dispatchEvent(new CustomEvent("popstate",{detail:e})),this.dispatchEvent(new Event("index-change"))}get canGoBack(){return this.#t>0}get canGoForward(){return this.#t<this.#e.length-1}clear(){this.#e=[],this.#t=-1}}const Et=n=>{if(!n)return{};try{const t=Intl.getCanonicalLocales(n)[0],e=new Intl.Locale(t),s=["zh","ja","kr"].includes(e.language),o=(e.getTextInfo?.()??e.textInfo)?.direction;return{canonical:t,locale:e,isCJK:s,direction:o}}catch(t){return console.warn(t),{}}};class Z extends HTMLElement{#e=this.attachShadow({mode:"closed"});#t;#n;#s;#i=new Map;#a=new C(this,()=>this.hasAttribute("autohide-cursor"));isFixedLayout=!1;lastLocation;history=new vt;constructor(){super(),this.history.addEventListener("popstate",({detail:t})=>{const e=this.resolveNavigation(t.state);this.renderer.goTo(e)})}async open(t){if((typeof t=="string"||typeof t.arrayBuffer=="function"||t.isDirectory)&&(t=await U(t)),this.book=t,this.language=Et(t.metadata?.language),t.splitTOCHref&&t.getTOCFragment){const e=t.sections.map(i=>i.id);this.#t=new at(t.sections,1500,1600);const s=t.splitTOCHref.bind(t),o=t.getTOCFragment.bind(t);this.#n=new R,await this.#n.init({toc:t.toc??[],ids:e,splitHref:s,getFragment:o}),this.#s=new R,await this.#s.init({toc:t.pageList??[],ids:e,splitHref:s,getFragment:o})}if(this.isFixedLayout=this.book.rendition?.layout==="pre-paginated",this.isFixedLayout?(await g(()=>import("./fixed-layout-DlZ2BKmE.js"),[]),this.renderer=document.createElement("foliate-fxl")):(await g(()=>import("./paginator-9dPRvgrx.js"),[]),this.renderer=document.createElement("foliate-paginator")),this.renderer.setAttribute("exportparts","head,foot,filter,container"),this.renderer.addEventListener("load",e=>this.#l(e.detail)),this.renderer.addEventListener("relocate",e=>this.#c(e.detail)),this.renderer.addEventListener("create-overlayer",e=>e.detail.attach(this.#d(e.detail))),this.renderer.open(t),this.#e.append(this.renderer),t.sections.some(e=>e.mediaOverlay)){const e=t.media.activeClass,s=t.media.playbackActiveClass;this.mediaOverlay=t.getMediaOverlay();let o;this.mediaOverlay.addEventListener("highlight",i=>{const a=this.resolveNavigation(i.detail.text);this.renderer.goTo(a).then(()=>{const{doc:r}=this.renderer.getContents().find(l=>l.index=a.index),c=a.anchor(r);c.classList.add(e),s&&c.ownerDocument.documentElement.classList.add(s),o=new WeakRef(c)})}),this.mediaOverlay.addEventListener("unhighlight",()=>{const i=o?.deref();i&&(i.classList.remove(e),s&&i.ownerDocument.documentElement.classList.remove(s))})}}close(){this.renderer?.destroy(),this.renderer?.remove(),this.#t=null,this.#n=null,this.#s=null,this.#i=new Map,this.lastLocation=null,this.history.clear(),this.tts=null,this.mediaOverlay=null}goToTextStart(){return this.goTo(this.book.landmarks?.find(t=>t.type.includes("bodymatter")||t.type.includes("text"))?.href??this.book.sections.findIndex(t=>t.linear!=="no"))}async init({lastLocation:t,showTextStart:e}){const s=t?this.resolveNavigation(t):null;s?(await this.renderer.goTo(s),this.history.pushState(t)):e?await this.goToTextStart():(this.history.pushState(0),await this.next())}#o(t,e,s){return this.dispatchEvent(new CustomEvent(t,{detail:e,cancelable:s}))}#c({reason:t,range:e,index:s,fraction:o,size:i}){const a=this.#t?.getProgress(s,o,i)??{},r=this.#n?.getProgress(s,e),c=this.#s?.getProgress(s,e),l=this.getCFI(s,e);this.lastLocation={...a,tocItem:r,pageItem:c,cfi:l,range:e},(t==="snap"||t==="page"||t==="scroll")&&this.history.replaceState(l),this.#o("relocate",this.lastLocation)}#l({doc:t,index:e}){t.documentElement.lang||=this.language.canonical??"",this.language.isCJK||(t.documentElement.dir||=this.language.direction??""),this.#h(t,e),this.#a.cloneFor(t.documentElement),this.#o("load",{doc:t,index:e})}#h(t,e){const{book:s}=this,o=s.sections[e];t.addEventListener("click",i=>{const a=i.target.closest("a[href]");if(!a)return;i.preventDefault();const r=a.getAttribute("href"),c=o?.resolveHref?.(r)??r;s?.isExternal?.(c)?Promise.resolve(this.#o("external-link",{a,href:c},!0)).then(l=>l?globalThis.open(c,"_blank"):null).catch(l=>console.error(l)):Promise.resolve(this.#o("link",{a,href:c},!0)).then(l=>l?this.goTo(c):null).catch(l=>console.error(l))})}async addAnnotation(t,e){const{value:s}=t;if(s.startsWith(y)){const c=s.replace(y,""),{index:l,anchor:h}=await this.resolveNavigation(c),d=this.#r(l);if(d){const{overlayer:f,doc:u}=d;if(e){f.remove(s);return}const m=u?h(u):h;f.add(s,m,A.outline)}return}const{index:o,anchor:i}=await this.resolveNavigation(s),a=this.#r(o);if(a){const{overlayer:c,doc:l}=a;if(c.remove(s),!e){const h=l?i(l):i,d=(f,u)=>c.add(s,h,f,u);this.#o("draw-annotation",{draw:d,annotation:t,doc:l,range:h})}}const r=this.#n.getProgress(o)?.label??"";return{index:o,label:r}}deleteAnnotation(t){return this.addAnnotation(t,!0)}#r(t){return this.renderer.getContents().find(e=>e.index===t&&e.overlayer)}#d({doc:t,index:e}){const s=new A(t);t.addEventListener("click",i=>{const[a,r]=s.hitTest(i);a&&!a.startsWith(y)&&this.#o("show-annotation",{value:a,index:e,range:r})},!1);const o=this.#i.get(e);if(o)for(const i of o)this.addAnnotation(i);return this.#o("create-overlay",{index:e}),s}async showAnnotation(t){const{value:e}=t,s=await this.goTo(e);if(s){const{index:o,anchor:i}=s,{doc:a}=this.#r(o),r=i(a);this.#o("show-annotation",{value:e,index:o,range:r})}}getCFI(t,e){const s=this.book.sections[t].cfi??O.fromIndex(t);return e?Y(s,ot(e)):s}resolveCFI(t){if(this.book.resolveCFI)return this.book.resolveCFI(t);{const e=E(t);return{index:O.toIndex((e.parent??e).shift()),anchor:i=>it(i,e)}}}resolveNavigation(t){try{if(typeof t=="number")return{index:t};if(typeof t.fraction=="number"){const[e,s]=this.#t.getSection(t.fraction);return{index:e,anchor:s}}return _.test(t)?this.resolveCFI(t):this.book.resolveHref(t)}catch(e){console.error(e),console.error(`Could not resolve target ${t}`)}}async goTo(t){const e=this.resolveNavigation(t);try{return await this.renderer.goTo(e),this.history.pushState(t),e}catch(s){console.error(s),console.error(`Could not go to ${t}`)}}async goToFraction(t){const[e,s]=this.#t.getSection(t);await this.renderer.goTo({index:e,anchor:s}),this.history.pushState({fraction:t})}async select(t){try{const e=await this.resolveNavigation(t);await this.renderer.goTo({...e,select:!0}),this.history.pushState(t)}catch(e){console.error(e),console.error(`Could not go to ${t}`)}}deselect(){for(const{doc:t}of this.renderer.getContents())t.defaultView.getSelection().removeAllRanges()}getSectionFractions(){return(this.#t?.sectionFractions??[]).map(t=>t+Number.EPSILON)}getProgressOf(t,e){const s=this.#n?.getProgress(t,e),o=this.#s?.getProgress(t,e);return{tocItem:s,pageItem:o}}async getTOCItemOf(t){try{const{index:e,anchor:s}=await this.resolveNavigation(t),o=await this.book.sections[e].createDocument(),i=s(o),a=i instanceof Range,r=a?i:o.createRange();return a||r.selectNodeContents(i),this.#n.getProgress(e,r)}catch(e){console.error(e),console.error(`Could not get ${t}`)}}async prev(t){await this.renderer.prev(t)}async next(t){await this.renderer.next(t)}goLeft(){return this.book.dir==="rtl"?this.next():this.prev()}goRight(){return this.book.dir==="rtl"?this.prev():this.next()}async*#u(t,e,s){const o=await this.book.sections[s].createDocument();for(const{range:i,excerpt:a}of t(o,e))yield{cfi:this.getCFI(s,i),excerpt:a}}async*#f(t,e){const{sections:s}=this.book;for(const[o,{createDocument:i}]of s.entries()){if(!i)continue;const a=await i(),r=Array.from(t(a,e),({range:l,excerpt:h})=>({cfi:this.getCFI(o,l),excerpt:h}));yield{progress:(o+1)/s.length},r.length&&(yield{index:o,subitems:r})}}async*search(t){this.clearSearch();const{searchMatcher:e}=await g(async()=>{const{searchMatcher:c}=await import("./search-D7qEUpRP.js");return{searchMatcher:c}},[]),{query:s,index:o}=t,i=e(N,{defaultLocale:this.language,...t}),a=o!=null?this.#u(i,s,o):this.#f(i,s),r=[];this.#i.set(o,r);for await(const c of a)if(c.subitems){const l=c.subitems.map(({cfi:h})=>({value:y+h}));this.#i.set(c.index,l);for(const h of l)this.addAnnotation(h);yield{label:this.#n.getProgress(c.index)?.label??"",subitems:c.subitems}}else{if(c.cfi){const l={value:y+c.cfi};r.push(l),this.addAnnotation(l)}yield c}yield"done"}clearSearch(){for(const t of this.#i.values())for(const e of t)this.deleteAnnotation(e);this.#i.clear()}async initTTS(t="word"){const e=this.renderer.getContents()[0].doc;if(this.tts&&this.tts.doc===e)return;const{TTS:s}=await g(async()=>{const{TTS:o}=await import("./tts-b9tpcooj.js");return{TTS:o}},[]);this.tts=new s(e,N,o=>this.renderer.scrollToAnchor(o,!0),t)}startMediaOverlay(){const{index:t}=this.renderer.getContents()[0];return this.mediaOverlay.start(t)}}customElements.define("foliate-view",Z);const It=Object.freeze(Object.defineProperty({__proto__:null,NotFoundError:j,ResponseError:V,UnsupportedTypeError:H,View:Z,makeBook:U},Symbol.toStringTag,{value:"Module"}));export{it as a,bt as f,E as p,xt as t,It as v};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/view-JuSt08YB.js","assets/overlayer-CvcsrVD0.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const M_=!1;var q0=Array.isArray,xj=Array.prototype.indexOf,Ck=Array.from,kj=Object.defineProperty,Gd=Object.getOwnPropertyDescriptor,AD=Object.getOwnPropertyDescriptors,CD=Object.prototype,Sj=Array.prototype,H0=Object.getPrototypeOf,JT=Object.isExtensible;function Tj(n){return typeof n=="function"}const Zl=()=>{};function Aj(n){return n()}function R_(n){for(var e=0;e<n.length;e++)n[e]()}function ED(){var n,e,t=new Promise((r,i)=>{n=r,e=i});return{promise:t,resolve:n,reject:e}}const fi=2,Ek=4,Z0=8,Cj=1<<24,ja=16,Ml=32,Lu=64,W0=128,Vo=512,Oi=1024,us=2048,Rl=4096,Ns=8192,ml=16384,X0=32768,dc=65536,eA=1<<17,Pk=1<<18,Gh=1<<19,PD=1<<20,yu=32768,D_=1<<21,Ik=1<<22,tc=1<<23,vl=Symbol("$state"),Ej=Symbol("legacy props"),Pj=Symbol(""),Id=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function ID(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Ij(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Mj(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Rj(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Dj(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Nj(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Lj(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function Qj(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function $j(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Fj(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function zj(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const MD=1,RD=2,DD=4,Bj=8,Uj=16,jj=1,Vj=2,qj=4,Hj=8,Zj=16,Wj=1,Xj=2,Yj=4,Gj=1,Kj=2,yi=Symbol(),Jj="http://www.w3.org/1999/xhtml";function e9(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function t9(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ND(n){return n===this.v}function LD(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function QD(n){return!LD(n,this.v)}let Kh=!1,n9=!1;function r9(){Kh=!0}const i9=[];function dy(n,e=!1,t=!1){return Rv(n,new Map,"",i9,null,t)}function Rv(n,e,t,r,i=null,s=!1){if(typeof n=="object"&&n!==null){var o=e.get(n);if(o!==void 0)return o;if(n instanceof Map)return new Map(n);if(n instanceof Set)return new Set(n);if(q0(n)){var a=Array(n.length);e.set(n,a),i!==null&&e.set(i,a);for(var l=0;l<n.length;l+=1){var c=n[l];l in n&&(a[l]=Rv(c,e,t,r,null,s))}return a}if(H0(n)===CD){a={},e.set(n,a),i!==null&&e.set(i,a);for(var d in n)a[d]=Rv(n[d],e,t,r,null,s);return a}if(n instanceof Date)return structuredClone(n);if(typeof n.toJSON=="function"&&!s)return Rv(n.toJSON(),e,t,r,n)}if(n instanceof EventTarget)return n;try{return structuredClone(n)}catch{return n}}let Or=null;function vh(n){Or=n}function lt(n,e=!1,t){Or={p:Or,i:!1,c:null,e:null,s:n,x:null,l:Kh&&!e?{s:null,u:null,$:[]}:null}}function ct(n){var e=Or,t=e.e;if(t!==null){e.e=null;for(var r of t)JD(r)}return n!==void 0&&(e.x=n),e.i=!0,Or=e.p,n??{}}function Jh(){return!Kh||Or!==null&&Or.l===null}let Jc=[];function $D(){var n=Jc;Jc=[],R_(n)}function kl(n){if(Jc.length===0&&!hp){var e=Jc;queueMicrotask(()=>{e===Jc&&$D()})}Jc.push(n)}function s9(){for(;Jc.length>0;)$D()}function FD(n){var e=Rn;if(e===null)return En.f|=tc,n;if((e.f&X0)===0){if((e.f&W0)===0)throw n;e.b.error(n)}else yh(n,e)}function yh(n,e){for(;e!==null;){if((e.f&W0)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const Am=new Set;let Pn=null,dp=null,oo=null,to=[],Y0=null,N_=!1,hp=!1;class Sa{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#r=0;#n=0;#s=null;#i=[];#o=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){to=[],dp=null,this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of e)this.#a(r,t);this.is_fork||this.#h(),this.is_deferred()?(this.#l(t.effects),this.#l(t.render_effects),this.#l(t.block_effects)):(dp=this,Pn=null,tA(t.render_effects),tA(t.effects),dp=null,this.#s?.resolve()),oo=null}#a(e,t){e.f^=Oi;for(var r=e.first;r!==null;){var i=r.f,s=(i&(Ml|Lu))!==0,o=s&&(i&Oi)!==0,a=o||(i&Ns)!==0||this.skipped_effects.has(r);if((r.f&W0)!==0&&r.b?.is_pending()&&(t={parent:t,effect:r,effects:[],render_effects:[],block_effects:[]}),!a&&r.fn!==null){s?r.f^=Oi:(i&Ek)!==0?t.effects.push(r):Fg(r)&&((r.f&ja)!==0&&t.block_effects.push(r),Np(r));var l=r.first;if(l!==null){r=l;continue}}var c=r.parent;for(r=r.next;r===null&&c!==null;)c===t.effect&&(this.#l(t.effects),this.#l(t.render_effects),this.#l(t.block_effects),t=t.parent),r=c.next,c=c.parent}}#l(e){for(const t of e)((t.f&us)!==0?this.#i:this.#o).push(t),this.#c(t.deps),xi(t,Oi)}#c(e){if(e!==null)for(const t of e)(t.f&fi)===0||(t.f&yu)===0||(t.f^=yu,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&tc)===0&&(this.current.set(e,e.v),oo?.set(e,e.v))}activate(){Pn=this,this.apply()}deactivate(){Pn===this&&(Pn=null,oo=null)}flush(){if(this.activate(),to.length>0){if(zD(),Pn!==null&&Pn!==this)return}else this.#r===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#h(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#r===0&&this.#u()}#u(){if(Am.size>1){this.previous.clear();var e=oo,t=!0,r={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of Am){if(s===this){t=!1;continue}const o=[];for(const[l,c]of this.current){if(s.current.has(l))if(t&&c!==s.current.get(l))s.current.set(l,c);else continue;o.push(l)}if(o.length===0)continue;const a=[...s.current.keys()].filter(l=>!this.current.has(l));if(a.length>0){var i=to;to=[];const l=new Set,c=new Map;for(const d of o)BD(d,a,l,c);if(to.length>0){Pn=s,s.apply();for(const d of to)s.#a(d,r);s.deactivate()}to=i}}Pn=null,oo=e}this.committed=!0,Am.delete(this)}increment(e){this.#r+=1,e&&(this.#n+=1)}decrement(e){this.#r-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#i)xi(e,us),bu(e);for(const e of this.#o)xi(e,Rl),bu(e);this.#i=[],this.#o=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#s??=ED()).promise}static ensure(){if(Pn===null){const e=Pn=new Sa;Am.add(Pn),hp||Sa.enqueue(()=>{Pn===e&&e.flush()})}return Pn}static enqueue(e){kl(e)}apply(){}}function o9(n){var e=hp;hp=!0;try{for(var t;;){if(s9(),to.length===0&&(Pn?.flush(),to.length===0))return Y0=null,t;zD()}}finally{hp=e}}function zD(){var n=rc;N_=!0;var e=null;try{var t=0;for(fy(!0);to.length>0;){var r=Sa.ensure();if(t++>1e3){var i,s;a9()}r.process(to),nc.clear()}}finally{N_=!1,fy(n),Y0=null}}function a9(){try{Nj()}catch(n){yh(n,Y0)}}let rl=null;function tA(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(ml|Ns))===0&&Fg(r)&&(rl=new Set,Np(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?i3(r):r.fn=null),rl?.size>0)){nc.clear();for(const i of rl){if((i.f&(ml|Ns))!==0)continue;const s=[i];let o=i.parent;for(;o!==null;)rl.has(o)&&(rl.delete(o),s.push(o)),o=o.parent;for(let a=s.length-1;a>=0;a--){const l=s[a];(l.f&(ml|Ns))===0&&Np(l)}}rl.clear()}}rl=null}}function BD(n,e,t,r){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const i of n.reactions){const s=i.f;(s&fi)!==0?BD(i,e,t,r):(s&(Ik|ja))!==0&&(s&us)===0&&UD(i,e,r)&&(xi(i,us),bu(i))}}function UD(n,e,t){const r=t.get(n);if(r!==void 0)return r;if(n.deps!==null)for(const i of n.deps){if(e.includes(i))return!0;if((i.f&fi)!==0&&UD(i,e,t))return t.set(i,!0),!0}return t.set(n,!1),!1}function bu(n){for(var e=Y0=n;e.parent!==null;){e=e.parent;var t=e.f;if(N_&&e===Rn&&(t&ja)!==0&&(t&Pk)===0)return;if((t&(Lu|Ml))!==0){if((t&Oi)===0)return;e.f^=Oi}}to.push(e)}function l9(n){let e=0,t=Tl(0),r;return()=>{Rp()&&(u(t),$g(()=>(e===0&&(r=as(()=>n(()=>Es(t)))),e+=1,()=>{kl(()=>{e-=1,e===0&&(r?.(),r=void 0,Es(t))})})))}}var c9=dc|Gh|W0;function u9(n,e,t){new d9(n,e,t)}class d9{parent;#e=!1;#t;#r=null;#n;#s;#i;#o=null;#a=null;#l=null;#c=null;#h=null;#u=0;#p=0;#m=!1;#f=null;#d=l9(()=>(this.#f=Tl(this.#u),()=>{this.#f=null}));constructor(e,t,r){this.#t=e,this.#n=t,this.#s=r,this.parent=Rn.b,this.#e=!!this.#n.pending,this.#i=tf(()=>{Rn.b=this;{var i=this.#b();try{this.#o=no(()=>r(i))}catch(s){this.error(s)}this.#p>0?this.#k():this.#e=!1}return()=>{this.#h?.remove()}},c9)}#g(){try{this.#o=no(()=>this.#s(this.#t))}catch(e){this.error(e)}this.#e=!1}#y(){const e=this.#n.pending;e&&(this.#a=no(()=>e(this.#t)),Sa.enqueue(()=>{var t=this.#b();this.#o=this.#v(()=>(Sa.ensure(),no(()=>this.#s(t)))),this.#p>0?this.#k():(Kd(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#b(){var e=this.#t;return this.#e&&(this.#h=La(),this.#t.before(this.#h),e=this.#h),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#v(e){var t=Rn,r=En,i=Or;Qa(this.#i),rs(this.#i),vh(this.#i.ctx);try{return e()}catch(s){return FD(s),null}finally{Qa(t),rs(r),vh(i)}}#k(){const e=this.#n.pending;this.#o!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#h),a3(this.#o,this.#c)),this.#a===null&&(this.#a=no(()=>e(this.#t)))}#x(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#x(e);return}this.#p+=e,this.#p===0&&(this.#e=!1,this.#a&&Kd(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#x(e),this.#u+=e,this.#f&&bh(this.#f,this.#u)}get_effect_pending(){return this.#d(),u(this.#f)}error(e){var t=this.#n.onerror;let r=this.#n.failed;if(this.#m||!t&&!r)throw e;this.#o&&(os(this.#o),this.#o=null),this.#a&&(os(this.#a),this.#a=null),this.#l&&(os(this.#l),this.#l=null);var i=!1,s=!1;const o=()=>{if(i){t9();return}i=!0,s&&zj(),Sa.ensure(),this.#u=0,this.#l!==null&&Kd(this.#l,()=>{this.#l=null}),this.#e=this.has_pending_snippet(),this.#o=this.#v(()=>(this.#m=!1,no(()=>this.#s(this.#t)))),this.#p>0?this.#k():this.#e=!1};var a=En;try{rs(null),s=!0,t?.(e,o),s=!1}catch(l){yh(l,this.#i&&this.#i.parent)}finally{rs(a)}r&&kl(()=>{this.#l=this.#v(()=>{Sa.ensure(),this.#m=!0;try{return no(()=>{r(this.#t,()=>e,()=>o)})}catch(l){return yh(l,this.#i.parent),null}finally{this.#m=!1}})})}}function Sl(n,e){return e}function h9(n,e,t){for(var r=[],i=e.length,s=0;s<i;s++)Nk(e[s].e,r,!0);s3(r,()=>{var o=r.length===0&&t!==null;if(o){var a=t,l=a.parentNode;x9(l),l.append(a),n.items.clear(),Ro(n,e[0].prev,e[i-1].next)}for(var c=0;c<i;c++){var d=e[c];o||(n.items.delete(d.k),Ro(n,d.prev,d.next)),os(d.e,!o)}n.first===e[0]&&(n.first=e[0].prev)})}function Tt(n,e,t,r,i,s=null){var o=n,a=new Map,l=null,c=(e&DD)!==0,d=(e&MD)!==0,h=(e&RD)!==0;if(c){var f=n;o=f.appendChild(La())}var p=null,g=Mk(()=>{var x=t();return q0(x)?x:x==null?[]:Ck(x)}),m,v=!0;function y(){f9(_,m,o,e,r),p!==null&&(m.length===0?(p.fragment?(o.before(p.fragment),p.fragment=null):Lk(p.effect),O.first=p.effect):Kd(p.effect,()=>{p=null}))}var O=tf(()=>{m=u(g);for(var x=m.length,k=new Set,S=Pn,E=null,R=GD(),C=0;C<x;C+=1){var I=m[C],D=r(I,C),Q=v?null:a.get(D);Q?(d&&bh(Q.v,I),h?bh(Q.i,C):Q.i=C,R&&S.skipped_effects.delete(Q.e)):(Q=p9(v?o:null,E,I,D,C,i,e,t),v&&(Q.o=!0,E===null?l=Q:E.next=Q,E=Q),a.set(D,Q)),k.add(D)}if(x===0&&s&&!p)if(v)p={fragment:null,effect:no(()=>s(o))};else{var M=document.createDocumentFragment(),N=La();M.append(N),p={fragment:M,effect:no(()=>s(N))}}if(!v)if(R){for(const[B,H]of a)k.has(B)||S.skipped_effects.add(H.e);S.oncommit(y),S.ondiscard(()=>{})}else y();u(g)}),_={effect:O,items:a,first:l};v=!1}function f9(n,e,t,r,i){var s=(r&Bj)!==0,o=e.length,a=n.items,l=n.first,c,d=null,h,f=[],p=[],g,m,v,y;if(s)for(y=0;y<o;y+=1)g=e[y],m=i(g,y),v=a.get(m),v.o&&(v.a?.measure(),(h??=new Set).add(v));for(y=0;y<o;y+=1){if(g=e[y],m=i(g,y),v=a.get(m),n.first??=v,!v.o){v.o=!0;var O=d?d.next:l;Ro(n,d,v),Ro(n,v,O),nw(v,O,t),d=v,f=[],p=[],l=d.next;continue}if((v.e.f&Ns)!==0&&(Lk(v.e),s&&(v.a?.unfix(),(h??=new Set).delete(v))),v!==l){if(c!==void 0&&c.has(v)){if(f.length<p.length){var _=p[0],x;d=_.prev;var k=f[0],S=f[f.length-1];for(x=0;x<f.length;x+=1)nw(f[x],_,t);for(x=0;x<p.length;x+=1)c.delete(p[x]);Ro(n,k.prev,S.next),Ro(n,d,k),Ro(n,S,_),l=_,d=S,y-=1,f=[],p=[]}else c.delete(v),nw(v,l,t),Ro(n,v.prev,v.next),Ro(n,v,d===null?n.first:d.next),Ro(n,d,v),d=v;continue}for(f=[],p=[];l!==null&&l.k!==m;)(l.e.f&Ns)===0&&(c??=new Set).add(l),p.push(l),l=l.next;if(l===null)continue;v=l}f.push(v),d=v,l=v.next}let E=a.size>o;if(l!==null||c!==void 0){for(var R=c===void 0?[]:Ck(c);l!==null;)(l.e.f&Ns)===0&&R.push(l),l=l.next;var C=R.length;if(E=a.size-C>o,C>0){var I=(r&DD)!==0&&o===0?t:null;if(s){for(y=0;y<C;y+=1)R[y].a?.measure();for(y=0;y<C;y+=1)R[y].a?.fix()}h9(n,R,I)}}if(E)for(const D of a.values())D.o||(Ro(n,d,D),d=D);n.effect.last=d&&d.e,s&&kl(()=>{if(h!==void 0)for(v of h)v.a?.apply()})}function p9(n,e,t,r,i,s,o,a){var l=(o&MD)!==0,c=(o&Uj)===0,d=l?c?b9(t,!1,!1):Tl(t):t,h=(o&RD)===0?i:Tl(i),f={i:h,v:d,k:r,a:null,e:null,o:!1,prev:e,next:null};try{if(n===null){var p=document.createDocumentFragment();p.append(n=La())}return f.e=no(()=>s(n,d,h,a)),e!==null&&(e.next=f),f}finally{}}function nw(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,i=e?e.e.nodes_start:t,s=n.e.nodes_start;s!==null&&s!==r;){var o=Qg(s);i.before(s),s=o}}function Ro(n,e,t){e===null?(n.first=t,n.effect.first=t&&t.e):(e.e.next&&(e.e.next.prev=null),e.next=t,e.e.next=t&&t.e),t!==null&&(t.e.prev&&(t.e.prev.next=null),t.prev=e,t.e.prev=e&&e.e)}function g9(n,e,t,r){const i=Jh()?Lg:Mk;if(t.length===0&&n.length===0){r(e.map(i));return}var s=Pn,o=Rn,a=m9();function l(){Promise.all(t.map(c=>v9(c))).then(c=>{a();try{r([...e.map(i),...c])}catch(d){(o.f&ml)===0&&yh(d,o)}s?.deactivate(),hy()}).catch(c=>{yh(c,o)})}n.length>0?Promise.all(n).then(()=>{a();try{return l()}finally{s?.deactivate(),hy()}}):l()}function m9(){var n=Rn,e=En,t=Or,r=Pn;return function(s=!0){Qa(n),rs(e),vh(t),s&&r?.activate()}}function hy(){Qa(null),rs(null),vh(null)}function Lg(n){var e=fi|us,t=En!==null&&(En.f&fi)!==0?En:null;return Rn!==null&&(Rn.f|=Gh),{ctx:Or,deps:null,effects:null,equals:ND,f:e,fn:n,reactions:null,rv:0,v:yi,wv:0,parent:t??Rn,ac:null}}function v9(n,e){let t=Rn;t===null&&Ij();var r=t.b,i=void 0,s=Tl(yi),o=!En,a=new Map;return A9(()=>{var l=ED();i=l.promise;try{Promise.resolve(n()).then(l.resolve,l.reject).then(()=>{c===Pn&&c.committed&&c.deactivate(),hy()})}catch(f){l.reject(f),hy()}var c=Pn;if(o){var d=!r.is_pending();r.update_pending_count(1),c.increment(d),a.get(c)?.reject(Id),a.delete(c),a.set(c,l)}const h=(f,p=void 0)=>{if(c.activate(),p)p!==Id&&(s.f|=tc,bh(s,p));else{(s.f&tc)!==0&&(s.f^=tc),bh(s,f);for(const[g,m]of a){if(a.delete(g),g===c)break;m.reject(Id)}}o&&(r.update_pending_count(-1),c.decrement(d))};l.promise.then(h,f=>h(null,f||"unknown"))}),G0(()=>{for(const l of a.values())l.reject(Id)}),new Promise(l=>{function c(d){function h(){d===i?l(s):c(i)}d.then(h,h)}c(i)})}function le(n){const e=Lg(n);return l3(e),e}function Mk(n){const e=Lg(n);return e.equals=QD,e}function jD(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)os(e[t])}}function y9(n){for(var e=n.parent;e!==null;){if((e.f&fi)===0)return(e.f&ml)===0?e:null;e=e.parent}return null}function Rk(n){var e,t=Rn;Qa(y9(n));try{n.f&=~yu,jD(n),e=h3(n)}finally{Qa(t)}return e}function VD(n){var e=Rk(n);if(n.equals(e)||(Pn?.is_fork||(n.v=e),n.wv=u3()),!Qu)if(oo!==null)(Rp()||Pn?.is_fork)&&oo.set(n,e);else{var t=(n.f&Vo)===0?Rl:Oi;xi(n,t)}}let L_=new Set;const nc=new Map;let qD=!1;function Tl(n,e){var t={f:0,v:n,reactions:null,equals:ND,rv:0,wv:0};return t}function j(n,e){const t=Tl(n);return l3(t),t}function b9(n,e=!1,t=!0){const r=Tl(n);return e||(r.equals=QD),Kh&&t&&Or!==null&&Or.l!==null&&(Or.l.s??=[]).push(r),r}function b(n,e,t=!1){En!==null&&(!Aa||(En.f&eA)!==0)&&Jh()&&(En.f&(fi|ja|Ik|eA))!==0&&!yl?.includes(n)&&Fj();let r=t?Qt(e):e;return bh(n,r)}function bh(n,e){if(!n.equals(e)){var t=n.v;Qu?nc.set(n,e):nc.set(n,t),n.v=e;var r=Sa.ensure();r.capture(n,t),(n.f&fi)!==0&&((n.f&us)!==0&&Rk(n),xi(n,(n.f&Vo)!==0?Oi:Rl)),n.wv=u3(),HD(n,us),Jh()&&Rn!==null&&(Rn.f&Oi)!==0&&(Rn.f&(Ml|Lu))===0&&(Ks===null?E9([n]):Ks.push(n)),!r.is_fork&&L_.size>0&&!qD&&w9()}return e}function w9(){qD=!1;var n=rc;fy(!0);const e=Array.from(L_);try{for(const t of e)(t.f&Oi)!==0&&xi(t,Rl),Fg(t)&&Np(t)}finally{fy(n)}L_.clear()}function _9(n,e=1){var t=u(n),r=e===1?t++:t--;return b(n,t),r}function Es(n){b(n,n.v+1)}function HD(n,e){var t=n.reactions;if(t!==null)for(var r=Jh(),i=t.length,s=0;s<i;s++){var o=t[s],a=o.f;if(!(!r&&o===Rn)){var l=(a&us)===0;if(l&&xi(o,e),(a&fi)!==0){var c=o;oo?.delete(c),(a&yu)===0&&(a&Vo&&(o.f|=yu),HD(c,Rl))}else l&&((a&ja)!==0&&rl!==null&&rl.add(o),bu(o))}}}function Qt(n){if(typeof n!="object"||n===null||vl in n)return n;const e=H0(n);if(e!==CD&&e!==Sj)return n;var t=new Map,r=q0(n),i=j(0),s=Uo,o=a=>{if(Uo===s)return a();var l=En,c=Uo;rs(null),sA(s);var d=a();return rs(l),sA(c),d};return r&&t.set("length",j(n.length)),new Proxy(n,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Qj();var d=t.get(l);return d===void 0?d=o(()=>{var h=j(c.value);return t.set(l,h),h}):b(d,c.value,!0),!0},deleteProperty(a,l){var c=t.get(l);if(c===void 0){if(l in a){const d=o(()=>j(yi));t.set(l,d),Es(i)}}else b(c,yi),Es(i);return!0},get(a,l,c){if(l===vl)return n;var d=t.get(l),h=l in a;if(d===void 0&&(!h||Gd(a,l)?.writable)&&(d=o(()=>{var p=Qt(h?a[l]:yi),g=j(p);return g}),t.set(l,d)),d!==void 0){var f=u(d);return f===yi?void 0:f}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var d=t.get(l);d&&(c.value=u(d))}else if(c===void 0){var h=t.get(l),f=h?.v;if(h!==void 0&&f!==yi)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(a,l){if(l===vl)return!0;var c=t.get(l),d=c!==void 0&&c.v!==yi||Reflect.has(a,l);if(c!==void 0||Rn!==null&&(!d||Gd(a,l)?.writable)){c===void 0&&(c=o(()=>{var f=d?Qt(a[l]):yi,p=j(f);return p}),t.set(l,c));var h=u(c);if(h===yi)return!1}return d},set(a,l,c,d){var h=t.get(l),f=l in a;if(r&&l==="length")for(var p=c;p<h.v;p+=1){var g=t.get(p+"");g!==void 0?b(g,yi):p in a&&(g=o(()=>j(yi)),t.set(p+"",g))}if(h===void 0)(!f||Gd(a,l)?.writable)&&(h=o(()=>j(void 0)),b(h,Qt(c)),t.set(l,h));else{f=h.v!==yi;var m=o(()=>Qt(c));b(h,m)}var v=Reflect.getOwnPropertyDescriptor(a,l);if(v?.set&&v.set.call(d,c),!f){if(r&&typeof l=="string"){var y=t.get("length"),O=Number(l);Number.isInteger(O)&&O>=y.v&&b(y,O+1)}Es(i)}return!0},ownKeys(a){u(i);var l=Reflect.ownKeys(a).filter(h=>{var f=t.get(h);return f===void 0||f.v!==yi});for(var[c,d]of t)d.v!==yi&&!(c in a)&&l.push(c);return l},setPrototypeOf(){$j()}})}function nA(n){try{if(n!==null&&typeof n=="object"&&vl in n)return n[vl]}catch{}return n}function ZD(n,e){return Object.is(nA(n),nA(e))}var Na,WD,XD,YD;function O9(){if(Na===void 0){Na=window,WD=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;XD=Gd(e,"firstChild").get,YD=Gd(e,"nextSibling").get,JT(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),JT(t)&&(t.__t=void 0)}}function La(n=""){return document.createTextNode(n)}function Ta(n){return XD.call(n)}function Qg(n){return YD.call(n)}function w(n,e){return Ta(n)}function Ie(n,e=!1){{var t=Ta(n);return t instanceof Comment&&t.data===""?Qg(t):t}}function A(n,e=1,t=!1){let r=n;for(;e--;)r=Qg(r);return r}function x9(n){n.textContent=""}function GD(){return!1}let rA=!1;function k9(){rA||(rA=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function ef(n){var e=En,t=Rn;rs(null),Qa(null);try{return n()}finally{rs(e),Qa(t)}}function Dk(n,e,t,r=t){n.addEventListener(e,()=>ef(t));const i=n.__on_r;i?n.__on_r=()=>{i(),r(!0)}:n.__on_r=()=>r(!0),k9()}function KD(n){Rn===null&&(En===null&&Dj(),Rj()),Qu&&Mj()}function S9(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Va(n,e,t){var r=Rn;r!==null&&(r.f&Ns)!==0&&(n|=Ns);var i={ctx:Or,deps:null,nodes_start:null,nodes_end:null,f:n|us|Vo,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Np(i),i.f|=X0}catch(a){throw os(i),a}else e!==null&&bu(i);var s=i;if(t&&s.deps===null&&s.teardown===null&&s.nodes_start===null&&s.first===s.last&&(s.f&Gh)===0&&(s=s.first,(n&ja)!==0&&(n&dc)!==0&&s!==null&&(s.f|=dc)),s!==null&&(s.parent=r,r!==null&&S9(s,r),En!==null&&(En.f&fi)!==0&&(n&Lu)===0)){var o=En;(o.effects??=[]).push(s)}return i}function Rp(){return En!==null&&!Aa}function G0(n){const e=Va(Z0,null,!1);return xi(e,Oi),e.teardown=n,e}function tt(n){KD();var e=Rn.f,t=!En&&(e&Ml)!==0&&(e&X0)===0;if(t){var r=Or;(r.e??=[]).push(n)}else return JD(n)}function JD(n){return Va(Ek|PD,n,!1)}function e3(n){return KD(),Va(Z0|PD,n,!0)}function T9(n){Sa.ensure();const e=Va(Lu|Gh,n,!0);return(t={})=>new Promise(r=>{t.outro?Kd(e,()=>{os(e),r(void 0)}):(os(e),r(void 0))})}function K0(n){return Va(Ek,n,!1)}function A9(n){return Va(Ik|Gh,n,!0)}function $g(n,e=0){return Va(Z0|e,n,!0)}function Y(n,e=[],t=[],r=[]){g9(r,e,t,i=>{Va(Z0,()=>n(...i.map(u)),!0)})}function tf(n,e=0){var t=Va(ja|e,n,!0);return t}function no(n){return Va(Ml|Gh,n,!0)}function t3(n){var e=n.teardown;if(e!==null){const t=Qu,r=En;iA(!0),rs(null);try{e.call(null)}finally{iA(t),rs(r)}}}function n3(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const i=t.ac;i!==null&&ef(()=>{i.abort(Id)});var r=t.next;(t.f&Lu)!==0?t.parent=null:os(t,e),t=r}}function C9(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Ml)===0&&os(e),e=t}}function os(n,e=!0){var t=!1;(e||(n.f&Pk)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(r3(n.nodes_start,n.nodes_end),t=!0),n3(n,e&&!t),py(n,0),xi(n,ml);var r=n.transitions;if(r!==null)for(const s of r)s.stop();t3(n);var i=n.parent;i!==null&&i.first!==null&&i3(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function r3(n,e){for(;n!==null;){var t=n===e?null:Qg(n);n.remove(),n=t}}function i3(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Kd(n,e,t=!0){var r=[];Nk(n,r,!0),s3(r,()=>{t&&os(n),e&&e()})}function s3(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var i of n)i.out(r)}else e()}function Nk(n,e,t){if((n.f&Ns)===0){if(n.f^=Ns,n.transitions!==null)for(const o of n.transitions)(o.is_global||t)&&e.push(o);for(var r=n.first;r!==null;){var i=r.next,s=(r.f&dc)!==0||(r.f&Ml)!==0&&(n.f&ja)!==0;Nk(r,e,s?t:!1),r=i}}}function Lk(n){o3(n,!0)}function o3(n,e){if((n.f&Ns)!==0){n.f^=Ns,(n.f&Oi)===0&&(xi(n,us),bu(n));for(var t=n.first;t!==null;){var r=t.next,i=(t.f&dc)!==0||(t.f&Ml)!==0;o3(t,i?e:!1),t=r}if(n.transitions!==null)for(const s of n.transitions)(s.is_global||e)&&s.in()}}function a3(n,e){for(var t=n.nodes_start,r=n.nodes_end;t!==null;){var i=t===r?null:Qg(t);e.append(t),t=i}}let rc=!1;function fy(n){rc=n}let Qu=!1;function iA(n){Qu=n}let En=null,Aa=!1;function rs(n){En=n}let Rn=null;function Qa(n){Rn=n}let yl=null;function l3(n){En!==null&&(yl===null?yl=[n]:yl.push(n))}let Li=null,bs=0,Ks=null;function E9(n){Ks=n}let c3=1,Dp=0,Uo=Dp;function sA(n){Uo=n}function u3(){return++c3}function Fg(n){var e=n.f;if((e&us)!==0)return!0;if(e&fi&&(n.f&=~yu),(e&Rl)!==0){var t=n.deps;if(t!==null)for(var r=t.length,i=0;i<r;i++){var s=t[i];if(Fg(s)&&VD(s),s.wv>n.wv)return!0}(e&Vo)!==0&&oo===null&&xi(n,Oi)}return!1}function d3(n,e,t=!0){var r=n.reactions;if(r!==null&&!yl?.includes(n))for(var i=0;i<r.length;i++){var s=r[i];(s.f&fi)!==0?d3(s,e,!1):e===s&&(t?xi(s,us):(s.f&Oi)!==0&&xi(s,Rl),bu(s))}}function h3(n){var e=Li,t=bs,r=Ks,i=En,s=yl,o=Or,a=Aa,l=Uo,c=n.f;Li=null,bs=0,Ks=null,En=(c&(Ml|Lu))===0?n:null,yl=null,vh(n.ctx),Aa=!1,Uo=++Dp,n.ac!==null&&(ef(()=>{n.ac.abort(Id)}),n.ac=null);try{n.f|=D_;var d=n.fn,h=d(),f=n.deps;if(Li!==null){var p;if(py(n,bs),f!==null&&bs>0)for(f.length=bs+Li.length,p=0;p<Li.length;p++)f[bs+p]=Li[p];else n.deps=f=Li;if(rc&&Rp()&&(n.f&Vo)!==0)for(p=bs;p<f.length;p++)(f[p].reactions??=[]).push(n)}else f!==null&&bs<f.length&&(py(n,bs),f.length=bs);if(Jh()&&Ks!==null&&!Aa&&f!==null&&(n.f&(fi|Rl|us))===0)for(p=0;p<Ks.length;p++)d3(Ks[p],n);return i!==null&&i!==n&&(Dp++,Ks!==null&&(r===null?r=Ks:r.push(...Ks))),(n.f&tc)!==0&&(n.f^=tc),h}catch(g){return FD(g)}finally{n.f^=D_,Li=e,bs=t,Ks=r,En=i,yl=s,vh(o),Aa=a,Uo=l}}function P9(n,e){let t=e.reactions;if(t!==null){var r=xj.call(t,n);if(r!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[r]=t[i],t.pop())}}t===null&&(e.f&fi)!==0&&(Li===null||!Li.includes(e))&&(xi(e,Rl),(e.f&Vo)!==0&&(e.f^=Vo,e.f&=~yu),jD(e),py(e,0))}function py(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)P9(n,t[r])}function Np(n){var e=n.f;if((e&ml)===0){xi(n,Oi);var t=Rn,r=rc;Rn=n,rc=!0;try{(e&(ja|Cj))!==0?C9(n):n3(n),t3(n);var i=h3(n);n.teardown=typeof i=="function"?i:null,n.wv=c3;var s;M_&&n9&&(n.f&us)!==0&&n.deps}finally{rc=r,Rn=t}}}async function fl(){await Promise.resolve(),o9()}function u(n){var e=n.f,t=(e&fi)!==0;if(En!==null&&!Aa){var r=Rn!==null&&(Rn.f&ml)!==0;if(!r&&!yl?.includes(n)){var i=En.deps;if((En.f&D_)!==0)n.rv<Dp&&(n.rv=Dp,Li===null&&i!==null&&i[bs]===n?bs++:Li===null?Li=[n]:Li.includes(n)||Li.push(n));else{(En.deps??=[]).push(n);var s=n.reactions;s===null?n.reactions=[En]:s.includes(En)||s.push(En)}}}if(Qu){if(nc.has(n))return nc.get(n);if(t){var o=n,a=o.v;return((o.f&Oi)===0&&o.reactions!==null||p3(o))&&(a=Rk(o)),nc.set(o,a),a}}else t&&(!oo?.has(n)||Pn?.is_fork&&!Rp())&&(o=n,Fg(o)&&VD(o),rc&&Rp()&&(o.f&Vo)===0&&f3(o));if(oo?.has(n))return oo.get(n);if((n.f&tc)!==0)throw n.v;return n.v}function f3(n){if(n.deps!==null){n.f^=Vo;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&fi)!==0&&(e.f&Vo)===0&&f3(e)}}function p3(n){if(n.v===yi)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(nc.has(e)||(e.f&fi)!==0&&p3(e))return!0;return!1}function as(n){var e=Aa;try{return Aa=!0,n()}finally{Aa=e}}const I9=-7169;function xi(n,e){n.f=n.f&I9|e}function g3(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(vl in n)Q_(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&vl in t&&Q_(t)}}}function Q_(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{Q_(n[r],e)}catch{}const t=H0(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=AD(t);for(let i in r){const s=r[i].get;if(s)try{s.call(n)}catch{}}}}}const M9=["touchstart","touchmove"];function R9(n){return M9.includes(n)}const m3=new Set,$_=new Set;function D9(n,e,t,r={}){function i(s){if(r.capture||Gf.call(e,s),!s.cancelBubble)return ef(()=>t?.call(this,s))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?kl(()=>{e.addEventListener(n,i,r)}):e.addEventListener(n,i,r),i}function It(n,e,t,r,i){var s={capture:r,passive:i},o=D9(n,e,t,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&G0(()=>{e.removeEventListener(n,o,s)})}function yt(n){for(var e=0;e<n.length;e++)m3.add(n[e]);for(var t of $_)t(n)}let oA=null;function Gf(n){var e=this,t=e.ownerDocument,r=n.type,i=n.composedPath?.()||[],s=i[0]||n.target;oA=n;var o=0,a=oA===n&&n.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(e===document||e===window)){n.__root=e;return}var c=i.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=i[o]||n.target,s!==e){kj(n,"currentTarget",{configurable:!0,get(){return s||t}});var d=En,h=Rn;rs(null),Qa(null);try{for(var f,p=[];s!==null;){var g=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+r];m!=null&&(!s.disabled||n.target===s)&&m.call(s,n)}catch(v){f?p.push(v):f=v}if(n.cancelBubble||g===e||g===null)break;s=g}if(f){for(let v of p)queueMicrotask(()=>{throw v});throw f}}finally{n.__root=e,delete n.currentTarget,rs(d),Qa(h)}}}function Qk(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function wh(n,e){var t=Rn;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function P(n,e){var t=(e&Gj)!==0,r=(e&Kj)!==0,i,s=!n.startsWith("<!>");return()=>{i===void 0&&(i=Qk(s?n:"<!>"+n),t||(i=Ta(i)));var o=r||WD?document.importNode(i,!0):i.cloneNode(!0);if(t){var a=Ta(o),l=o.lastChild;wh(a,l)}else wh(o,o);return o}}function N9(n,e,t="svg"){var r=!n.startsWith("<!>"),i=`<${t}>${r?n:"<!>"+n}</${t}>`,s;return()=>{if(!s){var o=Qk(i),a=Ta(o);s=Ta(a)}var l=s.cloneNode(!0);return wh(l,l),l}}function kn(n,e){return N9(n,e,"svg")}function Tr(n=""){{var e=La(n+"");return wh(e,e),e}}function Ve(){var n=document.createDocumentFragment(),e=document.createComment(""),t=La();return n.append(e,t),wh(e,t),n}function T(n,e){n!==null&&n.before(e)}let F_=!0;function J(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function v3(n,e){return L9(n,e)}const ud=new Map;function L9(n,{target:e,anchor:t,props:r={},events:i,context:s,intro:o=!0}){O9();var a=new Set,l=h=>{for(var f=0;f<h.length;f++){var p=h[f];if(!a.has(p)){a.add(p);var g=R9(p);e.addEventListener(p,Gf,{passive:g});var m=ud.get(p);m===void 0?(document.addEventListener(p,Gf,{passive:g}),ud.set(p,1)):ud.set(p,m+1)}}};l(Ck(m3)),$_.add(l);var c=void 0,d=T9(()=>{var h=t??e.appendChild(La());return u9(h,{pending:()=>{}},f=>{if(s){lt({});var p=Or;p.c=s}i&&(r.$$events=i),F_=o,c=n(f,r)||{},F_=!0,s&&ct()}),()=>{for(var f of a){e.removeEventListener(f,Gf);var p=ud.get(f);--p===0?(document.removeEventListener(f,Gf),ud.delete(f)):ud.set(f,p)}$_.delete(l),h!==t&&h.parentNode?.removeChild(h)}});return z_.set(c,d),c}let z_=new WeakMap;function Q9(n,e){const t=z_.get(n);return t?(z_.delete(n),t(e)):Promise.resolve()}class $k{anchor;#e=new Map;#t=new Map;#r=new Map;#n=new Set;#s=!0;constructor(e,t=!0){this.anchor=e,this.#s=t}#i=()=>{var e=Pn;if(this.#e.has(e)){var t=this.#e.get(e),r=this.#t.get(t);if(r)Lk(r),this.#n.delete(t);else{var i=this.#r.get(t);i&&(this.#t.set(t,i.effect),this.#r.delete(t),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),r=i.effect)}for(const[s,o]of this.#e){if(this.#e.delete(s),s===e)break;const a=this.#r.get(o);a&&(os(a.effect),this.#r.delete(o))}for(const[s,o]of this.#t){if(s===t||this.#n.has(s))continue;const a=()=>{if(Array.from(this.#e.values()).includes(s)){var c=document.createDocumentFragment();a3(o,c),c.append(La()),this.#r.set(s,{effect:o,fragment:c})}else os(o);this.#n.delete(s),this.#t.delete(s)};this.#s||!r?(this.#n.add(s),Kd(o,a,!1)):a()}}};#o=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[r,i]of this.#r)t.includes(r)||(os(i.effect),this.#r.delete(r))};ensure(e,t){var r=Pn,i=GD();if(t&&!this.#t.has(e)&&!this.#r.has(e))if(i){var s=document.createDocumentFragment(),o=La();s.append(o),this.#r.set(e,{effect:no(()=>t(o)),fragment:s})}else this.#t.set(e,no(()=>t(this.anchor)));if(this.#e.set(r,e),i){for(const[a,l]of this.#t)a===e?r.skipped_effects.delete(l):r.skipped_effects.add(l);for(const[a,l]of this.#r)a===e?r.skipped_effects.delete(l.effect):r.skipped_effects.add(l.effect);r.oncommit(this.#i),r.ondiscard(this.#o)}else this.#i()}}function z(n,e,t=!1){var r=new $k(n),i=t?dc:0;function s(o,a){r.ensure(o,a)}tf(()=>{var o=!1;e((a,l=!0)=>{o=!0,s(l,a)}),o||s(!1,null)},i)}function $9(n,e,t){var r=new $k(n),i=!Jh();tf(()=>{var s=e();i&&s!==null&&typeof s=="object"&&(s={}),r.ensure(s,t)})}function Fk(n,e,t=!1,r=!1,i=!1){var s=n,o="";Y(()=>{var a=Rn;if(o!==(o=e()??"")&&(a.nodes_start!==null&&(r3(a.nodes_start,a.nodes_end),a.nodes_start=a.nodes_end=null),o!=="")){var l=o+"";t?l=`<svg>${l}</svg>`:r&&(l=`<math>${l}</math>`);var c=Qk(l);if((t||r)&&(c=Ta(c)),wh(Ta(c),c.lastChild),t||r)for(;Ta(c);)s.before(Ta(c));else s.before(c)}})}function ic(n,e,...t){var r=new $k(n);tf(()=>{const i=e()??null;r.ensure(i,i&&(s=>i(s,...t)))},dc)}function F9(n,e){var t;t=document.head.appendChild(La());try{tf(()=>e(t),Pk)}finally{}}function Hc(n,e,t){K0(()=>{var r=as(()=>e(n,t?.())||{});if(t&&r?.update){var i=!1,s={};$g(()=>{var o=t();g3(o),i&&LD(s,o)&&(s=o,r.update(o))}),i=!0}if(r?.destroy)return()=>r.destroy()})}const aA=[...` 	
\r\fÂ \v\uFEFF`];function z9(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var i in t)if(t[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,o=0;(o=r.indexOf(i,o))>=0;){var a=o+s;(o===0||aA.includes(r[o-1]))&&(a===r.length||aA.includes(r[a]))?r=(o===0?"":r.substring(0,o))+r.substring(a+1):o=a}}return r===""?null:r}function lA(n,e=!1){var t=e?" !important;":";",r="";for(var i in n){var s=n[i];s!=null&&s!==""&&(r+=" "+i+": "+s+t)}return r}function rw(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function B9(n,e){if(e){var t="",r,i;if(Array.isArray(e)?(r=e[0],i=e[1]):r=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,o=0,a=!1,l=[];r&&l.push(...Object.keys(r).map(rw)),i&&l.push(...Object.keys(i).map(rw));var c=0,d=-1;const m=n.length;for(var h=0;h<m;h++){var f=n[h];if(a?f==="/"&&n[h-1]==="*"&&(a=!1):s?s===f&&(s=!1):f==="/"&&n[h+1]==="*"?a=!0:f==='"'||f==="'"?s=f:f==="("?o++:f===")"&&o--,!a&&s===!1&&o===0){if(f===":"&&d===-1)d=h;else if(f===";"||h===m-1){if(d!==-1){var p=rw(n.substring(c,d).trim());if(!l.includes(p)){f!==";"&&h++;var g=n.substring(c,h).trim();t+=" "+g+";"}}c=h+1,d=-1}}}}return r&&(t+=lA(r)),i&&(t+=lA(i,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function Ue(n,e,t,r,i,s){var o=n.__className;if(o!==t||o===void 0){var a=z9(t,r,s);a==null?n.removeAttribute("class"):e?n.className=a:n.setAttribute("class",a),n.__className=t}else if(s&&i!==s)for(var l in s){var c=!!s[l];(i==null||c!==!!i[l])&&n.classList.toggle(l,c)}return s}function iw(n,e={},t,r){for(var i in t){var s=t[i];e[i]!==s&&(t[i]==null?n.style.removeProperty(i):n.style.setProperty(i,s,r))}}function gn(n,e,t,r){var i=n.__style;if(i!==e){var s=B9(e,r);s==null?n.removeAttribute("style"):n.style.cssText=s,n.__style=e}else r&&(Array.isArray(r)?(iw(n,t?.[0],r[0]),iw(n,t?.[1],r[1],"important")):iw(n,t,r));return r}function go(n,e,t=!1){if(n.multiple){if(e==null)return;if(!q0(e))return e9();for(var r of n.options)r.selected=e.includes(fp(r));return}for(r of n.options){var i=fp(r);if(ZD(i,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function jo(n){var e=new MutationObserver(()=>{go(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),G0(()=>{e.disconnect()})}function Zc(n,e,t=e){var r=new WeakSet,i=!0;Dk(n,"change",s=>{var o=s?"[selected]":":checked",a;if(n.multiple)a=[].map.call(n.querySelectorAll(o),fp);else{var l=n.querySelector(o)??n.querySelector("option:not([disabled])");a=l&&fp(l)}t(a),Pn!==null&&r.add(Pn)}),K0(()=>{var s=e();if(n===document.activeElement){var o=dp??Pn;if(r.has(o))return}if(go(n,s,i),i&&s===void 0){var a=n.querySelector(":checked");a!==null&&(s=fp(a),t(s))}n.__value=s,i=!1}),jo(n)}function fp(n){return"__value"in n?n.__value:n.value}const U9=Symbol("is custom element"),j9=Symbol("is html");function Tn(n,e){var t=zk(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function zo(n,e){var t=zk(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function Pt(n,e,t,r){var i=zk(n);i[e]!==(i[e]=t)&&(e==="loading"&&(n[Pj]=t),t==null?n.removeAttribute(e):typeof t!="string"&&V9(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function zk(n){return n.__attributes??={[U9]:n.nodeName.includes("-"),[j9]:n.namespaceURI===Jj}}var cA=new Map;function V9(n){var e=n.getAttribute("is")||n.nodeName,t=cA.get(e);if(t)return t;cA.set(e,t=[]);for(var r,i=n,s=Element.prototype;s!==i;){r=AD(i);for(var o in r)r[o].set&&t.push(o);i=H0(i)}return t}const q9=()=>performance.now(),cl={tick:n=>requestAnimationFrame(n),now:()=>q9(),tasks:new Set};function y3(){const n=cl.now();cl.tasks.forEach(e=>{e.c(n)||(cl.tasks.delete(e),e.f())}),cl.tasks.size!==0&&cl.tick(y3)}function H9(n){let e;return cl.tasks.size===0&&cl.tick(y3),{promise:new Promise(t=>{cl.tasks.add(e={c:n,f:t})}),abort(){cl.tasks.delete(e)}}}function Cm(n,e){ef(()=>{n.dispatchEvent(new CustomEvent(e))})}function Z9(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const e=n.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function uA(n){const e={},t=n.split(";");for(const r of t){const[i,s]=r.split(":");if(!i||s===void 0)break;const o=Z9(i.trim());e[o]=s.trim()}return e}const W9=n=>n;function pp(n,e,t,r){var i=(n&Wj)!==0,s=(n&Xj)!==0,o=i&&s,a=(n&Yj)!==0,l=o?"both":i?"in":"out",c,d=e.inert,h=e.style.overflow,f,p;function g(){return ef(()=>c??=t()(e,r?.()??{},{direction:l}))}var m={is_global:a,in(){if(e.inert=d,!i){p?.abort(),p?.reset?.();return}s||f?.abort(),Cm(e,"introstart"),f=B_(e,g(),p,1,()=>{Cm(e,"introend"),f?.abort(),f=c=void 0,e.style.overflow=h})},out(_){if(!s){_?.(),c=void 0;return}e.inert=!0,Cm(e,"outrostart"),p=B_(e,g(),f,0,()=>{Cm(e,"outroend"),_?.()})},stop:()=>{f?.abort(),p?.abort()}},v=Rn;if((v.transitions??=[]).push(m),i&&F_){var y=a;if(!y){for(var O=v.parent;O&&(O.f&dc)!==0;)for(;(O=O.parent)&&(O.f&ja)===0;);y=!O||(O.f&X0)!==0}y&&K0(()=>{as(()=>m.in())})}}function B_(n,e,t,r,i){var s=r===1;if(Tj(e)){var o,a=!1;return kl(()=>{if(!a){var v=e({direction:s?"in":"out"});o=B_(n,v,t,r,i)}}),{abort:()=>{a=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(t?.deactivate(),!e?.duration)return i(),{abort:Zl,deactivate:Zl,reset:Zl,t:()=>r};const{delay:l=0,css:c,tick:d,easing:h=W9}=e;var f=[];if(s&&t===void 0&&(d&&d(0,1),c)){var p=uA(c(0,1));f.push(p,p)}var g=()=>1-r,m=n.animate(f,{duration:l,fill:"forwards"});return m.onfinish=()=>{m.cancel();var v=t?.t()??1-r;t?.abort();var y=r-v,O=e.duration*Math.abs(y),_=[];if(O>0){var x=!1;if(c)for(var k=Math.ceil(O/16.666666666666668),S=0;S<=k;S+=1){var E=v+y*h(S/k),R=uA(c(E,1-E));_.push(R),x||=R.overflow==="hidden"}x&&(n.style.overflow="hidden"),g=()=>{var C=m.currentTime;return v+y*h(C/O)},d&&H9(()=>{if(m.playState!=="running")return!1;var C=g();return d(C,1-C),!0})}m=n.animate(_,{duration:O,fill:"forwards"}),m.onfinish=()=>{g=()=>r,d?.(r,1-r),i()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=Zl)},deactivate:()=>{i=Zl},reset:()=>{r===0&&d?.(1,0)},t:()=>g()}}function Un(n,e,t=e){var r=new WeakSet;Dk(n,"input",async i=>{var s=i?n.defaultValue:n.value;if(s=aw(n)?lw(s):s,t(s),Pn!==null&&r.add(Pn),await fl(),s!==(s=e())){var o=n.selectionStart,a=n.selectionEnd,l=n.value.length;if(n.value=s??"",a!==null){var c=n.value.length;o===a&&a===l&&c>l?(n.selectionStart=c,n.selectionEnd=c):(n.selectionStart=o,n.selectionEnd=Math.min(a,c))}}}),as(e)==null&&n.value&&(t(aw(n)?lw(n.value):n.value),Pn!==null&&r.add(Pn)),$g(()=>{var i=e();if(n===document.activeElement){var s=dp??Pn;if(r.has(s))return}aw(n)&&i===lw(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}const sw=new Set;function ow(n,e,t,r,i=r){var s=t.getAttribute("type")==="checkbox",o=n;if(e!==null)for(var a of e)o=o[a]??=[];o.push(t),Dk(t,"change",()=>{var l=t.__value;s&&(l=X9(o,l,t.checked)),i(l)},()=>i(s?[]:null)),$g(()=>{var l=r();s?(l=l||[],t.checked=l.includes(t.__value)):t.checked=ZD(t.__value,l)}),G0(()=>{var l=o.indexOf(t);l!==-1&&o.splice(l,1)}),sw.has(o)||(sw.add(o),kl(()=>{o.sort((l,c)=>l.compareDocumentPosition(c)===4?-1:1),sw.delete(o)})),kl(()=>{})}function X9(n,e,t){for(var r=new Set,i=0;i<n.length;i+=1)n[i].checked&&r.add(n[i].__value);return t||r.delete(e),Array.from(r)}function aw(n){var e=n.type;return e==="number"||e==="range"}function lw(n){return n===""?null:+n}function dA(n,e){return n===e||n?.[vl]===e}function qt(n={},e,t,r){return K0(()=>{var i,s;return $g(()=>{i=s,s=r?.()||[],as(()=>{n!==t(...s)&&(e(n,...s),i&&dA(t(...i),n)&&e(null,...i))})}),()=>{kl(()=>{s&&dA(t(...s),n)&&e(null,...s)})}}),n}function b3(n=!1){const e=Or,t=e.l.u;if(!t)return;let r=()=>g3(e.s);if(n){let i=0,s={};const o=Lg(()=>{let a=!1;const l=e.s;for(const c in l)l[c]!==s[c]&&(s[c]=l[c],a=!0);return a&&i++,i});r=()=>u(o)}t.b.length&&e3(()=>{hA(e,r),R_(t.b)}),tt(()=>{const i=as(()=>t.m.map(Aj));return()=>{for(const s of i)typeof s=="function"&&s()}}),t.a.length&&tt(()=>{hA(e,r),R_(t.a)})}function hA(n,e){if(n.l.s)for(const t of n.l.s)u(t);e()}let Em=!1;function Y9(n){var e=Em;try{return Em=!1,[n(),Em]}finally{Em=e}}function et(n,e,t,r){var i=!Kh||(t&Vj)!==0,s=(t&Hj)!==0,o=(t&Zj)!==0,a=r,l=!0,c=()=>(l&&(l=!1,a=o?as(r):r),a),d;if(s){var h=vl in n||Ej in n;d=Gd(n,e)?.set??(h&&e in n?_=>n[e]=_:void 0)}var f,p=!1;s?[f,p]=Y9(()=>n[e]):f=n[e],f===void 0&&r!==void 0&&(f=c(),d&&(i&&Lj(),d(f)));var g;if(i?g=()=>{var _=n[e];return _===void 0?c():(l=!0,_)}:g=()=>{var _=n[e];return _!==void 0&&(a=void 0),_===void 0?a:_},i&&(t&qj)===0)return g;if(d){var m=n.$$legacy;return(function(_,x){return arguments.length>0?((!i||!x||m||p)&&d(x?g():_),_):g()})}var v=!1,y=((t&jj)!==0?Lg:Mk)(()=>(v=!1,g()));s&&u(y);var O=Rn;return(function(_,x){if(arguments.length>0){const k=x?u(y):i&&s?Qt(_):_;return b(y,k),v=!0,a!==void 0&&(a=k),_}return Qu&&v||(O.f&ml)!==0?y.v:u(y)})}function qr(n){Or===null&&ID(),Kh&&Or.l!==null?G9(Or).m.push(n):tt(()=>{const e=as(n);if(typeof e=="function")return e})}function Oo(n){Or===null&&ID(),qr(()=>()=>as(n))}function G9(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const K9="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(K9);const J9="modulepreload",eV=function(n){return"/app/"+n},fA={},_h=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let o=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=o(t.map(c=>{if(c=eV(c),c in fA)return;fA[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":J9,d||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((p,g)=>{f.addEventListener("load",p),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};let ba,tV=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});tV.decode();const cw=new TextEncoder;"encodeInto"in cw||(cw.encodeInto=function(n,e){const t=cw.encode(n);return e.set(t),{read:n.length,written:t.length}});function pA(n){const e=ba.__wbindgen_export_4.get(n);return ba.__externref_table_dealloc(n),e}typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>ba.__wbg_automerge_free(n>>>0,1));const gA=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>ba.__wbg_syncstate_free(n>>>0,1));let mA=class U_{static __wrap(e){e=e>>>0;const t=Object.create(U_.prototype);return t.__wbg_ptr=e,gA.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gA.unregister(this),e}free(){const e=this.__destroy_into_raw();ba.__wbg_syncstate_free(e,0)}get sharedHeads(){return ba.syncstate_sharedHeads(this.__wbg_ptr)}get lastSentHeads(){return ba.syncstate_lastSentHeads(this.__wbg_ptr)}set lastSentHeads(e){const t=ba.syncstate_set_lastSentHeads(this.__wbg_ptr,e);if(t[1])throw pA(t[0])}set sentHashes(e){const t=ba.syncstate_set_sentHashes(this.__wbg_ptr,e);if(t[1])throw pA(t[0])}clone(){const e=ba.syncstate_clone(this.__wbg_ptr);return U_.__wrap(e)}};Symbol.dispose&&(mA.prototype[Symbol.dispose]=mA.prototype.free);let nV=[];function rV(n){for(const e in n)ds[e]=n[e];for(const e of nV)e()}const ds={create(n){throw new RangeError("Automerge.use() not called")},load(n,e){throw new RangeError("Automerge.use() not called (load)")},encodeChange(n){throw new RangeError("Automerge.use() not called (encodeChange)")},decodeChange(n){throw new RangeError("Automerge.use() not called (decodeChange)")},initSyncState(){throw new RangeError("Automerge.use() not called (initSyncState)")},encodeSyncMessage(n){throw new RangeError("Automerge.use() not called (encodeSyncMessage)")},decodeSyncMessage(n){throw new RangeError("Automerge.use() not called (decodeSyncMessage)")},encodeSyncState(n){throw new RangeError("Automerge.use() not called (encodeSyncState)")},decodeSyncState(n){throw new RangeError("Automerge.use() not called (decodeSyncState)")},exportSyncState(n){throw new RangeError("Automerge.use() not called (exportSyncState)")},importSyncState(n){throw new RangeError("Automerge.use() not called (importSyncState)")},readBundle(n){throw new RangeError("Automerge.use() not called (readBundle)")}},iV="/app/assets/automerge_wasm_bg-U6EuUum1.wasm",sV=async(n={},e)=>{let t;if(e.startsWith("data:")){const r=e.replace(/^data:.*?base64,/,"");let i;if(typeof Buffer=="function"&&typeof Buffer.from=="function")i=Buffer.from(r,"base64");else if(typeof atob=="function"){const s=atob(r);i=new Uint8Array(s.length);for(let o=0;o<s.length;o++)i[o]=s.charCodeAt(o)}else throw new Error("Cannot decode base64-encoded data URL");t=await WebAssembly.instantiate(i,n)}else{const r=await fetch(e),i=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&i.startsWith("application/wasm"))t=await WebAssembly.instantiateStreaming(r,n);else{const s=await r.arrayBuffer();t=await WebAssembly.instantiate(s,n)}}return t.instance.exports};let qe;function w3(n){qe=n}let Pm=null;function gp(){return(Pm===null||Pm.byteLength===0)&&(Pm=new Uint8Array(qe.memory.buffer)),Pm}let Dv=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Dv.decode();const oV=2146435072;let uw=0;function aV(n,e){return uw+=e,uw>=oV&&(Dv=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),Dv.decode(),uw=e),Dv.decode(gp().subarray(n,n+e))}function ao(n,e){return n=n>>>0,aV(n,e)}let Ps=0;const mp=new TextEncoder;"encodeInto"in mp||(mp.encodeInto=function(n,e){const t=mp.encode(n);return e.set(t),{read:n.length,written:t.length}});function Fo(n,e,t){if(t===void 0){const a=mp.encode(n),l=e(a.length,1)>>>0;return gp().subarray(l,l+a.length).set(a),Ps=a.length,l}let r=n.length,i=e(r,1)>>>0;const s=gp();let o=0;for(;o<r;o++){const a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3,1)>>>0;const a=gp().subarray(i+o,i+r),l=mp.encodeInto(n,a);o+=l.written,i=t(i,r,o,1)>>>0}return Ps=o,i}let dd=null;function hs(){return(dd===null||dd.buffer.detached===!0||dd.buffer.detached===void 0&&dd.buffer!==qe.memory.buffer)&&(dd=new DataView(qe.memory.buffer)),dd}function lV(n){const e=qe.__externref_table_alloc();return qe.__wbindgen_export_4.set(e,n),e}function qa(n,e){try{return n.apply(this,e)}catch(t){const r=lV(t);qe.__wbindgen_exn_store(r)}}function Bk(n,e){return n=n>>>0,gp().subarray(n/1,n/1+e)}function Ji(n){return n==null}function j_(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let s="[";i>0&&(s+=j_(n[0]));for(let o=1;o<i;o++)s+=", "+j_(n[o]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function ut(n){const e=qe.__wbindgen_export_4.get(n);return qe.__externref_table_dealloc(n),e}function Wc(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`)}function cV(n){const e=qe.create(n);if(e[2])throw ut(e[1]);return ro.__wrap(e[0])}function uV(n,e){const t=qe.load(n,e);if(t[2])throw ut(t[1]);return ro.__wrap(t[0])}function dV(n){const e=qe.encodeChange(n);if(e[2])throw ut(e[1]);return ut(e[0])}function hV(n){const e=qe.decodeChange(n);if(e[2])throw ut(e[1]);return ut(e[0])}function fV(){const n=qe.initSyncState();return ls.__wrap(n)}function pV(n){const e=qe.importSyncState(n);if(e[2])throw ut(e[1]);return ls.__wrap(e[0])}function gV(n){return Wc(n,ls),qe.exportSyncState(n.__wbg_ptr)}function mV(n){const e=qe.encodeSyncMessage(n);if(e[2])throw ut(e[1]);return ut(e[0])}function vV(n){const e=qe.decodeSyncMessage(n);if(e[2])throw ut(e[1]);return ut(e[0])}function yV(n){return Wc(n,ls),qe.encodeSyncState(n.__wbg_ptr)}function bV(n){const e=qe.decodeSyncState(n);if(e[2])throw ut(e[1]);return ls.__wrap(e[0])}function wV(n){const e=qe.readBundle(n);if(e[2])throw ut(e[1]);return ut(e[0])}const vA=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>qe.__wbg_automerge_free(n>>>0,1));class ro{static __wrap(e){e=e>>>0;const t=Object.create(ro.prototype);return t.__wbg_ptr=e,vA.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vA.unregister(this),e}free(){const e=this.__destroy_into_raw();qe.__wbg_automerge_free(e,0)}static new(e){var t=Ji(e)?0:Fo(e,qe.__wbindgen_malloc,qe.__wbindgen_realloc),r=Ps;const i=qe.automerge_new(t,r);if(i[2])throw ut(i[1]);return ro.__wrap(i[0])}clone(e){var t=Ji(e)?0:Fo(e,qe.__wbindgen_malloc,qe.__wbindgen_realloc),r=Ps;const i=qe.automerge_clone(this.__wbg_ptr,t,r);if(i[2])throw ut(i[1]);return ro.__wrap(i[0])}fork(e,t){var r=Ji(e)?0:Fo(e,qe.__wbindgen_malloc,qe.__wbindgen_realloc),i=Ps;const s=qe.automerge_fork(this.__wbg_ptr,r,i,t);if(s[2])throw ut(s[1]);return ro.__wrap(s[0])}pendingOps(){return qe.automerge_pendingOps(this.__wbg_ptr)}commit(e,t){var r=Ji(e)?0:Fo(e,qe.__wbindgen_malloc,qe.__wbindgen_realloc),i=Ps;return qe.automerge_commit(this.__wbg_ptr,r,i,!Ji(t),Ji(t)?0:t)}merge(e){Wc(e,ro);const t=qe.automerge_merge(this.__wbg_ptr,e.__wbg_ptr);if(t[2])throw ut(t[1]);return ut(t[0])}rollback(){return qe.automerge_rollback(this.__wbg_ptr)}keys(e,t){const r=qe.automerge_keys(this.__wbg_ptr,e,t);if(r[2])throw ut(r[1]);return ut(r[0])}text(e,t){let r,i;try{const a=qe.automerge_text(this.__wbg_ptr,e,t);var s=a[0],o=a[1];if(a[3])throw s=0,o=0,ut(a[2]);return r=s,i=o,ao(s,o)}finally{qe.__wbindgen_free(r,i,1)}}spans(e,t){const r=qe.automerge_spans(this.__wbg_ptr,e,t);if(r[2])throw ut(r[1]);return ut(r[0])}splice(e,t,r,i){const s=qe.automerge_splice(this.__wbg_ptr,e,t,r,i);if(s[1])throw ut(s[0])}updateText(e,t){const r=qe.automerge_updateText(this.__wbg_ptr,e,t);if(r[1])throw ut(r[0])}updateSpans(e,t,r){const i=qe.automerge_updateSpans(this.__wbg_ptr,e,t,r);if(i[1])throw ut(i[0])}push(e,t,r){const i=qe.automerge_push(this.__wbg_ptr,e,t,r);if(i[1])throw ut(i[0])}pushObject(e,t){let r,i;try{const a=qe.automerge_pushObject(this.__wbg_ptr,e,t);var s=a[0],o=a[1];if(a[3])throw s=0,o=0,ut(a[2]);return r=s,i=o,ao(s,o)}finally{qe.__wbindgen_free(r,i,1)}}insert(e,t,r,i){const s=qe.automerge_insert(this.__wbg_ptr,e,t,r,i);if(s[1])throw ut(s[0])}splitBlock(e,t,r){const i=qe.automerge_splitBlock(this.__wbg_ptr,e,t,r);if(i[1])throw ut(i[0])}joinBlock(e,t){const r=qe.automerge_joinBlock(this.__wbg_ptr,e,t);if(r[1])throw ut(r[0])}updateBlock(e,t,r){const i=qe.automerge_updateBlock(this.__wbg_ptr,e,t,r);if(i[1])throw ut(i[0])}getBlock(e,t,r){const i=qe.automerge_getBlock(this.__wbg_ptr,e,t,r);if(i[2])throw ut(i[1]);return ut(i[0])}insertObject(e,t,r){let i,s;try{const l=qe.automerge_insertObject(this.__wbg_ptr,e,t,r);var o=l[0],a=l[1];if(l[3])throw o=0,a=0,ut(l[2]);return i=o,s=a,ao(o,a)}finally{qe.__wbindgen_free(i,s,1)}}put(e,t,r,i){const s=qe.automerge_put(this.__wbg_ptr,e,t,r,i);if(s[1])throw ut(s[0])}putObject(e,t,r){const i=qe.automerge_putObject(this.__wbg_ptr,e,t,r);if(i[2])throw ut(i[1]);return ut(i[0])}increment(e,t,r){const i=qe.automerge_increment(this.__wbg_ptr,e,t,r);if(i[1])throw ut(i[0])}get(e,t,r){const i=qe.automerge_get(this.__wbg_ptr,e,t,r);if(i[2])throw ut(i[1]);return ut(i[0])}getWithType(e,t,r){const i=qe.automerge_getWithType(this.__wbg_ptr,e,t,r);if(i[2])throw ut(i[1]);return ut(i[0])}objInfo(e,t){const r=qe.automerge_objInfo(this.__wbg_ptr,e,t);if(r[2])throw ut(r[1]);return ut(r[0])}getAll(e,t,r){const i=qe.automerge_getAll(this.__wbg_ptr,e,t,r);if(i[2])throw ut(i[1]);return ut(i[0])}enableFreeze(e){const t=qe.automerge_enableFreeze(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return t[0]!==0}registerDatatype(e,t,r){const i=qe.automerge_registerDatatype(this.__wbg_ptr,e,t,r);if(i[1])throw ut(i[0])}applyPatches(e,t){const r=qe.automerge_applyPatches(this.__wbg_ptr,e,t);if(r[2])throw ut(r[1]);return ut(r[0])}applyAndReturnPatches(e,t){const r=qe.automerge_applyAndReturnPatches(this.__wbg_ptr,e,t);if(r[2])throw ut(r[1]);return ut(r[0])}diffIncremental(){const e=qe.automerge_diffIncremental(this.__wbg_ptr);if(e[2])throw ut(e[1]);return ut(e[0])}updateDiffCursor(){qe.automerge_updateDiffCursor(this.__wbg_ptr)}resetDiffCursor(){qe.automerge_resetDiffCursor(this.__wbg_ptr)}diff(e,t){const r=qe.automerge_diff(this.__wbg_ptr,e,t);if(r[2])throw ut(r[1]);return ut(r[0])}isolate(e){const t=qe.automerge_isolate(this.__wbg_ptr,e);if(t[1])throw ut(t[0])}integrate(){qe.automerge_integrate(this.__wbg_ptr)}length(e,t){const r=qe.automerge_length(this.__wbg_ptr,e,t);if(r[2])throw ut(r[1]);return r[0]}delete(e,t){const r=qe.automerge_delete(this.__wbg_ptr,e,t);if(r[1])throw ut(r[0])}save(){return qe.automerge_save(this.__wbg_ptr)}saveIncremental(){return qe.automerge_saveIncremental(this.__wbg_ptr)}saveSince(e){const t=qe.automerge_saveSince(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}saveNoCompress(){return qe.automerge_saveNoCompress(this.__wbg_ptr)}saveAndVerify(){const e=qe.automerge_saveAndVerify(this.__wbg_ptr);if(e[2])throw ut(e[1]);return ut(e[0])}loadIncremental(e){const t=qe.automerge_loadIncremental(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return t[0]}applyChanges(e){const t=qe.automerge_applyChanges(this.__wbg_ptr,e);if(t[1])throw ut(t[0])}getChanges(e){const t=qe.automerge_getChanges(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}getChangesMeta(e){const t=qe.automerge_getChangesMeta(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}getChangeByHash(e){const t=qe.automerge_getChangeByHash(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}getChangeMetaByHash(e){const t=qe.automerge_getChangeMetaByHash(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}getDecodedChangeByHash(e){const t=qe.automerge_getDecodedChangeByHash(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}getChangesAdded(e){return Wc(e,ro),qe.automerge_getChangesAdded(this.__wbg_ptr,e.__wbg_ptr)}getHeads(){return qe.automerge_getHeads(this.__wbg_ptr)}getActorId(){let e,t;try{const r=qe.automerge_getActorId(this.__wbg_ptr);return e=r[0],t=r[1],ao(r[0],r[1])}finally{qe.__wbindgen_free(e,t,1)}}getLastLocalChange(){return qe.automerge_getLastLocalChange(this.__wbg_ptr)}dump(){qe.automerge_dump(this.__wbg_ptr)}getMissingDeps(e){const t=qe.automerge_getMissingDeps(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}receiveSyncMessage(e,t){Wc(e,ls);const r=qe.automerge_receiveSyncMessage(this.__wbg_ptr,e.__wbg_ptr,t);if(r[1])throw ut(r[0])}generateSyncMessage(e){return Wc(e,ls),qe.automerge_generateSyncMessage(this.__wbg_ptr,e.__wbg_ptr)}toJS(e){const t=qe.automerge_toJS(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}materialize(e,t,r){const i=qe.automerge_materialize(this.__wbg_ptr,e,t,r);if(i[2])throw ut(i[1]);return ut(i[0])}getCursor(e,t,r,i){let s,o;try{const c=qe.automerge_getCursor(this.__wbg_ptr,e,t,r,i);var a=c[0],l=c[1];if(c[3])throw a=0,l=0,ut(c[2]);return s=a,o=l,ao(a,l)}finally{qe.__wbindgen_free(s,o,1)}}getCursorPosition(e,t,r){const i=qe.automerge_getCursorPosition(this.__wbg_ptr,e,t,r);if(i[2])throw ut(i[1]);return i[0]}emptyChange(e,t){var r=Ji(e)?0:Fo(e,qe.__wbindgen_malloc,qe.__wbindgen_realloc),i=Ps;return qe.automerge_emptyChange(this.__wbg_ptr,r,i,!Ji(t),Ji(t)?0:t)}mark(e,t,r,i,s){const o=qe.automerge_mark(this.__wbg_ptr,e,t,r,i,s);if(o[1])throw ut(o[0])}unmark(e,t,r){const i=qe.automerge_unmark(this.__wbg_ptr,e,t,r);if(i[1])throw ut(i[0])}marks(e,t){const r=qe.automerge_marks(this.__wbg_ptr,e,t);if(r[2])throw ut(r[1]);return ut(r[0])}marksAt(e,t,r){const i=qe.automerge_marksAt(this.__wbg_ptr,e,t,r);if(i[2])throw ut(i[1]);return ut(i[0])}hasOurChanges(e){return Wc(e,ls),qe.automerge_hasOurChanges(this.__wbg_ptr,e.__wbg_ptr)!==0}topoHistoryTraversal(){return qe.automerge_topoHistoryTraversal(this.__wbg_ptr)}stats(){return qe.automerge_stats(this.__wbg_ptr)}saveBundle(e){const t=qe.automerge_saveBundle(this.__wbg_ptr,e);if(t[2])throw ut(t[1]);return ut(t[0])}}Symbol.dispose&&(ro.prototype[Symbol.dispose]=ro.prototype.free);const yA=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>qe.__wbg_syncstate_free(n>>>0,1));class ls{static __wrap(e){e=e>>>0;const t=Object.create(ls.prototype);return t.__wbg_ptr=e,yA.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yA.unregister(this),e}free(){const e=this.__destroy_into_raw();qe.__wbg_syncstate_free(e,0)}get sharedHeads(){return qe.syncstate_sharedHeads(this.__wbg_ptr)}get lastSentHeads(){return qe.syncstate_lastSentHeads(this.__wbg_ptr)}set lastSentHeads(e){const t=qe.syncstate_set_lastSentHeads(this.__wbg_ptr,e);if(t[1])throw ut(t[0])}set sentHashes(e){const t=qe.syncstate_set_sentHashes(this.__wbg_ptr,e);if(t[1])throw ut(t[0])}clone(){const e=qe.syncstate_clone(this.__wbg_ptr);return ls.__wrap(e)}}Symbol.dispose&&(ls.prototype[Symbol.dispose]=ls.prototype.free);function _3(n){return BigInt(n)}function O3(n,e){return Error(ao(n,e))}function x3(n,e){const t=String(e),r=Fo(t,qe.__wbindgen_malloc,qe.__wbindgen_realloc),i=Ps;hs().setInt32(n+4,i,!0),hs().setInt32(n+0,r,!0)}function k3(){return qa(function(n,e,t){return Reflect.apply(n,e,t)},arguments)}function S3(n,e){return Object.assign(n,e)}function T3(){return qa(function(n,e){return n.call(e)},arguments)}function A3(){return qa(function(n,e,t){return n.call(e,t)},arguments)}function C3(n,e){return n.concat(e)}function E3(n,e,t){return Object.defineProperty(n,e,t)}function P3(){return qa(function(n,e){return Reflect.deleteProperty(n,e)},arguments)}function I3(n){return n.done}function M3(n){return Object.entries(n)}function R3(n,e){let t,r;try{t=n,r=e,console.error(ao(n,e))}finally{qe.__wbindgen_free(t,r,1)}}function D3(n,e){return Symbol.for(ao(n,e))}function N3(n){return Object.freeze(n)}function L3(n){return Array.from(n)}function Q3(){return qa(function(n,e){globalThis.crypto.getRandomValues(Bk(n,e))},arguments)}function $3(n){return n.getTime()}function F3(n,e){return n[e>>>0]}function z3(){return qa(function(n,e){return Reflect.get(n,e)},arguments)}function B3(n){let e;try{e=n instanceof ArrayBuffer}catch{e=!1}return e}function U3(n){let e;try{e=n instanceof Date}catch{e=!1}return e}function j3(n){let e;try{e=n instanceof Object}catch{e=!1}return e}function V3(n){let e;try{e=n instanceof Uint8Array}catch{e=!1}return e}function q3(n){return Array.isArray(n)}function H3(n){return Array.isArray(n)}function Z3(){return Symbol.iterator}function W3(n){return Object.keys(n)}function X3(n){return n.length}function Y3(n){return n.length}function G3(n){return n.length}function K3(n){console.log(n)}function J3(n,e){console.log(n,e)}function eN(){return new Object}function tN(){return new Array}function nN(n){return new Date(n)}function rN(n){return new Uint8Array(n)}function iN(){return new Error}function sN(n,e){return new Error(ao(n,e))}function oN(n,e){return new RangeError(ao(n,e))}function aN(n,e){return new Uint8Array(Bk(n,e))}function lN(n){return n.next}function cN(){return qa(function(n){return n.next()},arguments)}function uN(){return qa(function(n){return Reflect.ownKeys(n)},arguments)}function dN(n,e,t){Uint8Array.prototype.set.call(Bk(n,e),t)}function hN(n,e){return n.push(e)}function fN(n,e,t){n[e]=t}function pN(){return qa(function(n,e,t){return Reflect.set(n,e,t)},arguments)}function gN(n,e,t){n[e>>>0]=t}function mN(n,e,t){return n.slice(e>>>0,t>>>0)}function vN(n,e){const t=e.stack,r=Fo(t,qe.__wbindgen_malloc,qe.__wbindgen_realloc),i=Ps;hs().setInt32(n+4,i,!0),hs().setInt32(n+0,r,!0)}function yN(n,e){const t=JSON.stringify(e);var r=Ji(t)?0:Fo(t,qe.__wbindgen_malloc,qe.__wbindgen_realloc),i=Ps;hs().setInt32(n+4,i,!0),hs().setInt32(n+0,r,!0)}function bN(n,e,t){const r=e.toString(t),i=Fo(r,qe.__wbindgen_malloc,qe.__wbindgen_realloc),s=Ps;hs().setInt32(n+4,s,!0),hs().setInt32(n+0,i,!0)}function wN(){return qa(function(n,e){return n.toString(e)},arguments)}function _N(n){return n.toString()}function ON(n,e){return n.unshift(e)}function xN(n){return n.value}function kN(n){return Object.values(n)}function SN(n){const e=n,t=typeof e=="boolean"?e:void 0;return Ji(t)?16777215:t?1:0}function TN(n,e){const t=j_(e),r=Fo(t,qe.__wbindgen_malloc,qe.__wbindgen_realloc),i=Ps;hs().setInt32(n+4,i,!0),hs().setInt32(n+0,r,!0)}function AN(n,e){return n>e}function CN(n){return typeof n=="bigint"}function EN(n){return typeof n=="function"}function PN(n){return n===null}function IN(n){const e=n;return typeof e=="object"&&e!==null}function MN(n){return typeof n=="string"}function RN(n){return n===void 0}function DN(n,e){return n==e}function NN(n,e){return n<e}function LN(n){return-n}function QN(n,e){const t=e,r=typeof t=="number"?t:void 0;hs().setFloat64(n+8,Ji(r)?0:r,!0),hs().setInt32(n+0,!Ji(r),!0)}function $N(n,e){const t=e,r=typeof t=="string"?t:void 0;var i=Ji(r)?0:Fo(r,qe.__wbindgen_malloc,qe.__wbindgen_realloc),s=Ps;hs().setInt32(n+4,s,!0),hs().setInt32(n+0,i,!0)}function FN(n,e){throw new Error(ao(n,e))}function zN(n,e){return ao(n,e)}function BN(n){return BigInt.asUintN(64,n)}function UN(n){return n}function jN(n){return n}function VN(){const n=qe.__wbindgen_export_4,e=n.grow(4);n.set(0,void 0),n.set(e+0,void 0),n.set(e+1,null),n.set(e+2,!0),n.set(e+3,!1)}URL=globalThis.URL;const ot=await sV({"./automerge_wasm_bg.js":{__wbg_new_8a6f238a6ece86ea:iN,__wbg_stack_0ed75d68575b0f3c:vN,__wbg_error_7534b8e9a36f1ab4:R3,__wbg_String_8f0eb39a4a4c2f66:x3,__wbg_set_3f1d0b984ed272ed:fN,__wbg_getRandomValues_1c61fac11405ffdc:Q3,__wbg_log_6c7b5f4f00b8ce3f:K3,__wbg_log_7917fde260a8fd39:J3,__wbg_get_0da715ceaecea5c8:F3,__wbg_length_186546c51cd61acd:X3,__wbg_new_1f3a344cf3123716:tN,__wbg_BigInt_6adbfd8eb0f7ec07:_3,__wbg_next_5b3530e612fde77d:lN,__wbg_next_692e82279131b03c:cN,__wbg_done_75ed0ee6dd243d9d:I3,__wbg_value_dd9372230531eade:xN,__wbg_iterator_f370b34483c71a1c:Z3,__wbg_get_458e874b43b18b25:z3,__wbg_call_13410aac570ffff7:T3,__wbg_new_19c25a3f2fa63a02:eN,__wbg_length_9d771c54845e987f:G3,__wbg_set_90f6c0f7bd8c0415:gN,__wbg_from_88bc52ce20ba6318:L3,__wbg_isArray_030cce220591fb41:q3,__wbg_push_330b2eb93e4e1212:hN,__wbg_unshift_18d353edeebf9a72:ON,__wbg_instanceof_ArrayBuffer_67f3012529f6a2dd:B3,__wbg_toString_7268338f40012a03:wN,__wbg_toString_1f1286a7a97689fe:bN,__wbg_new_da9dc54c5db29dfa:sN,__wbg_call_a5400b25a865cfd8:A3,__wbg_instanceof_Date_c0cdff0c3b978b0e:U3,__wbg_getTime_6bb3f64e0f18f817:$3,__wbg_new_5a2ae4557f92b50e:nN,__wbg_instanceof_Object_fbf5fef4952ff29b:j3,__wbg_assign_66f7942767cba7e3:S3,__wbg_defineProperty_1afba89a75bc184f:E3,__wbg_entries_2be2f15bd5554996:M3,__wbg_freeze_881cf93497533f9e:N3,__wbg_keys_ef52390b2ae0e714:W3,__wbg_values_a574c29011369bea:kN,__wbg_new_ef4f9056d946f38b:oN,__wbg_apply_55d63d092a912d6f:k3,__wbg_deleteProperty_5fe99f4fd0f66ebe:P3,__wbg_ownKeys_36e096e00ffe2676:uN,__wbg_set_453345bcda80b89a:pN,__wbg_concat_4a5e81410543b8f3:C3,__wbg_slice_974daea329f5c01d:mN,__wbg_for_fbb1cf47b8d6b3f6:D3,__wbg_toString_ea9a6b07f936eb86:_N,__wbg_length_6bb7e81f9d7713e4:Y3,__wbg_prototypesetcall_3d4a26c1ed734349:dN,__wbg_new_638ebfaedbf32a5e:rN,__wbg_instanceof_Uint8Array_9a8378d955933db7:V3,__wbg_newfromslice_074c56947bd43469:aN,__wbg_wbindgenstringget_0f16a6ddddef376f:$N,__wbg_wbindgendebugstring_99ef257a3ddda34d:TN,__wbg_isArray_52653600d4b65388:H3,__wbg_Error_e17e777aac105295:O3,__wbg_stringify_4a34a65f0d4e236f:yN,__wbg_wbindgenisnull_f3037694abe4d97a:PN,__wbg_wbindgenisundefined_c4b71d073b92f3c5:RN,__wbg_wbindgenisobject_307a53c6bd97fbf8:IN,__wbg_wbindgenisfunction_8cee7dce3725ae74:EN,__wbg_wbindgenisstring_d4fa939789f003b0:MN,__wbg_wbindgenisbigint_ecb90cc08a5a9154:CN,__wbg_wbindgenneg_3577d8a6fd6fd98b:LN,__wbg_wbindgenlt_544155a2b3097bd5:NN,__wbg_wbindgengt_5d4c5d18810de162:AN,__wbg_wbindgennumberget_f74b4c7525ac05cb:QN,__wbg_wbindgenbooleanget_3fe6f642c7d97746:SN,__wbg_wbindgenthrow_451ec1a8469d7eb6:FN,__wbg_wbindgenjsvallooseeq_9bec8c9be826bed1:DN,__wbindgen_init_externref_table:VN,__wbindgen_cast_2241b6af4c4b2941:zN,__wbindgen_cast_4625c577ab2ec9ee:BN,__wbindgen_cast_9ae0607507abb057:UN,__wbindgen_cast_d6cd19b81560fd6e:jN}},iV),_V=ot.memory,OV=ot.__wbg_syncstate_free,xV=ot.syncstate_sharedHeads,kV=ot.syncstate_lastSentHeads,SV=ot.syncstate_set_lastSentHeads,TV=ot.syncstate_set_sentHashes,AV=ot.syncstate_clone,CV=ot.__wbg_automerge_free,EV=ot.automerge_new,PV=ot.automerge_clone,IV=ot.automerge_fork,MV=ot.automerge_pendingOps,RV=ot.automerge_commit,DV=ot.automerge_merge,NV=ot.automerge_rollback,LV=ot.automerge_keys,QV=ot.automerge_text,$V=ot.automerge_spans,FV=ot.automerge_splice,zV=ot.automerge_updateText,BV=ot.automerge_updateSpans,UV=ot.automerge_push,jV=ot.automerge_pushObject,VV=ot.automerge_insert,qV=ot.automerge_splitBlock,HV=ot.automerge_joinBlock,ZV=ot.automerge_updateBlock,WV=ot.automerge_getBlock,XV=ot.automerge_insertObject,YV=ot.automerge_put,GV=ot.automerge_putObject,KV=ot.automerge_increment,JV=ot.automerge_get,eq=ot.automerge_getWithType,tq=ot.automerge_objInfo,nq=ot.automerge_getAll,rq=ot.automerge_enableFreeze,iq=ot.automerge_registerDatatype,sq=ot.automerge_applyPatches,oq=ot.automerge_applyAndReturnPatches,aq=ot.automerge_diffIncremental,lq=ot.automerge_updateDiffCursor,cq=ot.automerge_resetDiffCursor,uq=ot.automerge_diff,dq=ot.automerge_isolate,hq=ot.automerge_integrate,fq=ot.automerge_length,pq=ot.automerge_delete,gq=ot.automerge_save,mq=ot.automerge_saveIncremental,vq=ot.automerge_saveSince,yq=ot.automerge_saveNoCompress,bq=ot.automerge_saveAndVerify,wq=ot.automerge_loadIncremental,_q=ot.automerge_applyChanges,Oq=ot.automerge_getChanges,xq=ot.automerge_getChangesMeta,kq=ot.automerge_getChangeByHash,Sq=ot.automerge_getChangeMetaByHash,Tq=ot.automerge_getDecodedChangeByHash,Aq=ot.automerge_getChangesAdded,Cq=ot.automerge_getHeads,Eq=ot.automerge_getActorId,Pq=ot.automerge_getLastLocalChange,Iq=ot.automerge_dump,Mq=ot.automerge_getMissingDeps,Rq=ot.automerge_receiveSyncMessage,Dq=ot.automerge_generateSyncMessage,Nq=ot.automerge_toJS,Lq=ot.automerge_materialize,Qq=ot.automerge_getCursor,$q=ot.automerge_getCursorPosition,Fq=ot.automerge_emptyChange,zq=ot.automerge_mark,Bq=ot.automerge_unmark,Uq=ot.automerge_marks,jq=ot.automerge_marksAt,Vq=ot.automerge_hasOurChanges,qq=ot.automerge_topoHistoryTraversal,Hq=ot.automerge_stats,Zq=ot.automerge_saveBundle,Wq=ot.create,Xq=ot.load,Yq=ot.encodeChange,Gq=ot.decodeChange,Kq=ot.initSyncState,Jq=ot.importSyncState,eH=ot.exportSyncState,tH=ot.encodeSyncMessage,nH=ot.decodeSyncMessage,rH=ot.encodeSyncState,iH=ot.decodeSyncState,sH=ot.readBundle,oH=ot.__wbindgen_malloc,aH=ot.__wbindgen_realloc,lH=ot.__wbindgen_exn_store,cH=ot.__externref_table_alloc,uH=ot.__wbindgen_export_4,dH=ot.__wbindgen_free,hH=ot.__externref_table_dealloc,qN=ot.__wbindgen_start,fH=Object.freeze(Object.defineProperty({__proto__:null,__externref_table_alloc:cH,__externref_table_dealloc:hH,__wbg_automerge_free:CV,__wbg_syncstate_free:OV,__wbindgen_exn_store:lH,__wbindgen_export_4:uH,__wbindgen_free:dH,__wbindgen_malloc:oH,__wbindgen_realloc:aH,__wbindgen_start:qN,automerge_applyAndReturnPatches:oq,automerge_applyChanges:_q,automerge_applyPatches:sq,automerge_clone:PV,automerge_commit:RV,automerge_delete:pq,automerge_diff:uq,automerge_diffIncremental:aq,automerge_dump:Iq,automerge_emptyChange:Fq,automerge_enableFreeze:rq,automerge_fork:IV,automerge_generateSyncMessage:Dq,automerge_get:JV,automerge_getActorId:Eq,automerge_getAll:nq,automerge_getBlock:WV,automerge_getChangeByHash:kq,automerge_getChangeMetaByHash:Sq,automerge_getChanges:Oq,automerge_getChangesAdded:Aq,automerge_getChangesMeta:xq,automerge_getCursor:Qq,automerge_getCursorPosition:$q,automerge_getDecodedChangeByHash:Tq,automerge_getHeads:Cq,automerge_getLastLocalChange:Pq,automerge_getMissingDeps:Mq,automerge_getWithType:eq,automerge_hasOurChanges:Vq,automerge_increment:KV,automerge_insert:VV,automerge_insertObject:XV,automerge_integrate:hq,automerge_isolate:dq,automerge_joinBlock:HV,automerge_keys:LV,automerge_length:fq,automerge_loadIncremental:wq,automerge_mark:zq,automerge_marks:Uq,automerge_marksAt:jq,automerge_materialize:Lq,automerge_merge:DV,automerge_new:EV,automerge_objInfo:tq,automerge_pendingOps:MV,automerge_push:UV,automerge_pushObject:jV,automerge_put:YV,automerge_putObject:GV,automerge_receiveSyncMessage:Rq,automerge_registerDatatype:iq,automerge_resetDiffCursor:cq,automerge_rollback:NV,automerge_save:gq,automerge_saveAndVerify:bq,automerge_saveBundle:Zq,automerge_saveIncremental:mq,automerge_saveNoCompress:yq,automerge_saveSince:vq,automerge_spans:$V,automerge_splice:FV,automerge_splitBlock:qV,automerge_stats:Hq,automerge_text:QV,automerge_toJS:Nq,automerge_topoHistoryTraversal:qq,automerge_unmark:Bq,automerge_updateBlock:ZV,automerge_updateDiffCursor:lq,automerge_updateSpans:BV,automerge_updateText:zV,create:Wq,decodeChange:Gq,decodeSyncMessage:nH,decodeSyncState:iH,encodeChange:Yq,encodeSyncMessage:tH,encodeSyncState:rH,exportSyncState:eH,importSyncState:Jq,initSyncState:Kq,load:Xq,memory:_V,readBundle:sH,syncstate_clone:AV,syncstate_lastSentHeads:kV,syncstate_set_lastSentHeads:SV,syncstate_set_sentHashes:TV,syncstate_sharedHeads:xV},Symbol.toStringTag,{value:"Module"}));w3(fH);qN();const pH=Object.freeze(Object.defineProperty({__proto__:null,Automerge:ro,SyncState:ls,__wbg_BigInt_6adbfd8eb0f7ec07:_3,__wbg_Error_e17e777aac105295:O3,__wbg_String_8f0eb39a4a4c2f66:x3,__wbg_apply_55d63d092a912d6f:k3,__wbg_assign_66f7942767cba7e3:S3,__wbg_call_13410aac570ffff7:T3,__wbg_call_a5400b25a865cfd8:A3,__wbg_concat_4a5e81410543b8f3:C3,__wbg_defineProperty_1afba89a75bc184f:E3,__wbg_deleteProperty_5fe99f4fd0f66ebe:P3,__wbg_done_75ed0ee6dd243d9d:I3,__wbg_entries_2be2f15bd5554996:M3,__wbg_error_7534b8e9a36f1ab4:R3,__wbg_for_fbb1cf47b8d6b3f6:D3,__wbg_freeze_881cf93497533f9e:N3,__wbg_from_88bc52ce20ba6318:L3,__wbg_getRandomValues_1c61fac11405ffdc:Q3,__wbg_getTime_6bb3f64e0f18f817:$3,__wbg_get_0da715ceaecea5c8:F3,__wbg_get_458e874b43b18b25:z3,__wbg_instanceof_ArrayBuffer_67f3012529f6a2dd:B3,__wbg_instanceof_Date_c0cdff0c3b978b0e:U3,__wbg_instanceof_Object_fbf5fef4952ff29b:j3,__wbg_instanceof_Uint8Array_9a8378d955933db7:V3,__wbg_isArray_030cce220591fb41:q3,__wbg_isArray_52653600d4b65388:H3,__wbg_iterator_f370b34483c71a1c:Z3,__wbg_keys_ef52390b2ae0e714:W3,__wbg_length_186546c51cd61acd:X3,__wbg_length_6bb7e81f9d7713e4:Y3,__wbg_length_9d771c54845e987f:G3,__wbg_log_6c7b5f4f00b8ce3f:K3,__wbg_log_7917fde260a8fd39:J3,__wbg_new_19c25a3f2fa63a02:eN,__wbg_new_1f3a344cf3123716:tN,__wbg_new_5a2ae4557f92b50e:nN,__wbg_new_638ebfaedbf32a5e:rN,__wbg_new_8a6f238a6ece86ea:iN,__wbg_new_da9dc54c5db29dfa:sN,__wbg_new_ef4f9056d946f38b:oN,__wbg_newfromslice_074c56947bd43469:aN,__wbg_next_5b3530e612fde77d:lN,__wbg_next_692e82279131b03c:cN,__wbg_ownKeys_36e096e00ffe2676:uN,__wbg_prototypesetcall_3d4a26c1ed734349:dN,__wbg_push_330b2eb93e4e1212:hN,__wbg_set_3f1d0b984ed272ed:fN,__wbg_set_453345bcda80b89a:pN,__wbg_set_90f6c0f7bd8c0415:gN,__wbg_set_wasm:w3,__wbg_slice_974daea329f5c01d:mN,__wbg_stack_0ed75d68575b0f3c:vN,__wbg_stringify_4a34a65f0d4e236f:yN,__wbg_toString_1f1286a7a97689fe:bN,__wbg_toString_7268338f40012a03:wN,__wbg_toString_ea9a6b07f936eb86:_N,__wbg_unshift_18d353edeebf9a72:ON,__wbg_value_dd9372230531eade:xN,__wbg_values_a574c29011369bea:kN,__wbg_wbindgenbooleanget_3fe6f642c7d97746:SN,__wbg_wbindgendebugstring_99ef257a3ddda34d:TN,__wbg_wbindgengt_5d4c5d18810de162:AN,__wbg_wbindgenisbigint_ecb90cc08a5a9154:CN,__wbg_wbindgenisfunction_8cee7dce3725ae74:EN,__wbg_wbindgenisnull_f3037694abe4d97a:PN,__wbg_wbindgenisobject_307a53c6bd97fbf8:IN,__wbg_wbindgenisstring_d4fa939789f003b0:MN,__wbg_wbindgenisundefined_c4b71d073b92f3c5:RN,__wbg_wbindgenjsvallooseeq_9bec8c9be826bed1:DN,__wbg_wbindgenlt_544155a2b3097bd5:NN,__wbg_wbindgenneg_3577d8a6fd6fd98b:LN,__wbg_wbindgennumberget_f74b4c7525ac05cb:QN,__wbg_wbindgenstringget_0f16a6ddddef376f:$N,__wbg_wbindgenthrow_451ec1a8469d7eb6:FN,__wbindgen_cast_2241b6af4c4b2941:zN,__wbindgen_cast_4625c577ab2ec9ee:BN,__wbindgen_cast_9ae0607507abb057:UN,__wbindgen_cast_d6cd19b81560fd6e:jN,__wbindgen_init_externref_table:VN,create:cV,decodeChange:hV,decodeSyncMessage:vV,decodeSyncState:bV,encodeChange:dV,encodeSyncMessage:mV,encodeSyncState:yV,exportSyncState:gV,importSyncState:pV,initSyncState:fV,load:uV,readBundle:wV},Symbol.toStringTag,{value:"Module"})),J0=Symbol.for("_am_meta"),Lp=Symbol.for("_am_trace"),Qp=Symbol.for("_am_objectId"),Uk=Symbol.for("_am_isProxy"),jk=Symbol.for("_am_clearCache"),gH=Symbol.for("_am_uint"),mH=Symbol.for("_am_int"),vH=Symbol.for("_am_f64"),HN=Symbol.for("_am_counter"),ZN=Symbol.for("_am_immutableString");class V_{constructor(e){this.value=e||0,Reflect.defineProperty(this,HN,{value:!0})}valueOf(){return this.value}toString(){return this.valueOf().toString()}toJSON(){return this.value}increment(e){throw new Error("Counters should not be incremented outside of a change callback")}decrement(e){throw new Error("Counters should not be decremented outside of a change callback")}}class yH extends V_{constructor(e,t,r,i,s){super(e),this.context=t,this.path=r,this.objectId=i,this.key=s}increment(e){return e=typeof e=="number"?e:1,this.context.increment(this.objectId,this.key,e),this.value+=e,this.value}decrement(e){return this.increment(typeof e=="number"?-e:-1)}}function bH(n,e,t,r,i){return new yH(n,e,t,r,i)}var WN;class XN{constructor(e){this[WN]=!0,this.val=e}toString(){return this.val}toJSON(){return this.val}}WN=ZN;const wH=BigInt("9223372036854775807");function ul(n){if(typeof n=="string"&&/^[0-9]+$/.test(n)&&(n=parseInt(n,10)),typeof n!="number")return n;if(n<0||isNaN(n)||n===1/0||n===-1/0)throw new RangeError("A list index must be positive, but you passed "+n);return n}function ws(n,e){const{context:t,objectId:r,path:i}=n,s=t.getWithType(r,e);if(s===null)return;const o=s[0],a=s[1];switch(o){case void 0:return;case"map":return zg(t,a,[...i,e]);case"list":return tb(t,a,[...i,e]);case"text":return t.text(a);case"str":return new XN(a);case"uint":return a;case"int":return a;case"f64":return a;case"boolean":return a;case"null":return null;case"bytes":return a;case"timestamp":return a;case"counter":return bH(a,t,i,r,e);default:throw RangeError(`datatype ${o} unimplemented`)}}function gy(n,e,t){const r=typeof n;switch(r){case"object":if(n==null)return[null,"null"];if(n[gH])return[n.value,"uint"];if(n[mH])return[n.value,"int"];if(n[vH])return[n.value,"f64"];if(n[HN])return[n.value,"counter"];if(n instanceof Date)return[n.getTime(),"timestamp"];if(YN(n))return[n.toString(),"str"];if(n instanceof Uint8Array)return[n,"bytes"];if(n instanceof Array)return[n,"list"];if(Object.prototype.toString.call(n)==="[object Object]")return[n,"map"];throw eb(n,t)?new RangeError("Cannot create a reference to an existing document object"):new RangeError(`Cannot assign unknown object: ${n}`);case"boolean":return[n,"boolean"];case"bigint":return n>wH?[n,"uint"]:[n,"int"];case"number":return Number.isInteger(n)?[n,"int"]:[n,"f64"];case"string":return[n,"text"];case"undefined":throw new RangeError([`Cannot assign undefined value at ${bA(e)}, `,"because `undefined` is not a valid JSON data type. ","You might consider setting the property's value to `null`, ","or using `delete` to remove it altogether."].join(""));default:throw new RangeError([`Cannot assign ${r} value at ${bA(e)}. `,"All JSON primitive datatypes (object, array, string, number, boolean, null) ",`are supported in an Automerge document; ${r} values are not. `].join(""))}}function eb(n,e){var t,r;return n instanceof Date?!1:!!(n&&((r=(t=n[J0])===null||t===void 0?void 0:t.handle)===null||r===void 0?void 0:r.__wbg_ptr)===e.__wbg_ptr)}const _H={get(n,e){const{context:t,objectId:r,cache:i}=n;return e===Symbol.toStringTag?n[Symbol.toStringTag]:e===Qp?r:e===Uk?!0:e===Lp?n.trace:e===J0?{handle:t}:(i[e]||(i[e]=ws(n,e)),i[e])},set(n,e,t){const{context:r,objectId:i,path:s}=n;if(n.cache={},eb(t,r))throw new RangeError("Cannot create a reference to an existing document object");if(e===Lp)return n.trace=t,!0;if(e===jk)return!0;const[o,a]=gy(t,[...s,e],r);switch(a){case"list":{const l=r.putObject(i,e,[]),c=tb(r,l,[...s,e]);for(let d=0;d<o.length;d++)c[d]=o[d];break}case"text":{r.putObject(i,e,o);break}case"map":{const l=r.putObject(i,e,{}),c=zg(r,l,[...s,e]);for(const d in o)c[d]=o[d];break}default:r.put(i,e,o,a)}return!0},deleteProperty(n,e){const{context:t,objectId:r}=n;return n.cache={},t.delete(r,e),!0},has(n,e){return this.get(n,e)!==void 0},getOwnPropertyDescriptor(n,e){const t=this.get(n,e);if(typeof t<"u")return{configurable:!0,enumerable:!0,value:t}},ownKeys(n){const{context:e,objectId:t}=n,r=e.keys(t);return[...new Set(r)]}},OH={get(n,e){const{context:t,objectId:r}=n;return e=ul(e),e===Symbol.hasInstance?i=>Array.isArray(i):e===Symbol.toStringTag?n[Symbol.toStringTag]:e===Qp?r:e===Uk?!0:e===Lp?n.trace:e===J0?{handle:t}:e==="length"?t.length(r):typeof e=="number"?ws(n,e):kH(n)[e]},set(n,e,t){const{context:r,objectId:i,path:s}=n;if(e=ul(e),eb(t,r))throw new RangeError("Cannot create a reference to an existing document object");if(e===jk)return!0;if(e===Lp)return n.trace=t,!0;if(typeof e=="string")throw new RangeError("list index must be a number");const[o,a]=gy(t,[...s,e],r);switch(a){case"list":{let l;e>=r.length(i)?l=r.insertObject(i,e,[]):l=r.putObject(i,e,[]),tb(r,l,[...s,e]).splice(0,0,...o);break}case"text":{e>=r.length(i)?r.insertObject(i,e,o):r.putObject(i,e,o);break}case"map":{let l;e>=r.length(i)?l=r.insertObject(i,e,{}):l=r.putObject(i,e,{});const c=zg(r,l,[...s,e]);for(const d in o)c[d]=o[d];break}default:e>=r.length(i)?r.insert(i,e,o,a):r.put(i,e,o,a)}return!0},deleteProperty(n,e){const{context:t,objectId:r}=n;e=ul(e);const i=t.get(r,e);if(i!=null&&i[0]=="counter")throw new TypeError("Unsupported operation: deleting a counter from a list");return t.delete(r,e),!0},has(n,e){const{context:t,objectId:r}=n;return e=ul(e),typeof e=="number"?e<t.length(r):e==="length"},getOwnPropertyDescriptor(n,e){const{context:t,objectId:r}=n;return e==="length"?{writable:!0,value:t.length(r)}:e===Qp?{configurable:!1,enumerable:!1,value:r}:(e=ul(e),{configurable:!0,enumerable:!0,value:ws(n,e)})},getPrototypeOf(n){return Object.getPrototypeOf(n)},ownKeys(){const n=[];return n.push("length"),n}};function zg(n,e,t){const r={context:n,objectId:e,path:t||[],cache:{}},i={};return Object.assign(i,r),new Proxy(i,_H)}function tb(n,e,t){const r={context:n,objectId:e,path:t||[],cache:{}},i=[];return Object.assign(i,r),new Proxy(i,OH)}function xH(n){return zg(n,"_root",[])}function kH(n){const{context:e,objectId:t,path:r}=n;return{at(s){return ws(n,s)},deleteAt(s,o){return typeof o=="number"?e.splice(t,s,o):e.delete(t,s),this},fill(s,o,a){const[l,c]=gy(s,[...r,o],e),d=e.length(t);o=ul(o||0),a=ul(a||d);for(let h=o;h<Math.min(a,d);h++)c==="list"||c==="map"||c==="text"?e.putObject(t,h,l):e.put(t,h,l,c);return this},indexOf(s,o=0){const a=e.length(t);for(let l=o;l<a;l++){const c=e.getWithType(t,l);if(!c)continue;const[d,h]=c;if(!["map","list","text"].includes(d)){if(h===s)return l;continue}if(d==="text"&&typeof s=="string"&&s===ws(n,l)||s[Qp]===h)return l}return-1},insertAt(s,...o){return this.splice(s,0,...o),this},pop(){const s=e.length(t);if(s==0)return;const o=ws(n,s-1);return e.delete(t,s-1),o},push(...s){const o=e.length(t);return this.splice(o,0,...s),e.length(t)},shift(){if(e.length(t)==0)return;const s=ws(n,0);return e.delete(t,0),s},splice(s,o,...a){s=ul(s),typeof o!="number"&&(o=e.length(t)-s),o=ul(o);for(const d of a)if(eb(d,e))throw new RangeError("Cannot create a reference to an existing document object");const l=[];for(let d=0;d<o;d++){const h=ws(n,s);h!==void 0&&l.push(h),e.delete(t,s)}const c=a.map((d,h)=>{try{return gy(d,[...r],e)}catch(f){throw f instanceof RangeError?new RangeError(`${f.message} (at index ${h} in the input)`):f}});for(const[d,h]of c){switch(h){case"list":{const f=e.insertObject(t,s,[]);tb(e,f,[...r,s]).splice(0,0,...d);break}case"text":{e.insertObject(t,s,d);break}case"map":{const f=e.insertObject(t,s,{}),p=zg(e,f,[...r,s]);for(const g in d)p[g]=d[g];break}default:e.insert(t,s,d,h)}s+=1}return l},unshift(...s){return this.splice(0,0,...s),e.length(t)},entries(){let s=0;return{next:()=>{const a=ws(n,s);return a===void 0?{value:void 0,done:!0}:{value:[s++,a],done:!1}},[Symbol.iterator](){return this}}},keys(){let s=0;const o=e.length(t);return{next:()=>s<o?{value:s++,done:!1}:{value:void 0,done:!0},[Symbol.iterator](){return this}}},values(){let s=0;return{next:()=>{const a=ws(n,s++);return a===void 0?{value:void 0,done:!0}:{value:a,done:!1}},[Symbol.iterator](){return this}}},toArray(){const s=[];let o;do o=ws(n,s.length),o!==void 0&&s.push(o);while(o!==void 0);return s},map(s){return this.toArray().map(s)},toString(){return this.toArray().toString()},toLocaleString(){return this.toArray().toLocaleString()},forEach(s){return this.toArray().forEach(s)},concat(s){return this.toArray().concat(s)},every(s){return this.toArray().every(s)},filter(s){return this.toArray().filter(s)},find(s){let o=0;for(const a of this){if(s(a,o))return a;o+=1}},findIndex(s){let o=0;for(const a of this){if(s(a,o))return o;o+=1}return-1},includes(s){return this.find(o=>o===s)!==void 0},join(s){return this.toArray().join(s)},reduce(s,o){return this.toArray().reduce(s,o)},reduceRight(s,o){return this.toArray().reduceRight(s,o)},lastIndexOf(s,o=1/0){return this.toArray().lastIndexOf(s,o)},slice(s,o){return this.toArray().slice(s,o)},some(s){let o=0;for(const a of this){if(s(a,o))return!0;o+=1}return!1},[Symbol.iterator]:function*(){let s=0,o=ws(n,s);for(;o!==void 0;)yield o,s+=1,o=ws(n,s)}}}function bA(n){const e=n.map(t=>{if(typeof t=="number")return t.toString();if(typeof t=="string")return t.replace(/~/g,"~0").replace(/\//g,"~1")});return n.length===0?"":"/"+e.join("/")}function YN(n){return typeof n=="object"&&n!==null&&Object.prototype.hasOwnProperty.call(n,ZN)}function Ar(n,e=!0){if(typeof n!="object")throw new RangeError("must be the document root");const t=Reflect.get(n,J0);if(t===void 0||t==null||e&&JN(n)!=="_root")throw new RangeError("must be the document root");return t}function GN(n){Reflect.set(n,jk,!0)}function KN(n){return Reflect.get(n,Lp)}function JN(n){return typeof n!="object"||n===null?null:Reflect.get(n,Qp)}function nf(n){return!!Reflect.get(n,Uk)}var SH=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};function Vk(n){return typeof n=="object"?n:{actor:n}}function TH(n,e,t){if(typeof t=="string"){if(/^-?[0-9]+@[0-9a-zA-Z]+$|^[se]$/.test(t))return n.handle.getCursorPosition(e,t);throw new RangeError("index must be a number or cursor")}else return t}function lo(n){const e=Vk(n),t=!!e.freeze,r=e.patchCallback,i=e.actor,s=ds.create({actor:i});return s.enableFreeze(!!e.freeze),rL(s),s.materialize("/",void 0,{handle:s,heads:void 0,freeze:t,patchCallback:r})}function AH(n,e){const t=Ar(n),r=t.handle;return t.handle.materialize("/",e,Object.assign(Object.assign({},t),{handle:r,heads:e}))}function my(n,e){const t=Ar(n),r=t.heads,i=Vk(e),s=t.handle.fork(i.actor,r);s.updateDiffCursor();const{heads:o}=t,a=SH(t,["heads"]);return a.patchCallback=i.patchCallback,s.applyPatches(n,Object.assign(Object.assign({},a),{handle:s}))}function wA(n,e){return $p(lo(e),"from",{},t=>Object.assign(t,n)).newDoc}function CH(n,e,t){if(typeof e=="function")return $p(n,"change",{},e).newDoc;if(typeof t=="function")return typeof e=="string"&&(e={message:e}),$p(n,"change",e,t).newDoc;throw RangeError("Invalid args for change")}function EH(n,e,t,r){if(typeof t=="function")return $p(n,"changeAt",{},t,e);if(typeof r=="function")return typeof t=="string"&&(t={message:t}),$p(n,"changeAt",t,r,e);throw RangeError("Invalid args for changeAt")}function Bg(n,e,t,r){if(t==null)return n;const i=Ar(n),s=Object.assign(Object.assign({},i),{heads:void 0}),{value:o,patches:a}=i.handle.applyAndReturnPatches(n,s);if(a.length>0){r?.(a,{before:n,after:o,source:e});const l=Ar(o);l.mostRecentPatch={before:Ar(n).heads,after:l.handle.getHeads(),patches:a}}return i.heads=t,o}function $p(n,e,t,r,i){if(typeof r!="function")throw new RangeError("invalid change function");const s=Ar(n);if(n===void 0||s===void 0)throw new RangeError("must be the document root");if(s.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(nf(n))throw new RangeError("Calls to Automerge.change cannot be nested");let o=s.handle.getHeads();i&&IH(i,o)&&(i=void 0),i&&(s.handle.isolate(i),o=i),"time"in t||(t.time=Math.floor(Date.now()/1e3));try{s.heads=o;const a=xH(s.handle);if(r(a),s.handle.pendingOps()===0)return s.heads=void 0,i&&s.handle.integrate(),{newDoc:n,newHeads:null};{const l=s.handle.commit(t.message,t.time);return s.handle.integrate(),{newDoc:Bg(n,e,o,t.patchCallback||s.patchCallback),newHeads:l!=null?[l]:null}}}catch(a){throw s.heads=void 0,s.handle.rollback(),a}}function _A(n,e){e===void 0&&(e={}),typeof e=="string"&&(e={message:e}),"time"in e||(e.time=Math.floor(Date.now()/1e3));const t=Ar(n);if(t.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(nf(n))throw new RangeError("Calls to Automerge.change cannot be nested");const r=t.handle.getHeads();return t.handle.emptyChange(e.message,e.time),Bg(n,"emptyChange",r)}function PH(n,e){const t=Vk(e);if(t.patchCallback)return qk(lo(t),n);const r=t.actor,i=t.patchCallback,s=t.unchecked||!1,o=t.allowMissingChanges||!1,a=t.convertImmutableStringsToText||!1,l=ds.load(n,{actor:r,unchecked:s,allowMissingDeps:o,convertImmutableStringsToText:a});return l.enableFreeze(!!t.freeze),rL(l),l.materialize("/",void 0,{handle:l,heads:void 0,patchCallback:i})}function qk(n,e,t){t||(t={});const r=Ar(n);if(r.heads)throw new RangeError("Attempting to change an out of date document - set at: "+KN(n));if(nf(n))throw new RangeError("Calls to Automerge.change cannot be nested");const i=r.handle.getHeads();return r.handle.loadIncremental(e),Bg(n,"loadIncremental",i,t.patchCallback||r.patchCallback)}function eL(n){return Ar(n).handle.save()}function OA(n,e){const t=Ar(n);if(t.heads)throw new RangeError("Attempting to change an out of date document - set at: "+KN(n));const r=t.handle.getHeads(),i=Ar(e),s=t.handle.getChangesAdded(i.handle);return t.handle.applyChanges(s),Bg(n,"merge",r,t.patchCallback)}function Nv(n,e,t){xA(e,"before heads"),xA(t,"after heads");const r=Ar(n);return r.mostRecentPatch&&vy(r.mostRecentPatch.before,e)&&vy(r.mostRecentPatch.after,t)?r.mostRecentPatch.patches:r.handle.diff(e,t)}function IH(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function xA(n,e){if(!Array.isArray(n))throw new Error(`invalid ${e}: must be an array`)}function vy(n,e){if(!kA(n)||!kA(e))return n===e;const t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==r[i]||!vy(n[t[i]],e[r[i]]))return!1;return!0}function tL(n){const e=ds.importSyncState(n),t=ds.encodeSyncState(e);return e.free(),t}function nL(n){const e=ds.decodeSyncState(n),t=ds.exportSyncState(e);return e.free(),t}function MH(n,e){const t=Ar(n),r=ds.importSyncState(e),i=t.handle.generateSyncMessage(r);return[ds.exportSyncState(r),i]}function RH(n,e,t,r){const i=ds.importSyncState(e);r||(r={});const s=Ar(n);if(s.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(nf(n))throw new RangeError("Calls to Automerge.change cannot be nested");const o=s.handle.getHeads();s.handle.receiveSyncMessage(i,t);const a=ds.exportSyncState(i);return[Bg(n,"receiveSyncMessage",o,r.patchCallback||s.patchCallback),a,null]}function DH(){return ds.exportSyncState(ds.initSyncState())}function NH(n){return ds.decodeSyncMessage(n)}function Is(n){const e=Ar(n);return e.heads||e.handle.getHeads()}function kA(n){return typeof n=="object"&&n!==null}function LH(n,e){return Ar(n).handle.saveSince(e)}function rL(n){n.registerDatatype("counter",e=>new V_(e),e=>{if(e instanceof V_)return e.value}),n.registerDatatype("str",e=>new XN(e),e=>{if(YN(e))return e.val})}function QH(n){return Ar(n).handle.topoHistoryTraversal()}function $H(n,e){return Ar(n).handle.getDecodedChangeByHash(e)}function Hk(n){return Ar(n).handle.stats()}function FH(n,e,t,r,i){const s=sL(n,e,"splice");if(!nf(n))throw new RangeError("object cannot be modified outside of a change block");const o=Ar(n,!1);GN(n),t=TH(o,s,t);try{return o.handle.splice(s,t,r,i)}catch(a){throw new RangeError(`Cannot splice: ${a}`)}}function iL(n,e,t){const r=sL(n,e,"updateText");if(!nf(n))throw new RangeError("object cannot be modified outside of a change block");const i=Ar(n,!1);GN(n);try{return i.handle.updateText(r,t)}catch(s){throw new RangeError(`Cannot updateText: ${s}`)}}function sL(n,e,t){e=e.slice();const r=JN(n);if(!r)throw new RangeError(`invalid object for ${t}`);return e.unshift(r),e.join("/")}rV(pH);async function $u(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("conversations",{create:!0})}async function zH(n){const r=await(await(await $u()).getFileHandle(`${n.id}.json`,{create:!0})).createWritable();try{const i=JSON.stringify(n);await r.write(i)}finally{await r.close()}}async function BH(n){try{const i=await(await(await(await $u()).getFileHandle(`${n}.json`)).getFile()).text();return JSON.parse(i)}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return null;throw e}}async function UH(n){try{return await(await $u()).getFileHandle(`${n}.json`),!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async function jH(n){try{return await(await $u()).removeEntry(`${n}.json`),!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async function VH(){const n=await $u();let e=0,t=0;for await(const[r,i]of n.entries())if(i.kind==="file"&&r.endsWith(".json")){e++;const o=await i.getFile();t+=o.size}return{totalFiles:e,totalBytes:t}}async function qH(){const n=await $u(),e=[];for await(const[t,r]of n.entries())r.kind==="file"&&t.endsWith(".json")&&e.push(t.slice(0,-5));return e}async function HH(){const n=await $u();let e=0;const t=[];for await(const[r,i]of n.entries())i.kind==="file"&&r.endsWith(".json")&&t.push(r);for(const r of t)await n.removeEntry(r),e++;return e}const Al={store:zH,retrieve:BH,exists:UH,remove:jH,getStorageStats:VH,listIds:qH,clearAll:HH};function oL(n,e,t){if(e.startsWith("props.")){const r=e.slice(6);return n.props?.[r]}switch(e){case"type":return t[n.type]?.name||n.type;case"type_id":return n.type;case"title":return n.title;case"created":return n.created;case"updated":return n.updated;case"archived":return n.archived;case"sourceFormat":return n.sourceFormat||"markdown";case"lastOpened":return n.lastOpened;case"review.enabled":return n.review?.enabled??!1;case"review.status":return n.review?.status;case"review.lastReviewed":return n.review?.lastReviewed;case"review.reviewCount":return n.review?.reviewCount??0;default:return}}const nb="__empty__";function aL(n,e,t){const r=Array.isArray(n)?n.map(String):String(n);switch(e){case"=":return Array.isArray(r)?r.some(i=>i.toLowerCase()===String(t).toLowerCase()):r.toLowerCase()===String(t).toLowerCase();case"!=":return Array.isArray(r)?!r.some(i=>i.toLowerCase()===String(t).toLowerCase()):r.toLowerCase()!==String(t).toLowerCase();case">":return Uc(n,t)>0;case"<":return Uc(n,t)<0;case">=":return Uc(n,t)>=0;case"<=":return Uc(n,t)<=0;case"LIKE":{const i=String(t).toLowerCase();return Array.isArray(r)?r.some(s=>s.toLowerCase().includes(i)):r.toLowerCase().includes(i)}case"IN":{const i=Array.isArray(t)?t.map(s=>s.toLowerCase()):String(t).split(",").map(s=>s.trim().toLowerCase());return Array.isArray(r)?r.some(s=>i.includes(s.toLowerCase())):i.includes(r.toLowerCase())}case"NOT IN":{const i=Array.isArray(t)?t.map(s=>s.toLowerCase()):String(t).split(",").map(s=>s.trim().toLowerCase());return Array.isArray(r)?!r.some(s=>i.includes(s.toLowerCase())):!i.includes(r.toLowerCase())}case"BETWEEN":{const i=Array.isArray(t)?t:String(t).split(",").map(a=>a.trim());if(i.length!==2)return!1;const[s,o]=i;return Uc(n,s)>=0&&Uc(n,o)<=0}default:return Array.isArray(r)?r.some(i=>i.toLowerCase()===String(t).toLowerCase()):r.toLowerCase()===String(t).toLowerCase()}}function Uc(n,e){const t=String(n),r=String(e);if(SA(t)&&SA(r))return new Date(t).getTime()-new Date(r).getTime();const i=parseFloat(t),s=parseFloat(r);return!isNaN(i)&&!isNaN(s)?i-s:t.localeCompare(r)}function SA(n){return/^\d{4}-\d{2}-\d{2}/.test(n)}function Qs(n){return n==null||typeof n!="object"?n:JSON.parse(JSON.stringify(n))}function lL(n){return n!==null&&typeof n=="object"?JSON.parse(JSON.stringify(n)):n}function ZH(n){const e=new Uint8Array(Math.ceil(n/2));return crypto.getRandomValues(e),Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("").slice(0,n)}function Ha(n){return`${n}-${ZH(8)}`}function Ug(){return Ha("n")}function WH(){return Ha("ws")}function XH(){return Ha("type")}function Zk(){return Ha("vault")}function YH(){return Ha("conv")}function GH(){return Ha("msg")}function KH(){return Ha("w")}function JH(){return Ha("wc")}function cL(){return Ha("wm")}function yy(){return Ha("prop")}function Wt(){return new Date().toISOString()}function Wk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Im={exports:{}},dw,TA;function eZ(){if(TA)return dw;TA=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,s=r*365.25;dw=function(d,h){h=h||{};var f=typeof d;if(f==="string"&&d.length>0)return o(d);if(f==="number"&&isFinite(d))return h.long?l(d):a(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function o(d){if(d=String(d),!(d.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(h){var f=parseFloat(h[1]),p=(h[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return f*s;case"weeks":case"week":case"w":return f*i;case"days":case"day":case"d":return f*r;case"hours":case"hour":case"hrs":case"hr":case"h":return f*t;case"minutes":case"minute":case"mins":case"min":case"m":return f*e;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function a(d){var h=Math.abs(d);return h>=r?Math.round(d/r)+"d":h>=t?Math.round(d/t)+"h":h>=e?Math.round(d/e)+"m":h>=n?Math.round(d/n)+"s":d+"ms"}function l(d){var h=Math.abs(d);return h>=r?c(d,h,r,"day"):h>=t?c(d,h,t,"hour"):h>=e?c(d,h,e,"minute"):h>=n?c(d,h,n,"second"):d+" ms"}function c(d,h,f,p){var g=h>=f*1.5;return Math.round(d/f)+" "+p+(g?"s":"")}return dw}var hw,AA;function tZ(){if(AA)return hw;AA=1;function n(e){r.debug=r,r.default=r,r.coerce=c,r.disable=a,r.enable=s,r.enabled=l,r.humanize=eZ(),r.destroy=d,Object.keys(e).forEach(h=>{r[h]=e[h]}),r.names=[],r.skips=[],r.formatters={};function t(h){let f=0;for(let p=0;p<h.length;p++)f=(f<<5)-f+h.charCodeAt(p),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=t;function r(h){let f,p=null,g,m;function v(...y){if(!v.enabled)return;const O=v,_=Number(new Date),x=_-(f||_);O.diff=x,O.prev=f,O.curr=_,f=_,y[0]=r.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let k=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(E,R)=>{if(E==="%%")return"%";k++;const C=r.formatters[R];if(typeof C=="function"){const I=y[k];E=C.call(O,I),y.splice(k,1),k--}return E}),r.formatArgs.call(O,y),(O.log||r.log).apply(O,y)}return v.namespace=h,v.useColors=r.useColors(),v.color=r.selectColor(h),v.extend=i,v.destroy=r.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(g!==r.namespaces&&(g=r.namespaces,m=r.enabled(h)),m),set:y=>{p=y}}),typeof r.init=="function"&&r.init(v),v}function i(h,f){const p=r(this.namespace+(typeof f>"u"?":":f)+h);return p.log=this.log,p}function s(h){r.save(h),r.namespaces=h,r.names=[],r.skips=[];const f=(typeof h=="string"?h:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const p of f)p[0]==="-"?r.skips.push(p.slice(1)):r.names.push(p)}function o(h,f){let p=0,g=0,m=-1,v=0;for(;p<h.length;)if(g<f.length&&(f[g]===h[p]||f[g]==="*"))f[g]==="*"?(m=g,v=p,g++):(p++,g++);else if(m!==-1)g=m+1,v++,p=v;else return!1;for(;g<f.length&&f[g]==="*";)g++;return g===f.length}function a(){const h=[...r.names,...r.skips.map(f=>"-"+f)].join(",");return r.enable(""),h}function l(h){for(const f of r.skips)if(o(h,f))return!1;for(const f of r.names)if(o(h,f))return!0;return!1}function c(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return hw=n,hw}var CA;function nZ(){return CA||(CA=1,(function(n,e){var t={};e.formatArgs=i,e.save=s,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let h=0,f=0;c[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(h++,p==="%c"&&(f=h))}),c.splice(f,0,d)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function o(){let c;try{c=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=t.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=tZ()(e);const{formatters:l}=n.exports;l.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(Im,Im.exports)),Im.exports}var rZ=nZ();const Fu=Wk(rZ);var fw={exports:{}},EA;function iZ(){return EA||(EA=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function s(l,c,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new i(d,h||l,f),g=t?t+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],p]:l._events[g].push(p):(l._events[g]=p,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],d,h;if(this._eventsCount===0)return c;for(h in d=this._events)e.call(d,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},a.prototype.listeners=function(c){var d=t?t+c:c,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,p=h.length,g=new Array(p);f<p;f++)g[f]=h[f].fn;return g},a.prototype.listenerCount=function(c){var d=t?t+c:c,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(c,d,h,f,p,g){var m=t?t+c:c;if(!this._events[m])return!1;var v=this._events[m],y=arguments.length,O,_;if(v.fn){switch(v.once&&this.removeListener(c,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,d),!0;case 3:return v.fn.call(v.context,d,h),!0;case 4:return v.fn.call(v.context,d,h,f),!0;case 5:return v.fn.call(v.context,d,h,f,p),!0;case 6:return v.fn.call(v.context,d,h,f,p,g),!0}for(_=1,O=new Array(y-1);_<y;_++)O[_-1]=arguments[_];v.fn.apply(v.context,O)}else{var x=v.length,k;for(_=0;_<x;_++)switch(v[_].once&&this.removeListener(c,v[_].fn,void 0,!0),y){case 1:v[_].fn.call(v[_].context);break;case 2:v[_].fn.call(v[_].context,d);break;case 3:v[_].fn.call(v[_].context,d,h);break;case 4:v[_].fn.call(v[_].context,d,h,f);break;default:if(!O)for(k=1,O=new Array(y-1);k<y;k++)O[k-1]=arguments[k];v[_].fn.apply(v[_].context,O)}}return!0},a.prototype.on=function(c,d,h){return s(this,c,d,h,!1)},a.prototype.once=function(c,d,h){return s(this,c,d,h,!0)},a.prototype.removeListener=function(c,d,h,f){var p=t?t+c:c;if(!this._events[p])return this;if(!d)return o(this,p),this;var g=this._events[p];if(g.fn)g.fn===d&&(!f||g.once)&&(!h||g.context===h)&&o(this,p);else{for(var m=0,v=[],y=g.length;m<y;m++)(g[m].fn!==d||f&&!g[m].once||h&&g[m].context!==h)&&v.push(g[m]);v.length?this._events[p]=v.length===1?v[0]:v:o(this,p)}return this},a.prototype.removeAllListeners=function(c){var d;return c?(d=t?t+c:c,this._events[d]&&o(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(fw)),fw.exports}var sZ=iZ();const zu=Wk(sZ);function oZ(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function aZ(){const n=oZ();if(n.__xstate__)return n.__xstate__}const lZ=n=>{if(typeof window>"u")return;const e=aZ();e&&e.register(n)};class PA{constructor(e){this._process=e,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(e){const t={value:e,next:null};if(this._current){this._last.next=t,this._last=t;return}this._current=t,this._last=t,this._active&&this.flush()}flush(){for(;this._current;){const e=this._current;this._process(e.value),this._current=e.next}this._last=null}}const uL=".",cZ="",dL="",uZ="#",dZ="*",hL="xstate.init",hZ="xstate.error",q_="xstate.stop";function fZ(n,e){return{type:`xstate.after.${n}.${e}`}}function H_(n,e){return{type:`xstate.done.state.${n}`,output:e}}function pZ(n,e){return{type:`xstate.done.actor.${n}`,output:e,actorId:n}}function fL(n,e){return{type:`xstate.error.actor.${n}`,error:e,actorId:n}}function pL(n){return{type:hL,input:n}}function ra(n){setTimeout(()=>{throw n})}const gZ=typeof Symbol=="function"&&Symbol.observable||"@@observable";function gL(n,e){const t=IA(n),r=IA(e);return typeof r=="string"?typeof t=="string"?r===t:!1:typeof t=="string"?t in r:Object.keys(t).every(i=>i in r?gL(t[i],r[i]):!1)}function Xk(n){if(vL(n))return n;const e=[];let t="";for(let r=0;r<n.length;r++){switch(n.charCodeAt(r)){case 92:t+=n[r+1],r++;continue;case 46:e.push(t),t="";continue}t+=n[r]}return e.push(t),e}function IA(n){if(ZZ(n))return n.value;if(typeof n!="string")return n;const e=Xk(n);return mZ(e)}function mZ(n){if(n.length===1)return n[0];const e={};let t=e;for(let r=0;r<n.length-1;r++)if(r===n.length-2)t[n[r]]=n[r+1];else{const i=t;t={},i[n[r]]=t}return e}function MA(n,e){const t={},r=Object.keys(n);for(let i=0;i<r.length;i++){const s=r[i];t[s]=e(n[s],s,n,i)}return t}function mL(n){return vL(n)?n:[n]}function pl(n){return n===void 0?[]:mL(n)}function Z_(n,e,t,r){return typeof n=="function"?n({context:e,event:t,self:r}):n}function vL(n){return Array.isArray(n)}function vZ(n){return n.type.startsWith("xstate.error.actor")}function kd(n){return mL(n).map(e=>typeof e>"u"||typeof e=="string"?{target:e}:e)}function yL(n){if(!(n===void 0||n===cZ))return pl(n)}function W_(n,e,t){const r=typeof n=="object",i=r?n:void 0;return{next:(r?n.next:n)?.bind(i),error:(r?n.error:e)?.bind(i),complete:(r?n.complete:t)?.bind(i)}}function RA(n,e){return`${e}.${n}`}function Yk(n,e){const t=e.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!t)return n.implementations.actors[e];const[,r,i]=t,o=n.getStateNodeById(i).config.invoke;return(Array.isArray(o)?o[r]:o).src}function DA(n,e){return`${n.sessionId}.${e}`}let yZ=0;function bZ(n,e){const t=new Map,r=new Map,i=new WeakMap,s=new Set,o={},{clock:a,logger:l}=e,c={schedule:(f,p,g,m,v=Math.random().toString(36).slice(2))=>{const y={source:f,target:p,event:g,delay:m,id:v,startedAt:Date.now()},O=DA(f,v);h._snapshot._scheduledEvents[O]=y;const _=a.setTimeout(()=>{delete o[O],delete h._snapshot._scheduledEvents[O],h._relay(f,p,g)},m);o[O]=_},cancel:(f,p)=>{const g=DA(f,p),m=o[g];delete o[g],delete h._snapshot._scheduledEvents[g],m!==void 0&&a.clearTimeout(m)},cancelAll:f=>{for(const p in h._snapshot._scheduledEvents){const g=h._snapshot._scheduledEvents[p];g.source===f&&c.cancel(f,g.id)}}},d=f=>{if(!s.size)return;const p={...f,rootId:n.sessionId};s.forEach(g=>g.next?.(p))},h={_snapshot:{_scheduledEvents:(e?.snapshot&&e.snapshot.scheduler)??{}},_bookId:()=>`x:${yZ++}`,_register:(f,p)=>(t.set(f,p),f),_unregister:f=>{t.delete(f.sessionId);const p=i.get(f);p!==void 0&&(r.delete(p),i.delete(f))},get:f=>r.get(f),getAll:()=>Object.fromEntries(r.entries()),_set:(f,p)=>{const g=r.get(f);if(g&&g!==p)throw new Error(`Actor with system ID '${f}' already exists.`);r.set(f,p),i.set(p,f)},inspect:f=>{const p=W_(f);return s.add(p),{unsubscribe(){s.delete(p)}}},_sendInspectionEvent:d,_relay:(f,p,g)=>{h._sendInspectionEvent({type:"@xstate.event",sourceRef:f,actorRef:p,event:g}),p._send(g)},scheduler:c,getSnapshot:()=>({_scheduledEvents:{...h._snapshot._scheduledEvents}}),start:()=>{const f=h._snapshot._scheduledEvents;h._snapshot._scheduledEvents={};for(const p in f){const{source:g,target:m,event:v,delay:y,id:O}=f[p];c.schedule(g,m,v,y,O)}},_clock:a,_logger:l};return h}let pw=!1;const Gk=1;let Yi=(function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n})({});const wZ={clock:{setTimeout:(n,e)=>setTimeout(n,e),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class _Z{constructor(e,t){this.logic=e,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new PA(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=Yi.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this.systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const r={...wZ,...t},{clock:i,logger:s,parent:o,syncSnapshot:a,id:l,systemId:c,inspect:d}=r;this.system=o?o.system:bZ(this,{clock:i,logger:s}),d&&!o&&this.system.inspect(W_(d)),this.sessionId=this.system._bookId(),this.id=l??this.sessionId,this.logger=t?.logger??this.system._logger,this.clock=t?.clock??this.system._clock,this._parent=o,this._syncSnapshot=a,this.options=r,this.src=r.src??e,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:h=>{this._deferred.push(h)},system:this.system,stopChild:h=>{if(h._parent!==this)throw new Error(`Cannot stop child actor ${h.id} of ${this.id} because it is not a child`);h._stop()},emit:h=>{const f=this.eventListeners.get(h.type),p=this.eventListeners.get("*");if(!f&&!p)return;const g=[...f?f.values():[],...p?p.values():[]];for(const m of g)try{m(h)}catch(v){ra(v)}},actionExecutor:h=>{const f=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:h.type,params:h.params}}),!h.exec)return;const p=pw;try{pw=!0,h.exec(h.info,h.params)}finally{pw=p}};this._processingStatus===Yi.Running?f():this._deferred.push(f)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),c&&(this.systemId=c,this.system._set(c,this)),this._initState(t?.snapshot??t?.state),c&&this._snapshot.status!=="active"&&this.system._unregister(this)}_initState(e){try{this._snapshot=e?this.logic.restoreSnapshot?this.logic.restoreSnapshot(e,this._actorScope):e:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(t){this._snapshot={status:"error",output:void 0,error:t}}}update(e,t){this._snapshot=e;let r;for(;r=this._deferred.shift();)try{r()}catch(i){this._deferred.length=0,this._snapshot={...e,status:"error",error:i}}switch(this._snapshot.status){case"active":for(const i of this.observers)try{i.next?.(e)}catch(s){ra(s)}break;case"done":for(const i of this.observers)try{i.next?.(e)}catch(s){ra(s)}this._stopProcedure(),this._complete(),this._doneEvent=pZ(this.id,this._snapshot.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error);break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:t,snapshot:e})}subscribe(e,t,r){const i=W_(e,t,r);if(this._processingStatus!==Yi.Stopped)this.observers.add(i);else switch(this._snapshot.status){case"done":try{i.complete?.()}catch(s){ra(s)}break;case"error":{const s=this._snapshot.error;if(!i.error)ra(s);else try{i.error(s)}catch(o){ra(o)}break}}return{unsubscribe:()=>{this.observers.delete(i)}}}on(e,t){let r=this.eventListeners.get(e);r||(r=new Set,this.eventListeners.set(e,r));const i=t.bind(void 0);return r.add(i),{unsubscribe:()=>{r.delete(i)}}}start(){if(this._processingStatus===Yi.Running)return this;this._syncSnapshot&&this.subscribe({next:r=>{r.status==="active"&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:r})},error:()=>{}}),this.system._register(this.sessionId,this),this.systemId&&this.system._set(this.systemId,this),this._processingStatus=Yi.Running;const e=pL(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:e}),this._snapshot.status){case"done":return this.update(this._snapshot,e),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(r){return this._snapshot={...this._snapshot,status:"error",error:r},this._error(r),this}return this.update(this._snapshot,e),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(e){let t,r;try{t=this.logic.transition(this._snapshot,e,this._actorScope)}catch(i){r={err:i}}if(r){const{err:i}=r;this._snapshot={...this._snapshot,status:"error",error:i},this._error(i);return}this.update(t,e),e.type===q_&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===Yi.Stopped?this:(this.mailbox.clear(),this._processingStatus===Yi.NotStarted?(this._processingStatus=Yi.Stopped,this):(this.mailbox.enqueue({type:q_}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(const e of this.observers)try{e.complete?.()}catch(t){ra(t)}this.observers.clear()}_reportError(e){if(!this.observers.size){this._parent||ra(e);return}let t=!1;for(const r of this.observers){const i=r.error;t||=!i;try{i?.(e)}catch(s){ra(s)}}this.observers.clear(),t&&ra(e)}_error(e){this._stopProcedure(),this._reportError(e),this._parent&&this.system._relay(this,this._parent,fL(this.id,e))}_stopProcedure(){return this._processingStatus!==Yi.Running?this:(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new PA(this._process.bind(this)),this._processingStatus=Yi.Stopped,this.system._unregister(this),this)}_send(e){this._processingStatus!==Yi.Stopped&&this.mailbox.enqueue(e)}send(e){this.system._relay(void 0,this,e)}attachDevTools(){const{devTools:e}=this.options;e&&(typeof e=="function"?e:lZ)(this)}toJSON(){return{xstate$$type:Gk,id:this.id}}getPersistedSnapshot(e){return this.logic.getPersistedSnapshot(this._snapshot,e)}[gZ](){return this}getSnapshot(){return this._snapshot}}function Fp(n,...[e]){return new _Z(n,e)}function OZ(n,e,t,r,{sendId:i}){const s=typeof i=="function"?i(t,r):i;return[e,{sendId:s},void 0]}function xZ(n,e){n.defer(()=>{n.system.scheduler.cancel(n.self,e.sendId)})}function Kk(n){function e(t,r){}return e.type="xstate.cancel",e.sendId=n,e.resolve=OZ,e.execute=xZ,e}function kZ(n,e,t,r,{id:i,systemId:s,src:o,input:a,syncSnapshot:l}){const c=typeof o=="string"?Yk(e.machine,o):o,d=typeof i=="function"?i(t):i;let h,f;return c&&(f=typeof a=="function"?a({context:e.context,event:t.event,self:n.self}):a,h=Fp(c,{id:d,src:o,parent:n.self,syncSnapshot:l,systemId:s,input:f})),[wu(e,{children:{...e.children,[d]:h}}),{id:i,systemId:s,actorRef:h,src:o,input:f},void 0]}function SZ(n,{actorRef:e}){e&&n.defer(()=>{e._processingStatus!==Yi.Stopped&&e.start()})}function Jk(...[n,{id:e,systemId:t,input:r,syncSnapshot:i=!1}={}]){function s(o,a){}return s.type="xstate.spawnChild",s.id=e,s.systemId=t,s.src=n,s.input=r,s.syncSnapshot=i,s.resolve=kZ,s.execute=SZ,s}function TZ(n,e,t,r,{actorRef:i}){const s=typeof i=="function"?i(t,r):i,o=typeof s=="string"?e.children[s]:s;let a=e.children;return o&&(a={...a},delete a[o.id]),[wu(e,{children:a}),o,void 0]}function AZ(n,e){if(e){if(n.system._unregister(e),e._processingStatus!==Yi.Running){n.stopChild(e);return}n.defer(()=>{n.stopChild(e)})}}function rb(n){function e(t,r){}return e.type="xstate.stopChild",e.actorRef=n,e.resolve=TZ,e.execute=AZ,e}function ib(n,e,t,r){const{machine:i}=r,s=typeof n=="function",o=s?n:i.implementations.guards[typeof n=="string"?n:n.type];if(!s&&!o)throw new Error(`Guard '${typeof n=="string"?n:n.type}' is not implemented.'.`);if(typeof o!="function")return ib(o,e,t,r);const a={context:e,event:t},l=s||typeof n=="string"?void 0:"params"in n?typeof n.params=="function"?n.params({context:e,event:t}):n.params:void 0;return"check"in o?o.check(r,a,o):o(a,l)}const eS=n=>n.type==="atomic"||n.type==="final";function Oh(n){return Object.values(n.states).filter(e=>e.type!=="history")}function jg(n,e){const t=[];if(e===n)return t;let r=n.parent;for(;r&&r!==e;)t.push(r),r=r.parent;return t}function by(n){const e=new Set(n),t=wL(e);for(const r of e)if(r.type==="compound"&&(!t.get(r)||!t.get(r).length))NA(r).forEach(i=>e.add(i));else if(r.type==="parallel"){for(const i of Oh(r))if(i.type!=="history"&&!e.has(i)){const s=NA(i);for(const o of s)e.add(o)}}for(const r of e){let i=r.parent;for(;i;)e.add(i),i=i.parent}return e}function bL(n,e){const t=e.get(n);if(!t)return{};if(n.type==="compound"){const i=t[0];if(i){if(eS(i))return i.key}else return{}}const r={};for(const i of t)r[i.key]=bL(i,e);return r}function wL(n){const e=new Map;for(const t of n)e.has(t)||e.set(t,[]),t.parent&&(e.has(t.parent)||e.set(t.parent,[]),e.get(t.parent).push(t));return e}function _L(n,e){const t=by(e);return bL(n,wL(t))}function tS(n,e){return e.type==="compound"?Oh(e).some(t=>t.type==="final"&&n.has(t)):e.type==="parallel"?Oh(e).every(t=>tS(n,t)):e.type==="final"}const sb=n=>n[0]===uZ;function CZ(n,e){return n.transitions.get(e)||[...n.transitions.keys()].filter(r=>{if(r===dZ)return!0;if(!r.endsWith(".*"))return!1;const i=r.split("."),s=e.split(".");for(let o=0;o<i.length;o++){const a=i[o],l=s[o];if(a==="*")return o===i.length-1;if(a!==l)return!1}return!0}).sort((r,i)=>i.length-r.length).flatMap(r=>n.transitions.get(r))}function EZ(n){const e=n.config.after;if(!e)return[];const t=i=>{const s=fZ(i,n.id),o=s.type;return n.entry.push(iS(s,{id:o,delay:i})),n.exit.push(Kk(o)),o};return Object.keys(e).flatMap(i=>{const s=e[i],o=typeof s=="string"?{target:s}:s,a=Number.isNaN(+i)?i:+i,l=t(a);return pl(o).map(c=>({...c,event:l,delay:a}))}).map(i=>{const{delay:s}=i;return{...Xc(n,i.event,i),delay:s}})}function Xc(n,e,t){const r=yL(t.target),i=t.reenter??!1,s=MZ(n,r),o={...t,actions:pl(t.actions),guard:t.guard,target:s,source:n,reenter:i,eventType:e,toJSON:()=>({...o,source:`#${n.id}`,target:s?s.map(a=>`#${a.id}`):void 0})};return o}function PZ(n){const e=new Map;if(n.config.on)for(const t of Object.keys(n.config.on)){if(t===dL)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const r=n.config.on[t];e.set(t,kd(r).map(i=>Xc(n,t,i)))}if(n.config.onDone){const t=`xstate.done.state.${n.id}`;e.set(t,kd(n.config.onDone).map(r=>Xc(n,t,r)))}for(const t of n.invoke){if(t.onDone){const r=`xstate.done.actor.${t.id}`;e.set(r,kd(t.onDone).map(i=>Xc(n,r,i)))}if(t.onError){const r=`xstate.error.actor.${t.id}`;e.set(r,kd(t.onError).map(i=>Xc(n,r,i)))}if(t.onSnapshot){const r=`xstate.snapshot.${t.id}`;e.set(r,kd(t.onSnapshot).map(i=>Xc(n,r,i)))}}for(const t of n.after){let r=e.get(t.eventType);r||(r=[],e.set(t.eventType,r)),r.push(t)}return e}function IZ(n,e){const t=typeof e=="string"?n.states[e]:e?n.states[e.target]:void 0;if(!t&&e)throw new Error(`Initial state node "${e}" not found on parent state node #${n.id}`);const r={source:n,actions:!e||typeof e=="string"?[]:pl(e.actions),eventType:null,reenter:!1,target:t?[t]:[],toJSON:()=>({...r,source:`#${n.id}`,target:t?[`#${t.id}`]:[]})};return r}function MZ(n,e){if(e!==void 0)return e.map(t=>{if(typeof t!="string")return t;if(sb(t))return n.machine.getStateNodeById(t);const r=t[0]===uL;if(r&&!n.parent)return wy(n,t.slice(1));const i=r?n.key+t:t;if(n.parent)try{return wy(n.parent,i)}catch(s){throw new Error(`Invalid transition definition for state node '${n.id}':
${s.message}`)}else throw new Error(`Invalid target: "${t}" is not a valid target from the root node. Did you mean ".${t}"?`)})}function OL(n){const e=yL(n.config.target);return e?{target:e.map(t=>typeof t=="string"?wy(n.parent,t):t)}:n.parent.initial}function eu(n){return n.type==="history"}function NA(n){const e=xL(n);for(const t of e)for(const r of jg(t,n))e.add(r);return e}function xL(n){const e=new Set;function t(r){if(!e.has(r)){if(e.add(r),r.type==="compound")t(r.initial.target[0]);else if(r.type==="parallel")for(const i of Oh(r))t(i)}}return t(n),e}function xh(n,e){if(sb(e))return n.machine.getStateNodeById(e);if(!n.states)throw new Error(`Unable to retrieve child state '${e}' from '${n.id}'; no child states exist.`);const t=n.states[e];if(!t)throw new Error(`Child state '${e}' does not exist on '${n.id}'`);return t}function wy(n,e){if(typeof e=="string"&&sb(e))try{return n.machine.getStateNodeById(e)}catch{}const t=Xk(e).slice();let r=n;for(;t.length;){const i=t.shift();if(!i.length)break;r=xh(r,i)}return r}function _y(n,e){if(typeof e=="string"){const i=n.states[e];if(!i)throw new Error(`State '${e}' does not exist on '${n.id}'`);return[n,i]}const t=Object.keys(e),r=t.map(i=>xh(n,i)).filter(Boolean);return[n.machine.root,n].concat(r,t.reduce((i,s)=>{const o=xh(n,s);if(!o)return i;const a=_y(o,e[s]);return i.concat(a)},[]))}function RZ(n,e,t,r){const s=xh(n,e).next(t,r);return!s||!s.length?n.next(t,r):s}function DZ(n,e,t,r){const i=Object.keys(e),s=xh(n,i[0]),o=nS(s,e[i[0]],t,r);return!o||!o.length?n.next(t,r):o}function NZ(n,e,t,r){const i=[];for(const s of Object.keys(e)){const o=e[s];if(!o)continue;const a=xh(n,s),l=nS(a,o,t,r);l&&i.push(...l)}return i.length?i:n.next(t,r)}function nS(n,e,t,r){return typeof e=="string"?RZ(n,e,t,r):Object.keys(e).length===1?DZ(n,e,t,r):NZ(n,e,t,r)}function LZ(n){return Object.keys(n.states).map(e=>n.states[e]).filter(e=>e.type==="history")}function hc(n,e){let t=n;for(;t.parent&&t.parent!==e;)t=t.parent;return t.parent===e}function QZ(n,e){const t=new Set(n),r=new Set(e);for(const i of t)if(r.has(i))return!0;for(const i of r)if(t.has(i))return!0;return!1}function kL(n,e,t){const r=new Set;for(const i of n){let s=!1;const o=new Set;for(const a of r)if(QZ(X_([i],e,t),X_([a],e,t)))if(hc(i.source,a.source))o.add(a);else{s=!0;break}if(!s){for(const a of o)r.delete(a);r.add(i)}}return Array.from(r)}function $Z(n){const[e,...t]=n;for(const r of jg(e,void 0))if(t.every(i=>hc(i,r)))return r}function rS(n,e){if(!n.target)return[];const t=new Set;for(const r of n.target)if(eu(r))if(e[r.id])for(const i of e[r.id])t.add(i);else for(const i of rS(OL(r),e))t.add(i);else t.add(r);return[...t]}function SL(n,e){const t=rS(n,e);if(!t)return;if(!n.reenter&&t.every(i=>i===n.source||hc(i,n.source)))return n.source;const r=$Z(t.concat(n.source));if(r)return r;if(!n.reenter)return n.source.machine.root}function X_(n,e,t){const r=new Set;for(const i of n)if(i.target?.length){const s=SL(i,t);i.reenter&&i.source===s&&r.add(s);for(const o of e)hc(o,s)&&r.add(o)}return[...r]}function FZ(n,e){if(n.length!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0}function Y_(n,e,t,r,i,s){if(!n.length)return e;const o=new Set(e._nodes);let a=e.historyValue;const l=kL(n,o,a);let c=e;i||([c,a]=jZ(c,r,t,l,o,a,s,t.actionExecutor)),c=kh(c,r,t,l.flatMap(h=>h.actions),s,void 0),c=BZ(c,r,t,l,o,s,a,i);const d=[...o];c.status==="done"&&(c=kh(c,r,t,d.sort((h,f)=>f.order-h.order).flatMap(h=>h.exit),s,void 0));try{return a===e.historyValue&&FZ(e._nodes,o)?c:wu(c,{_nodes:d,historyValue:a})}catch(h){throw h}}function zZ(n,e,t,r,i){if(r.output===void 0)return;const s=H_(i.id,i.output!==void 0&&i.parent?Z_(i.output,n.context,e,t.self):void 0);return Z_(r.output,n.context,s,t.self)}function BZ(n,e,t,r,i,s,o,a){let l=n;const c=new Set,d=new Set;UZ(r,o,d,c),a&&d.add(n.machine.root);const h=new Set;for(const f of[...c].sort((p,g)=>p.order-g.order)){i.add(f);const p=[];p.push(...f.entry);for(const g of f.invoke)p.push(Jk(g.src,{...g,syncSnapshot:!!g.onSnapshot}));if(d.has(f)){const g=f.initial.actions;p.push(...g)}if(l=kh(l,e,t,p,s,f.invoke.map(g=>g.id)),f.type==="final"){const g=f.parent;let m=g?.type==="parallel"?g:g?.parent,v=m||f;for(g?.type==="compound"&&s.push(H_(g.id,f.output!==void 0?Z_(f.output,l.context,e,t.self):void 0));m?.type==="parallel"&&!h.has(m)&&tS(i,m);)h.add(m),s.push(H_(m.id)),v=m,m=m.parent;if(m)continue;l=wu(l,{status:"done",output:zZ(l,e,t,l.machine.root,v)})}}return l}function UZ(n,e,t,r){for(const i of n){const s=SL(i,e);for(const a of i.target||[])!eu(a)&&(i.source!==a||i.source!==s||i.reenter)&&(r.add(a),t.add(a)),Md(a,e,t,r);const o=rS(i,e);for(const a of o){const l=jg(a,s);s?.type==="parallel"&&l.push(s),TL(r,e,t,l,!i.source.parent&&i.reenter?void 0:s)}}}function Md(n,e,t,r){if(eu(n))if(e[n.id]){const i=e[n.id];for(const s of i)r.add(s),Md(s,e,t,r);for(const s of i)gw(s,n.parent,r,e,t)}else{const i=OL(n);for(const s of i.target)r.add(s),i===n.parent?.initial&&t.add(n.parent),Md(s,e,t,r);for(const s of i.target)gw(s,n.parent,r,e,t)}else if(n.type==="compound"){const[i]=n.initial.target;eu(i)||(r.add(i),t.add(i)),Md(i,e,t,r),gw(i,n,r,e,t)}else if(n.type==="parallel")for(const i of Oh(n).filter(s=>!eu(s)))[...r].some(s=>hc(s,i))||(eu(i)||(r.add(i),t.add(i)),Md(i,e,t,r))}function TL(n,e,t,r,i){for(const s of r)if((!i||hc(s,i))&&n.add(s),s.type==="parallel")for(const o of Oh(s).filter(a=>!eu(a)))[...n].some(a=>hc(a,o))||(n.add(o),Md(o,e,t,n))}function gw(n,e,t,r,i){TL(t,r,i,jg(n,e))}function jZ(n,e,t,r,i,s,o,a){let l=n;const c=X_(r,i,s);c.sort((h,f)=>f.order-h.order);let d;for(const h of c)for(const f of LZ(h)){let p;f.history==="deep"?p=g=>eS(g)&&hc(g,h):p=g=>g.parent===h,d??={...s},d[f.id]=Array.from(i).filter(p)}for(const h of c)l=kh(l,e,t,[...h.exit,...h.invoke.map(f=>rb(f.id))],o,void 0),i.delete(h);return[l,d||s]}function VZ(n,e){return n.implementations.actions[e]}function AL(n,e,t,r,i,s){const{machine:o}=n;let a=n;for(const l of r){const c=typeof l=="function",d=c?l:VZ(o,typeof l=="string"?l:l.type),h={context:a.context,event:e,self:t.self,system:t.system},f=c||typeof l=="string"?void 0:"params"in l?typeof l.params=="function"?l.params({context:a.context,event:e}):l.params:void 0;if(!d||!("resolve"in d)){t.actionExecutor({type:typeof l=="string"?l:typeof l=="object"?l.type:l.name||"(anonymous)",info:h,params:f,exec:d});continue}const p=d,[g,m,v]=p.resolve(t,a,h,f,d,i);a=g,"retryResolve"in p&&s?.push([p,m]),"execute"in p&&t.actionExecutor({type:p.type,info:h,params:m,exec:p.execute.bind(null,t,m)}),v&&(a=AL(a,e,t,v,i,s))}return a}function kh(n,e,t,r,i,s){const o=s?[]:void 0,a=AL(n,e,t,r,{internalQueue:i,deferredActorIds:s},o);return o?.forEach(([l,c])=>{l.retryResolve(t,a,c)}),a}function mw(n,e,t,r){let i=n;const s=[];function o(c,d,h){t.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:t.self,event:d,snapshot:c,_transitions:h}),s.push(c)}if(e.type===q_)return i=wu(LA(i,e,t),{status:"stopped"}),o(i,e,[]),{snapshot:i,microstates:s};let a=e;if(a.type!==hL){const c=a,d=vZ(c),h=QA(c,i);if(d&&!h.length)return i=wu(n,{status:"error",error:c.error}),o(i,c,[]),{snapshot:i,microstates:s};i=Y_(h,n,t,a,!1,r),o(i,c,h)}let l=!0;for(;i.status==="active";){let c=l?qZ(i,a):[];const d=c.length?i:void 0;if(!c.length){if(!r.length)break;a=r.shift(),c=QA(a,i)}i=Y_(c,i,t,a,!1,r),l=i!==d,o(i,a,c)}return i.status!=="active"&&LA(i,a,t),{snapshot:i,microstates:s}}function LA(n,e,t){return kh(n,e,t,Object.values(n.children).map(r=>rb(r)),[],void 0)}function QA(n,e){return e.machine.getTransitionData(e,n)}function qZ(n,e){const t=new Set,r=n._nodes.filter(eS);for(const i of r)e:for(const s of[i].concat(jg(i,void 0)))if(s.always){for(const o of s.always)if(o.guard===void 0||ib(o.guard,n.context,e,n)){t.add(o);break e}}return kL(Array.from(t),new Set(n._nodes),n.historyValue)}function HZ(n,e){const t=by(_y(n,e));return _L(n,[...t])}function ZZ(n){return!!n&&typeof n=="object"&&"machine"in n&&"value"in n}const WZ=function(e){return gL(e,this.value)},XZ=function(e){return this.tags.has(e)},YZ=function(e){const t=this.machine.getTransitionData(this,e);return!!t?.length&&t.some(r=>r.target!==void 0||r.actions.length)},GZ=function(){const{_nodes:e,tags:t,machine:r,getMeta:i,toJSON:s,can:o,hasTag:a,matches:l,...c}=this;return{...c,tags:Array.from(t)}},KZ=function(){return this._nodes.reduce((e,t)=>(t.meta!==void 0&&(e[t.id]=t.meta),e),{})};function Lv(n,e){return{status:n.status,output:n.output,error:n.error,machine:e,context:n.context,_nodes:n._nodes,value:_L(e.root,n._nodes),tags:new Set(n._nodes.flatMap(t=>t.tags)),children:n.children,historyValue:n.historyValue||{},matches:WZ,hasTag:XZ,can:YZ,getMeta:KZ,toJSON:GZ}}function wu(n,e={}){return Lv({...n,...e},n.machine)}function JZ(n){if(typeof n!="object"||n===null)return{};const e={};for(const t in n){const r=n[t];Array.isArray(r)&&(e[t]=r.map(i=>({id:i.id})))}return e}function eW(n,e){const{_nodes:t,tags:r,machine:i,children:s,context:o,can:a,hasTag:l,matches:c,getMeta:d,toJSON:h,...f}=n,p={};for(const m in s){const v=s[m];p[m]={snapshot:v.getPersistedSnapshot(e),src:v.src,systemId:v.systemId,syncSnapshot:v._syncSnapshot}}return{...f,context:CL(o),children:p,historyValue:JZ(f.historyValue)}}function CL(n){let e;for(const t in n){const r=n[t];if(r&&typeof r=="object")if("sessionId"in r&&"send"in r&&"ref"in r)e??=Array.isArray(n)?n.slice():{...n},e[t]={xstate$$type:Gk,id:r.id};else{const i=CL(r);i!==r&&(e??=Array.isArray(n)?n.slice():{...n},e[t]=i)}}return e??n}function tW(n,e,t,r,{event:i,id:s,delay:o},{internalQueue:a}){const l=e.machine.implementations.delays;if(typeof i=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${i}" }) instead`);const c=typeof i=="function"?i(t,r):i;let d;if(typeof o=="string"){const h=l&&l[o];d=typeof h=="function"?h(t,r):h}else d=typeof o=="function"?o(t,r):o;return typeof d!="number"&&a.push(c),[e,{event:c,id:s,delay:d},void 0]}function nW(n,e){const{event:t,delay:r,id:i}=e;if(typeof r=="number"){n.defer(()=>{const s=n.self;n.system.scheduler.schedule(s,s,t,r,i)});return}}function iS(n,e){function t(r,i){}return t.type="xstate.raise",t.event=n,t.id=e?.id,t.delay=e?.delay,t.resolve=tW,t.execute=nW,t}function rW(n,{machine:e,context:t},r,i){const s=(o,a)=>{if(typeof o=="string"){const l=Yk(e,o);if(!l)throw new Error(`Actor logic '${o}' not implemented in machine '${e.id}'`);const c=Fp(l,{id:a?.id,parent:n.self,syncSnapshot:a?.syncSnapshot,input:typeof a?.input=="function"?a.input({context:t,event:r,self:n.self}):a?.input,src:o,systemId:a?.systemId});return i[c.id]=c,c}else return Fp(o,{id:a?.id,parent:n.self,syncSnapshot:a?.syncSnapshot,input:a?.input,src:o,systemId:a?.systemId})};return(o,a)=>{const l=s(o,a);return i[l.id]=l,n.defer(()=>{l._processingStatus!==Yi.Stopped&&l.start()}),l}}function iW(n,e,t,r,{assignment:i}){if(!e.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const s={},o={context:e.context,event:t.event,spawn:rW(n,e,t.event,s),self:n.self,system:n.system};let a={};if(typeof i=="function")a=i(o,r);else for(const c of Object.keys(i)){const d=i[c];a[c]=typeof d=="function"?d(o,r):d}const l=Object.assign({},e.context,a);return[wu(e,{context:l,children:Object.keys(s).length?{...e.children,...s}:e.children}),void 0,void 0]}function tu(n){function e(t,r){}return e.type="xstate.assign",e.assignment=n,e.resolve=iW,e}const $A=new WeakMap;function hd(n,e,t){let r=$A.get(n);return r?e in r||(r[e]=t()):(r={[e]:t()},$A.set(n,r)),r[e]}const sW={},gf=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class Oy{constructor(e,t){if(this.config=e,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=t._parent,this.key=t._key,this.machine=t._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(uL),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?MA(this.config.states,(r,i)=>new Oy(r,{_parent:this,_key:i,_machine:this.machine})):sW,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=pl(this.config.entry).slice(),this.exit=pl(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=pl(e.tags).slice()}_initialize(){this.transitions=PZ(this),this.config.always&&(this.always=kd(this.config.always).map(e=>Xc(this,dL,e))),Object.keys(this.states).forEach(e=>{this.states[e]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(gf),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(e=>`#${e.id}`),source:`#${this.id}`,actions:this.initial.actions.map(gf),eventType:null})}:void 0,history:this.history,states:MA(this.states,e=>e.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(e=>({...e,actions:e.actions.map(gf)})),entry:this.entry.map(gf),exit:this.exit.map(gf),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return hd(this,"invoke",()=>pl(this.config.invoke).map((e,t)=>{const{src:r,systemId:i}=e,s=e.id??RA(this.id,t),o=typeof r=="string"?r:`xstate.invoke.${RA(this.id,t)}`;return{...e,src:o,id:s,systemId:i,toJSON(){const{onDone:a,onError:l,...c}=e;return{...c,type:"xstate.invoke",src:o,id:s}}}}))}get on(){return hd(this,"on",()=>[...this.transitions].flatMap(([t,r])=>r.map(i=>[t,i])).reduce((t,[r,i])=>(t[r]=t[r]||[],t[r].push(i),t),{}))}get after(){return hd(this,"delayedTransitions",()=>EZ(this))}get initial(){return hd(this,"initial",()=>IZ(this,this.config.initial))}next(e,t){const r=t.type,i=[];let s;const o=hd(this,`candidates-${r}`,()=>CZ(this,r));for(const a of o){const{guard:l}=a,c=e.context;let d=!1;try{d=!l||ib(l,c,t,e)}catch(h){const f=typeof l=="string"?l:typeof l=="object"?l.type:void 0;throw new Error(`Unable to evaluate guard ${f?`'${f}' `:""}in transition for event '${r}' in state node '${this.id}':
${h.message}`)}if(d){i.push(...a.actions),s=a;break}}return s?[s]:void 0}get events(){return hd(this,"events",()=>{const{states:e}=this,t=new Set(this.ownEvents);if(e)for(const r of Object.keys(e)){const i=e[r];if(i.states)for(const s of i.events)t.add(`${s}`)}return Array.from(t)})}get ownEvents(){const e=new Set([...this.transitions.keys()].filter(t=>this.transitions.get(t).some(r=>!(!r.target&&!r.actions.length&&!r.reenter))));return Array.from(e)}}const oW="#";class sS{constructor(e,t){this.config=e,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=e.id||"(machine)",this.implementations={actors:t?.actors??{},actions:t?.actions??{},delays:t?.delays??{},guards:t?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new Oy(e,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(e){const{actions:t,guards:r,actors:i,delays:s}=this.implementations;return new sS(this.config,{actions:{...t,...e.actions},guards:{...r,...e.guards},actors:{...i,...e.actors},delays:{...s,...e.delays}})}resolveState(e){const t=HZ(this.root,e.value),r=by(_y(this.root,t));return Lv({_nodes:[...r],context:e.context||{},children:{},status:tS(r,this.root)?"done":e.status||"active",output:e.output,error:e.error,historyValue:e.historyValue},this)}transition(e,t,r){return mw(e,t,r,[]).snapshot}microstep(e,t,r){return mw(e,t,r,[]).microstates}getTransitionData(e,t){return nS(this.root,e.value,e,t)||[]}getPreInitialState(e,t,r){const{context:i}=this.config,s=Lv({context:typeof i!="function"&&i?i:{},_nodes:[this.root],children:{},status:"active"},this);return typeof i=="function"?kh(s,t,e,[tu(({spawn:a,event:l,self:c})=>i({spawn:a,input:l.input,self:c}))],r,void 0):s}getInitialSnapshot(e,t){const r=pL(t),i=[],s=this.getPreInitialState(e,r,i),o=Y_([{target:[...xL(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],s,e,r,!0,i),{snapshot:a}=mw(o,r,e,i);return a}start(e){Object.values(e.children).forEach(t=>{t.getSnapshot().status==="active"&&t.start()})}getStateNodeById(e){const t=Xk(e),r=t.slice(1),i=sb(t[0])?t[0].slice(oW.length):t[0],s=this.idMap.get(i);if(!s)throw new Error(`Child state node '#${i}' does not exist on machine '${this.id}'`);return wy(s,r)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(e,t){return eW(e,t)}restoreSnapshot(e,t){const r={},i=e.children;Object.keys(i).forEach(h=>{const f=i[h],p=f.snapshot,g=f.src,m=typeof g=="string"?Yk(this,g):g;if(!m)return;const v=Fp(m,{id:h,parent:t.self,syncSnapshot:f.syncSnapshot,snapshot:p,src:g,systemId:f.systemId});r[h]=v});function s(h,f){if(f instanceof Oy)return f;try{return h.machine.getStateNodeById(f.id)}catch{}}function o(h,f){if(!f||typeof f!="object")return{};const p={};for(const g in f){const m=f[g];for(const v of m){const y=s(h,v);y&&(p[g]??=[],p[g].push(y))}}return p}const a=o(this.root,e.historyValue),l=Lv({...e,children:r,_nodes:Array.from(by(_y(this.root,e.value))),historyValue:a},this),c=new Set;function d(h,f){if(!c.has(h)){c.add(h);for(const p in h){const g=h[p];if(g&&typeof g=="object"){if("xstate$$type"in g&&g.xstate$$type===Gk){h[p]=f[g.id];continue}d(g,f)}}}}return d(l.context,r),l}}function aW(n,e,t,r,{event:i}){const s=typeof i=="function"?i(t,r):i;return[e,{event:s},void 0]}function lW(n,{event:e}){n.defer(()=>n.emit(e))}function EL(n){function e(t,r){}return e.type="xstate.emit",e.event=n,e.resolve=aW,e.execute=lW,e}let G_=(function(n){return n.Parent="#_parent",n.Internal="#_internal",n})({});function cW(n,e,t,r,{to:i,event:s,id:o,delay:a},l){const c=e.machine.implementations.delays;if(typeof s=="string")throw new Error(`Only event objects may be used with sendTo; use sendTo({ type: "${s}" }) instead`);const d=typeof s=="function"?s(t,r):s;let h;if(typeof a=="string"){const g=c&&c[a];h=typeof g=="function"?g(t,r):g}else h=typeof a=="function"?a(t,r):a;const f=typeof i=="function"?i(t,r):i;let p;if(typeof f=="string"){if(f===G_.Parent?p=n.self._parent:f===G_.Internal?p=n.self:f.startsWith("#_")?p=e.children[f.slice(2)]:p=l.deferredActorIds?.includes(f)?f:e.children[f],!p)throw new Error(`Unable to send event to actor '${f}' from machine '${e.machine.id}'.`)}else p=f||n.self;return[e,{to:p,targetId:typeof f=="string"?f:void 0,event:d,id:o,delay:h},void 0]}function uW(n,e,t){typeof t.to=="string"&&(t.to=e.children[t.to])}function dW(n,e){n.defer(()=>{const{to:t,event:r,delay:i,id:s}=e;if(typeof i=="number"){n.system.scheduler.schedule(n.self,t,r,i,s);return}n.system._relay(n.self,t,r.type===hZ?fL(n.self.id,r.data):r)})}function oS(n,e,t){function r(i,s){}return r.type="xstate.sendTo",r.to=n,r.event=e,r.id=t?.id,r.delay=t?.delay,r.resolve=cW,r.retryResolve=uW,r.execute=dW,r}function hW(n,e){return oS(G_.Parent,n,e)}function fW(n,e,t,r,{collect:i}){const s=[],o=function(l){s.push(l)};return o.assign=(...a)=>{s.push(tu(...a))},o.cancel=(...a)=>{s.push(Kk(...a))},o.raise=(...a)=>{s.push(iS(...a))},o.sendTo=(...a)=>{s.push(oS(...a))},o.sendParent=(...a)=>{s.push(hW(...a))},o.spawnChild=(...a)=>{s.push(Jk(...a))},o.stopChild=(...a)=>{s.push(rb(...a))},o.emit=(...a)=>{s.push(EL(...a))},i({context:t.context,event:t.event,enqueue:o,check:a=>ib(a,e.context,t.event,e),self:n.self,system:n.system},r),[e,void 0,s]}function pW(n){function e(t,r){}return e.type="xstate.enqueueActions",e.collect=n,e.resolve=fW,e}function gW(n,e,t,r,{value:i,label:s}){return[e,{value:typeof i=="function"?i(t,r):i,label:s},void 0]}function mW({logger:n},{value:e,label:t}){t?n(t,e):n(e)}function vW(n=({context:t,event:r})=>({context:t,event:r}),e){function t(r,i){}return t.type="xstate.log",t.value=n,t.label=e,t.resolve=gW,t.execute=mW,t}function yW(n,e){const t=pl(e);if(!t.includes(n.type)){const r=t.length===1?`type "${t[0]}"`:`one of types "${t.join('", "')}"`;throw new Error(`Expected event ${JSON.stringify(n)} to have ${r}`)}}function bW(n,e){return new sS(n,e)}function PL({schemas:n,actors:e,actions:t,guards:r,delays:i}){return{assign:tu,sendTo:oS,raise:iS,log:vW,cancel:Kk,stopChild:rb,enqueueActions:pW,emit:EL,spawnChild:Jk,createStateConfig:s=>s,createAction:s=>s,createMachine:s=>bW({...s,schemas:n},{actors:e,actions:t,guards:r,delays:i}),extend:s=>PL({schemas:n,actors:e,actions:{...t,...s.actions},guards:{...r,...s.guards},delays:{...i,...s.delays}})}}const wW={timeout:1/0};function _W(n,e,t){const r={...wW,...t};return new Promise((i,s)=>{const{signal:o}=r;if(o?.aborted){s(o.reason);return}let a=!1;const l=r.timeout===1/0?void 0:setTimeout(()=>{c(),s(new Error(`Timeout of ${r.timeout} ms exceeded`))},r.timeout),c=()=>{clearTimeout(l),a=!0,f?.unsubscribe(),h&&o.removeEventListener("abort",h)};function d(p){e(p)&&(c(),i(p))}let h,f;d(n.getSnapshot()),!a&&(o&&(h=()=>{c(),s(o.reason)},o.addEventListener("abort",h)),f=n.subscribe({next:d,error:p=>{c(),s(p)},complete:()=>{c(),s(new Error("Actor terminated without satisfying predicate"))}}),a&&f.unsubscribe())})}let Mm;const OW=new Uint8Array(16);function xW(){if(!Mm&&(Mm=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Mm))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mm(OW)}const kW=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function IL(n){return typeof n=="string"&&kW.test(n)}const Jr=[];for(let n=0;n<256;++n)Jr.push((n+256).toString(16).slice(1));function SW(n,e=0){return Jr[n[e+0]]+Jr[n[e+1]]+Jr[n[e+2]]+Jr[n[e+3]]+"-"+Jr[n[e+4]]+Jr[n[e+5]]+"-"+Jr[n[e+6]]+Jr[n[e+7]]+"-"+Jr[n[e+8]]+Jr[n[e+9]]+"-"+Jr[n[e+10]]+Jr[n[e+11]]+Jr[n[e+12]]+Jr[n[e+13]]+Jr[n[e+14]]+Jr[n[e+15]]}function TW(n){if(!IL(n))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}const AW=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),FA={randomUUID:AW};function ML(n,e,t){if(FA.randomUUID&&!e&&!n)return FA.randomUUID();n=n||{};const r=n.random||(n.rng||xW)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return SW(r)}var Co={},Gn={},vi={},vw={},mf={},zA;function CW(){return zA||(zA=1,Object.defineProperty(mf,"__esModule",{value:!0}),mf.crypto=void 0,mf.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0),mf}var BA;function RL(){return BA||(BA=1,(function(n){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(n,"__esModule",{value:!0}),n.wrapXOFConstructorWithOpts=n.wrapConstructorWithOpts=n.wrapConstructor=n.Hash=n.nextTick=n.swap32IfBE=n.byteSwapIfBE=n.swap8IfBE=n.isLE=void 0,n.isBytes=t,n.anumber=r,n.abytes=i,n.ahash=s,n.aexists=o,n.aoutput=a,n.u8=l,n.u32=c,n.clean=d,n.createView=h,n.rotr=f,n.rotl=p,n.byteSwap=g,n.byteSwap32=m,n.bytesToHex=O,n.hexToBytes=k,n.asyncLoop=E,n.utf8ToBytes=R,n.bytesToUtf8=C,n.toBytes=I,n.kdfInputToBytes=D,n.concatBytes=Q,n.checkOpts=M,n.createHasher=B,n.createOptHasher=H,n.createXOFer=F,n.randomBytes=Z;const e=CW();function t($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function r($){if(!Number.isSafeInteger($)||$<0)throw new Error("positive integer expected, got "+$)}function i($,...W){if(!t($))throw new Error("Uint8Array expected");if(W.length>0&&!W.includes($.length))throw new Error("Uint8Array expected of length "+W+", got length="+$.length)}function s($){if(typeof $!="function"||typeof $.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");r($.outputLen),r($.blockLen)}function o($,W=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(W&&$.finished)throw new Error("Hash#digest() has already been called")}function a($,W){i($);const G=W.outputLen;if($.length<G)throw new Error("digestInto() expects output buffer of length at least "+G)}function l($){return new Uint8Array($.buffer,$.byteOffset,$.byteLength)}function c($){return new Uint32Array($.buffer,$.byteOffset,Math.floor($.byteLength/4))}function d(...$){for(let W=0;W<$.length;W++)$[W].fill(0)}function h($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function f($,W){return $<<32-W|$>>>W}function p($,W){return $<<W|$>>>32-W>>>0}n.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function g($){return $<<24&4278190080|$<<8&16711680|$>>>8&65280|$>>>24&255}n.swap8IfBE=n.isLE?$=>$:$=>g($),n.byteSwapIfBE=n.swap8IfBE;function m($){for(let W=0;W<$.length;W++)$[W]=g($[W]);return $}n.swap32IfBE=n.isLE?$=>$:m;const v=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",y=Array.from({length:256},($,W)=>W.toString(16).padStart(2,"0"));function O($){if(i($),v)return $.toHex();let W="";for(let G=0;G<$.length;G++)W+=y[$[G]];return W}const _={_0:48,_9:57,A:65,F:70,a:97,f:102};function x($){if($>=_._0&&$<=_._9)return $-_._0;if($>=_.A&&$<=_.F)return $-(_.A-10);if($>=_.a&&$<=_.f)return $-(_.a-10)}function k($){if(typeof $!="string")throw new Error("hex string expected, got "+typeof $);if(v)return Uint8Array.fromHex($);const W=$.length,G=W/2;if(W%2)throw new Error("hex string expected, got unpadded hex of length "+W);const L=new Uint8Array(G);for(let q=0,ue=0;q<G;q++,ue+=2){const oe=x($.charCodeAt(ue)),fe=x($.charCodeAt(ue+1));if(oe===void 0||fe===void 0){const be=$[ue]+$[ue+1];throw new Error('hex string expected, got non-hex character "'+be+'" at index '+ue)}L[q]=oe*16+fe}return L}const S=async()=>{};n.nextTick=S;async function E($,W,G){let L=Date.now();for(let q=0;q<$;q++){G(q);const ue=Date.now()-L;ue>=0&&ue<W||(await(0,n.nextTick)(),L+=ue)}}function R($){if(typeof $!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode($))}function C($){return new TextDecoder().decode($)}function I($){return typeof $=="string"&&($=R($)),i($),$}function D($){return typeof $=="string"&&($=R($)),i($),$}function Q(...$){let W=0;for(let L=0;L<$.length;L++){const q=$[L];i(q),W+=q.length}const G=new Uint8Array(W);for(let L=0,q=0;L<$.length;L++){const ue=$[L];G.set(ue,q),q+=ue.length}return G}function M($,W){if(W!==void 0&&{}.toString.call(W)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign($,W)}class N{}n.Hash=N;function B($){const W=L=>$().update(I(L)).digest(),G=$();return W.outputLen=G.outputLen,W.blockLen=G.blockLen,W.create=()=>$(),W}function H($){const W=(L,q)=>$(q).update(I(L)).digest(),G=$({});return W.outputLen=G.outputLen,W.blockLen=G.blockLen,W.create=L=>$(L),W}function F($){const W=(L,q)=>$(q).update(I(L)).digest(),G=$({});return W.outputLen=G.outputLen,W.blockLen=G.blockLen,W.create=L=>$(L),W}n.wrapConstructor=B,n.wrapConstructorWithOpts=H,n.wrapXOFConstructorWithOpts=F;function Z($=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array($));if(e.crypto&&typeof e.crypto.randomBytes=="function")return Uint8Array.from(e.crypto.randomBytes($));throw new Error("crypto.getRandomValues must be defined")}})(vw)),vw}var UA;function EW(){if(UA)return vi;UA=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.SHA512_IV=vi.SHA384_IV=vi.SHA224_IV=vi.SHA256_IV=vi.HashMD=void 0,vi.setBigUint64=e,vi.Chi=t,vi.Maj=r;const n=RL();function e(s,o,a,l){if(typeof s.setBigUint64=="function")return s.setBigUint64(o,a,l);const c=BigInt(32),d=BigInt(4294967295),h=Number(a>>c&d),f=Number(a&d),p=l?4:0,g=l?0:4;s.setUint32(o+p,h,l),s.setUint32(o+g,f,l)}function t(s,o,a){return s&o^~s&a}function r(s,o,a){return s&o^s&a^o&a}class i extends n.Hash{constructor(o,a,l,c){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=o,this.outputLen=a,this.padOffset=l,this.isLE=c,this.buffer=new Uint8Array(o),this.view=(0,n.createView)(this.buffer)}update(o){(0,n.aexists)(this),o=(0,n.toBytes)(o),(0,n.abytes)(o);const{view:a,buffer:l,blockLen:c}=this,d=o.length;for(let h=0;h<d;){const f=Math.min(c-this.pos,d-h);if(f===c){const p=(0,n.createView)(o);for(;c<=d-h;h+=c)this.process(p,h);continue}l.set(o.subarray(h,h+f),this.pos),this.pos+=f,h+=f,this.pos===c&&(this.process(a,0),this.pos=0)}return this.length+=o.length,this.roundClean(),this}digestInto(o){(0,n.aexists)(this),(0,n.aoutput)(o,this),this.finished=!0;const{buffer:a,view:l,blockLen:c,isLE:d}=this;let{pos:h}=this;a[h++]=128,(0,n.clean)(this.buffer.subarray(h)),this.padOffset>c-h&&(this.process(l,0),h=0);for(let v=h;v<c;v++)a[v]=0;e(l,c-8,BigInt(this.length*8),d),this.process(l,0);const f=(0,n.createView)(o),p=this.outputLen;if(p%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=p/4,m=this.get();if(g>m.length)throw new Error("_sha2: outputLen bigger than state");for(let v=0;v<g;v++)f.setUint32(4*v,m[v],d)}digest(){const{buffer:o,outputLen:a}=this;this.digestInto(o);const l=o.slice(0,a);return this.destroy(),l}_cloneInto(o){o||(o=new this.constructor),o.set(...this.get());const{blockLen:a,buffer:l,length:c,finished:d,destroyed:h,pos:f}=this;return o.destroyed=h,o.finished=d,o.length=c,o.pos=f,c%a&&o.buffer.set(l),o}clone(){return this._cloneInto()}}return vi.HashMD=i,vi.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),vi.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),vi.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),vi.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),vi}var nn={},jA;function PW(){if(jA)return nn;jA=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.toBig=nn.shrSL=nn.shrSH=nn.rotrSL=nn.rotrSH=nn.rotrBL=nn.rotrBH=nn.rotr32L=nn.rotr32H=nn.rotlSL=nn.rotlSH=nn.rotlBL=nn.rotlBH=nn.add5L=nn.add5H=nn.add4L=nn.add4H=nn.add3L=nn.add3H=void 0,nn.add=y,nn.fromBig=t,nn.split=r;const n=BigInt(2**32-1),e=BigInt(32);function t(C,I=!1){return I?{h:Number(C&n),l:Number(C>>e&n)}:{h:Number(C>>e&n)|0,l:Number(C&n)|0}}function r(C,I=!1){const D=C.length;let Q=new Uint32Array(D),M=new Uint32Array(D);for(let N=0;N<D;N++){const{h:B,l:H}=t(C[N],I);[Q[N],M[N]]=[B,H]}return[Q,M]}const i=(C,I)=>BigInt(C>>>0)<<e|BigInt(I>>>0);nn.toBig=i;const s=(C,I,D)=>C>>>D;nn.shrSH=s;const o=(C,I,D)=>C<<32-D|I>>>D;nn.shrSL=o;const a=(C,I,D)=>C>>>D|I<<32-D;nn.rotrSH=a;const l=(C,I,D)=>C<<32-D|I>>>D;nn.rotrSL=l;const c=(C,I,D)=>C<<64-D|I>>>D-32;nn.rotrBH=c;const d=(C,I,D)=>C>>>D-32|I<<64-D;nn.rotrBL=d;const h=(C,I)=>I;nn.rotr32H=h;const f=(C,I)=>C;nn.rotr32L=f;const p=(C,I,D)=>C<<D|I>>>32-D;nn.rotlSH=p;const g=(C,I,D)=>I<<D|C>>>32-D;nn.rotlSL=g;const m=(C,I,D)=>I<<D-32|C>>>64-D;nn.rotlBH=m;const v=(C,I,D)=>C<<D-32|I>>>64-D;nn.rotlBL=v;function y(C,I,D,Q){const M=(I>>>0)+(Q>>>0);return{h:C+D+(M/2**32|0)|0,l:M|0}}const O=(C,I,D)=>(C>>>0)+(I>>>0)+(D>>>0);nn.add3L=O;const _=(C,I,D,Q)=>I+D+Q+(C/2**32|0)|0;nn.add3H=_;const x=(C,I,D,Q)=>(C>>>0)+(I>>>0)+(D>>>0)+(Q>>>0);nn.add4L=x;const k=(C,I,D,Q,M)=>I+D+Q+M+(C/2**32|0)|0;nn.add4H=k;const S=(C,I,D,Q,M)=>(C>>>0)+(I>>>0)+(D>>>0)+(Q>>>0)+(M>>>0);nn.add5L=S;const E=(C,I,D,Q,M,N)=>I+D+Q+M+N+(C/2**32|0)|0;nn.add5H=E;const R={fromBig:t,split:r,toBig:i,shrSH:s,shrSL:o,rotrSH:a,rotrSL:l,rotrBH:c,rotrBL:d,rotr32H:h,rotr32L:f,rotlSH:p,rotlSL:g,rotlBH:m,rotlBL:v,add:y,add3L:O,add3H:_,add4L:x,add4H:k,add5H:E,add5L:S};return nn.default=R,nn}var VA;function IW(){if(VA)return Gn;VA=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.sha512_224=Gn.sha512_256=Gn.sha384=Gn.sha512=Gn.sha224=Gn.sha256=Gn.SHA512_256=Gn.SHA512_224=Gn.SHA384=Gn.SHA512=Gn.SHA224=Gn.SHA256=void 0;const n=EW(),e=PW(),t=RL(),r=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),i=new Uint32Array(64);class s extends n.HashMD{constructor(_=32){super(64,_,8,!1),this.A=n.SHA256_IV[0]|0,this.B=n.SHA256_IV[1]|0,this.C=n.SHA256_IV[2]|0,this.D=n.SHA256_IV[3]|0,this.E=n.SHA256_IV[4]|0,this.F=n.SHA256_IV[5]|0,this.G=n.SHA256_IV[6]|0,this.H=n.SHA256_IV[7]|0}get(){const{A:_,B:x,C:k,D:S,E,F:R,G:C,H:I}=this;return[_,x,k,S,E,R,C,I]}set(_,x,k,S,E,R,C,I){this.A=_|0,this.B=x|0,this.C=k|0,this.D=S|0,this.E=E|0,this.F=R|0,this.G=C|0,this.H=I|0}process(_,x){for(let M=0;M<16;M++,x+=4)i[M]=_.getUint32(x,!1);for(let M=16;M<64;M++){const N=i[M-15],B=i[M-2],H=(0,t.rotr)(N,7)^(0,t.rotr)(N,18)^N>>>3,F=(0,t.rotr)(B,17)^(0,t.rotr)(B,19)^B>>>10;i[M]=F+i[M-7]+H+i[M-16]|0}let{A:k,B:S,C:E,D:R,E:C,F:I,G:D,H:Q}=this;for(let M=0;M<64;M++){const N=(0,t.rotr)(C,6)^(0,t.rotr)(C,11)^(0,t.rotr)(C,25),B=Q+N+(0,n.Chi)(C,I,D)+r[M]+i[M]|0,F=((0,t.rotr)(k,2)^(0,t.rotr)(k,13)^(0,t.rotr)(k,22))+(0,n.Maj)(k,S,E)|0;Q=D,D=I,I=C,C=R+B|0,R=E,E=S,S=k,k=B+F|0}k=k+this.A|0,S=S+this.B|0,E=E+this.C|0,R=R+this.D|0,C=C+this.E|0,I=I+this.F|0,D=D+this.G|0,Q=Q+this.H|0,this.set(k,S,E,R,C,I,D,Q)}roundClean(){(0,t.clean)(i)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,t.clean)(this.buffer)}}Gn.SHA256=s;class o extends s{constructor(){super(28),this.A=n.SHA224_IV[0]|0,this.B=n.SHA224_IV[1]|0,this.C=n.SHA224_IV[2]|0,this.D=n.SHA224_IV[3]|0,this.E=n.SHA224_IV[4]|0,this.F=n.SHA224_IV[5]|0,this.G=n.SHA224_IV[6]|0,this.H=n.SHA224_IV[7]|0}}Gn.SHA224=o;const a=e.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(O=>BigInt(O))),l=a[0],c=a[1],d=new Uint32Array(80),h=new Uint32Array(80);class f extends n.HashMD{constructor(_=64){super(128,_,16,!1),this.Ah=n.SHA512_IV[0]|0,this.Al=n.SHA512_IV[1]|0,this.Bh=n.SHA512_IV[2]|0,this.Bl=n.SHA512_IV[3]|0,this.Ch=n.SHA512_IV[4]|0,this.Cl=n.SHA512_IV[5]|0,this.Dh=n.SHA512_IV[6]|0,this.Dl=n.SHA512_IV[7]|0,this.Eh=n.SHA512_IV[8]|0,this.El=n.SHA512_IV[9]|0,this.Fh=n.SHA512_IV[10]|0,this.Fl=n.SHA512_IV[11]|0,this.Gh=n.SHA512_IV[12]|0,this.Gl=n.SHA512_IV[13]|0,this.Hh=n.SHA512_IV[14]|0,this.Hl=n.SHA512_IV[15]|0}get(){const{Ah:_,Al:x,Bh:k,Bl:S,Ch:E,Cl:R,Dh:C,Dl:I,Eh:D,El:Q,Fh:M,Fl:N,Gh:B,Gl:H,Hh:F,Hl:Z}=this;return[_,x,k,S,E,R,C,I,D,Q,M,N,B,H,F,Z]}set(_,x,k,S,E,R,C,I,D,Q,M,N,B,H,F,Z){this.Ah=_|0,this.Al=x|0,this.Bh=k|0,this.Bl=S|0,this.Ch=E|0,this.Cl=R|0,this.Dh=C|0,this.Dl=I|0,this.Eh=D|0,this.El=Q|0,this.Fh=M|0,this.Fl=N|0,this.Gh=B|0,this.Gl=H|0,this.Hh=F|0,this.Hl=Z|0}process(_,x){for(let G=0;G<16;G++,x+=4)d[G]=_.getUint32(x),h[G]=_.getUint32(x+=4);for(let G=16;G<80;G++){const L=d[G-15]|0,q=h[G-15]|0,ue=e.rotrSH(L,q,1)^e.rotrSH(L,q,8)^e.shrSH(L,q,7),oe=e.rotrSL(L,q,1)^e.rotrSL(L,q,8)^e.shrSL(L,q,7),fe=d[G-2]|0,be=h[G-2]|0,De=e.rotrSH(fe,be,19)^e.rotrBH(fe,be,61)^e.shrSH(fe,be,6),Le=e.rotrSL(fe,be,19)^e.rotrBL(fe,be,61)^e.shrSL(fe,be,6),he=e.add4L(oe,Le,h[G-7],h[G-16]),se=e.add4H(he,ue,De,d[G-7],d[G-16]);d[G]=se|0,h[G]=he|0}let{Ah:k,Al:S,Bh:E,Bl:R,Ch:C,Cl:I,Dh:D,Dl:Q,Eh:M,El:N,Fh:B,Fl:H,Gh:F,Gl:Z,Hh:$,Hl:W}=this;for(let G=0;G<80;G++){const L=e.rotrSH(M,N,14)^e.rotrSH(M,N,18)^e.rotrBH(M,N,41),q=e.rotrSL(M,N,14)^e.rotrSL(M,N,18)^e.rotrBL(M,N,41),ue=M&B^~M&F,oe=N&H^~N&Z,fe=e.add5L(W,q,oe,c[G],h[G]),be=e.add5H(fe,$,L,ue,l[G],d[G]),De=fe|0,Le=e.rotrSH(k,S,28)^e.rotrBH(k,S,34)^e.rotrBH(k,S,39),he=e.rotrSL(k,S,28)^e.rotrBL(k,S,34)^e.rotrBL(k,S,39),se=k&E^k&C^E&C,V=S&R^S&I^R&I;$=F|0,W=Z|0,F=B|0,Z=H|0,B=M|0,H=N|0,{h:M,l:N}=e.add(D|0,Q|0,be|0,De|0),D=C|0,Q=I|0,C=E|0,I=R|0,E=k|0,R=S|0;const ne=e.add3L(De,he,V);k=e.add3H(ne,be,Le,se),S=ne|0}({h:k,l:S}=e.add(this.Ah|0,this.Al|0,k|0,S|0)),{h:E,l:R}=e.add(this.Bh|0,this.Bl|0,E|0,R|0),{h:C,l:I}=e.add(this.Ch|0,this.Cl|0,C|0,I|0),{h:D,l:Q}=e.add(this.Dh|0,this.Dl|0,D|0,Q|0),{h:M,l:N}=e.add(this.Eh|0,this.El|0,M|0,N|0),{h:B,l:H}=e.add(this.Fh|0,this.Fl|0,B|0,H|0),{h:F,l:Z}=e.add(this.Gh|0,this.Gl|0,F|0,Z|0),{h:$,l:W}=e.add(this.Hh|0,this.Hl|0,$|0,W|0),this.set(k,S,E,R,C,I,D,Q,M,N,B,H,F,Z,$,W)}roundClean(){(0,t.clean)(d,h)}destroy(){(0,t.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}Gn.SHA512=f;class p extends f{constructor(){super(48),this.Ah=n.SHA384_IV[0]|0,this.Al=n.SHA384_IV[1]|0,this.Bh=n.SHA384_IV[2]|0,this.Bl=n.SHA384_IV[3]|0,this.Ch=n.SHA384_IV[4]|0,this.Cl=n.SHA384_IV[5]|0,this.Dh=n.SHA384_IV[6]|0,this.Dl=n.SHA384_IV[7]|0,this.Eh=n.SHA384_IV[8]|0,this.El=n.SHA384_IV[9]|0,this.Fh=n.SHA384_IV[10]|0,this.Fl=n.SHA384_IV[11]|0,this.Gh=n.SHA384_IV[12]|0,this.Gl=n.SHA384_IV[13]|0,this.Hh=n.SHA384_IV[14]|0,this.Hl=n.SHA384_IV[15]|0}}Gn.SHA384=p;const g=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),m=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class v extends f{constructor(){super(28),this.Ah=g[0]|0,this.Al=g[1]|0,this.Bh=g[2]|0,this.Bl=g[3]|0,this.Ch=g[4]|0,this.Cl=g[5]|0,this.Dh=g[6]|0,this.Dl=g[7]|0,this.Eh=g[8]|0,this.El=g[9]|0,this.Fh=g[10]|0,this.Fl=g[11]|0,this.Gh=g[12]|0,this.Gl=g[13]|0,this.Hh=g[14]|0,this.Hl=g[15]|0}}Gn.SHA512_224=v;class y extends f{constructor(){super(32),this.Ah=m[0]|0,this.Al=m[1]|0,this.Bh=m[2]|0,this.Bl=m[3]|0,this.Ch=m[4]|0,this.Cl=m[5]|0,this.Dh=m[6]|0,this.Dl=m[7]|0,this.Eh=m[8]|0,this.El=m[9]|0,this.Fh=m[10]|0,this.Fl=m[11]|0,this.Gh=m[12]|0,this.Gl=m[13]|0,this.Hh=m[14]|0,this.Hl=m[15]|0}}return Gn.SHA512_256=y,Gn.sha256=(0,t.createHasher)(()=>new s),Gn.sha224=(0,t.createHasher)(()=>new o),Gn.sha512=(0,t.createHasher)(()=>new f),Gn.sha384=(0,t.createHasher)(()=>new p),Gn.sha512_256=(0,t.createHasher)(()=>new y),Gn.sha512_224=(0,t.createHasher)(()=>new v),Gn}var qA;function MW(){if(qA)return Co;qA=1,Object.defineProperty(Co,"__esModule",{value:!0}),Co.sha224=Co.SHA224=Co.sha256=Co.SHA256=void 0;const n=IW();return Co.SHA256=n.SHA256,Co.sha256=n.sha256,Co.SHA224=n.SHA224,Co.sha224=n.sha224,Co}var yw,HA;function RW(){if(HA)return yw;HA=1;function n(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var m=0,v=0,y=0,O=g.length;y!==O&&g[y]===0;)y++,m++;for(var _=(O-y)*d+1>>>0,x=new Uint8Array(_);y!==O;){for(var k=g[y],S=0,E=_-1;(k!==0||S<v)&&E!==-1;E--,S++)k+=256*x[E]>>>0,x[E]=k%a>>>0,k=k/a>>>0;if(k!==0)throw new Error("Non-zero carry");v=S,y++}for(var R=_-v;R!==_&&x[R]===0;)R++;for(var C=l.repeat(m);R<_;++R)C+=e.charAt(x[R]);return C}function f(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;for(var m=0,v=0,y=0;g[m]===l;)v++,m++;for(var O=(g.length-m)*c+1>>>0,_=new Uint8Array(O);g[m];){var x=g.charCodeAt(m);if(x>255)return;var k=t[x];if(k===255)return;for(var S=0,E=O-1;(k!==0||S<y)&&E!==-1;E--,S++)k+=a*_[E]>>>0,_[E]=k%256>>>0,k=k/256>>>0;if(k!==0)throw new Error("Non-zero carry");y=S,m++}for(var R=O-y;R!==O&&_[R]===0;)R++;for(var C=new Uint8Array(v+(O-R)),I=v;R!==O;)C[I++]=_[R++];return C}function p(g){var m=f(g);if(m)return m;throw new Error("Non-base"+a+" character")}return{encode:h,decodeUnsafe:f,decode:p}}return yw=n,yw}var bw,ZA;function DW(){return ZA||(ZA=1,bw=RW()("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")),bw}var ww,WA;function NW(){if(WA)return ww;WA=1;var n=DW();return ww=function(e){function t(o){var a=Uint8Array.from(o),l=e(a),c=a.length+4,d=new Uint8Array(c);return d.set(a,0),d.set(l.subarray(0,4),a.length),n.encode(d,c)}function r(o){var a=o.slice(0,-4),l=o.slice(-4),c=e(a);if(!(l[0]^c[0]|l[1]^c[1]|l[2]^c[2]|l[3]^c[3]))return a}function i(o){var a=n.decodeUnsafe(o);if(a)return r(a)}function s(o){var a=n.decode(o),l=r(a);if(!l)throw new Error("Invalid checksum");return l}return{encode:t,decode:s,decodeUnsafe:i}},ww}var _w,XA;function LW(){if(XA)return _w;XA=1;var{sha256:n}=MW(),e=NW();function t(r){return n(n(r))}return _w=e(t),_w}var QW=LW();const Bu=Wk(QW),$W=n=>{if(n.length%2!==0)throw new Error("Hex string must have an even length");const e=new Uint8Array(n.length/2);for(let t=0;t<n.length;t+=2)e[t>>1]=parseInt(n.slice(t,t+2),16);return e},DL=n=>Array.from(n,e=>e.toString(16).padStart(2,"0")).join(""),xy="automerge:",Jd=n=>{const[e,t,...r]=n.split("#");if(r.length>0)throw new Error("Invalid URL: contains multiple heads sections");const i=new RegExp(`^${xy}(\\w+)$`),[,s]=e.match(i)||[],o=s,a=$L(o);if(!a)throw new Error("Invalid document URL: "+n);if(t===void 0)return{binaryDocumentId:a,documentId:o};const l=t===""?[]:t.split("|"),c=l.map(d=>{try{return DL(Bu.decode(d))}catch{throw new Error(`Invalid head in URL: ${d}`)}});return{binaryDocumentId:a,hexHeads:c,documentId:o,heads:l}},NL=n=>{if(n instanceof Uint8Array||typeof n=="string")return xy+(n instanceof Uint8Array?zp(n):n);const{documentId:e,heads:t=void 0}=n;if(e===void 0)throw new Error("Invalid documentId: "+e);const r=e instanceof Uint8Array?zp(e):e;let i=`${xy}${r}`;return t!==void 0&&(t.forEach(s=>{try{Bu.decode(s)}catch{throw new Error(`Invalid head: ${s}`)}}),i+="#"+t.join("|")),i},LL=n=>{if(typeof n!="string"||!n||!n.startsWith(xy))return!1;try{const{documentId:e,heads:t}=Jd(n);return!(!QL(e)||t&&!t.every(r=>{try{return Bu.decode(r),!0}catch{return!1}}))}catch{return!1}},QL=n=>typeof n!="string"?!1:$L(n)!==void 0,FW=n=>typeof n=="string"&&IL(n),YA=()=>{const n=ML(null,new Uint8Array(16));return NL({documentId:n})},$L=n=>Bu.decodeUnsafe(n),zp=n=>Bu.encode(n),_a=n=>n.map(e=>Bu.encode($W(e))),Rc=n=>n.map(e=>DL(Bu.decode(e))),Rm=n=>{if(n instanceof Uint8Array)return zp(n);if(LL(n))return Jd(n).documentId;if(QL(n))return n;if(FW(n)){console.warn("Future versions will not support UUIDs as document IDs; use Automerge URLs instead.");const e=TW(n);return zp(e)}throw new Error(`Invalid AutomergeUrl: '${n}'`)};let K_;try{K_=new TextDecoder}catch{}let Lt,fu,Ke=0;const zW=105,BW=57342,UW=57343,GA=57337,KA=6,fd={};let vf=11281e4,Ga=1681e4,vn={},wr,ky,Sy=0,Bp=0,Ur,io,Qr=[],J_=[],ts,Di,Kf,JA={useRecords:!1,mapsAsObjects:!0},Up=!1,FL=2;try{new Function("")}catch{FL=1/0}class jp{constructor(e){if(e&&((e.keyMap||e._keyMap)&&!e.useRecords&&(e.useRecords=!1,e.mapsAsObjects=!0),e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[t,r]of Object.entries(e.keyMap))this.mapKey.set(r,t)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[r,i]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,i);return t}decodeKeys(e){if(!this._keyMap||e.constructor.name!="Map")return e;if(!this._mapKey){this._mapKey=new Map;for(let[r,i]of Object.entries(this._keyMap))this._mapKey.set(i,r)}let t={};return e.forEach((r,i)=>t[so(this._mapKey.has(i)?this._mapKey.get(i):i)]=r),t}mapDecode(e,t){let r=this.decode(e);if(this._keyMap)switch(r.constructor.name){case"Array":return r.map(i=>this.decodeKeys(i))}return r}decode(e,t){if(Lt)return jL(()=>(rO(),this?this.decode(e,t):jp.prototype.decode.call(JA,e,t)));fu=t>-1?t:e.length,Ke=0,Bp=0,ky=null,Ur=null,Lt=e;try{Di=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw Lt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof jp){if(vn=this,ts=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return wr=this.structures,Dm();(!wr||wr.length>0)&&(wr=[])}else vn=JA,(!wr||wr.length>0)&&(wr=[]),ts=null;return Dm()}decodeMultiple(e,t){let r,i=0;try{let s=e.length;Up=!0;let o=this?this.decode(e,s):cS.decode(e,s);if(t){if(t(o)===!1)return;for(;Ke<s;)if(i=Ke,t(Dm())===!1)return}else{for(r=[o];Ke<s;)i=Ke,r.push(Dm());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Up=!1,rO()}}}function Dm(){try{let n=bn();if(Ur){if(Ke>=Ur.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}Ke=Ur.postBundlePosition,Ur=null}if(Ke==fu)wr=null,Lt=null,io&&(io=null);else if(Ke>fu){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}else if(!Up)throw new Error("Data read, but end of buffer not reached");return n}catch(n){throw rO(),(n instanceof RangeError||n.message.startsWith("Unexpected end of buffer"))&&(n.incomplete=!0),n}}function bn(){let n=Lt[Ke++],e=n>>5;if(n=n&31,n>23)switch(n){case 24:n=Lt[Ke++];break;case 25:if(e==7)return HW();n=Di.getUint16(Ke),Ke+=2;break;case 26:if(e==7){let t=Di.getFloat32(Ke);if(vn.useFloat32>2){let r=lS[(Lt[Ke]&127)<<1|Lt[Ke+1]>>7];return Ke+=4,(r*t+(t>0?.5:-.5)>>0)/r}return Ke+=4,t}n=Di.getUint32(Ke),Ke+=4;break;case 27:if(e==7){let t=Di.getFloat64(Ke);return Ke+=8,t}if(e>1){if(Di.getUint32(Ke)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");n=Di.getUint32(Ke+4)}else vn.int64AsNumber?(n=Di.getUint32(Ke)*4294967296,n+=Di.getUint32(Ke+4)):n=Di.getBigUint64(Ke);Ke+=8;break;case 31:switch(e){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let t=[],r,i=0;for(;(r=bn())!=fd;){if(i>=vf)throw new Error(`Array length exceeds ${vf}`);t[i++]=r}return e==4?t:e==3?t.join(""):Buffer.concat(t);case 5:let s;if(vn.mapsAsObjects){let o={},a=0;if(vn.keyMap)for(;(s=bn())!=fd;){if(a++>=Ga)throw new Error(`Property count exceeds ${Ga}`);o[so(vn.decodeKey(s))]=bn()}else for(;(s=bn())!=fd;){if(a++>=Ga)throw new Error(`Property count exceeds ${Ga}`);o[so(s)]=bn()}return o}else{Kf&&(vn.mapsAsObjects=!0,Kf=!1);let o=new Map;if(vn.keyMap){let a=0;for(;(s=bn())!=fd;){if(a++>=Ga)throw new Error(`Map size exceeds ${Ga}`);o.set(vn.decodeKey(s),bn())}}else{let a=0;for(;(s=bn())!=fd;){if(a++>=Ga)throw new Error(`Map size exceeds ${Ga}`);o.set(s,bn())}}return o}case 7:return fd;default:throw new Error("Invalid major type for indefinite length "+e)}default:throw new Error("Unknown token "+n)}switch(e){case 0:return n;case 1:return~n;case 2:return qW(n);case 3:if(Bp>=Ke)return ky.slice(Ke-Sy,(Ke+=n)-Sy);if(Bp==0&&fu<140&&n<32){let i=n<16?zL(n):VW(n);if(i!=null)return i}return jW(n);case 4:if(n>=vf)throw new Error(`Array length exceeds ${vf}`);let t=new Array(n);for(let i=0;i<n;i++)t[i]=bn();return t;case 5:if(n>=Ga)throw new Error(`Map size exceeds ${vf}`);if(vn.mapsAsObjects){let i={};if(vn.keyMap)for(let s=0;s<n;s++)i[so(vn.decodeKey(bn()))]=bn();else for(let s=0;s<n;s++)i[so(bn())]=bn();return i}else{Kf&&(vn.mapsAsObjects=!0,Kf=!1);let i=new Map;if(vn.keyMap)for(let s=0;s<n;s++)i.set(vn.decodeKey(bn()),bn());else for(let s=0;s<n;s++)i.set(bn(),bn());return i}case 6:if(n>=GA){let i=wr[n&8191];if(i)return i.read||(i.read=eO(i)),i.read();if(n<65536){if(n==UW){let s=Rd(),o=bn(),a=bn();nO(o,a);let l={};if(vn.keyMap)for(let c=2;c<s;c++){let d=vn.decodeKey(a[c-2]);l[so(d)]=bn()}else for(let c=2;c<s;c++){let d=a[c-2];l[so(d)]=bn()}return l}else if(n==BW){let s=Rd(),o=bn();for(let a=2;a<s;a++)nO(o++,bn());return bn()}else if(n==GA)return KW();if(vn.getShared&&(aS(),i=wr[n&8191],i))return i.read||(i.read=eO(i)),i.read()}}let r=Qr[n];if(r)return r.handlesRead?r(bn):r(bn());{let i=bn();for(let s=0;s<J_.length;s++){let o=J_[s](n,i);if(o!==void 0)return o}return new _u(i,n)}case 7:switch(n){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let i=(ts||jc())[n];if(i!==void 0)return i;throw new Error("Unknown token "+n)}default:if(isNaN(n)){let i=new Error("Unexpected end of CBOR data");throw i.incomplete=!0,i}throw new Error("Unknown CBOR token "+n)}}const eC=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function eO(n){if(!n)throw new Error("Structure is required in record definition");function e(){let t=Lt[Ke++];if(t=t&31,t>23)switch(t){case 24:t=Lt[Ke++];break;case 25:t=Di.getUint16(Ke),Ke+=2;break;case 26:t=Di.getUint32(Ke),Ke+=4;break;default:throw new Error("Expected array header, but got "+Lt[Ke-1])}let r=this.compiledReader;for(;r;){if(r.propertyCount===t)return r(bn);r=r.next}if(this.slowReads++>=FL){let s=this.length==t?this:this.slice(0,t);return r=vn.keyMap?new Function("r","return {"+s.map(o=>vn.decodeKey(o)).map(o=>eC.test(o)?so(o)+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}"):new Function("r","return {"+s.map(o=>eC.test(o)?so(o)+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}"),this.compiledReader&&(r.next=this.compiledReader),r.propertyCount=t,this.compiledReader=r,r(bn)}let i={};if(vn.keyMap)for(let s=0;s<t;s++)i[so(vn.decodeKey(this[s]))]=bn();else for(let s=0;s<t;s++)i[so(this[s])]=bn();return i}return n.slowReads=0,e}function so(n){if(typeof n=="string")return n==="__proto__"?"__proto_":n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";throw new Error("Invalid property name type "+typeof n)}let jW=tO;function tO(n){let e;if(n<16&&(e=zL(n)))return e;if(n>64&&K_)return K_.decode(Lt.subarray(Ke,Ke+=n));const t=Ke+n,r=[];for(e="";Ke<t;){const i=Lt[Ke++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=Lt[Ke++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=Lt[Ke++]&63,o=Lt[Ke++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Lt[Ke++]&63,o=Lt[Ke++]&63,a=Lt[Ke++]&63;let l=(i&7)<<18|s<<12|o<<6|a;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(i);r.length>=4096&&(e+=Yr.apply(String,r),r.length=0)}return r.length>0&&(e+=Yr.apply(String,r)),e}let Yr=String.fromCharCode;function VW(n){let e=Ke,t=new Array(n);for(let r=0;r<n;r++){const i=Lt[Ke++];if((i&128)>0){Ke=e;return}t[r]=i}return Yr.apply(String,t)}function zL(n){if(n<4)if(n<2){if(n===0)return"";{let e=Lt[Ke++];if((e&128)>1){Ke-=1;return}return Yr(e)}}else{let e=Lt[Ke++],t=Lt[Ke++];if((e&128)>0||(t&128)>0){Ke-=2;return}if(n<3)return Yr(e,t);let r=Lt[Ke++];if((r&128)>0){Ke-=3;return}return Yr(e,t,r)}else{let e=Lt[Ke++],t=Lt[Ke++],r=Lt[Ke++],i=Lt[Ke++];if((e&128)>0||(t&128)>0||(r&128)>0||(i&128)>0){Ke-=4;return}if(n<6){if(n===4)return Yr(e,t,r,i);{let s=Lt[Ke++];if((s&128)>0){Ke-=5;return}return Yr(e,t,r,i,s)}}else if(n<8){let s=Lt[Ke++],o=Lt[Ke++];if((s&128)>0||(o&128)>0){Ke-=6;return}if(n<7)return Yr(e,t,r,i,s,o);let a=Lt[Ke++];if((a&128)>0){Ke-=7;return}return Yr(e,t,r,i,s,o,a)}else{let s=Lt[Ke++],o=Lt[Ke++],a=Lt[Ke++],l=Lt[Ke++];if((s&128)>0||(o&128)>0||(a&128)>0||(l&128)>0){Ke-=8;return}if(n<10){if(n===8)return Yr(e,t,r,i,s,o,a,l);{let c=Lt[Ke++];if((c&128)>0){Ke-=9;return}return Yr(e,t,r,i,s,o,a,l,c)}}else if(n<12){let c=Lt[Ke++],d=Lt[Ke++];if((c&128)>0||(d&128)>0){Ke-=10;return}if(n<11)return Yr(e,t,r,i,s,o,a,l,c,d);let h=Lt[Ke++];if((h&128)>0){Ke-=11;return}return Yr(e,t,r,i,s,o,a,l,c,d,h)}else{let c=Lt[Ke++],d=Lt[Ke++],h=Lt[Ke++],f=Lt[Ke++];if((c&128)>0||(d&128)>0||(h&128)>0||(f&128)>0){Ke-=12;return}if(n<14){if(n===12)return Yr(e,t,r,i,s,o,a,l,c,d,h,f);{let p=Lt[Ke++];if((p&128)>0){Ke-=13;return}return Yr(e,t,r,i,s,o,a,l,c,d,h,f,p)}}else{let p=Lt[Ke++],g=Lt[Ke++];if((p&128)>0||(g&128)>0){Ke-=14;return}if(n<15)return Yr(e,t,r,i,s,o,a,l,c,d,h,f,p,g);let m=Lt[Ke++];if((m&128)>0){Ke-=15;return}return Yr(e,t,r,i,s,o,a,l,c,d,h,f,p,g,m)}}}}}function qW(n){return vn.copyBuffers?Uint8Array.prototype.slice.call(Lt,Ke,Ke+=n):Lt.subarray(Ke,Ke+=n)}let BL=new Float32Array(1),Nm=new Uint8Array(BL.buffer,0,4);function HW(){let n=Lt[Ke++],e=Lt[Ke++],t=(n&127)>>2;if(t===31)return e||n&3?NaN:n&128?-1/0:1/0;if(t===0){let r=((n&3)<<8|e)/16777216;return n&128?-r:r}return Nm[3]=n&128|(t>>1)+56,Nm[2]=(n&7)<<5|e>>3,Nm[1]=e<<5,Nm[0]=0,BL[0]}new Array(4096);let _u=class{constructor(e,t){this.value=e,this.tag=t}};Qr[0]=n=>new Date(n);Qr[1]=n=>new Date(Math.round(n*1e3));Qr[2]=n=>{let e=BigInt(0);for(let t=0,r=n.byteLength;t<r;t++)e=BigInt(n[t])+(e<<BigInt(8));return e};Qr[3]=n=>BigInt(-1)-Qr[2](n);Qr[4]=n=>+(n[1]+"e"+n[0]);Qr[5]=n=>n[1]*Math.exp(n[0]*Math.log(2));const nO=(n,e)=>{n=n-57344;let t=wr[n];t&&t.isShared&&((wr.restoreStructures||(wr.restoreStructures=[]))[n]=t),wr[n]=e,e.read=eO(e)};Qr[zW]=n=>{let e=n.length,t=n[1];nO(n[0],t);let r={};for(let i=2;i<e;i++){let s=t[i-2];r[so(s)]=n[i]}return r};Qr[14]=n=>Ur?Ur[0].slice(Ur.position0,Ur.position0+=n):new _u(n,14);Qr[15]=n=>Ur?Ur[1].slice(Ur.position1,Ur.position1+=n):new _u(n,15);let ZW={Error,RegExp};Qr[27]=n=>(ZW[n[0]]||Error)(n[1],n[2]);const UL=n=>{if(Lt[Ke++]!=132){let t=new Error("Packed values structure must be followed by a 4 element array");throw Lt.length<Ke&&(t.incomplete=!0),t}let e=n();if(!e||!e.length){let t=new Error("Packed values structure must be followed by a 4 element array");throw t.incomplete=!0,t}return ts=ts?e.concat(ts.slice(e.length)):e,ts.prefixes=n(),ts.suffixes=n(),n()};UL.handlesRead=!0;Qr[51]=UL;Qr[KA]=n=>{if(!ts)if(vn.getShared)aS();else return new _u(n,KA);if(typeof n=="number")return ts[16+(n>=0?2*n:-2*n-1)];let e=new Error("No support for non-integer packed references yet");throw n===void 0&&(e.incomplete=!0),e};Qr[28]=n=>{io||(io=new Map,io.id=0);let e=io.id++,t=Ke,r=Lt[Ke],i;r>>5==4?i=[]:i={};let s={target:i};io.set(e,s);let o=n();return s.used?(Object.getPrototypeOf(i)!==Object.getPrototypeOf(o)&&(Ke=t,i=o,io.set(e,{target:i}),o=n()),Object.assign(i,o)):(s.target=o,o)};Qr[28].handlesRead=!0;Qr[29]=n=>{let e=io.get(n);return e.used=!0,e.target};Qr[258]=n=>new Set(n);(Qr[259]=n=>(vn.mapsAsObjects&&(vn.mapsAsObjects=!1,Kf=!0),n())).handlesRead=!0;function pd(n,e){return typeof n=="string"?n+e:n instanceof Array?n.concat(e):Object.assign({},n,e)}function jc(){if(!ts)if(vn.getShared)aS();else throw new Error("No packed values available");return ts}const WW=1399353956;J_.push((n,e)=>{if(n>=225&&n<=255)return pd(jc().prefixes[n-224],e);if(n>=28704&&n<=32767)return pd(jc().prefixes[n-28672],e);if(n>=1879052288&&n<=2147483647)return pd(jc().prefixes[n-1879048192],e);if(n>=216&&n<=223)return pd(e,jc().suffixes[n-216]);if(n>=27647&&n<=28671)return pd(e,jc().suffixes[n-27639]);if(n>=1811940352&&n<=1879048191)return pd(e,jc().suffixes[n-1811939328]);if(n==WW)return{packedValues:ts,structures:wr.slice(0),version:e};if(n==55799)return e});const XW=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,tC=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],YW=[64,68,69,70,71,72,77,78,79,85,86];for(let n=0;n<tC.length;n++)GW(tC[n],YW[n]);function GW(n,e){let t="get"+n.name.slice(0,-5),r;typeof n=="function"?r=n.BYTES_PER_ELEMENT:n=null;for(let i=0;i<2;i++){if(!i&&r==1)continue;let s=r==2?1:r==4?2:r==8?3:0;Qr[i?e:e-4]=r==1||i==XW?o=>{if(!n)throw new Error("Could not find typed array for code "+e);return!vn.copyBuffers&&(r===1||r===2&&!(o.byteOffset&1)||r===4&&!(o.byteOffset&3)||r===8&&!(o.byteOffset&7))?new n(o.buffer,o.byteOffset,o.byteLength>>s):new n(Uint8Array.prototype.slice.call(o,0).buffer)}:o=>{if(!n)throw new Error("Could not find typed array for code "+e);let a=new DataView(o.buffer,o.byteOffset,o.byteLength),l=o.length>>s,c=new n(l),d=a[t];for(let h=0;h<l;h++)c[h]=d.call(a,h<<s,i);return c}}}function KW(){let n=Rd(),e=Ke+bn();for(let r=2;r<n;r++){let i=Rd();Ke+=i}let t=Ke;return Ke=e,Ur=[tO(Rd()),tO(Rd())],Ur.position0=0,Ur.position1=0,Ur.postBundlePosition=Ke,Ke=t,bn()}function Rd(){let n=Lt[Ke++]&31;if(n>23)switch(n){case 24:n=Lt[Ke++];break;case 25:n=Di.getUint16(Ke),Ke+=2;break;case 26:n=Di.getUint32(Ke),Ke+=4;break}return n}function aS(){if(vn.getShared){let n=jL(()=>(Lt=null,vn.getShared()))||{},e=n.structures||[];vn.sharedVersion=n.version,ts=vn.sharedValues=n.packedValues,wr===!0?vn.structures=wr=e:wr.splice.apply(wr,[0,e.length].concat(e))}}function jL(n){let e=fu,t=Ke,r=Sy,i=Bp,s=ky,o=io,a=Ur,l=new Uint8Array(Lt.slice(0,fu)),c=wr,d=vn,h=Up,f=n();return fu=e,Ke=t,Sy=r,Bp=i,ky=s,io=o,Ur=a,Lt=l,Up=h,wr=c,vn=d,Di=new DataView(Lt.buffer,Lt.byteOffset,Lt.byteLength),f}function rO(){Lt=null,io=null,wr=null}const lS=new Array(147);for(let n=0;n<256;n++)lS[n]=+("1e"+Math.floor(45.15-n*.30103));let cS=new jp({useRecords:!1});const JW=cS.decode;cS.decodeMultiple;let Qv;try{Qv=new TextEncoder}catch{}let iO,VL;const ob=typeof globalThis=="object"&&globalThis.Buffer,Vg=typeof ob<"u",Ow=Vg?ob.allocUnsafeSlow:Uint8Array,nC=Vg?ob:Uint8Array,rC=256,iC=Vg?4294967296:2144337920;let xw,$e,rr,xe=0,Ql,zr=null;const eX=61440,tX=/[\u0080-\uFFFF]/,gs=Symbol("record-id");class qL extends jp{constructor(e){super(e),this.offset=0;let t,r,i,s,o;e=e||{};let a=nC.prototype.utf8Write?function(M,N,B){return $e.utf8Write(M,N,B)}:Qv&&Qv.encodeInto?function(M,N){return Qv.encodeInto(M,$e.subarray(N)).written}:!1,l=this,c=e.structures||e.saveStructures,d=e.maxSharedStructures;if(d==null&&(d=c?128:0),d>8190)throw new Error("Maximum maxSharedStructure is 8190");let h=e.sequential;h&&(d=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let f,p,g=e.sharedValues,m;if(g){m=Object.create(null);for(let M=0,N=g.length;M<N;M++)m[g[M]]=M}let v=[],y=0,O=0;this.mapEncode=function(M,N){if(this._keyMap&&!this._mapped)switch(M.constructor.name){case"Array":M=M.map(B=>this.encodeKeys(B));break}return this.encode(M,N)},this.encode=function(M,N){if($e||($e=new Ow(8192),rr=new DataView($e.buffer,0,8192),xe=0),Ql=$e.length-10,Ql-xe<2048?($e=new Ow($e.length),rr=new DataView($e.buffer,0,$e.length),Ql=$e.length-10,xe=0):N===aC&&(xe=xe+7&2147483640),t=xe,l.useSelfDescribedHeader&&(rr.setUint32(xe,3654940416),xe+=3),o=l.structuredClone?new Map:null,l.bundleStrings&&typeof M!="string"?(zr=[],zr.size=1/0):zr=null,r=l.structures,r){if(r.uninitialized){let H=l.getShared()||{};l.structures=r=H.structures||[],l.sharedVersion=H.version;let F=l.sharedValues=H.packedValues;if(F){m={};for(let Z=0,$=F.length;Z<$;Z++)m[F[Z]]=Z}}let B=r.length;if(B>d&&!h&&(B=d),!r.transitions){r.transitions=Object.create(null);for(let H=0;H<B;H++){let F=r[H];if(!F)continue;let Z,$=r.transitions;for(let W=0,G=F.length;W<G;W++){$[gs]===void 0&&($[gs]=H);let L=F[W];Z=$[L],Z||(Z=$[L]=Object.create(null)),$=Z}$[gs]=H|1048576}}h||(r.nextId=B)}if(i&&(i=!1),s=r||[],p=m,e.pack){let B=new Map;if(B.values=[],B.encoder=l,B.maxValues=e.maxPrivatePackedValues||(m?16:1/0),B.objectMap=m||!1,B.samplingPackedValues=f,$v(M,B),B.values.length>0){$e[xe++]=216,$e[xe++]=51,ma(4);let H=B.values;_(H),ma(0),ma(0),p=Object.create(m||null);for(let F=0,Z=H.length;F<Z;F++)p[H[F]]=F}}xw=N&Sw;try{if(xw)return;if(_(M),zr&&oC(t,_),l.offset=xe,o&&o.idsToInsert){xe+=o.idsToInsert.length*2,xe>Ql&&k(xe),l.offset=xe;let B=iX($e.subarray(t,xe),o.idsToInsert);return o=null,B}return N&aC?($e.start=t,$e.end=xe,$e):$e.subarray(t,xe)}finally{if(r){if(O<10&&O++,r.length>d&&(r.length=d),y>1e4)r.transitions=null,O=0,y=0,v.length>0&&(v=[]);else if(v.length>0&&!h){for(let B=0,H=v.length;B<H;B++)v[B][gs]=void 0;v=[]}}if(i&&l.saveShared){l.structures.length>d&&(l.structures=l.structures.slice(0,d));let B=$e.subarray(t,xe);return l.updateSharedData()===!1?l.encode(M):B}N&sX&&(xe=t)}},this.findCommonStringsToPack=()=>(f=new Map,m||(m=Object.create(null)),M=>{let N=M&&M.threshold||4,B=this.pack?M.maxPrivatePackedValues||16:0;g||(g=this.sharedValues=[]);for(let[H,F]of f)F.count>N&&(m[H]=B++,g.push(H),i=!0);for(;this.saveShared&&this.updateSharedData()===!1;);f=null});const _=M=>{xe>Ql&&($e=k(xe));var N=typeof M,B;if(N==="string"){if(p){let $=p[M];if($>=0){$<16?$e[xe++]=$+224:($e[xe++]=198,$&1?_(15-$>>1):_($-16>>1));return}else if(f&&!e.pack){let W=f.get(M);W?W.count++:f.set(M,{count:1})}}let H=M.length;if(zr&&H>=4&&H<1024){if((zr.size+=H)>eX){let W,G=(zr[0]?zr[0].length*3+zr[1].length:0)+10;xe+G>Ql&&($e=k(xe+G)),$e[xe++]=217,$e[xe++]=223,$e[xe++]=249,$e[xe++]=zr.position?132:130,$e[xe++]=26,W=xe-t,xe+=4,zr.position&&oC(t,_),zr=["",""],zr.size=0,zr.position=W}let $=tX.test(M);zr[$?0:1]+=M,$e[xe++]=$?206:207,_(H);return}let F;H<32?F=1:H<256?F=2:H<65536?F=3:F=5;let Z=H*3;if(xe+Z>Ql&&($e=k(xe+Z)),H<64||!a){let $,W,G,L=xe+F;for($=0;$<H;$++)W=M.charCodeAt($),W<128?$e[L++]=W:W<2048?($e[L++]=W>>6|192,$e[L++]=W&63|128):(W&64512)===55296&&((G=M.charCodeAt($+1))&64512)===56320?(W=65536+((W&1023)<<10)+(G&1023),$++,$e[L++]=W>>18|240,$e[L++]=W>>12&63|128,$e[L++]=W>>6&63|128,$e[L++]=W&63|128):($e[L++]=W>>12|224,$e[L++]=W>>6&63|128,$e[L++]=W&63|128);B=L-xe-F}else B=a(M,xe+F,Z);B<24?$e[xe++]=96|B:B<256?(F<2&&$e.copyWithin(xe+2,xe+1,xe+1+B),$e[xe++]=120,$e[xe++]=B):B<65536?(F<3&&$e.copyWithin(xe+3,xe+2,xe+2+B),$e[xe++]=121,$e[xe++]=B>>8,$e[xe++]=B&255):(F<5&&$e.copyWithin(xe+5,xe+3,xe+3+B),$e[xe++]=122,rr.setUint32(xe,B),xe+=4),xe+=B}else if(N==="number")if(!this.alwaysUseFloat&&M>>>0===M)M<24?$e[xe++]=M:M<256?($e[xe++]=24,$e[xe++]=M):M<65536?($e[xe++]=25,$e[xe++]=M>>8,$e[xe++]=M&255):($e[xe++]=26,rr.setUint32(xe,M),xe+=4);else if(!this.alwaysUseFloat&&M>>0===M)M>=-24?$e[xe++]=31-M:M>=-256?($e[xe++]=56,$e[xe++]=~M):M>=-65536?($e[xe++]=57,rr.setUint16(xe,~M),xe+=2):($e[xe++]=58,rr.setUint32(xe,~M),xe+=4);else{let H;if((H=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){$e[xe++]=250,rr.setFloat32(xe,M);let F;if(H<4||(F=M*lS[($e[xe]&127)<<1|$e[xe+1]>>7])>>0===F){xe+=4;return}else xe--}$e[xe++]=251,rr.setFloat64(xe,M),xe+=8}else if(N==="object")if(!M)$e[xe++]=246;else{if(o){let F=o.get(M);if(F){if($e[xe++]=216,$e[xe++]=29,$e[xe++]=25,!F.references){let Z=o.idsToInsert||(o.idsToInsert=[]);F.references=[],Z.push(F)}F.references.push(xe-t),xe+=2;return}else o.set(M,{offset:xe-t})}let H=M.constructor;if(H===Object)x(M);else if(H===Array){B=M.length,B<24?$e[xe++]=128|B:ma(B);for(let F=0;F<B;F++)_(M[F])}else if(H===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&($e[xe++]=217,$e[xe++]=1,$e[xe++]=3),B=M.size,B<24?$e[xe++]=160|B:B<256?($e[xe++]=184,$e[xe++]=B):B<65536?($e[xe++]=185,$e[xe++]=B>>8,$e[xe++]=B&255):($e[xe++]=186,rr.setUint32(xe,B),xe+=4),l.keyMap)for(let[F,Z]of M)_(l.encodeKey(F)),_(Z);else for(let[F,Z]of M)_(F),_(Z);else{for(let F=0,Z=iO.length;F<Z;F++){let $=VL[F];if(M instanceof $){let W=iO[F],G=W.tag;G==null&&(G=W.getTag&&W.getTag.call(this,M)),G<24?$e[xe++]=192|G:G<256?($e[xe++]=216,$e[xe++]=G):G<65536?($e[xe++]=217,$e[xe++]=G>>8,$e[xe++]=G&255):G>-1&&($e[xe++]=218,rr.setUint32(xe,G),xe+=4),W.encode.call(this,M,_,k);return}}if(M[Symbol.iterator]){if(xw){let F=new Error("Iterable should be serialized as iterator");throw F.iteratorNotHandled=!0,F}$e[xe++]=159;for(let F of M)_(F);$e[xe++]=255;return}if(M[Symbol.asyncIterator]||kw(M)){let F=new Error("Iterable/blob should be serialized as iterator");throw F.iteratorNotHandled=!0,F}if(this.useToJSON&&M.toJSON){const F=M.toJSON();if(F!==M)return _(F)}x(M)}}else if(N==="boolean")$e[xe++]=M?245:244;else if(N==="bigint"){if(M<BigInt(1)<<BigInt(64)&&M>=0)$e[xe++]=27,rr.setBigUint64(xe,M);else if(M>-(BigInt(1)<<BigInt(64))&&M<0)$e[xe++]=59,rr.setBigUint64(xe,-M-BigInt(1));else if(this.largeBigIntToFloat)$e[xe++]=251,rr.setFloat64(xe,Number(M));else{M>=BigInt(0)?$e[xe++]=194:($e[xe++]=195,M=BigInt(-1)-M);let H=[];for(;M;)H.push(Number(M&BigInt(255))),M>>=BigInt(8);sO(new Uint8Array(H.reverse()),k);return}xe+=8}else if(N==="undefined")$e[xe++]=247;else throw new Error("Unknown type: "+N)},x=this.useRecords===!1?this.variableMapSize?M=>{let N=Object.keys(M),B=Object.values(M),H=N.length;if(H<24?$e[xe++]=160|H:H<256?($e[xe++]=184,$e[xe++]=H):H<65536?($e[xe++]=185,$e[xe++]=H>>8,$e[xe++]=H&255):($e[xe++]=186,rr.setUint32(xe,H),xe+=4),l.keyMap)for(let F=0;F<H;F++)_(l.encodeKey(N[F])),_(B[F]);else for(let F=0;F<H;F++)_(N[F]),_(B[F])}:M=>{$e[xe++]=185;let N=xe-t;xe+=2;let B=0;if(l.keyMap)for(let H in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(H))&&(_(l.encodeKey(H)),_(M[H]),B++);else for(let H in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(H))&&(_(H),_(M[H]),B++);$e[N+++t]=B>>8,$e[N+t]=B&255}:(M,N)=>{let B,H=s.transitions||(s.transitions=Object.create(null)),F=0,Z=0,$,W;if(this.keyMap){W=Object.keys(M).map(L=>this.encodeKey(L)),Z=W.length;for(let L=0;L<Z;L++){let q=W[L];B=H[q],B||(B=H[q]=Object.create(null),F++),H=B}}else for(let L in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(L))&&(B=H[L],B||(H[gs]&1048576&&($=H[gs]&65535),B=H[L]=Object.create(null),F++),H=B,Z++);let G=H[gs];if(G!==void 0)G&=65535,$e[xe++]=217,$e[xe++]=G>>8|224,$e[xe++]=G&255;else if(W||(W=H.__keys__||(H.__keys__=Object.keys(M))),$===void 0?(G=s.nextId++,G||(G=0,s.nextId=1),G>=rC&&(s.nextId=(G=d)+1)):G=$,s[G]=W,G<d){$e[xe++]=217,$e[xe++]=G>>8|224,$e[xe++]=G&255,H=s.transitions;for(let L=0;L<Z;L++)(H[gs]===void 0||H[gs]&1048576)&&(H[gs]=G),H=H[W[L]];H[gs]=G|1048576,i=!0}else{if(H[gs]=G,rr.setUint32(xe,3655335680),xe+=3,F&&(y+=O*F),v.length>=rC-d&&(v.shift()[gs]=void 0),v.push(H),ma(Z+2),_(57344+G),_(W),N)return;for(let L in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(L))&&_(M[L]);return}if(Z<24?$e[xe++]=128|Z:ma(Z),!N)for(let L in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(L))&&_(M[L])},k=M=>{let N;if(M>16777216){if(M-t>iC)throw new Error("Encoded buffer would be larger than maximum buffer size");N=Math.min(iC,Math.round(Math.max((M-t)*(M>67108864?1.25:2),4194304)/4096)*4096)}else N=(Math.max(M-t<<2,$e.length-1)>>12)+1<<12;let B=new Ow(N);return rr=new DataView(B.buffer,0,N),$e.copy?$e.copy(B,0,t,M):B.set($e.slice(t,M)),xe-=t,t=0,Ql=B.length-10,$e=B};let S=100,E=1e3;this.encodeAsIterable=function(M,N){return D(M,N,R)},this.encodeAsAsyncIterable=function(M,N){return D(M,N,Q)};function*R(M,N,B){let H=M.constructor;if(H===Object){let F=l.useRecords!==!1;F?x(M,!0):sC(Object.keys(M).length,160);for(let Z in M){let $=M[Z];F||_(Z),$&&typeof $=="object"?N[Z]?yield*R($,N[Z]):yield*C($,N,Z):_($)}}else if(H===Array){let F=M.length;ma(F);for(let Z=0;Z<F;Z++){let $=M[Z];$&&(typeof $=="object"||xe-t>S)?N.element?yield*R($,N.element):yield*C($,N,"element"):_($)}}else if(M[Symbol.iterator]&&!M.buffer){$e[xe++]=159;for(let F of M)F&&(typeof F=="object"||xe-t>S)?N.element?yield*R(F,N.element):yield*C(F,N,"element"):_(F);$e[xe++]=255}else kw(M)?(sC(M.size,64),yield $e.subarray(t,xe),yield M,I()):M[Symbol.asyncIterator]?($e[xe++]=159,yield $e.subarray(t,xe),yield M,I(),$e[xe++]=255):_(M);B&&xe>t?yield $e.subarray(t,xe):xe-t>S&&(yield $e.subarray(t,xe),I())}function*C(M,N,B){let H=xe-t;try{_(M),xe-t>S&&(yield $e.subarray(t,xe),I())}catch(F){if(F.iteratorNotHandled)N[B]={},xe=t+H,yield*R.call(this,M,N[B]);else throw F}}function I(){S=E,l.encode(null,Sw)}function D(M,N,B){return N&&N.chunkThreshold?S=E=N.chunkThreshold:S=100,M&&typeof M=="object"?(l.encode(null,Sw),B(M,l.iterateProperties||(l.iterateProperties={}),!0)):[l.encode(M)]}async function*Q(M,N){for(let B of R(M,N,!0)){let H=B.constructor;if(H===nC||H===Uint8Array)yield B;else if(kw(B)){let F=B.stream().getReader(),Z;for(;!(Z=await F.read()).done;)yield Z.value}else if(B[Symbol.asyncIterator])for await(let F of B)I(),F?yield*Q(F,N.async||(N.async={})):yield l.encode(F);else yield B}}}useBuffer(e){$e=e,rr=new DataView($e.buffer,$e.byteOffset,$e.byteLength),xe=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let t=this.structures.slice(0),r=new HL(t,this.sharedValues,this.sharedVersion),i=this.saveShared(r,s=>(s&&s.version||0)==e);return i===!1?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):t.forEach((s,o)=>this.structures[o]=s),i}}function sC(n,e){n<24?$e[xe++]=e|n:n<256?($e[xe++]=e|24,$e[xe++]=n):n<65536?($e[xe++]=e|25,$e[xe++]=n>>8,$e[xe++]=n&255):($e[xe++]=e|26,rr.setUint32(xe,n),xe+=4)}class HL{constructor(e,t,r){this.structures=e,this.packedValues=t,this.version=r}}function ma(n){n<24?$e[xe++]=128|n:n<256?($e[xe++]=152,$e[xe++]=n):n<65536?($e[xe++]=153,$e[xe++]=n>>8,$e[xe++]=n&255):($e[xe++]=154,rr.setUint32(xe,n),xe+=4)}const nX=typeof Blob>"u"?function(){}:Blob;function kw(n){if(n instanceof nX)return!0;let e=n[Symbol.toStringTag];return e==="Blob"||e==="File"}function $v(n,e){switch(typeof n){case"string":if(n.length>3){if(e.objectMap[n]>-1||e.values.length>=e.maxValues)return;let r=e.get(n);if(r)++r.count==2&&e.values.push(n);else if(e.set(n,{count:1}),e.samplingPackedValues){let i=e.samplingPackedValues.get(n);i?i.count++:e.samplingPackedValues.set(n,{count:1})}}break;case"object":if(n)if(n instanceof Array)for(let r=0,i=n.length;r<i;r++)$v(n[r],e);else{let r=!e.encoder.useRecords;for(var t in n)n.hasOwnProperty(t)&&(r&&$v(t,e),$v(n[t],e))}break;case"function":console.log(n)}}const rX=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;VL=[Date,Set,Error,RegExp,_u,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,HL];iO=[{tag:1,encode(n,e){let t=n.getTime()/1e3;(this.useTimestamp32||n.getMilliseconds()===0)&&t>=0&&t<4294967296?($e[xe++]=26,rr.setUint32(xe,t),xe+=4):($e[xe++]=251,rr.setFloat64(xe,t),xe+=8)}},{tag:258,encode(n,e){let t=Array.from(n);e(t)}},{tag:27,encode(n,e){e([n.name,n.message])}},{tag:27,encode(n,e){e(["RegExp",n.source,n.flags])}},{getTag(n){return n.tag},encode(n,e){e(n.value)}},{encode(n,e,t){sO(n,t)}},{getTag(n){if(n.constructor===Uint8Array&&(this.tagUint8Array||Vg&&this.tagUint8Array!==!1))return 64},encode(n,e,t){sO(n,t)}},ia(68,1),ia(69,2),ia(70,4),ia(71,8),ia(72,1),ia(77,2),ia(78,4),ia(79,8),ia(85,4),ia(86,8),{encode(n,e){let t=n.packedValues||[],r=n.structures||[];if(t.values.length>0){$e[xe++]=216,$e[xe++]=51,ma(4);let i=t.values;e(i),ma(0),ma(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let s=0,o=i.length;s<o;s++)packedObjectMap[i[s]]=s}if(r){rr.setUint32(xe,3655335424),xe+=3;let i=r.slice(0);i.unshift(57344),i.push(new _u(n.version,1399353956)),e(i)}else e(new _u(n.version,1399353956))}}];function ia(n,e){return!rX&&e>1&&(n-=4),{tag:n,encode:function(r,i){let s=r.byteLength,o=r.byteOffset||0,a=r.buffer||r;i(Vg?ob.from(a,o,s):new Uint8Array(a,o,s))}}}function sO(n,e){let t=n.byteLength;t<24?$e[xe++]=64+t:t<256?($e[xe++]=88,$e[xe++]=t):t<65536?($e[xe++]=89,$e[xe++]=t>>8,$e[xe++]=t&255):($e[xe++]=90,rr.setUint32(xe,t),xe+=4),xe+t>=$e.length&&e(xe+t),$e.set(n.buffer?n:new Uint8Array(n),xe),xe+=t}function iX(n,e){let t,r=e.length*2,i=n.length-r;e.sort((s,o)=>s.offset>o.offset?1:-1);for(let s=0;s<e.length;s++){let o=e[s];o.id=s;for(let a of o.references)n[a++]=s>>8,n[a]=s&255}for(;t=e.pop();){let s=t.offset;n.copyWithin(s+r,s,i),r-=2;let o=s+r;n[o++]=216,n[o++]=28,i=s}return n}function oC(n,e){rr.setUint32(zr.position+n,xe-zr.position-n+1);let t=zr;zr=null,e(t[0]),e(t[1])}let uS=new qL({useRecords:!1});uS.encode;uS.encodeAsIterable;uS.encodeAsAsyncIterable;const aC=512,sX=1024,Sw=2048;function oX(n){return new qL({tagUint8Array:!1,useRecords:!1}).encode(n)}const aX=(n,e)=>n.length===e.length&&n.every((t,r)=>t===e[r]),dS=(n,e)=>aX(n,e),lX=async(n,e)=>{let t;const r=new Promise((i,s)=>{t=setTimeout(()=>s(new cX(`withTimeout: timed out after ${e}ms`)),e)});try{return await Promise.race([n,r])}finally{clearTimeout(t)}};class cX extends Error{constructor(e){super(e),this.name="TimeoutError"}}class ab extends DOMException{constructor(e){super(e??"Operation aborted","AbortError")}}const uX=n=>n instanceof ab||(n instanceof Error||DOMException&&n instanceof DOMException)&&n.name==="AbortError";function lC(n,e){let t=!1;return new Promise((r,i)=>{e?.addEventListener("abort",()=>{t||i(new ab)},{once:!0}),n.then(s=>{r(s)}).catch(s=>{i(s)}).finally(()=>{t=!0})})}class Ty extends zu{documentId;#e;#t;#r;#n=lo();#s=6e4;#i={};#o=new Map;constructor(e,t={}){super(),this.documentId=e,"timeoutDelay"in t&&t.timeoutDelay&&(this.#s=t.timeoutDelay),"heads"in t&&(this.#r=t.heads);const r=lo();this.#e=Fu(`automerge-repo:dochandle:${this.documentId.slice(0,5)}`);const i=this.#s,s=PL({actions:{onUpdate:tu(({context:o,event:a})=>{const l=o.doc;yW(a,uC);const{callback:c}=a.payload;return{doc:c(l)}}),onDelete:tu(()=>(this.emit("delete",{handle:this}),{doc:lo()})),onUnavailable:tu(()=>({doc:lo()})),onUnload:tu(()=>({doc:lo()}))}}).createMachine({initial:"idle",context:{documentId:e,doc:r},on:{UPDATE:{actions:"onUpdate"},UNLOAD:".unloaded",DELETE:".deleted"},states:{idle:{on:{BEGIN:"loading"}},loading:{on:{REQUEST:"requesting",DOC_READY:"ready"},after:{[i]:"unavailable"}},requesting:{on:{DOC_UNAVAILABLE:"unavailable",DOC_READY:"ready"},after:{[i]:"unavailable"}},unavailable:{entry:"onUnavailable",on:{DOC_READY:"ready"}},ready:{},unloaded:{entry:"onUnload",on:{RELOAD:"loading"}},deleted:{entry:"onDelete",type:"final"}}});this.#t=Fp(s),this.#t.subscribe(o=>{const a=this.#n,l=o.context.doc;this.#e(`â ${o.value} %o`,l),this.#u(a,l)}),this.#t.start(),this.begin()}get#a(){return this.#t?.getSnapshot().context.doc}get#l(){return this.#t?.getSnapshot().value}#c(e,t){const r=Array.isArray(e)?e:[e];return _W(this.#t,i=>r.some(s=>i.matches(s)),{timeout:this.#s*2,...t})}#h(e){let t=null;if(this.#t.send({type:uC,payload:{callback:r=>{try{return e(r)}catch(i){return t=i,r}}}}),t)throw t}#u(e,t){const r=Is(e),i=Is(t);if(!dS(_a(i),_a(r))){this.emit("heads-changed",{handle:this,doc:t});const o=Nv(t,r,i);o.length>0&&this.emit("change",{handle:this,doc:t,patches:o,patchInfo:{before:e,after:t,source:"change"}}),this.isReady()||this.#t.send({type:cC})}this.#n=t}get url(){return NL({documentId:this.documentId,heads:this.#r})}isReady=()=>this.inState(["ready"]);isUnloaded=()=>this.inState(["unloaded"]);isDeleted=()=>this.inState(["deleted"]);isUnavailable=()=>this.inState(["unavailable"]);inState=e=>e.some(t=>this.#t.getSnapshot().matches(t));get state(){return this.#t.getSnapshot().value}async whenReady(e=["ready"],t){try{await lX(this.#c(e,t),this.#s)}catch(r){throw uX(r)?new ab:(console.log(`error waiting for ${this.documentId} to be in one of states: ${e.join(", ")}`),r)}}doc(){if(!this.isReady())throw new Error("DocHandle is not ready");return this.#r?AH(this.#a,Rc(this.#r)):this.#a}docSync(){return console.warn("docSync is deprecated. Use doc() instead. This function will be removed as part of the 2.0 release."),this.doc()}heads(){if(!this.isReady())throw new Error("DocHandle is not ready");return this.#r?this.#r:_a(Is(this.#a))}begin(){this.#t.send({type:fX})}history(){if(this.isReady())return QH(this.#a).map(e=>_a([e]))}view(e){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before calling view().`);const t=JSON.stringify(e),r=this.#o.get(t);if(r)return r;const i=new Ty(this.documentId,{heads:e,timeoutDelay:this.#s});return i.update(()=>my(this.#a)),i.doneLoading(),this.#o.set(t,i),i}diff(e,t){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before calling diff().`);const r=this.#a;if(!r)throw new Error("Document not available");if(e instanceof Ty){if(!e.isReady())throw new Error("Cannot diff against a handle that isn't ready");const o=e.heads();if(!o)throw new Error("Other document's heads not available");const a=OA(my(r),e.doc());return Nv(a,Rc(this.heads()),Rc(o))}const i=t?e:this.heads()||[],s=t||e;return Nv(r,Rc(i),Rc(s))}metadata(e){if(this.isReady())return e||(e=this.heads()[0]),$H(this.#a,Rc([e])[0])||void 0}update(e){this.#h(e)}doneLoading(){this.#t.send({type:cC})}setSyncInfo(e,t){this.#i[e]=t,this.emit("remote-heads",{storageId:e,heads:t.lastHeads,timestamp:t.lastSyncTimestamp})}getRemoteHeads(e){return this.#i[e]?.lastHeads}getSyncInfo(e){return this.#i[e]}change(e,t={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is in ${this.state} and not ready. Check \`handle.isReady()\` before accessing the document.`);if(this.#r)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);this.#h(r=>CH(r,t,e))}changeAt(e,t,r={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);if(this.#r)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);let i;return this.#h(s=>{const o=EH(s,Rc(e),r,t);return i=o.newHeads?_a(o.newHeads):void 0,o.newDoc}),i}isReadOnly(){return!!this.#r}merge(e){if(!this.isReady()||!e.isReady())throw new Error("Both handles must be ready to merge");if(this.#r)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);const t=e.doc();this.update(r=>OA(r,t))}unavailable(){this.#t.send({type:yX})}request(){this.#l==="loading"&&this.#t.send({type:pX})}unload(){this.#t.send({type:gX})}reload(){this.#t.send({type:mX})}delete(){this.#t.send({type:vX})}broadcast(e){this.emit("ephemeral-message-outbound",{handle:this,data:new Uint8Array(oX(e))})}metrics(){return Hk(this.#a)}}const dX={REQUESTING:"requesting",READY:"ready",UNLOADED:"unloaded",DELETED:"deleted",UNAVAILABLE:"unavailable"},{REQUESTING:Lm,READY:va,UNLOADED:hX,DELETED:Qm,UNAVAILABLE:_s}=dX,fX="BEGIN",pX="REQUEST",cC="DOC_READY",uC="UPDATE",gX="UNLOAD",mX="RELOAD",vX="DELETE",yX="DOC_UNAVAILABLE";class bX extends zu{#e=new Map;#t=new Set;#r=new Map;#n=new Set;#s=new Map;#i=Fu("automerge-repo:remote-heads-subscriptions");subscribeToRemotes(e){this.#i("subscribeToRemotes",e);const t=[];for(const r of e)this.#t.has(r)||(this.#t.add(r),t.push(r));t.length>0&&this.emit("change-remote-subs",{add:t,peers:Array.from(this.#n)})}unsubscribeFromRemotes(e){this.#i("subscribeToRemotes",e);const t=[];for(const r of e)this.#t.has(r)&&(this.#t.delete(r),this.#r.has(r)||t.push(r));t.length>0&&this.emit("change-remote-subs",{remove:t,peers:Array.from(this.#n)})}handleControlMessage(e){const t=[],r=[],i=[];if(this.#i("handleControlMessage",e),e.add)for(const s of e.add){let o=this.#r.get(s);(this.#t.has(s)||o)&&i.push(s),o||(o=new Set,this.#r.set(s,o),this.#t.has(s)||t.push(s)),o.add(e.senderId)}if(e.remove)for(const s of e.remove){const o=this.#r.get(s);o&&(o.delete(e.senderId),o.size==0&&!this.#t.has(s)&&r.push(s))}(t.length>0||r.length>0)&&this.emit("change-remote-subs",{peers:Array.from(this.#n),add:t,remove:r});for(const s of i){const o=this.#s.get(e.senderId);if(o)for(const a of o){const l=this.#e.get(a);if(!l)continue;const c=l.get(s);c&&this.emit("notify-remote-heads",{targetId:e.senderId,documentId:a,heads:c.lastHeads,timestamp:c.lastSyncTimestamp,storageId:s})}}}handleRemoteHeads(e){this.#i("handleRemoteHeads",e);const t=this.#a(e);for(const r of t)this.#t.has(r.storageId)&&this.emit("remote-heads-changed",r);for(const r of t)for(const i of this.#n)i!==e.senderId&&this.emit("notify-remote-heads",{targetId:i,documentId:r.documentId,heads:r.remoteHeads,timestamp:r.timestamp,storageId:r.storageId});for(const r of t){const i=this.#r.get(r.storageId);if(i)for(const s of i)this.#o(s,r.documentId)&&this.emit("notify-remote-heads",{targetId:s,documentId:r.documentId,heads:r.remoteHeads,timestamp:r.timestamp,storageId:r.storageId})}}handleImmediateRemoteHeadsChanged(e,t,r){this.#i("handleLocalHeadsChanged",e,t,r);const i=this.#e.get(e),s=Date.now();if(!i)this.#e.set(e,new Map([[t,{lastSyncTimestamp:s,lastHeads:r}]]));else{const a=i.get(t);(!a||a.lastSyncTimestamp<Date.now())&&i.set(t,{lastSyncTimestamp:Date.now(),lastHeads:r})}const o=this.#r.get(t);if(o)for(const a of o)this.#o(a,e)&&this.emit("notify-remote-heads",{targetId:a,documentId:e,heads:r,timestamp:s,storageId:t})}addGenerousPeer(e){this.#i("addGenerousPeer",e),this.#n.add(e),this.#t.size>0&&this.emit("change-remote-subs",{add:Array.from(this.#t),peers:[e]});for(const[t,r]of this.#e)for(const[i,{lastHeads:s,lastSyncTimestamp:o}]of r)this.emit("notify-remote-heads",{targetId:e,documentId:t,heads:s,timestamp:o,storageId:i})}removePeer(e){this.#i("removePeer",e);const t=[];this.#n.delete(e),this.#s.delete(e);for(const[r,i]of this.#r)i.has(e)&&(i.delete(e),i.size==0&&(t.push(r),this.#r.delete(r)));t.length>0&&this.emit("change-remote-subs",{remove:t,peers:Array.from(this.#n)})}subscribePeerToDoc(e,t){let r=this.#s.get(e);r||(r=new Set,this.#s.set(e,r)),r.add(t);const i=this.#e.get(t);if(i)for(const[s,o]of i){const a=this.#r.get(s);a&&a.has(e)&&this.emit("notify-remote-heads",{targetId:e,documentId:t,heads:o.lastHeads,timestamp:o.lastSyncTimestamp,storageId:s})}}#o(e,t){const r=this.#s.get(e);return r&&r.has(t)}#a(e){const t=[],{documentId:r,newHeads:i}=e;for(const[s,{heads:o,timestamp:a}]of Object.entries(i)){if(!this.#t.has(s)&&!this.#r.has(s))continue;let l=this.#e.get(r);l||(l=new Map,this.#e.set(r,l));const c=l.get(s);c&&c.lastSyncTimestamp>=a||(l.set(s,{lastSyncTimestamp:a,lastHeads:o}),t.push({documentId:r,storageId:s,remoteHeads:o,timestamp:a}))}return t}}const oO=(n,e)=>{let t=Date.now(),r,i;return function(...s){r=t+e-Date.now(),clearTimeout(i),i=setTimeout(()=>{n(...s),t=Date.now()},r)}},wX=n=>OX(n)||WL(n)||ZL(n)||_X(n)||xX(n)||kX(n),_X=n=>n.type==="doc-unavailable",ZL=n=>n.type==="request",OX=n=>n.type==="sync",WL=n=>n.type==="ephemeral",xX=n=>n.type==="remote-subscription-change",kX=n=>n.type==="remote-heads-changed",SX=n=>`${n.senderId}:${n.sessionId}`;class TX extends zu{peerId;peerMetadata;#e;#t={};#r=0;#n=Math.random().toString(36).slice(2);#s={};adapters=[];constructor(e,t,r){super(),this.peerId=t,this.peerMetadata=r,this.#e=Fu(`automerge-repo:network:${this.peerId}`),e.forEach(i=>this.addNetworkAdapter(i))}disconnect(){this.adapters.forEach(e=>e.disconnect())}reconnect(){this.adapters.forEach(e=>e.connect(this.peerId))}addNetworkAdapter(e){this.adapters.push(e),e.on("peer-candidate",({peerId:t,peerMetadata:r})=>{this.#e(`peer candidate: ${t} `),this.#t[t]||(this.#t[t]=e),this.emit("peer",{peerId:t,peerMetadata:r})}),e.on("peer-disconnected",({peerId:t})=>{this.#e(`peer disconnected: ${t} `),delete this.#t[t],this.emit("peer-disconnected",{peerId:t})}),e.on("message",t=>{if(!wX(t)){this.#e(`invalid message: ${JSON.stringify(t)}`);return}if(this.#e(`message from ${t.senderId}`),WL(t)){const r=SX(t);(this.#s[r]===void 0||t.count>this.#s[r])&&(this.#s[r]=t.count,this.emit("message",t));return}this.emit("message",t)}),e.on("close",()=>{this.#e("adapter closed"),Object.entries(this.#t).forEach(([t,r])=>{r===e&&delete this.#t[t]}),this.adapters=this.adapters.filter(t=>t!==e)}),this.peerMetadata.then(t=>{e.connect(this.peerId,t)}).catch(t=>{this.#e("error connecting to network",t)})}removeNetworkAdapter(e){this.adapters=this.adapters.filter(t=>t!==e),e.disconnect()}send(e){const t=this.#t[e.targetId];if(!t){this.#e(`Tried to send message but peer not found: ${e.targetId}`);return}const i=(s=>s.type==="ephemeral"?"count"in s?s:{...s,count:++this.#r,sessionId:this.#n,senderId:this.peerId}:{...s,senderId:this.peerId})(e);this.#e("sending message %o",i),t.send(i)}isReady=()=>this.adapters.every(e=>e.isReady());whenReady=async()=>Promise.all(this.adapters.map(e=>e.whenReady()))}function XL(n){let e=0;n.forEach(i=>{e+=i.length});const t=new Uint8Array(e);let r=0;return n.forEach(i=>{t.set(i,r),r+=i.length}),t}var Fv={exports:{}},AX=Fv.exports,dC;function CX(){return dC||(dC=1,(function(n){(function(e,t){var r={};t(r);var i=r.default;for(var s in r)i[s]=r[s];n.exports=i})(AX,function(e){e.__esModule=!0,e.digestLength=32,e.blockSize=64;var t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function r(f,p,g,m,v){for(var y,O,_,x,k,S,E,R,C,I,D,Q,M;v>=64;){for(y=p[0],O=p[1],_=p[2],x=p[3],k=p[4],S=p[5],E=p[6],R=p[7],I=0;I<16;I++)D=m+I*4,f[I]=(g[D]&255)<<24|(g[D+1]&255)<<16|(g[D+2]&255)<<8|g[D+3]&255;for(I=16;I<64;I++)C=f[I-2],Q=(C>>>17|C<<15)^(C>>>19|C<<13)^C>>>10,C=f[I-15],M=(C>>>7|C<<25)^(C>>>18|C<<14)^C>>>3,f[I]=(Q+f[I-7]|0)+(M+f[I-16]|0);for(I=0;I<64;I++)Q=(((k>>>6|k<<26)^(k>>>11|k<<21)^(k>>>25|k<<7))+(k&S^~k&E)|0)+(R+(t[I]+f[I]|0)|0)|0,M=((y>>>2|y<<30)^(y>>>13|y<<19)^(y>>>22|y<<10))+(y&O^y&_^O&_)|0,R=E,E=S,S=k,k=x+Q|0,x=_,_=O,O=y,y=Q+M|0;p[0]+=y,p[1]+=O,p[2]+=_,p[3]+=x,p[4]+=k,p[5]+=S,p[6]+=E,p[7]+=R,m+=64,v-=64}return m}var i=(function(){function f(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return f.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},f.prototype.clean=function(){for(var p=0;p<this.buffer.length;p++)this.buffer[p]=0;for(var p=0;p<this.temp.length;p++)this.temp[p]=0;this.reset()},f.prototype.update=function(p,g){if(g===void 0&&(g=p.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var m=0;if(this.bytesHashed+=g,this.bufferLength>0){for(;this.bufferLength<64&&g>0;)this.buffer[this.bufferLength++]=p[m++],g--;this.bufferLength===64&&(r(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(g>=64&&(m=r(this.temp,this.state,p,m,g),g%=64);g>0;)this.buffer[this.bufferLength++]=p[m++],g--;return this},f.prototype.finish=function(p){if(!this.finished){var g=this.bytesHashed,m=this.bufferLength,v=g/536870912|0,y=g<<3,O=g%64<56?64:128;this.buffer[m]=128;for(var _=m+1;_<O-8;_++)this.buffer[_]=0;this.buffer[O-8]=v>>>24&255,this.buffer[O-7]=v>>>16&255,this.buffer[O-6]=v>>>8&255,this.buffer[O-5]=v>>>0&255,this.buffer[O-4]=y>>>24&255,this.buffer[O-3]=y>>>16&255,this.buffer[O-2]=y>>>8&255,this.buffer[O-1]=y>>>0&255,r(this.temp,this.state,this.buffer,0,O),this.finished=!0}for(var _=0;_<8;_++)p[_*4+0]=this.state[_]>>>24&255,p[_*4+1]=this.state[_]>>>16&255,p[_*4+2]=this.state[_]>>>8&255,p[_*4+3]=this.state[_]>>>0&255;return this},f.prototype.digest=function(){var p=new Uint8Array(this.digestLength);return this.finish(p),p},f.prototype._saveState=function(p){for(var g=0;g<this.state.length;g++)p[g]=this.state[g]},f.prototype._restoreState=function(p,g){for(var m=0;m<this.state.length;m++)this.state[m]=p[m];this.bytesHashed=g,this.finished=!1,this.bufferLength=0},f})();e.Hash=i;var s=(function(){function f(p){this.inner=new i,this.outer=new i,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var g=new Uint8Array(this.blockSize);if(p.length>this.blockSize)new i().update(p).finish(g).clean();else for(var m=0;m<p.length;m++)g[m]=p[m];for(var m=0;m<g.length;m++)g[m]^=54;this.inner.update(g);for(var m=0;m<g.length;m++)g[m]^=106;this.outer.update(g),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var m=0;m<g.length;m++)g[m]=0}return f.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},f.prototype.clean=function(){for(var p=0;p<this.istate.length;p++)this.ostate[p]=this.istate[p]=0;this.inner.clean(),this.outer.clean()},f.prototype.update=function(p){return this.inner.update(p),this},f.prototype.finish=function(p){return this.outer.finished?this.outer.finish(p):(this.inner.finish(p),this.outer.update(p,this.digestLength).finish(p)),this},f.prototype.digest=function(){var p=new Uint8Array(this.digestLength);return this.finish(p),p},f})();e.HMAC=s;function o(f){var p=new i().update(f),g=p.digest();return p.clean(),g}e.hash=o,e.default=o;function a(f,p){var g=new s(f).update(p),m=g.digest();return g.clean(),m}e.hmac=a;function l(f,p,g,m){var v=m[0];if(v===0)throw new Error("hkdf: cannot expand more");p.reset(),v>1&&p.update(f),g&&p.update(g),p.update(m),p.finish(f),m[0]++}var c=new Uint8Array(e.digestLength);function d(f,p,g,m){p===void 0&&(p=c),m===void 0&&(m=32);for(var v=new Uint8Array([1]),y=a(p,f),O=new s(y),_=new Uint8Array(O.digestLength),x=_.length,k=new Uint8Array(m),S=0;S<m;S++)x===_.length&&(l(_,O,g,v),x=0),k[S]=_[x++];return O.clean(),_.fill(0),v.fill(0),k}e.hkdf=d;function h(f,p,g,m){for(var v=new s(f),y=v.digestLength,O=new Uint8Array(4),_=new Uint8Array(y),x=new Uint8Array(y),k=new Uint8Array(m),S=0;S*y<m;S++){var E=S+1;O[0]=E>>>24&255,O[1]=E>>>16&255,O[2]=E>>>8&255,O[3]=E>>>0&255,v.reset(),v.update(p),v.update(O),v.finish(x);for(var R=0;R<y;R++)_[R]=x[R];for(var R=2;R<=g;R++){v.reset(),v.update(x).finish(x);for(var C=0;C<y;C++)_[C]^=x[C]}for(var R=0;R<y&&S*y+R<m;R++)k[S*y+R]=_[R]}for(var S=0;S<y;S++)_[S]=x[S]=0;for(var S=0;S<4;S++)O[S]=0;return v.clean(),k}e.pbkdf2=h})})(Fv)),Fv.exports}var EX=CX();function YL(n){const e=EX.hash(n);return IX(e)}function PX(n){const e=new TextEncoder,t=XL(n.map(r=>e.encode(r)));return YL(t)}function IX(n){return Array.from(n,e=>e.toString(16).padStart(2,"0")).join("")}class MX extends zu{#e;#t=new Map;#r=new Map;#n=!1;#s=Fu("automerge-repo:storage-subsystem");constructor(e){super(),this.#e=e}async id(){const e=await this.#e.load(["storage-adapter-id"]);let t;return e?t=new TextDecoder().decode(e):(t=ML(),await this.#e.save(["storage-adapter-id"],new TextEncoder().encode(t))),t}async load(e,t){const r=[e,t];return await this.#e.load(r)}async save(e,t,r){const i=[e,t];await this.#e.save(i,r)}async remove(e,t){const r=[e,t];await this.#e.remove(r)}async loadDocData(e){const t=await this.#e.loadRange([e,"snapshot"]),r=await this.#e.loadRange([e,"incremental"]),i=[],s=[];for(const o of t)o.data!==void 0&&(s.push({key:o.key,type:"snapshot",size:o.data.length}),i.push(o.data));for(const o of r)o.data!==void 0&&(s.push({key:o.key,type:"incremental",size:o.data.length}),i.push(o.data));return this.#r.set(e,s),i.length===0?null:XL(i)}async loadDoc(e){const t=await this.loadDocData(e);if(!t)return null;const r=performance.now(),i=qk(lo(),t),s=performance.now();return this.emit("document-loaded",{documentId:e,durationMillis:s-r,...Hk(i)}),this.#t.set(e,Is(i)),i}async saveDoc(e,t){if(!this.#a(e,t))return;const r=this.#r.get(e)??[];this.#l(r)?await this.#o(e,t,r):await this.#i(e,t),this.#t.set(e,Is(t))}async removeDoc(e){await this.#e.removeRange([e,"snapshot"]),await this.#e.removeRange([e,"incremental"]),await this.#e.removeRange([e,"sync-state"])}async#i(e,t){const r=this.#t.get(e)??[],i=performance.now(),s=LH(t,r),o=performance.now();if(this.emit("doc-saved",{documentId:e,durationMillis:o-i,sinceHeads:r}),s&&s.length>0){const a=[e,"incremental",YL(s)];this.#s(`Saving incremental ${a} for document ${e}`),await this.#e.save(a,s),this.#r.has(e)||this.#r.set(e,[]),this.#r.get(e).push({key:a,type:"incremental",size:s.length}),this.#t.set(e,Is(t))}else return Promise.resolve()}async#o(e,t,r){this.#n=!0;const i=performance.now(),s=eL(t),o=performance.now();this.emit("doc-compacted",{documentId:e,durationMillis:o-i});const a=PX(Is(t)),l=[e,"snapshot",a],c=new Set(r.map(h=>h.key).filter(h=>h[2]!==a));this.#s(`Saving snapshot ${l} for document ${e}`),this.#s(`deleting old chunks ${Array.from(c)}`),await this.#e.save(l,s);for(const h of c)await this.#e.remove(h);const d=this.#r.get(e)?.filter(h=>!c.has(h.key))??[];d.push({key:l,type:"snapshot",size:s.length}),this.#r.set(e,d),this.#n=!1}async loadSyncState(e,t){const r=[e,"sync-state",t];try{const i=await this.#e.load(r);return i?nL(i):void 0}catch{this.#s(`Error loading sync state for ${e} from ${t}`);return}}async saveSyncState(e,t,r){const i=[e,"sync-state",t];await this.#e.save(i,tL(r))}#a(e,t){const r=this.#t.get(e);if(!r)return!0;const i=Is(t);return!dS(_a(i),_a(r))}#l(e){if(this.#n)return!1;let t=0,r=0;for(const i of e)i.type==="snapshot"?t+=i.size:r+=i.size;return t<1024||r>=t}}class GL extends zu{}class RX extends GL{#e;syncDebounceRate=100;#t=[];#r={};#n={};#s={};#i=[];#o;#a=!1;#l;#c;constructor({handle:e,peerId:t,onLoadSyncState:r}){super(),this.#o=t,this.#l=e,this.#c=r??(()=>Promise.resolve(void 0));const i=e.documentId.slice(0,5);this.#e=Fu(`automerge-repo:docsync:${i}`),e.on("change",oO(()=>this.#h(),this.syncDebounceRate)),e.on("ephemeral-message-outbound",s=>this.#u(s)),(async()=>this.#k())()}get peerStates(){return this.#n}get documentId(){return this.#l.documentId}async#h(){try{await this.#l.whenReady();const e=this.#l.doc();this.#t.forEach(t=>this.#y(t,e))}catch{console.log("sync with peers threw an exception")}}async#u({data:e}){this.#e("broadcastToPeers",this.#t),this.#t.forEach(t=>this.#p(t,e))}#p(e,t){this.#e(`sendEphemeralMessage ->${e}`);const r={type:"ephemeral",targetId:e,documentId:this.#l.documentId,data:t};this.emit("message",r)}#m(e,t){this.#f(e),e in this.#n||(this.#n[e]="unknown");const r=this.#s[e];if(r){t(r);return}let i=this.#r[e];i||(this.#c(e).then(s=>{this.#d(e,s??DH())}).catch(s=>{this.#e(`Error loading sync state for ${e}: ${s}`)}),i=this.#r[e]=[]),i.push(t)}#f(e){this.#t.includes(e)||(this.#t.push(e),this.emit("open-doc",{documentId:this.documentId,peerId:e}))}#d(e,t){const r=this.#r[e];if(r)for(const i of r)i(t);delete this.#r[e],this.#s[e]=t}#g(e,t){this.#s[e]=t,this.emit("sync-state",{peerId:e,syncState:t,documentId:this.#l.documentId})}#y(e,t){this.#e(`sendSyncMessage ->${e}`),this.#m(e,r=>{const i=performance.now(),[s,o]=MH(t,r),a=performance.now();if(this.emit("metrics",{type:"generate-sync-message",documentId:this.#l.documentId,durationMillis:a-i,forPeer:e}),this.#g(e,s),o){const l=Is(t).length===0;!this.#l.isReady()&&l&&s.sharedHeads.length===0&&!Object.values(this.#n).includes("has")&&this.#n[e]==="unknown"?this.emit("message",{type:"request",targetId:e,documentId:this.#l.documentId,data:o}):this.emit("message",{type:"sync",targetId:e,data:o,documentId:this.#l.documentId}),l||(this.#n[e]="has")}})}hasPeer(e){return this.#t.includes(e)}async beginSync(e){this.#l.whenReady([va,Lm,_s]).then(()=>{this.#a=!0,this.#v()}).catch(r=>{console.log("caught whenready",r),this.#a=!0,this.#v()}),this.#t.some(r=>this.#n[r]=="has")&&await this.#l.whenReady(),e.forEach(r=>{this.#m(r,i=>{const s=nL(tL(i));this.#g(r,s),this.#l.whenReady([va,Lm,_s]).then(()=>{const o=this.#l.isReady()?this.#l.doc():lo(),a=e.every(c=>this.#n[c]in["unavailable","wants"]);o===void 0&&a||this.#y(r,o??lo())}).catch(o=>{this.#e(`Error loading doc for ${r}: ${o}`)})})})}endSync(e){this.#e(`removing peer ${e}`),this.#t=this.#t.filter(t=>t!==e),delete this.#n[e],this.#v()}receiveMessage(e){switch(e.type){case"sync":case"request":this.receiveSyncMessage(e);break;case"ephemeral":this.receiveEphemeralMessage(e);break;case"doc-unavailable":this.#n[e.senderId]="unavailable",this.#v();break;default:throw new Error(`unknown message type: ${e}`)}}receiveEphemeralMessage(e){if(e.documentId!==this.#l.documentId)throw new Error("channelId doesn't match documentId");const{senderId:t,data:r}=e,i=JW(new Uint8Array(r));this.#l.emit("ephemeral-message",{handle:this.#l,senderId:t,message:i}),this.#t.forEach(s=>{s!==t&&this.emit("message",{...e,targetId:s})})}receiveSyncMessage(e){if(e.documentId!==this.#l.documentId)throw new Error("channelId doesn't match documentId");if(!this.#l.inState([va,Lm,_s])){this.#i.push({message:e,received:new Date});return}this.#k(),this.#b(e)}#b(e){ZL(e)&&(this.#n[e.senderId]="wants"),this.#v(),NH(e.data).heads.length>0&&(this.#n[e.senderId]="has"),this.#m(e.senderId,t=>{this.#l.update(r=>{const i=performance.now(),[s,o]=RH(r,t,e.data),a=performance.now();return this.emit("metrics",{type:"receive-sync-message",documentId:this.#l.documentId,durationMillis:a-i,fromPeer:e.senderId,...Hk(r)}),this.#g(e.senderId,o),this.#y(e.senderId,r),s}),this.#v()})}#v(){this.#a&&this.#l.inState([Lm,_s])&&this.#t.every(e=>this.#n[e]==="unavailable"||this.#n[e]==="wants")&&(this.#t.filter(e=>this.#n[e]==="wants").forEach(e=>{this.#n[e]="unavailable";const t={type:"doc-unavailable",documentId:this.#l.documentId,targetId:e};this.emit("message",t)}),this.#l.unavailable())}#k(){for(const e of this.#i)this.#b(e.message);this.#i=[]}metrics(){return{peers:this.#t,size:this.#l.metrics()}}}const $l=Fu("automerge-repo:collectionsync");class DX extends GL{repo;#e=new Set;docSynchronizers={};#t={};#r;#n=new Map;constructor(e,t=[]){super(),this.repo=e,this.#r=t.map(r=>Jd(r).documentId)}#s(e){return this.docSynchronizers[e.documentId]||(this.docSynchronizers[e.documentId]=this.#i(e)),this.docSynchronizers[e.documentId]}#i(e){const t=new RX({handle:e,peerId:this.repo.networkSubsystem.peerId,onLoadSyncState:async r=>{if(!this.repo.storageSubsystem)return;const{storageId:i,isEphemeral:s}=this.repo.peerMetadataByPeerId[r]||{};if(!(!i||s))return this.repo.storageSubsystem.loadSyncState(e.documentId,i)}});return t.on("message",r=>this.emit("message",r)),t.on("open-doc",r=>this.emit("open-doc",r)),t.on("sync-state",r=>this.emit("sync-state",r)),t.on("metrics",r=>this.emit("metrics",r)),t}async#o(e){const t=Array.from(this.#e),r=[];for(const i of t)await this.#a(i,e)&&r.push(i);return r}async receiveMessage(e){$l(`onSyncMessage: ${e.senderId}, ${e.documentId}, ${"data"in e?e.data.byteLength+"bytes":""}`);const t=e.documentId;if(!t)throw new Error("received a message with an invalid documentId");if(this.#r.includes(t)){this.emit("metrics",{type:"doc-denied",documentId:t}),this.emit("message",{type:"doc-unavailable",documentId:t,targetId:e.senderId});return}if(e.type==="request"&&(this.#n.has(t)||this.#n.set(t,new Set),this.#n.get(t)?.add(e.senderId)),!await this.repo.shareConfig.access(e.senderId,t)){$l("access denied"),this.emit("message",{type:"doc-unavailable",documentId:t,targetId:e.senderId});return}this.#t[t]=!0;const i=await this.repo.find(t,{allowableStates:["ready","unavailable","requesting"]}),s=this.#s(i);s.receiveMessage(e);const o=await this.#o(t);s.beginSync(o.filter(a=>!s.hasPeer(a)))}addDocument(e){if(this.#t[e.documentId])return;this.#t[e.documentId]=!0;const t=this.#s(e);this.#o(e.documentId).then(r=>{t.beginSync(r)})}removeDocument(e){$l(`removing document ${e}`);const t=this.docSynchronizers[e];t!==void 0&&this.peers.forEach(r=>t.endSync(r)),delete this.docSynchronizers[e],delete this.#t[e]}addPeer(e){if($l(`adding ${e} & synchronizing with them`),!this.#e.has(e)){this.#e.add(e);for(const t of Object.values(this.docSynchronizers)){const{documentId:r}=t;this.#a(e,r).then(i=>{i&&t.beginSync([e])})}}}removePeer(e){$l(`removing peer ${e}`),this.#e.delete(e);for(const t of this.#n.values())t.delete(e);for(const t of Object.values(this.docSynchronizers))t.endSync(e)}get peers(){return Array.from(this.#e)}async reevaluateDocumentShare(){const e=Array.from(this.#e),t=[];for(const r of Object.values(this.docSynchronizers)){const i=r.documentId;t.push((async()=>{for(const s of e){const o=await this.#a(s,i),a=r.hasPeer(s);$l(`reevaluateDocumentShare: ${s} for ${i}, shouldShare: ${o}, isAlreadySyncing: ${a}`),o&&!a?($l(`reevaluateDocumentShare: starting sync with ${s} for ${i}`),r.beginSync([s])):!o&&a&&($l(`reevaluateDocumentShare: stopping sync with ${s} for ${i}`),r.endSync(s))}})().catch(s=>{console.log(`error reevaluating document share for ${i}: ${s}`)}))}await Promise.allSettled(t)}metrics(){return Object.fromEntries(Object.entries(this.docSynchronizers).map(([e,t])=>[e,t.metrics()]))}async#a(e,t){const[r,i]=await Promise.all([this.repo.shareConfig.announce(e,t),this.repo.shareConfig.access(e,t)]),s=this.#n.get(t)?.has(e)??!1;return r||i&&s}}function NX(){return"peer-"+Math.random().toString(36).slice(4)}class LX extends zu{#e;networkSubsystem;storageSubsystem;#t;#r;#n={};synchronizer;#s={announce:async()=>!0,access:async()=>!0};peerMetadataByPeerId={};#i=new bX;#o=!1;#a={};#l={};#c;constructor({storage:e,network:t=[],peerId:r=NX(),sharePolicy:i,shareConfig:s,isEphemeral:o=e===void 0,enableRemoteHeadsGossiping:a=!1,denylist:l=[],saveDebounceRate:c=100,idFactory:d}={}){if(super(),this.#o=a,this.#e=Fu("automerge-repo:repo"),this.#c=d||null,i!=null&&s!=null)throw new Error("cannot provide both sharePolicy and shareConfig at once");i&&(this.#s={announce:i,access:async()=>!0}),s&&(this.#s=s),this.on("delete-document",({documentId:g})=>{this.synchronizer.removeDocument(g),h&&h.removeDoc(g).catch(m=>{this.#e("error deleting document",{documentId:g,err:m})})}),this.synchronizer=new DX(this,l),this.synchronizer.on("message",g=>{this.#e(`sending ${g.type} message to ${g.targetId}`),p.send(g)}),this.synchronizer.on("metrics",g=>this.emit("doc-metrics",g)),this.#o&&this.synchronizer.on("open-doc",({peerId:g,documentId:m})=>{this.#i.subscribePeerToDoc(g,m)});const h=e?new MX(e):void 0;h&&(h.on("document-loaded",g=>this.emit("doc-metrics",{type:"doc-loaded",...g})),h.on("doc-compacted",g=>this.emit("doc-metrics",{type:"doc-compacted",...g})),h.on("doc-saved",g=>this.emit("doc-metrics",{type:"doc-saved",...g}))),this.storageSubsystem=h,this.#t=c,this.storageSubsystem?this.#r=({handle:g,doc:m})=>{let v=this.#l[g.documentId];v||(v=oO(({doc:y,handle:O})=>{this.storageSubsystem.saveDoc(O.documentId,y)},this.#t),this.#l[g.documentId]=v),v({handle:g,doc:m})}:this.#r=()=>{};const f=(async()=>({storageId:await h?.id(),isEphemeral:o}))(),p=new TX(t,r,f);this.networkSubsystem=p,p.on("peer",async({peerId:g,peerMetadata:m})=>{this.#e("peer connected",{peerId:g}),m&&(this.peerMetadataByPeerId[g]={...m}),this.#s.announce(g).then(v=>{v&&this.#o&&this.#i.addGenerousPeer(g)}).catch(v=>{console.log("error in share policy",{err:v})}),this.synchronizer.addPeer(g)}),p.on("peer-disconnected",({peerId:g})=>{this.synchronizer.removePeer(g),this.#i.removePeer(g)}),p.on("message",async g=>{this.#u(g)}),this.synchronizer.on("sync-state",g=>{this.#m(g);const m=this.#n[g.documentId],{storageId:v}=this.peerMetadataByPeerId[g.peerId]||{};if(!v)return;const y=m.getSyncInfo(v)?.lastHeads;g.syncState.theirHeads&&(!y||!dS(y,_a(g.syncState.theirHeads)))&&g.syncState.theirHeads&&(m.setSyncInfo(v,{lastHeads:_a(g.syncState.theirHeads),lastSyncTimestamp:Date.now()}),v&&this.#o&&this.#i.handleImmediateRemoteHeadsChanged(g.documentId,v,_a(g.syncState.theirHeads)))}),this.#o&&(this.#i.on("notify-remote-heads",g=>{this.networkSubsystem.send({type:"remote-heads-changed",targetId:g.targetId,documentId:g.documentId,newHeads:{[g.storageId]:{heads:g.heads,timestamp:g.timestamp}}})}),this.#i.on("change-remote-subs",g=>{this.#e("change-remote-subs",g);for(const m of g.peers)this.networkSubsystem.send({type:"remote-subscription-change",targetId:m,add:g.add,remove:g.remove})}),this.#i.on("remote-heads-changed",({documentId:g,storageId:m,remoteHeads:v,timestamp:y})=>{this.#n[g].setSyncInfo(m,{lastHeads:v,lastSyncTimestamp:y})}))}#h(e){this.storageSubsystem&&(e.listeners("heads-changed").some(r=>r===this.#r)||e.on("heads-changed",this.#r)),this.synchronizer.addDocument(e)}#u(e){switch(e.type){case"remote-subscription-change":this.#o&&this.#i.handleControlMessage(e);break;case"remote-heads-changed":this.#o&&this.#i.handleRemoteHeads(e);break;case"sync":case"request":case"ephemeral":case"doc-unavailable":this.synchronizer.receiveMessage(e).catch(t=>{console.log("error receiving message",{err:t,message:e})})}}#p={};#m(e){if(!this.storageSubsystem)return;const{storageId:t,isEphemeral:r}=this.peerMetadataByPeerId[e.peerId]||{};if(!t||r)return;let i=this.#p[t];i||(i=this.#p[t]=oO(({documentId:s,syncState:o})=>{this.storageSubsystem.saveSyncState(s,t,o)},this.#t)),i(e)}#f({documentId:e}){if(this.#n[e])return this.#n[e];if(!e)throw new Error(`Invalid documentId ${e}`);const t=new Ty(e);return this.#n[e]=t,t}get handles(){return this.#n}get peers(){return this.synchronizer.peers}get peerId(){return this.networkSubsystem.peerId}get sharePolicy(){return this.#s.announce}set sharePolicy(e){this.#s.announce=e}get shareConfig(){return this.#s}set shareConfig(e){this.#s=e}getStorageIdOfPeer(e){return this.peerMetadataByPeerId[e]?.storageId}create(e){let t;e?t=wA(e):t=_A(lo());const{documentId:r}=Jd(YA()),i=this.#f({documentId:r});return this.#h(i),i.update(()=>t),i.doneLoading(),i}async create2(e){let t;e?t=wA(e):t=_A(lo());let{documentId:r}=Jd(YA());if(this.#c){const s=await this.#c(Is(t));r=zp(s)}const i=this.#f({documentId:r});return this.#h(i),i.update(()=>t),i.doneLoading(),i}clone(e){if(!e.isReady())throw new Error(`Cloned handle is not yet in ready state.
        (Try await handle.whenReady() first.)`);const t=e.doc(),r=this.create();return r.update(()=>my(t)),r}findWithProgress(e,t={}){const{signal:r}=t,{documentId:i,heads:s}=LL(e)?Jd(e):{documentId:Rm(e),heads:void 0};if(this.#n[i]){const h=this.#n[i];if(h.state===_s)return{state:"unavailable",error:new Error(`Document ${e} is unavailable`),handle:h};if(h.state===Qm)return{state:"failed",error:new Error(`Document ${e} was deleted`),handle:h};if(h.state===va)return{state:"ready",handle:s?h.view(s):h}}const o=this.#a[i];if(o){const h=this.#n[i];if(h&&(h.state===va||h.state===_s||h.state===Qm||h.state==="loading"))return o}const a=this.#f({documentId:i}),l={state:"loading",progress:0,handle:a},c={subscribers:new Set,currentProgress:void 0,notify:h=>{c.currentProgress=h,c.subscribers.forEach(f=>f(h)),this.#a[i]=h},peek:()=>c.currentProgress||l,subscribe:h=>(c.subscribers.add(h),()=>c.subscribers.delete(h))};c.notify(l),this.#d(e,i,a,c,r?lC(new Promise(()=>{}),r):new Promise(()=>{}));const d={...l,peek:c.peek,subscribe:c.subscribe};return this.#a[i]=d,d}async#d(e,t,r,i,s){try{i.notify({state:"loading",progress:25,handle:r});const o=await(this.storageSubsystem?this.storageSubsystem.loadDoc(r.documentId):Promise.resolve(null)),a=await Promise.race([o,s]);if(a?(r.update(()=>a),r.doneLoading(),i.notify({state:"loading",progress:50,handle:r})):(await Promise.race([this.networkSubsystem.whenReady(),s]),r.request(),i.notify({state:"loading",progress:75,handle:r})),this.#h(r),await Promise.race([r.whenReady([va,_s]),s]),r.state===_s){const l={state:"unavailable",handle:r};i.notify(l);return}if(r.state===Qm)throw new Error(`Document ${e} was deleted`);i.notify({state:"ready",handle:r})}catch(o){i.notify({state:"failed",error:o instanceof Error||o instanceof DOMException?o:new Error(String(o)),handle:this.#f({documentId:t})})}}async find(e,t={}){const{allowableStates:r=["ready"],signal:i}=t;if(i?.aborted)throw new ab;const s=this.findWithProgress(e,{signal:i});if("subscribe"in s)return this.#h(s.handle),new Promise((o,a)=>{const l=s.subscribe(c=>{r.includes(c.handle.state)?(l(),o(c.handle)):c.state==="unavailable"?(l(),a(new Error(`Document ${e} is unavailable`))):c.state==="failed"&&(l(),a(c.error))})});if(s.handle.state===va)return s.handle;if(await s.handle.whenReady([va,_s]),s.handle.state==="unavailable"&&!r.includes(_s))throw new Error(`Document ${e} is unavailable`);return s.handle}async#g(e){if(this.#n[e])return this.#n[e];const t=this.#f({documentId:e}),r=await(this.storageSubsystem?this.storageSubsystem.loadDoc(t.documentId):Promise.resolve(null));return r?(t.update(()=>r),t.doneLoading()):(await this.networkSubsystem.whenReady(),t.request()),this.#h(t),t}async findClassic(e,t={}){const r=Rm(e),{allowableStates:i,signal:s}=t;return lC((async()=>{const o=await this.#g(r);if(!i&&(await o.whenReady([va,_s]),o.state===_s&&!s?.aborted))throw new Error(`Document ${e} is unavailable`);return o})(),s)}delete(e){const t=Rm(e);this.#f({documentId:t}).delete(),delete this.#n[t],delete this.#a[t],delete this.#l[t],this.emit("delete-document",{documentId:t})}async export(e){const t=Rm(e),i=this.#f({documentId:t}).doc();return eL(i)}import(e,t){const r=t?.docId;if(r!=null){const i=this.#f({documentId:r});return i.update(s=>qk(s,e)),this.#h(i),i}else{const i=PH(e),s=this.create();return s.update(()=>my(i)),s}}subscribeToRemotes=e=>{this.#o?(this.#e("subscribeToRemotes",{remotes:e}),this.#i.subscribeToRemotes(e)):this.#e("WARN: subscribeToRemotes called but remote heads gossiping is not enabled")};storageId=async()=>{if(this.storageSubsystem)return this.storageSubsystem.id()};async flush(e){if(!this.storageSubsystem)return;const t=e?e.map(r=>this.#n[r]):Object.values(this.#n);await Promise.all(t.map(async r=>this.storageSubsystem.saveDoc(r.documentId,r.doc())))}async removeFromCache(e){if(!this.#n[e]){this.#e(`WARN: removeFromCache called but handle not found in handleCache for documentId: ${e}`);return}const t=this.#f({documentId:e});await t.whenReady([va,hX,Qm,_s]),t.doc()?(t.isReady()?t.unload():this.#e(`WARN: removeFromCache called but handle for documentId: ${e} in unexpected state: ${t.state}`),delete this.#n[e],delete this.#a[e],delete this.#l[e],this.synchronizer.removeDocument(e)):this.#e(`WARN: removeFromCache called but doc undefined for documentId: ${e}`)}shutdown(){return this.networkSubsystem.adapters.forEach(e=>{e.disconnect()}),this.flush()}metrics(){return{documents:this.synchronizer.metrics()}}shareConfigChanged(){this.synchronizer.reevaluateDocumentShare()}}class QX extends zu{peerId;peerMetadata}class $X{database;store;dbPromise;constructor(e="automerge",t="documents"){this.database=e,this.store=t,this.dbPromise=this.createDatabasePromise()}createDatabasePromise(){return new Promise((e,t)=>{const r=indexedDB.open(this.database,1);r.onerror=()=>{t(r.error)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this.store)},r.onsuccess=i=>{const s=i.target.result;e(s)}})}async load(e){const r=(await this.dbPromise).transaction(this.store),s=r.objectStore(this.store).get(e);return new Promise((o,a)=>{r.onerror=()=>{a(s.error)},s.onsuccess=l=>{const c=l.target.result;c&&typeof c=="object"&&"binary"in c?o(c.binary):o(void 0)}})}async save(e,t){const i=(await this.dbPromise).transaction(this.store,"readwrite");return i.objectStore(this.store).put({key:e,binary:t},e),new Promise((o,a)=>{i.onerror=()=>{a(i.error)},i.oncomplete=()=>{o()}})}async remove(e){const r=(await this.dbPromise).transaction(this.store,"readwrite");return r.objectStore(this.store).delete(e),new Promise((s,o)=>{r.onerror=()=>{o(r.error)},r.oncomplete=()=>{s()}})}async loadRange(e){const t=await this.dbPromise,r=e,i=[...e,"ï¿¿"],s=IDBKeyRange.bound(r,i),o=t.transaction(this.store),l=o.objectStore(this.store).openCursor(s),c=[];return new Promise((d,h)=>{o.onerror=()=>{h(l.error)},l.onsuccess=f=>{const p=f.target.result;p?(c.push({data:p.value.binary,key:p.key}),p.continue()):d(c)}})}async removeRange(e){const t=await this.dbPromise,r=e,i=[...e,"ï¿¿"],s=IDBKeyRange.bound(r,i),o=t.transaction(this.store,"readwrite");return o.objectStore(this.store).delete(s),new Promise((l,c)=>{o.onerror=()=>{c(o.error)},o.oncomplete=()=>{l()}})}}class FX extends QX{ready=!1;readyResolve;readyPromise;remotePeerId;electronSync;constructor(e){super(),this.readyPromise=new Promise(t=>{this.readyResolve=t}),this.electronSync=e}connect(e,t){this.peerId=e,this.peerMetadata=t,this.electronSync.onRepoMessage(r=>{this.handleMessage(r)}),this.electronSync.sendRepoMessage({type:"arrive",peerId:e,peerMetadata:t})}handleMessage(e){switch(e.type){case"welcome":this.remotePeerId=e.peerId,this.ready||(this.ready=!0,this.readyResolve?.()),this.emit("peer-candidate",{peerId:e.peerId,peerMetadata:e.peerMetadata||{}});break;case"arrive":this.remotePeerId=e.peerId,this.electronSync.sendRepoMessage({type:"welcome",peerId:this.peerId,peerMetadata:this.peerMetadata}),this.ready||(this.ready=!0,this.readyResolve?.()),this.emit("peer-candidate",{peerId:e.peerId,peerMetadata:e.peerMetadata||{}});break;case"leave":this.emit("peer-disconnected",{peerId:e.peerId});break;case"message":{const t=this.deserializeMessage(e.data);this.emit("message",t);break}}}send(e){this.electronSync.sendRepoMessage({type:"message",data:this.serializeMessage(e)})}disconnect(){this.electronSync.sendRepoMessage({type:"leave",peerId:this.peerId}),this.remotePeerId&&this.emit("peer-disconnected",{peerId:this.remotePeerId}),this.electronSync.removeRepoMessageListener()}isReady(){return this.ready}whenReady(){return this.readyPromise}serializeMessage(e){const t={senderId:e.senderId,targetId:e.targetId,type:e.type};return"documentId"in e&&e.documentId&&(t.documentId=e.documentId),"data"in e&&e.data&&(t.data=Array.from(e.data)),t}deserializeMessage(e){const t={senderId:e.senderId,targetId:e.targetId,type:e.type};return e.documentId&&(t.documentId=e.documentId),e.data&&(t.data=new Uint8Array(e.data)),t}}const KL=typeof window<"u"&&!!window.api?.automergeSync;function lb(){return KL&&window.api?.automergeSync||null}let Dd=null;const aO=new Map;let wa=null;const hS="flint-vaults",fS="flint-active-vault-id",lO="ws-default",JL="type-default";function zX(){if(Dd)return Dd;const n=new $X("flint-notes");return Dd=new LX({storage:n}),Dd}function Zo(){if(!Dd)throw new Error("Repo not initialized. Call createRepo() first.");return Dd}function BX(){return{id:lO,name:"Default",icon:"ð",pinnedItemIds:[],recentItemIds:[],created:Wt()}}function UX(){return{id:JL,name:"Note",purpose:"General purpose notes",icon:"ð",archived:!1,created:Wt()}}function jX(n){return n.create({notes:{},workspaces:{[lO]:BX()},activeWorkspaceId:lO,noteTypes:{[JL]:UX()}})}async function e4(n,e){const t=await n.find(e);if(await t.whenReady(),!t.isReady())throw new Error(`Document ${e} is unavailable`);return t}function sc(){const n=localStorage.getItem(hS);return n?JSON.parse(n):[]}function Ou(n){localStorage.setItem(hS,JSON.stringify(n))}function VX(){return localStorage.getItem(fS)}function pS(n){localStorage.setItem(fS,n)}function qX(n,e,t){const r=jX(n),i={id:Zk(),name:e,docUrl:r.url,archived:!1,created:Wt(),...t&&{baseDirectory:t}},s=sc();return s.push(i),Ou(s),i}function t4(n,e){const t=sc(),r=t.findIndex(i=>i.id===n);r!==-1&&(t[r]={...t[r],...e},Ou(t))}function HX(){localStorage.removeItem(hS),localStorage.removeItem(fS)}async function ZX(n){const e=sc(),t=VX();if(e.length===0)return{vaults:[],activeVault:null};const r=e.filter(s=>!s.archived);if(r.length===0)return{vaults:e,activeVault:null};let i=r.find(s=>s.id===t);return i||(i=r[0],pS(i.id)),{vaults:e,activeVault:i}}async function cb(n,e){const t=lb();if(!(!t||!e.baseDirectory)){wa&&wa!==e.id&&await n4();try{await t.initVaultSync({vaultId:e.id,baseDirectory:e.baseDirectory,docUrl:e.docUrl,vaultName:e.name});const r=new FX(t);aO.set(e.id,r),n.networkSubsystem.addNetworkAdapter(r),wa=e.id,console.log(`[Renderer] Connected vault sync: ${e.id}`)}catch(r){console.error("[Renderer] Failed to connect vault sync:",r)}}}async function n4(){const n=lb();if(!n||!wa)return;const e=aO.get(wa);e&&(e.disconnect(),aO.delete(wa));try{await n.disposeVaultSync({vaultId:wa}),console.log(`[Renderer] Disconnected vault sync: ${wa}`)}catch(t){console.error("[Renderer] Failed to disconnect vault sync:",t)}wa=null}function WX(){return wa}function XX(){return KL&&lb()!==null}async function gS(){const n=lb();return n?n.selectSyncDirectory():null}const eh=new Map,r4="flint-content-urls-";function i4(n){const e=`${r4}${n}`,t=localStorage.getItem(e);return t?JSON.parse(t):{}}function YX(n,e){const t=`${r4}${n}`;localStorage.setItem(t,JSON.stringify(e))}function s4(n,e){return i4(n)[e]}function o4(n,e,t){const r=i4(n);r[e]=t,YX(n,r)}async function ub(n,e,t,r){const i=eh.get(t);if(i)return i;const s=r||s4(e,t);if(s)try{const a=await n.find(s);if(await a.whenReady(),a.isReady())return eh.set(t,a),a;console.warn(`[ContentDocs] Content doc unavailable for ${t}, creating new one`)}catch(a){console.warn(`[ContentDocs] Error loading content doc for ${t}:`,a)}const o=n.create({noteId:t,content:""});return o4(e,t,o.url),eh.set(t,o),o}async function GX(n,e,t,r){const i=eh.get(t);if(i)return i;const s=r||s4(e,t);if(!s)return null;try{const o=await n.find(s);return await o.whenReady(),o.isReady()?(eh.set(t,o),o):null}catch{return null}}function KX(){eh.clear()}const JX="ENTRIES",a4="KEYS",l4="VALUES",oi="";class Tw{constructor(e,t){const r=e._tree,i=Array.from(r.keys());this.set=e,this._type=t,this._path=i.length>0?[{node:r,keys:i}]:[]}next(){const e=this.dive();return this.backtrack(),e}dive(){if(this._path.length===0)return{done:!0,value:void 0};const{node:e,keys:t}=gd(this._path);if(gd(t)===oi)return{done:!1,value:this.result()};const r=e.get(gd(t));return this._path.push({node:r,keys:Array.from(r.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;const e=gd(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:e})=>gd(e)).filter(e=>e!==oi).join("")}value(){return gd(this._path).node.get(oi)}result(){switch(this._type){case l4:return this.value();case a4:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}}const gd=n=>n[n.length-1],eY=(n,e,t)=>{const r=new Map;if(e===void 0)return r;const i=e.length+1,s=i+t,o=new Uint8Array(s*i).fill(t+1);for(let a=0;a<i;++a)o[a]=a;for(let a=1;a<s;++a)o[a*i]=a;return c4(n,e,t,r,o,1,i,""),r},c4=(n,e,t,r,i,s,o,a)=>{const l=s*o;e:for(const c of n.keys())if(c===oi){const d=i[l-1];d<=t&&r.set(a,[n.get(c),d])}else{let d=s;for(let h=0;h<c.length;++h,++d){const f=c[h],p=o*d,g=p-o;let m=i[p];const v=Math.max(0,d-t-1),y=Math.min(o-1,d+t);for(let O=v;O<y;++O){const _=f!==e[O],x=i[g+O]+ +_,k=i[g+O+1]+1,S=i[p+O]+1,E=i[p+O+1]=Math.min(x,k,S);E<m&&(m=E)}if(m>t)continue e}c4(n.get(c),e,t,r,i,d,o,a+c)}};class Yl{constructor(e=new Map,t=""){this._size=void 0,this._tree=e,this._prefix=t}atPrefix(e){if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");const[t,r]=Ay(this._tree,e.slice(this._prefix.length));if(t===void 0){const[i,s]=mS(r);for(const o of i.keys())if(o!==oi&&o.startsWith(s)){const a=new Map;return a.set(o.slice(s.length),i.get(o)),new Yl(a,e)}}return new Yl(t,e)}clear(){this._size=void 0,this._tree.clear()}delete(e){return this._size=void 0,tY(this._tree,e)}entries(){return new Tw(this,JX)}forEach(e){for(const[t,r]of this)e(t,r,this)}fuzzyGet(e,t){return eY(this._tree,e,t)}get(e){const t=cO(this._tree,e);return t!==void 0?t.get(oi):void 0}has(e){const t=cO(this._tree,e);return t!==void 0&&t.has(oi)}keys(){return new Tw(this,a4)}set(e,t){if(typeof e!="string")throw new Error("key must be a string");return this._size=void 0,Aw(this._tree,e).set(oi,t),this}get size(){if(this._size)return this._size;this._size=0;const e=this.entries();for(;!e.next().done;)this._size+=1;return this._size}update(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;const r=Aw(this._tree,e);return r.set(oi,t(r.get(oi))),this}fetch(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;const r=Aw(this._tree,e);let i=r.get(oi);return i===void 0&&r.set(oi,i=t()),i}values(){return new Tw(this,l4)}[Symbol.iterator](){return this.entries()}static from(e){const t=new Yl;for(const[r,i]of e)t.set(r,i);return t}static fromObject(e){return Yl.from(Object.entries(e))}}const Ay=(n,e,t=[])=>{if(e.length===0||n==null)return[n,t];for(const r of n.keys())if(r!==oi&&e.startsWith(r))return t.push([n,r]),Ay(n.get(r),e.slice(r.length),t);return t.push([n,e]),Ay(void 0,"",t)},cO=(n,e)=>{if(e.length===0||n==null)return n;for(const t of n.keys())if(t!==oi&&e.startsWith(t))return cO(n.get(t),e.slice(t.length))},Aw=(n,e)=>{const t=e.length;e:for(let r=0;n&&r<t;){for(const s of n.keys())if(s!==oi&&e[r]===s[0]){const o=Math.min(t-r,s.length);let a=1;for(;a<o&&e[r+a]===s[a];)++a;const l=n.get(s);if(a===s.length)n=l;else{const c=new Map;c.set(s.slice(a),l),n.set(e.slice(r,r+a),c),n.delete(s),n=c}r+=a;continue e}const i=new Map;return n.set(e.slice(r),i),i}return n},tY=(n,e)=>{const[t,r]=Ay(n,e);if(t!==void 0){if(t.delete(oi),t.size===0)u4(r);else if(t.size===1){const[i,s]=t.entries().next().value;d4(r,i,s)}}},u4=n=>{if(n.length===0)return;const[e,t]=mS(n);if(e.delete(t),e.size===0)u4(n.slice(0,-1));else if(e.size===1){const[r,i]=e.entries().next().value;r!==oi&&d4(n.slice(0,-1),r,i)}},d4=(n,e,t)=>{if(n.length===0)return;const[r,i]=mS(n);r.set(i+e,t),r.delete(i)},mS=n=>n[n.length-1],vS="or",h4="and",nY="and_not";class pu{constructor(e){if(e?.fields==null)throw new Error('MiniSearch: option "fields" must be provided');const t=e.autoVacuum==null||e.autoVacuum===!0?Pw:e.autoVacuum;this._options={...Ew,...e,autoVacuum:t,searchOptions:{...hC,...e.searchOptions||{}},autoSuggestOptions:{...aY,...e.autoSuggestOptions||{}}},this._index=new Yl,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=dO,this.addFields(this._options.fields)}add(e){const{extractField:t,stringifyField:r,tokenize:i,processTerm:s,fields:o,idField:a}=this._options,l=t(e,a);if(l==null)throw new Error(`MiniSearch: document does not have ID field "${a}"`);if(this._idToShortId.has(l))throw new Error(`MiniSearch: duplicate ID ${l}`);const c=this.addDocumentId(l);this.saveStoredFields(c,e);for(const d of o){const h=t(e,d);if(h==null)continue;const f=i(r(h,d),d),p=this._fieldIds[d],g=new Set(f).size;this.addFieldLength(c,p,this._documentCount-1,g);for(const m of f){const v=s(m,d);if(Array.isArray(v))for(const y of v)this.addTerm(p,c,y);else v&&this.addTerm(p,c,v)}}}addAll(e){for(const t of e)this.add(t)}addAllAsync(e,t={}){const{chunkSize:r=10}=t,i={chunk:[],promise:Promise.resolve()},{chunk:s,promise:o}=e.reduce(({chunk:a,promise:l},c,d)=>(a.push(c),(d+1)%r===0?{chunk:[],promise:l.then(()=>new Promise(h=>setTimeout(h,0))).then(()=>this.addAll(a))}:{chunk:a,promise:l}),i);return o.then(()=>this.addAll(s))}remove(e){const{tokenize:t,processTerm:r,extractField:i,stringifyField:s,fields:o,idField:a}=this._options,l=i(e,a);if(l==null)throw new Error(`MiniSearch: document does not have ID field "${a}"`);const c=this._idToShortId.get(l);if(c==null)throw new Error(`MiniSearch: cannot remove document with ID ${l}: it is not in the index`);for(const d of o){const h=i(e,d);if(h==null)continue;const f=t(s(h,d),d),p=this._fieldIds[d],g=new Set(f).size;this.removeFieldLength(c,p,this._documentCount,g);for(const m of f){const v=r(m,d);if(Array.isArray(v))for(const y of v)this.removeTerm(p,c,y);else v&&this.removeTerm(p,c,v)}}this._storedFields.delete(c),this._documentIds.delete(c),this._idToShortId.delete(l),this._fieldLength.delete(c),this._documentCount-=1}removeAll(e){if(e)for(const t of e)this.remove(t);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new Yl,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(e){const t=this._idToShortId.get(e);if(t==null)throw new Error(`MiniSearch: cannot discard document with ID ${e}: it is not in the index`);this._idToShortId.delete(e),this._documentIds.delete(t),this._storedFields.delete(t),(this._fieldLength.get(t)||[]).forEach((r,i)=>{this.removeFieldLength(t,i,this._documentCount,r)}),this._fieldLength.delete(t),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;const{minDirtFactor:e,minDirtCount:t,batchSize:r,batchWait:i}=this._options.autoVacuum;this.conditionalVacuum({batchSize:r,batchWait:i},{minDirtCount:t,minDirtFactor:e})}discardAll(e){const t=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(const r of e)this.discard(r)}finally{this._options.autoVacuum=t}this.maybeAutoVacuum()}replace(e){const{idField:t,extractField:r}=this._options,i=r(e,t);this.discard(i),this.add(e)}vacuum(e={}){return this.conditionalVacuum(e)}conditionalVacuum(e,t){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{const r=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=dO,this.performVacuuming(e,r)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)}async performVacuuming(e,t){const r=this._dirtCount;if(this.vacuumConditionsMet(t)){const i=e.batchSize||uO.batchSize,s=e.batchWait||uO.batchWait;let o=1;for(const[a,l]of this._index){for(const[c,d]of l)for(const[h]of d)this._documentIds.has(h)||(d.size<=1?l.delete(c):d.delete(h));this._index.get(a).size===0&&this._index.delete(a),o%i===0&&await new Promise(c=>setTimeout(c,s)),o+=1}this._dirtCount-=r}await null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null}vacuumConditionsMet(e){if(e==null)return!0;let{minDirtCount:t,minDirtFactor:r}=e;return t=t||Pw.minDirtCount,r=r||Pw.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=r}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(e){return this._idToShortId.has(e)}getStoredFields(e){const t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)}search(e,t={}){const{searchOptions:r}=this._options,i={...r,...t},s=this.executeQuery(e,t),o=[];for(const[a,{score:l,terms:c,match:d}]of s){const h=c.length||1,f={id:this._documentIds.get(a),score:l*h,terms:Object.keys(d),queryTerms:c,match:d};Object.assign(f,this._storedFields.get(a)),(i.filter==null||i.filter(f))&&o.push(f)}return e===pu.wildcard&&i.boostDocument==null||o.sort(pC),o}autoSuggest(e,t={}){t={...this._options.autoSuggestOptions,...t};const r=new Map;for(const{score:s,terms:o}of this.search(e,t)){const a=o.join(" "),l=r.get(a);l!=null?(l.score+=s,l.count+=1):r.set(a,{score:s,terms:o,count:1})}const i=[];for(const[s,{score:o,terms:a,count:l}]of r)i.push({suggestion:s,terms:a,score:o/l});return i.sort(pC),i}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)}static async loadJSONAsync(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(e),t)}static getDefault(e){if(Ew.hasOwnProperty(e))return Cw(Ew,e);throw new Error(`MiniSearch: unknown option "${e}"`)}static loadJS(e,t){const{index:r,documentIds:i,fieldLength:s,storedFields:o,serializationVersion:a}=e,l=this.instantiateMiniSearch(e,t);l._documentIds=$m(i),l._fieldLength=$m(s),l._storedFields=$m(o);for(const[c,d]of l._documentIds)l._idToShortId.set(d,c);for(const[c,d]of r){const h=new Map;for(const f of Object.keys(d)){let p=d[f];a===1&&(p=p.ds),h.set(parseInt(f,10),$m(p))}l._index.set(c,h)}return l}static async loadJSAsync(e,t){const{index:r,documentIds:i,fieldLength:s,storedFields:o,serializationVersion:a}=e,l=this.instantiateMiniSearch(e,t);l._documentIds=await Fm(i),l._fieldLength=await Fm(s),l._storedFields=await Fm(o);for(const[d,h]of l._documentIds)l._idToShortId.set(h,d);let c=0;for(const[d,h]of r){const f=new Map;for(const p of Object.keys(h)){let g=h[p];a===1&&(g=g.ds),f.set(parseInt(p,10),await Fm(g))}++c%1e3===0&&await f4(0),l._index.set(d,f)}return l}static instantiateMiniSearch(e,t){const{documentCount:r,nextId:i,fieldIds:s,averageFieldLength:o,dirtCount:a,serializationVersion:l}=e;if(l!==1&&l!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");const c=new pu(t);return c._documentCount=r,c._nextId=i,c._idToShortId=new Map,c._fieldIds=s,c._avgFieldLength=o,c._dirtCount=a||0,c._index=new Yl,c}executeQuery(e,t={}){if(e===pu.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){const f={...t,...e,queries:void 0},p=e.queries.map(g=>this.executeQuery(g,f));return this.combineResults(p,f.combineWith)}const{tokenize:r,processTerm:i,searchOptions:s}=this._options,o={tokenize:r,processTerm:i,...s,...t},{tokenize:a,processTerm:l}=o,h=a(e).flatMap(f=>l(f)).filter(f=>!!f).map(oY(o)).map(f=>this.executeQuerySpec(f,o));return this.combineResults(h,o.combineWith)}executeQuerySpec(e,t){const r={...this._options.searchOptions,...t},i=(r.fields||this._options.fields).reduce((m,v)=>({...m,[v]:Cw(r.boost,v)||1}),{}),{boostDocument:s,weights:o,maxFuzzy:a,bm25:l}=r,{fuzzy:c,prefix:d}={...hC.weights,...o},h=this._index.get(e.term),f=this.termResults(e.term,e.term,1,e.termBoost,h,i,s,l);let p,g;if(e.prefix&&(p=this._index.atPrefix(e.term)),e.fuzzy){const m=e.fuzzy===!0?.2:e.fuzzy,v=m<1?Math.min(a,Math.round(e.term.length*m)):m;v&&(g=this._index.fuzzyGet(e.term,v))}if(p)for(const[m,v]of p){const y=m.length-e.term.length;if(!y)continue;g?.delete(m);const O=d*m.length/(m.length+.3*y);this.termResults(e.term,m,O,e.termBoost,v,i,s,l,f)}if(g)for(const m of g.keys()){const[v,y]=g.get(m);if(!y)continue;const O=c*m.length/(m.length+y);this.termResults(e.term,m,O,e.termBoost,v,i,s,l,f)}return f}executeWildcardQuery(e){const t=new Map,r={...this._options.searchOptions,...e};for(const[i,s]of this._documentIds){const o=r.boostDocument?r.boostDocument(s,"",this._storedFields.get(i)):1;t.set(i,{score:o,terms:[],match:{}})}return t}combineResults(e,t=vS){if(e.length===0)return new Map;const r=t.toLowerCase(),i=rY[r];if(!i)throw new Error(`Invalid combination operator: ${t}`);return e.reduce(i)||new Map}toJSON(){const e=[];for(const[t,r]of this._index){const i={};for(const[s,o]of r)i[s]=Object.fromEntries(o);e.push([t,i])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:e,serializationVersion:2}}termResults(e,t,r,i,s,o,a,l,c=new Map){if(s==null)return c;for(const d of Object.keys(o)){const h=o[d],f=this._fieldIds[d],p=s.get(f);if(p==null)continue;let g=p.size;const m=this._avgFieldLength[f];for(const v of p.keys()){if(!this._documentIds.has(v)){this.removeTerm(f,v,t),g-=1;continue}const y=a?a(this._documentIds.get(v),t,this._storedFields.get(v)):1;if(!y)continue;const O=p.get(v),_=this._fieldLength.get(v)[f],x=sY(O,g,this._documentCount,_,m,l),k=r*i*h*y*x,S=c.get(v);if(S){S.score+=k,lY(S.terms,e);const E=Cw(S.match,t);E?E.push(d):S.match[t]=[d]}else c.set(v,{score:k,terms:[e],match:{[t]:[d]}})}}return c}addTerm(e,t,r){const i=this._index.fetch(r,gC);let s=i.get(e);if(s==null)s=new Map,s.set(t,1),i.set(e,s);else{const o=s.get(t);s.set(t,(o||0)+1)}}removeTerm(e,t,r){if(!this._index.has(r)){this.warnDocumentChanged(t,e,r);return}const i=this._index.fetch(r,gC),s=i.get(e);s==null||s.get(t)==null?this.warnDocumentChanged(t,e,r):s.get(t)<=1?s.size<=1?i.delete(e):s.delete(t):s.set(t,s.get(t)-1),this._index.get(r).size===0&&this._index.delete(r)}warnDocumentChanged(e,t,r){for(const i of Object.keys(this._fieldIds))if(this._fieldIds[i]===t){this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(e)} has changed before removal: term "${r}" was not present in field "${i}". Removing a document after it has changed can corrupt the index!`,"version_conflict");return}}addDocumentId(e){const t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t}addFields(e){for(let t=0;t<e.length;t++)this._fieldIds[e[t]]=t}addFieldLength(e,t,r,i){let s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[t]=i;const a=(this._avgFieldLength[t]||0)*r+i;this._avgFieldLength[t]=a/(r+1)}removeFieldLength(e,t,r,i){if(r===1){this._avgFieldLength[t]=0;return}const s=this._avgFieldLength[t]*r-i;this._avgFieldLength[t]=s/(r-1)}saveStoredFields(e,t){const{storeFields:r,extractField:i}=this._options;if(r==null||r.length===0)return;let s=this._storedFields.get(e);s==null&&this._storedFields.set(e,s={});for(const o of r){const a=i(t,o);a!==void 0&&(s[o]=a)}}}pu.wildcard=Symbol("*");const Cw=(n,e)=>Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0,rY={[vS]:(n,e)=>{for(const t of e.keys()){const r=n.get(t);if(r==null)n.set(t,e.get(t));else{const{score:i,terms:s,match:o}=e.get(t);r.score=r.score+i,r.match=Object.assign(r.match,o),fC(r.terms,s)}}return n},[h4]:(n,e)=>{const t=new Map;for(const r of e.keys()){const i=n.get(r);if(i==null)continue;const{score:s,terms:o,match:a}=e.get(r);fC(i.terms,o),t.set(r,{score:i.score+s,terms:i.terms,match:Object.assign(i.match,a)})}return t},[nY]:(n,e)=>{for(const t of e.keys())n.delete(t);return n}},iY={k:1.2,b:.7,d:.5},sY=(n,e,t,r,i,s)=>{const{k:o,b:a,d:l}=s;return Math.log(1+(t-e+.5)/(e+.5))*(l+n*(o+1)/(n+o*(1-a+a*r/i)))},oY=n=>(e,t,r)=>{const i=typeof n.fuzzy=="function"?n.fuzzy(e,t,r):n.fuzzy||!1,s=typeof n.prefix=="function"?n.prefix(e,t,r):n.prefix===!0,o=typeof n.boostTerm=="function"?n.boostTerm(e,t,r):1;return{term:e,fuzzy:i,prefix:s,termBoost:o}},Ew={idField:"id",extractField:(n,e)=>n[e],stringifyField:(n,e)=>n.toString(),tokenize:n=>n.split(cY),processTerm:n=>n.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(n,e)=>{typeof console?.[n]=="function"&&console[n](e)},autoVacuum:!0},hC={combineWith:vS,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:iY},aY={combineWith:h4,prefix:(n,e,t)=>e===t.length-1},uO={batchSize:1e3,batchWait:10},dO={minDirtFactor:.1,minDirtCount:20},Pw={...uO,...dO},lY=(n,e)=>{n.includes(e)||n.push(e)},fC=(n,e)=>{for(const t of e)n.includes(t)||n.push(t)},pC=({score:n},{score:e})=>e-n,gC=()=>new Map,$m=n=>{const e=new Map;for(const t of Object.keys(n))e.set(parseInt(t,10),n[t]);return e},Fm=async n=>{const e=new Map;let t=0;for(const r of Object.keys(n))e.set(parseInt(r,10),n[r]),++t%1e3===0&&await f4(0);return e},f4=n=>new Promise(e=>setTimeout(e,n)),cY=/[\n\r\p{Z}\p{P}]+/u;class uY{miniSearch;indexedNoteIds=new Set;#e=j(!1);get _isIndexing(){return u(this.#e)}set _isIndexing(e){b(this.#e,e,!0)}#t=j(Qt({current:0,total:0}));get _indexProgress(){return u(this.#t)}set _indexProgress(e){b(this.#t,e,!0)}loadContentFn=null;constructor(){this.miniSearch=new pu({fields:["title","content"],storeFields:["id","title","type","updated"],searchOptions:{boost:{title:3,content:1},fuzzy:.2,prefix:!0}})}setContentLoader(e){this.loadContentFn=e}async indexNote(e,t){if(this.indexedNoteIds.has(e.id))try{this.miniSearch.discard(e.id)}catch{}const r=t??await this.loadContentFn?.(e.id)??"";this.miniSearch.add({id:e.id,title:e.title,content:r,type:e.type,updated:e.updated}),this.indexedNoteIds.add(e.id)}async buildIndex(e,t){if(!this._isIndexing){this._isIndexing=!0,this._indexProgress={current:0,total:e.length};try{const r=e.filter(s=>!s.archived);this._indexProgress.total=r.length;const i=10;for(let s=0;s<r.length;s+=i){const o=r.slice(s,s+i);await Promise.all(o.map(a=>this.indexNote(a))),this._indexProgress.current=Math.min(s+i,r.length),t?.(this._indexProgress.current,r.length),await new Promise(a=>setTimeout(a,0))}}finally{this._isIndexing=!1}}}search(e){return e.trim()?this.miniSearch.search(e,{fuzzy:.2,prefix:!0}).map(r=>({id:r.id,score:r.score,match:r.match,terms:r.terms})):[]}removeNote(e){if(this.indexedNoteIds.has(e)){try{this.miniSearch.discard(e)}catch{}this.indexedNoteIds.delete(e)}}clear(){this.miniSearch.removeAll(),this.indexedNoteIds.clear()}get isBuilding(){return this._isIndexing}get progress(){return this._indexProgress}get indexedCount(){return this.indexedNoteIds.size}isIndexed(e){return this.indexedNoteIds.has(e)}}const fc=new uY;/*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT */function p4(n){return typeof n>"u"||n===null}function dY(n){return typeof n=="object"&&n!==null}function hY(n){return Array.isArray(n)?n:p4(n)?[]:[n]}function fY(n,e){var t,r,i,s;if(e)for(s=Object.keys(e),t=0,r=s.length;t<r;t+=1)i=s[t],n[i]=e[i];return n}function pY(n,e){var t="",r;for(r=0;r<e;r+=1)t+=n;return t}function gY(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}var mY=p4,vY=dY,yY=hY,bY=pY,wY=gY,_Y=fY,Br={isNothing:mY,isObject:vY,toArray:yY,repeat:bY,isNegativeZero:wY,extend:_Y};function g4(n,e){var t="",r=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),r+" "+t):r}function Vp(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=g4(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Vp.prototype=Object.create(Error.prototype);Vp.prototype.constructor=Vp;Vp.prototype.toString=function(e){return this.name+": "+g4(this,e)};var Fi=Vp;function Iw(n,e,t,r,i){var s="",o="",a=Math.floor(i/2)-1;return r-e>a&&(s=" ... ",e=r-a+s.length),t-r>a&&(o=" ...",t=r+a-o.length),{str:s+n.slice(e,t).replace(/\t/g,"â")+o,pos:r-e+s.length}}function Mw(n,e){return Br.repeat(" ",e-n.length)+n}function OY(n,e){if(e=Object.create(e||null),!n.buffer)return null;e.maxLength||(e.maxLength=79),typeof e.indent!="number"&&(e.indent=1),typeof e.linesBefore!="number"&&(e.linesBefore=3),typeof e.linesAfter!="number"&&(e.linesAfter=2);for(var t=/\r?\n|\r|\0/g,r=[0],i=[],s,o=-1;s=t.exec(n.buffer);)i.push(s.index),r.push(s.index+s[0].length),n.position<=s.index&&o<0&&(o=r.length-2);o<0&&(o=r.length-1);var a="",l,c,d=Math.min(n.line+e.linesAfter,i.length).toString().length,h=e.maxLength-(e.indent+d+3);for(l=1;l<=e.linesBefore&&!(o-l<0);l++)c=Iw(n.buffer,r[o-l],i[o-l],n.position-(r[o]-r[o-l]),h),a=Br.repeat(" ",e.indent)+Mw((n.line-l+1).toString(),d)+" | "+c.str+`
`+a;for(c=Iw(n.buffer,r[o],i[o],n.position,h),a+=Br.repeat(" ",e.indent)+Mw((n.line+1).toString(),d)+" | "+c.str+`
`,a+=Br.repeat("-",e.indent+d+3+c.pos)+`^
`,l=1;l<=e.linesAfter&&!(o+l>=i.length);l++)c=Iw(n.buffer,r[o+l],i[o+l],n.position-(r[o]-r[o+l]),h),a+=Br.repeat(" ",e.indent)+Mw((n.line+l+1).toString(),d)+" | "+c.str+`
`;return a.replace(/\n$/,"")}var xY=OY,kY=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],SY=["scalar","sequence","mapping"];function TY(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){e[String(r)]=t})}),e}function AY(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(kY.indexOf(t)===-1)throw new Fi('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=TY(e.styleAliases||null),SY.indexOf(this.kind)===-1)throw new Fi('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}var di=AY;function mC(n,e){var t=[];return n[e].forEach(function(r){var i=t.length;t.forEach(function(s,o){s.tag===r.tag&&s.kind===r.kind&&s.multi===r.multi&&(i=o)}),t[i]=r}),t}function CY(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function r(i){i.multi?(n.multi[i.kind].push(i),n.multi.fallback.push(i)):n[i.kind][i.tag]=n.fallback[i.tag]=i}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}function hO(n){return this.extend(n)}hO.prototype.extend=function(e){var t=[],r=[];if(e instanceof di)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new Fi("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(s){if(!(s instanceof di))throw new Fi("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(s.loadKind&&s.loadKind!=="scalar")throw new Fi("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(s.multi)throw new Fi("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(s){if(!(s instanceof di))throw new Fi("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(hO.prototype);return i.implicit=(this.implicit||[]).concat(t),i.explicit=(this.explicit||[]).concat(r),i.compiledImplicit=mC(i,"implicit"),i.compiledExplicit=mC(i,"explicit"),i.compiledTypeMap=CY(i.compiledImplicit,i.compiledExplicit),i};var m4=hO,v4=new di("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return n!==null?n:""}}),y4=new di("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return n!==null?n:[]}}),b4=new di("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return n!==null?n:{}}}),w4=new m4({explicit:[v4,y4,b4]});function EY(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}function PY(){return null}function IY(n){return n===null}var _4=new di("tag:yaml.org,2002:null",{kind:"scalar",resolve:EY,construct:PY,predicate:IY,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function MY(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}function RY(n){return n==="true"||n==="True"||n==="TRUE"}function DY(n){return Object.prototype.toString.call(n)==="[object Boolean]"}var O4=new di("tag:yaml.org,2002:bool",{kind:"scalar",resolve:MY,construct:RY,predicate:DY,represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"});function NY(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}function LY(n){return 48<=n&&n<=55}function QY(n){return 48<=n&&n<=57}function $Y(n){if(n===null)return!1;var e=n.length,t=0,r=!1,i;if(!e)return!1;if(i=n[t],(i==="-"||i==="+")&&(i=n[++t]),i==="0"){if(t+1===e)return!0;if(i=n[++t],i==="b"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(i!=="0"&&i!=="1")return!1;r=!0}return r&&i!=="_"}if(i==="x"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(!NY(n.charCodeAt(t)))return!1;r=!0}return r&&i!=="_"}if(i==="o"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(!LY(n.charCodeAt(t)))return!1;r=!0}return r&&i!=="_"}}if(i==="_")return!1;for(;t<e;t++)if(i=n[t],i!=="_"){if(!QY(n.charCodeAt(t)))return!1;r=!0}return!(!r||i==="_")}function FY(n){var e=n,t=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}function zY(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!Br.isNegativeZero(n)}var x4=new di("tag:yaml.org,2002:int",{kind:"scalar",resolve:$Y,construct:FY,predicate:zY,represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),BY=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function UY(n){return!(n===null||!BY.test(n)||n[n.length-1]==="_")}function jY(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}var VY=/^[-+]?[0-9]+e/;function qY(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Br.isNegativeZero(n))return"-0.0";return t=n.toString(10),VY.test(t)?t.replace("e",".e"):t}function HY(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||Br.isNegativeZero(n))}var k4=new di("tag:yaml.org,2002:float",{kind:"scalar",resolve:UY,construct:jY,predicate:HY,represent:qY,defaultStyle:"lowercase"}),S4=w4.extend({implicit:[_4,O4,x4,k4]}),T4=S4,A4=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),C4=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function ZY(n){return n===null?!1:A4.exec(n)!==null||C4.exec(n)!==null}function WY(n){var e,t,r,i,s,o,a,l=0,c=null,d,h,f;if(e=A4.exec(n),e===null&&(e=C4.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],r=+e[2]-1,i=+e[3],!e[4])return new Date(Date.UTC(t,r,i));if(s=+e[4],o=+e[5],a=+e[6],e[7]){for(l=e[7].slice(0,3);l.length<3;)l+="0";l=+l}return e[9]&&(d=+e[10],h=+(e[11]||0),c=(d*60+h)*6e4,e[9]==="-"&&(c=-c)),f=new Date(Date.UTC(t,r,i,s,o,a,l)),c&&f.setTime(f.getTime()-c),f}function XY(n){return n.toISOString()}var E4=new di("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:ZY,construct:WY,instanceOf:Date,represent:XY});function YY(n){return n==="<<"||n===null}var P4=new di("tag:yaml.org,2002:merge",{kind:"scalar",resolve:YY}),yS=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function GY(n){if(n===null)return!1;var e,t,r=0,i=n.length,s=yS;for(t=0;t<i;t++)if(e=s.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}function KY(n){var e,t,r=n.replace(/[\r\n=]/g,""),i=r.length,s=yS,o=0,a=[];for(e=0;e<i;e++)e%4===0&&e&&(a.push(o>>16&255),a.push(o>>8&255),a.push(o&255)),o=o<<6|s.indexOf(r.charAt(e));return t=i%4*6,t===0?(a.push(o>>16&255),a.push(o>>8&255),a.push(o&255)):t===18?(a.push(o>>10&255),a.push(o>>2&255)):t===12&&a.push(o>>4&255),new Uint8Array(a)}function JY(n){var e="",t=0,r,i,s=n.length,o=yS;for(r=0;r<s;r++)r%3===0&&r&&(e+=o[t>>18&63],e+=o[t>>12&63],e+=o[t>>6&63],e+=o[t&63]),t=(t<<8)+n[r];return i=s%3,i===0?(e+=o[t>>18&63],e+=o[t>>12&63],e+=o[t>>6&63],e+=o[t&63]):i===2?(e+=o[t>>10&63],e+=o[t>>4&63],e+=o[t<<2&63],e+=o[64]):i===1&&(e+=o[t>>2&63],e+=o[t<<4&63],e+=o[64],e+=o[64]),e}function eG(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}var I4=new di("tag:yaml.org,2002:binary",{kind:"scalar",resolve:GY,construct:KY,predicate:eG,represent:JY}),tG=Object.prototype.hasOwnProperty,nG=Object.prototype.toString;function rG(n){if(n===null)return!0;var e=[],t,r,i,s,o,a=n;for(t=0,r=a.length;t<r;t+=1){if(i=a[t],o=!1,nG.call(i)!=="[object Object]")return!1;for(s in i)if(tG.call(i,s))if(!o)o=!0;else return!1;if(!o)return!1;if(e.indexOf(s)===-1)e.push(s);else return!1}return!0}function iG(n){return n!==null?n:[]}var M4=new di("tag:yaml.org,2002:omap",{kind:"sequence",resolve:rG,construct:iG}),sG=Object.prototype.toString;function oG(n){if(n===null)return!0;var e,t,r,i,s,o=n;for(s=new Array(o.length),e=0,t=o.length;e<t;e+=1){if(r=o[e],sG.call(r)!=="[object Object]"||(i=Object.keys(r),i.length!==1))return!1;s[e]=[i[0],r[i[0]]]}return!0}function aG(n){if(n===null)return[];var e,t,r,i,s,o=n;for(s=new Array(o.length),e=0,t=o.length;e<t;e+=1)r=o[e],i=Object.keys(r),s[e]=[i[0],r[i[0]]];return s}var R4=new di("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:oG,construct:aG}),lG=Object.prototype.hasOwnProperty;function cG(n){if(n===null)return!0;var e,t=n;for(e in t)if(lG.call(t,e)&&t[e]!==null)return!1;return!0}function uG(n){return n!==null?n:{}}var D4=new di("tag:yaml.org,2002:set",{kind:"mapping",resolve:cG,construct:uG}),bS=T4.extend({implicit:[E4,P4],explicit:[I4,M4,R4,D4]}),pc=Object.prototype.hasOwnProperty,Cy=1,N4=2,L4=3,Ey=4,Rw=1,dG=2,vC=3,hG=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,fG=/[\x85\u2028\u2029]/,pG=/[,\[\]\{\}]/,Q4=/^(?:!|!!|![a-z\-]+!)$/i,$4=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function yC(n){return Object.prototype.toString.call(n)}function Ma(n){return n===10||n===13}function gu(n){return n===9||n===32}function is(n){return n===9||n===32||n===10||n===13}function Nd(n){return n===44||n===91||n===93||n===123||n===125}function gG(n){var e;return 48<=n&&n<=57?n-48:(e=n|32,97<=e&&e<=102?e-97+10:-1)}function mG(n){return n===120?2:n===117?4:n===85?8:0}function vG(n){return 48<=n&&n<=57?n-48:-1}function bC(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"Â":n===95?"Â ":n===76?"\u2028":n===80?"\u2029":""}function yG(n){return n<=65535?String.fromCharCode(n):String.fromCharCode((n-65536>>10)+55296,(n-65536&1023)+56320)}function F4(n,e,t){e==="__proto__"?Object.defineProperty(n,e,{configurable:!0,enumerable:!0,writable:!0,value:t}):n[e]=t}var z4=new Array(256),B4=new Array(256);for(var md=0;md<256;md++)z4[md]=bC(md)?1:0,B4[md]=bC(md);function bG(n,e){this.input=n,this.filename=e.filename||null,this.schema=e.schema||bS,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=n.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function U4(n,e){var t={name:n.filename,buffer:n.input.slice(0,-1),position:n.position,line:n.line,column:n.position-n.lineStart};return t.snippet=xY(t),new Fi(e,t)}function Vt(n,e){throw U4(n,e)}function Py(n,e){n.onWarning&&n.onWarning.call(null,U4(n,e))}var wC={YAML:function(e,t,r){var i,s,o;e.version!==null&&Vt(e,"duplication of %YAML directive"),r.length!==1&&Vt(e,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(r[0]),i===null&&Vt(e,"ill-formed argument of the YAML directive"),s=parseInt(i[1],10),o=parseInt(i[2],10),s!==1&&Vt(e,"unacceptable YAML version of the document"),e.version=r[0],e.checkLineBreaks=o<2,o!==1&&o!==2&&Py(e,"unsupported YAML version of the document")},TAG:function(e,t,r){var i,s;r.length!==2&&Vt(e,"TAG directive accepts exactly two arguments"),i=r[0],s=r[1],Q4.test(i)||Vt(e,"ill-formed tag handle (first argument) of the TAG directive"),pc.call(e.tagMap,i)&&Vt(e,'there is a previously declared suffix for "'+i+'" tag handle'),$4.test(s)||Vt(e,"ill-formed tag prefix (second argument) of the TAG directive");try{s=decodeURIComponent(s)}catch{Vt(e,"tag prefix is malformed: "+s)}e.tagMap[i]=s}};function oc(n,e,t,r){var i,s,o,a;if(e<t){if(a=n.input.slice(e,t),r)for(i=0,s=a.length;i<s;i+=1)o=a.charCodeAt(i),o===9||32<=o&&o<=1114111||Vt(n,"expected valid JSON character");else hG.test(a)&&Vt(n,"the stream contains non-printable characters");n.result+=a}}function _C(n,e,t,r){var i,s,o,a;for(Br.isObject(t)||Vt(n,"cannot merge mappings; the provided source object is unacceptable"),i=Object.keys(t),o=0,a=i.length;o<a;o+=1)s=i[o],pc.call(e,s)||(F4(e,s,t[s]),r[s]=!0)}function Ld(n,e,t,r,i,s,o,a,l){var c,d;if(Array.isArray(i))for(i=Array.prototype.slice.call(i),c=0,d=i.length;c<d;c+=1)Array.isArray(i[c])&&Vt(n,"nested arrays are not supported inside keys"),typeof i=="object"&&yC(i[c])==="[object Object]"&&(i[c]="[object Object]");if(typeof i=="object"&&yC(i)==="[object Object]"&&(i="[object Object]"),i=String(i),e===null&&(e={}),r==="tag:yaml.org,2002:merge")if(Array.isArray(s))for(c=0,d=s.length;c<d;c+=1)_C(n,e,s[c],t);else _C(n,e,s,t);else!n.json&&!pc.call(t,i)&&pc.call(e,i)&&(n.line=o||n.line,n.lineStart=a||n.lineStart,n.position=l||n.position,Vt(n,"duplicated mapping key")),F4(e,i,s),delete t[i];return e}function wS(n){var e;e=n.input.charCodeAt(n.position),e===10?n.position++:e===13?(n.position++,n.input.charCodeAt(n.position)===10&&n.position++):Vt(n,"a line break is expected"),n.line+=1,n.lineStart=n.position,n.firstTabInLine=-1}function Rr(n,e,t){for(var r=0,i=n.input.charCodeAt(n.position);i!==0;){for(;gu(i);)i===9&&n.firstTabInLine===-1&&(n.firstTabInLine=n.position),i=n.input.charCodeAt(++n.position);if(e&&i===35)do i=n.input.charCodeAt(++n.position);while(i!==10&&i!==13&&i!==0);if(Ma(i))for(wS(n),i=n.input.charCodeAt(n.position),r++,n.lineIndent=0;i===32;)n.lineIndent++,i=n.input.charCodeAt(++n.position);else break}return t!==-1&&r!==0&&n.lineIndent<t&&Py(n,"deficient indentation"),r}function db(n){var e=n.position,t;return t=n.input.charCodeAt(e),!!((t===45||t===46)&&t===n.input.charCodeAt(e+1)&&t===n.input.charCodeAt(e+2)&&(e+=3,t=n.input.charCodeAt(e),t===0||is(t)))}function _S(n,e){e===1?n.result+=" ":e>1&&(n.result+=Br.repeat(`
`,e-1))}function wG(n,e,t){var r,i,s,o,a,l,c,d,h=n.kind,f=n.result,p;if(p=n.input.charCodeAt(n.position),is(p)||Nd(p)||p===35||p===38||p===42||p===33||p===124||p===62||p===39||p===34||p===37||p===64||p===96||(p===63||p===45)&&(i=n.input.charCodeAt(n.position+1),is(i)||t&&Nd(i)))return!1;for(n.kind="scalar",n.result="",s=o=n.position,a=!1;p!==0;){if(p===58){if(i=n.input.charCodeAt(n.position+1),is(i)||t&&Nd(i))break}else if(p===35){if(r=n.input.charCodeAt(n.position-1),is(r))break}else{if(n.position===n.lineStart&&db(n)||t&&Nd(p))break;if(Ma(p))if(l=n.line,c=n.lineStart,d=n.lineIndent,Rr(n,!1,-1),n.lineIndent>=e){a=!0,p=n.input.charCodeAt(n.position);continue}else{n.position=o,n.line=l,n.lineStart=c,n.lineIndent=d;break}}a&&(oc(n,s,o,!1),_S(n,n.line-l),s=o=n.position,a=!1),gu(p)||(o=n.position+1),p=n.input.charCodeAt(++n.position)}return oc(n,s,o,!1),n.result?!0:(n.kind=h,n.result=f,!1)}function _G(n,e){var t,r,i;if(t=n.input.charCodeAt(n.position),t!==39)return!1;for(n.kind="scalar",n.result="",n.position++,r=i=n.position;(t=n.input.charCodeAt(n.position))!==0;)if(t===39)if(oc(n,r,n.position,!0),t=n.input.charCodeAt(++n.position),t===39)r=n.position,n.position++,i=n.position;else return!0;else Ma(t)?(oc(n,r,i,!0),_S(n,Rr(n,!1,e)),r=i=n.position):n.position===n.lineStart&&db(n)?Vt(n,"unexpected end of the document within a single quoted scalar"):(n.position++,i=n.position);Vt(n,"unexpected end of the stream within a single quoted scalar")}function OG(n,e){var t,r,i,s,o,a;if(a=n.input.charCodeAt(n.position),a!==34)return!1;for(n.kind="scalar",n.result="",n.position++,t=r=n.position;(a=n.input.charCodeAt(n.position))!==0;){if(a===34)return oc(n,t,n.position,!0),n.position++,!0;if(a===92){if(oc(n,t,n.position,!0),a=n.input.charCodeAt(++n.position),Ma(a))Rr(n,!1,e);else if(a<256&&z4[a])n.result+=B4[a],n.position++;else if((o=mG(a))>0){for(i=o,s=0;i>0;i--)a=n.input.charCodeAt(++n.position),(o=gG(a))>=0?s=(s<<4)+o:Vt(n,"expected hexadecimal character");n.result+=yG(s),n.position++}else Vt(n,"unknown escape sequence");t=r=n.position}else Ma(a)?(oc(n,t,r,!0),_S(n,Rr(n,!1,e)),t=r=n.position):n.position===n.lineStart&&db(n)?Vt(n,"unexpected end of the document within a double quoted scalar"):(n.position++,r=n.position)}Vt(n,"unexpected end of the stream within a double quoted scalar")}function xG(n,e){var t=!0,r,i,s,o=n.tag,a,l=n.anchor,c,d,h,f,p,g=Object.create(null),m,v,y,O;if(O=n.input.charCodeAt(n.position),O===91)d=93,p=!1,a=[];else if(O===123)d=125,p=!0,a={};else return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=a),O=n.input.charCodeAt(++n.position);O!==0;){if(Rr(n,!0,e),O=n.input.charCodeAt(n.position),O===d)return n.position++,n.tag=o,n.anchor=l,n.kind=p?"mapping":"sequence",n.result=a,!0;t?O===44&&Vt(n,"expected the node content, but found ','"):Vt(n,"missed comma between flow collection entries"),v=m=y=null,h=f=!1,O===63&&(c=n.input.charCodeAt(n.position+1),is(c)&&(h=f=!0,n.position++,Rr(n,!0,e))),r=n.line,i=n.lineStart,s=n.position,Sh(n,e,Cy,!1,!0),v=n.tag,m=n.result,Rr(n,!0,e),O=n.input.charCodeAt(n.position),(f||n.line===r)&&O===58&&(h=!0,O=n.input.charCodeAt(++n.position),Rr(n,!0,e),Sh(n,e,Cy,!1,!0),y=n.result),p?Ld(n,a,g,v,m,y,r,i,s):h?a.push(Ld(n,null,g,v,m,y,r,i,s)):a.push(m),Rr(n,!0,e),O=n.input.charCodeAt(n.position),O===44?(t=!0,O=n.input.charCodeAt(++n.position)):t=!1}Vt(n,"unexpected end of the stream within a flow collection")}function kG(n,e){var t,r,i=Rw,s=!1,o=!1,a=e,l=0,c=!1,d,h;if(h=n.input.charCodeAt(n.position),h===124)r=!1;else if(h===62)r=!0;else return!1;for(n.kind="scalar",n.result="";h!==0;)if(h=n.input.charCodeAt(++n.position),h===43||h===45)Rw===i?i=h===43?vC:dG:Vt(n,"repeat of a chomping mode identifier");else if((d=vG(h))>=0)d===0?Vt(n,"bad explicit indentation width of a block scalar; it cannot be less than one"):o?Vt(n,"repeat of an indentation width identifier"):(a=e+d-1,o=!0);else break;if(gu(h)){do h=n.input.charCodeAt(++n.position);while(gu(h));if(h===35)do h=n.input.charCodeAt(++n.position);while(!Ma(h)&&h!==0)}for(;h!==0;){for(wS(n),n.lineIndent=0,h=n.input.charCodeAt(n.position);(!o||n.lineIndent<a)&&h===32;)n.lineIndent++,h=n.input.charCodeAt(++n.position);if(!o&&n.lineIndent>a&&(a=n.lineIndent),Ma(h)){l++;continue}if(n.lineIndent<a){i===vC?n.result+=Br.repeat(`
`,s?1+l:l):i===Rw&&s&&(n.result+=`
`);break}for(r?gu(h)?(c=!0,n.result+=Br.repeat(`
`,s?1+l:l)):c?(c=!1,n.result+=Br.repeat(`
`,l+1)):l===0?s&&(n.result+=" "):n.result+=Br.repeat(`
`,l):n.result+=Br.repeat(`
`,s?1+l:l),s=!0,o=!0,l=0,t=n.position;!Ma(h)&&h!==0;)h=n.input.charCodeAt(++n.position);oc(n,t,n.position,!1)}return!0}function OC(n,e){var t,r=n.tag,i=n.anchor,s=[],o,a=!1,l;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=s),l=n.input.charCodeAt(n.position);l!==0&&(n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,Vt(n,"tab characters must not be used in indentation")),!(l!==45||(o=n.input.charCodeAt(n.position+1),!is(o))));){if(a=!0,n.position++,Rr(n,!0,-1)&&n.lineIndent<=e){s.push(null),l=n.input.charCodeAt(n.position);continue}if(t=n.line,Sh(n,e,L4,!1,!0),s.push(n.result),Rr(n,!0,-1),l=n.input.charCodeAt(n.position),(n.line===t||n.lineIndent>e)&&l!==0)Vt(n,"bad indentation of a sequence entry");else if(n.lineIndent<e)break}return a?(n.tag=r,n.anchor=i,n.kind="sequence",n.result=s,!0):!1}function SG(n,e,t){var r,i,s,o,a,l,c=n.tag,d=n.anchor,h={},f=Object.create(null),p=null,g=null,m=null,v=!1,y=!1,O;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=h),O=n.input.charCodeAt(n.position);O!==0;){if(!v&&n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,Vt(n,"tab characters must not be used in indentation")),r=n.input.charCodeAt(n.position+1),s=n.line,(O===63||O===58)&&is(r))O===63?(v&&(Ld(n,h,f,p,g,null,o,a,l),p=g=m=null),y=!0,v=!0,i=!0):v?(v=!1,i=!0):Vt(n,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),n.position+=1,O=r;else{if(o=n.line,a=n.lineStart,l=n.position,!Sh(n,t,N4,!1,!0))break;if(n.line===s){for(O=n.input.charCodeAt(n.position);gu(O);)O=n.input.charCodeAt(++n.position);if(O===58)O=n.input.charCodeAt(++n.position),is(O)||Vt(n,"a whitespace character is expected after the key-value separator within a block mapping"),v&&(Ld(n,h,f,p,g,null,o,a,l),p=g=m=null),y=!0,v=!1,i=!1,p=n.tag,g=n.result;else if(y)Vt(n,"can not read an implicit mapping pair; a colon is missed");else return n.tag=c,n.anchor=d,!0}else if(y)Vt(n,"can not read a block mapping entry; a multiline key may not be an implicit key");else return n.tag=c,n.anchor=d,!0}if((n.line===s||n.lineIndent>e)&&(v&&(o=n.line,a=n.lineStart,l=n.position),Sh(n,e,Ey,!0,i)&&(v?g=n.result:m=n.result),v||(Ld(n,h,f,p,g,m,o,a,l),p=g=m=null),Rr(n,!0,-1),O=n.input.charCodeAt(n.position)),(n.line===s||n.lineIndent>e)&&O!==0)Vt(n,"bad indentation of a mapping entry");else if(n.lineIndent<e)break}return v&&Ld(n,h,f,p,g,null,o,a,l),y&&(n.tag=c,n.anchor=d,n.kind="mapping",n.result=h),y}function TG(n){var e,t=!1,r=!1,i,s,o;if(o=n.input.charCodeAt(n.position),o!==33)return!1;if(n.tag!==null&&Vt(n,"duplication of a tag property"),o=n.input.charCodeAt(++n.position),o===60?(t=!0,o=n.input.charCodeAt(++n.position)):o===33?(r=!0,i="!!",o=n.input.charCodeAt(++n.position)):i="!",e=n.position,t){do o=n.input.charCodeAt(++n.position);while(o!==0&&o!==62);n.position<n.length?(s=n.input.slice(e,n.position),o=n.input.charCodeAt(++n.position)):Vt(n,"unexpected end of the stream within a verbatim tag")}else{for(;o!==0&&!is(o);)o===33&&(r?Vt(n,"tag suffix cannot contain exclamation marks"):(i=n.input.slice(e-1,n.position+1),Q4.test(i)||Vt(n,"named tag handle cannot contain such characters"),r=!0,e=n.position+1)),o=n.input.charCodeAt(++n.position);s=n.input.slice(e,n.position),pG.test(s)&&Vt(n,"tag suffix cannot contain flow indicator characters")}s&&!$4.test(s)&&Vt(n,"tag name cannot contain such characters: "+s);try{s=decodeURIComponent(s)}catch{Vt(n,"tag name is malformed: "+s)}return t?n.tag=s:pc.call(n.tagMap,i)?n.tag=n.tagMap[i]+s:i==="!"?n.tag="!"+s:i==="!!"?n.tag="tag:yaml.org,2002:"+s:Vt(n,'undeclared tag handle "'+i+'"'),!0}function AG(n){var e,t;if(t=n.input.charCodeAt(n.position),t!==38)return!1;for(n.anchor!==null&&Vt(n,"duplication of an anchor property"),t=n.input.charCodeAt(++n.position),e=n.position;t!==0&&!is(t)&&!Nd(t);)t=n.input.charCodeAt(++n.position);return n.position===e&&Vt(n,"name of an anchor node must contain at least one character"),n.anchor=n.input.slice(e,n.position),!0}function CG(n){var e,t,r;if(r=n.input.charCodeAt(n.position),r!==42)return!1;for(r=n.input.charCodeAt(++n.position),e=n.position;r!==0&&!is(r)&&!Nd(r);)r=n.input.charCodeAt(++n.position);return n.position===e&&Vt(n,"name of an alias node must contain at least one character"),t=n.input.slice(e,n.position),pc.call(n.anchorMap,t)||Vt(n,'unidentified alias "'+t+'"'),n.result=n.anchorMap[t],Rr(n,!0,-1),!0}function Sh(n,e,t,r,i){var s,o,a,l=1,c=!1,d=!1,h,f,p,g,m,v;if(n.listener!==null&&n.listener("open",n),n.tag=null,n.anchor=null,n.kind=null,n.result=null,s=o=a=Ey===t||L4===t,r&&Rr(n,!0,-1)&&(c=!0,n.lineIndent>e?l=1:n.lineIndent===e?l=0:n.lineIndent<e&&(l=-1)),l===1)for(;TG(n)||AG(n);)Rr(n,!0,-1)?(c=!0,a=s,n.lineIndent>e?l=1:n.lineIndent===e?l=0:n.lineIndent<e&&(l=-1)):a=!1;if(a&&(a=c||i),(l===1||Ey===t)&&(Cy===t||N4===t?m=e:m=e+1,v=n.position-n.lineStart,l===1?a&&(OC(n,v)||SG(n,v,m))||xG(n,m)?d=!0:(o&&kG(n,m)||_G(n,m)||OG(n,m)?d=!0:CG(n)?(d=!0,(n.tag!==null||n.anchor!==null)&&Vt(n,"alias node should not have any properties")):wG(n,m,Cy===t)&&(d=!0,n.tag===null&&(n.tag="?")),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):l===0&&(d=a&&OC(n,v))),n.tag===null)n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);else if(n.tag==="?"){for(n.result!==null&&n.kind!=="scalar"&&Vt(n,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+n.kind+'"'),h=0,f=n.implicitTypes.length;h<f;h+=1)if(g=n.implicitTypes[h],g.resolve(n.result)){n.result=g.construct(n.result),n.tag=g.tag,n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);break}}else if(n.tag!=="!"){if(pc.call(n.typeMap[n.kind||"fallback"],n.tag))g=n.typeMap[n.kind||"fallback"][n.tag];else for(g=null,p=n.typeMap.multi[n.kind||"fallback"],h=0,f=p.length;h<f;h+=1)if(n.tag.slice(0,p[h].tag.length)===p[h].tag){g=p[h];break}g||Vt(n,"unknown tag !<"+n.tag+">"),n.result!==null&&g.kind!==n.kind&&Vt(n,"unacceptable node kind for !<"+n.tag+'> tag; it should be "'+g.kind+'", not "'+n.kind+'"'),g.resolve(n.result,n.tag)?(n.result=g.construct(n.result,n.tag),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):Vt(n,"cannot resolve a node with !<"+n.tag+"> explicit tag")}return n.listener!==null&&n.listener("close",n),n.tag!==null||n.anchor!==null||d}function EG(n){var e=n.position,t,r,i,s=!1,o;for(n.version=null,n.checkLineBreaks=n.legacy,n.tagMap=Object.create(null),n.anchorMap=Object.create(null);(o=n.input.charCodeAt(n.position))!==0&&(Rr(n,!0,-1),o=n.input.charCodeAt(n.position),!(n.lineIndent>0||o!==37));){for(s=!0,o=n.input.charCodeAt(++n.position),t=n.position;o!==0&&!is(o);)o=n.input.charCodeAt(++n.position);for(r=n.input.slice(t,n.position),i=[],r.length<1&&Vt(n,"directive name must not be less than one character in length");o!==0;){for(;gu(o);)o=n.input.charCodeAt(++n.position);if(o===35){do o=n.input.charCodeAt(++n.position);while(o!==0&&!Ma(o));break}if(Ma(o))break;for(t=n.position;o!==0&&!is(o);)o=n.input.charCodeAt(++n.position);i.push(n.input.slice(t,n.position))}o!==0&&wS(n),pc.call(wC,r)?wC[r](n,r,i):Py(n,'unknown document directive "'+r+'"')}if(Rr(n,!0,-1),n.lineIndent===0&&n.input.charCodeAt(n.position)===45&&n.input.charCodeAt(n.position+1)===45&&n.input.charCodeAt(n.position+2)===45?(n.position+=3,Rr(n,!0,-1)):s&&Vt(n,"directives end mark is expected"),Sh(n,n.lineIndent-1,Ey,!1,!0),Rr(n,!0,-1),n.checkLineBreaks&&fG.test(n.input.slice(e,n.position))&&Py(n,"non-ASCII line breaks are interpreted as content"),n.documents.push(n.result),n.position===n.lineStart&&db(n)){n.input.charCodeAt(n.position)===46&&(n.position+=3,Rr(n,!0,-1));return}if(n.position<n.length-1)Vt(n,"end of the stream or a document separator is expected");else return}function j4(n,e){n=String(n),e=e||{},n.length!==0&&(n.charCodeAt(n.length-1)!==10&&n.charCodeAt(n.length-1)!==13&&(n+=`
`),n.charCodeAt(0)===65279&&(n=n.slice(1)));var t=new bG(n,e),r=n.indexOf("\0");for(r!==-1&&(t.position=r,Vt(t,"null byte is not allowed in input")),t.input+="\0";t.input.charCodeAt(t.position)===32;)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)EG(t);return t.documents}function PG(n,e,t){e!==null&&typeof e=="object"&&typeof t>"u"&&(t=e,e=null);var r=j4(n,t);if(typeof e!="function")return r;for(var i=0,s=r.length;i<s;i+=1)e(r[i])}function IG(n,e){var t=j4(n,e);if(t.length!==0){if(t.length===1)return t[0];throw new Fi("expected a single document in the stream, but found more")}}var MG=PG,RG=IG,V4={loadAll:MG,load:RG},q4=Object.prototype.toString,H4=Object.prototype.hasOwnProperty,OS=65279,DG=9,qp=10,NG=13,LG=32,QG=33,$G=34,fO=35,FG=37,zG=38,BG=39,UG=42,Z4=44,jG=45,Iy=58,VG=61,qG=62,HG=63,ZG=64,W4=91,X4=93,WG=96,Y4=123,XG=124,G4=125,Ti={};Ti[0]="\\0";Ti[7]="\\a";Ti[8]="\\b";Ti[9]="\\t";Ti[10]="\\n";Ti[11]="\\v";Ti[12]="\\f";Ti[13]="\\r";Ti[27]="\\e";Ti[34]='\\"';Ti[92]="\\\\";Ti[133]="\\N";Ti[160]="\\_";Ti[8232]="\\L";Ti[8233]="\\P";var YG=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],GG=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function KG(n,e){var t,r,i,s,o,a,l;if(e===null)return{};for(t={},r=Object.keys(e),i=0,s=r.length;i<s;i+=1)o=r[i],a=String(e[o]),o.slice(0,2)==="!!"&&(o="tag:yaml.org,2002:"+o.slice(2)),l=n.compiledTypeMap.fallback[o],l&&H4.call(l.styleAliases,a)&&(a=l.styleAliases[a]),t[o]=a;return t}function JG(n){var e,t,r;if(e=n.toString(16).toUpperCase(),n<=255)t="x",r=2;else if(n<=65535)t="u",r=4;else if(n<=4294967295)t="U",r=8;else throw new Fi("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+t+Br.repeat("0",r-e.length)+e}var eK=1,Hp=2;function tK(n){this.schema=n.schema||bS,this.indent=Math.max(1,n.indent||2),this.noArrayIndent=n.noArrayIndent||!1,this.skipInvalid=n.skipInvalid||!1,this.flowLevel=Br.isNothing(n.flowLevel)?-1:n.flowLevel,this.styleMap=KG(this.schema,n.styles||null),this.sortKeys=n.sortKeys||!1,this.lineWidth=n.lineWidth||80,this.noRefs=n.noRefs||!1,this.noCompatMode=n.noCompatMode||!1,this.condenseFlow=n.condenseFlow||!1,this.quotingType=n.quotingType==='"'?Hp:eK,this.forceQuotes=n.forceQuotes||!1,this.replacer=typeof n.replacer=="function"?n.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function xC(n,e){for(var t=Br.repeat(" ",e),r=0,i=-1,s="",o,a=n.length;r<a;)i=n.indexOf(`
`,r),i===-1?(o=n.slice(r),r=a):(o=n.slice(r,i+1),r=i+1),o.length&&o!==`
`&&(s+=t),s+=o;return s}function pO(n,e){return`
`+Br.repeat(" ",n.indent*e)}function nK(n,e){var t,r,i;for(t=0,r=n.implicitTypes.length;t<r;t+=1)if(i=n.implicitTypes[t],i.resolve(e))return!0;return!1}function My(n){return n===LG||n===DG}function Zp(n){return 32<=n&&n<=126||161<=n&&n<=55295&&n!==8232&&n!==8233||57344<=n&&n<=65533&&n!==OS||65536<=n&&n<=1114111}function kC(n){return Zp(n)&&n!==OS&&n!==NG&&n!==qp}function SC(n,e,t){var r=kC(n),i=r&&!My(n);return(t?r:r&&n!==Z4&&n!==W4&&n!==X4&&n!==Y4&&n!==G4)&&n!==fO&&!(e===Iy&&!i)||kC(e)&&!My(e)&&n===fO||e===Iy&&i}function rK(n){return Zp(n)&&n!==OS&&!My(n)&&n!==jG&&n!==HG&&n!==Iy&&n!==Z4&&n!==W4&&n!==X4&&n!==Y4&&n!==G4&&n!==fO&&n!==zG&&n!==UG&&n!==QG&&n!==XG&&n!==VG&&n!==qG&&n!==BG&&n!==$G&&n!==FG&&n!==ZG&&n!==WG}function iK(n){return!My(n)&&n!==Iy}function Jf(n,e){var t=n.charCodeAt(e),r;return t>=55296&&t<=56319&&e+1<n.length&&(r=n.charCodeAt(e+1),r>=56320&&r<=57343)?(t-55296)*1024+r-56320+65536:t}function K4(n){var e=/^\n* /;return e.test(n)}var J4=1,gO=2,e5=3,t5=4,Sd=5;function sK(n,e,t,r,i,s,o,a){var l,c=0,d=null,h=!1,f=!1,p=r!==-1,g=-1,m=rK(Jf(n,0))&&iK(Jf(n,n.length-1));if(e||o)for(l=0;l<n.length;c>=65536?l+=2:l++){if(c=Jf(n,l),!Zp(c))return Sd;m=m&&SC(c,d,a),d=c}else{for(l=0;l<n.length;c>=65536?l+=2:l++){if(c=Jf(n,l),c===qp)h=!0,p&&(f=f||l-g-1>r&&n[g+1]!==" ",g=l);else if(!Zp(c))return Sd;m=m&&SC(c,d,a),d=c}f=f||p&&l-g-1>r&&n[g+1]!==" "}return!h&&!f?m&&!o&&!i(n)?J4:s===Hp?Sd:gO:t>9&&K4(n)?Sd:o?s===Hp?Sd:gO:f?t5:e5}function oK(n,e,t,r,i){n.dump=(function(){if(e.length===0)return n.quotingType===Hp?'""':"''";if(!n.noCompatMode&&(YG.indexOf(e)!==-1||GG.test(e)))return n.quotingType===Hp?'"'+e+'"':"'"+e+"'";var s=n.indent*Math.max(1,t),o=n.lineWidth===-1?-1:Math.max(Math.min(n.lineWidth,40),n.lineWidth-s),a=r||n.flowLevel>-1&&t>=n.flowLevel;function l(c){return nK(n,c)}switch(sK(e,a,n.indent,o,l,n.quotingType,n.forceQuotes&&!r,i)){case J4:return e;case gO:return"'"+e.replace(/'/g,"''")+"'";case e5:return"|"+TC(e,n.indent)+AC(xC(e,s));case t5:return">"+TC(e,n.indent)+AC(xC(aK(e,o),s));case Sd:return'"'+lK(e)+'"';default:throw new Fi("impossible error: invalid scalar style")}})()}function TC(n,e){var t=K4(n)?String(e):"",r=n[n.length-1]===`
`,i=r&&(n[n.length-2]===`
`||n===`
`),s=i?"+":r?"":"-";return t+s+`
`}function AC(n){return n[n.length-1]===`
`?n.slice(0,-1):n}function aK(n,e){for(var t=/(\n+)([^\n]*)/g,r=(function(){var c=n.indexOf(`
`);return c=c!==-1?c:n.length,t.lastIndex=c,CC(n.slice(0,c),e)})(),i=n[0]===`
`||n[0]===" ",s,o;o=t.exec(n);){var a=o[1],l=o[2];s=l[0]===" ",r+=a+(!i&&!s&&l!==""?`
`:"")+CC(l,e),i=s}return r}function CC(n,e){if(n===""||n[0]===" ")return n;for(var t=/ [^ ]/g,r,i=0,s,o=0,a=0,l="";r=t.exec(n);)a=r.index,a-i>e&&(s=o>i?o:a,l+=`
`+n.slice(i,s),i=s+1),o=a;return l+=`
`,n.length-i>e&&o>i?l+=n.slice(i,o)+`
`+n.slice(o+1):l+=n.slice(i),l.slice(1)}function lK(n){for(var e="",t=0,r,i=0;i<n.length;t>=65536?i+=2:i++)t=Jf(n,i),r=Ti[t],!r&&Zp(t)?(e+=n[i],t>=65536&&(e+=n[i+1])):e+=r||JG(t);return e}function cK(n,e,t){var r="",i=n.tag,s,o,a;for(s=0,o=t.length;s<o;s+=1)a=t[s],n.replacer&&(a=n.replacer.call(t,String(s),a)),(Cl(n,e,a,!1,!1)||typeof a>"u"&&Cl(n,e,null,!1,!1))&&(r!==""&&(r+=","+(n.condenseFlow?"":" ")),r+=n.dump);n.tag=i,n.dump="["+r+"]"}function EC(n,e,t,r){var i="",s=n.tag,o,a,l;for(o=0,a=t.length;o<a;o+=1)l=t[o],n.replacer&&(l=n.replacer.call(t,String(o),l)),(Cl(n,e+1,l,!0,!0,!1,!0)||typeof l>"u"&&Cl(n,e+1,null,!0,!0,!1,!0))&&((!r||i!=="")&&(i+=pO(n,e)),n.dump&&qp===n.dump.charCodeAt(0)?i+="-":i+="- ",i+=n.dump);n.tag=s,n.dump=i||"[]"}function uK(n,e,t){var r="",i=n.tag,s=Object.keys(t),o,a,l,c,d;for(o=0,a=s.length;o<a;o+=1)d="",r!==""&&(d+=", "),n.condenseFlow&&(d+='"'),l=s[o],c=t[l],n.replacer&&(c=n.replacer.call(t,l,c)),Cl(n,e,l,!1,!1)&&(n.dump.length>1024&&(d+="? "),d+=n.dump+(n.condenseFlow?'"':"")+":"+(n.condenseFlow?"":" "),Cl(n,e,c,!1,!1)&&(d+=n.dump,r+=d));n.tag=i,n.dump="{"+r+"}"}function dK(n,e,t,r){var i="",s=n.tag,o=Object.keys(t),a,l,c,d,h,f;if(n.sortKeys===!0)o.sort();else if(typeof n.sortKeys=="function")o.sort(n.sortKeys);else if(n.sortKeys)throw new Fi("sortKeys must be a boolean or a function");for(a=0,l=o.length;a<l;a+=1)f="",(!r||i!=="")&&(f+=pO(n,e)),c=o[a],d=t[c],n.replacer&&(d=n.replacer.call(t,c,d)),Cl(n,e+1,c,!0,!0,!0)&&(h=n.tag!==null&&n.tag!=="?"||n.dump&&n.dump.length>1024,h&&(n.dump&&qp===n.dump.charCodeAt(0)?f+="?":f+="? "),f+=n.dump,h&&(f+=pO(n,e)),Cl(n,e+1,d,!0,h)&&(n.dump&&qp===n.dump.charCodeAt(0)?f+=":":f+=": ",f+=n.dump,i+=f));n.tag=s,n.dump=i||"{}"}function PC(n,e,t){var r,i,s,o,a,l;for(i=t?n.explicitTypes:n.implicitTypes,s=0,o=i.length;s<o;s+=1)if(a=i[s],(a.instanceOf||a.predicate)&&(!a.instanceOf||typeof e=="object"&&e instanceof a.instanceOf)&&(!a.predicate||a.predicate(e))){if(t?a.multi&&a.representName?n.tag=a.representName(e):n.tag=a.tag:n.tag="?",a.represent){if(l=n.styleMap[a.tag]||a.defaultStyle,q4.call(a.represent)==="[object Function]")r=a.represent(e,l);else if(H4.call(a.represent,l))r=a.represent[l](e,l);else throw new Fi("!<"+a.tag+'> tag resolver accepts not "'+l+'" style');n.dump=r}return!0}return!1}function Cl(n,e,t,r,i,s,o){n.tag=null,n.dump=t,PC(n,t,!1)||PC(n,t,!0);var a=q4.call(n.dump),l=r,c;r&&(r=n.flowLevel<0||n.flowLevel>e);var d=a==="[object Object]"||a==="[object Array]",h,f;if(d&&(h=n.duplicates.indexOf(t),f=h!==-1),(n.tag!==null&&n.tag!=="?"||f||n.indent!==2&&e>0)&&(i=!1),f&&n.usedDuplicates[h])n.dump="*ref_"+h;else{if(d&&f&&!n.usedDuplicates[h]&&(n.usedDuplicates[h]=!0),a==="[object Object]")r&&Object.keys(n.dump).length!==0?(dK(n,e,n.dump,i),f&&(n.dump="&ref_"+h+n.dump)):(uK(n,e,n.dump),f&&(n.dump="&ref_"+h+" "+n.dump));else if(a==="[object Array]")r&&n.dump.length!==0?(n.noArrayIndent&&!o&&e>0?EC(n,e-1,n.dump,i):EC(n,e,n.dump,i),f&&(n.dump="&ref_"+h+n.dump)):(cK(n,e,n.dump),f&&(n.dump="&ref_"+h+" "+n.dump));else if(a==="[object String]")n.tag!=="?"&&oK(n,n.dump,e,s,l);else{if(a==="[object Undefined]")return!1;if(n.skipInvalid)return!1;throw new Fi("unacceptable kind of an object to dump "+a)}n.tag!==null&&n.tag!=="?"&&(c=encodeURI(n.tag[0]==="!"?n.tag.slice(1):n.tag).replace(/!/g,"%21"),n.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",n.dump=c+" "+n.dump)}return!0}function hK(n,e){var t=[],r=[],i,s;for(mO(n,t,r),i=0,s=r.length;i<s;i+=1)e.duplicates.push(t[r[i]]);e.usedDuplicates=new Array(s)}function mO(n,e,t){var r,i,s;if(n!==null&&typeof n=="object")if(i=e.indexOf(n),i!==-1)t.indexOf(i)===-1&&t.push(i);else if(e.push(n),Array.isArray(n))for(i=0,s=n.length;i<s;i+=1)mO(n[i],e,t);else for(r=Object.keys(n),i=0,s=r.length;i<s;i+=1)mO(n[r[i]],e,t)}function fK(n,e){e=e||{};var t=new tK(e);t.noRefs||hK(n,t);var r=n;return t.replacer&&(r=t.replacer.call({"":r},"",r)),Cl(t,0,r,!0,!0)?t.dump+`
`:""}var pK=fK,gK={dump:pK};function xS(n,e){return function(){throw new Error("Function yaml."+n+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}var mK=di,vK=m4,yK=w4,bK=S4,wK=T4,_K=bS,OK=V4.load,xK=V4.loadAll,kK=gK.dump,SK=Fi,TK={binary:I4,float:k4,map:b4,null:_4,pairs:R4,set:D4,timestamp:E4,bool:O4,int:x4,merge:P4,omap:M4,seq:y4,str:v4},AK=xS("safeLoad","load"),CK=xS("safeLoadAll","loadAll"),EK=xS("safeDump","dump"),PK={Type:mK,Schema:vK,FAILSAFE_SCHEMA:yK,JSON_SCHEMA:bK,CORE_SCHEMA:wK,DEFAULT_SCHEMA:_K,load:OK,loadAll:xK,dump:kK,YAMLException:SK,types:TK,safeLoad:AK,safeLoadAll:CK,safeDump:EK};const IK=["=","!=",">","<",">=","<=","LIKE","IN","NOT IN","BETWEEN"],MK=["asc","desc"],IC=200,zv=[10,25,50,100],Th=25;function n5(n){const e=new Set,t=[],r=[];for(const i of n){if(e.has(i.field)){r.push({type:"duplicate_field",field:i.field,message:`Multiple filters for "${i.field}" - only the first is used. Use IN/NOT IN for multiple values or BETWEEN for ranges.`});continue}e.add(i.field),t.push(i)}return{filters:t,warnings:r}}function RK(n){return DK(n)?.config??null}function DK(n){try{const e=PK.load(n);return LK(e)}catch(e){return console.error("Failed to parse flint-deck YAML:",e),null}}function NK(n){const e=[];if(!n||typeof n!="object")return{view:null,warnings:e};const t=n;if(typeof t.name!="string"||!t.name.trim())return{view:null,warnings:e};if(!Array.isArray(t.filters))return{view:null,warnings:e};const r=[];for(const o of t.filters){const a=r5(o);a&&r.push(a)}const i=n5(r);e.push(...i.warnings);const s={name:t.name.trim(),filters:i.filters};if(t.sort){const o=i5(t.sort);o&&(s.sort=o)}if(Array.isArray(t.columns)){const o=[];for(const a of t.columns){const l=s5(a);l&&o.push(l)}o.length>0&&(s.columns=o)}return{view:s,warnings:e}}function LK(n){const e=[];if(!n||typeof n!="object")return null;const t=n,r={};if(Array.isArray(t.views)&&t.views.length>0){const i=[];for(const s of t.views){const o=NK(s);o.view&&(i.push(o.view),e.push(...o.warnings))}i.length>0&&(r.views=i,r.activeView=typeof t.activeView=="number"?Math.max(0,Math.min(t.activeView,i.length-1)):0)}if(!r.views&&Array.isArray(t.filters)){const i=[];for(const a of t.filters){const l=r5(a);l&&i.push(l)}const s=n5(i);e.push(...s.warnings);const o={name:"Default",filters:s.filters};if(t.sort){const a=i5(t.sort);a&&(o.sort=a)}if(Array.isArray(t.columns)){const a=[];for(const l of t.columns){const c=s5(l);c&&a.push(c)}a.length>0&&(o.columns=a)}r.views=[o],r.activeView=0}return!r.views||r.views.length===0?null:(typeof t.pageSize=="number"&&t.pageSize>0?r.pageSize=Math.min(Math.max(t.pageSize,zv[0]),IC):typeof t.limit=="number"&&t.limit>0?r.pageSize=Math.min(t.limit,zv[zv.length-1]):r.pageSize=Th,typeof t.limit=="number"&&t.limit>0&&(r.limit=Math.min(t.limit,IC)),t.expanded===!0&&(r.expanded=!0),{config:r,warnings:e})}function r5(n){if(!n||typeof n!="object")return null;const e=n;if(typeof e.field!="string"||!e.field.trim()||e.value===void 0||e.value===null)return null;const t={field:e.field.trim(),value:$K(e.value)};if(e.operator!==void 0){if(typeof e.operator!="string"||!IK.includes(e.operator))return null;t.operator=e.operator}return t}function i5(n){if(!n||typeof n!="object")return null;const e=n;return typeof e.field!="string"||!e.field.trim()||typeof e.order!="string"||!MK.includes(e.order)?null:{field:e.field.trim(),order:e.order}}const QK=["default","relative","absolute","iso","pills","comma","check","yesno"];function s5(n){if(typeof n=="string"&&n.trim().length>0)return n.trim();if(n&&typeof n=="object"){const e=n;if(typeof e.field!="string"||!e.field.trim())return null;const t={field:e.field.trim()};return typeof e.label=="string"&&e.label.trim()&&(t.label=e.label.trim()),e.format!==void 0&&(typeof e.format!="string"||!QK.includes(e.format)?t.format="default":t.format=e.format),e.visible===!1&&(t.visible=!1),t}return null}function $K(n){return Array.isArray(n)?n.map(e=>String(e)):String(n)}function kS(){return{views:[{name:"Default",filters:[],sort:{field:"updated",order:"desc"}}],activeView:0,pageSize:Th}}function Wp(n){if(n.views&&n.views.length>0){const e=n.activeView??0;return n.views[Math.min(e,n.views.length-1)]}return{name:"Default",filters:n.filters??[],columns:n.columns,sort:n.sort}}const Uu={sessionSize:5,sessionsPerWeek:7,maxIntervalSessions:15,minIntervalDays:1},FK={1:.5,2:1.5,3:2.5},nu={1:"Need more time",2:"Productive",3:"Already familiar",4:"Fully processed"},zm={1:"See sooner",2:"Normal",3:"See later",4:"Done with this"};function zK(n,e,t,r=Uu){if(t===4)return"retired";const i=FK[t],s=Math.max(1,Math.round(e*i)),o=Math.min(s,r.maxIntervalSessions);return{nextSession:n+o,interval:o}}function o5(n){if(!n)return!0;const e=new Date,t=new Date(n),r=o=>{const a=new Date(o);return a.getHours()<1&&a.setDate(a.getDate()-1),a.toISOString().split("T")[0]},i=r(e),s=r(t);return i!==s}function BK(n){if(o5(n))return null;const e=new Date,t=new Date(e);return t.setDate(t.getDate()+1),t.setHours(1,0,0,0),t}function UK(n){const e=["th","st","nd","rd"],t=n%100;return n+(e[(t-20)%10]||e[t]||e[0])}function jK(n,e,t,r,i){return{date:new Date().toISOString(),sessionNumber:n,rating:e,response:t,prompt:r,feedback:i}}function VK(n){return n>=2}function qK(){return`session-${Date.now().toString(36)}-${Math.random().toString(36).substring(2,8)}`}let Ft=j(Qt({notes:{},workspaces:{},activeWorkspaceId:"",noteTypes:{}})),Fe=null,_r=j(Qt([])),ji=j(null),Lr=j(null),qg=j(null),a5=j(null),Dw=j(!1),vO=j(!0);const $a=new Map,Ca="type-default",HK=new Set(["type-default","type-daily"]);function Xp(n){return HK.has(n)}function Hg(n){if(n.sourceFormat)return n.sourceFormat;switch(n.type){case wO:return"pdf";case bO:return"epub";case _O:return"webpage";case OO:return"deck";default:return"markdown"}}async function Ah(n){b(vO,!0);try{const e=zX(),{vaults:t,activeVault:r}=await ZX(e);if(b(_r,t,!0),!r){b(ji,null),b(Dw,!0);return}const i=n&&t.find(a=>a.id===n)||r;b(ji,i.id,!0);let s;try{s=await e4(e,i.docUrl)}catch(a){console.warn("Document unavailable, clearing orphaned vault data:",a instanceof Error?a.message:a),HX(),b(_r,[],!0),b(ji,null),b(Dw,!0);return}Fe=s;const o=s.doc();if(o&&b(Ft,o,!0),l5(),c5(),u5(),YK().catch(a=>{console.error("[Migration] Deck config migration failed:",a)}),d5(),s.on("change",({doc:a})=>{b(Ft,a,!0)}),i.baseDirectory){await cb(e,i);try{const{setupFileSyncListener:a}=await _h(async()=>{const{setupFileSyncListener:l}=await Promise.resolve().then(()=>VQ);return{setupFileSyncListener:l}},void 0);a()}catch(a){console.error("[FileSync] Failed to set up file sync listener:",a)}}GK(),b(Dw,!0)}finally{b(vO,!1)}}function l5(){if(!Fe)return;Fe.doc()?.noteTypes?.[Ca]||Fe.change(e=>{e.noteTypes||(e.noteTypes={}),e.noteTypes[Ca]||(e.noteTypes[Ca]={id:Ca,name:"Note",purpose:"General purpose notes",icon:"ð",archived:!1,created:Wt()})})}function c5(){if(!Fe)return;const n=Fe.doc();if(!n?.notes)return;const e=[wO,bO,_O,OO],r=Object.values(n.notes).filter(s=>e.includes(s.type)),i=e.filter(s=>n.noteTypes?.[s]);r.length===0&&i.length===0||(r.length>0&&console.log(`[Migration] Migrating ${r.length} notes from legacy type IDs`),i.length>0&&console.log(`[Migration] Removing ${i.length} legacy note type entries`),Fe.change(s=>{for(const o of r){const a=s.notes[o.id];if(a){if(!a.sourceFormat)switch(o.type){case wO:a.sourceFormat="pdf";break;case bO:a.sourceFormat="epub";break;case _O:a.sourceFormat="webpage";break;case OO:a.sourceFormat="deck";break}a.type=Ca}}for(const o of i)s.noteTypes?.[o]&&delete s.noteTypes[o]}))}const Bm=2;function ZK(n){if(!n.notes)return;const e=new Set(["flint_id","id","flint_title","title","flint_type","type","flint_kind","flint_filename","flint_created","created","flint_updated","updated","flint_archived","archived","flint_lastOpened","lastOpened"]),t=new Set(["reviewEnabled","reviewCount","reviewSessionNumber","reviewInterval","reviewStatus","reviewHistory","reviewNextReview","reviewLastReviewed"]);for(const r of Object.keys(n.notes)){const i=n.notes[r];if(i?.props){for(const s of e)s in i.props&&delete i.props[s];if(!i.review&&i.props.reviewEnabled!==void 0){const s=i.props.reviewHistory??[];i.review={enabled:!!i.props.reviewEnabled,lastReviewed:i.props.reviewLastReviewed||null,nextSessionNumber:i.props.reviewSessionNumber??1,currentInterval:i.props.reviewInterval??1,status:i.props.reviewStatus??"active",reviewCount:i.props.reviewCount??0,reviewHistory:Qs(s)}}for(const s of t)s in i.props&&delete i.props[s];Object.keys(i.props).length===0&&delete i.props}}}function WK(n){if(!n.notes)return;const e={flint_type:"type",flint_title:"title",flint_created:"created",flint_updated:"updated",flint_archived:"archived"},t=new Set(["type","type_id","title","created","updated","archived"]);function r(i){return i.startsWith("props.")?i:e[i]?e[i]:t.has(i)?i:`props.${i}`}for(const i of Object.keys(n.notes)){const s=n.notes[i];if(!s?.props?.deckConfig)continue;const o=s.props.deckConfig;if(!o.views)continue;let a=!1;for(const l of o.views){if(l.filters)for(const c of l.filters){const d=r(c.field);d!==c.field&&(c.field=d,a=!0)}if(l.sort){const c=r(l.sort.field);c!==l.sort.field&&(l.sort.field=c,a=!0)}if(l.columns)for(let c=0;c<l.columns.length;c++){const d=l.columns[c],h=typeof d=="string"?d:d.field,f=r(h);f!==h&&(typeof d=="string"?l.columns[c]=f:d.field=f,a=!0)}}a&&(s.updated=Wt())}}const XK={1:ZK,2:WK};function u5(){if(!Fe)return;const n=Fe.doc();if(!n)return;const e=n.schemaVersion??0;e>=Bm||(console.log(`[Migration] Upgrading schema from v${e} to v${Bm}`),Fe.change(t=>{for(let r=e+1;r<=Bm;r++){const i=XK[r];i&&(console.log(`[Migration] Running migration to v${r}`),i(t))}t.schemaVersion=Bm}))}async function YK(){if(!Fe)return;const n=Fe.doc();if(!n?.notes)return;const e=[];for(const t of Object.keys(n.notes)){const r=n.notes[t];!r||!(r.sourceFormat==="deck"||r.type==="type-flint-deck"||r.type==="Deck")||r.props?.deckConfig||e.push(t)}if(e.length!==0){console.log(`[Migration] Migrating ${e.length} deck notes to structured config`);for(const t of e)try{const r=await ns(t);if(!r)continue;const i=r.match(/```flint-deck\n([\s\S]*?)```/),s=i?i[1]:r.trim();if(!s)continue;const o=RK(s);if(!o){console.warn(`[Migration] Failed to parse deck config for note ${t}`);continue}Fe.change(a=>{const l=a.notes[t];l&&(l.props||(l.props={}),l.props.deckConfig=Qs(o),l.sourceFormat||(l.sourceFormat="deck"),console.log(`[Migration] Migrated deck note ${t} to structured config`))})}catch(r){console.error(`[Migration] Error migrating deck note ${t}:`,r)}}}function GK(){fc.setContentLoader(ns);const n=Object.values(u(Ft).notes).filter(e=>!e.archived);fc.buildIndex(n).catch(e=>{console.error("[Search] Index build failed:",e)})}function d5(){const n=Fe?.doc();if(!n?.lastViewState)return;const{activeItem:e,systemView:t}=n.lastViewState;if(b(qg,t,!0),e){if(e.type==="note"){const r=n.notes[e.id];r&&!r.archived&&b(Lr,e,!0)}else if(e.type==="conversation"){const r=n.conversationIndex?.[e.id];r&&!r.archived&&b(Lr,e,!0)}}}function KK(){return u(_r)}function h5(){return u(_r).filter(n=>!n.archived)}function bl(){return u(_r).find(n=>n.id===u(ji))}function f5(n){b(_r,[...u(_r),n],!0)}function JK(n,e){b(_r,u(_r).map(t=>t.id===n?{...t,...e}:t),!0),Ou(u(_r))}function p5(n,e){const t=Zo(),r=qX(t,n,e);return f5(r),r}function ep(n){return!!n.legacyPath&&!n.docUrl}function eJ(n,e,t){b(_r,u(_r).map(r=>r.id===n?{id:r.id,name:r.name,docUrl:e,baseDirectory:t,archived:r.archived,created:r.created}:r),!0),Ou(u(_r))}async function ru(n){const e=u(_r).find(s=>s.id===n);if(!e)return null;const t=Zo();KX(),b(ji,n,!0),pS(n);const r=await e4(t,e.docUrl);Fe=r;const i=r.doc();return i&&b(Ft,i,!0),l5(),c5(),u5(),r.on("change",({doc:s})=>{b(Ft,s,!0)}),b(Lr,null),b(qg,null),d5(),r}function MC(){return Object.values(u(Ft).notes).filter(n=>!n.archived).sort((n,e)=>new Date(e.updated).getTime()-new Date(n.updated).getTime())}function cs(){return Object.values(u(Ft).notes)}function RC(){return u(Ft).notes}function iu(){return u(Ft).noteTypes}function tJ(n){if(!n.trim())return[];const e=n.toLowerCase();return Object.values(u(Ft).notes).filter(t=>!t.archived).filter(t=>t.title.toLowerCase().includes(e)).sort((t,r)=>new Date(r.updated).getTime()-new Date(t.updated).getTime())}function DC(n,e){if(!e?.filters||e.filters.length===0)return n;const t=e.logic??"AND",r=u(Ft).noteTypes;return n.filter(i=>t==="AND"?e.filters.every(s=>NC(i,s,r)):e.filters.some(s=>NC(i,s,r)))}function NC(n,e,t){const{field:r,operator:i="=",value:s}=e,o=oL(n,r,t);if(s===nb){const a=o==null||o==="";return i==="="?a:!a}return o==null?i==="!="||i==="="&&s==="false":aL(o,i,s)}async function zs(n){if(!Fe)throw new Error("Not initialized");if(!u(ji))throw new Error("No active vault");const e=Ug(),t=Wt(),r=Zo(),i=await ub(r,u(ji),e);n.content&&i.change(o=>{o.content=n.content||""}),Fe.change(o=>{o.notes[e]={id:e,title:n.title||"",type:n.type||Ca,created:t,updated:t,archived:!1,...n.props&&Object.keys(n.props).length>0?{props:{...n.props}}:{}},o.contentUrls||(o.contentUrls={}),o.contentUrls[e]=i.url;const a=o.activeWorkspaceId;if(a&&o.workspaces[a]){const l=o.workspaces[a];qi(l),l.recentItemIds.push({type:"note",id:e})}});const s=u(Ft).notes[e];return s&&fc.indexNote(s,n.content||"").catch(o=>{console.error("[Search] Failed to index new note:",o)}),e}function dl(n,e){if(!Fe)throw new Error("Not initialized");if(Fe.change(t=>{const r=t.notes[n];r&&(e.title!==void 0&&iL(t,["notes",n,"title"],e.title),e.type!==void 0&&(r.type=e.type),r.updated=Wt())}),e.title!==void 0){const t=u(Ft).notes[n];t&&fc.indexNote(t).catch(r=>{console.error("[Search] Failed to re-index note:",r)})}}async function gc(n,e){if(!Fe)throw new Error("Not initialized");if(!u(ji))throw new Error("No active vault");const t=Zo(),r=u(Ft).contentUrls?.[n];(await ub(t,u(ji),n,r)).change(o=>{iL(o,["content"],e)}),Fe.change(o=>{const a=o.notes[n];a&&(a.updated=Wt())});const s=u(Ft).notes[n];s&&fc.indexNote(s,e).catch(o=>{console.error("[Search] Failed to re-index note content:",o)})}async function ns(n){if(!u(ji))return"";const e=Zo(),t=u(Ft).contentUrls?.[n],r=await GX(e,u(ji),n,t);return r&&r.doc()?.content||""}async function Yp(n){if(!u(ji))return null;const e=Zo(),t=u(Ft).contentUrls?.[n];return ub(e,u(ji),n,t)}function Ch(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{const t=e.notes[n];t&&(t.archived=!0,t.updated=Wt())}),fc.removeNote(n)}function yO(n){if(!Fe)throw new Error("Not initialized");if(!Fe.doc()?.notes[n])return;Fe.change(r=>{const i=r.notes[n];i&&(i.archived=!1,i.updated=Wt())});const t=Fe.doc()?.notes[n];t&&fc.indexNote(t)}function Gp(){const n=u(Ft).workspaces,e=u(Ft).workspaceOrder;if(e&&e.length>0){const t=[];for(const r of e)n[r]&&t.push(n[r]);for(const r of Object.values(n))e.includes(r.id)||t.push(r);return t}return Object.values(n).sort((t,r)=>Date.parse(t.created)-Date.parse(r.created))}function ki(){const n=u(Ft).activeWorkspaceId;return n?u(Ft).workspaces[n]:void 0}function SS(n){if(n.pinnedItemIds&&Array.isArray(n.pinnedItemIds))return n.pinnedItemIds;const e=n.pinnedNoteIds;return e&&Array.isArray(e)?e.map(t=>({type:"note",id:t})):[]}function g5(n){if(n.recentItemIds&&Array.isArray(n.recentItemIds))return n.recentItemIds;const e=n.recentNoteIds;return e&&Array.isArray(e)?e.map(t=>({type:"note",id:t})):[]}function qi(n){if(!n.pinnedItemIds){const e=n.pinnedNoteIds;e&&Array.isArray(e)?(n.pinnedItemIds=e.map(t=>({type:"note",id:t})),delete n.pinnedNoteIds):n.pinnedItemIds=[]}if(!n.recentItemIds){const e=n.recentNoteIds;e&&Array.isArray(e)?(n.recentItemIds=e.map(t=>({type:"note",id:t})),delete n.recentNoteIds):n.recentItemIds=[]}}function m5(n,e){if(n.type==="note"){const t=u(Ft).notes[n.id];if(!t)return null;const r=e[t.type],i=t.title||"Untitled";return{id:t.id,type:"note",title:i,icon:r?.icon||"ð",updated:t.updated,metadata:{noteTypeId:t.type,isPreview:!t.title,archived:t.archived}}}else if(n.type==="conversation"){const t=u(Ft).conversationIndex?.[n.id];return!t||t.archived?null:{id:t.id,type:"conversation",title:t.title,icon:"ð¬",updated:t.updated,metadata:{messageCount:t.messageCount}}}return null}function LC(){const n=ki();if(!n)return[];const e=u(Ft).noteTypes??{};return g5(n).map(r=>m5(r,e)).filter(r=>r!==null)}function TS(n){if(!Fe)throw new Error("Not initialized");const e=WH();return Fe.change(t=>{t.workspaces[e]={id:e,name:n.name,icon:n.icon,pinnedItemIds:[],recentItemIds:[],created:Wt()},t.workspaceOrder||(t.workspaceOrder=[]),t.workspaceOrder.push(e)}),e}function v5(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{const r=t.workspaces[n];r&&(e.name!==void 0&&(r.name=e.name),e.icon!==void 0&&(r.icon=e.icon))})}function y5(n){if(!Fe)throw new Error("Not initialized");return Object.keys(u(Ft).workspaces).length<=1?!1:(Fe.change(t=>{if(delete t.workspaces[n],t.workspaceOrder){const r=t.workspaceOrder.indexOf(n);r!==-1&&t.workspaceOrder.splice(r,1)}if(t.activeWorkspaceId===n){const r=Object.keys(t.workspaces);t.activeWorkspaceId=r[0]||""}}),!0)}function Ry(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{e.workspaces[n]&&(e.activeWorkspaceId=n)})}function Dr(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{const t=e.workspaces[e.activeWorkspaceId];t&&(qi(t),!t.pinnedItemIds.some(r=>r.type===n.type&&r.id===n.id)&&(t.recentItemIds.some(r=>r.type===n.type&&r.id===n.id)||t.recentItemIds.push(n)))})}function Nw(n){if(!Fe)throw new Error("Not initialized");const e=ki();if(!e)return null;const t=g5(e),r=t.findIndex(s=>s.type===n.type&&s.id===n.id);if(r===-1)return null;let i=null;return t.length>1&&(r<t.length-1?i=t[r+1]:i=t[r-1]),Fe.change(s=>{const o=s.workspaces[s.activeWorkspaceId];if(o){qi(o);const a=o.recentItemIds.findIndex(l=>l.type===n.type&&l.id===n.id);a!==-1&&o.recentItemIds.splice(a,1)}}),u(Lr)?.type===n.type&&u(Lr).id===n.id&&cn(i||null),i}function nJ(n,e){if(!Fe)throw new Error("Not initialized");const t=u(Ft).activeWorkspaceId;e!==t&&(Fe.change(r=>{const i=r.workspaces[t];if(i){qi(i);const o=i.pinnedItemIds.findIndex(l=>l.type===n.type&&l.id===n.id);o!==-1&&i.pinnedItemIds.splice(o,1);const a=i.recentItemIds.findIndex(l=>l.type===n.type&&l.id===n.id);a!==-1&&i.recentItemIds.splice(a,1)}const s=r.workspaces[e];if(s){qi(s);const o=s.pinnedItemIds.some(l=>l.type===n.type&&l.id===n.id),a=s.recentItemIds.some(l=>l.type===n.type&&l.id===n.id);!o&&!a&&s.recentItemIds.push({type:n.type,id:n.id})}}),u(Lr)?.type===n.type&&u(Lr).id===n.id&&cn(null))}function QC(n,e){if(!Fe)throw new Error("Not initialized");ki()&&Fe.change(r=>{const i=r.workspaces[r.activeWorkspaceId];if(!i)return;qi(i);const[s]=i.recentItemIds.splice(n,1);i.recentItemIds.splice(e,0,{type:s.type,id:s.id})})}function rJ(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{if(!t.workspaceOrder){const i=Object.values(t.workspaces);t.workspaceOrder=i.sort((s,o)=>new Date(s.created).getTime()-new Date(o.created).getTime()).map(s=>s.id)}if(n<0||n>=t.workspaceOrder.length||e<0||e>=t.workspaceOrder.length)return;const[r]=t.workspaceOrder.splice(n,1);t.workspaceOrder.splice(e,0,r)})}function $C(){const n=ki();if(!n)return[];const e=u(Ft).noteTypes??{};return SS(n).map(r=>m5(r,e)).filter(r=>r!==null)}function Kp(n){if(!Fe)throw new Error("Not initialized");const e=ki();!e||SS(e).some(r=>r.type===n.type&&r.id===n.id)||Fe.change(r=>{const i=r.workspaces[r.activeWorkspaceId];if(!i)return;qi(i),i.pinnedItemIds.some(o=>o.type===n.type&&o.id===n.id)||i.pinnedItemIds.push(n);const s=i.recentItemIds.findIndex(o=>o.type===n.type&&o.id===n.id);s!==-1&&i.recentItemIds.splice(s,1)})}function Bv(n){if(!Fe)throw new Error("Not initialized");ki()&&Fe.change(t=>{const r=t.workspaces[t.activeWorkspaceId];if(!r)return;qi(r);const i=r.pinnedItemIds.findIndex(s=>s.type===n.type&&s.id===n.id);i!==-1&&(r.pinnedItemIds.splice(i,1),r.recentItemIds.some(s=>s.type===n.type&&s.id===n.id)||r.recentItemIds.push(n))})}function iJ(n){const e=ki();return e?SS(e).some(r=>r.type===n.type&&r.id===n.id):!1}function FC(n,e){if(!Fe)throw new Error("Not initialized");ki()&&Fe.change(r=>{const i=r.workspaces[r.activeWorkspaceId];if(!i)return;qi(i);const[s]=i.pinnedItemIds.splice(n,1);i.pinnedItemIds.splice(e,0,{type:s.type,id:s.id})})}function yo(){return Object.values(u(Ft).noteTypes??{}).filter(n=>!n.archived).sort((n,e)=>n.name.localeCompare(e.name))}function sJ(){return Object.values(u(Ft).noteTypes??{})}function jr(n){return u(Ft).noteTypes?.[n]}function hb(n){if(!Fe)throw new Error("Not initialized");const e=XH();return Fe.change(t=>{t.noteTypes||(t.noteTypes={});const r={id:e,name:n.name,purpose:n.purpose||"",icon:n.icon||"ð",archived:!1,created:Wt()};n.properties!==void 0&&(r.properties=Qs(n.properties).map(i=>({...i,id:i.id||yy()}))),n.editorChips!==void 0&&(r.editorChips=[...n.editorChips]),t.noteTypes[e]=r}),e}function Qd(n,e){if(!Fe)throw new Error("Not initialized");if(Xp(n)&&e.name!==void 0){console.warn(`Cannot change name of system note type: ${n}`);return}Fe.change(t=>{const r=t.noteTypes?.[n];if(r){if(e.name!==void 0&&!Xp(n)&&(r.name=e.name),e.purpose!==void 0&&(r.purpose=e.purpose),e.icon!==void 0&&(r.icon=e.icon),e.properties!==void 0){const i=r.properties||[],s=Qs(e.properties).map(a=>({...a,id:a.id||yy()})),o=new Map;for(const a of s){if(!a.id)continue;const l=i.find(c=>c.id===a.id);l&&l.name!==a.name&&o.set(l.name,a.name)}if(o.size>0){const a=Object.values(t.notes);for(const l of a)if(l.type===n&&l.props)for(const[c,d]of o)c in l.props&&(l.props[d]=lL(l.props[c]),delete l.props[c]);r.editorChips&&(r.editorChips=r.editorChips.map(l=>o.get(l)||l))}r.properties=s}e.editorChips!==void 0&&(r.editorChips=[...e.editorChips]),e.agentInstructions!==void 0&&(r.agentInstructions=e.agentInstructions)}})}function b5(n){if(!Fe)throw new Error("Not initialized");if(Xp(n)){console.warn(`Cannot archive system note type: ${n}`);return}Fe.change(e=>{const t=e.noteTypes?.[n];t&&(t.archived=!0)})}function oJ(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{const t=e.noteTypes?.[n];t&&(t.archived=!1)})}function w5(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{const r=t.notes[n];r&&(r.type=e,r.updated=Wt())})}function Zn(n){return u(Ft).notes[n]}function aJ(n,e,t){if(!Fe)throw new Error("Not initialized");Fe.change(r=>{const i=r.notes[n];i&&(i.props||(i.props={}),i.props[e]=t,i.updated=Wt())})}function zC(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{const r=t.notes[n];if(r){r.props||(r.props={});for(const[i,s]of Object.entries(e))r.props[i]=lL(s);r.updated=Wt()}})}function _5(){Fe&&Fe.change(n=>{n.lastViewState={activeItem:u(Lr)?{type:u(Lr).type,id:u(Lr).id}:null,systemView:u(qg)}})}function O5(){return u(Lr)}function cn(n){b(Lr,n,!0),_5(),n?.type==="note"&&n.id&&(lJ(n.id),Dr({type:"note",id:n.id}))}function lJ(n){Fe&&Fe.change(e=>{const t=e.notes[n];t&&(t.lastOpened=Wt())})}function cJ(){return u(qg)}function Fn(n){b(qg,n,!0),_5()}function uJ(){return u(a5)}function mu(n){b(a5,n,!0)}function dJ(){if(!(!u(Lr)||u(Lr).type!=="note"))return u(Ft).notes[u(Lr).id]}function hJ(){if(!(!u(Lr)||u(Lr).type!=="conversation"))return u(Ft).conversationIndex?.[u(Lr).id]}function Rs(n){cn(n===null?null:{type:"note",id:n})}function AS(n){cn(n===null?null:{type:"conversation",id:n})}function El(n){Dr({type:"note",id:n})}async function fb(n,e,t){const r=t?.targetType||"note",i=t?.shouldCreate||!1;if(r==="conversation")return cn({type:"conversation",id:n}),Dr({type:"conversation",id:n}),n;if(r==="type")return mu(n),Fn("types"),n;if(i){const s=await zs({title:e});return Dr({type:"note",id:s}),cn({type:"note",id:s}),s}else return cn({type:"note",id:n}),n}const BC=/\[\[(n-[a-f0-9]{8})(?:\|[^\]]+)?\]\]/g;async function x5(n){const e=[];for(const t of Object.values(u(Ft).notes)){if(t.archived||t.id===n)continue;const i=(await ns(t.id)).split(`
`),s=[];for(let a=0;a<i.length;a++){const l=i[a];BC.lastIndex=0;let c;for(;(c=BC.exec(l))!==null;)c[1]===n&&s.push({source:"content",lineNumber:a,lineText:l,charStart:c.index,charEnd:c.index+c[0].length})}const o=jr(t.type);if(o?.properties)for(const a of o.properties)a.type==="notelink"?t.props?.[a.name]===n&&s.push({source:"property",propertyName:a.name}):a.type==="notelinks"&&t.props?.[a.name]?.includes(n)&&s.push({source:"property",propertyName:a.name});s.length>0&&e.push({note:t,occurrences:s})}return e.sort((t,r)=>r.occurrences.length-t.occurrences.length)}function fJ(){return u(vO)}const Gl="type-daily";function pJ(){if(!Fe)return;Fe.doc()?.noteTypes?.[Gl]||Fe.change(e=>{e.noteTypes||(e.noteTypes={}),e.noteTypes[Gl]||(e.noteTypes[Gl]={id:Gl,name:"Daily",purpose:"Daily notes for tracking progress and capturing thoughts",icon:"ð",archived:!1,created:Wt()})})}function k5(n){return`daily-${n}`}function S5(n){const e=k5(n);return u(Ft).notes[e]}async function T5(n){if(!Fe)throw new Error("Not initialized");if(!u(ji))throw new Error("No active vault");pJ();const e=k5(n),t=u(Ft).notes[e];if(t)return t;const r=Zo();if(!r)throw new Error("No repo available");const i=await ub(r,u(ji),e),s=Wt();return Fe.change(o=>{o.notes[e]={id:e,title:n,type:Gl,created:s,updated:s,archived:!1},o.contentUrls||(o.contentUrls={}),o.contentUrls[e]=i.url}),u(Ft).notes[e]}function gJ(n){const e=[];for(let r=0;r<7;r++){const i=UC(n,r),s=S5(i)||null,o=Object.values(u(Ft).notes).filter(l=>l.archived||l.type===Gl?!1:l.created.split("T")[0]===i),a=Object.values(u(Ft).notes).filter(l=>{if(l.archived||l.type===Gl)return!1;const c=l.created.split("T")[0];return l.updated.split("T")[0]===i&&c!==i});e.push({date:i,dailyNote:s,createdNotes:o,modifiedNotes:a,totalActivity:o.length+a.length+(s?1:0)})}const t=UC(n,6);return{startDate:n,endDate:t,days:e}}function UC(n,e){const[t,r,i]=n.split("-").map(Number),s=Date.UTC(t,r-1,i)+e*24*60*60*1e3,o=1440*60*1e3,l=Math.floor(s/o)+719468,c=Math.floor((l>=0?l:l-146096)/146097),d=l-c*146097,h=Math.floor((d-Math.floor(d/1460)+Math.floor(d/36524)-Math.floor(d/146096))/365),f=h+c*400,p=d-(365*h+Math.floor(h/4)-Math.floor(h/100)),g=Math.floor((5*p+2)/153),m=p-Math.floor((153*g+2)/5)+1,v=g+(g<10?3:-9);return`${f+(v<=2?1:0)}-${String(v).padStart(2,"0")}-${String(m).padStart(2,"0")}`}function A5(){const n=ki();if(!n)return[];const e=u(Ft).conversationIndex??{};return Object.values(e).filter(t=>!t.archived&&t.workspaceId===n.id).sort((t,r)=>new Date(r.updated).getTime()-new Date(t.updated).getTime())}async function mJ(n){const e=$a.get(n);if(e)return e;const t=await Al.retrieve(n);return t&&$a.set(n,t),t}function xu(n){return u(Ft).conversationIndex?.[n]}function C5(n){n?$a.delete(n):$a.clear()}async function Lw(n){if(!Fe)throw new Error("Not initialized");const e=ki();if(!e)throw new Error("No active workspace");const t=YH(),r=Wt(),i=n?.addToRecent??!0,s=n?.title||"New Conversation",o={id:t,title:s,workspaceId:e.id,messages:[],created:r,updated:r,archived:!1};return await Al.store(o),$a.set(t,o),Fe.change(a=>{if(a.conversationIndex||(a.conversationIndex={}),a.conversationIndex[t]={id:t,title:s,workspaceId:e.id,created:r,updated:r,archived:!1,messageCount:0},i){const l=a.workspaces[a.activeWorkspaceId];l&&(qi(l),l.recentItemIds.push({type:"conversation",id:t}))}}),t}async function yf(n,e){if(!Fe)throw new Error("Not initialized");let t=$a.get(n);if(!t){const a=await Al.retrieve(n);if(!a)throw new Error("Conversation not found");t=a}const r=GH(),i=Wt(),s={id:r,role:e.role,content:e.content,createdAt:i};e.toolCalls&&e.toolCalls.length>0&&(s.toolCalls=e.toolCalls.map(a=>{const l={id:a.id,name:a.name,args:{...a.args},status:a.status};return a.result!==void 0&&(l.result=a.result),a.error!==void 0&&(l.error=a.error),l})),t.messages.push(s),t.updated=i;let o=!1;if(t.title==="New Conversation"&&e.role==="user"){const a=e.content.slice(0,50).trim();t.title=a+(e.content.length>50?"...":""),o=!0}return await Al.store(t),$a.set(n,t),Fe.change(a=>{const l=a.conversationIndex?.[n];l&&(l.updated=i,l.messageCount=t.messages.length,o&&(l.title=t.title))}),r}async function vJ(n,e,t){const r=$a.get(n);if(!r)return;const i=r.messages.findIndex(a=>a.id===e);if(i===-1)return;const s=r.messages[i],o=Wt();t.content!==void 0&&(s.content=t.content),t.toolCalls!==void 0&&t.toolCalls.length>0&&(s.toolCalls=t.toolCalls.map(a=>{const l={id:a.id,name:a.name,args:{...a.args},status:a.status};return a.result!==void 0&&(l.result=a.result),a.error!==void 0&&(l.error=a.error),a.commentary!==void 0&&(l.commentary=a.commentary),l})),r.updated=o,await Al.store(r),Fe&&Fe.change(a=>{const l=a.conversationIndex?.[n];l&&(l.updated=o)})}async function E5(n){if(!Fe)throw new Error("Not initialized");const e=Wt(),t=$a.get(n)||await Al.retrieve(n);t&&(t.archived=!0,t.updated=e,await Al.store(t)),C5(n),Fe.change(r=>{const i=r.conversationIndex?.[n];i&&(i.archived=!0,i.updated=e);for(const s of Object.keys(r.workspaces)){const o=r.workspaces[s];qi(o);const a=o.pinnedItemIds.findIndex(c=>c.type==="conversation"&&c.id===n);a!==-1&&o.pinnedItemIds.splice(a,1);const l=o.recentItemIds.findIndex(c=>c.type==="conversation"&&c.id===n);l!==-1&&o.recentItemIds.splice(l,1)}}),u(Lr)?.type==="conversation"&&u(Lr).id===n&&cn(null)}async function yJ(n){if(!Fe)throw new Error("Not initialized");const e=Wt(),t=$a.get(n)||await Al.retrieve(n);t&&(t.archived=!1,t.updated=e,await Al.store(t)),C5(n),Fe.change(r=>{const i=r.conversationIndex?.[n];i&&(i.archived=!1,i.updated=e)})}function bJ(){return XX()}function Za(){return bl()?.baseDirectory!==void 0}function wJ(){return bl()?.baseDirectory}function _J(){const n=bl();return n?WX()===n.id:!1}async function OJ(){const n=bl();if(!n)return null;const e=await gS();if(!e)return null;t4(n.id,{baseDirectory:e});const t={...n,baseDirectory:e},r=u(_r).findIndex(s=>s.id===n.id);r!==-1&&(u(_r)[r]=t,b(_r,[...u(_r)],!0));const i=Zo();await cb(i,t);try{const{performInitialFileSync:s,performReverseFileSync:o,setupFileSyncListener:a}=await _h(async()=>{const{performInitialFileSync:l,performReverseFileSync:c,setupFileSyncListener:d}=await Promise.resolve().then(()=>VQ);return{performInitialFileSync:l,performReverseFileSync:c,setupFileSyncListener:d}},void 0);await s(),await o(),a()}catch(s){console.error("[FileSync] Failed to perform initial file sync:",s)}return e}async function xJ(){const n=bl();if(!n)return;await n4(),t4(n.id,{baseDirectory:void 0});const e={...n,baseDirectory:void 0},t=u(_r).findIndex(r=>r.id===n.id);t!==-1&&(u(_r)[t]=e,b(_r,[...u(_r)],!0))}function kJ(){return u(Ft).shelfItems??[]}function CS(n,e){return(u(Ft).shelfItems??[]).some(r=>r.type===n&&r.id===e)}function P5(n,e){if(!Fe)throw new Error("Not initialized");CS(n,e)||Fe.change(t=>{t.shelfItems||(t.shelfItems=[]),t.shelfItems.push({type:n,id:e,isExpanded:!1})})}function I5(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{if(!t.shelfItems)return;const r=t.shelfItems.findIndex(i=>i.type===n&&i.id===e);r!==-1&&t.shelfItems.splice(r,1)})}function SJ(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{if(!t.shelfItems)return;const r=t.shelfItems.find(i=>i.type===n&&i.id===e);r&&(r.isExpanded=!r.isExpanded)})}function TJ(n,e,t){if(!Fe)throw new Error("Not initialized");Fe.change(r=>{if(!r.shelfItems)return;const i=r.shelfItems.find(s=>s.type===n&&s.id===e);i&&i.isExpanded!==t&&(i.isExpanded=t)})}function AJ(){if(!Fe)throw new Error("Not initialized");Fe.change(n=>{n.shelfItems=[]})}const bO="type-epub";function M5(n){if(!Fe)throw new Error("Not initialized");const e=Ug(),t=Wt(),r={epubHash:n.epubHash,progress:0,textSize:100};return n.epubTitle!==void 0&&(r.epubTitle=n.epubTitle),n.epubAuthor!==void 0&&(r.epubAuthor=n.epubAuthor),Fe.change(i=>{i.notes[e]={id:e,title:n.title,content:"",type:Ca,sourceFormat:"epub",created:t,updated:t,archived:!1,props:r};const s=i.activeWorkspaceId;if(s&&i.workspaces[s]){const o=i.workspaces[s];qi(o),o.recentItemIds.push({type:"note",id:e})}}),e}function jC(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{const r=t.notes[n];if(!r)return;r.props||(r.props={});const i=r.props;e.currentCfi!==void 0&&(i.currentCfi=e.currentCfi),e.progress!==void 0&&(i.progress=e.progress),e.lastRead!==void 0&&(i.lastRead=e.lastRead),r.updated=Wt()})}function VC(n,e){if(!Fe)throw new Error("Not initialized");const t=Math.max(75,Math.min(200,e));Fe.change(r=>{const i=r.notes[n];i&&(i.props||(i.props={}),i.props.textSize=t,i.updated=Wt())})}const wO="type-pdf";function R5(n){if(!Fe)throw new Error("Not initialized");const e=Ug(),t=Wt(),r={pdfHash:n.pdfHash,totalPages:n.totalPages,currentPage:1,zoomLevel:100};return n.pdfTitle!==void 0&&(r.pdfTitle=n.pdfTitle),n.pdfAuthor!==void 0&&(r.pdfAuthor=n.pdfAuthor),Fe.change(i=>{i.notes[e]={id:e,title:n.title,content:"",type:Ca,sourceFormat:"pdf",created:t,updated:t,archived:!1,props:r};const s=i.activeWorkspaceId;if(s&&i.workspaces[s]){const o=i.workspaces[s];qi(o),o.recentItemIds.push({type:"note",id:e})}}),e}function qC(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{const r=t.notes[n];if(!r)return;r.props||(r.props={});const i=r.props;e.currentPage!==void 0&&(i.currentPage=e.currentPage),e.zoomLevel!==void 0&&(i.zoomLevel=e.zoomLevel),e.lastRead!==void 0&&(i.lastRead=e.lastRead),r.updated=Wt()})}function HC(n,e){if(!Fe)throw new Error("Not initialized");const t=Math.max(50,Math.min(200,e));Fe.change(r=>{const i=r.notes[n];i&&(i.props||(i.props={}),i.props.zoomLevel=t,i.updated=Wt())})}const _O="type-webpage";function D5(n){if(!Fe)throw new Error("Not initialized");const e=Ug(),t=Wt(),r={webpageHash:n.webpageHash,webpageUrl:n.webpageUrl,progress:0,archivedAt:t};return n.webpageTitle!==void 0&&(r.webpageTitle=n.webpageTitle),n.webpageAuthor!==void 0&&(r.webpageAuthor=n.webpageAuthor),n.webpageSiteName!==void 0&&(r.webpageSiteName=n.webpageSiteName),n.webpageExcerpt!==void 0&&(r.webpageExcerpt=n.webpageExcerpt),Fe.change(i=>{i.notes[e]={id:e,title:n.title,content:"",type:Ca,sourceFormat:"webpage",created:t,updated:t,archived:!1,props:r};const s=i.activeWorkspaceId;if(s&&i.workspaces[s]){const o=i.workspaces[s];qi(o),o.recentItemIds.push({type:"note",id:e})}}),e}function CJ(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{const r=t.notes[n];if(!r)return;r.props||(r.props={});const i=r.props;e.progress!==void 0&&(i.progress=e.progress),e.lastRead!==void 0&&(i.lastRead=e.lastRead),r.updated=Wt()})}const OO="type-deck";function EJ(){return Object.values(u(Ft).notes).filter(n=>!n.archived&&Hg(n)==="deck").sort((n,e)=>new Date(e.updated).getTime()-new Date(n.updated).getTime())}function N5(n,e){if(!Fe)throw new Error("Not initialized");const t=Ug(),r=Wt(),i=e??kS();return Fe.change(s=>{s.notes[t]={id:t,title:n,content:"",type:Ca,sourceFormat:"deck",created:r,updated:r,archived:!1,props:{deckConfig:Qs(i)}};const o=s.activeWorkspaceId;if(o&&s.workspaces[o]){const a=s.workspaces[o];qi(a),a.recentItemIds.push({type:"note",id:t})}}),t}function $d(n){const e=u(Ft).notes[n];return!e||Hg(e)!=="deck"?null:e.props?.deckConfig??null}function ES(n,e){if(!Fe)throw new Error("Not initialized");Fe.change(t=>{const r=t.notes[n];r&&(r.props||(r.props={}),r.props.deckConfig=Qs(e),r.updated=Wt())})}function Zg(){return u(Ft).reviewState??{currentSessionNumber:1,lastSessionDate:null,config:Uu}}function PS(){if(!Fe)return;Fe.doc()?.reviewState||Fe.change(e=>{e.reviewState||(e.reviewState={currentSessionNumber:1,lastSessionDate:null,config:{...Uu}})})}function pb(){return Zg().config??Uu}function PJ(n){if(!Fe)throw new Error("Not initialized");PS(),Fe.change(e=>{e.reviewState||(e.reviewState={currentSessionNumber:1,lastSessionDate:null,config:{...Uu}}),e.reviewState.config={...e.reviewState.config,...n}})}function Wg(){return Zg().currentSessionNumber}function IJ(){if(!Fe)throw new Error("Not initialized");PS(),Fe.change(n=>{n.reviewState||(n.reviewState={currentSessionNumber:1,lastSessionDate:null,config:{...Uu}}),n.reviewState.currentSessionNumber++,n.reviewState.lastSessionDate=new Date().toISOString().split("T")[0]})}function L5(){const n=Zg();return o5(n.lastSessionDate)}function MJ(){const n=Zg();return BK(n.lastSessionDate)}function IS(n){if(!Fe)throw new Error("Not initialized");const e=Wg();Fe.change(t=>{const r=t.notes[n];r&&(r.review?(r.review.enabled=!0,r.review.status="active",r.review.nextSessionNumber<e&&(r.review.nextSessionNumber=e+1,r.review.currentInterval=1)):r.review={enabled:!0,lastReviewed:null,nextSessionNumber:e+1,currentInterval:1,status:"active",reviewCount:0,reviewHistory:[]})})}function MS(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{const t=e.notes[n];t?.review&&(t.review.enabled=!1)})}function Dy(n){return u(Ft).notes[n]?.review??null}function RJ(){const n=Wg(),e=pb();return Object.values(u(Ft).notes).filter(r=>r.archived||!r.review?.enabled||r.review.status==="retired"?!1:r.review.nextSessionNumber<=n).sort((r,i)=>{const s=r.review?.nextSessionNumber??0,o=i.review?.nextSessionNumber??0;return s!==o?s-o:new Date(i.updated).getTime()-new Date(r.updated).getTime()}).slice(0,e.sessionSize)}function Q5(){const n=Wg(),e=Object.values(u(Ft).notes);let t=0,r=0,i=0;for(const s of e)s.archived||s.review?.enabled&&(r++,s.review.status==="retired"?i++:s.review.nextSessionNumber<=n&&t++);return{dueThisSession:t,totalEnabled:r,retired:i,currentSessionNumber:n}}function DJ(){const n=[];for(const e of Object.values(u(Ft).notes))if(!e.archived&&e.review?.reviewHistory)for(const t of e.review.reviewHistory)n.push({noteId:e.id,noteTitle:e.title,entry:t});return n.sort((e,t)=>new Date(t.entry.date).getTime()-new Date(e.entry.date).getTime()),n}function il(){return Zg().activeSession??null}function ZC(){return!!il()}function WC(n){if(!Fe)throw new Error("Not initialized");PS();const e={id:qK(),startedAt:Wt(),noteIds:n,currentIndex:0,results:[],state:"prompting"};return Fe.change(t=>{t.reviewState||(t.reviewState={currentSessionNumber:1,lastSessionDate:null,config:{...Uu}}),t.reviewState.activeSession=e}),e}function bf(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{if(!e.reviewState?.activeSession)return;const t=e.reviewState.activeSession;n.currentIndex!==void 0&&(t.currentIndex=n.currentIndex),n.currentPrompt!==void 0&&(t.currentPrompt=n.currentPrompt),n.userResponse!==void 0&&(t.userResponse=n.userResponse),n.agentFeedback!==void 0&&(t.agentFeedback=n.agentFeedback),n.state!==void 0&&(t.state=n.state)})}function NJ(n,e,t,r,i){if(!Fe)throw new Error("Not initialized");const s=Wg(),o=pb();let a=-1;return Fe.change(l=>{const c=l.notes[n];if(!c?.review)return;const d=c.review,h=zK(s,d.currentInterval,e,o);if(h==="retired"?(d.status="retired",d.nextSessionNumber=999999,a=-1):(d.nextSessionNumber=h.nextSession,d.currentInterval=h.interval,a=h.nextSession),d.lastReviewed=Wt(),d.reviewCount++,d.reviewHistory||(d.reviewHistory=[]),d.reviewHistory.push(jK(s,e,r,t,i)),l.reviewState?.activeSession){const f=l.reviewState.activeSession,p={noteId:n,noteTitle:c.title,rating:e,userResponse:r,agentFeedback:i,timestamp:Wt(),scheduledForSession:a};f.results||(f.results=[]),f.results.push(p),f.currentIndex++,delete f.currentPrompt,delete f.userResponse,delete f.agentFeedback,f.state="prompting"}}),a}function LJ(){if(!Fe)throw new Error("Not initialized");Fe.change(n=>{n.reviewState&&(delete n.reviewState.activeSession,n.reviewState.currentSessionNumber++,n.reviewState.lastSessionDate=new Date().toISOString().split("T")[0])})}function QJ(){if(!Fe)throw new Error("Not initialized");Fe.change(n=>{n.reviewState&&delete n.reviewState.activeSession})}function wf(){const n=il();if(!n)return null;const e=n.noteIds[n.currentIndex];return e?u(Ft).notes[e]??null:null}function $J(){const n=Wg(),e=pb(),t=[];for(const r of Object.values(u(Ft).notes)){if(r.archived||!r.review?.enabled)continue;const i=r.review,s=Math.max(0,i.nextSessionNumber-n),o=Math.round(s/e.sessionsPerWeek*7),a=new Date;a.setDate(a.getDate()+o),t.push({note:r,review:i,estimatedDue:a,isOverdue:i.nextSessionNumber<=n&&i.status==="active"})}return t.sort((r,i)=>r.isOverdue!==i.isOverdue?r.isOverdue?-1:1:r.review.nextSessionNumber-i.review.nextSessionNumber),t}function $5(n=7){const e=new Date;e.setDate(e.getDate()-n);const t=e.getTime(),r=u(Ft).processedNoteIds??{};return Object.values(u(Ft).notes).filter(i=>i.archived||new Date(i.created).getTime()<t?!1:!r[i.id]).map(i=>({id:i.id,title:i.title,type:i.type,created:i.created})).sort((i,s)=>new Date(s.created).getTime()-new Date(i.created).getTime())}function FJ(n=7){const e=new Date;e.setDate(e.getDate()-n);const t=e.getTime(),r=u(Ft).processedNoteIds??{};return Object.entries(r).filter(([i,s])=>{const o=u(Ft).notes[i];return!o||o.archived?!1:new Date(s).getTime()>=t}).map(([i,s])=>{const o=u(Ft).notes[i];return{id:o.id,title:o.title,type:o.type,created:o.created,processedAt:s}}).sort((i,s)=>new Date(s.processedAt).getTime()-new Date(i.processedAt).getTime())}function zJ(n=7){return $5(n).length}function BJ(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{e.processedNoteIds||(e.processedNoteIds={}),e.processedNoteIds[n]=Wt()})}function UJ(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{e.processedNoteIds&&e.processedNoteIds[n]&&delete e.processedNoteIds[n]})}function jJ(n){if(!Fe)throw new Error("Not initialized");const e=Wt();Fe.change(t=>{t.processedNoteIds||(t.processedNoteIds={});for(const r of n)t.processedNoteIds[r]=e})}function VJ(n){if(!Fe)throw new Error("Not initialized");Fe.change(e=>{if(e.processedNoteIds)for(const t of n)e.processedNoteIds[t]&&delete e.processedNoteIds[t]})}function mo(n){return u(Ft).agentRoutines?.[n]}function RS(n){const e=u(Ft).agentRoutines||{},t=n.toLowerCase();return Object.values(e).find(r=>r.name.toLowerCase()===t)}function qJ(n){const{frequency:e,dayOfWeek:t,dayOfMonth:r,time:i}=n,s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let o="";return e==="daily"?o="Every day":e==="weekly"&&t!==void 0?o=`Every ${s[t]}`:e==="monthly"&&r!==void 0?o=`Every month on the ${r}${r===1?"st":r===2?"nd":r===3?"rd":"th"}`:o=`Every ${e}`,i&&(o+=` at ${i}`),o}function HJ(n,e){const t=e||new Date;if(n.status!=="active")return!1;if(n.dueDate&&!n.recurringSpec)return new Date(n.dueDate)<=t;if(n.recurringSpec){const{frequency:r,dayOfWeek:i,dayOfMonth:s}=n.recurringSpec;if(!n.lastCompleted)return!0;const o=new Date(n.lastCompleted),a=Math.floor((t.getTime()-o.getTime())/(1e3*60*60*24));switch(r){case"daily":return a>=1;case"weekly":return i===void 0?!1:a>=7&&t.getDay()===i;case"monthly":return s===void 0?!1:a>=28&&t.getDate()===s;default:return!1}}return!1}function ZJ(n,e){const t=e||new Date;if(!n.recurringSpec)return null;const{frequency:r,dayOfWeek:i,dayOfMonth:s}=n.recurringSpec;if(!n.lastCompleted)return 0;const o=new Date(n.lastCompleted),a=Math.floor((t.getTime()-o.getTime())/(1e3*60*60*24));switch(r){case"daily":{const l=1-a;return l<0?0:l}case"weekly":{if(i===void 0)return null;const l=t.getDay(),c=i;let d=c-l;return d<0&&(d+=7),d===0&&(d=7),a<7&&l>=c,d}case"monthly":{if(s===void 0)return null;const l=t.getDate(),c=s;let d=c-l;return(d<0||d===0&&a<28)&&(d=new Date(t.getFullYear(),t.getMonth()+1,0).getDate()-l+c),d}default:return null}}function WJ(n,e){if(!!n.recurringSpec&&n.recurringSpec){const r=HJ(n,e);let i="scheduled";if(r)i="due_now";else{const s=ZJ(n,e);s!==null&&s<=7&&(i="upcoming")}return{type:i,recurringSchedule:qJ(n.recurringSpec)}}else if(n.dueDate){const r=new Date(n.dueDate),i=Math.ceil((r.getTime()-e.getTime())/(1e3*60*60*24));let s;return i<0?s="overdue":i===0?s="due_now":i<=7?s="upcoming":s="scheduled",{type:s,dueDate:n.dueDate}}}function th(n){const e=u(Ft).agentRoutines||{},t=new Date;let r=Object.values(e);n?.status&&n.status!=="all"?r=r.filter(l=>l.status===n.status):n?.includeArchived||(r=r.filter(l=>l.status!=="archived")),n?.type&&n.type!=="all"&&(r=r.filter(l=>l.type===n.type)),n?.recurringOnly&&(r=r.filter(l=>!!l.recurringSpec));let i=r.map(l=>{const c=WJ(l,t);return{id:l.id,name:l.name,purpose:l.purpose,status:l.status,type:l.type,isRecurring:!!l.recurringSpec,dueInfo:c,lastCompleted:l.lastCompleted}});n?.dueSoon&&(i=i.filter(l=>l.dueInfo&&(l.dueInfo.type==="due_now"||l.dueInfo.type==="upcoming"||l.dueInfo.type==="overdue"))),n?.overdueOnly&&(i=i.filter(l=>l.dueInfo?.type==="overdue"));const s=n?.sortBy||"dueDate",a=(n?.sortOrder||"asc")==="asc"?1:-1;return i.sort((l,c)=>{switch(s){case"name":return a*l.name.localeCompare(c.name);case"created":{const d=e[l.id],h=e[c.id];return a*(new Date(d?.created||0).getTime()-new Date(h?.created||0).getTime())}case"lastCompleted":{const d=l.lastCompleted?new Date(l.lastCompleted).getTime():0,h=c.lastCompleted?new Date(c.lastCompleted).getTime():0;return a*(d-h)}case"dueDate":default:{const d={overdue:1,due_now:2,upcoming:3,scheduled:4},h=l.dueInfo?d[l.dueInfo.type]:5,f=c.dueInfo?d[c.dueInfo.type]:5;return h!==f?a*(h-f):l.name.localeCompare(c.name)}}}),i}function F5(){return th({status:"active"}).filter(n=>n.dueInfo?.type==="due_now"||n.dueInfo?.type==="overdue")}function XJ(n=7){return th({status:"active"}).filter(e=>e.dueInfo?.type==="upcoming"||e.dueInfo?.type==="due_now"||e.dueInfo?.type==="overdue")}function z5(n){if(!Fe)throw new Error("Not initialized");if(n.name.length<1||n.name.length>20)throw new Error("Routine name must be between 1 and 20 characters");if(n.purpose.length<1||n.purpose.length>100)throw new Error("Routine purpose must be between 1 and 100 characters");const e=RS(n.name);if(e&&e.status!=="archived")throw new Error(`A routine named '${n.name}' already exists`);const t=KH(),r=Wt();return Fe.change(i=>{i.agentRoutines||(i.agentRoutines={});const s=(n.supplementaryMaterials||[]).map((o,a)=>({id:cL(),materialType:o.type,content:o.content,noteId:o.noteId,metadata:o.metadata?Qs(o.metadata):void 0,position:a,createdAt:r}));i.agentRoutines[t]={id:t,name:n.name,purpose:n.purpose,description:n.description,status:n.status||"active",type:n.type||"routine",recurringSpec:n.recurringSpec?Qs(n.recurringSpec):void 0,dueDate:n.dueDate,created:r,updated:r,supplementaryMaterials:s.length>0?s:void 0,completionHistory:[]}}),t}function B5(n){if(!Fe)throw new Error("Not initialized");if(!mo(n.routineId))throw new Error(`Routine not found: ${n.routineId}`);if(n.name!==void 0){if(n.name.length<1||n.name.length>20)throw new Error("Routine name must be between 1 and 20 characters");const t=RS(n.name);if(t&&t.id!==n.routineId&&t.status!=="archived")throw new Error(`A routine named '${n.name}' already exists`)}if(n.purpose!==void 0&&(n.purpose.length<1||n.purpose.length>100))throw new Error("Routine purpose must be between 1 and 100 characters");Fe.change(t=>{const r=t.agentRoutines?.[n.routineId];r&&(n.name!==void 0&&(r.name=n.name),n.purpose!==void 0&&(r.purpose=n.purpose),n.description!==void 0&&(r.description=n.description),n.status!==void 0&&(r.status=n.status),n.type!==void 0&&(r.type=n.type),n.recurringSpec===null?r.recurringSpec=void 0:n.recurringSpec!==void 0&&(r.recurringSpec=Qs(n.recurringSpec)),n.dueDate===null?r.dueDate=void 0:n.dueDate!==void 0&&(r.dueDate=n.dueDate),r.updated=Wt())})}function U5(n){if(!Fe)throw new Error("Not initialized");if(!mo(n))throw new Error(`Routine not found: ${n}`);Fe.change(t=>{const r=t.agentRoutines?.[n];r&&(r.status="archived",r.updated=Wt())})}function YJ(n){if(!Fe)throw new Error("Not initialized");if(!mo(n.routineId))throw new Error(`Routine not found: ${n.routineId}`);const t=JH(),r=Wt();return Fe.change(i=>{const s=i.agentRoutines?.[n.routineId];if(!s)return;s.completionHistory||(s.completionHistory=[]);const o={id:t,completedAt:r};n.conversationId!==void 0&&(o.conversationId=n.conversationId),n.notes!==void 0&&(o.notes=n.notes),n.outputNoteId!==void 0&&(o.outputNoteId=n.outputNoteId),n.metadata!==void 0&&(o.metadata=Qs(n.metadata)),s.completionHistory.push(o),s.lastCompleted=r,s.updated=r,s.recurringSpec||(s.status="completed")}),t}function GJ(n,e){if(!Fe)throw new Error("Not initialized");const t=mo(n);if(!t)throw new Error(`Routine not found: ${n}`);const r=cL(),i=Wt(),s=t.supplementaryMaterials||[],o=e.position??s.length;return Fe.change(a=>{const l=a.agentRoutines?.[n];l&&(l.supplementaryMaterials||(l.supplementaryMaterials=[]),l.supplementaryMaterials.push({id:r,materialType:e.type,content:e.content,noteId:e.noteId,metadata:e.metadata?Qs(e.metadata):void 0,position:o,createdAt:i}),l.updated=i)}),r}function KJ(n,e){if(!Fe)throw new Error("Not initialized");if(!mo(n))throw new Error(`Routine not found: ${n}`);Fe.change(r=>{const i=r.agentRoutines?.[n];if(!i||!i.supplementaryMaterials)return;const s=i.supplementaryMaterials.findIndex(o=>o.id===e);s!==-1&&(i.supplementaryMaterials.splice(s,1),i.updated=Wt())})}function JJ(){const n=yo();if(n.length===0)return`## Note Types

No note types are currently defined in this vault.
`;let e=`## Note Types

`;e+=`The following note types are available in this vault:

`;for(const t of n){const r=t.purpose?.trim()||"No purpose defined";e+=`- **${t.name}**: ${r}
`}return e+="\nWhen creating or updating notes of a specific type, use `get_note_type` to understand the full requirements including metadata schema and agent instructions.\n",e}function eee(n){const e=new Uint8Array(n);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}async function j5(n){const e=await crypto.subtle.digest("SHA-256",n);return eee(e)}async function ju(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("epubs",{create:!0})}async function tee(n){const e=await j5(n);if(await q5(e))return e;const i=await(await(await ju()).getFileHandle(`${e}.epub`,{create:!0})).createWritable();try{await i.write(n)}finally{await i.close()}return e}async function V5(n){try{return await(await(await(await ju()).getFileHandle(`${n}.epub`)).getFile()).arrayBuffer()}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return null;throw e}}async function q5(n){try{return await(await ju()).getFileHandle(`${n}.epub`),!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async function nee(n){try{return await(await ju()).removeEntry(`${n}.epub`),!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async function ree(){const n=await ju();let e=0,t=0;for await(const[r,i]of n.entries())if(i.kind==="file"&&r.endsWith(".epub")){e++;const o=await i.getFile();t+=o.size}return{totalFiles:e,totalBytes:t}}async function iee(){const n=await ju(),e=[];for await(const[t,r]of n.entries())r.kind==="file"&&t.endsWith(".epub")&&e.push(t.slice(0,-5));return e}async function see(){const n=await ju();let e=0;const t=[];for await(const[r,i]of n.entries())i.kind==="file"&&r.endsWith(".epub")&&t.push(r);for(const r of t)await n.removeEntry(r),e++;return e}const Vu={store:tee,retrieve:V5,exists:q5,remove:nee,getStorageStats:ree,listHashes:iee,clearAll:see,computeHash:j5};function oee(n){const e=new Uint8Array(n);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}async function H5(n){const e=await crypto.subtle.digest("SHA-256",n);return oee(e)}async function qu(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("pdfs",{create:!0})}async function aee(n){const e=await H5(n);if(await W5(e))return e;const i=await(await(await qu()).getFileHandle(`${e}.pdf`,{create:!0})).createWritable();try{await i.write(n)}finally{await i.close()}return e}async function Z5(n){try{return await(await(await(await qu()).getFileHandle(`${n}.pdf`)).getFile()).arrayBuffer()}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return null;throw e}}async function W5(n){try{return await(await qu()).getFileHandle(`${n}.pdf`),!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async function lee(n){try{return await(await qu()).removeEntry(`${n}.pdf`),!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async function cee(){const n=await qu();let e=0,t=0;for await(const[r,i]of n.entries())if(i.kind==="file"&&r.endsWith(".pdf")){e++;const o=await i.getFile();t+=o.size}return{totalFiles:e,totalBytes:t}}async function uee(){const n=await qu(),e=[];for await(const[t,r]of n.entries())r.kind==="file"&&t.endsWith(".pdf")&&e.push(t.slice(0,-4));return e}async function dee(){const n=await qu();let e=0;const t=[];for await(const[r,i]of n.entries())i.kind==="file"&&r.endsWith(".pdf")&&t.push(r);for(const r of t)await n.removeEntry(r),e++;return e}const Hu={store:aee,retrieve:Z5,exists:W5,remove:lee,getStorageStats:cee,listHashes:uee,clearAll:dee,computeHash:H5};function hee(n){const e=new Uint8Array(n);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}async function DS(n){const e=await crypto.subtle.digest("SHA-256",n);return hee(e)}async function fee(n){const t=new TextEncoder().encode(n);return DS(t.buffer)}async function Dl(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("webpages",{create:!0})}async function pee(n){const t=new TextEncoder().encode(n),r=await DS(t.buffer);if(await Y5(r))return r;const o=await(await(await Dl()).getFileHandle(`${r}.html`,{create:!0})).createWritable();try{await o.write(t)}finally{await o.close()}return r}async function gee(n,e){const r=await(await Dl()).getFileHandle(`${n}.meta.json`,{create:!0}),s=new TextEncoder().encode(JSON.stringify(e,null,2)),o=await r.createWritable();try{await o.write(s)}finally{await o.close()}}async function X5(n){try{return await(await(await(await Dl()).getFileHandle(`${n}.html`)).getFile()).text()}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return null;throw e}}async function mee(n){try{const i=await(await(await(await Dl()).getFileHandle(`${n}.meta.json`)).getFile()).text();return JSON.parse(i)}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return null;throw e}}async function Y5(n){try{return await(await Dl()).getFileHandle(`${n}.html`),!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async function vee(n){try{const e=await Dl();await e.removeEntry(`${n}.html`);try{await e.removeEntry(`${n}.meta.json`)}catch{}return!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async function yee(){const n=await Dl();let e=0,t=0;for await(const[r,i]of n.entries())if(i.kind==="file"&&r.endsWith(".html")){e++;const o=await i.getFile();t+=o.size}return{totalFiles:e,totalBytes:t}}async function bee(){const n=await Dl(),e=[];for await(const[t,r]of n.entries())r.kind==="file"&&t.endsWith(".html")&&e.push(t.slice(0,-5));return e}async function wee(){const n=await Dl();let e=0;const t=[];for await(const[r,i]of n.entries())i.kind==="file"&&t.push(r);for(const r of t)await n.removeEntry(r),r.endsWith(".html")&&e++;return e}const Fa={store:pee,storeMetadata:gee,retrieve:X5,retrieveMetadata:mee,exists:Y5,remove:vee,getStorageStats:yee,listHashes:bee,clearAll:wee,computeHash:DS,computeStringHash:fee};var Ms=Uint8Array,Fd=Uint16Array,_ee=Int32Array,G5=new Ms([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),K5=new Ms([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Oee=new Ms([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),J5=function(n,e){for(var t=new Fd(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new _ee(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},eQ=J5(G5,2),tQ=eQ.b,xee=eQ.r;tQ[28]=258,xee[258]=28;var kee=J5(K5,0),See=kee.b,xO=new Fd(32768);for(var sr=0;sr<32768;++sr){var Fl=(sr&43690)>>1|(sr&21845)<<1;Fl=(Fl&52428)>>2|(Fl&13107)<<2,Fl=(Fl&61680)>>4|(Fl&3855)<<4,xO[sr]=((Fl&65280)>>8|(Fl&255)<<8)>>1}var vp=(function(n,e,t){for(var r=n.length,i=0,s=new Fd(e);i<r;++i)n[i]&&++s[n[i]-1];var o=new Fd(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new Fd(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var c=i<<4|n[i],d=e-n[i],h=o[n[i]-1]++<<d,f=h|(1<<d)-1;h<=f;++h)a[xO[h]>>l]=c}else for(a=new Fd(r),i=0;i<r;++i)n[i]&&(a[i]=xO[o[n[i]-1]++]>>15-n[i]);return a}),Xg=new Ms(288);for(var sr=0;sr<144;++sr)Xg[sr]=8;for(var sr=144;sr<256;++sr)Xg[sr]=9;for(var sr=256;sr<280;++sr)Xg[sr]=7;for(var sr=280;sr<288;++sr)Xg[sr]=8;var nQ=new Ms(32);for(var sr=0;sr<32;++sr)nQ[sr]=5;var Tee=vp(Xg,9,1),Aee=vp(nQ,5,1),Qw=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Eo=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},$w=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Cee=function(n){return(n+7)/8|0},NS=function(n,e,t){return(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length),new Ms(n.subarray(e,t))},Eee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],eo=function(n,e,t){var r=new Error(e||Eee[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,eo),!t)throw r;return r},Pee=function(n,e,t,r){var i=n.length,s=r?r.length:0;if(!i||e.f&&!e.l)return t||new Ms(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new Ms(i*3));var c=function(se){var V=t.length;if(se>V){var ne=new Ms(Math.max(V*2,se));ne.set(t),t=ne}},d=e.f||0,h=e.p||0,f=e.b||0,p=e.l,g=e.d,m=e.m,v=e.n,y=i*8;do{if(!p){d=Eo(n,h,1);var O=Eo(n,h+1,3);if(h+=3,O)if(O==1)p=Tee,g=Aee,m=9,v=5;else if(O==2){var S=Eo(n,h,31)+257,E=Eo(n,h+10,15)+4,R=S+Eo(n,h+5,31)+1;h+=14;for(var C=new Ms(R),I=new Ms(19),D=0;D<E;++D)I[Oee[D]]=Eo(n,h+D*3,7);h+=E*3;for(var Q=Qw(I),M=(1<<Q)-1,N=vp(I,Q,1),D=0;D<R;){var B=N[Eo(n,h,M)];h+=B&15;var _=B>>4;if(_<16)C[D++]=_;else{var H=0,F=0;for(_==16?(F=3+Eo(n,h,3),h+=2,H=C[D-1]):_==17?(F=3+Eo(n,h,7),h+=3):_==18&&(F=11+Eo(n,h,127),h+=7);F--;)C[D++]=H}}var Z=C.subarray(0,S),$=C.subarray(S);m=Qw(Z),v=Qw($),p=vp(Z,m,1),g=vp($,v,1)}else eo(1);else{var _=Cee(h)+4,x=n[_-4]|n[_-3]<<8,k=_+x;if(k>i){l&&eo(0);break}a&&c(f+x),t.set(n.subarray(_,k),f),e.b=f+=x,e.p=h=k*8,e.f=d;continue}if(h>y){l&&eo(0);break}}a&&c(f+131072);for(var W=(1<<m)-1,G=(1<<v)-1,L=h;;L=h){var H=p[$w(n,h)&W],q=H>>4;if(h+=H&15,h>y){l&&eo(0);break}if(H||eo(2),q<256)t[f++]=q;else if(q==256){L=h,p=null;break}else{var ue=q-254;if(q>264){var D=q-257,oe=G5[D];ue=Eo(n,h,(1<<oe)-1)+tQ[D],h+=oe}var fe=g[$w(n,h)&G],be=fe>>4;fe||eo(3),h+=fe&15;var $=See[be];if(be>3){var oe=K5[be];$+=$w(n,h)&(1<<oe)-1,h+=oe}if(h>y){l&&eo(0);break}a&&c(f+131072);var De=f+ue;if(f<$){var Le=s-$,he=Math.min($,De);for(Le+f<0&&eo(3);f<he;++f)t[f]=r[Le+f]}for(;f<De;++f)t[f]=t[f-$]}}e.l=p,e.p=L,e.b=f,e.f=d,p&&(d=1,e.m=m,e.d=g,e.n=v)}while(!d);return f!=t.length&&o?NS(t,0,f):t.subarray(0,f)},Iee=new Ms(0),Oa=function(n,e){return n[e]|n[e+1]<<8},Lo=function(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0},Fw=function(n,e){return Lo(n,e)+Lo(n,e+4)*4294967296};function Mee(n,e){return Pee(n,{i:2},e&&e.out,e&&e.dictionary)}var kO=typeof TextDecoder<"u"&&new TextDecoder,Ree=0;try{kO.decode(Iee,{stream:!0}),Ree=1}catch{}var Dee=function(n){for(var e="",t=0;;){var r=n[t++],i=(r>127)+(r>223)+(r>239);if(t+i>n.length)return{s:e,r:NS(n,t-1)};i?i==3?(r=((r&15)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?e+=String.fromCharCode((r&31)<<6|n[t++]&63):e+=String.fromCharCode((r&15)<<12|(n[t++]&63)<<6|n[t++]&63):e+=String.fromCharCode(r)}};function Nee(n,e){if(e){for(var t="",r=0;r<n.length;r+=16384)t+=String.fromCharCode.apply(null,n.subarray(r,r+16384));return t}else{if(kO)return kO.decode(n);var i=Dee(n),s=i.s,t=i.r;return t.length&&eo(8),s}}var Lee=function(n,e){return e+30+Oa(n,e+26)+Oa(n,e+28)},Qee=function(n,e,t){var r=Oa(n,e+28),i=Nee(n.subarray(e+46,e+46+r),!(Oa(n,e+8)&2048)),s=e+46+r,o=Lo(n,e+20),a=t&&o==4294967295?$ee(n,s):[o,Lo(n,e+24),Lo(n,e+42)],l=a[0],c=a[1],d=a[2];return[Oa(n,e+10),l,c,i,s+Oa(n,e+30)+Oa(n,e+32),d]},$ee=function(n,e){for(;Oa(n,e)!=1;e+=4+Oa(n,e+2));return[Fw(n,e+12),Fw(n,e+4),Fw(n,e+20)]};function rQ(n,e){for(var t={},r=n.length-22;Lo(n,r)!=101010256;--r)(!r||n.length-r>65558)&&eo(13);var i=Oa(n,r+8);if(!i)return{};var s=Lo(n,r+16),o=s==4294967295||i==65535;if(o){var a=Lo(n,r-12);o=Lo(n,a)==101075792,o&&(i=Lo(n,a+32),s=Lo(n,a+48))}for(var l=0;l<i;++l){var c=Qee(n,s,o),d=c[0],h=c[1],f=c[2],p=c[3],g=c[4],m=c[5],v=Lee(n,m);s=g,d?d==8?t[p]=Mee(n.subarray(v,v+h),{out:new Ms(f)}):eo(14,"unknown compression type "+d):t[p]=NS(n,v,v+h)}return t}const gb=["png","jpg","jpeg","gif","webp"],mc=new Map;function Fee(n){const e=new Uint8Array(n);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}async function LS(n){const e=await crypto.subtle.digest("SHA-256",n);return Fee(e)}function iQ(n){return n.slice(0,8)}function ku(n){return n.toLowerCase().replace(/^\./,"")}function zee(n){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp"}[n]||"application/octet-stream"}async function Ec(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("images",{create:!0})}function mb(n,e){return`${n}.${e}`}function vb(n){const e=n.match(/^([a-f0-9]{8})\.(\w+)$/i);return e?{shortHash:e[1].toLowerCase(),extension:e[2].toLowerCase()}:null}async function sQ(n,e){const t=ku(e);if(!gb.includes(t))throw new Error(`Unsupported image extension: ${e}`);const r=await LS(n),i=iQ(r);if(await QS(i,t))return{shortHash:i,extension:t,fullHash:r};const s=await Ec(),o=mb(i,t),l=await(await s.getFileHandle(o,{create:!0})).createWritable();try{await l.write(n)}finally{await l.close()}return{shortHash:i,extension:t,fullHash:r}}async function Bee(n,e){const t=vb(e);if(!t){const c=e.split(".").pop()||"png";return sQ(n,c)}const{shortHash:r,extension:i}=t,s=await LS(n);if(await QS(r,i))return{shortHash:r,extension:i,fullHash:s};const l=await(await(await Ec()).getFileHandle(e,{create:!0})).createWritable();try{await l.write(n)}finally{await l.close()}return{shortHash:r,extension:i,fullHash:s}}async function oQ(n,e){try{const t=await Ec(),r=mb(n,ku(e));return await(await(await t.getFileHandle(r)).getFile()).arrayBuffer()}catch(t){if(t instanceof DOMException&&t.name==="NotFoundError")return null;throw t}}async function QS(n,e){try{const t=await Ec(),r=mb(n,ku(e));return await t.getFileHandle(r),!0}catch(t){if(t instanceof DOMException&&t.name==="NotFoundError")return!1;throw t}}async function Uee(n,e){try{const t=await Ec(),r=mb(n,ku(e)),i=`${n}.${e}`,s=mc.get(i);return s&&(URL.revokeObjectURL(s),mc.delete(i)),await t.removeEntry(r),!0}catch(t){if(t instanceof DOMException&&t.name==="NotFoundError")return!1;throw t}}async function jee(n,e){const t=`${n}.${ku(e)}`,r=mc.get(t);if(r)return r;const i=await oQ(n,e);if(!i)return null;const s=zee(ku(e)),o=new Blob([i],{type:s}),a=URL.createObjectURL(o);return mc.set(t,a),a}function Vee(n,e){const t=`${n}.${ku(e)}`,r=mc.get(t);r&&(URL.revokeObjectURL(r),mc.delete(t))}function aQ(){for(const n of mc.values())URL.revokeObjectURL(n);mc.clear()}async function qee(){const n=await Ec();let e=0,t=0;for await(const[r,i]of n.entries())if(i.kind==="file"){const s=vb(r);if(s&&gb.includes(s.extension)){e++;const a=await i.getFile();t+=a.size}}return{totalFiles:e,totalBytes:t}}async function Hee(){const n=await Ec(),e=[];for await(const[t,r]of n.entries())if(r.kind==="file"){const i=vb(t);if(i&&gb.includes(i.extension)){const o=await r.getFile();e.push({shortHash:i.shortHash,extension:i.extension,size:o.size})}}return e}async function Zee(){aQ();const n=await Ec();let e=0;const t=[];for await(const[r,i]of n.entries())if(i.kind==="file"){const s=vb(r);s&&gb.includes(s.extension)&&t.push(r)}for(const r of t)await n.removeEntry(r),e++;return e}const vc={store:sQ,storeWithFilename:Bee,retrieve:oQ,exists:QS,remove:Uee,getBlobUrl:jee,revokeBlobUrl:Vee,revokeAllBlobUrls:aQ,getStorageStats:qee,listImages:Hee,clearAll:Zee,computeHash:LS,getShortHash:iQ},Mi=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),SO=[.001,0,0,.001,0,0],zw=1.35,Os={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Wl={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Jp="pdfjs_internal_editor_",on={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},wn={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Wee={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},TO={TRIANGLES:1,LATTICE:2},ei={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Uv={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Pr={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Td={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},yb={ERRORS:0,WARNINGS:1,INFOS:5},eg={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},_f={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},Xee={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let bb=yb.WARNINGS;function Yee(n){Number.isInteger(n)&&(bb=n)}function Gee(){return bb}function wb(n){bb>=yb.INFOS&&console.info(`Info: ${n}`)}function rn(n){bb>=yb.WARNINGS&&console.warn(`Warning: ${n}`)}function Jn(n){throw new Error(n)}function _n(n,e){n||Jn(e)}function Kee(n){switch(n?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function lQ(n,e=null,t=null){if(!n)return null;if(t&&typeof n=="string"&&(t.addDefaultProtocol&&n.startsWith("www.")&&n.match(/\./g)?.length>=2&&(n=`http://${n}`),t.tryConvertEncoding))try{n=rte(n)}catch{}const r=e?URL.parse(n,e):URL.parse(n);return Kee(r)?r:null}function cQ(n,e,t=!1){const r=URL.parse(n);return r?(r.hash=e,r.href):t&&lQ(n,"http://example.com")?n.split("#",1)[0]+`${e?`#${e}`:""}`:""}function an(n,e,t,r=!1){return Object.defineProperty(n,e,{value:t,enumerable:!r,configurable:!0,writable:!1}),t}const Zu=(function(){function e(t,r){this.message=t,this.name=r}return e.prototype=new Error,e.constructor=e,e})();class XC extends Zu{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Bw extends Zu{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class AO extends Zu{constructor(e){super(e,"InvalidPDFException")}}class Ny extends Zu{constructor(e,t,r){super(e,"ResponseException"),this.status=t,this.missing=r}}class Jee extends Zu{constructor(e){super(e,"FormatError")}}class yc extends Zu{constructor(e){super(e,"AbortException")}}function uQ(n){(typeof n!="object"||n?.length===void 0)&&Jn("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const r=[];for(let i=0;i<e;i+=t){const s=Math.min(i+t,e),o=n.subarray(i,s);r.push(String.fromCharCode.apply(null,o))}return r.join("")}function Yg(n){typeof n!="string"&&Jn("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let r=0;r<e;++r)t[r]=n.charCodeAt(r)&255;return t}function ete(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function tte(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function nte(){try{return new Function(""),!0}catch{return!1}}class hi{static get isLittleEndian(){return an(this,"isLittleEndian",tte())}static get isEvalSupported(){return an(this,"isEvalSupported",nte())}static get isOffscreenCanvasSupported(){return an(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return an(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return an(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return an(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return an(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return an(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Uw=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));class Dt{static makeHexColor(e,t,r){return`#${Uw[e]}${Uw[t]}${Uw[r]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let r;e[0]?(e[0]<0&&(r=t[0],t[0]=t[2],t[2]=r),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(r=t[1],t[1]=t[3],t[3]=r),t[1]*=e[3],t[3]*=e[3]):(r=t[0],t[0]=t[1],t[1]=r,r=t[2],t[2]=t[3],t[3]=r,e[1]<0&&(r=t[1],t[1]=t[3],t[3]=r),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(r=t[0],t[0]=t[2],t[2]=r),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,r=0){const i=e[r],s=e[r+1];e[r]=i*t[0]+s*t[2]+t[4],e[r+1]=i*t[1]+s*t[3]+t[5]}static applyTransformToBezier(e,t,r=0){const i=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let d=0;d<6;d+=2){const h=e[r+d],f=e[r+d+1];e[r+d]=h*i+f*o+l,e[r+d+1]=h*s+f*a+c}}static applyInverseTransform(e,t){const r=e[0],i=e[1],s=t[0]*t[3]-t[1]*t[2];e[0]=(r*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/s,e[1]=(-r*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/s}static axialAlignedBoundingBox(e,t,r){const i=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5],d=e[0],h=e[1],f=e[2],p=e[3];let g=i*d+l,m=g,v=i*f+l,y=v,O=a*h+c,_=O,x=a*p+c,k=x;if(s!==0||o!==0){const S=s*d,E=s*f,R=o*h,C=o*p;g+=R,y+=R,v+=C,m+=C,O+=S,k+=S,x+=E,_+=E}r[0]=Math.min(r[0],g,v,m,y),r[1]=Math.min(r[1],O,x,_,k),r[2]=Math.max(r[2],g,v,m,y),r[3]=Math.max(r[3],O,x,_,k)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const r=e[0],i=e[1],s=e[2],o=e[3],a=r**2+i**2,l=r*s+i*o,c=s**2+o**2,d=(a+c)/2,h=Math.sqrt(d**2-(a*c-l**2));t[0]=Math.sqrt(d+h||1),t[1]=Math.sqrt(d-h||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const r=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(r>i)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>o?null:[r,s,i,o]}static pointBoundingBox(e,t,r){r[0]=Math.min(r[0],e),r[1]=Math.min(r[1],t),r[2]=Math.max(r[2],e),r[3]=Math.max(r[3],t)}static rectBoundingBox(e,t,r,i,s){s[0]=Math.min(s[0],e,r),s[1]=Math.min(s[1],t,i),s[2]=Math.max(s[2],e,r),s[3]=Math.max(s[3],t,i)}static#e(e,t,r,i,s,o,a,l,c,d){if(c<=0||c>=1)return;const h=1-c,f=c*c,p=f*c,g=h*(h*(h*e+3*c*t)+3*f*r)+p*i,m=h*(h*(h*s+3*c*o)+3*f*a)+p*l;d[0]=Math.min(d[0],g),d[1]=Math.min(d[1],m),d[2]=Math.max(d[2],g),d[3]=Math.max(d[3],m)}static#t(e,t,r,i,s,o,a,l,c,d,h,f){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&this.#e(e,t,r,i,s,o,a,l,-h/d,f);return}const p=d**2-4*h*c;if(p<0)return;const g=Math.sqrt(p),m=2*c;this.#e(e,t,r,i,s,o,a,l,(-d+g)/m,f),this.#e(e,t,r,i,s,o,a,l,(-d-g)/m,f)}static bezierBoundingBox(e,t,r,i,s,o,a,l,c){c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l),this.#t(e,r,s,a,t,i,o,l,3*(-e+3*(r-s)+a),6*(e-2*r+s),3*(r-e),c),this.#t(e,r,s,a,t,i,o,l,3*(-t+3*(i-o)+l),6*(t-2*i+o),3*(i-t),c)}}function rte(n){return decodeURIComponent(escape(n))}let jw=null,YC=null;function ite(n){return jw||(jw=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,YC=new Map([["ï¬","Å¿t"]])),n.replaceAll(jw,(e,t,r)=>t?t.normalize("NFKC"):YC.get(r))}function dQ(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),uQ(n)}const zd="pdfjs_internal_id_";function ste(n,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[r,i,...s]=t;if(!n(r)&&!Number.isInteger(r)||!e(i))return!1;const o=s.length;let a=!0;switch(i.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;a=!1;break;default:return!1}for(const l of s)if(!(typeof l=="number"||a&&l===null))return!1;return!0}function Ri(n,e,t){return Math.min(Math.max(n,e),t)}function hQ(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(uQ(n))}function ote(n){return Uint8Array.fromBase64?Uint8Array.fromBase64(n):Yg(atob(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(n){return n.reduce((e,t)=>e+t,0)});class tg{static textContent(e){const t=[],r={items:t,styles:Object.create(null)};function i(s){if(!s)return;let o=null;const a=s.name;if(a==="#text")o=s.value;else if(tg.shouldBuildText(a))s?.attributes?.textContent?o=s.attributes.textContent:s.value&&(o=s.value);else return;if(o!==null&&t.push({str:o}),!!s.children)for(const l of s.children)i(l)}return i(e),r}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class fQ{static setupStorage(e,t,r,i,s){const o=i.getValue(t,{value:null});switch(r.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),s==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})});break;case"input":if(r.attributes.type==="radio"||r.attributes.type==="checkbox"){if(o.value===r.attributes.xfaOn?e.setAttribute("checked",!0):o.value===r.attributes.xfaOff&&e.removeAttribute("checked"),s==="print")break;e.addEventListener("change",a=>{i.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),s==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const a of r.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{const l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:r=null,intent:i,linkService:s}){const{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[l,c]of Object.entries(o))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&s.addLinkAttributes(e,o.href,o.newWindow),r&&o.dataId&&this.setupStorage(e,o.dataId,t,r)}static render(e){const t=e.annotationStorage,r=e.linkService,i=e.xfaHtml,s=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:s,linkService:r});const a=s!=="richText",l=e.div;if(l.append(o),e.viewport){const h=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=h}a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(i.children.length===0){if(i.value){const h=document.createTextNode(i.value);o.append(h),a&&tg.shouldBuildText(i.name)&&c.push(h)}return{textDivs:c}}const d=[[i,-1,o]];for(;d.length>0;){const[h,f,p]=d.at(-1);if(f+1===h.children.length){d.pop();continue}const g=h.children[++d.at(-1)[1]];if(g===null)continue;const{name:m}=g;if(m==="#text"){const y=document.createTextNode(g.value);c.push(y),p.append(y);continue}const v=g?.attributes?.xmlns?document.createElementNS(g.attributes.xmlns,m):document.createElement(m);if(p.append(v),g.attributes&&this.setAttributes({html:v,element:g,storage:t,intent:s,linkService:r}),g.children?.length>0)d.push([g,-1,v]);else if(g.value){const y=document.createTextNode(g.value);a&&tg.shouldBuildText(m)&&c.push(y),v.append(y)}}for(const h of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const tl="http://www.w3.org/2000/svg";class Eh{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Gg(n,e="text"){if(tp(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,r)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}r(new Error(i.statusText))}},i.send(null)})}class Kg{constructor({viewBox:e,userUnit:t,scale:r,rotation:i,offsetX:s=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=r,this.rotation=i,this.offsetX=s,this.offsetY=o,r*=t;const l=(e[2]+e[0])/2,c=(e[3]+e[1])/2;let d,h,f,p;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,h=0,f=0,p=1;break;case 90:d=0,h=1,f=1,p=0;break;case 270:d=0,h=-1,f=-1,p=0;break;case 0:d=1,h=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(f=-f,p=-p);let g,m,v,y;d===0?(g=Math.abs(c-e[1])*r+s,m=Math.abs(l-e[0])*r+o,v=(e[3]-e[1])*r,y=(e[2]-e[0])*r):(g=Math.abs(l-e[0])*r+s,m=Math.abs(c-e[1])*r+o,v=(e[2]-e[0])*r,y=(e[3]-e[1])*r),this.transform=[d*r,h*r,f*r,p*r,g-d*r*l-f*r*c,m-h*r*l-p*r*c],this.width=v,this.height=y}get rawDims(){const e=this.viewBox;return an(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:r=this.offsetX,offsetY:i=this.offsetY,dontFlip:s=!1}={}){return new Kg({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:r,offsetY:i,dontFlip:s})}convertToViewportPoint(e,t){const r=[e,t];return Dt.applyTransform(r,this.transform),r}convertToViewportRectangle(e){const t=[e[0],e[1]];Dt.applyTransform(t,this.transform);const r=[e[2],e[3]];return Dt.applyTransform(r,this.transform),[t[0],t[1],r[0],r[1]]}convertToPdfPoint(e,t){const r=[e,t];return Dt.applyInverseTransform(r,this.transform),r}}class $S extends Zu{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function _b(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function FS(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function ate(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function lte(n,e="document.pdf"){if(typeof n!="string")return e;if(_b(n))return rn('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const r=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(n);if(!r)return e;const i=a=>{try{let l=decodeURIComponent(a);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:a):l}catch{return a}},s=/\.pdf$/i,o=r.pathname.split("/").at(-1);if(s.test(o))return i(o);if(r.searchParams.size>0){const a=Array.from(r.searchParams.values()).reverse();for(const c of a)if(s.test(c))return i(c);const l=Array.from(r.searchParams.keys()).reverse();for(const c of l)if(s.test(c))return i(c)}if(r.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(r.hash);if(l)return i(l[0])}return e}class GC{started=Object.create(null);times=[];time(e){e in this.started&&rn(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||rn(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:r}of this.times)t=Math.max(r.length,t);for(const{name:r,start:i,end:s}of this.times)e.push(`${r.padEnd(t)} ${s-i}ms
`);return e.join("")}}function tp(n,e){const t=e?URL.parse(n,e):URL.parse(n);return t?.protocol==="http:"||t?.protocol==="https:"}function bo(n){n.preventDefault()}function br(n){n.preventDefault(),n.stopPropagation()}function cte(n){console.log("Deprecated API usage: "+n)}class CO{static#e;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const r=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const c=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(o+=d,a+=h):c==="+"&&(o-=d,a-=h),new Date(Date.UTC(r,i,s,o,a,l))}}function ute(n,{scale:e=1,rotation:t=0}){const{width:r,height:i}=n.attributes.style,s=[0,0,parseInt(r),parseInt(i)];return new Kg({viewBox:s,userUnit:1,scale:e,rotation:t})}function Jg(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(rn(`Not a valid color format: "${n}"`),[0,0,0])}function dte(n){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of n.keys()){e.style.color=t;const r=window.getComputedStyle(e).color;n.set(t,Jg(r))}e.remove()}function fr(n){const{a:e,b:t,c:r,d:i,e:s,f:o}=n.getTransform();return[e,t,r,i,s,o]}function sa(n){const{a:e,b:t,c:r,d:i,e:s,f:o}=n.getTransform().invertSelf();return[e,t,r,i,s,o]}function Su(n,e,t=!1,r=!0){if(e instanceof Kg){const{pageWidth:i,pageHeight:s}=e.rawDims,{style:o}=n,a=hi.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,c=`var(--total-scale-factor) * ${s}px`,d=a?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,h=a?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!t||e.rotation%180===0?(o.width=d,o.height=h):(o.width=h,o.height=d)}r&&n.setAttribute("data-main-rotation",e.rotation)}class za{constructor(){const{pixelRatio:e}=za;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,r,i,s=-1){let o=1/0,a=1/0,l=1/0;r=za.capPixels(r,s),r>0&&(o=Math.sqrt(r/(e*t))),i!==-1&&(a=i/e,l=i/t);const c=Math.min(o,a,l);return this.sx>c||this.sy>c?(this.sx=c,this.sy=c,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const r=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,r):r}return e}}const EO=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class hte{static get isDarkMode(){return an(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class fte{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:r}=window.getComputedStyle(e);return e.remove(),an(this,"commentForegroundColor",Jg(r))}}function pte(n,e,t,r){r=Math.min(Math.max(r??1,0),1);const i=255*(1-r);return n=Math.round(n*r+i),e=Math.round(e*r+i),t=Math.round(t*r+i),[n,e,t]}function KC(n,e){const t=n[0]/255,r=n[1]/255,i=n[2]/255,s=Math.max(t,r,i),o=Math.min(t,r,i),a=(s+o)/2;if(s===o)e[0]=e[1]=0;else{const l=s-o;switch(e[1]=a<.5?l/(s+o):l/(2-s-o),s){case t:e[0]=((r-i)/l+(r<i?6:0))*60;break;case r:e[0]=((i-t)/l+2)*60;break;case i:e[0]=((t-r)/l+4)*60;break}}e[2]=a}function PO(n,e){const t=n[0],r=n[1],i=n[2],s=(1-Math.abs(2*i-1))*r,o=s*(1-Math.abs(t/60%2-1)),a=i-s/2;switch(Math.floor(t/60)){case 0:e[0]=s+a,e[1]=o+a,e[2]=a;break;case 1:e[0]=o+a,e[1]=s+a,e[2]=a;break;case 2:e[0]=a,e[1]=s+a,e[2]=o+a;break;case 3:e[0]=a,e[1]=o+a,e[2]=s+a;break;case 4:e[0]=o+a,e[1]=a,e[2]=s+a;break;case 5:case 6:e[0]=s+a,e[1]=a,e[2]=o+a;break}}function JC(n){return n<=.03928?n/12.92:((n+.055)/1.055)**2.4}function eE(n,e,t){PO(n,t),t.map(JC);const r=.2126*t[0]+.7152*t[1]+.0722*t[2];PO(e,t),t.map(JC);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];return r>i?(r+.05)/(i+.05):(i+.05)/(r+.05)}const tE=new Map;function gte(n,e){const t=n[0]+n[1]*256+n[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let r=tE.get(t);if(r)return r;const i=new Float32Array(9),s=i.subarray(0,3),o=i.subarray(3,6);KC(n,o);const a=i.subarray(6,9);KC(e,a);const l=a[2]<.5,c=l?12:4.5;if(o[2]=l?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),eE(o,a,s)<c){let d,h;l?(d=o[2],h=1):(d=0,h=o[2]);const f=.005;for(;h-d>f;){const p=o[2]=(d+h)/2;l===eE(o,a,s)<c?d=p:h=p}o[2]=l?h:d}return PO(o,s),r=Dt.makeHexColor(Math.round(s[0]*255),Math.round(s[1]*255),Math.round(s[2]*255)),tE.set(t,r),r}function pQ({html:n,dir:e,className:t},r){const i=document.createDocumentFragment();if(typeof n=="string"){const s=document.createElement("p");s.dir=e||"auto";const o=n.split(/(?:\r\n?|\n)/);for(let a=0,l=o.length;a<l;++a){const c=o[a];s.append(document.createTextNode(c)),a<l-1&&s.append(document.createElement("br"))}i.append(s)}else fQ.render({xfaHtml:n,div:i,intent:"richText"});i.firstChild.classList.add("richText",t),r.append(i)}function gQ(n){const e=new Path2D;if(!n)return e;for(let t=0,r=n.length;t<r;)switch(n[t++]){case _f.moveTo:e.moveTo(n[t++],n[t++]);break;case _f.lineTo:e.lineTo(n[t++],n[t++]);break;case _f.curveTo:e.bezierCurveTo(n[t++],n[t++],n[t++],n[t++],n[t++],n[t++]);break;case _f.quadraticCurveTo:e.quadraticCurveTo(n[t++],n[t++],n[t++],n[t++]);break;case _f.closePath:e.closePath();break;default:rn(`Unrecognized drawing path operator: ${n[t-1]}`);break}return e}class yp{#e=null;#t=null;#r;#n=null;#s=null;#i=null;#o=null;#a=null;static#l=null;constructor(e){this.#r=e,yp.#l||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#r._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",bo,{signal:t}),e.addEventListener("pointerdown",yp.#c,{signal:t}));const r=this.#n=document.createElement("div");r.className="buttons",e.append(r);const i=this.#r.toolbarPosition;if(i){const{style:s}=e,o=this.#r._uiManager.direction==="ltr"?1-i[0]:i[0];s.insetInlineEnd=`${100*o}%`,s.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#c(e){e.stopPropagation()}#h(e){this.#r._focusEventsAllowed=!1,br(e)}#u(e){this.#r._focusEventsAllowed=!0,br(e)}#p(e){const t=this.#r._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#u.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",bo,{signal:t}),!0)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#s?.shown(),this.#i?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#r,r=document.createElement("button");r.classList.add("basic","deleteButton"),r.tabIndex=0,r.setAttribute("data-l10n-id",yp.#l[e]),this.#p(r)&&r.addEventListener("click",i=>{t.delete()},{signal:t._signal}),this.#n.append(r)}get#m(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#p(t),this.#n.append(t,this.#m),this.#s=e}addComment(e,t=null){if(this.#i)return;const r=e.renderForToolbar();if(!r)return;this.#p(r);const i=this.#o=this.#m;t?(this.#n.insertBefore(r,t),this.#n.insertBefore(i,t)):this.#n.append(r,i),this.#i=e,e.toolbar=this}addColorPicker(e){if(this.#t)return;this.#t=e;const t=e.renderButton();this.#p(t),this.#n.append(t,this.#m)}async addEditSignatureButton(e){const t=this.#a=await e.renderEditButton(this.#r);this.#p(t),this.#n.append(t,this.#m)}removeButton(e){switch(e){case"comment":this.#i?.removeToolbarCommentButton(),this.#i=null,this.#o?.remove(),this.#o=null;break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,r){if(!t&&e==="comment")return;const i=this.#n.querySelector(r);i&&e==="comment"&&this.addComment(t,i)}updateEditSignatureButton(e){this.#a&&(this.#a.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class mte{#e=null;#t=null;#r;constructor(e){this.#r=e}#n(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#r._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",bo,{signal:t});const r=this.#e=document.createElement("div");return r.className="buttons",e.append(r),this.#r.hasCommentManager()&&this.#i("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#r.commentSelection("floating_button")}),this.#i("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#r.highlightSelection("floating_button")}),e}#s(e,t){let r=0,i=0;for(const s of e){const o=s.y+s.height;if(o<r)continue;const a=s.x+(t?s.width:0);if(o>r){i=a,r=o;continue}t?a>i&&(i=a):a<i&&(i=a)}return[t?1-i:i,r]}show(e,t,r){const[i,s]=this.#s(t,r),{style:o}=this.#t||=this.#n();e.append(this.#t),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#i(e,t,r,i){const s=document.createElement("button");s.classList.add("basic",e),s.tabIndex=0,s.setAttribute("data-l10n-id",t);const o=document.createElement("span");s.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",r);const a=this.#r._signal;a instanceof AbortSignal&&!a.aborted&&(s.addEventListener("contextmenu",bo,{signal:a}),s.addEventListener("click",i,{signal:a})),this.#e.append(s)}}function mQ(n,e,t){for(const r of t)e.addEventListener(r,n[r].bind(n))}class Qn{static#e=NaN;static#t=null;static#r=NaN;static#n=null;static initializeAndAddPointerId(e){(Qn.#t||=new Set).add(e)}static setPointer(e,t){Qn.#e||=t,Qn.#n??=e}static setTimeStamp(e){Qn.#r=e}static isSamePointerId(e){return Qn.#e===e}static isSamePointerIdOrRemove(e){return Qn.#e===e?!0:(Qn.#t?.delete(e),!1)}static isSamePointerType(e){return Qn.#n===e}static isInitializedAndDifferentPointerType(e){return Qn.#n!==null&&!Qn.isSamePointerType(e)}static isSameTimeStamp(e){return Qn.#r===e}static isUsingMultiplePointers(){return Qn.#t?.size>=1}static clearPointerType(){Qn.#n=null}static clearPointerIds(){Qn.#e=NaN,Qn.#t=null}static clearTimeStamp(){Qn.#r=NaN}}class vte{#e=0;get id(){return`${Jp}${this.#e++}`}}class zS{#e=dQ();#t=0;#r=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',r=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const s=i.decode().then(()=>(r.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(r.getImageData(0,0,1,1).data.buffer)[0]===0));return an(this,"_isSVGFittingCanvas",s)}async#n(e,t){this.#r||=new Map;let r=this.#r.get(e);if(r===null)return null;if(r?.bitmap)return r.refCounter+=1,r;try{r||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let i;if(typeof t=="string"?(r.url=t,i=await Gg(t,"blob")):t instanceof File?i=r.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const s=zS._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{r.bitmap=a,r.isSvg=!0,c()},o.onload=async()=>{const h=r.svgUrl=o.result;a.src=await s?`${h}#svgView(preserveAspectRatio(none))`:h},a.onerror=o.onerror=d});o.readAsDataURL(i),await l}else r.bitmap=await createImageBitmap(i);r.refCounter=1}catch(i){rn(i),r=null}return this.#r.set(e,r),r&&this.#r.set(r.id,r),r}async getFromFile(e){const{lastModified:t,name:r,size:i,type:s}=e;return this.#n(`${t}_${r}_${i}_${s}`,e)}async getFromUrl(e){return this.#n(e,e)}async getFromBlob(e,t){const r=await t;return this.#n(e,r)}async getFromId(e){this.#r||=new Map;const t=this.#r.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:r}=t;return delete t.blobPromise,this.getFromBlob(t.id,r)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#r||=new Map;let r=this.#r.get(e);if(r?.bitmap)return r.refCounter+=1,r;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),r={bitmap:i.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#r.set(e,r),this.#r.set(r.id,r),r}getSvgUrl(e){const t=this.#r.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#r||=new Map;const t=this.#r.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:r}=t;if(!t.url&&!t.file){const i=new OffscreenCanvas(r.width,r.height);i.getContext("bitmaprenderer").transferFromImageBitmap(r),t.blobPromise=i.convertToBlob()}r.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class yte{#e=[];#t=!1;#r;#n=-1;constructor(e=128){this.#r=e}add({cmd:e,undo:t,post:r,mustExec:i,type:s=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(i&&e(),this.#t)return;const l={cmd:e,undo:t,post:r,type:s};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(l);return}if(o&&this.#e[this.#n].type===s){a&&(l.undo=this.#e[this.#n].undo),this.#e[this.#n]=l;return}const c=this.#n+1;c===this.#r?this.#e.splice(0,1):(this.#n=c,c<this.#e.length&&this.#e.splice(c)),this.#e.push(l)}undo(){if(this.#n===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1,this.#n-=1}redo(){if(this.#n<this.#e.length-1){this.#n+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}cleanType(e){if(this.#n!==-1){for(let t=this.#n;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#n-t),this.#n=t;return}this.#e.length=0,this.#n=-1}}destroy(){this.#e=null}}class em{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=hi.platform;for(const[r,i,s={}]of e)for(const o of r){const a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:i,options:s}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:i,options:s}),this.allKeys.add(o.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const r=this.callbacks.get(this.#e(t));if(!r)return;const{callback:i,options:{bubbles:s=!1,args:o=[],checker:a=null}}=r;a&&!a(e,t)||(i.bind(e,...o,t)(),s||br(t))}}class BS{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return dte(e),an(this,"_colors",e)}convert(e){const t=Jg(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[r,i]of this._colors)if(i.every((s,o)=>s===t[o]))return BS._colorsMapping.get(r);return t}getHexCode(e){const t=this._colors.get(e);return t?Dt.makeHexColor(...t):e}}class bc{#e=new AbortController;#t=null;#r=null;#n=new Map;#s=new Map;#i=null;#o=null;#a=null;#l=new yte;#c=null;#h=null;#u=null;#p=0;#m=new Set;#f=null;#d=null;#g=new Set;_editorUndoBar=null;#y=!1;#b=!1;#v=!1;#k=null;#x=null;#_=null;#A=null;#w=!1;#S=null;#P=new vte;#C=!1;#E=!1;#Q=!1;#M=null;#D=null;#$=null;#N=null;#V=null;#T=on.NONE;#O=new Set;#R=null;#F=null;#B=null;#Z=null;#H=null;#W={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#U=[0,0];#L=null;#q=null;#K=null;#J=null;#z=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=bc.prototype,t=o=>o.#q.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),r=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return an(this,"_keyboardManager",new em([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:r}],[["ctrl+z","mac+meta+z"],e.undo,{checker:r}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:r}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:r}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&o.#q.contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&o.#q.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}constructor(e,t,r,i,s,o,a,l,c,d,h,f,p,g,m,v){const y=this._signal=this.#e.signal;this.#q=e,this.#K=t,this.#J=r,this.#i=i,this.#c=s,this.#F=o,this.#H=l,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:y}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),a._on("setpreference",this.onSetPreference.bind(this),{signal:y}),a._on("switchannotationeditorparams",O=>this.updateParams(O.type,O.value),{signal:y}),window.addEventListener("pointerdown",()=>{this.#E=!0},{capture:!0,signal:y}),window.addEventListener("pointerup",()=>{this.#E=!1},{capture:!0,signal:y}),this.#oe(),this.#he(),this.#te(),this.#o=l.annotationStorage,this.#k=l.filterFactory,this.#B=c,this.#A=d||null,this.#y=h,this.#b=f,this.#v=p,this.#V=g||null,this.viewParameters={realScale:Eh.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null,this._supportsPinchToZoom=v!==!1,s?.setSidebarUiManager(this)}destroy(){this.#z?.resolve(),this.#z=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#s.values())e.destroy();this.#s.clear(),this.#n.clear(),this.#g.clear(),this.#N?.clear(),this.#t=null,this.#O.clear(),this.#l.destroy(),this.#i?.destroy(),this.#c?.destroy(),this.#F?.destroy(),this.#S?.hide(),this.#S=null,this.#$?.destroy(),this.#$=null,this.#r=null,this.#x&&(clearTimeout(this.#x),this.#x=null),this.#L&&(clearTimeout(this.#L),this.#L=null),this._editorUndoBar?.destroy(),this.#H=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#V}get useNewAltTextFlow(){return this.#b}get useNewAltTextWhenAddingImage(){return this.#v}get hcmFilter(){return an(this,"hcmFilter",this.#B?this.#k.addHCMFilter(this.#B.foreground,this.#B.background):"none")}get direction(){return an(this,"direction",getComputedStyle(this.#q).direction)}get _highlightColors(){return an(this,"_highlightColors",this.#A?new Map(this.#A.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return an(this,"highlightColors",null);const t=new Map,r=!!this.#B;for(const[i,s]of e){const o=i.endsWith("_HCM");if(r&&o){t.set(i.replace("_HCM",""),s);continue}!r&&!o&&t.set(i,s)}return an(this,"highlightColors",t)}get highlightColorNames(){return an(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#u=e}setMainHighlightColorPicker(e){this.#$=e}editAltText(e,t=!1){this.#i?.editAltText(this,e,t)}hasCommentManager(){return!!this.#c}editComment(e,t,r,i){this.#c?.showDialog(this,e,t,r,i)}selectComment(e,t){this.#s.get(e)?.getEditorByUID(t)?.toggleComment(!0,!0)}updateComment(e){this.#c?.updateComment(e.getData())}updatePopupColor(e){this.#c?.updatePopupColor(e)}removeComment(e){this.#c?.removeComments([e.uid])}toggleComment(e,t,r=void 0){this.#c?.toggleCommentPopup(e,t,r)}makeCommentColor(e,t){return e&&this.#c?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#c?.dialogElement||null}async waitForEditorsRendered(e){if(this.#s.has(e-1))return;const{resolve:t,promise:r}=Promise.withResolvers(),i=s=>{s.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await r}getSignature(e){this.#F?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#F}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":this.#v=t;break}}onPageChanging({pageNumber:e}){this.#p=e-1}focusMainContainer(){this.#q.focus()}findParent(e,t){for(const r of this.#s.values()){const{x:i,y:s,width:o,height:a}=r.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=s&&t<=s+a)return r}return null}disableUserSelect(e=!1){this.#K.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#g.add(e)}removeShouldRescale(e){this.#g.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Eh.PDF_TO_CSS_UNITS;for(const t of this.#g)t.onScaleChanging();this.#u?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#G({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#ee(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const r of this.#s.values())if(r.hasTextLayer(e))return r;return null}highlightSelection(e="",t=!1){const r=document.getSelection();if(!r||r.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:o,focusOffset:a}=r,l=r.toString(),d=this.#G(r).closest(".textLayer"),h=this.getSelectionBoxes(d);if(!h)return;r.empty();const f=this.#ee(d),p=this.#T===on.NONE,g=()=>{const m=f?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:h,anchorNode:i,anchorOffset:s,focusNode:o,focusOffset:a,text:l});p&&this.showAllEditors("highlight",!0,!0),t&&m?.editComment()};if(p){this.switchToMode(on.HIGHLIGHT,g);return}g()}commentSelection(e=""){this.highlightSelection(e,!0)}#ie(){const e=document.getSelection();if(!e||e.isCollapsed)return;const r=this.#G(e).closest(".textLayer"),i=this.getSelectionBoxes(r);i&&(this.#S||=new mte(this),this.#S.show(r,i,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#o)return null;const t=`${Jp}${e}`,r=this.#o.getRawValue(t);return r&&this.#o.remove(t),r}addToAnnotationStorage(e){!e.isEmpty()&&this.#o&&!this.#o.has(e.id)&&this.#o.setValue(e.id,e)}a11yAlert(e,t=null){const r=this.#J;r&&(r.setAttribute("data-l10n-id",e),t?r.setAttribute("data-l10n-args",JSON.stringify(t)):r.removeAttribute("data-l10n-args"))}#se(){const e=document.getSelection();if(!e||e.isCollapsed){this.#R&&(this.#S?.hide(),this.#R=null,this.#I({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#R)return;const i=this.#G(e).closest(".textLayer");if(!i){this.#R&&(this.#S?.hide(),this.#R=null,this.#I({hasSelectedText:!1}));return}if(this.#S?.hide(),this.#R=t,this.#I({hasSelectedText:!0}),!(this.#T!==on.HIGHLIGHT&&this.#T!==on.NONE)&&(this.#T===on.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#w=this.isShiftKeyDown,!this.isShiftKeyDown)){const s=this.#T===on.HIGHLIGHT?this.#ee(i):null;if(s?.toggleDrawing(),this.#E){const o=new AbortController,a=this.combinedSignal(o),l=c=>{c.type==="pointerup"&&c.button!==0||(o.abort(),s?.toggleDrawing(!0),c.type==="pointerup"&&this.#X("main_toolbar"))};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}else s?.toggleDrawing(!0),this.#X("main_toolbar")}}#X(e=""){this.#T===on.HIGHLIGHT?this.highlightSelection(e):this.#y&&this.#ie()}#oe(){document.addEventListener("selectionchange",this.#se.bind(this),{signal:this._signal})}#ae(){if(this.#_)return;this.#_=new AbortController;const e=this.combinedSignal(this.#_);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#le(){this.#_?.abort(),this.#_=null}blur(){if(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#X("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#O)if(t.div.contains(e)){this.#D=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#D)return;const[e,t]=this.#D;this.#D=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#te(){if(this.#M)return;this.#M=new AbortController;const e=this.combinedSignal(this.#M);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#ce(){this.#M?.abort(),this.#M=null}#ue(){if(this.#h)return;this.#h=new AbortController;const e=this.combinedSignal(this.#h);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#de(){this.#h?.abort(),this.#h=null}#he(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#te(),this.setEditingState(!0)}removeEditListeners(){this.#ce(),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const r of this.#d)if(r.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const r of this.#d)if(r.isHandlingMimeForPasting(t.type)){r.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of this.#O){const i=r.serialize(!0);i&&t.push(i)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const s of t.items)for(const o of this.#d)if(o.isHandlingMimeForPasting(s.type)){o.paste(s,this.currentLayer);return}let r=t.getData("application/pdfjs");if(!r)return;try{r=JSON.parse(r)}catch(s){rn(`paste: "${s.message}".`);return}if(!Array.isArray(r))return;this.unselectAll();const i=this.currentLayer;try{const s=[];for(const l of r){const c=await i.deserialize(l);if(!c)return;s.push(c)}const o=()=>{for(const l of s)this.#ne(l);this.#re(s)},a=()=>{for(const l of s)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(s){rn(`paste: "${s.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#T!==on.NONE&&!this.isEditorHandlingKeyboard&&bc._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#X("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#I(e){Object.entries(e).some(([r,i])=>this.#W[r]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#W,e)}),this.#T===on.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#j([[wn.HIGHLIGHT_FREE,!0]]))}#j(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#ae(),this.#ue(),this.#I({isEditing:this.#T!==on.NONE,isEmpty:this.#Y(),hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:this.#l.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#le(),this.#de(),this.#I({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#d){this.#d=e;for(const t of this.#d)this.#j(t.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#s.get(this.#p)}getLayer(e){return this.#s.get(e)}get currentPageIndex(){return this.#p}addLayer(e){this.#s.set(e.pageIndex,e),this.#C?e.enable():e.disable()}removeLayer(e){this.#s.delete(e.pageIndex)}async updateMode(e,t=null,r=!1,i=!1,s=!1){if(this.#T!==e&&!(this.#z&&(await this.#z.promise,!this.#z))){if(this.#z=Promise.withResolvers(),this.#u?.commitOrRemove(),this.#T===on.POPUP&&this.#c?.hideSidebar(),this.#c?.destroyPopup(),this.#T=e,e===on.NONE){this.setEditingState(!1),this.#pe();for(const o of this.#n.values())o.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#z.resolve();return}for(const o of this.#n.values())o.addStandaloneCommentButton();e===on.SIGNATURE&&await this.#F?.loadSignatures(),this.setEditingState(!0),await this.#fe(),this.unselectAll();for(const o of this.#s.values())o.updateMode(e);if(e===on.POPUP){this.#r||=await this.#H.getAnnotationsByType(new Set(this.#d.map(l=>l._editorType)));const o=new Set,a=[];for(const l of this.#n.values()){const{annotationElementId:c,hasComment:d,deleted:h}=l;c&&o.add(c),d&&!h&&a.push(l.getData())}for(const l of this.#r){const{id:c,popupRef:d,contentsObj:h}=l;d&&h?.str&&!o.has(c)&&!this.#m.has(c)&&a.push(l)}this.#c?.showSidebar(a)}if(!t){r&&this.addNewEditorFromKeyboard(),this.#z.resolve();return}for(const o of this.#n.values())o.uid===t?(this.setSelected(o),s?o.editComment():i?o.enterInEditMode():o.focus()):o.unselect();this.#z.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#T&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#d){switch(e){case wn.CREATE:this.currentLayer.addNewEditor(t);return;case wn.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#Z||=new Map).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const r of this.#O)r.updateParams(e,t);else for(const r of this.#d)r.updateDefaultParams(e,t)}}showAllEditors(e,t,r=!1){for(const s of this.#n.values())s.editorType===e&&s.show(t);(this.#Z?.get(wn.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#j([[wn.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#Q!==e){this.#Q=e;for(const t of this.#s.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#fe(){if(!this.#C){this.#C=!0;const e=[];for(const t of this.#s.values())e.push(t.enable());await Promise.all(e);for(const t of this.#n.values())t.enable()}}#pe(){if(this.unselectAll(),this.#C){this.#C=!1;for(const e of this.#s.values())e.disable();for(const e of this.#n.values())e.disable()}}*getEditors(e){for(const t of this.#n.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#n.get(e)}addEditor(e){this.#n.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#x&&clearTimeout(this.#x),this.#x=setTimeout(()=>{this.focusMainContainer(),this.#x=null},0)),this.#n.delete(e.id),e.annotationElementId&&this.#N?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#m.has(e.annotationElementId))&&this.#o?.remove(e.id)}addDeletedAnnotationElement(e){this.#m.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#m.has(e)}removeDeletedAnnotationElement(e){this.#m.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#ne(e){const t=this.#s.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#j(e.propertiesToUpdate))}get#ge(){let e=null;for(e of this.#O);return e}updateUI(e){this.#ge===e&&this.#j(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#j(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#O.has(e)){this.#O.delete(e),e.unselect(),this.#I({hasSelectedEditor:this.hasSelection});return}this.#O.add(e),e.select(),this.#j(e.propertiesToUpdate),this.#I({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.uid}),this.#u?.commitOrRemove();for(const t of this.#O)t!==e&&t.unselect();this.#O.clear(),this.#O.add(e),e.select(),this.#j(e.propertiesToUpdate),this.#I({hasSelectedEditor:!0})}isSelected(e){return this.#O.has(e)}get firstSelectedEditor(){return this.#O.values().next().value}unselect(e){e.unselect(),this.#O.delete(e),this.#I({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#O.size!==0}get isEnterHandled(){return this.#O.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#l.undo(),this.#I({hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#Y()}),this._editorUndoBar?.hide()}redo(){this.#l.redo(),this.#I({hasSomethingToUndo:!0,hasSomethingToRedo:this.#l.hasSomethingToRedo(),isEmpty:this.#Y()})}addCommands(e){this.#l.add(e),this.#I({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#Y()})}cleanUndoStack(e){this.#l.cleanType(e)}#Y(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const e of this.#n.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#O],r=()=>{this._editorUndoBar?.show(i,t.length===1?t[0].editorType:t.length);for(const s of t)s.remove()},i=()=>{for(const s of t)this.#ne(s)};this.addCommands({cmd:r,undo:i,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#re(e){for(const t of this.#O)t.unselect();this.#O.clear();for(const t of e)t.isEmpty()||(this.#O.add(t),t.select());this.#I({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#O)e.commit();this.#re(this.#n.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#T!==on.NONE))&&!this.#u?.commitOrRemove()&&this.hasSelection){for(const e of this.#O)e.unselect();this.#O.clear(),this.#I({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,r=!1){if(r||this.commitOrRemove(),!this.hasSelection)return;this.#U[0]+=e,this.#U[1]+=t;const[i,s]=this.#U,o=[...this.#O],a=1e3;this.#L&&clearTimeout(this.#L),this.#L=setTimeout(()=>{this.#L=null,this.#U[0]=this.#U[1]=0,this.addCommands({cmd:()=>{for(const l of o)this.#n.has(l.id)&&(l.translateInPage(i,s),l.translationDone())},undo:()=>{for(const l of o)this.#n.has(l.id)&&(l.translateInPage(-i,-s),l.translationDone())},mustExec:!1})},a);for(const l of o)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(const e of this.#O)this.#f.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);const e=this.#f;this.#f=null;let t=!1;for(const[{x:i,y:s,pageIndex:o},a]of e)a.newX=i,a.newY=s,a.newPageIndex=o,t||=i!==a.savedX||s!==a.savedY||o!==a.savedPageIndex;if(!t)return!1;const r=(i,s,o,a)=>{if(this.#n.has(i.id)){const l=this.#s.get(a);l?i._setParentAndPosition(l,s,o):(i.pageIndex=a,i.x=s,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:s,newY:o,newPageIndex:a}]of e)r(i,s,o,a)},undo:()=>{for(const[i,{savedX:s,savedY:o,savedPageIndex:a}]of e)r(i,s,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#f)for(const r of this.#f.keys())r.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#O.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#T}isEditingMode(){return this.#T!==on.NONE}get imageManager(){return an(this,"imageManager",new zS)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let c=0,d=t.rangeCount;c<d;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;const{x:r,y:i,width:s,height:o}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,d,h,f)=>({x:(d-i)/o,y:1-(c+h-r)/s,width:f/o,height:h/s});break;case"180":a=(c,d,h,f)=>({x:1-(c+h-r)/s,y:1-(d+f-i)/o,width:h/s,height:f/o});break;case"270":a=(c,d,h,f)=>({x:1-(d+f-i)/o,y:(c-r)/s,width:f/o,height:h/s});break;default:a=(c,d,h,f)=>({x:(c-r)/s,y:(d-i)/o,width:h/s,height:f/o});break}const l=[];for(let c=0,d=t.rangeCount;c<d;c++){const h=t.getRangeAt(c);if(!h.collapsed)for(const{x:f,y:p,width:g,height:m}of h.getClientRects())g===0||m===0||l.push(a(f,p,g,m))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#a||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#a?.delete(e)}renderAnnotationElement(e){const t=this.#a?.get(e.data.id);if(!t)return;const r=this.#o.getRawValue(t);r&&(this.#T===on.NONE&&!r.hasBeenModified||r.renderAnnotationElement(e))}setMissingCanvas(e,t,r){const i=this.#N?.get(e);i&&(i.setCanvas(t,r),this.#N.delete(e))}addMissingCanvas(e,t){(this.#N||=new Map).set(e,t)}}class ya{#e=null;#t=!1;#r=null;#n=null;#s=null;#i=null;#o=!1;#a=null;#l=null;#c=null;#h=null;#u=!1;static#p=null;static _l10n=null;constructor(e){this.#l=e,this.#u=e._uiManager.useNewAltTextFlow,ya.#p||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){ya._l10n??=e}async render(){const e=this.#r=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#n=document.createElement("span");e.append(t),this.#u?(e.classList.add("new"),e.setAttribute("data-l10n-id",ya.#p.missing),t.setAttribute("data-l10n-id",ya.#p["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const r=this.#l._uiManager._signal;e.addEventListener("contextmenu",bo,{signal:r}),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:r});const i=s=>{s.preventDefault(),this.#l._uiManager.editAltText(this.#l),this.#u&&this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return e.addEventListener("click",i,{capture:!0,signal:r}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(this.#o=!0,i(s))},{signal:r}),await this.#f(),e}get#m(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#r&&(this.#r.focus({focusVisible:this.#o}),this.#o=!1)}isEmpty(){return this.#u?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#u?this.#e!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(e){this.#e===null&&(this.#c=e,this.#h=await ya._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#f())}toggleAltTextBadge(e=!1){if(!this.#u||this.#e){this.#a?.remove(),this.#a=null;return}if(!this.#a){const t=this.#a=document.createElement("div");t.className="noAltTextBadge",this.#l.div.append(t)}this.#a.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#c===t&&(t=this.#h),{altText:t,decorative:this.#t,guessedText:this.#c,textWithDisclaimer:this.#h}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:r,textWithDisclaimer:i,cancel:s=!1}){r&&(this.#c=r,this.#h=i),!(this.#e===e&&this.#t===t)&&(s||(this.#e=e,this.#t=t),this.#f())}toggle(e=!1){this.#r&&(!e&&this.#i&&(clearTimeout(this.#i),this.#i=null),this.#r.disabled=!e)}shown(){this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#r?.remove(),this.#r=null,this.#n=null,this.#s=null,this.#a?.remove(),this.#a=null}async#f(){const e=this.#r;if(!e)return;if(this.#u){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",ya.#p[this.#m]),this.#n?.setAttribute("data-l10n-id",ya.#p[`${this.#m}-label`]),!this.#e){this.#s?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#s?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#s;if(!t){this.#s=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#l.id}`;const i=100,s=this.#l._uiManager._signal;s.addEventListener("abort",()=>{clearTimeout(this.#i),this.#i=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#i=setTimeout(()=>{this.#i=null,this.#s.classList.add("show"),this.#l._reportTelemetry({action:"alt_text_tooltip"})},i)},{signal:s}),e.addEventListener("mouseleave",()=>{this.#i&&(clearTimeout(this.#i),this.#i=null),this.#s?.classList.remove("show")},{signal:s})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#l.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}let Um=class{#e=null;#t=null;#r=!1;#n=null;#s=null;#i=null;#o=null;#a=null;#l=!1;#c=null;constructor(e){this.#n=e}renderForToolbar(){const e=this.#t=document.createElement("button");return e.className="comment",this.#h(e,!1)}renderForStandalone(){const e=this.#e=document.createElement("button");e.className="annotationCommentButton";const t=this.#n.commentButtonPosition;if(t){const{style:r}=e;r.insetInlineEnd=`calc(${100*(this.#n._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,r.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=this.#n.commentButtonColor;i&&(r.backgroundColor=i)}return this.#h(e,!0)}focusButton(){setTimeout(()=>{(this.#e??this.#t)?.focus()},0)}onUpdatedColor(){if(!this.#e)return;const e=this.#n.commentButtonColor;e&&(this.#e.style.backgroundColor=e),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#e?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#c)return this.#c;if(!this.#e)return null;const{x:e,y:t,height:r}=this.#e.getBoundingClientRect(),{x:i,y:s,width:o,height:a}=this.#n.parent.boundingClientRect;return[(e-i)/o,(t+r-s)/a]}set commentPopupPositionInLayer(e){this.#c=e}hasDefaultPopupPosition(){return this.#c===null}removeStandaloneCommentButton(){this.#e?.remove(),this.#e=null}removeToolbarCommentButton(){this.#t?.remove(),this.#t=null}setCommentButtonStates({selected:e,hasPopup:t}){this.#e&&(this.#e.classList.toggle("selected",e),this.#e.ariaExpanded=t)}#h(e,t){if(!this.#n._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const r=this.#n._uiManager._signal;if(!(r instanceof AbortSignal)||r.aborted)return e;e.addEventListener("contextmenu",bo,{signal:r}),t&&(e.addEventListener("focusin",s=>{this.#n._focusEventsAllowed=!1,br(s)},{capture:!0,signal:r}),e.addEventListener("focusout",s=>{this.#n._focusEventsAllowed=!0,br(s)},{capture:!0,signal:r})),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:r});const i=s=>{s.preventDefault(),e===this.#t?this.edit():this.#n.toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:r}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(this.#r=!0,i(s))},{signal:r}),e.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:r}),e.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:r}),e}edit(e){const t=this.commentPopupPositionInLayer;let r,i;if(t)[r,i]=t;else{[r,i]=this.#n.commentButtonPosition;const{width:d,height:h,x:f,y:p}=this.#n;r=f+r*d,i=p+i*h}const s=this.#n.parent.boundingClientRect,{x:o,y:a,width:l,height:c}=s;this.#n._uiManager.editComment(this.#n,o+r*l,a+i*c,{...e,parentDimensions:s})}finish(){this.#t&&(this.#t.focus({focusVisible:this.#r}),this.#r=!1)}isDeleted(){return this.#l||this.#o===""}isEmpty(){return this.#o===null}hasBeenEdited(){return this.isDeleted()||this.#o!==this.#s}serialize(){return this.data}get data(){return{text:this.#o,richText:this.#i,date:this.#a,deleted:this.isDeleted()}}set data(e){if(e!==this.#o&&(this.#i=null),e===null){this.#o="",this.#l=!0;return}this.#o=e,this.#a=new Date,this.#l=!1}setInitialText(e,t=null){this.#s=e,this.data=e,this.#a=null,this.#i=t}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#e?.remove(),this.#e=null,this.#o="",this.#i=null,this.#a=null,this.#n=null,this.#r=!1,this.#l=!1}};class Ob{#e;#t=!1;#r=null;#n;#s;#i;#o;#a=null;#l;#c=null;#h;#u=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:r=null,onPinchStart:i=null,onPinching:s=null,onPinchEnd:o=null,signal:a}){this.#e=e,this.#r=r,this.#n=t,this.#s=i,this.#i=s,this.#o=o,this.#h=new AbortController,this.#l=AbortSignal.any([a,this.#h.signal]),e.addEventListener("touchstart",this.#p.bind(this),{passive:!1,signal:this.#l})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/za.pixelRatio}#p(e){if(this.#n?.())return;if(e.touches.length===1){if(this.#a)return;const i=this.#a=new AbortController,s=AbortSignal.any([this.#l,i.signal]),o=this.#e,a={capture:!0,signal:s,passive:!1},l=c=>{c.pointerType==="touch"&&(this.#a?.abort(),this.#a=null)};o.addEventListener("pointerdown",c=>{c.pointerType==="touch"&&(br(c),l(c))},a),o.addEventListener("pointerup",l,a),o.addEventListener("pointercancel",l,a);return}if(!this.#u){this.#u=new AbortController;const i=AbortSignal.any([this.#l,this.#u.signal]),s=this.#e,o={signal:i,capture:!1,passive:!1};s.addEventListener("touchmove",this.#m.bind(this),o);const a=this.#f.bind(this);s.addEventListener("touchend",a,o),s.addEventListener("touchcancel",a,o),o.capture=!0,s.addEventListener("pointerdown",br,o),s.addEventListener("pointermove",br,o),s.addEventListener("pointercancel",br,o),s.addEventListener("pointerup",br,o),this.#s?.()}if(br(e),e.touches.length!==2||this.#r?.()){this.#c=null;return}let[t,r]=e.touches;t.identifier>r.identifier&&([t,r]=[r,t]),this.#c={touch0X:t.screenX,touch0Y:t.screenY,touch1X:r.screenX,touch1Y:r.screenY}}#m(e){if(!this.#c||e.touches.length!==2)return;br(e);let[t,r]=e.touches;t.identifier>r.identifier&&([t,r]=[r,t]);const{screenX:i,screenY:s}=t,{screenX:o,screenY:a}=r,l=this.#c,{touch0X:c,touch0Y:d,touch1X:h,touch1Y:f}=l,p=h-c,g=f-d,m=o-i,v=a-s,y=Math.hypot(m,v)||1,O=Math.hypot(p,g)||1;if(!this.#t&&Math.abs(O-y)<=Ob.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=s,l.touch1X=o,l.touch1Y=a,!this.#t){this.#t=!0;return}const _=[(i+o)/2,(s+a)/2];this.#i?.(_,O,y)}#f(e){e.touches.length>=2||(this.#u&&(this.#u.abort(),this.#u=null,this.#o?.()),this.#c&&(br(e),this.#c=null,this.#t=!1))}destroy(){this.#h?.abort(),this.#h=null,this.#a?.abort(),this.#a=null}}class Ht{#e=null;#t=null;#r=null;#n=null;#s=null;#i=!1;#o=null;#a="";#l=null;#c=null;#h=null;#u=null;#p=null;#m="";#f=!1;#d=null;#g=!1;#y=!1;#b=!1;#v=null;#k=0;#x=0;#_=null;#A=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#w=!1;#S=Ht._zIndex++;static _borderLineWidth=-1;static _colorManager=new BS;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=Ht.prototype._resizeWithKeyboard,t=bc.TRANSLATE_SMALL,r=bc.TRANSLATE_BIG;return an(this,"_resizerKeyboardManager",new em([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-r,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[r,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-r]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,r]}],[["Escape","mac+Escape"],Ht.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:r,pageHeight:i,pageX:s,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,i],this.pageTranslation=[s,o];const[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return an(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new bte({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Ht._l10n??=e,Ht._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),Ht._borderLineWidth!==-1)return;const r=getComputedStyle(document.documentElement);Ht._borderLineWidth=parseFloat(r.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Jn("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(e){this.#w=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#S}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#L(),this.#u?.remove(),this.#u=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,r,i){const[s,o]=this.parentDimensions;[r,i]=this.screenToPageTranslation(r,i),this.x=(e+r)/s,this.y=(t+i)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[r,i]=this.parentDimensions;this.setAt(e*r,t*i,this.width*r,this.height*i),this._onTranslated()}#P([e,t],r,i){[r,i]=this.screenToPageTranslation(r,i),this.x+=r/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#P(this.parentDimensions,e,t)}translateInPage(e,t){this.#d||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#d||=[this.x,this.y,this.width,this.height];const{div:r,parentDimensions:[i,s]}=this;if(this.x+=e/i,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[l,c]=this.getBaseTranslation();o+=l,a+=c;const{style:d}=r;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),r.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#d&&(this.#d[0]!==this.x||this.#d[1]!==this.y)}get _hasBeenResized(){return!!this.#d&&(this.#d[2]!==this.width||this.#d[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:r}=Ht,i=r/e,s=r/t;switch(this.rotation){case 90:return[-i,s];case 180:return[i,s];case 270:return[i,-s];default:return[-i,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[r,i]}=this;let{x:s,y:o,width:a,height:l}=this;if(a*=r,l*=i,s*=r,o*=i,this._mustFixPosition)switch(e){case 0:s=Ri(s,0,r-a),o=Ri(o,0,i-l);break;case 90:s=Ri(s,0,r-l),o=Ri(o,a,i);break;case 180:s=Ri(s,a,r),o=Ri(o,l,i);break;case 270:s=Ri(s,l,r),o=Ri(o,0,i-a);break}this.x=s/=r,this.y=o/=i;const[c,d]=this.getBaseTranslation();s+=c,o+=d,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#C(e,t,r){switch(r){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return Ht.#C(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return Ht.#C(e,t,360-this.parentRotation)}#E(e){switch(e){case 90:{const[t,r]=this.pageDimensions;return[0,-t/r,r/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,r]=this.pageDimensions;return[0,t/r,-r/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,r]}=this;return[t*e,r*e]}setDims(){const{div:{style:e},width:t,height:r}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*r).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#Q(){if(this.#l)return;this.#l=document.createElement("div"),this.#l.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const r of e){const i=document.createElement("div");this.#l.append(i),i.classList.add("resizer",r),i.setAttribute("data-resizer-name",r),i.addEventListener("pointerdown",this.#M.bind(this,r),{signal:t}),i.addEventListener("contextmenu",bo,{signal:t}),i.tabIndex=-1}this.div.prepend(this.#l)}#M(e,t){t.preventDefault();const{isMac:r}=hi.platform;if(t.button!==0||t.ctrlKey&&r)return;this.#r?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#c=[t.screenX,t.screenY];const s=new AbortController,o=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#N.bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",br,{passive:!1,signal:o}),window.addEventListener("contextmenu",bo,{signal:o}),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const c=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#r?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#$()};window.addEventListener("pointerup",c,{signal:o}),window.addEventListener("blur",c,{signal:o})}#D(e,t,r,i){this.width=r,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#$(){if(!this.#h)return;const{savedX:e,savedY:t,savedWidth:r,savedHeight:i}=this.#h;this.#h=null;const s=this.x,o=this.y,a=this.width,l=this.height;s===e&&o===t&&a===r&&l===i||this.addCommands({cmd:this.#D.bind(this,s,o,a,l),undo:this.#D.bind(this,e,t,r,i),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#N(e,t){const[r,i]=this.parentDimensions,s=this.x,o=this.y,a=this.width,l=this.height,c=Ht.MIN_SIZE/r,d=Ht.MIN_SIZE/i,h=this.#E(this.rotation),f=(H,F)=>[h[0]*H+h[2]*F,h[1]*H+h[3]*F],p=this.#E(360-this.rotation),g=(H,F)=>[p[0]*H+p[2]*F,p[1]*H+p[3]*F];let m,v,y=!1,O=!1;switch(e){case"topLeft":y=!0,m=(H,F)=>[0,0],v=(H,F)=>[H,F];break;case"topMiddle":m=(H,F)=>[H/2,0],v=(H,F)=>[H/2,F];break;case"topRight":y=!0,m=(H,F)=>[H,0],v=(H,F)=>[0,F];break;case"middleRight":O=!0,m=(H,F)=>[H,F/2],v=(H,F)=>[0,F/2];break;case"bottomRight":y=!0,m=(H,F)=>[H,F],v=(H,F)=>[0,0];break;case"bottomMiddle":m=(H,F)=>[H/2,F],v=(H,F)=>[H/2,0];break;case"bottomLeft":y=!0,m=(H,F)=>[0,F],v=(H,F)=>[H,0];break;case"middleLeft":O=!0,m=(H,F)=>[0,F/2],v=(H,F)=>[H,F/2];break}const _=m(a,l),x=v(a,l);let k=f(...x);const S=Ht._round(s+k[0]),E=Ht._round(o+k[1]);let R=1,C=1,I,D;if(t.fromKeyboard)({deltaX:I,deltaY:D}=t);else{const{screenX:H,screenY:F}=t,[Z,$]=this.#c;[I,D]=this.screenToPageTranslation(H-Z,F-$),this.#c[0]=H,this.#c[1]=F}if([I,D]=g(I/r,D/i),y){const H=Math.hypot(a,l);R=C=Math.max(Math.min(Math.hypot(x[0]-_[0]-I,x[1]-_[1]-D)/H,1/a,1/l),c/a,d/l)}else O?R=Ri(Math.abs(x[0]-_[0]-I),c,1)/a:C=Ri(Math.abs(x[1]-_[1]-D),d,1)/l;const Q=Ht._round(a*R),M=Ht._round(l*C);k=f(...v(Q,M));const N=S-k[0],B=E-k[1];this.#d||=[this.x,this.y,this.width,this.height],this.width=Q,this.height=M,this.x=N,this.y=B,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#r?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new yp(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,r]of e)await this._editToolbar.addButton(t,r);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#r?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#r||(ya.initialize(Ht._l10n),this.#r=new ya(this),this.#e&&(this.#r.data=this.#e,this.#e=null)),this.#r}get altTextData(){return this.#r?.data}set altTextData(e){this.#r&&(this.#r.data=e)}get guessedAltText(){return this.#r?.guessedText}async setGuessedAltText(e){await this.#r?.setGuessedText(e)}serializeAltText(e){return this.#r?.serialize(e)}hasAltText(){return!!this.#r&&!this.#r.isEmpty()}hasAltTextData(){return this.#r?.hasData()??!1}focusCommentButton(){this.#n?.focusButton()}addCommentButton(){return this.canAddComment?this.#n||=new Um(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#s){this._uiManager.isEditingMode()&&this.#s.classList.remove("hidden");return}this.hasComment&&(this.#s=this.#n.renderForStandalone(),this.div.append(this.#s))}}removeStandaloneCommentButton(){this.#n.removeStandaloneCommentButton(),this.#s=null}hideStandaloneCommentButton(){this.#s?.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:r,deleted:i}}=this.#n;return{text:t,richText:e,date:r,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#n||=new Um(this),this.#n.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:r}){if(!t||(this.#n||=new Um(this),this.#n.setInitialText(e,r),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){return this.#n?.hasBeenEdited()}get hasDeletedComment(){return this.#n?.isDeleted()}get hasComment(){return!!this.#n&&!this.#n.isEmpty()&&!this.#n.isDeleted()}async editComment(e){this.#n||=new Um(this),this.#n.edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#n.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,i]=e.rect,[s]=this.pageDimensions,[o]=this.pageTranslation,a=o+s+1,l=i-100,c=a+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,l,c,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){this.#n.data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#i?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#B();const[t,r]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*r/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/r).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),mQ(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#A||=new Ob({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#V.bind(this),onPinching:this.#T.bind(this),onPinchEnd:this.#O.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#V(){this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#r?.toggle(!1),this.parent.togglePointerEvents(!1)}#T(e,t,r){let s=.7*(r/t)+1-.7;if(s===1)return;const o=this.#E(this.rotation),a=(S,E)=>[o[0]*S+o[2]*E,o[1]*S+o[3]*E],[l,c]=this.parentDimensions,d=this.x,h=this.y,f=this.width,p=this.height,g=Ht.MIN_SIZE/l,m=Ht.MIN_SIZE/c;s=Math.max(Math.min(s,1/f,1/p),g/f,m/p);const v=Ht._round(f*s),y=Ht._round(p*s);if(v===f&&y===p)return;this.#d||=[d,h,f,p];const O=a(f/2,p/2),_=Ht._round(d+O[0]),x=Ht._round(h+O[1]),k=a(v/2,y/2);this.x=_-k[0],this.y=x-k[1],this.width=v,this.height=y,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#O(){this.#r?.toggle(!0),this.parent.togglePointerEvents(!0),this.#$()}pointerdown(e){const{isMac:t}=hi.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#F(e);return}this.#R(e)}#R(e){const{isMac:t}=hi.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#F(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let r=!1;const i=new AbortController,s=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:s},a=c=>{i.abort(),this.#o=null,this.#f=!1,this._uiManager.endDragSession()||this.#R(c),r&&this._onStopDragging()};t&&(this.#k=e.clientX,this.#x=e.clientY,this.#o=e.pointerId,this.#a=e.pointerType,window.addEventListener("pointermove",c=>{r||(r=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:d,clientY:h,pointerId:f}=c;if(f!==this.#o){br(c);return}const[p,g]=this.screenToPageTranslation(d-this.#k,h-this.#x);this.#k=d,this.#x=h,this._uiManager.dragSelectedEditors(p,g)},o),window.addEventListener("touchmove",br,o),window.addEventListener("pointerdown",c=>{c.pointerType===this.#a&&(this.#A||c.isPrimary)&&a(c),br(c)},o));const l=c=>{if(!this.#o||this.#o===c.pointerId){a(c);return}br(c)};window.addEventListener("pointerup",l,{signal:s}),window.addEventListener("blur",l,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.#v=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,r){e.changeParent(this),this.x=t,this.y=r,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,r=this.rotation){const i=this.parentScale,[s,o]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/i,d=t/i,h=this.x*s,f=this.y*o,p=this.width*s,g=this.height*o;switch(r){case 0:return[h+c+a,o-f-d-g+l,h+c+p+a,o-f-d+l];case 90:return[h+d+a,o-f+c+l,h+d+g+a,o-f+c+p+l];case 180:return[h-c-p+a,o-f+d+l,h-c+a,o-f+d+g+l];case 270:return[h-d-g+a,o-f-c-p+l,h-d+a,o-f-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[r,i,s,o]=e,a=s-r,l=o-i;switch(this.rotation){case 0:return[r,t-o,a,l];case 90:return[r,t-i,l,a];case 180:return[s,t-i,a,l];case 270:return[s,t-o,l,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&Ht._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#n?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:r,opacity:i,deleted:s,richText:o},uid:a,pageIndex:l,creationDate:c,modificationDate:d}=this;return{id:a,pageIndex:l,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:c,modificationDate:r||d,popupRef:!s,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#b}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:r,right:i}=this.getClientDimensions(),{innerHeight:s,innerWidth:o}=window;return t<o&&i>0&&e<s&&r>0}#B(){if(this.#p||!this.div)return;this.#p=new AbortController;const e=this._uiManager.combinedSignal(this.#p);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#B()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,r){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:r,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,i.#e=e.accessibilityData,i._isCopy=e.isCopy||!1;const[s,o]=i.pageDimensions,[a,l,c,d]=i.getRectInCurrentCoords(e.rect,o);return i.x=a/s,i.y=l/o,i.width=c/s,i.height=d/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#p?.abort(),this.#p=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#v&&(clearTimeout(this.#v),this.#v=null),this.#L(),this.removeEditToolbar(),this.#_){for(const e of this.#_.values())clearTimeout(e);this.#_=null}this.parent=null,this.#A?.destroy(),this.#A=null,this.#u?.remove(),this.#u=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#Q(),this.#l.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[r,i,s,o]=this.getPDFRect();return[Ht._round(r+(s-r)*e),Ht._round(i+(o-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#n.commentPopupPositionInLayer}set commentPopupPosition(e){this.#n.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#n.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#n.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#n?.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#l.children;if(!this.#t){this.#t=Array.from(t);const o=this.#Z.bind(this),a=this.#H.bind(this),l=this._uiManager._signal;for(const c of this.#t){const d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",this.#W.bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",Ht._l10nResizer[d])}}const r=this.#t[0];let i=0;for(const o of t){if(o===r)break;i++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(s!==i){if(s<i)for(let a=0;a<i-s;a++)this.#l.append(this.#l.firstChild);else if(s>i)for(let a=0;a<s-i;a++)this.#l.firstChild.before(this.#l.lastChild);let o=0;for(const a of t){const c=this.#t[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",Ht._l10nResizer[c])}}this.#U(0),this.#b=!0,this.#l.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#Z(e){Ht._resizerKeyboardManager.exec(this,e)}#H(e){this.#b&&e.relatedTarget?.parentNode!==this.#l&&this.#L()}#W(e){this.#m=this.#b?e:""}#U(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#b&&this.#N(this.#m,{deltaX:e,deltaY:t,fromKeyboard:!0})}#L(){this.#b=!1,this.#U(-1),this.#$()}_stopResizingWithKeyboard(){this.#L(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#r?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#l?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#r?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#g}set isEditing(e){this.#g=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#_||=new Map;const{action:r}=e;let i=this.#_.get(r);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),this.#_.delete(r),this.#_.size===0&&(this.#_=null)},Ht._telemetryTimeout),this.#_.set(r,i);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#i=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#i=!0}updateFakeAnnotationElement(e){if(!this.#u&&!this.deleted){this.#u=e.addFakeAnnotation(this);return}if(this.deleted){this.#u.remove(),this.#u=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#u.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const r=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),r.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class bte extends Ht{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const nE=3285377520,Zs=4294901760,oa=65535;class vQ{constructor(e){this.h1=e?e&4294967295:nE,this.h2=e?e&4294967295:nE}update(e){let t,r;if(typeof e=="string"){t=new Uint8Array(e.length*2),r=0;for(let m=0,v=e.length;m<v;m++){const y=e.charCodeAt(m);y<=255?t[r++]=y:(t[r++]=y>>>8,t[r++]=y&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),r=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=r>>2,s=r-i*4,o=new Uint32Array(t.buffer,0,i);let a=0,l=0,c=this.h1,d=this.h2;const h=3432918353,f=461845907,p=h&oa,g=f&oa;for(let m=0;m<i;m++)m&1?(a=o[m],a=a*h&Zs|a*p&oa,a=a<<15|a>>>17,a=a*f&Zs|a*g&oa,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=o[m],l=l*h&Zs|l*p&oa,l=l<<15|l>>>17,l=l*f&Zs|l*g&oa,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,s){case 3:a^=t[i*4+2]<<16;case 2:a^=t[i*4+1]<<8;case 1:a^=t[i*4],a=a*h&Zs|a*p&oa,a=a<<15|a>>>17,a=a*f&Zs|a*g&oa,i&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Zs|e*36045&oa,t=t*4283543511&Zs|((t<<16|e>>>16)*2950163797&Zs)>>>16,e^=t>>>1,e=e*444984403&Zs|e*60499&oa,t=t*3301882366&Zs|((t<<16|e>>>16)*3120437893&Zs)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const IO=Object.freeze({map:null,hash:"",transfer:void 0});class US{#e=!1;#t=null;#r=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const r=this.#n.get(e);return r===void 0?t:Object.assign(t,r)}getRawValue(e){return this.#n.get(e)}remove(e){const t=this.#n.get(e);if(t!==void 0&&(t instanceof Ht&&this.#r.delete(t.annotationElementId),this.#n.delete(e),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const r of this.#n.values())if(r instanceof Ht)return;this.onAnnotationEditor(null)}}setValue(e,t){const r=this.#n.get(e);let i=!1;if(r!==void 0)for(const[s,o]of Object.entries(t))r[s]!==o&&(i=!0,r[s]=o);else i=!0,this.#n.set(e,t);i&&this.#s(),t instanceof Ht&&((this.#r||=new Map).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#n.has(e)}get size(){return this.#n.size}#s(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new yQ(this)}get serializable(){if(this.#n.size===0)return IO;const e=new Map,t=new vQ,r=[],i=Object.create(null);let s=!1;for(const[o,a]of this.#n){const l=a instanceof Ht?a.serialize(!1,i):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),s||=!!l.bitmap)}if(s)for(const o of e.values())o.bitmap&&r.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:r}:IO}get editorStats(){let e=null;const t=new Map;let r=0,i=0;for(const s of this.#n.values()){if(!(s instanceof Ht)){s.popup&&(s.popup.deleted?i+=1:r+=1);continue}s.isCommentDeleted?i+=1:s.hasEditedComment&&(r+=1);const o=s.telemetryFinalData;if(!o)continue;const{type:a}=o;t.has(a)||t.set(a,Object.getPrototypeOf(s).constructor),e||=Object.create(null);const l=e[a]||=new Map;for(const[c,d]of Object.entries(o)){if(c==="type")continue;let h=l.get(c);h||(h=new Map,l.set(c,h));const f=h.get(d)??0;h.set(d,f+1)}}if((i>0||r>0)&&(e||=Object.create(null),e.comments={deleted:i,edited:r}),!e)return null;for(const[s,o]of t)e[s]=o.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){this.#t=null}updateEditor(e,t){const r=this.#r?.get(e);return r?(r.updateFromAnnotationLayer(t),!0):!1}getEditor(e){return this.#r?.get(e)||null}get modifiedIds(){if(this.#t)return this.#t;const e=[];if(this.#r)for(const t of this.#r.values())t.serialize()&&e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class yQ extends US{#e;constructor(e){super();const{map:t,hash:r,transfer:i}=e.serializable,s=structuredClone(t,i?{transfer:i}:null);this.#e={map:s,hash:r,transfer:i}}get print(){Jn("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return an(this,"modifiedIds",{ids:new Set,hash:""})}}class wte{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:r}){if(!(!e||this.#e.has(e.loadedName))){if(_n(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:s,style:o}=e,a=new FontFace(i,s,o);this.addNativeFontFace(a);try{await a.load(),this.#e.add(i),r?.(e)}catch{rn(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Jn("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const r=e.createNativeFontFace();if(r){this.addNativeFontFace(r);try{await r.loaded}catch(i){throw rn(`Failed to load font '${r.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(r=>{const i=this._queueLoadingCallback(r);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return an(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return an(this,"isSyncFontLoadingSupported",Mi||hi.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(_n(!i.done,"completeRequest() cannot be called twice."),i.done=!0;r.length>0&&r[0].done;){const s=r.shift();setTimeout(s.callback,0)}}const{loadingRequests:r}=this,i={done:!1,complete:t,callback:e};return r.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return an(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function r(x,k){return x.charCodeAt(k)<<24|x.charCodeAt(k+1)<<16|x.charCodeAt(k+2)<<8|x.charCodeAt(k+3)&255}function i(x,k,S,E){const R=x.substring(0,k),C=x.substring(k+S);return R+E+C}let s,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let c=0;function d(x,k){if(++c>30){rn("Load test font never loaded."),k();return}if(l.font="30px "+x,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){k();return}setTimeout(d.bind(null,x,k))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,h.length,h);const g=16,m=1482184792;let v=r(f,g);for(s=0,o=h.length-3;s<o;s+=4)v=v-m+r(h,s)|0;s<h.length&&(v=v-m+r(h+"XXX",s)|0),f=i(f,g,4,ete(v));const y=`url(data:font/opentype;base64,${btoa(f)});`,O=`@font-face {font-family:"${h}";src:${y}}`;this.insertRule(O);const _=this._document.createElement("div");_.style.visibility="hidden",_.style.width=_.style.height="10px",_.style.position="absolute",_.style.top=_.style.left="0px";for(const x of[e.loadedName,h]){const k=this._document.createElement("span");k.textContent="Hi",k.style.fontFamily=x,_.append(k)}this._document.body.append(_),d(h,()=>{_.remove(),t.complete()})}}class _te{#e;constructor(e,t=null,r,i){this.compiledGlyphs=Object.create(null),this.#e=e,this._inspectFont=t,r&&Object.assign(this,r),i&&(this.charProcOperatorList=i)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${hQ(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const r=this.loadedName+"_path_"+t;let i;try{i=e.get(r)}catch(o){rn(`getPathGenerator - ignoring character: "${o}".`)}const s=gQ(i);return this.fontExtraProperties||e.delete(r),this.compiledGlyphs[t]=s}get black(){return this.#e.black}get bold(){return this.#e.bold}get disableFontFace(){return this.#e.disableFontFace??!1}get fontExtraProperties(){return this.#e.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#e.isInvalidPDFjsFont}get isType3Font(){return this.#e.isType3Font}get italic(){return this.#e.italic}get missingFile(){return this.#e.missingFile}get remeasure(){return this.#e.remeasure}get vertical(){return this.#e.vertical}get ascent(){return this.#e.ascent}get defaultWidth(){return this.#e.defaultWidth}get descent(){return this.#e.descent}get bbox(){return this.#e.bbox}get fontMatrix(){return this.#e.fontMatrix}get fallbackName(){return this.#e.fallbackName}get loadedName(){return this.#e.loadedName}get mimetype(){return this.#e.mimetype}get name(){return this.#e.name}get data(){return this.#e.data}clearData(){this.#e.clearData()}get cssFontInfo(){return this.#e.cssFontInfo}get systemFontInfo(){return this.#e.systemFontInfo}get defaultVMetrics(){return this.#e.defaultVMetrics}}class nh{#e;#t;#r;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,r={};let i=0;for(const c of nh.strings){const d=t.encode(e[c]);r[c]=d,i+=4+d.length}const s=new ArrayBuffer(i),o=new Uint8Array(s),a=new DataView(s);let l=0;for(const c of nh.strings){const d=r[c],h=d.length;a.setUint32(l,h),o.set(d,l+4),l+=4+h}return _n(l===s.byteLength,"CssFontInfo.write: Buffer overflow"),s}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#r=new TextDecoder}#n(e){_n(e<nh.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=this.#t.getUint32(t)+4;const r=this.#t.getUint32(t);return this.#r.decode(new Uint8Array(this.#e,t+4,r))}get fontFamily(){return this.#n(0)}get fontWeight(){return this.#n(1)}get italicAngle(){return this.#n(2)}}class rh{#e;#t;#r;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,r={};let i=0;for(const f of rh.strings){const p=t.encode(e[f]);r[f]=p,i+=4+p.length}i+=4;let s,o,a=1+i;e.style&&(s=t.encode(e.style.style),o=t.encode(e.style.weight),a+=4+s.length+4+o.length);const l=new ArrayBuffer(a),c=new Uint8Array(l),d=new DataView(l);let h=0;d.setUint8(h++,e.guessFallback?1:0),d.setUint32(h,0),h+=4,i=0;for(const f of rh.strings){const p=r[f],g=p.length;i+=4+g,d.setUint32(h,g),c.set(p,h+4),h+=4+g}return d.setUint32(h-i-4,i),e.style&&(d.setUint32(h,s.length),c.set(s,h+4),h+=4+s.length,d.setUint32(h,o.length),c.set(o,h+4),h+=4+o.length),_n(h<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(h)}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#r=new TextDecoder}get guessFallback(){return this.#t.getUint8(0)!==0}#n(e){_n(e<rh.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=this.#t.getUint32(t)+4;const r=this.#t.getUint32(t);return this.#r.decode(new Uint8Array(this.#e,t+4,r))}get css(){return this.#n(0)}get loadedName(){return this.#n(1)}get baseFontName(){return this.#n(2)}get src(){return this.#n(3)}get style(){let e=1;e+=4+this.#t.getUint32(e);const t=this.#t.getUint32(e),r=this.#r.decode(new Uint8Array(this.#e,e+4,t));e+=4+t;const i=this.#t.getUint32(e),s=this.#r.decode(new Uint8Array(this.#e,e+4,i));return{style:r,weight:s}}}class Hn{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#e=Math.ceil(this.bools.length*2/8);static#t=this.#e+this.numbers.length*8;static#r=this.#t+1+8;static#n=this.#r+1+48;static#s=this.#n+1+6;#i;#o;#a;constructor({data:e,extra:t}){this.#i=e,this.#o=new TextDecoder,this.#a=new DataView(this.#i),t&&Object.assign(this,t)}#l(e){_n(e<Hn.bools.length,"Invalid boolean index");const t=Math.floor(e/4),r=e*2%8,i=this.#a.getUint8(t)>>r&3;return i===0?void 0:i===2}get black(){return this.#l(0)}get bold(){return this.#l(1)}get disableFontFace(){return this.#l(2)}get fontExtraProperties(){return this.#l(3)}get isInvalidPDFjsFont(){return this.#l(4)}get isType3Font(){return this.#l(5)}get italic(){return this.#l(6)}get missingFile(){return this.#l(7)}get remeasure(){return this.#l(8)}get vertical(){return this.#l(9)}#c(e){return _n(e<Hn.numbers.length,"Invalid number index"),this.#a.getFloat64(Hn.#e+e*8)}get ascent(){return this.#c(0)}get defaultWidth(){return this.#c(1)}get descent(){return this.#c(2)}get bbox(){let e=Hn.#t;if(this.#a.getUint8(e)===0)return;e+=1;const r=[];for(let i=0;i<4;i++)r.push(this.#a.getInt16(e,!0)),e+=2;return r}get fontMatrix(){let e=Hn.#r;if(this.#a.getUint8(e)===0)return;e+=1;const r=[];for(let i=0;i<6;i++)r.push(this.#a.getFloat64(e,!0)),e+=8;return r}get defaultVMetrics(){let e=Hn.#n;if(this.#a.getUint8(e)===0)return;e+=1;const r=[];for(let i=0;i<3;i++)r.push(this.#a.getInt16(e,!0)),e+=2;return r}#h(e){_n(e<Hn.strings.length,"Invalid string index");let t=Hn.#s+4;for(let s=0;s<e;s++)t+=this.#a.getUint32(t)+4;const r=this.#a.getUint32(t),i=new Uint8Array(r);return i.set(new Uint8Array(this.#i,t+4,r)),this.#o.decode(i)}get fallbackName(){return this.#h(0)}get loadedName(){return this.#h(1)}get mimetype(){return this.#h(2)}get name(){return this.#h(3)}get data(){let e=Hn.#s;const t=this.#a.getUint32(e);e+=4+t;const r=this.#a.getUint32(e);e+=4+r;const i=this.#a.getUint32(e);e+=4+i;const s=this.#a.getUint32(e);if(s!==0)return new Uint8Array(this.#i,e+4,s)}clearData(){let e=Hn.#s;const t=this.#a.getUint32(e);e+=4+t;const r=this.#a.getUint32(e);e+=4+r;const i=this.#a.getUint32(e);e+=4+i;const s=this.#a.getUint32(e);new Uint8Array(this.#i,e+4,s).fill(0),this.#a.setUint32(e,0)}get cssFontInfo(){let e=Hn.#s;const t=this.#a.getUint32(e);e+=4+t;const r=this.#a.getUint32(e);e+=4+r;const i=this.#a.getUint32(e);if(i===0)return null;const s=new Uint8Array(i);return s.set(new Uint8Array(this.#i,e+4,i)),new nh(s.buffer)}get systemFontInfo(){let e=Hn.#s;const t=this.#a.getUint32(e);e+=4+t;const r=this.#a.getUint32(e);if(r===0)return null;const i=new Uint8Array(r);return i.set(new Uint8Array(this.#i,e+4,r)),new rh(i.buffer)}static write(e){const t=e.systemFontInfo?rh.write(e.systemFontInfo):null,r=e.cssFontInfo?nh.write(e.cssFontInfo):null,i=new TextEncoder,s={};let o=0;for(const m of Hn.strings)s[m]=i.encode(e[m]),o+=4+s[m].length;const a=Hn.#s+4+o+4+(t?t.byteLength:0)+4+(r?r.byteLength:0)+4+(e.data?e.data.length:0),l=new ArrayBuffer(a),c=new Uint8Array(l),d=new DataView(l);let h=0;const f=Hn.bools.length;let p=0,g=0;for(let m=0;m<f;m++){const v=e[Hn.bools[m]];p|=(v===void 0?0:v?2:1)<<g,g+=2,(g===8||m===f-1)&&(d.setUint8(h++,p),p=0,g=0)}_n(h===Hn.#e,"FontInfo.write: Boolean properties offset mismatch");for(const m of Hn.numbers)d.setFloat64(h,e[m]),h+=8;if(_n(h===Hn.#t,"FontInfo.write: Number properties offset mismatch"),e.bbox){d.setUint8(h++,4);for(const m of e.bbox)d.setInt16(h,m,!0),h+=2}else d.setUint8(h++,0),h+=8;if(_n(h===Hn.#r,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){d.setUint8(h++,6);for(const m of e.fontMatrix)d.setFloat64(h,m,!0),h+=8}else d.setUint8(h++,0),h+=48;if(_n(h===Hn.#n,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){d.setUint8(h++,1);for(const m of e.defaultVMetrics)d.setInt16(h,m,!0),h+=2}else d.setUint8(h++,0),h+=6;_n(h===Hn.#s,"FontInfo.write: DefaultVMetrics properties offset mismatch"),d.setUint32(Hn.#s,0),h+=4;for(const m of Hn.strings){const v=s[m],y=v.length;d.setUint32(h,y),c.set(v,h+4),h+=4+y}if(d.setUint32(Hn.#s,h-Hn.#s-4),!t)d.setUint32(h,0),h+=4;else{const m=t.byteLength;d.setUint32(h,m),_n(h+4+m<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),c.set(new Uint8Array(t),h+4),h+=4+m}if(!r)d.setUint32(h,0),h+=4;else{const m=r.byteLength;d.setUint32(h,m),_n(h+4+m<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),c.set(new Uint8Array(r),h+4),h+=4+m}return e.data===void 0?(d.setUint32(h,0),h+=4):(d.setUint32(h,e.data.length),c.set(e.data,h+4),h+=4+e.data.length),_n(h<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(h)}}class Wr{static#e=0;static#t=1;static#r=2;static#n=3;static#s=4;static#i=8;static#o=12;static#a=16;constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,r=null,i=[],s=[],o=[],a=[],l=null,c=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,r=e[2],o=e[3],t===1?i.push(...e[4],...e[5]):i.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,l=e[1],i=e[2],s=e[3],a=e[4]||[],r=e[6],c=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const d=Math.floor(i.length/2),h=Math.floor(s.length/3),f=o.length,p=a.length;let g=0;for(const k of a)g+=1,g=Math.ceil(g/4)*4,g+=4+k.coords.length*4,g+=4+k.colors.length*4,k.verticesPerRow!==void 0&&(g+=4);const m=20+d*8+h*3+f*8+(r?16:0)+(c?3:0)+g,v=new ArrayBuffer(m),y=new DataView(v),O=new Uint8Array(v);y.setUint8(Wr.#e,t),y.setUint8(Wr.#t,r?1:0),y.setUint8(Wr.#r,c?1:0),y.setUint8(Wr.#n,l),y.setUint32(Wr.#s,d,!0),y.setUint32(Wr.#i,h,!0),y.setUint32(Wr.#o,f,!0),y.setUint32(Wr.#a,p,!0);let _=20;new Float32Array(v,_,d*2).set(i),_+=d*8,O.set(s,_),_+=h*3;for(const[k,S]of o)y.setFloat32(_,k,!0),_+=4,y.setUint32(_,parseInt(S.slice(1),16),!0),_+=4;if(r)for(const k of r)y.setFloat32(_,k,!0),_+=4;c&&(O.set(c,_),_+=3);for(let k=0;k<a.length;k++){const S=a[k];y.setUint8(_,S.type),_+=1,_=Math.ceil(_/4)*4,y.setUint32(_,S.coords.length,!0),_+=4,new Int32Array(v,_,S.coords.length).set(S.coords),_+=S.coords.length*4,y.setUint32(_,S.colors.length,!0),_+=4,new Int32Array(v,_,S.colors.length).set(S.colors),_+=S.colors.length*4,S.verticesPerRow!==void 0&&(y.setUint32(_,S.verticesPerRow,!0),_+=4)}return v}getIR(){const e=this.view,t=this.data[Wr.#e],r=!!this.data[Wr.#t],i=!!this.data[Wr.#r],s=e.getUint32(Wr.#s,!0),o=e.getUint32(Wr.#i,!0),a=e.getUint32(Wr.#o,!0),l=e.getUint32(Wr.#a,!0);let c=20;const d=new Float32Array(this.buffer,c,s*2);c+=s*8;const h=new Uint8Array(this.buffer,c,o*3);c+=o*3;const f=[];for(let v=0;v<a;++v){const y=e.getFloat32(c,!0);c+=4;const O=e.getUint32(c,!0);c+=4,f.push([y,`#${O.toString(16).padStart(6,"0")}`])}let p=null;if(r){p=[];for(let v=0;v<4;++v)p.push(e.getFloat32(c,!0)),c+=4}let g=null;i&&(g=new Uint8Array(this.buffer,c,3),c+=3);const m=[];for(let v=0;v<l;++v){const y=e.getUint8(c);c+=1,c=Math.ceil(c/4)*4;const O=e.getUint32(c,!0);c+=4;const _=new Int32Array(this.buffer,c,O);c+=O*4;const x=e.getUint32(c,!0);c+=4;const k=new Int32Array(this.buffer,c,x);c+=x*4;const S={type:y,coords:_,colors:k};y===TO.LATTICE&&(S.verticesPerRow=e.getUint32(c,!0),c+=4),m.push(S)}if(t===1)return["RadialAxial","axial",p,f,Array.from(d.slice(0,2)),Array.from(d.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",p,f,[d[0],d[1]],[d[3],d[4]],d[2],d[5]];if(t===3){const v=this.data[Wr.#n];let y=null;if(d.length>0){let O=d[0],_=d[0],x=d[1],k=d[1];for(let S=0;S<d.length;S+=2){const E=d[S],R=d[S+1];O=O>E?E:O,x=x>R?R:x,_=_<E?E:_,k=k<R?R:k}y=[O,x,_,k]}return["Mesh",v,d,h,m,y,p,g]}throw new Error(`Unsupported pattern kind: ${t}`)}}function Ote(n){if(n instanceof URL)return n.href;if(typeof n=="string"){if(Mi)return n;const e=URL.parse(n,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function xte(n){if(Mi&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return Yg(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n?.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function jm(n){if(typeof n!="string")return null;if(n.endsWith("/"))return n;throw new Error(`Invalid factory url: "${n}" must include trailing slash.`)}const MO=n=>typeof n=="object"&&Number.isInteger(n?.num)&&n.num>=0&&Number.isInteger(n?.gen)&&n.gen>=0,kte=n=>typeof n=="object"&&typeof n?.name=="string",Ste=ste.bind(null,MO,kte);class Tte{#e=new Map;#t=Promise.resolve();postMessage(e,t){const r={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[i]of this.#e)i.call(this,r)})}addEventListener(e,t,r=null){let i=null;if(r?.signal instanceof AbortSignal){const{signal:s}=r;if(s.aborted){rn("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);i=()=>s.removeEventListener("abort",o),s.addEventListener("abort",o)}this.#e.set(t,i)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const Vm={DATA:1,ERROR:2},Er={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function rE(){}function Xi(n){if(n instanceof yc||n instanceof AO||n instanceof XC||n instanceof Ny||n instanceof Bw)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||Jn('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new yc(n.message);case"InvalidPDFException":return new AO(n.message);case"PasswordException":return new XC(n.message,n.code);case"ResponseException":return new Ny(n.message,n.status,n.missing);case"UnknownErrorException":return new Bw(n.message,n.details)}return new Bw(n.message,n.toString())}class np{#e=new AbortController;constructor(e,t,r){this.sourceName=e,this.targetName=t,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),r.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#n(e);return}if(e.callback){const r=e.callbackId,i=this.callbackCapabilities[r];if(!i)throw new Error(`Cannot resolve callback ${r}`);if(delete this.callbackCapabilities[r],e.callback===Vm.DATA)i.resolve(e.data);else if(e.callback===Vm.ERROR)i.reject(Xi(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const r=this.sourceName,i=e.sourceName,s=this.comObj;Promise.try(t,e.data).then(function(o){s.postMessage({sourceName:r,targetName:i,callback:Vm.DATA,callbackId:e.callbackId,data:o})},function(o){s.postMessage({sourceName:r,targetName:i,callback:Vm.ERROR,callbackId:e.callbackId,reason:Xi(o)})});return}if(e.streamId){this.#r(e);return}t(e.data)}on(e,t){const r=this.actionHandler;if(r[e])throw new Error(`There is already an actionName called "${e}"`);r[e]=t}send(e,t,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},r)}sendWithPromise(e,t,r){const i=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[i]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},r)}catch(o){s.reject(o)}return s.promise}sendWithStream(e,t,r,i){const s=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const d=Promise.withResolvers();return this.streamControllers[s]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:s,data:t,desiredSize:c.desiredSize},i),d.promise},pull:c=>{const d=Promise.withResolvers();return this.streamControllers[s].pullCall=d,l.postMessage({sourceName:o,targetName:a,stream:Er.PULL,streamId:s,desiredSize:c.desiredSize}),d.promise},cancel:c=>{_n(c instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[s].cancelCall=d,this.streamControllers[s].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:Er.CANCEL,streamId:s,reason:Xi(c)}),d.promise}},r)}#r(e){const t=e.streamId,r=this.sourceName,i=e.sourceName,s=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(c,d=1,h){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=d,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:r,targetName:i,stream:Er.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:r,targetName:i,stream:Er.CLOSE,streamId:t}),delete o.streamSinks[t])},error(c){_n(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:r,targetName:i,stream:Er.ERROR,streamId:t,reason:Xi(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){s.postMessage({sourceName:r,targetName:i,stream:Er.START_COMPLETE,streamId:t,success:!0})},function(c){s.postMessage({sourceName:r,targetName:i,stream:Er.START_COMPLETE,streamId:t,reason:Xi(c)})})}#n(e){const t=e.streamId,r=this.sourceName,i=e.sourceName,s=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Er.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Xi(e.reason));break;case Er.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Xi(e.reason));break;case Er.PULL:if(!a){s.postMessage({sourceName:r,targetName:i,stream:Er.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||rE).then(function(){s.postMessage({sourceName:r,targetName:i,stream:Er.PULL_COMPLETE,streamId:t,success:!0})},function(c){s.postMessage({sourceName:r,targetName:i,stream:Er.PULL_COMPLETE,streamId:t,reason:Xi(c)})});break;case Er.ENQUEUE:if(_n(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Er.CLOSE:if(_n(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#s(o,t);break;case Er.ERROR:_n(o,"error should have stream controller"),o.controller.error(Xi(e.reason)),this.#s(o,t);break;case Er.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Xi(e.reason)),this.#s(o,t);break;case Er.CANCEL:if(!a)break;const l=Xi(e.reason);Promise.try(a.onCancel||rE,l).then(function(){s.postMessage({sourceName:r,targetName:i,stream:Er.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){s.postMessage({sourceName:r,targetName:i,stream:Er.CANCEL_COMPLETE,streamId:t,reason:Xi(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#s(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class bQ{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const r=this._createCanvas(e,t);return{canvas:r,context:r.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,r){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||r<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=r}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Jn("Abstract method `_createCanvas` called.")}}class Ate extends bQ{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const r=this._document.createElement("canvas");return r.width=e,r.height=t,r}}class wQ{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(r=>({cMapData:r,isCompressed:this.isCompressed})).catch(r=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Jn("Abstract method `_fetch` called.")}}class iE extends wQ{async _fetch(e){const t=await Gg(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Yg(t)}}class _Q{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,r,i,s){return"none"}destroy(e=!1){}}class Cte extends _Q{#e;#t;#r;#n;#s;#i;#o=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#n=e,this.#s=t}get#a(){return this.#t||=new Map}get#l(){return this.#i||=new Map}get#c(){if(!this.#r){const e=this.#s.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const r=this.#s.createElementNS(tl,"svg");r.setAttribute("width",0),r.setAttribute("height",0),this.#r=this.#s.createElementNS(tl,"defs"),e.append(r),r.append(this.#r),this.#s.body.append(e)}return this.#r}#h(e){if(e.length===1){const l=e[0],c=new Array(256);for(let h=0;h<256;h++)c[h]=l[h]/255;const d=c.join(",");return[d,d,d]}const[t,r,i]=e,s=new Array(256),o=new Array(256),a=new Array(256);for(let l=0;l<256;l++)s[l]=t[l]/255,o[l]=r[l]/255,a[l]=i[l]/255;return[s.join(","),o.join(","),a.join(",")]}#u(e){if(this.#e===void 0){this.#e="";const t=this.#s.URL;t!==this.#s.baseURI&&(_b(t)?rn('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=cQ(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#a.get(e);if(t)return t;const[r,i,s]=this.#h(e),o=e.length===1?r:`${r}${i}${s}`;if(t=this.#a.get(o),t)return this.#a.set(e,t),t;const a=`g_${this.#n}_transfer_map_${this.#o++}`,l=this.#u(a);this.#a.set(e,l),this.#a.set(o,l);const c=this.#f(a);return this.#g(r,i,s,c),l}addHCMFilter(e,t){const r=`${e}-${t}`,i="base";let s=this.#l.get(i);if(s?.key===r||(s?(s.filter?.remove(),s.key=r,s.url="none",s.filter=null):(s={key:r,url:"none",filter:null},this.#l.set(i,s)),!e||!t))return s.url;const o=this.#b(e);e=Dt.makeHexColor(...o);const a=this.#b(t);if(t=Dt.makeHexColor(...a),this.#c.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return s.url;const l=new Array(256);for(let p=0;p<=255;p++){const g=p/255;l[p]=g<=.03928?g/12.92:((g+.055)/1.055)**2.4}const c=l.join(","),d=`g_${this.#n}_hcm_filter`,h=s.filter=this.#f(d);this.#g(c,c,c,h),this.#m(h);const f=(p,g)=>{const m=o[p]/255,v=a[p]/255,y=new Array(g+1);for(let O=0;O<=g;O++)y[O]=m+O/g*(v-m);return y.join(",")};return this.#g(f(0,5),f(1,5),f(2,5),h),s.url=this.#u(d),s.url}addAlphaFilter(e){let t=this.#a.get(e);if(t)return t;const[r]=this.#h([e]),i=`alpha_${r}`;if(t=this.#a.get(i),t)return this.#a.set(e,t),t;const s=`g_${this.#n}_alpha_map_${this.#o++}`,o=this.#u(s);this.#a.set(e,o),this.#a.set(i,o);const a=this.#f(s);return this.#y(r,a),o}addLuminosityFilter(e){let t=this.#a.get(e||"luminosity");if(t)return t;let r,i;if(e?([r]=this.#h([e]),i=`luminosity_${r}`):i="luminosity",t=this.#a.get(i),t)return this.#a.set(e,t),t;const s=`g_${this.#n}_luminosity_map_${this.#o++}`,o=this.#u(s);this.#a.set(e,o),this.#a.set(i,o);const a=this.#f(s);return this.#p(a),e&&this.#y(r,a),o}addHighlightHCMFilter(e,t,r,i,s){const o=`${t}-${r}-${i}-${s}`;let a=this.#l.get(e);if(a?.key===o||(a?(a.filter?.remove(),a.key=o,a.url="none",a.filter=null):(a={key:o,url:"none",filter:null},this.#l.set(e,a)),!t||!r))return a.url;const[l,c]=[t,r].map(this.#b.bind(this));let d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[f,p]=[i,s].map(this.#b.bind(this));h<d&&([d,h,f,p]=[h,d,p,f]),this.#c.style.color="";const g=(y,O,_)=>{const x=new Array(256),k=(h-d)/_,S=y/255,E=(O-y)/(255*_);let R=0;for(let C=0;C<=_;C++){const I=Math.round(d+C*k),D=S+C*E;for(let Q=R;Q<=I;Q++)x[Q]=D;R=I+1}for(let C=R;C<256;C++)x[C]=x[R-1];return x.join(",")},m=`g_${this.#n}_hcm_${e}_filter`,v=a.filter=this.#f(m);return this.#m(v),this.#g(g(f[0],p[0],5),g(f[1],p[1],5),g(f[2],p[2],5),v),a.url=this.#u(m),a.url}destroy(e=!1){e&&this.#i?.size||(this.#r?.parentNode.parentNode.remove(),this.#r=null,this.#t?.clear(),this.#t=null,this.#i?.clear(),this.#i=null,this.#o=0)}#p(e){const t=this.#s.createElementNS(tl,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#m(e){const t=this.#s.createElementNS(tl,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#f(e){const t=this.#s.createElementNS(tl,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#c.append(t),t}#d(e,t,r){const i=this.#s.createElementNS(tl,t);i.setAttribute("type","discrete"),i.setAttribute("tableValues",r),e.append(i)}#g(e,t,r,i){const s=this.#s.createElementNS(tl,"feComponentTransfer");i.append(s),this.#d(s,"feFuncR",e),this.#d(s,"feFuncG",t),this.#d(s,"feFuncB",r)}#y(e,t){const r=this.#s.createElementNS(tl,"feComponentTransfer");t.append(r),this.#d(r,"feFuncA",e)}#b(e){return this.#c.style.color=e,Jg(getComputedStyle(this.#c).getPropertyValue("color"))}}class OQ{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(r=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Jn("Abstract method `_fetch` called.")}}class sE extends OQ{async _fetch(e){const t=await Gg(e,"arraybuffer");return new Uint8Array(t)}}class xQ{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(r=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Jn("Abstract method `_fetch` called.")}}class oE extends xQ{async _fetch(e){const t=await Gg(e,"arraybuffer");return new Uint8Array(t)}}Mi&&rn("Please use the `legacy` build in Node.js environments.");async function jS(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class Ete extends _Q{}class Pte extends bQ{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Ite extends wQ{async _fetch(e){return jS(e)}}class Mte extends OQ{async _fetch(e){return jS(e)}}class Rte extends xQ{async _fetch(e){return jS(e)}}const vd="__forcedDependency",{floor:aE,ceil:lE}=Math;function qm(n,e,t,r,i,s){n[e*4+0]=Math.min(n[e*4+0],t),n[e*4+1]=Math.min(n[e*4+1],r),n[e*4+2]=Math.max(n[e*4+2],i),n[e*4+3]=Math.max(n[e*4+3],s)}const RO=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class Dte{#e;#t;constructor(e,t){this.#e=e,this.#t=t}get length(){return this.#e.length}isEmpty(e){return this.#e[e]===RO}minX(e){return this.#t[e*4+0]/256}minY(e){return this.#t[e*4+1]/256}maxX(e){return(this.#t[e*4+2]+1)/256}maxY(e){return(this.#t[e*4+3]+1)/256}}const Hm=(n,e)=>{if(!n)return;let t=n.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},n.set(e,t)),t};class Nte{#e={__proto__:null};#t={__proto__:null,transform:[],moveText:[],sameLineText:[],[vd]:[]};#r=new Map;#n=[];#s=[];#i=[[1,0,0,1,0,0]];#o=[-1/0,-1/0,1/0,1/0];#a=new Float64Array([1/0,1/0,-1/0,-1/0]);#l=-1;#c=new Set;#h=new Map;#u=new Map;#p;#m;#f;#d;#g;constructor(e,t,r=!1){this.#p=e.width,this.#m=e.height,this.#y(t),r&&(this.#g=new Map)}growOperationsCount(e){e>=this.#d.length&&this.#y(e,this.#d)}#y(e,t){const r=new ArrayBuffer(e*4);this.#f=new Uint8ClampedArray(r),this.#d=new Uint32Array(r),t&&t.length>0?(this.#d.set(t),this.#d.fill(RO,t.length)):this.#d.fill(RO)}save(e){return this.#e={__proto__:this.#e},this.#t={__proto__:this.#t,transform:{__proto__:this.#t.transform},moveText:{__proto__:this.#t.moveText},sameLineText:{__proto__:this.#t.sameLineText},[vd]:{__proto__:this.#t[vd]}},this.#o={__proto__:this.#o},this.#n.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#e);if(t===null)return this;this.#e=t,this.#t=Object.getPrototypeOf(this.#t),this.#o=Object.getPrototypeOf(this.#o);const r=this.#n.pop();return r!==void 0&&(Hm(this.#g,e)?.dependencies.add(r),this.#d[e]=this.#d[r]),this}recordOpenMarker(e){return this.#n.push(e),this}getOpenMarker(){return this.#n.length===0?null:this.#n.at(-1)}recordCloseMarker(e){const t=this.#n.pop();return t!==void 0&&(Hm(this.#g,e)?.dependencies.add(t),this.#d[e]=this.#d[t]),this}beginMarkedContent(e){return this.#s.push(e),this}endMarkedContent(e){const t=this.#s.pop();return t!==void 0&&(Hm(this.#g,e)?.dependencies.add(t),this.#d[e]=this.#d[t]),this}pushBaseTransform(e){return this.#i.push(Dt.multiplyByDOMMatrix(this.#i.at(-1),e.getTransform())),this}popBaseTransform(){return this.#i.length>1&&this.#i.pop(),this}recordSimpleData(e,t){return this.#e[e]=t,this}recordIncrementalData(e,t){return this.#t[e].push(t),this}resetIncrementalData(e,t){return this.#t[e].length=0,this}recordNamedData(e,t){return this.#r.set(e,t),this}recordSimpleDataFromNamed(e,t,r){this.#e[e]=this.#r.get(t)??r}recordFutureForcedDependency(e,t){return this.recordIncrementalData(vd,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#e&&this.recordFutureForcedDependency(t,this.#e[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#c)this.recordFutureForcedDependency(vd,e);return this}resetBBox(e){return this.#l!==e&&(this.#l=e,this.#a[0]=1/0,this.#a[1]=1/0,this.#a[2]=-1/0,this.#a[3]=-1/0),this}recordClipBox(e,t,r,i,s,o){const a=Dt.multiplyByDOMMatrix(this.#i.at(-1),t.getTransform()),l=[1/0,1/0,-1/0,-1/0];Dt.axialAlignedBoundingBox([r,s,i,o],a,l);const c=Dt.intersect(this.#o,l);return c?(this.#o[0]=c[0],this.#o[1]=c[1],this.#o[2]=c[2],this.#o[3]=c[3]):(this.#o[0]=this.#o[1]=1/0,this.#o[2]=this.#o[3]=-1/0),this}recordBBox(e,t,r,i,s,o){const a=this.#o;if(a[0]===1/0)return this;const l=Dt.multiplyByDOMMatrix(this.#i.at(-1),t.getTransform());if(a[0]===-1/0)return Dt.axialAlignedBoundingBox([r,s,i,o],l,this.#a),this;const c=[1/0,1/0,-1/0,-1/0];return Dt.axialAlignedBoundingBox([r,s,i,o],l,c),this.#a[0]=Math.min(this.#a[0],Math.max(c[0],a[0])),this.#a[1]=Math.min(this.#a[1],Math.max(c[1],a[1])),this.#a[2]=Math.max(this.#a[2],Math.min(c[2],a[2])),this.#a[3]=Math.max(this.#a[3],Math.min(c[3],a[3])),this}recordCharacterBBox(e,t,r,i=1,s=0,o=0,a){const l=r.bbox;let c,d;if(l&&(c=l[2]!==l[0]&&l[3]!==l[1]&&this.#u.get(r),c!==!1&&(d=[0,0,0,0],Dt.axialAlignedBoundingBox(l,r.fontMatrix,d),(i!==1||s!==0||o!==0)&&Dt.scaleMinMax([i,0,0,-i,s,o],d),c)))return this.recordBBox(e,t,d[0],d[2],d[1],d[3]);if(!a)return this.recordFullPageBBox(e);const h=a();return l&&d&&c===void 0&&(c=d[0]<=s-h.actualBoundingBoxLeft&&d[2]>=s+h.actualBoundingBoxRight&&d[1]<=o-h.actualBoundingBoxAscent&&d[3]>=o+h.actualBoundingBoxDescent,this.#u.set(r,c),c)?this.recordBBox(e,t,d[0],d[2],d[1],d[3]):this.recordBBox(e,t,s-h.actualBoundingBoxLeft,s+h.actualBoundingBoxRight,o-h.actualBoundingBoxAscent,o+h.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#a[0]=Math.max(0,this.#o[0]),this.#a[1]=Math.max(0,this.#o[1]),this.#a[2]=Math.min(this.#p,this.#o[2]),this.#a[3]=Math.min(this.#m,this.#o[3]),this}getSimpleIndex(e){return this.#e[e]}recordDependencies(e,t){const r=this.#c,i=this.#e,s=this.#t;for(const o of t)o in this.#e?r.add(i[o]):o in s&&s[o].forEach(r.add,r);return this}recordNamedDependency(e,t){return this.#r.has(t)&&this.#c.add(this.#r.get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[vd]),this.#g){const r=Hm(this.#g,e),{dependencies:i}=r;this.#c.forEach(i.add,i),this.#n.forEach(i.add,i),this.#s.forEach(i.add,i),i.delete(e),r.isRenderingOperation=!0}if(this.#l===e){const r=aE(this.#a[0]*256/this.#p),i=aE(this.#a[1]*256/this.#m),s=lE(this.#a[2]*256/this.#p),o=lE(this.#a[3]*256/this.#m);qm(this.#f,e,r,i,s,o);for(const a of this.#c)a!==e&&qm(this.#f,a,r,i,s,o);for(const a of this.#n)a!==e&&qm(this.#f,a,r,i,s,o);for(const a of this.#s)a!==e&&qm(this.#f,a,r,i,s,o);t||(this.#c.clear(),this.#l=-1)}return this}recordShowTextOperation(e,t=!1){const r=Array.from(this.#c);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of r)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e,t=!1){return this.#l===e&&(this.#l=-1,this.#o[0]=Math.max(this.#o[0],this.#a[0]),this.#o[1]=Math.max(this.#o[1],this.#a[1]),this.#o[2]=Math.min(this.#o[2],this.#a[2]),this.#o[3]=Math.min(this.#o[3],this.#a[3]),t||this.#c.clear()),this}_takePendingDependencies(){const e=this.#c;return this.#c=new Set,e}_extractOperation(e){const t=this.#h.get(e);return this.#h.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#c.add(t)}take(){return this.#u.clear(),new Dte(this.#d,this.#f)}takeDebugMetadata(){return this.#g}}class Ly{#e;#t;#r;#n=0;#s=0;constructor(e,t,r){if(e instanceof Ly&&e.#r===!!r)return e;this.#e=e,this.#t=t,this.#r=!!r}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#s++,this.#e.save(this.#t),this}restore(e){return this.#s>0&&(this.#e.restore(this.#t),this.#s--),this}recordOpenMarker(e){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#t:this.#e.getOpenMarker()}recordCloseMarker(e){return this.#n--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#e.pushBaseTransform(e),this}popBaseTransform(){return this.#e.popBaseTransform(),this}recordSimpleData(e,t){return this.#e.recordSimpleData(e,this.#t),this}recordIncrementalData(e,t){return this.#e.recordIncrementalData(e,this.#t),this}resetIncrementalData(e,t){return this.#e.resetIncrementalData(e,this.#t),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,r){return this.#e.recordSimpleDataFromNamed(e,t,this.#t),this}recordFutureForcedDependency(e,t){return this.#e.recordFutureForcedDependency(e,this.#t),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#e.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#e.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#r||this.#e.resetBBox(this.#t),this}recordClipBox(e,t,r,i,s,o){return this.#r||this.#e.recordClipBox(this.#t,t,r,i,s,o),this}recordBBox(e,t,r,i,s,o){return this.#r||this.#e.recordBBox(this.#t,t,r,i,s,o),this}recordCharacterBBox(e,t,r,i,s,o,a){return this.#r||this.#e.recordCharacterBBox(this.#t,t,r,i,s,o,a),this}recordFullPageBBox(e){return this.#r||this.#e.recordFullPageBBox(this.#t),this}getSimpleIndex(e){return this.#e.getSimpleIndex(e)}recordDependencies(e,t){return this.#e.recordDependencies(this.#t,t),this}recordNamedDependency(e,t){return this.#e.recordNamedDependency(this.#t,t),this}recordOperation(e){return this.#e.recordOperation(this.#t,!0),this}recordShowTextOperation(e){return this.#e.recordShowTextOperation(this.#t,!0),this}bboxToClipBoxDropOperation(e){return this.#r||this.#e.bboxToClipBoxDropOperation(this.#t,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Ws={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},ai={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function DO(n,e){if(!e)return;const t=e[2]-e[0],r=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,r),n.clip(i)}class VS{isModifyingCurrentTransform(){return!1}getPattern(){Jn("Abstract method `getPattern` called.")}}class Lte extends VS{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const r of this._colorStops)t.addColorStop(r[0],r[1]);return t}getPattern(e,t,r,i){let s;if(i===ai.STROKE||i===ai.FILL){const o=t.current.getClippedPathBoundingBox(i,fr(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),r=Dt.transform(r,[1,0,0,1,o[0],o[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),DO(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),s=e.createPattern(c.canvas,"no-repeat");const h=new DOMMatrix(r);s.setTransform(h)}else DO(e,this._bbox),s=this._createGradient(e);return s}}function Vw(n,e,t,r,i,s,o,a){const l=e.coords,c=e.colors,d=n.data,h=n.width*4;let f;l[t+1]>l[r+1]&&(f=t,t=r,r=f,f=s,s=o,o=f),l[r+1]>l[i+1]&&(f=r,r=i,i=f,f=o,o=a,a=f),l[t+1]>l[r+1]&&(f=t,t=r,r=f,f=s,s=o,o=f);const p=(l[t]+e.offsetX)*e.scaleX,g=(l[t+1]+e.offsetY)*e.scaleY,m=(l[r]+e.offsetX)*e.scaleX,v=(l[r+1]+e.offsetY)*e.scaleY,y=(l[i]+e.offsetX)*e.scaleX,O=(l[i+1]+e.offsetY)*e.scaleY;if(g>=O)return;const _=c[s],x=c[s+1],k=c[s+2],S=c[o],E=c[o+1],R=c[o+2],C=c[a],I=c[a+1],D=c[a+2],Q=Math.round(g),M=Math.round(O);let N,B,H,F,Z,$,W,G;for(let L=Q;L<=M;L++){if(L<v){const be=L<g?0:(g-L)/(g-v);N=p-(p-m)*be,B=_-(_-S)*be,H=x-(x-E)*be,F=k-(k-R)*be}else{let be;L>O?be=1:v===O?be=0:be=(v-L)/(v-O),N=m-(m-y)*be,B=S-(S-C)*be,H=E-(E-I)*be,F=R-(R-D)*be}let q;L<g?q=0:L>O?q=1:q=(g-L)/(g-O),Z=p-(p-y)*q,$=_-(_-C)*q,W=x-(x-I)*q,G=k-(k-D)*q;const ue=Math.round(Math.min(N,Z)),oe=Math.round(Math.max(N,Z));let fe=h*L+ue*4;for(let be=ue;be<=oe;be++)q=(N-be)/(N-Z),q<0?q=0:q>1&&(q=1),d[fe++]=B-(B-$)*q|0,d[fe++]=H-(H-W)*q|0,d[fe++]=F-(F-G)*q|0,d[fe++]=255}}function Qte(n,e,t){const r=e.coords,i=e.colors;let s,o;switch(e.type){case TO.LATTICE:const a=e.verticesPerRow,l=Math.floor(r.length/a)-1,c=a-1;for(s=0;s<l;s++){let d=s*a;for(let h=0;h<c;h++,d++)Vw(n,t,r[d],r[d+1],r[d+a],i[d],i[d+1],i[d+a]),Vw(n,t,r[d+a+1],r[d+1],r[d+a],i[d+a+1],i[d+1],i[d+a])}break;case TO.TRIANGLES:for(s=0,o=r.length;s<o;s+=3)Vw(n,t,r[s],r[s+1],r[s+2],i[s],i[s+1],i[s+2]);break;default:throw new Error("illegal figure")}}class $te extends VS{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,r){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),p=c/h,g=d/f,m={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/p,scaleY:1/g},v=h+4,y=f+4,O=r.getCanvas("mesh",v,y),_=O.context,x=_.createImageData(h,f);if(t){const S=x.data;for(let E=0,R=S.length;E<R;E+=4)S[E]=t[0],S[E+1]=t[1],S[E+2]=t[2],S[E+3]=255}for(const S of this._figures)Qte(x,S,m);return _.putImageData(x,2,2),{canvas:O.canvas,offsetX:a-2*p,offsetY:l-2*g,scaleX:p,scaleY:g}}isModifyingCurrentTransform(){return!0}getPattern(e,t,r,i){DO(e,this._bbox);const s=new Float32Array(2);if(i===ai.SHADING)Dt.singularValueDecompose2dScale(fr(e),s);else if(this.matrix){Dt.singularValueDecompose2dScale(this.matrix,s);const[a,l]=s;Dt.singularValueDecompose2dScale(t.baseTransform,s),s[0]*=a,s[1]*=l}else Dt.singularValueDecompose2dScale(t.baseTransform,s);const o=this._createMeshCanvas(s,i===ai.SHADING?null:this._background,t.cachedCanvases);return i!==ai.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class Fte extends VS{getPattern(){return"hotpink"}}function zte(n){switch(n[0]){case"RadialAxial":return new Lte(n);case"Mesh":return new $te(n);case"Dummy":return new Fte}throw new Error(`Unknown IR type: ${n[0]}`)}const cE={COLORED:1,UNCOLORED:2};class qS{static MAX_PATTERN_SIZE=3e3;constructor(e,t,r,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=r,this.baseTransform=i}createPatternCanvas(e,t){const{bbox:r,operatorList:i,paintType:s,tilingType:o,color:a,canvasGraphicsFactory:l}=this;let{xstep:c,ystep:d}=this;c=Math.abs(c),d=Math.abs(d),wb("TilingType: "+o);const h=r[0],f=r[1],p=r[2],g=r[3],m=p-h,v=g-f,y=new Float32Array(2);Dt.singularValueDecompose2dScale(this.matrix,y);const[O,_]=y;Dt.singularValueDecompose2dScale(this.baseTransform,y);const x=O*y[0],k=_*y[1];let S=m,E=v,R=!1,C=!1;const I=Math.ceil(c*x),D=Math.ceil(d*k),Q=Math.ceil(m*x),M=Math.ceil(v*k);I>=Q?S=c:R=!0,D>=M?E=d:C=!0;const N=this.getSizeAndScale(S,this.ctx.canvas.width,x),B=this.getSizeAndScale(E,this.ctx.canvas.height,k),H=e.cachedCanvases.getCanvas("pattern",N.size,B.size),F=H.context,Z=l.createCanvasGraphics(F,t);if(Z.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(Z,s,a),F.translate(-N.scale*h,-B.scale*f),Z.transform(0,N.scale,0,0,B.scale,0,0),F.save(),Z.dependencyTracker?.save(),this.clipBbox(Z,h,f,p,g),Z.baseTransform=fr(Z.ctx),Z.executeOperatorList(i),Z.endDrawing(),Z.dependencyTracker?.restore(),F.restore(),R||C){const $=H.canvas;R&&(S=c),C&&(E=d);const W=this.getSizeAndScale(S,this.ctx.canvas.width,x),G=this.getSizeAndScale(E,this.ctx.canvas.height,k),L=W.size,q=G.size,ue=e.cachedCanvases.getCanvas("pattern-workaround",L,q),oe=ue.context,fe=R?Math.floor(m/c):0,be=C?Math.floor(v/d):0;for(let De=0;De<=fe;De++)for(let Le=0;Le<=be;Le++)oe.drawImage($,L*De,q*Le,L,q,0,0,L,q);return{canvas:ue.canvas,scaleX:W.scale,scaleY:G.scale,offsetX:h,offsetY:f}}return{canvas:H.canvas,scaleX:N.scale,scaleY:B.scale,offsetX:h,offsetY:f}}getSizeAndScale(e,t,r){const i=Math.max(qS.MAX_PATTERN_SIZE,t);let s=Math.ceil(e*r);return s>=i?s=i:r=s/e,{scale:r,size:s}}clipBbox(e,t,r,i,s){const o=i-t,a=s-r;e.ctx.rect(t,r,o,a),Dt.axialAlignedBoundingBox([t,r,i,s],fr(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,r){const i=e.ctx,s=e.current;switch(t){case cE.COLORED:const{fillStyle:o,strokeStyle:a}=this.ctx;i.fillStyle=s.fillColor=o,i.strokeStyle=s.strokeColor=a;break;case cE.UNCOLORED:i.fillStyle=i.strokeStyle=r,s.fillColor=s.strokeColor=r;break;default:throw new Jee(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,r,i,s){let o=r;i!==ai.SHADING&&(o=Dt.transform(o,t.baseTransform),this.matrix&&(o=Dt.transform(o,this.matrix)));const a=this.createPatternCanvas(t,s);let l=new DOMMatrix(o);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const c=e.createPattern(a.canvas,"repeat");return c.setTransform(l),c}}function Bte({src:n,srcPos:e=0,dest:t,width:r,height:i,nonBlackColor:s=4294967295,inverseDecode:o=!1}){const a=hi.isLittleEndian?4278190080:255,[l,c]=o?[s,a]:[a,s],d=r>>3,h=r&7,f=n.length;t=new Uint32Array(t.buffer);let p=0;for(let g=0;g<i;g++){for(const v=e+d;e<v;e++){const y=e<f?n[e]:255;t[p++]=y&128?c:l,t[p++]=y&64?c:l,t[p++]=y&32?c:l,t[p++]=y&16?c:l,t[p++]=y&8?c:l,t[p++]=y&4?c:l,t[p++]=y&2?c:l,t[p++]=y&1?c:l}if(h===0)continue;const m=e<f?n[e++]:255;for(let v=0;v<h;v++)t[p++]=m&1<<7-v?c:l}return{srcPos:e,destPos:p}}const uE=16,dE=100,Ute=15,hE=10,es=16,qw=new DOMMatrix,Ts=new Float32Array(2),Bd=new Float32Array([1/0,1/0,-1/0,-1/0]);function jte(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(t,r){e.translate(t,r),this.__originalTranslate(t,r)},n.scale=function(t,r){e.scale(t,r),this.__originalScale(t,r)},n.transform=function(t,r,i,s,o,a){e.transform(t,r,i,s,o,a),this.__originalTransform(t,r,i,s,o,a)},n.setTransform=function(t,r,i,s,o,a){e.setTransform(t,r,i,s,o,a),this.__originalSetTransform(t,r,i,s,o,a)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(t){e.rotate(t),this.__originalRotate(t)},n.clip=function(t){e.clip(t),this.__originalClip(t)},n.moveTo=function(t,r){e.moveTo(t,r),this.__originalMoveTo(t,r)},n.lineTo=function(t,r){e.lineTo(t,r),this.__originalLineTo(t,r)},n.bezierCurveTo=function(t,r,i,s,o,a){e.bezierCurveTo(t,r,i,s,o,a),this.__originalBezierCurveTo(t,r,i,s,o,a)},n.rect=function(t,r,i,s){e.rect(t,r,i,s),this.__originalRect(t,r,i,s)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class Vte{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,r){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,r)):(i=this.canvasFactory.create(t,r),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Zm(n,e,t,r,i,s,o,a,l,c){const[d,h,f,p,g,m]=fr(n);if(h===0&&f===0){const O=o*d+g,_=Math.round(O),x=a*p+m,k=Math.round(x),S=(o+l)*d+g,E=Math.abs(Math.round(S)-_)||1,R=(a+c)*p+m,C=Math.abs(Math.round(R)-k)||1;return n.setTransform(Math.sign(d),0,0,Math.sign(p),_,k),n.drawImage(e,t,r,i,s,0,0,E,C),n.setTransform(d,h,f,p,g,m),[E,C]}if(d===0&&p===0){const O=a*f+g,_=Math.round(O),x=o*h+m,k=Math.round(x),S=(a+c)*f+g,E=Math.abs(Math.round(S)-_)||1,R=(o+l)*h+m,C=Math.abs(Math.round(R)-k)||1;return n.setTransform(0,Math.sign(h),Math.sign(f),0,_,k),n.drawImage(e,t,r,i,s,0,0,C,E),n.setTransform(d,h,f,p,g,m),[C,E]}n.drawImage(e,t,r,i,s,o,a,l,c);const v=Math.hypot(d,h),y=Math.hypot(f,p);return[v*l,y*c]}class fE{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=SO;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=ei.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,r){r?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Bd.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=ai.FILL,t=null){const r=this.minMax.slice();if(e===ai.STROKE){t||Jn("Stroke bounding box must include transform."),Dt.singularValueDecompose2dScale(t,Ts);const i=Ts[0]*this.lineWidth/2,s=Ts[1]*this.lineWidth/2;r[0]-=i,r[1]-=s,r[2]+=i,r[3]+=s}return r}updateClipFromPath(){const e=Dt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Bd,0)}getClippedPathBoundingBox(e=ai.FILL,t=null){return Dt.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function pE(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,r=e.width,i=t%es,s=(t-i)/es,o=i===0?s:s+1,a=n.createImageData(r,es);let l=0,c;const d=e.data,h=a.data;let f,p,g,m;if(e.kind===Uv.GRAYSCALE_1BPP){const v=d.byteLength,y=new Uint32Array(h.buffer,0,h.byteLength>>2),O=y.length,_=r+7>>3,x=4294967295,k=hi.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(g=f<s?es:i,c=0,p=0;p<g;p++){const S=v-l;let E=0;const R=S>_?r:S*8-7,C=R&-8;let I=0,D=0;for(;E<C;E+=8)D=d[l++],y[c++]=D&128?x:k,y[c++]=D&64?x:k,y[c++]=D&32?x:k,y[c++]=D&16?x:k,y[c++]=D&8?x:k,y[c++]=D&4?x:k,y[c++]=D&2?x:k,y[c++]=D&1?x:k;for(;E<R;E++)I===0&&(D=d[l++],I=128),y[c++]=D&I?x:k,I>>=1}for(;c<O;)y[c++]=0;n.putImageData(a,0,f*es)}}else if(e.kind===Uv.RGBA_32BPP){for(p=0,m=r*es*4,f=0;f<s;f++)h.set(d.subarray(l,l+m)),l+=m,n.putImageData(a,0,p),p+=es;f<o&&(m=r*i*4,h.set(d.subarray(l,l+m)),n.putImageData(a,0,p))}else if(e.kind===Uv.RGB_24BPP)for(g=es,m=r*g,f=0;f<o;f++){for(f>=s&&(g=i,m=r*g),c=0,p=m;p--;)h[c++]=d[l++],h[c++]=d[l++],h[c++]=d[l++],h[c++]=255;n.putImageData(a,0,f*es)}else throw new Error(`bad image kind: ${e.kind}`)}function gE(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,r=e.width,i=t%es,s=(t-i)/es,o=i===0?s:s+1,a=n.createImageData(r,es);let l=0;const c=e.data,d=a.data;for(let h=0;h<o;h++){const f=h<s?es:i;({srcPos:l}=Bte({src:c,srcPos:l,dest:d,width:r,height:f,nonBlackColor:0})),n.putImageData(a,0,h*es)}}function Of(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const r of t)n[r]!==void 0&&(e[r]=n[r]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function Wm(n){n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0);const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}function mE(n,e){if(e)return!0;Dt.singularValueDecompose2dScale(n,Ts);const t=Math.fround(za.pixelRatio*Eh.PDF_TO_CSS_UNITS);return Ts[0]<=t&&Ts[1]<=t}const qte=["butt","round","square"],Hte=["miter","round","bevel"],Zte={},vE={};class ih{constructor(e,t,r,i,s,{optionalContentConfig:o,markedContentStack:a=null},l,c,d){this.ctx=e,this.current=new fE(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=r,this.canvasFactory=i,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new Vte(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=d??null}getObject(e,t,r=null){return typeof t=="string"?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):r}beginDrawing({transform:e,viewport:t,transparency:r=!1,background:i=null}){const s=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,s,o),this.ctx.fillStyle=a,r){const l=this.cachedCanvases.getCanvas("transparent",s,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...fr(this.compositeCtx))}this.ctx.save(),Wm(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=fr(this.ctx)}executeOperatorList(e,t,r,i,s){const o=e.argsArray,a=e.fnArray;let l=t||0;const c=o.length;if(c===l)return l;const d=c-l>hE&&typeof r=="function",h=d?Date.now()+Ute:0;let f=0;const p=this.commonObjs,g=this.objs;let m,v;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,r),l;if(!s||s(l))if(m=a[l],v=o[l]??null,m!==eg.dependency)v===null?this[m](l):this[m](l,...v);else for(const y of v){this.dependencyTracker?.recordNamedData(y,l);const O=y.startsWith("g_")?p:g;if(!O.has(y))return O.get(y,r),l}if(l++,l===c)return l;if(d&&++f>hE){if(Date.now()>h)return r(),l;f=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const r=e.width??e.displayWidth,i=e.height??e.displayHeight;let s=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=r,l=i,c="prescale1",d,h;for(;s>2&&a>1||o>2&&l>1;){let f=a,p=l;s>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),s/=a/f),o>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/p),d=this.cachedCanvases.getCanvas(c,f,p),h=d.context,h.clearRect(0,0,f,p),h.drawImage(e,0,0,a,l,0,0,f,p),e=d.canvas,a=f,l=p,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e,t){const r=this.ctx,{width:i,height:s}=t,o=this.current.fillColor,a=this.current.patternFill,l=fr(r);let c,d,h,f;if((t.bitmap||t.data)&&t.count>1){const I=t.bitmap||t.data.buffer;d=JSON.stringify(a?l:[l.slice(0,4),o]),c=this._cachedBitmapsMap.get(I),c||(c=new Map,this._cachedBitmapsMap.set(I,c));const D=c.get(d);if(D&&!a){const Q=Math.round(Math.min(l[0],l[2])+l[4]),M=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(e,Ws.transformAndFill),{canvas:D,offsetX:Q,offsetY:M}}h=D}h||(f=this.cachedCanvases.getCanvas("maskCanvas",i,s),gE(f.context,t));let p=Dt.transform(l,[1/i,0,0,-1/s,0,0]);p=Dt.transform(p,[1,0,0,1,0,-s]);const g=Bd.slice();Dt.axialAlignedBoundingBox([0,0,i,s],p,g);const[m,v,y,O]=g,_=Math.round(y-m)||1,x=Math.round(O-v)||1,k=this.cachedCanvases.getCanvas("fillCanvas",_,x),S=k.context,E=m,R=v;S.translate(-E,-R),S.transform(...p),h||(h=this._scaleImage(f.canvas,sa(S)),h=h.img,c&&a&&c.set(d,h)),S.imageSmoothingEnabled=mE(fr(S),t.interpolate),Zm(S,h,0,0,h.width,h.height,0,0,i,s),S.globalCompositeOperation="source-in";const C=Dt.transform(sa(S),[1,0,0,1,-E,-R]);return S.fillStyle=a?o.getPattern(r,this,C,ai.FILL,e):o,S.fillRect(0,0,i,s),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(d,k.canvas)),this.dependencyTracker?.recordDependencies(e,Ws.transformAndFill),{canvas:k.canvas,offsetX:Math.round(E),offsetY:Math.round(R)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=qte[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=Hte[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,r){this.dependencyTracker?.recordSimpleData("dash",e);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=r)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[r,i]of t)switch(r){case"LW":this.setLineWidth(e,i);break;case"LC":this.setLineCap(e,i);break;case"LJ":this.setLineJoin(e,i);break;case"ML":this.setMiterLimit(e,i);break;case"D":this.setDash(e,i[0],i[1]);break;case"RI":this.setRenderingIntent(e,i);break;case"FL":this.setFlatness(e,i);break;case"Font":this.setFont(e,i[0],i[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=i;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=i;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,r=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,r);this.suspendedCtx=this.ctx;const o=this.ctx=s.context;o.setTransform(this.suspendedCtx.getTransform()),Of(this.suspendedCtx,o),jte(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Of(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,r=this.suspendedCtx;this.composeSMask(r,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,r,i){const s=i[0],o=i[1],a=i[2]-s,l=i[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,r,a,l,t.subtype,t.backdrop,t.transferMap,s,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(r.canvas,0,0),e.restore())}genericComposeSMask(e,t,r,i,s,o,a,l,c,d,h){let f=e.canvas,p=l-d,g=c-h;if(o)if(p<0||g<0||p+r>f.width||g+i>f.height){const v=this.cachedCanvases.getCanvas("maskExtension",r,i),y=v.context;y.drawImage(f,-p,-g),y.globalCompositeOperation="destination-atop",y.fillStyle=o,y.fillRect(0,0,r,i),y.globalCompositeOperation="source-over",f=v.canvas,p=g=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const v=new Path2D;v.rect(p,g,r,i),e.clip(v),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(p,g,r,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),s==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):s==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));const m=new Path2D;m.rect(l,c,r,i),t.clip(m),t.globalCompositeOperation="destination-in",t.drawImage(f,p,g,r,i,l,c,r,i),t.restore()}save(e){this.inSMaskMode&&Of(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Of(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,r,i,s,o,a){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,r,i,s,o,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,r,i){let[s]=r;if(!i){s||=r[0]=new Path2D,this[t](e,s);return}if(this.dependencyTracker!==null){const o=t===eg.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-o,i[2]+o,i[1]-o,i[3]+o).recordDependencies(e,["transform"])}s instanceof Path2D||(s=r[0]=gQ(s)),Dt.axialAlignedBoundingBox(i,fr(this.ctx),this.current.minMax),this[t](e,s),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,r=!0){const i=this.ctx,s=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&s?.getPattern){const o=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=s.getPattern(i,this,sa(i),ai.STROKE,e),o){const a=new Path2D;a.addPath(t,i.getTransform().invertSelf().multiplySelf(o)),t=a}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,Ws.stroke),r&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(ai.STROKE,fr(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,r=!0){const i=this.ctx,s=this.current.fillColor,o=this.current.patternFill;let a=!1;if(o){const c=s.isModifyingCurrentTransform()?i.getTransform():null;if(this.dependencyTracker?.save(e),i.save(),i.fillStyle=s.getPattern(i,this,sa(i),ai.FILL,e),c){const d=new Path2D;d.addPath(t,i.getTransform().invertSelf().multiplySelf(c)),t=d}a=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),this.dependencyTracker?.recordDependencies(e,Ws.fill),a&&(i.restore(),this.dependencyTracker?.restore(e)),r&&this.consumePath(e,t,l)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,Ws.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=Zte}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=vE}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,r=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;t!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",e),i.recordCloseMarker(e)}if(t!==void 0){const i=new Path2D,s=r.getTransform().invertSelf();for(const{transform:o,x:a,y:l,fontSize:c,path:d}of t)d&&i.addPath(d,new DOMMatrix(o).preMultiplySelf(s).translate(a,l).scale(c,-c));r.clip(i)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,r){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),s=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=i.fontMatrix||SO,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&rn("Invalid font matrix for font "+t),r<0?(r=-r,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=r,i.isType3Font)return;const o=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${o}", ${i.fallbackName}`;let l="normal";i.black?l="900":i.bold&&(l="bold");const c=i.italic?"italic":"normal";let d=r;r<uE?d=uE:r>dE&&(d=dE),this.current.fontSizeScale=r/d,this.ctx.font=`${c} ${l} ${d}px ${a}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,r){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=r}setLeadingMoveText(e,t,r){this.setLeading(e,-r),this.moveText(e,t,r)}setTextMatrix(e,t){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:r}=this;r.textMatrix=t,r.textMatrixScale=Math.hypot(t[0],t[1]),r.x=r.lineX=0,r.y=r.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#r(e,t,r){const i=new Path2D;return i.addPath(e,new DOMMatrix(r).invertSelf().multiplySelf(t)),i}paintChar(e,t,r,i,s,o){const a=this.ctx,l=this.current,c=l.font,d=l.textRenderingMode,h=l.fontSize/l.fontSizeScale,f=d&ei.FILL_STROKE_MASK,p=!!(d&ei.ADD_TO_PATH_FLAG),g=l.patternFill&&!c.missingFile,m=l.patternStroke&&!c.missingFile;let v;if((c.disableFontFace||p||g||m)&&!c.missingFile&&(v=c.getPathGenerator(this.commonObjs,t)),v&&(c.disableFontFace||g||m)){a.save(),a.translate(r,i),a.scale(h,-h),this.dependencyTracker?.recordCharacterBBox(e,a,c);let y;if(f===ei.FILL||f===ei.FILL_STROKE)if(s){y=a.getTransform(),a.setTransform(...s);const O=this.#r(v,y,s);a.fill(O)}else a.fill(v);if(f===ei.STROKE||f===ei.FILL_STROKE)if(o){y||=a.getTransform(),a.setTransform(...o);const{a:O,b:_,c:x,d:k}=y,S=Dt.inverseTransform(o),E=Dt.transform([O,_,x,k,0,0],S);Dt.singularValueDecompose2dScale(E,Ts),a.lineWidth*=Math.max(Ts[0],Ts[1])/h,a.stroke(this.#r(v,y,o))}else a.lineWidth/=h,a.stroke(v);a.restore()}else(f===ei.FILL||f===ei.FILL_STROKE)&&(a.fillText(t,r,i),this.dependencyTracker?.recordCharacterBBox(e,a,c,h,r,i,()=>a.measureText(t))),(f===ei.STROKE||f===ei.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,a,c,h,r,i,()=>a.measureText(t)).recordDependencies(e,Ws.stroke),a.strokeText(t,r,i));p&&((this.pendingTextPaths||=[]).push({transform:fr(a),x:r,y:i,fontSize:h,path:v}),this.dependencyTracker?.recordCharacterBBox(e,a,c,h,r,i))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let r=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){r=!0;break}return an(this,"isFontSubpixelAAEnabled",r)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Ws.showText).resetBBox(e),this.current.textRenderingMode&ei.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const r=this.current,i=r.font;if(i.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordShowTextOperation(e);return}const s=r.fontSize;if(s===0){this.dependencyTracker?.recordOperation(e);return}const o=this.ctx,a=r.fontSizeScale,l=r.charSpacing,c=r.wordSpacing,d=r.fontDirection,h=r.textHScale*d,f=t.length,p=i.vertical,g=p?1:-1,m=i.defaultVMetrics,v=s*r.fontMatrix[0],y=r.textRenderingMode===ei.FILL&&!i.disableFontFace&&!r.patternFill;o.save(),r.textMatrix&&o.transform(...r.textMatrix),o.translate(r.x,r.y+r.textRise),d>0?o.scale(h,-1):o.scale(h,1);let O,_;if(r.patternFill){o.save();const R=r.fillColor.getPattern(o,this,sa(o),ai.FILL,e);O=fr(o),o.restore(),o.fillStyle=R}if(r.patternStroke){o.save();const R=r.strokeColor.getPattern(o,this,sa(o),ai.STROKE,e);_=fr(o),o.restore(),o.strokeStyle=R}let x=r.lineWidth;const k=r.textMatrixScale;if(k===0||x===0){const R=r.textRenderingMode&ei.FILL_STROKE_MASK;(R===ei.STROKE||R===ei.FILL_STROKE)&&(x=this.getSinglePixelWidth())}else x/=k;if(a!==1&&(o.scale(a,a),x/=a),o.lineWidth=x,i.isInvalidPDFjsFont){const R=[];let C=0;for(const D of t)R.push(D.unicode),C+=D.width;const I=R.join("");if(o.fillText(I,0,0),this.dependencyTracker!==null){const D=o.measureText(I);this.dependencyTracker.recordBBox(e,this.ctx,-D.actualBoundingBoxLeft,D.actualBoundingBoxRight,-D.actualBoundingBoxAscent,D.actualBoundingBoxDescent).recordShowTextOperation(e)}r.x+=C*v*h,o.restore(),this.compose();return}let S=0,E;for(E=0;E<f;++E){const R=t[E];if(typeof R=="number"){S+=g*R*s/1e3;continue}let C=!1;const I=(R.isSpace?c:0)+l,D=R.fontChar,Q=R.accent;let M,N,B=R.width;if(p){const Z=R.vmetric||m,$=-(R.vmetric?Z[1]:B*.5)*v,W=Z[2]*v;B=Z?-Z[0]:B,M=$/a,N=(S+W)/a}else M=S/a,N=0;let H;if(i.remeasure&&B>0){H=o.measureText(D);const Z=H.width*1e3/s*a;if(B<Z&&this.isFontSubpixelAAEnabled){const $=B/Z;C=!0,o.save(),o.scale($,1),M/=$}else B!==Z&&(M+=(B-Z)/2e3*s/a)}if(this.contentVisible&&(R.isInFont||i.missingFile)){if(y&&!Q)o.fillText(D,M,N),this.dependencyTracker?.recordCharacterBBox(e,o,H?{bbox:null}:i,s/a,M,N,()=>H??o.measureText(D));else if(this.paintChar(e,D,M,N,O,_),Q){const Z=M+s*Q.offset.x/a,$=N-s*Q.offset.y/a;this.paintChar(e,Q.fontChar,Z,$,O,_)}}const F=p?B*v-I*d:B*v+I*d;S+=F,C&&o.restore()}p?r.y-=S:r.x+=S*h,o.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const r=this.ctx,i=this.current,s=i.font,o=i.fontSize,a=i.fontDirection,l=s.vertical?1:-1,c=i.charSpacing,d=i.wordSpacing,h=i.textHScale*a,f=i.fontMatrix||SO,p=t.length,g=i.textRenderingMode===ei.INVISIBLE;let m,v,y,O;if(g||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,r.save(),i.textMatrix&&r.transform(...i.textMatrix),r.translate(i.x,i.y+i.textRise),r.scale(h,a);const _=this.dependencyTracker;for(this.dependencyTracker=_?new Ly(_,e):null,m=0;m<p;++m){if(v=t[m],typeof v=="number"){O=l*v*o/1e3,this.ctx.translate(O,0),i.x+=O*h;continue}const x=(v.isSpace?d:0)+c,k=s.charProcOperatorList[v.operatorListId];k?this.contentVisible&&(this.save(),r.scale(o,o),r.transform(...f),this.executeOperatorList(k),this.restore()):rn(`Type3 character "${v.operatorListId}" is not available.`);const S=[v.width,0];Dt.applyTransform(S,f),y=S[0]*o+x,r.translate(y,0),i.x+=y*h}r.restore(),_&&(this.dependencyTracker=_)}setCharWidth(e,t,r){}setCharWidthAndBounds(e,t,r,i,s,o,a){const l=new Path2D;l.rect(i,s,o-i,a-s),this.ctx.clip(l),this.dependencyTracker?.recordBBox(e,this.ctx,i,o,s,a).recordClipBox(e,this.ctx,i,o,s,a),this.endPath(e)}getColorN_Pattern(e,t){let r;if(t[0]==="TilingPattern"){const i=this.baseTransform||fr(this.ctx),s={createCanvasGraphics:(o,a)=>new ih(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Ly(this.dependencyTracker,a,!0):null)};r=new qS(t,this.ctx,s,i)}else r=this._getPattern(e,t[1],t[2]);return r}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,r=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=zte(this.getObject(e,t)),this.cachedPatterns.set(t,i)),r&&(i.matrix=r),i}shadingFill(e,t){if(!this.contentVisible)return;const r=this.ctx;this.save(e);const i=this._getPattern(e,t);r.fillStyle=i.getPattern(r,this,sa(r),ai.SHADING,e);const s=sa(r);if(s){const{width:o,height:a}=r.canvas,l=Bd.slice();Dt.axialAlignedBoundingBox([0,0,o,a],s,l);const[c,d,h,f]=l;this.ctx.fillRect(c,d,h-c,f-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Ws.transform).recordDependencies(e,Ws.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Jn("Should not call beginInlineImage")}beginImageData(){Jn("Should not call beginImageData")}paintFormXObjectBegin(e,t,r){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=fr(this.ctx),r)){Dt.axialAlignedBoundingBox(r,this.baseTransform,this.current.minMax);const[i,s,o,a]=r,l=new Path2D;l.rect(i,s,o-i,a-s),this.ctx.clip(l),this.dependencyTracker?.recordClipBox(e,this.ctx,i,o,s,a),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const r=this.ctx;t.isolated||wb("TODO: Support non-isolated groups."),t.knockout&&rn("Knockout groups not supported.");const i=fr(r);if(t.matrix&&r.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=Bd.slice();Dt.axialAlignedBoundingBox(t.bbox,fr(r),s);const o=[0,0,r.canvas.width,r.canvas.height];s=Dt.intersect(s,o)||[0,0,0,0];const a=Math.floor(s[0]),l=Math.floor(s[1]),c=Math.max(Math.ceil(s[2])-a,1),d=Math.max(Math.ceil(s[3])-l,1);this.current.startNewPathAndClipBox([0,0,c,d]);let h="groupAt"+this.groupLevel;t.smask&&(h+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(h,c,d),p=f.context;p.translate(-a,-l),p.transform(...i);let g=new Path2D;const[m,v,y,O]=t.bbox;if(g.rect(m,v,y-m,O-v),t.matrix){const _=new Path2D;_.addPath(g,new DOMMatrix(t.matrix)),g=_}p.clip(g),t.smask&&this.smaskStack.push({canvas:f.canvas,context:p,offsetX:a,offsetY:l,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(r.setTransform(1,0,0,1,0,0),r.translate(a,l),r.save()),Of(r,p),this.ctx=p,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(r),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(r),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const r=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const s=fr(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...s);const o=Bd.slice();Dt.axialAlignedBoundingBox([0,0,r.canvas.width,r.canvas.height],s,o),this.ctx.drawImage(r.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,r,i,s,o){if(this.#e(),Wm(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),r){const a=r[2]-r[0],l=r[3]-r[1];if(o&&this.annotationCanvasMap){i=i.slice(),i[4]-=r[0],i[5]-=r[1],r=r.slice(),r[0]=r[1]=0,r[2]=a,r[3]=l,Dt.singularValueDecompose2dScale(fr(this.ctx),Ts);const{viewportScale:c}=this,d=Math.ceil(a*this.outputScaleX*c),h=Math.ceil(l*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,h);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(Ts[0],0,0,-Ts[1],0,l*Ts[1]),Wm(this.ctx)}else{Wm(this.ctx),this.endPath(e);const c=new Path2D;c.rect(r[0],r[1],a,l),this.ctx.clip(c)}}this.current=new fE(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...s)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const r=t.count;t=this.getObject(e,t.data,t),t.count=r;const i=this.ctx,s=this._createMaskCanvas(e,t),o=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(o,s.offsetX,s.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,s.offsetX,s.offsetX+o.width,s.offsetY,s.offsetY+o.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,r,i=0,s=0,o,a){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const l=this.ctx;l.save();const c=fr(l);l.transform(r,i,s,o,0,0);const d=this._createMaskCanvas(e,t);l.setTransform(1,0,0,1,d.offsetX-c[4],d.offsetY-c[5]),this.dependencyTracker?.resetBBox(e);for(let h=0,f=a.length;h<f;h+=2){const p=Dt.transform(c,[r,i,s,o,a[h],a[h+1]]);l.drawImage(d.canvas,p[4],p[5]),this.dependencyTracker?.recordBBox(e,this.ctx,p[4],p[4]+d.canvas.width,p[5],p[5]+d.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const r=this.ctx,i=this.current.fillColor,s=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,Ws.transformAndFill);for(const o of t){const{data:a,width:l,height:c,transform:d}=o,h=this.cachedCanvases.getCanvas("maskCanvas",l,c),f=h.context;f.save();const p=this.getObject(e,a,o);gE(f,p),f.globalCompositeOperation="source-in",f.fillStyle=s?i.getPattern(f,this,sa(r),ai.FILL,e):i,f.fillRect(0,0,l,c),f.restore(),r.save(),r.transform(...d),r.scale(1,-1),Zm(r,h.canvas,0,0,l,c,0,-1,1,1),this.dependencyTracker?.recordBBox(e,r,0,l,0,c),r.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const r=this.getObject(e,t);if(!r){rn("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,r)}paintImageXObjectRepeat(e,t,r,i,s){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){rn("Dependent image isn't ready yet");return}const a=o.width,l=o.height,c=[];for(let d=0,h=s.length;d<h;d+=2)c.push({transform:[r,0,0,i,s[d],s[d+1]],x:0,y:0,w:a,h:l});this.paintInlineImageXObjectGroup(e,o,c)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:r,height:i}=e,s=this.cachedCanvases.getCanvas("inlineImage",r,i),o=s.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",s.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const r=t.width,i=t.height,s=this.ctx;this.save(e);const{filter:o}=s;o!=="none"&&o!==""&&(s.filter="none"),s.scale(1/r,-1/i);let a;if(t.bitmap)a=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)a=t;else{const d=this.cachedCanvases.getCanvas("inlineImage",r,i).context;pE(d,t),a=this.applyTransferMapsToCanvas(d)}const l=this._scaleImage(a,sa(s));s.imageSmoothingEnabled=mE(fr(s),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,s,0,r,-i,0).recordDependencies(e,Ws.imageXObject).recordOperation(e),Zm(s,l.img,0,0,l.paintWidth,l.paintHeight,0,-i,r,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,r){if(!this.contentVisible)return;const i=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const o=t.width,a=t.height,c=this.cachedCanvases.getCanvas("inlineImage",o,a).context;pE(c,t),s=this.applyTransferMapsToCanvas(c)}this.dependencyTracker?.resetBBox(e);for(const o of r)i.save(),i.transform(...o.transform),i.scale(1,-1),Zm(i,s,o.x,o.y,o.w,o.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,i,0,1,-1,0),i.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Ws.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,r){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,r){this.dependencyTracker?.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(r)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,r){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(r);const s=this.ctx;this.pendingClip?(i||(this.pendingClip===vE?s.clip(t,"evenodd"):s.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=fr(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),r=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(r,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:r,c:i,d:s}=this.ctx.getTransform();let o,a;if(r===0&&i===0){const l=Math.abs(t),c=Math.abs(s);if(l===c)if(e===0)o=a=1/l;else{const d=l*e;o=a=d<1?1/d:1}else if(e===0)o=1/l,a=1/c;else{const d=l*e,h=c*e;o=d<1?1/d:1,a=h<1?1/h:1}}else{const l=Math.abs(t*s-r*i),c=Math.hypot(t,r),d=Math.hypot(i,s);if(e===0)o=d/l,a=c/l;else{const h=e*l;o=d>h?d/h:1,a=c>h?c/h:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:r,current:{lineWidth:i}}=this,[s,o]=this.getScaleForStroking();if(s===o){r.lineWidth=(i||1)*s,r.stroke(e);return}const a=r.getLineDash();t&&r.save(),r.scale(s,o),qw.a=1/s,qw.d=1/o;const l=new Path2D;if(l.addPath(e,qw),a.length>0){const c=Math.max(s,o);r.setLineDash(a.map(d=>d/c)),r.lineDashOffset/=c}r.lineWidth=i||1,r.stroke(l),t&&r.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const n in eg)ih.prototype[n]!==void 0&&(ih.prototype[eg[n]]=ih.prototype[n]);class ac{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class Wte{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const Ad=Symbol("INTERNAL");class Xte{#e=!1;#t=!1;#r=!1;#n=!0;constructor(e,{name:t,intent:r,usage:i,rbGroups:s}){this.#e=!!(e&Os.DISPLAY),this.#t=!!(e&Os.PRINT),this.name=t,this.intent=r,this.usage=i,this.rbGroups=s}get visible(){if(this.#r)return this.#n;if(!this.#n)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,r=!1){e!==Ad&&Jn("Internal method `_setVisible` called."),this.#r=r,this.#n=t}}class Yte{#e=null;#t=new Map;#r=null;#n=null;constructor(e,t=Os.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#n=e.order;for(const r of e.groups)this.#t.set(r.id,new Xte(t,r));if(e.baseState==="OFF")for(const r of this.#t.values())r._setVisible(Ad,!1);for(const r of e.on)this.#t.get(r)._setVisible(Ad,!0);for(const r of e.off)this.#t.get(r)._setVisible(Ad,!1);this.#r=this.getHash()}}#s(e){const t=e.length;if(t<2)return!0;const r=e[0];for(let i=1;i<t;i++){const s=e[i];let o;if(Array.isArray(s))o=this.#s(s);else if(this.#t.has(s))o=this.#t.get(s).visible;else return rn(`Optional content group not found: ${s}`),!0;switch(r){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return r==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return wb("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(rn(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#s(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return rn(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return rn(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return rn(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return rn(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return rn(`Unknown optional content policy ${e.policy}.`),!0}return rn(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,r=!0){const i=this.#t.get(e);if(!i){rn(`Optional content group not found: ${e}`);return}if(r&&t&&i.rbGroups.length)for(const s of i.rbGroups)for(const o of s)o!==e&&this.#t.get(o)?._setVisible(Ad,!1,!0);i._setVisible(Ad,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let r;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":r=i;continue}const s=this.#t.get(i);if(s)switch(r){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!s.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#r===null||this.getHash()===this.#r}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new vQ;for(const[t,r]of this.#t)e.update(`${t}:${r.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class Gte{constructor(e,{disableRange:t=!1,disableStream:r=!1}){_n(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:s,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,s?.length>0){const l=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!r,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const r=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{const i=this._rangeReaders.some(function(s){return s._begin!==e?!1:(s._enqueue(r),!0)});_n(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){_n(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Kte(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new Jte(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class Kte{constructor(e,t,r=!1,i=null){this._stream=e,this._done=r||!1,this._filename=FS(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Jte{constructor(e,t,r){this._stream=e,this._begin=t,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function ene(n){let e=!0,t=r("filename\\*","i").exec(n);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=c(d),s(d)}if(t=o(n),t){const d=c(t);return s(d)}if(t=r("filename","i").exec(n),t){t=t[1];let d=a(t);return d=c(d),s(d)}function r(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function i(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const f=new TextDecoder(d,{fatal:!0}),p=Yg(h);h=f.decode(p),e=!1}catch{}}return h}function s(d){return e&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),e&&(d=i("iso-8859-1",d))),d}function o(d){const h=[];let f;const p=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(d))!==null;){let[,m,v,y]=f;if(m=parseInt(m,10),m in h){if(m===0)break;continue}h[m]=[v,y]}const g=[];for(let m=0;m<h.length&&m in h;++m){let[v,y]=h[m];y=a(y),v&&(y=unescape(y),m===0&&(y=l(y))),g.push(y)}return g.join("")}function a(d){if(d.startsWith('"')){const h=d.slice(1).split('\\"');for(let f=0;f<h.length;++f){const p=h[f].indexOf('"');p!==-1&&(h[f]=h[f].slice(0,p),h.length=f+1),h[f]=h[f].replaceAll(/\\(.)/g,"$1")}d=h.join('"')}return d}function l(d){const h=d.indexOf("'");if(h===-1)return d;const f=d.slice(0,h),g=d.slice(h+1).replace(/^[^']*'/,"");return i(f,g)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,f,p,g){if(p==="q"||p==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(m,v){return String.fromCharCode(parseInt(v,16))}),i(f,g);try{g=atob(g)}catch{}return i(f,g)})}return""}function kQ(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const r in e){const i=e[r];i!==void 0&&t.append(r,i)}return t}function xb(n){return URL.parse(n)?.origin??null}function SQ({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:r}){const i={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(n.get("Content-Length"),10);return!Number.isInteger(s)||(i.suggestedLength=s,s<=2*t)||r||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function TQ(n){const e=n.get("Content-Disposition");if(e){let t=ene(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(FS(t))return t}return null}function tm(n,e){return new Ny(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n,n===404||n===0&&e.startsWith("file:"))}function AQ(n){return n===200||n===206}function CQ(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function EQ(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(rn(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class tne{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=kQ(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return _n(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new nne(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new rne(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class nne{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const r=new Headers(e.headers),i=t.url;fetch(i,CQ(r,this._withCredentials,this._abortController)).then(s=>{if(e._responseOrigin=xb(s.url),!AQ(s.status))throw tm(s.status,i);this._reader=s.body.getReader(),this._headersCapability.resolve();const o=s.headers,{allowRangeRequests:a,suggestedLength:l}=SQ({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=TQ(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new yc("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:EQ(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class rne{constructor(e,t,r){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const s=new Headers(e.headers);s.append("Range",`bytes=${t}-${r-1}`);const o=i.url;fetch(o,CQ(s,this._withCredentials,this._abortController)).then(a=>{const l=xb(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!AQ(a.status))throw tm(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:EQ(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const Hw=200,Zw=206;function ine(n){const e=n.response;return typeof e!="string"?e:Yg(e).buffer}class sne{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:r}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=kQ(this.isHttp,t),this.withCredentials=r||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,r=this.currXhrId++,i=this.pendingRequests[r]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[s,o]of this.headers)t.setRequestHeader(s,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=Zw):i.expectedStatus=Hw,t.responseType="arraybuffer",_n(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,r),t.onprogress=this.onProgress.bind(this,r),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),r}onProgress(e,t){const r=this.pendingRequests[e];r&&r.onProgress?.(t)}onStateChange(e,t){const r=this.pendingRequests[e];if(!r)return;const i=r.xhr;if(i.readyState>=2&&r.onHeadersReceived&&(r.onHeadersReceived(),delete r.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){r.onError(i.status);return}const s=i.status||Hw;if(!(s===Hw&&r.expectedStatus===Zw)&&s!==r.expectedStatus){r.onError(i.status);return}const a=ine(i);if(s===Zw){const l=i.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?r.onDone({begin:parseInt(c[1],10),chunk:a}):(rn('Missing or invalid "Content-Range" header.'),r.onError(0))}else a?r.onDone({begin:0,chunk:a}):r.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class one{constructor(e){this._source=e,this._manager=new sne(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return _n(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ane(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const r=new lne(this._manager,e,t);return r.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class ane{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=xb(t.responseURL);const r=t.getAllResponseHeaders(),i=new Headers(r?r.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:o}=SQ({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=TQ(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=tm(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class lne{constructor(e,t,r){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:r,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=xb(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=tm(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const cne=/^[a-z][a-z0-9\-+.]+:/i;function une(n){if(cne.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class dne{constructor(e){this.source=e,this.url=une(e.url),_n(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return _n(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new hne(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new fne(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class hne{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const r=process.getBuiltinModule("fs");r.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(r.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=tm(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new yc("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class fne{constructor(e,t,r){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:r-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const xf=Symbol("INITIAL_DATA");class PQ{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:xf}}get(e,t=null){if(t){const i=this.#t(e);return i.promise.then(()=>t(i.data)),null}const r=this.#e[e];if(!r||r.data===xf)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return r.data}has(e){const t=this.#e[e];return!!t&&t.data!==xf}delete(e){const t=this.#e[e];return!t||t.data===xf?!1:(delete this.#e[e],!0)}resolve(e,t=null){const r=this.#t(e);r.data=t,r.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==xf&&(yield[e,t])}}}const pne=1e5,yE=30;class bi{#e=Promise.withResolvers();#t=null;#r=!1;#n=!!globalThis.FontInspector?.enabled;#s=null;#i=null;#o=0;#a=0;#l=null;#c=null;#h=0;#u=0;#p=Object.create(null);#m=[];#f=null;#d=[];#g=new WeakMap;#y=null;static#b=new Map;static#v=new Map;static#k=new WeakMap;static#x=null;static#_=new Set;constructor({textContentSource:e,container:t,viewport:r}){if(e instanceof ReadableStream)this.#f=e;else if(typeof e=="object")this.#f=new ReadableStream({start(l){l.enqueue(e),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#c=t,this.#u=r.scale*za.pixelRatio,this.#h=r.rotation,this.#i={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:s,pageX:o,pageY:a}=r.rawDims;this.#y=[1,0,0,-1,-o,a+s],this.#a=i,this.#o=s,bi.#E(),Su(t,r),this.#e.promise.finally(()=>{bi.#_.delete(this),this.#i=null,this.#p=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=hi.platform;return an(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#l.read().then(({value:t,done:r})=>{if(r){this.#e.resolve();return}this.#s??=t.lang,Object.assign(this.#p,t.styles),this.#A(t.items),e()},this.#e.reject)};return this.#l=this.#f.getReader(),bi.#_.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const r=e.scale*za.pixelRatio,i=e.rotation;if(i!==this.#h&&(t?.(),this.#h=i,Su(this.#c,{rotation:i})),r!==this.#u){t?.(),this.#u=r;const s={div:null,properties:null,ctx:bi.#P(this.#s)};for(const o of this.#d)s.properties=this.#g.get(o),s.div=o,this.#S(s)}}cancel(){const e=new yc("TextLayer task cancelled.");this.#l?.cancel(e).catch(()=>{}),this.#l=null,this.#e.reject(e)}get textDivs(){return this.#d}get textContentItemsStr(){return this.#m}#A(e){if(this.#r)return;this.#i.ctx??=bi.#P(this.#s);const t=this.#d,r=this.#m;for(const i of e){if(t.length>pne){rn("Ignoring additional textDivs for performance reasons."),this.#r=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const s=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),i.id&&this.#t.setAttribute("id",`${i.id}`),s.append(this.#t)}else i.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}r.push(i.str),this.#w(i)}}#w(e){const t=document.createElement("span"),r={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#d.push(t);const i=Dt.transform(this.#y,e.transform);let s=Math.atan2(i[1],i[0]);const o=this.#p[e.fontName];o.vertical&&(s+=Math.PI/2);let a=this.#n&&o.fontSubstitution||o.fontFamily;a=bi.fontFamilyMap.get(a)||a;const l=Math.hypot(i[2],i[3]),c=l*bi.#Q(a,o,this.#s);let d,h;s===0?(d=i[4],h=i[5]-c):(d=i[4]+c*Math.sin(s),h=i[5]-c*Math.cos(s));const f="calc(var(--total-scale-factor) *",p=t.style;this.#t===this.#c?(p.left=`${(100*d/this.#a).toFixed(2)}%`,p.top=`${(100*h/this.#o).toFixed(2)}%`):(p.left=`${f}${d.toFixed(2)}px)`,p.top=`${f}${h.toFixed(2)}px)`),p.fontSize=`${f}${(bi.#x*l).toFixed(2)}px)`,p.fontFamily=a,r.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#n&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),s!==0&&(r.angle=s*(180/Math.PI));let g=!1;if(e.str.length>1)g=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const m=Math.abs(e.transform[0]),v=Math.abs(e.transform[3]);m!==v&&Math.max(m,v)/Math.min(m,v)>1.5&&(g=!0)}if(g&&(r.canvasWidth=o.vertical?e.height:e.width),this.#g.set(t,r),this.#i.div=t,this.#i.properties=r,this.#S(this.#i),r.hasText&&this.#t.append(t),r.hasEOL){const m=document.createElement("br");m.setAttribute("role","presentation"),this.#t.append(m)}}#S(e){const{div:t,properties:r,ctx:i}=e,{style:s}=t;let o="";if(bi.#x>1&&(o=`scale(${1/bi.#x})`),r.canvasWidth!==0&&r.hasText){const{fontFamily:a}=s,{canvasWidth:l,fontSize:c}=r;bi.#C(i,c*this.#u,a);const{width:d}=i.measureText(t.textContent);d>0&&(o=`scaleX(${l*this.#u/d}) ${o}`)}r.angle!==0&&(o=`rotate(${r.angle}deg) ${o}`),o.length>0&&(s.transform=o)}static cleanup(){if(!(this.#_.size>0)){this.#b.clear();for(const{canvas:e}of this.#v.values())e.remove();this.#v.clear()}}static#P(e=null){let t=this.#v.get(e||="");if(!t){const r=document.createElement("canvas");r.className="hiddenCanvasElement",r.lang=e,document.body.append(r),t=r.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#v.set(e,t),this.#k.set(t,{size:0,family:""})}return t}static#C(e,t,r){const i=this.#k.get(e);t===i.size&&r===i.family||(e.font=`${t}px ${r}`,i.size=t,i.family=r)}static#E(){if(this.#x!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#x=e.getBoundingClientRect().height,e.remove()}static#Q(e,t,r){const i=this.#b.get(e);if(i)return i;const s=this.#P(r);s.canvas.width=s.canvas.height=yE,this.#C(s,yE,e);const o=s.measureText(""),a=o.fontBoundingBoxAscent,l=Math.abs(o.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let c=.8;return a?c=a/(a+l):(hi.platform.isFirefox&&rn("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?c=t.ascent:t.descent&&(c=1+t.descent)),this.#b.set(e,c),c}}const gne=100;function kb(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new HS,{docId:t}=e,r=n.url?Ote(n.url):null,i=n.data?xte(n.data):null,s=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,l=n.range instanceof IQ?n.range:null,c=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:2**16;let d=n.worker instanceof ri?n.worker:null;const h=n.verbosity,f=typeof n.docBaseUrl=="string"&&!_b(n.docBaseUrl)?n.docBaseUrl:null,p=jm(n.cMapUrl),g=n.cMapPacked!==!1,m=n.CMapReaderFactory||(Mi?Ite:iE),v=jm(n.iccUrl),y=jm(n.standardFontDataUrl),O=n.StandardFontDataFactory||(Mi?Mte:sE),_=jm(n.wasmUrl),x=n.WasmFactory||(Mi?Rte:oE),k=n.stopAtErrors!==!0,S=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,E=n.isEvalSupported!==!1,R=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!Mi,C=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!Mi&&(hi.platform.isFirefox||!globalThis.chrome),I=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,D=typeof n.disableFontFace=="boolean"?n.disableFontFace:Mi,Q=n.fontExtraProperties===!0,M=n.enableXfa===!0,N=n.ownerDocument||globalThis.document,B=n.disableRange===!0,H=n.disableStream===!0,F=n.disableAutoFetch===!0,Z=n.pdfBug===!0,$=n.CanvasFactory||(Mi?Pte:Ate),W=n.FilterFactory||(Mi?Ete:Cte),G=n.enableHWA===!0,L=n.useWasm!==!1,q=l?l.length:n.length??NaN,ue=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!Mi&&!D,oe=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:!!(m===iE&&O===sE&&x===oE&&p&&y&&_&&tp(p,document.baseURI)&&tp(y,document.baseURI)&&tp(_,document.baseURI)),fe=null;Yee(h);const be={canvasFactory:new $({ownerDocument:N,enableHWA:G}),filterFactory:new W({docId:t,ownerDocument:N}),cMapReaderFactory:oe?null:new m({baseUrl:p,isCompressed:g}),standardFontDataFactory:oe?null:new O({baseUrl:y}),wasmFactory:oe?null:new x({baseUrl:_})};d||(d=ri.create({verbosity:h,port:ac.workerPort}),e._worker=d);const De={docId:t,apiVersion:"5.4.394",data:i,password:a,disableAutoFetch:F,rangeChunkSize:c,length:q,docBaseUrl:f,enableXfa:M,evaluatorOptions:{maxImageSize:S,disableFontFace:D,ignoreErrors:k,isEvalSupported:E,isOffscreenCanvasSupported:R,isImageDecoderSupported:C,canvasMaxAreaInBytes:I,fontExtraProperties:Q,useSystemFonts:ue,useWasm:L,useWorkerFetch:oe,cMapUrl:p,iccUrl:v,standardFontDataUrl:y,wasmUrl:_}},Le={ownerDocument:N,pdfBug:Z,styleElement:fe,loadingParams:{disableAutoFetch:F,enableXfa:M}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const he=d.messageHandler.sendWithPromise("GetDocRequest",De,i?[i.buffer]:null);let se;if(l)se=new Gte(l,{disableRange:B,disableStream:H});else if(!i){if(!r)throw new Error("getDocument - no `url` parameter provided.");const V=tp(r)?tne:Mi?dne:one;se=new V({url:r,length:q,httpHeaders:s,withCredentials:o,rangeChunkSize:c,disableRange:B,disableStream:H})}return he.then(V=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const ne=new np(t,V,d.port),ee=new yne(ne,e,se,Le,be,G);e._transport=ee,ne.send("Ready",null)})}).catch(e._capability.reject),e}class HS{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${HS.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class IQ{#e=Promise.withResolvers();#t=[];#r=[];#n=[];#s=[];constructor(e,t,r=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=r,this.contentDispositionFilename=i}addRangeListener(e){this.#s.push(e)}addProgressListener(e){this.#n.push(e)}addProgressiveReadListener(e){this.#r.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const r of this.#s)r(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const r of this.#n)r(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#r)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){Jn("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class mne{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return an(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class vne{#e=!1;constructor(e,t,r,i=!1){this._pageIndex=e,this._pageInfo=t,this._transport=r,this._stats=i?new GC:null,this._pdfBug=i,this.commonObjs=r.commonObjs,this.objs=new PQ,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:r=0,offsetY:i=0,dontFlip:s=!1}={}){return new Kg({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:r,offsetY:i,dontFlip:s})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return an(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:r,intent:i="display",annotationMode:s=Wl.ENABLE,transform:o=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:d=null,printAnnotationStorage:h=null,isEditing:f=!1,recordOperations:p=!1,operationsFilter:g=null}){this._stats?.time("Overall");const m=this._transport.getRenderingIntent(i,s,h,f),{renderingIntent:v,cacheKey:y}=m;this.#e=!1,l||=this._transport.getOptionalContentConfig(v);let O=this._intentStates.get(y);O||(O=Object.create(null),this._intentStates.set(y,O)),O.streamReaderCancelTimeout&&(clearTimeout(O.streamReaderCancelTimeout),O.streamReaderCancelTimeout=null);const _=!!(v&Os.PRINT);O.displayReadyCapability||(O.displayReadyCapability=Promise.withResolvers(),O.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(m));const x=!!(this._pdfBug&&globalThis.StepperManager?.enabled),k=!this.recordedBBoxes&&(p||x),S=C=>{if(O.renderTasks.delete(E),k){const I=E.gfx?.dependencyTracker.take();I&&(E.stepper&&E.stepper.setOperatorBBoxes(I,E.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=I))}_&&(this.#e=!0),this.#t(),C?(E.capability.reject(C),this._abortOperatorList({intentState:O,reason:C instanceof Error?C:new Error(C)})):E.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},E=new Ud({callback:S,params:{canvas:t,canvasContext:e,dependencyTracker:k?new Nte(t,O.operatorList.length,x):null,viewport:r,transform:o,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:O.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:d,enableHWA:this._transport.enableHWA,operationsFilter:g});(O.renderTasks||=new Set).add(E);const R=E.task;return Promise.all([O.displayReadyCapability.promise,l]).then(([C,I])=>{if(this.destroyed){S();return}if(this._stats?.time("Rendering"),!(I.renderingIntent&v))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");E.initializeGraphics({transparency:C,optionalContentConfig:I}),E.operatorListChanged()}).catch(S),R}getOperatorList({intent:e="display",annotationMode:t=Wl.ENABLE,printAnnotationStorage:r=null,isEditing:i=!1}={}){function s(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const o=this._transport.getRenderingIntent(e,t,r,i,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=s,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(r=>tg.textContent(r));const t=this.streamTextContent(e);return new Promise(function(r,i){function s(){o.read().then(function({value:l,done:c}){if(c){r(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),s()},i)}const o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const r of t.renderTasks)e.push(r.completed),r.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#t();return e&&t&&(this._stats&&=new GC),t}#t(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const r=this._intentStates.get(t);r&&(this._stats?.timeEnd("Page Request"),r.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let r=0,i=e.length;r<i;r++)t.operatorList.fnArray.push(e.fnArray[r]),t.operatorList.argsArray.push(e.argsArray[r]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const r of t.renderTasks)r.operatorListChanged();e.lastChunk&&this.#t()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:r,modifiedIds:i}){const{map:s,transfer:o}=r,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s,modifiedIds:i},o).getReader(),c=this._intentStates.get(t);c.streamReader=l;const d=()=>{l.read().then(({value:h,done:f})=>{if(f){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),d())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const f of c.renderTasks)f.operatorListChanged();this.#t()}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};d()}_abortOperatorList({intentState:e,reason:t,force:r=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!r){if(e.renderTasks.size>0)return;if(t instanceof $S){let i=gne;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new yc(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,s]of this._intentStates)if(s===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}class ri{#e=Promise.withResolvers();#t=null;#r=null;#n=null;static#s=0;static#i=!1;static#o=new WeakMap;static{Mi&&(this.#i=!0,ac.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(e,t)=>{const r=URL.parse(e);if(!r?.origin||r.origin==="null")return!1;const i=new URL(t,r);return r.origin===i.origin},this._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},this.fromPort=e=>{if(cte("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.create(e)}}constructor({name:e=null,port:t=null,verbosity:r=Gee()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=r,t){if(ri.#o.has(t))throw new Error("Cannot use more than one PDFWorker per port.");ri.#o.set(t,this),this.#l(t)}else this.#c()}get promise(){return this.#e.promise}#a(){this.#e.resolve(),this.#t.send("configure",{verbosity:this.verbosity})}get port(){return this.#r}get messageHandler(){return this.#t}#l(e){this.#r=e,this.#t=new np("main","worker",e),this.#t.on("ready",()=>{}),this.#a()}#c(){if(ri.#i||ri.#u){this.#h();return}let{workerSrc:e}=ri;try{ri._isSameOrigin(window.location,e)||(e=ri._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),r=new np("main","worker",t),i=()=>{s.abort(),r.destroy(),t.terminate(),this.destroyed?this.#e.reject(new Error("Worker was destroyed")):this.#h()},s=new AbortController;t.addEventListener("error",()=>{this.#n||i()},{signal:s.signal}),r.on("test",a=>{if(s.abort(),this.destroyed||!a){i();return}this.#t=r,this.#r=t,this.#n=t,this.#a()}),r.on("ready",a=>{if(s.abort(),this.destroyed){i();return}try{o()}catch{this.#h()}});const o=()=>{const a=new Uint8Array;r.send("test",a,[a.buffer])};o();return}catch{wb("The worker has been disabled.")}this.#h()}#h(){ri.#i||(rn("Setting up fake worker."),ri.#i=!0),ri._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this.#e.reject(new Error("Worker was destroyed"));return}const t=new Tte;this.#r=t;const r=`fake${ri.#s++}`,i=new np(r+"_worker",r,t);e.setup(i,t),this.#t=new np(r,r+"_worker",t),this.#a()}).catch(e=>{this.#e.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this.#n?.terminate(),this.#n=null,ri.#o.delete(this.#r),this.#r=null,this.#t?.destroy(),this.#t=null}static create(e){const t=this.#o.get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new ri(e)}static get workerSrc(){if(ac.workerSrc)return ac.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#u(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return an(this,"_setupFakeWorkerGlobal",(async()=>this.#u?this.#u:(await import(this.workerSrc)).WorkerMessageHandler)())}}class yne{#e=new Map;#t=new Map;#r=new Map;#n=new Map;#s=null;constructor(e,t,r,i,s,o){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PQ,this.fontLoader=new wte({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}#i(e,t=null){const r=this.#e.get(e);if(r)return r;const i=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,i),i}get annotationStorage(){return an(this,"annotationStorage",new US)}getRenderingIntent(e,t=Wl.ENABLE,r=null,i=!1,s=!1){let o=Os.DISPLAY,a=IO;switch(e){case"any":o=Os.ANY;break;case"display":break;case"print":o=Os.PRINT;break;default:rn(`getRenderingIntent - invalid intent: ${e}`)}const l=o&Os.PRINT&&r instanceof yQ?r:this.annotationStorage;switch(t){case Wl.DISABLE:o+=Os.ANNOTATIONS_DISABLE;break;case Wl.ENABLE:break;case Wl.ENABLE_FORMS:o+=Os.ANNOTATIONS_FORMS;break;case Wl.ENABLE_STORAGE:o+=Os.ANNOTATIONS_STORAGE,a=l.serializable;break;default:rn(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=Os.IS_EDITING),s&&(o+=Os.OPLIST);const{ids:c,hash:d}=l.modifiedIds,h=[o,a.hash,d];return{renderingIntent:o,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#s?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of this.#t.values())e.push(r._destroy());this.#t.clear(),this.#r.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),bi.cleanup(),this._networkStream?.cancelAllRequests(new yc("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(r,i)=>{_n(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},i.onPull=()=>{this._fullReader.read().then(function({value:s,done:o}){if(o){i.close();return}_n(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{i.error(s)})},i.onCancel=s=>{this._fullReader.cancel(s),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async r=>{await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:s,contentLength:o}=this._fullReader;return(!i||!s)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{t.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:i,isRangeSupported:s,contentLength:o}}),e.on("GetRangeReader",(r,i)=>{_n(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(r.begin,r.end);if(!s){i.close();return}i.onPull=()=>{s.read().then(function({value:o,done:a}){if(a){i.close();return}_n(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{s.cancel(o),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:r})=>{this._numPages=r.numPages,this._htmlForXfa=r.htmlForXfa,delete r.htmlForXfa,t._capability.resolve(new mne(r,this))}),e.on("DocException",r=>{t._capability.reject(Xi(r))}),e.on("PasswordRequest",r=>{this.#s=Promise.withResolvers();try{if(!t.onPassword)throw Xi(r);const i=s=>{s instanceof Error?this.#s.reject(s):this.#s.resolve({password:s})};t.onPassword(i,r.code)}catch(i){this.#s.reject(i)}return this.#s.promise}),e.on("DataLoaded",r=>{t.onProgress?.({loaded:r.length,total:r.length}),this.downloadInfoCapability.resolve(r)}),e.on("StartRenderPage",r=>{if(this.destroyed)return;this.#t.get(r.pageIndex)._startRenderPage(r.transparency,r.cacheKey)}),e.on("commonobj",([r,i,s])=>{if(this.destroyed||this.commonObjs.has(r))return null;switch(i){case"Font":if("error"in s){const h=s.error;rn(`Error during font loading: ${h}`),this.commonObjs.resolve(r,h);break}const o=new Hn(s),a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(h,f)=>globalThis.FontInspector.fontAdded(h,f):null,l=new _te(o,a,s.extra,s.charProcOperatorList);this.fontLoader.bind(l).catch(()=>e.sendWithPromise("FontFallback",{id:r})).finally(()=>{!l.fontExtraProperties&&l.data&&l.clearData(),this.commonObjs.resolve(r,l)});break;case"CopyLocalImage":const{imageRef:c}=s;_n(c,"The imageRef must be defined.");for(const h of this.#t.values())for(const[,f]of h.objs)if(f?.ref===c)return f.dataLen?(this.commonObjs.resolve(r,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(r,s);break;case"Pattern":const d=new Wr(s);this.commonObjs.resolve(r,d.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([r,i,s,o])=>{if(this.destroyed)return;const a=this.#t.get(i);if(!a.objs.has(r)){if(a._intentStates.size===0){o?.bitmap?.close();return}switch(s){case"Image":case"Pattern":a.objs.resolve(r,o);break;default:throw new Error(`Got unknown object type ${s}`)}}}),e.on("DocProgress",r=>{this.destroyed||t.onProgress?.({loaded:r.loaded,total:r.total})}),e.on("FetchBinaryData",async r=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[r.type];if(!i)throw new Error(`${r.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(r)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&rn("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,r=this.#r.get(t);if(r)return r;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&this.#n.set(s.refStr,e);const o=new vne(t,s,this,this._params.pdfBug);return this.#t.set(t,o),o});return this.#r.set(t,i),i}getPageIndex(e){return MO(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#i("GetFieldObjects")}hasJSActions(){return this.#i("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#i("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#i("GetOptionalContentConfig").then(t=>new Yte(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const r=this.messageHandler.sendWithPromise(e,null).then(i=>({info:i[0],metadata:i[1]?new Wte(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,r),r}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),bi.cleanup()}}cachedPageNumber(e){if(!MO(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#n.get(t)??null}}class bne{#e=null;onContinue=null;onError=null;constructor(e){this.#e=e}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class Ud{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:r,commonObjs:i,annotationCanvasMap:s,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:f=null,enableHWA:p=!1,operationsFilter:g=null}){this.callback=e,this.params=t,this.objs=r,this.commonObjs=i,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new bne(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=p,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=g}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(Ud.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ud.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:r,transform:i,background:s,dependencyTracker:o}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new ih(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:i,viewport:r,transparency:e,background:s}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),Ud.#t.delete(this._canvas),e||=new $S(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ud.#t.delete(this._canvas),this.callback())))}}const wne="5.4.394",_ne="2cc809ade";class Js{#e=null;#t=null;#r;#n=null;#s=!1;#i=!1;#o=null;#a;#l=null;#c=null;static#h=null;static get _keyboardManager(){return an(this,"_keyboardManager",new em([[["Escape","mac+Escape"],Js.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Js.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Js.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Js.prototype._moveToPrevious],[["Home","mac+Home"],Js.prototype._moveToBeginning],[["End","mac+End"],Js.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#i=!1,this.#o=e):this.#i=!0,this.#c=e?._uiManager||t,this.#a=this.#c._eventBus,this.#r=e?.color?.toUpperCase()||this.#c?.highlightColors.values().next().value||"#FFFF98",Js.#h||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#o&&(e.ariaControls=`${this.#o.id}_colorpicker_dropdown`);const t=this.#c._signal;e.addEventListener("click",this.#f.bind(this),{signal:t}),e.addEventListener("keydown",this.#m.bind(this),{signal:t});const r=this.#t=document.createElement("span");return r.className="swatch",r.ariaHidden="true",r.style.backgroundColor=this.#r,e.append(r),e}renderMainDropdown(){const e=this.#n=this.#u();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#u(){const e=document.createElement("div"),t=this.#c._signal;e.addEventListener("contextmenu",bo,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#o&&(e.id=`${this.#o.id}_colorpicker_dropdown`);for(const[r,i]of this.#c.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",i),s.title=r,s.setAttribute("data-l10n-id",Js.#h[r]);const o=document.createElement("span");s.append(o),o.className="swatch",o.style.backgroundColor=i,s.ariaSelected=i===this.#r,s.addEventListener("click",this.#p.bind(this,i),{signal:t}),e.append(s)}return e.addEventListener("keydown",this.#m.bind(this),{signal:t}),e}#p(e,t){t.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:wn.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#f(e);return}const t=e.target.getAttribute("data-color");t&&this.#p(t,e)}_moveToNext(e){if(!this.#g){this.#f(e);return}if(e.target===this.#e){this.#n.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#n?.firstChild||e.target===this.#e){this.#g&&this._hideDropdownFromKeyboard();return}this.#g||this.#f(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#g){this.#f(e);return}this.#n.firstChild?.focus()}_moveToEnd(e){if(!this.#g){this.#f(e);return}this.#n.lastChild?.focus()}#m(e){Js._keyboardManager.exec(this,e)}#f(e){if(this.#g){this.hideDropdown();return}if(this.#s=e.detail===0,this.#l||(this.#l=new AbortController,window.addEventListener("pointerdown",this.#d.bind(this),{signal:this.#c.combinedSignal(this.#l)})),this.#e.ariaExpanded="true",this.#n){this.#n.classList.remove("hidden");return}const t=this.#n=this.#u();this.#e.append(t)}#d(e){this.#n?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#l?.abort(),this.#l=null}get#g(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#i){if(!this.#g){this.#o?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#s})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#n)return;const t=this.#c.highlightColors.values();for(const r of this.#n.children)r.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#n?.remove(),this.#n=null}}class ng{#e=null;#t=null;#r=null;static#n=null;constructor(e){this.#t=e,this.#r=e._uiManager,ng.#n||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#e)return this.#e;const{editorType:e,colorType:t,color:r}=this.#t,i=this.#e=document.createElement("input");return i.type="color",i.value=r||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",ng.#n[e]),i.addEventListener("input",()=>{this.#r.updateParams(t,i.value)},{signal:this.#r._signal}),i}update(e){this.#e&&(this.#e.value=e)}destroy(){this.#e?.remove(),this.#e=null}hideDropdown(){}}function bE(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function kf(n){return Math.max(0,Math.min(255,255*n))}class wE{static CMYK_G([e,t,r,i]){return["G",1-Math.min(1,.3*e+.59*r+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=kf(e),[e,e,e]}static G_HTML([e]){const t=bE(e);return`#${t}${t}${t}`}static RGB_G([e,t,r]){return["G",.3*e+.59*t+.11*r]}static RGB_rgb(e){return e.map(kf)}static RGB_HTML(e){return`#${e.map(bE).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,r,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,r+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,r,i]){return[kf(1-Math.min(1,e+i)),kf(1-Math.min(1,r+i)),kf(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,r]){const i=1-e,s=1-t,o=1-r,a=Math.min(i,s,o);return["CMYK",i,s,o,a]}}class One{create(e,t,r=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),r||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Jn("Abstract method `_createSVG` called.")}}class Qy extends One{_createSVG(e){return document.createElementNS(tl,e)}}const xne=9,Tu=new WeakSet,kne=new Date().getTimezoneOffset()*60*1e3;class Ww{static create(e){switch(e.data.annotationType){case Pr.LINK:return new ZS(e);case Pr.TEXT:return new Tne(e);case Pr.WIDGET:switch(e.data.fieldType){case"Tx":return new Ane(e);case"Btn":return e.data.radioButton?new MQ(e):e.data.checkBox?new Ene(e):new Pne(e);case"Ch":return new Ine(e);case"Sig":return new Cne(e)}return new Wu(e);case Pr.POPUP:return new NO(e);case Pr.FREETEXT:return new RQ(e);case Pr.LINE:return new Rne(e);case Pr.SQUARE:return new Dne(e);case Pr.CIRCLE:return new Nne(e);case Pr.POLYLINE:return new DQ(e);case Pr.CARET:return new Qne(e);case Pr.INK:return new WS(e);case Pr.POLYGON:return new Lne(e);case Pr.HIGHLIGHT:return new NQ(e);case Pr.UNDERLINE:return new $ne(e);case Pr.SQUIGGLY:return new Fne(e);case Pr.STRIKEOUT:return new zne(e);case Pr.STAMP:return new LQ(e);case Pr.FILEATTACHMENT:return new Bne(e);default:return new gr(e)}}}class gr{#e=null;#t=!1;#r=null;constructor(e,{isRenderable:t=!1,ignoreBorder:r=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(r)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return gr._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:r,rect:i}=this.data;let s=-1/0,o=-1/0;if(t?.length>=8){for(let a=0;a<t.length;a+=8)t[a+1]>o?(o=t[a+1],s=t[a+2]):t[a+1]===o&&(s=Math.max(s,t[a+2]));return[s,o]}if(r?.length>=1){for(const a of r)for(let l=0,c=a.length;l<c;l+=2)a[l+1]>o?(o=a[l+1],s=a[l]):a[l+1]===o&&(s=Math.max(s,a[l]));if(s!==1/0)return[s,o]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:r,pageHeight:i,pageX:s,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-s)/r,e[1]=100*(e[1]-o)/i,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${Jp}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,r={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:r})||this.annotationStorage.setValue(`${Jp}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:r,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#r?.popup||this.popup)?.remove(),this.#r=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#e||={rect:this.data.rect.slice(0)});const{rect:t,popup:r}=e;t&&this.#n(t);let i=this.#r?.popup||this.popup;!i&&r?.text&&(this._createPopup(r),i=this.#r.popup),i&&(i.updateEdited(e),r?.deleted&&(i.remove(),this.#r=null,this.popup=null))}resetEdited(){this.#e&&(this.#n(this.#e.rect),this.#r?.popup.resetEdited(),this.#e=null)}#n(e){const{container:{style:t},data:{rect:r,rotation:i},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:o,pageX:a,pageY:l}}}}=this;r?.splice(0,4,...e),t.left=`${100*(e[0]-a)/s}%`,t.top=`${100*(o-e[3]+l)/o}%`,i===0?(t.width=`${100*(e[2]-e[0])/s}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(i)}_createContainer(e){const{data:t,parent:{page:r,viewport:i}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),!(this instanceof Wu)&&!(this instanceof ZS)&&(s.tabIndex=0);const{style:o}=s;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof NO){const{rotation:m}=t;return!t.hasOwnCanvas&&m!==0&&this.setRotation(m,s),s}const{width:a,height:l}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const m=t.borderStyle.horizontalCornerRadius,v=t.borderStyle.verticalCornerRadius;if(m>0||v>0){const O=`calc(${m}px * var(--total-scale-factor)) / calc(${v}px * var(--total-scale-factor))`;o.borderRadius=O}else if(this instanceof MQ){const O=`calc(${a}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;o.borderRadius=O}switch(t.borderStyle.style){case Td.SOLID:o.borderStyle="solid";break;case Td.DASHED:o.borderStyle="dashed";break;case Td.BEVELED:rn("Unimplemented border style: beveled");break;case Td.INSET:rn("Unimplemented border style: inset");break;case Td.UNDERLINE:o.borderBottomStyle="solid";break}const y=t.borderColor||null;y?(this.#t=!0,o.borderColor=Dt.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):o.borderWidth=0}const c=Dt.normalizeRect([t.rect[0],r.view[3]-t.rect[1]+r.view[1],t.rect[2],r.view[3]-t.rect[3]+r.view[1]]),{pageWidth:d,pageHeight:h,pageX:f,pageY:p}=i.rawDims;o.left=`${100*(c[0]-f)/d}%`,o.top=`${100*(c[1]-p)/h}%`;const{rotation:g}=t;return t.hasOwnCanvas||g===0?(o.width=`${100*a/d}%`,o.height=`${100*l/h}%`):this.setRotation(g,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:r,pageHeight:i}=this.parent.viewport.rawDims;let{width:s,height:o}=this;e%180!==0&&([s,o]=[o,s]),t.style.width=`${100*s/r}%`,t.style.height=`${100*o/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,r,i)=>{const s=i.detail[t],o=s[0],a=s.slice(1);i.target.style[r]=wE[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[r]:wE[`${o}_rgb`](a)})};return an(this,"_commonActions",{display:t=>{const{display:r}=t.detail,i=r%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:r===1||r===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:r}=t.detail;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:r,noView:r})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const r=t.detail.rotation;this.setRotation(r),this.annotationStorage.setValue(this.data.id,{rotation:r})}})}_dispatchEventFromSandbox(e,t){const r=this._commonActions;for(const i of Object.keys(t.detail))(e[i]||r[i])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const r=this._commonActions;for(const[i,s]of Object.entries(t)){const o=r[i];if(o){const a={detail:{[i]:s},target:e};o(a),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,r,i,s]=this.data.rect.map(m=>Math.fround(m));if(e.length===8){const[m,v,y,O]=e.subarray(2,6);if(i===m&&s===v&&t===y&&r===O)return}const{style:o}=this.container;let a;if(this.#t){const{borderColor:m,borderWidth:v}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${v}">`],this.container.classList.add("hasBorder")}const l=i-t,c=s-r,{svgFactory:d}=this,h=d.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0),h.role="none";const f=d.createElement("defs");h.append(f);const p=d.createElement("clipPath"),g=`clippath_${this.data.id}`;p.setAttribute("id",g),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let m=2,v=e.length;m<v;m+=8){const y=e[m],O=e[m+1],_=e[m+2],x=e[m+3],k=d.createElement("rect"),S=(_-t)/l,E=(s-O)/c,R=(y-_)/l,C=(O-x)/c;k.setAttribute("x",S),k.setAttribute("y",E),k.setAttribute("width",R),k.setAttribute("height",C),p.append(k),a?.push(`<rect vector-effect="non-scaling-stroke" x="${S}" y="${E}" width="${R}" height="${C}"/>`)}this.#t&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${g})`}_createPopup(e=null){const{data:t}=this;let r,i;e?(r={str:e.text},i=e.date):(r=t.contentsObj,i=t.modificationDate),this.#r=new NO({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:r,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#r||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#r}render(){Jn("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const r=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:s,id:o,exportValues:a}of i){if(s===-1||o===t)continue;const l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!Tu.has(c)){rn(`_getElementsByName - element not allowed: ${o}`);continue}r.push({id:o,exportValue:l,domElement:c})}return r}for(const i of document.getElementsByName(e)){const{exportValue:s}=i,o=i.getAttribute("data-element-id");o!==t&&Tu.has(i)&&r.push({id:o,exportValue:s,domElement:i})}return r}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Sne extends gr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class ZS extends gr{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,r=document.createElement("a");r.setAttribute("data-element-id",e.id);let i=!1;return e.url?(t.addLinkAttributes(r,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(r,e.action,e.overlaidText),i=!0):e.attachment?(this.#t(r,e.attachment,e.overlaidText,e.attachmentDest),i=!0):e.setOCGState?(this.#r(r,e.setOCGState,e.overlaidText),i=!0):e.dest?(this._bindLink(r,e.dest,e.overlaidText),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,e),i=!0),e.resetForm?(this._bindResetFormAction(r,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(r,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&(this.contentElement=r,this.container.append(r)),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t,r=""){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e(),r&&(e.title=r)}_bindNamedAction(e,t,r=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),r&&(e.title=r),this.#e()}#t(e,t,r="",i=null){e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:r&&(e.title=r),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,i),!1),this.#e()}#r(e,t,r=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),r&&(e.title=r),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(t.actions)){const s=r.get(i);s&&(e[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:i}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const r=e.onclick;if(r||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){rn('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(e.onclick=()=>!1);return}e.onclick=()=>{r?.();const{fields:i,refs:s,include:o}=t,a=[];if(i.length!==0||s.length!==0){const d=new Set(s);for(const h of i){const f=this._fieldObjects[h]||[];for(const{id:p}of f)d.add(p)}for(const h of Object.values(this._fieldObjects))for(const f of h)d.has(f.id)===o&&a.push(f)}else for(const d of Object.values(this._fieldObjects))a.push(...d);const l=this.annotationStorage,c=[];for(const d of a){const{id:h}=d;switch(c.push(h),d.type){case"text":{const p=d.defaultValue||"";l.setValue(h,{value:p});break}case"checkbox":case"radiobutton":{const p=d.defaultValue===d.exportValues;l.setValue(h,{value:p});break}case"combobox":case"listbox":{const p=d.defaultValue||"";l.setValue(h,{value:p});break}default:continue}const f=document.querySelector(`[data-element-id="${h}"]`);if(f){if(!Tu.has(f)){rn(`_bindResetFormAction - element not allowed: ${h}`);continue}}else continue;f.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}}class Tne extends gr{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class Wu extends gr{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return hi.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,r,i,s){r.includes("mouse")?e.addEventListener(r,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(r,o=>{if(r==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(r==="focus"){if(t.focused)return;t.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(o)}})})}_setEventListeners(e,t,r,i){for(const[s,o]of r)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,s,o,i),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Dt.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:r}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||xne,s=e.style;let o;const a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(zw*i))||1,h=c/d;o=Math.min(i,l(h/zw))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(i,l(c/zw))}s.fontSize=`calc(${o}px * var(--total-scale-factor))`,s.color=Dt.makeHexColor(r[0],r[1],r[2]),this.data.textAlignment!==null&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Ane extends Wu{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,r,i){const s=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=r),s.setValue(o.id,{[i]:r})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let r=null;if(this.renderForms){const i=e.getValue(t,{value:this.data.fieldValue});let s=i.value||"";const o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));let a=i.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const l={userValue:s,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(r=document.createElement("textarea"),r.textContent=a??s,this.data.doNotScroll&&(r.style.overflowY="hidden")):(r=document.createElement("input"),r.type=this.data.password?"password":"text",r.setAttribute("value",a??s),this.data.doNotScroll&&(r.style.overflowX="hidden")),this.data.hasOwnCanvas&&(r.hidden=!0),Tu.add(r),this.contentElement=r,r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,r.name=this.data.fieldName,r.tabIndex=0;const{datetimeFormat:c,datetimeType:d,timeStep:h}=this.data,f=!!d&&this.enableScripting;c&&(r.title=c),this._setRequired(r,this.data.required),o&&(r.maxLength=o),r.addEventListener("input",g=>{e.setValue(t,{value:g.target.value}),this.setPropertyOnSiblings(r,"value",g.target.value,"value"),l.formattedValue=null}),r.addEventListener("resetform",g=>{const m=this.data.defaultFieldValue??"";r.value=l.userValue=m,l.formattedValue=null});let p=g=>{const{formattedValue:m}=l;m!=null&&(g.target.value=m),g.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){r.addEventListener("focus",m=>{if(l.focused)return;const{target:v}=m;if(f&&(v.type=d,h&&(v.step=h)),l.userValue){const y=l.userValue;if(f)if(d==="time"){const O=new Date(y),_=[O.getHours(),O.getMinutes(),O.getSeconds()];v.value=_.map(x=>x.toString().padStart(2,"0")).join(":")}else v.value=new Date(y-kne).toISOString().split(d==="date"?"T":".",1)[0];else v.value=y}l.lastCommittedValue=v.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),r.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);const v={value(y){l.userValue=y.detail.value??"",f||e.setValue(t,{value:l.userValue.toString()}),y.target.value=l.userValue},formattedValue(y){const{formattedValue:O}=y.detail;l.formattedValue=O,O!=null&&y.target!==document.activeElement&&(y.target.value=O);const _={formattedValue:O};f&&(_.value=O),e.setValue(t,_)},selRange(y){y.target.setSelectionRange(...y.detail.selRange)},charLimit:y=>{const{charLimit:O}=y.detail,{target:_}=y;if(O===0){_.removeAttribute("maxLength");return}_.setAttribute("maxLength",O);let x=l.userValue;!x||x.length<=O||(x=x.slice(0,O),_.value=l.userValue=x,e.setValue(t,{value:x}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,willCommit:!0,commitKey:1,selStart:_.selectionStart,selEnd:_.selectionEnd}}))}};this._dispatchEventFromSandbox(v,m)}),r.addEventListener("keydown",m=>{l.commitKey=1;let v=-1;if(m.key==="Escape"?v=0:m.key==="Enter"&&!this.data.multiLine?v=2:m.key==="Tab"&&(l.commitKey=3),v===-1)return;const{value:y}=m.target;l.lastCommittedValue!==y&&(l.lastCommittedValue=y,l.userValue=y,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:v,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});const g=p;p=null,r.addEventListener("blur",m=>{if(!l.focused||!m.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{target:v}=m;let{value:y}=v;if(f){if(y&&d==="time"){const O=y.split(":").map(_=>parseInt(_,10));y=new Date(2e3,0,1,O[0],O[1],O[2]||0).valueOf(),v.step=""}else y.includes("T")||(y=`${y}T00:00`),y=new Date(y).valueOf();v.type="text"}l.userValue=y,l.lastCommittedValue!==y&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:l.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}),g(m)}),this.data.actions?.Keystroke&&r.addEventListener("beforeinput",m=>{l.lastCommittedValue=null;const{data:v,target:y}=m,{value:O,selectionStart:_,selectionEnd:x}=y;let k=_,S=x;switch(m.inputType){case"deleteWordBackward":{const E=O.substring(0,_).match(/\w*[^\w]*$/);E&&(k-=E[0].length);break}case"deleteWordForward":{const E=O.substring(_).match(/^[^\w]*\w*/);E&&(S+=E[0].length);break}case"deleteContentBackward":_===x&&(k-=1);break;case"deleteContentForward":_===x&&(S+=1);break}m.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:O,change:v||"",willCommit:!1,selStart:k,selEnd:S}})}),this._setEventListeners(r,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(p&&r.addEventListener("blur",p),this.data.comb){const m=(this.data.rect[2]-this.data.rect[0])/o;r.classList.add("comb"),r.style.letterSpacing=`calc(${m}px * var(--total-scale-factor) - 1ch)`}}else r=document.createElement("div"),r.textContent=this.data.fieldValue,r.style.verticalAlign="middle",r.style.display="table-cell",this.data.hasOwnCanvas&&(r.hidden=!0);return this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Cne extends Wu{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Ene extends Wu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,r=t.id;let i=e.getValue(r,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(r,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return Tu.add(s),s.setAttribute("data-element-id",r),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=0,s.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const c of this._getElementsByName(a,r)){const d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(r,{value:l})}),s.addEventListener("resetform",o=>{const a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",o=>{const a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(r,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class MQ extends Wu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,r=t.id;let i=e.getValue(r,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(r,{value:i})),i)for(const o of this._getElementsByName(t.fieldName,r))e.setValue(o.id,{value:!1});const s=document.createElement("input");if(Tu.add(s),s.setAttribute("data-element-id",r),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const c of this._getElementsByName(a,r))e.setValue(c.id,{value:!1});e.setValue(r,{value:l})}),s.addEventListener("resetform",o=>{const a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;s.addEventListener("updatefromsandbox",a=>{const l={value:c=>{const d=o===c.detail.value;for(const h of this._getElementsByName(c.target.name)){const f=d&&h.id===r;h.domElement&&(h.domElement.checked=f),e.setValue(h.id,{value:f})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Pne extends ZS{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",r=>{this._dispatchEventFromSandbox({},r)})),e}}class Ine extends Wu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,r=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Tu.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{const h=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===h});for(const d of this.data.options){const h=document.createElement("option");h.textContent=d.displayValue,h.value=d.exportValue,r.value.includes(d.exportValue)&&(h.setAttribute("selected",!0),s=!1),i.append(h)}let o=null;if(s){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),o=()=>{d.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const a=d=>{const h=d?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,g=>g.selected).map(g=>g[h]):f.selectedIndex===-1?null:f[f.selectedIndex][h]};let l=a(!1);const c=d=>{const h=d.target.options;return Array.prototype.map.call(h,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{const h={value(f){o?.();const p=f.detail.value,g=new Set(Array.isArray(p)?p:[p]);for(const m of i.options)m.selected=g.has(m.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(f){i.multiple=!0},remove(f){const p=i.options,g=f.detail.remove;p[g].selected=!1,i.remove(g),p.length>0&&Array.prototype.findIndex.call(p,v=>v.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(f){const{index:p,displayValue:g,exportValue:m}=f.detail.insert,v=i.children[p],y=document.createElement("option");y.textContent=g,y.value=m,v?v.before(y):i.append(y),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},items(f){const{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(const g of p){const{displayValue:m,exportValue:v}=g,y=document.createElement("option");y.textContent=m,y.value=v,i.append(y)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},indices(f){const p=new Set(f.detail.indices);for(const g of f.target.options)g.selected=p.has(g.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(h,d)}),i.addEventListener("input",d=>{const h=a(!0),f=a(!1);e.setValue(t,{value:h}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class NO extends gr{constructor(e){const{data:t,elements:r,parent:i}=e,s=!!i._commentManager;if(super(e,{isRenderable:!s&&gr._hasPopupData(t)}),this.elements=r,s&&gr._hasPopupData(t)){const o=this.popup=this.#e();for(const a of r)a.popup=o}else this.popup=null}#e(){return new Mne({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#e(),r=[];for(const i of this.elements)i.popup=t,i.container.ariaHasPopup="dialog",r.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",r.map(i=>`${zd}${i}`).join(",")),this.container}}class Mne{#e=null;#t=this.#V.bind(this);#r=this.#F.bind(this);#n=this.#R.bind(this);#s=this.#O.bind(this);#i=null;#o=null;#a=null;#l=null;#c=null;#h=null;#u=null;#p=!1;#m=null;#f=null;#d=null;#g=null;#y=null;#b=null;#v=null;#k=null;#x=null;#_=null;#A=!1;#w=null;#S=null;constructor({container:e,color:t,elements:r,titleObj:i,modificationDate:s,contentsObj:o,richText:a,parent:l,rect:c,parentRect:d,open:h,commentManager:f=null}){this.#o=e,this.#x=i,this.#a=o,this.#k=a,this.#h=l,this.#i=t,this.#v=c,this.#u=d,this.#c=r,this.#e=f,this.#w=r[0],this.#l=CO.toDateObject(s),this.trigger=r.flatMap(p=>p.getElementsToTriggerPopup()),f||(this.#P(),this.#o.hidden=!0,h&&this.#O())}#P(){if(this.#f)return;this.#f=new AbortController;const{signal:e}=this.#f;for(const t of this.trigger)t.addEventListener("click",this.#s,{signal:e}),t.addEventListener("pointerenter",this.#n,{signal:e}),t.addEventListener("pointerleave",this.#r,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#c)t.container?.addEventListener("keydown",this.#t,{signal:e})}#C(){const e=this.#c.find(t=>t.hasCommentButton);e&&(this.#y=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#g){this.#g.parentNode||this.#w.container.after(this.#g);return}if(this.#y||this.#C(),!this.#y)return;const{signal:e}=this.#f=new AbortController,t=this.#w.hasOwnCommentButton,r=()=>{this.#e.toggleCommentPopup(this,!0,void 0,!t)},i=()=>{this.#e.toggleCommentPopup(this,!1,!0,!t)},s=()=>{this.#e.toggleCommentPopup(this,!1,!1)};if(t){this.#g=this.#w.container;for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",this.#t,{signal:e}),o.addEventListener("click",r,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",s,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=this.#g=document.createElement("button");o.className="annotationCommentButton";const a=this.#w.container;o.style.zIndex=a.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#Q(),this.#E(),o.addEventListener("keydown",this.#t,{signal:e}),o.addEventListener("click",r,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",s,{signal:e}),a.after(o)}}#E(){if(this.#w.extraPopupElement&&!this.#w.editor)return;this.#g||this.renderCommentButton();const[e,t]=this.#y,{style:r}=this.#g;r.left=`calc(${e}%)`,r.top=`calc(${t}% - var(--comment-button-dim))`}#Q(){this.#w.extraPopupElement||(this.#g||this.renderCommentButton(),this.#g.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#w.commentData;return e?this.#h._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#g?.focus()},0)}getData(){const{richText:e,color:t,opacity:r,creationDate:i,modificationDate:s}=this.#w.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:r,creationDate:i,modificationDate:s}}get elementBeforePopup(){return this.#g}get comment(){return this.#S||=this.#w.commentText,this.#S}set comment(e){e!==this.comment&&(this.#w.commentText=this.#S=e)}focus(){this.#w.container?.focus()}get parentBoundingClientRect(){return this.#w.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){this.#g&&(this.#g.classList.toggle("selected",e),this.#g.ariaExpanded=t)}setSelectedCommentButton(e){this.#g.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#b)return this.#b;const{x:e,y:t,height:r}=this.#g.getBoundingClientRect(),{x:i,y:s,width:o,height:a}=this.#w.layer.getBoundingClientRect();return[(e-i)/o,(t+r-s)/a]}set commentPopupPosition(e){this.#b=e}hasDefaultPopupPosition(){return this.#b===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#g.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,r]=this.#b||this.commentButtonPosition.map(c=>c/100),i=this.parentBoundingClientRect,{x:s,y:o,width:a,height:l}=i;this.#e.showDialog(null,this,s+t*a,o+r*l,{...e,parentDimensions:i})}render(){if(this.#m)return;const e=this.#m=document.createElement("div");if(e.className="popup",this.#i){const r=e.style.outlineColor=Dt.makeHexColor(...this.#i);e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#x?.str){const r=document.createElement("span");r.className="title",t.append(r),{dir:r.dir,str:r.textContent}=this.#x}if(e.append(t),this.#l){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#l.valueOf()})),r.dateTime=this.#l.toISOString(),t.append(r)}pQ({html:this.#M||this.#a.str,dir:this.#a?.dir,className:"popupContent"},e),this.#o.append(e)}get#M(){const e=this.#k,t=this.#a;return e?.str&&(!t?.str||t.str===e.str)&&this.#k.html||null}get#D(){return this.#M?.attributes?.style?.fontSize||0}get#$(){return this.#M?.attributes?.style?.color||null}#N(e){const t=[],r={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:this.#$,fontSize:this.#D?`calc(${this.#D}px * var(--total-scale-factor))`:""}};for(const s of e.split(`
`))t.push({name:"span",value:s,attributes:i});return r}#V(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#p)&&this.#O()}updateEdited({rect:e,popup:t,deleted:r}){if(this.#e){r?(this.remove(),this.#S=null):t&&(t.deleted?this.remove():(this.#Q(),this.#S=t.text)),e&&(this.#y=null,this.#C(),this.#E());return}if(r||t?.deleted){this.remove();return}this.#P(),this.#_||={contentsObj:this.#a,richText:this.#k},e&&(this.#d=null),t&&t.text&&(this.#k=this.#N(t.text),this.#l=CO.toDateObject(t.date),this.#a=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#_&&({contentsObj:this.#a,richText:this.#k}=this.#_,this.#_=null,this.#m?.remove(),this.#m=null,this.#d=null)}remove(){if(this.#f?.abort(),this.#f=null,this.#m?.remove(),this.#m=null,this.#A=!1,this.#p=!1,this.#g?.remove(),this.#g=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#T(){if(this.#d!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:r,pageX:i,pageY:s}}}=this.#h;let o=!!this.#u,a=o?this.#u:this.#v;for(const g of this.#c)if(!a||Dt.intersect(g.data.rect,a)!==null){a=g.data.rect,o=!0;break}const l=Dt.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=o?a[2]-a[0]+5:0,h=l[0]+d,f=l[1];this.#d=[100*(h-i)/t,100*(f-s)/r];const{style:p}=this.#o;p.left=`${this.#d[0]}%`,p.top=`${this.#d[1]}%`}#O(){if(this.#e){this.#e.toggleCommentPopup(this,!1);return}this.#p=!this.#p,this.#p?(this.#R(),this.#o.addEventListener("click",this.#s),this.#o.addEventListener("keydown",this.#t)):(this.#F(),this.#o.removeEventListener("click",this.#s),this.#o.removeEventListener("keydown",this.#t))}#R(){this.#m||this.render(),this.isVisible?this.#p&&this.#o.classList.add("focused"):(this.#T(),this.#o.hidden=!1,this.#o.style.zIndex=parseInt(this.#o.style.zIndex)+1e3)}#F(){this.#o.classList.remove("focused"),!(this.#p||!this.isVisible)&&(this.#o.hidden=!0,this.#o.style.zIndex=parseInt(this.#o.style.zIndex)-1e3)}forceHide(){this.#A=this.isVisible,this.#A&&(this.#o.hidden=!0)}maybeShow(){this.#e||(this.#P(),this.#A&&(this.#m||this.#R(),this.#A=!1,this.#o.hidden=!1))}get isVisible(){return this.#e?!1:this.#o.hidden===!1}}class RQ extends gr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=on.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const r=document.createElement("span");r.textContent=t,e.append(r)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Rne extends gr{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:r}=this,i=this.svgFactory.create(t,r,!0),s=this.#e=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),s.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),s.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),s.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Dne extends gr{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:r}=this,i=this.svgFactory.create(t,r,!0),s=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",s/2),o.setAttribute("y",s/2),o.setAttribute("width",t-s),o.setAttribute("height",r-s),o.setAttribute("stroke-width",s||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Nne extends gr{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:r}=this,i=this.svgFactory.create(t,r,!0),s=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",t/2),o.setAttribute("cy",r/2),o.setAttribute("rx",t/2-s/2),o.setAttribute("ry",r/2-s/2),o.setAttribute("stroke-width",s||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class DQ extends gr{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:r,popupRef:i},width:s,height:o}=this;if(!t)return this.container;const a=this.svgFactory.create(s,o,!0);let l=[];for(let d=0,h=t.length;d<h;d+=2){const f=t[d]-e[0],p=e[3]-t[d+1];l.push(`${f},${p}`)}l=l.join(" ");const c=this.#e=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",r.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!i&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Lne extends DQ{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Qne extends gr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class WS extends gr{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?on.HIGHLIGHT:on.INK}#r(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:r,borderStyle:i,popupRef:s}}=this,{transform:o,width:a,height:l}=this.#r(t,e),c=this.svgFactory.create(a,l,!0),d=this.#e=this.svgFactory.createElement("svg:g");c.append(d),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",o);for(let h=0,f=r.length;h<f;h++){const p=this.svgFactory.createElement(this.svgElementName);this.#t.push(p),p.setAttribute("points",r[h].join(",")),d.append(p)}return!s&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:r,rect:i}=e,s=this.#e;if(t>=0&&s.setAttribute("stroke-width",t||1),r)for(let o=0,a=this.#t.length;o<a;o++)this.#t[o].setAttribute("points",r[o].join(","));if(i){const{transform:o,width:a,height:l}=this.#r(this.data.rotation,i);s.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),s.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class NQ extends gr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=on.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const r=document.createElement("mark");r.classList.add("overlaidText"),r.textContent=e,this.container.append(r)}return this.container}}class $ne extends gr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const r=document.createElement("u");r.classList.add("overlaidText"),r.textContent=e,this.container.append(r)}return this.container}}class Fne extends gr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const r=document.createElement("u");r.classList.add("overlaidText"),r.textContent=e,this.container.append(r)}return this.container}}class zne extends gr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const r=document.createElement("s");r.classList.add("overlaidText"),r.textContent=e,this.container.append(r)}return this.container}}class LQ extends gr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=on.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Bne extends gr{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let r;t.hasAppearance||t.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),r.addEventListener("dblclick",this.#t.bind(this)),this.#e=r;const{isMac:i}=hi.platform;return e.addEventListener("keydown",s=>{s.key==="Enter"&&(i?s.metaKey:s.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):r.classList.add("popupTriggerArea"),e.append(r),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class XS{#e=null;#t=null;#r=null;#n=new Map;#s=null;#i=null;#o=[];#a=!1;constructor({div:e,accessibilityManager:t,annotationCanvasMap:r,annotationEditorUIManager:i,page:s,viewport:o,structTreeLayer:a,commentManager:l,linkService:c,annotationStorage:d}){this.div=e,this.#e=t,this.#t=r,this.#s=a||null,this.#i=c||null,this.#r=d||new US,this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=l||null}hasEditableAnnotations(){return this.#n.size>0}async render(e){const{annotations:t}=e,r=this.div;Su(r,this.viewport);const i=new Map,s=[],o={data:null,layer:r,linkService:this.#i,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Qy,annotationStorage:this.#r,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const l=a.annotationType===Pr.POPUP;if(l){const h=i.get(a.id);if(!h)continue;if(!this._commentManager){s.push(a);continue}o.elements=h}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;o.data=a;const c=Ww.create(o);if(!c.isRenderable)continue;if(!l&&(this.#o.push(c),a.popupRef)){const h=i.get(a.popupRef);h?h.push(c):i.set(a.popupRef,[c])}const d=c.render();a.hidden&&(d.style.visibility="hidden"),c._isEditable&&(this.#n.set(c.data.id,c),this._annotationEditorUIManager?.renderAnnotationElement(c))}await this.#l();for(const a of s){const l=o.elements=i.get(a.id);o.data=a;const c=Ww.create(o);if(!c.isRenderable)continue;const d=c.render();c.contentElement.id=`${zd}${a.id}`,a.hidden&&(d.style.visibility="hidden"),l.at(-1).container.after(d)}this.#c()}async#l(){if(this.#o.length===0)return;this.div.replaceChildren();const e=[];if(!this.#a){this.#a=!0;for(const{contentElement:r,data:{id:i}}of this.#o){const s=r.id=`${zd}${i}`;e.push(this.#s?.getAriaAttributes(s).then(o=>{if(o)for(const[a,l]of o)r.setAttribute(a,l)}))}}this.#o.sort(({data:{rect:[r,i,s,o]}},{data:{rect:[a,l,c,d]}})=>{if(r===s&&i===o)return 1;if(a===c&&l===d)return-1;const h=o,f=i,p=(i+o)/2,g=d,m=l,v=(l+d)/2;if(p>=g&&v<=f)return-1;if(v>=h&&p<=m)return 1;const y=(r+s)/2,O=(a+c)/2;return y-O});const t=document.createDocumentFragment();for(const r of this.#o)t.append(r.container),this._commentManager?(r.extraPopupElement?.popup||r.popup)?.renderCommentButton():r.extraPopupElement&&t.append(r.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),this.#e)for(const r of this.#o)this.#e.addPointerInTextLayer(r.contentElement,!1)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#i,svgFactory:new Qy,parent:this};for(const r of e){r.borderStyle||=XS._defaultBorderStyle,t.data=r;const i=Ww.create(t);i.isRenderable&&(i.render(),i.contentElement.id=`${zd}${r.id}`,this.#o.push(i))}await this.#l()}update({viewport:e}){const t=this.div;this.viewport=e,Su(t,{rotation:e.rotation}),this.#c(),t.hidden=!1}#c(){if(!this.#t)return;const e=this.div;for(const[t,r]of this.#t){const i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;r.className="annotationContent";const{firstChild:s}=i;s?s.nodeName==="CANVAS"?s.replaceWith(r):s.classList.contains("annotationContent")?s.after(r):s.before(r):i.append(r);const o=this.#n.get(t);o&&(o._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,i.id,r),o._hasNoCanvas=!1):o.canvas=r)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(e){return this.#n.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:r,rotation:i}=e,s=new Sne({data:{id:r,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#i,annotationStorage:this.#r});return s.render(),s.contentElement.id=`${zd}${r}`,s.createOrUpdatePopup(),this.#o.push(s),s}removeAnnotation(e){const t=this.#o.findIndex(i=>i.data.id===e);if(t<0)return;const[r]=this.#o.splice(t,1);this.#e?.removePointerInTextLayer(r.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);this.#l()}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return an(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Td.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Xm=/\r\n?|\n/g;class Xr extends Ht{#e="";#t=`${this.id}-editor`;#r=null;#n;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=Xr.prototype,t=s=>s.isEmpty(),r=bc.TRANSLATE_SMALL,i=bc.TRANSLATE_BIG;return an(this,"_keyboardManager",new em([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}]]))}static _type="freetext";static _editorType=on.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||Xr._defaultColor||Ht._defaultLineColor,this.#n=e.fontSize||Xr._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(e,t){Ht.initialize(e,t);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case wn.FREETEXT_SIZE:Xr._defaultFontSize=t;break;case wn.FREETEXT_COLOR:Xr._defaultColor=t;break}}updateParams(e,t){switch(e){case wn.FREETEXT_SIZE:this.#s(t);break;case wn.FREETEXT_COLOR:this.#i(t);break}}static get defaultPropertiesToUpdate(){return[[wn.FREETEXT_SIZE,Xr._defaultFontSize],[wn.FREETEXT_COLOR,Xr._defaultColor||Ht._defaultLineColor]]}get propertiesToUpdate(){return[[wn.FREETEXT_SIZE,this.#n],[wn.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new ng(this),[["colorPicker",this._colorPicker]]}get colorType(){return wn.FREETEXT_COLOR}#s(e){const t=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-this.#n)*this.parentScale),this.#n=i,this.#a()},r=this.#n;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:wn.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#i(e){const t=i=>{this.color=i,this.onUpdatedColor()},r=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:wn.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-Xr._internalPadding*e,-(Xr._internalPadding+this.#n)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#r=new AbortController;const e=this._uiManager.combinedSignal(this.#r);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#t),this._isDraggable=!0,this.#r?.abort(),this.#r=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const e=[];this.editorDiv.normalize();let t=null;for(const r of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&r.nodeName==="BR"||(e.push(Xr.#l(r)),t=r);return e.join(`
`)}#a(){const[e,t]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:i,div:s}=this,o=s.style.display,a=s.classList.contains("hidden");s.classList.remove("hidden"),s.style.display="hidden",i.div.append(this.div),r=s.getBoundingClientRect(),s.remove(),s.style.display=o,s.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=r.width/e,this.height=r.height/t):(this.width=r.height/e,this.height=r.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#o().trimEnd();if(e===t)return;const r=i=>{if(this.#e=i,!i){this.remove();return}this.#c(),this._uiManager.rebuild(this),this.#a()};this.addCommands({cmd:()=>{r(t)},undo:()=>{r(e)},mustExec:!1}),this.#a()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){Xr._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#t),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,r.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,s]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);const[c,d]=this.pageDimensions,[h,f]=this.pageTranslation;let p,g;switch(this.rotation){case 0:p=e+(o[0]-h)/c,g=t+this.height-(o[1]-f)/d;break;case 90:p=e+(o[0]-h)/c,g=t-(o[1]-f)/d,[a,l]=[l,-a];break;case 180:p=e-this.width+(o[0]-h)/c,g=t-(o[1]-f)/d,[a,l]=[-a,-l];break;case 270:p=e+(o[0]-h-this.height*d)/c,g=t+(o[1]-f-this.width*c)/d,[a,l]=[-l,a];break}this.setAt(p*i,g*s,a,l)}else this._moveAfterPaste(e,t);this.#c(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#l(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Xm,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:r}=t;if(r.length===1&&r[0]==="text/plain")return;e.preventDefault();const i=Xr.#u(t.getData("text")||"").replaceAll(Xm,`
`);if(!i)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const o=s.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),s.collapseToStart();return}const{startContainer:a,startOffset:l}=o,c=[],d=[];if(a.nodeType===Node.TEXT_NODE){const p=a.parentElement;if(d.push(a.nodeValue.slice(l).replaceAll(Xm,"")),p!==this.editorDiv){let g=c;for(const m of this.editorDiv.childNodes){if(m===p){g=d;continue}g.push(Xr.#l(m))}}c.push(a.nodeValue.slice(0,l).replaceAll(Xm,""))}else if(a===this.editorDiv){let p=c,g=0;for(const m of this.editorDiv.childNodes)g++===l&&(p=d),p.push(Xr.#l(m))}this.#e=`${c.join(`
`)}${i}${d.join(`
`)}`,this.#c();const h=new Range;let f=Math.sumPrecise(c.map(p=>p.length));for(const{firstChild:p}of this.editorDiv.childNodes)if(p.nodeType===Node.TEXT_NODE){const g=p.nodeValue.length;if(f<=g){h.setStart(p,f),h.setEnd(p,f);break}f-=g}s.removeAllRanges(),s.addRange(h)}#c(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const e of this.#e.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#h(){return this.#e.replaceAll("Â "," ")}static#u(e){return e.replaceAll(" ","Â ")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=Xr._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,r){let i=null;if(e instanceof RQ){const{data:{defaultAppearanceData:{fontSize:o,fontColor:a},rect:l,rotation:c,id:d,popupRef:h,richText:f,contentsObj:p,creationDate:g,modificationDate:m},textContent:v,textPosition:y,parent:{page:{pageNumber:O}}}=e;if(!v||v.length===0)return null;i=e={annotationType:on.FREETEXT,color:Array.from(a),fontSize:o,value:v.join(`
`),position:y,pageIndex:O-1,rect:l.slice(0),rotation:c,annotationElementId:d,id:d,deleted:!1,popupRef:h,comment:p?.str||null,richText:f,creationDate:g,modificationDate:m}}const s=await super.deserialize(e,t,r);return s.#n=e.fontSize,s.color=Dt.makeHexColor(...e.color),s.#e=Xr.#u(e.value),s._initialData=i,e.comment&&s.setCommentData(e),s}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=Ht._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),r=Object.assign(super.serialize(e),{color:t,fontSize:this.#n,value:this.#h()});return this.addComment(r),e?(r.isCopy=!0,r):this.annotationElementId&&!this.#p(r)?null:(r.id=this.annotationElementId,r)}#p(e){const{value:t,fontSize:r,color:i,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==r||e.color.some((o,a)=>o!==i[a])||e.pageIndex!==s}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:r}=t;r.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,r.color=this.color,t.replaceChildren();for(const i of this.#e.split(`
`)){const s=document.createElement("div");s.append(i?document.createTextNode(i):document.createElement("br")),t.append(s)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#e}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class Mt{static PRECISION=1e-4;toSVGPath(){Jn("Abstract method `toSVGPath` must be implemented.")}get box(){Jn("Abstract getter `box` must be implemented.")}serialize(e,t){Jn("Abstract method `serialize` must be implemented.")}static _rescale(e,t,r,i,s,o){o||=new Float32Array(e.length);for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*i,o[a+1]=r+e[a+1]*s;return o}static _rescaleAndSwap(e,t,r,i,s,o){o||=new Float32Array(e.length);for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*i,o[a+1]=r+e[a]*s;return o}static _translate(e,t,r,i){i||=new Float32Array(e.length);for(let s=0,o=e.length;s<o;s+=2)i[s]=t+e[s],i[s+1]=r+e[s+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,r,i,s){switch(s){case 90:return[1-t/r,e/i];case 180:return[1-e/r,1-t/i];case 270:return[t/r,1-e/i];default:return[e/r,t/i]}}static _normalizePagePoint(e,t,r){switch(r){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,r,i,s,o){return[(e+5*r)/6,(t+5*i)/6,(5*r+s)/6,(5*i+o)/6,(r+s)/2,(i+o)/2]}}class su{#e;#t=[];#r;#n;#s=[];#i=new Float32Array(18);#o;#a;#l;#c;#h;#u;#p=[];static#m=8;static#f=2;static#d=su.#m+su.#f;constructor({x:e,y:t},r,i,s,o,a=0){this.#e=r,this.#u=s*i,this.#n=o,this.#i.set([NaN,NaN,NaN,NaN,e,t],6),this.#r=a,this.#c=su.#m*i,this.#l=su.#d*i,this.#h=i,this.#p.push(e,t)}isEmpty(){return isNaN(this.#i[8])}#g(){const e=this.#i.subarray(4,6),t=this.#i.subarray(16,18),[r,i,s,o]=this.#e;return[(this.#o+(e[0]-t[0])/2-r)/s,(this.#a+(e[1]-t[1])/2-i)/o,(this.#o+(t[0]-e[0])/2-r)/s,(this.#a+(t[1]-e[1])/2-i)/o]}add({x:e,y:t}){this.#o=e,this.#a=t;const[r,i,s,o]=this.#e;let[a,l,c,d]=this.#i.subarray(8,12);const h=e-c,f=t-d,p=Math.hypot(h,f);if(p<this.#l)return!1;const g=p-this.#c,m=g/p,v=m*h,y=m*f;let O=a,_=l;a=c,l=d,c+=v,d+=y,this.#p?.push(e,t);const x=-y/g,k=v/g,S=x*this.#u,E=k*this.#u;return this.#i.set(this.#i.subarray(2,8),0),this.#i.set([c+S,d+E],4),this.#i.set(this.#i.subarray(14,18),12),this.#i.set([c-S,d-E],16),isNaN(this.#i[6])?(this.#s.length===0&&(this.#i.set([a+S,l+E],2),this.#s.push(NaN,NaN,NaN,NaN,(a+S-r)/s,(l+E-i)/o),this.#i.set([a-S,l-E],14),this.#t.push(NaN,NaN,NaN,NaN,(a-S-r)/s,(l-E-i)/o)),this.#i.set([O,_,a,l,c,d],6),!this.isEmpty()):(this.#i.set([O,_,a,l,c,d],6),Math.abs(Math.atan2(_-l,O-a)-Math.atan2(y,v))<Math.PI/2?([a,l,c,d]=this.#i.subarray(2,6),this.#s.push(NaN,NaN,NaN,NaN,((a+c)/2-r)/s,((l+d)/2-i)/o),[a,l,O,_]=this.#i.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((O+a)/2-r)/s,((_+l)/2-i)/o),!0):([O,_,a,l,c,d]=this.#i.subarray(0,6),this.#s.push(((O+5*a)/6-r)/s,((_+5*l)/6-i)/o,((5*a+c)/6-r)/s,((5*l+d)/6-i)/o,((a+c)/2-r)/s,((l+d)/2-i)/o),[c,d,a,l,O,_]=this.#i.subarray(12,18),this.#t.push(((O+5*a)/6-r)/s,((_+5*l)/6-i)/o,((5*a+c)/6-r)/s,((5*l+d)/6-i)/o,((a+c)/2-r)/s,((l+d)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#s,t=this.#t;if(isNaN(this.#i[6])&&!this.isEmpty())return this.#y();const r=[];r.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?r.push(`L${e[i+4]} ${e[i+5]}`):r.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);this.#v(r);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?r.push(`L${t[i+4]} ${t[i+5]}`):r.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return this.#b(r),r.join(" ")}#y(){const[e,t,r,i]=this.#e,[s,o,a,l]=this.#g();return`M${(this.#i[2]-e)/r} ${(this.#i[3]-t)/i} L${(this.#i[4]-e)/r} ${(this.#i[5]-t)/i} L${s} ${o} L${a} ${l} L${(this.#i[16]-e)/r} ${(this.#i[17]-t)/i} L${(this.#i[14]-e)/r} ${(this.#i[15]-t)/i} Z`}#b(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#v(e){const[t,r,i,s]=this.#e,o=this.#i.subarray(4,6),a=this.#i.subarray(16,18),[l,c,d,h]=this.#g();e.push(`L${(o[0]-t)/i} ${(o[1]-r)/s} L${l} ${c} L${d} ${h} L${(a[0]-t)/i} ${(a[1]-r)/s}`)}newFreeDrawOutline(e,t,r,i,s,o){return new QQ(e,t,r,i,s,o)}getOutlines(){const e=this.#s,t=this.#t,r=this.#i,[i,s,o,a]=this.#e,l=new Float32Array((this.#p?.length??0)+2);for(let h=0,f=l.length-2;h<f;h+=2)l[h]=(this.#p[h]-i)/o,l[h+1]=(this.#p[h+1]-s)/a;if(l[l.length-2]=(this.#o-i)/o,l[l.length-1]=(this.#a-s)/a,isNaN(r[6])&&!this.isEmpty())return this.#k(l);const c=new Float32Array(this.#s.length+24+this.#t.length);let d=e.length;for(let h=0;h<d;h+=2){if(isNaN(e[h])){c[h]=c[h+1]=NaN;continue}c[h]=e[h],c[h+1]=e[h+1]}d=this.#_(c,d);for(let h=t.length-6;h>=6;h-=6)for(let f=0;f<6;f+=2){if(isNaN(t[h+f])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[h+f],c[d+1]=t[h+f+1],d+=2}return this.#x(c,d),this.newFreeDrawOutline(c,l,this.#e,this.#h,this.#r,this.#n)}#k(e){const t=this.#i,[r,i,s,o]=this.#e,[a,l,c,d]=this.#g(),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-r)/s,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-r)/s,(t[5]-i)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-r)/s,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-r)/s,(t[15]-i)/o],0),this.newFreeDrawOutline(h,e,this.#e,this.#h,this.#r,this.#n)}#x(e,t){const r=this.#t;return e.set([NaN,NaN,NaN,NaN,r[4],r[5]],t),t+=6}#_(e,t){const r=this.#i.subarray(4,6),i=this.#i.subarray(16,18),[s,o,a,l]=this.#e,[c,d,h,f]=this.#g();return e.set([NaN,NaN,NaN,NaN,(r[0]-s)/a,(r[1]-o)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,(i[0]-s)/a,(i[1]-o)/l],t),t+=24}}class QQ extends Mt{#e;#t=new Float32Array(4);#r;#n;#s;#i;#o;constructor(e,t,r,i,s,o){super(),this.#o=e,this.#s=t,this.#e=r,this.#i=i,this.#r=s,this.#n=o,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#a(o);const[a,l,c,d]=this.#t;for(let h=0,f=e.length;h<f;h+=2)e[h]=(e[h]-a)/c,e[h+1]=(e[h+1]-l)/d;for(let h=0,f=t.length;h<f;h+=2)t[h]=(t[h]-a)/c,t[h+1]=(t[h+1]-l)/d}toSVGPath(){const e=[`M${this.#o[4]} ${this.#o[5]}`];for(let t=6,r=this.#o.length;t<r;t+=6){if(isNaN(this.#o[t])){e.push(`L${this.#o[t+4]} ${this.#o[t+5]}`);continue}e.push(`C${this.#o[t]} ${this.#o[t+1]} ${this.#o[t+2]} ${this.#o[t+3]} ${this.#o[t+4]} ${this.#o[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,r,i],s){const o=r-e,a=i-t;let l,c;switch(s){case 0:l=Mt._rescale(this.#o,e,i,o,-a),c=Mt._rescale(this.#s,e,i,o,-a);break;case 90:l=Mt._rescaleAndSwap(this.#o,e,t,o,a),c=Mt._rescaleAndSwap(this.#s,e,t,o,a);break;case 180:l=Mt._rescale(this.#o,r,t,-o,a),c=Mt._rescale(this.#s,r,t,-o,a);break;case 270:l=Mt._rescaleAndSwap(this.#o,r,i,-o,-a),c=Mt._rescaleAndSwap(this.#s,r,i,-o,-a);break}return{outline:Array.from(l),points:[Array.from(c)]}}#a(e){const t=this.#o;let r=t[4],i=t[5];const s=[r,i,r,i];let o=r,a=i,l=r,c=i;const d=e?Math.max:Math.min,h=new Float32Array(4);for(let p=6,g=t.length;p<g;p+=6){const m=t[p+4],v=t[p+5];isNaN(t[p])?(Dt.pointBoundingBox(m,v,s),a>v?(o=m,a=v):a===v&&(o=d(o,m)),c<v?(l=m,c=v):c===v&&(l=d(l,m))):(h[0]=h[1]=1/0,h[2]=h[3]=-1/0,Dt.bezierBoundingBox(r,i,...t.slice(p,p+6),h),Dt.rectBoundingBox(h[0],h[1],h[2],h[3],s),a>h[1]?(o=h[0],a=h[1]):a===h[1]&&(o=d(o,h[0])),c<h[3]?(l=h[2],c=h[3]):c===h[3]&&(l=d(l,h[2]))),r=m,i=v}const f=this.#t;f[0]=s[0]-this.#r,f[1]=s[1]-this.#r,f[2]=s[2]-s[0]+2*this.#r,f[3]=s[3]-s[1]+2*this.#r,this.firstPoint=[o,a],this.lastPoint=[l,c]}get box(){return this.#t}newOutliner(e,t,r,i,s,o=0){return new su(e,t,r,i,s,o)}getNewOutline(e,t){const[r,i,s,o]=this.#t,[a,l,c,d]=this.#e,h=s*c,f=o*d,p=r*c+a,g=i*d+l,m=this.newOutliner({x:this.#s[0]*h+p,y:this.#s[1]*f+g},this.#e,this.#i,e,this.#n,t??this.#r);for(let v=2;v<this.#s.length;v+=2)m.add({x:this.#s[v]*h+p,y:this.#s[v+1]*f+g});return m.getOutlines()}}class LO{#e;#t;#r;#n=[];#s=[];constructor(e,t=0,r=0,i=!0){const s=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:m,y:v,width:y,height:O}of e){const _=Math.floor((m-t)/o)*o,x=Math.ceil((m+y+t)/o)*o,k=Math.floor((v-t)/o)*o,S=Math.ceil((v+O+t)/o)*o,E=[_,k,S,!0],R=[x,k,S,!1];this.#n.push(E,R),Dt.rectBoundingBox(_,k,x,S,s)}const a=s[2]-s[0]+2*r,l=s[3]-s[1]+2*r,c=s[0]-r,d=s[1]-r;let h=i?-1/0:1/0,f=1/0;const p=this.#n.at(i?-1:-2),g=[p[0],p[2]];for(const m of this.#n){const[v,y,O,_]=m;!_&&i?y<f?(f=y,h=v):y===f&&(h=Math.max(h,v)):_&&!i&&(y<f?(f=y,h=v):y===f&&(h=Math.min(h,v))),m[0]=(v-c)/a,m[1]=(y-d)/l,m[2]=(O-d)/l}this.#e=new Float32Array([c,d,a,l]),this.#t=[h,f],this.#r=g}getOutlines(){this.#n.sort((t,r)=>t[0]-r[0]||t[1]-r[1]||t[2]-r[2]);const e=[];for(const t of this.#n)t[3]?(e.push(...this.#c(t)),this.#a(t)):(this.#l(t),e.push(...this.#c(t)));return this.#i(e)}#i(e){const t=[],r=new Set;for(const o of e){const[a,l,c]=o;t.push([a,l,o],[a,c,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){const l=t[o][2],c=t[o+1][2];l.push(c),c.push(l),r.add(l),r.add(c)}const i=[];let s;for(;r.size>0;){const o=r.values().next().value;let[a,l,c,d,h]=o;r.delete(o);let f=a,p=l;for(s=[a,c],i.push(s);;){let g;if(r.has(d))g=d;else if(r.has(h))g=h;else break;r.delete(g),[a,l,c,d,h]=g,f!==a&&(s.push(f,p,a,p===l?l:c),f=a),p=p===l?c:l}s.push(f,p)}return new Une(i,this.#e,this.#t,this.#r)}#o(e){const t=this.#s;let r=0,i=t.length-1;for(;r<=i;){const s=r+i>>1,o=t[s][0];if(o===e)return s;o<e?r=s+1:i=s-1}return i+1}#a([,e,t]){const r=this.#o(e);this.#s.splice(r,0,[e,t])}#l([,e,t]){const r=this.#o(e);for(let i=r;i<this.#s.length;i++){const[s,o]=this.#s[i];if(s!==e)break;if(s===e&&o===t){this.#s.splice(i,1);return}}for(let i=r-1;i>=0;i--){const[s,o]=this.#s[i];if(s!==e)break;if(s===e&&o===t){this.#s.splice(i,1);return}}}#c(e){const[t,r,i]=e,s=[[t,r,i]],o=this.#o(i);for(let a=0;a<o;a++){const[l,c]=this.#s[a];for(let d=0,h=s.length;d<h;d++){const[,f,p]=s[d];if(!(c<=f||p<=l)){if(f>=l){if(p>c)s[d][1]=c;else{if(h===1)return[];s.splice(d,1),d--,h--}continue}s[d][2]=l,p>c&&s.push([t,c,p])}}}return s}}class Une extends Mt{#e;#t;constructor(e,t,r,i){super(),this.#t=e,this.#e=t,this.firstPoint=r,this.lastPoint=i}toSVGPath(){const e=[];for(const t of this.#t){let[r,i]=t;e.push(`M${r} ${i}`);for(let s=2;s<t.length;s+=2){const o=t[s],a=t[s+1];o===r?(e.push(`V${a}`),i=a):a===i&&(e.push(`H${o}`),r=o)}e.push("Z")}return e.join(" ")}serialize([e,t,r,i],s){const o=[],a=r-e,l=i-t;for(const c of this.#t){const d=new Array(c.length);for(let h=0;h<c.length;h+=2)d[h]=e+c[h]*a,d[h+1]=i-c[h+1]*l;o.push(d)}return o}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class QO extends su{newFreeDrawOutline(e,t,r,i,s,o){return new jne(e,t,r,i,s,o)}}class jne extends QQ{newOutliner(e,t,r,i,s,o=0){return new QO(e,t,r,i,s,o)}}class kr extends Ht{#e=null;#t=0;#r;#n=null;#s=null;#i=null;#o=null;#a=0;#l=null;#c=null;#h=null;#u=!1;#p=null;#m=null;#f=null;#d="";#g;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=on.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=kr.prototype;return an(this,"_keyboardManager",new em([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||kr._defaultColor,this.#g=e.thickness||kr._defaultThickness,this.opacity=e.opacity||kr._defaultOpacity,this.#r=e.boxes||null,this.#y=e.methodOfCreation||"",this.#d=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#u=!0,this.#v(e),this.#w()):this.#r&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#o=e.focusNode,this.#a=e.focusOffset,this.#b(),this.#w(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#u?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#g,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){const e=new LO(this.#r,.001);this.#c=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const t=new LO(this.#r,.0025,.001,this._uiManager.direction==="ltr");this.#i=t.getOutlines();const{firstPoint:r}=this.#c;this.#p=[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height];const{lastPoint:i}=this.#i;this.#m=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#v({highlightOutlines:e,highlightId:t,clipPathId:r}){this.#c=e;const i=1.5;if(this.#i=e.getNewOutline(this.#g/2+i,.0025),t>=0)this.#h=t,this.#n=r,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#f=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},!0);else if(this.parent){const h=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#h,{bbox:kr.#S(this.#c.box,(h-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#f,{bbox:kr.#S(this.#i.box,h),path:{d:this.#i.toSVGPath()}})}const[s,o,a,l]=e.box;switch(this.rotation){case 0:this.x=s,this.y=o,this.width=a,this.height=l;break;case 90:{const[h,f]=this.parentDimensions;this.x=o,this.y=1-s,this.width=a*f/h,this.height=l*h/f;break}case 180:this.x=1-s,this.y=1-o,this.width=a,this.height=l;break;case 270:{const[h,f]=this.parentDimensions;this.x=1-o,this.y=s,this.width=a*f/h,this.height=l*h/f;break}}const{firstPoint:c}=e;this.#p=[(c[0]-s)/a,(c[1]-o)/l];const{lastPoint:d}=this.#i;this.#m=[(d[0]-s)/a,(d[1]-o)/l]}static initialize(e,t){Ht.initialize(e,t),kr._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case wn.HIGHLIGHT_COLOR:kr._defaultColor=t;break;case wn.HIGHLIGHT_THICKNESS:kr._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#p}updateParams(e,t){switch(e){case wn.HIGHLIGHT_COLOR:this.#k(t);break;case wn.HIGHLIGHT_THICKNESS:this.#x(t);break}}static get defaultPropertiesToUpdate(){return[[wn.HIGHLIGHT_COLOR,kr._defaultColor],[wn.HIGHLIGHT_THICKNESS,kr._defaultThickness]]}get propertiesToUpdate(){return[[wn.HIGHLIGHT_COLOR,this.color||kr._defaultColor],[wn.HIGHLIGHT_THICKNESS,this.#g||kr._defaultThickness],[wn.HIGHLIGHT_FREE,this.#u]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#h,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#s?.updateColor(this.color),super.onUpdatedColor()}#k(e){const t=(s,o)=>{this.color=s,this.opacity=o,this.onUpdatedColor()},r=this.color,i=this.opacity;this.addCommands({cmd:t.bind(this,e,kr._defaultOpacity),undo:t.bind(this,r,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:wn.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#x(e){const t=this.#g,r=i=>{this.#g=i,this.#_(i)};this.addCommands({cmd:r.bind(this,e),undo:r.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:wn.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#s=new Js({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#E())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#E())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#A(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#w(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#A():e&&(this.#w(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#_(e){this.#u&&(this.#v({highlightOutlines:this.#c.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims())}#A(){this.#h===null||!this.parent||(this.parent.drawLayer.remove(this.#h),this.#h=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#w(e=this.parent){this.#h===null&&({id:this.#h,clipPathId:this.#n}=e.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#u},path:{d:this.#c.toSVGPath()}},!1,!0),this.#f=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#u},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},this.#u),this.#l&&(this.#l.style.clipPath=this.#n))}static#S([e,t,r,i],s){switch(s){case 90:return[1-t-i,e,i,r];case 180:return[1-e-r,1-t-i,r,i];case 270:return[t,1-e-r,i,r]}return[e,t,r,i]}rotate(e){const{drawLayer:t}=this.parent;let r;this.#u?(e=(e-this.rotation+360)%360,r=kr.#S(this.#c.box,e)):r=kr.#S([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#h,{bbox:r,root:{"data-main-rotation":e}}),t.updateProperties(this.#f,{bbox:kr.#S(this.#i.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#d&&(e.setAttribute("aria-label",this.#d),e.setAttribute("role","mark")),this.#u?e.classList.add("free"):this.div.addEventListener("keydown",this.#P.bind(this),{signal:this._uiManager._signal});const t=this.#l=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#n,this.setDims(),mQ(this,this.#l,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1}})}#P(e){kr._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#C(!0);break;case 1:case 3:this.#C(!1);break}}#C(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#o,this.#a)}select(){super.select(),this.#f&&this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{selected:!1}}),this.#u||this.#C(!1))}get _mustFixPosition(){return!this.#u}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#h,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#f,{rootClass:{hidden:!e}}))}#E(){return this.#u?this.rotation:0}#Q(){if(this.#u)return null;const[e,t]=this.pageDimensions,[r,i]=this.pageTranslation,s=this.#r,o=new Float32Array(s.length*8);let a=0;for(const{x:l,y:c,width:d,height:h}of s){const f=l*e+r,p=(1-c)*t+i;o[a]=o[a+4]=f,o[a+1]=o[a+3]=p,o[a+2]=o[a+6]=f+d*e,o[a+5]=o[a+7]=p-h*t,a+=8}return o}#M(e){return this.#c.serialize(e,this.#E())}static startHighlighting(e,t,{target:r,x:i,y:s}){const{x:o,y:a,width:l,height:c}=r.getBoundingClientRect(),d=new AbortController,h=e.combinedSignal(d),f=p=>{d.abort(),this.#$(e,p)};window.addEventListener("blur",f,{signal:h}),window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("pointerdown",br,{capture:!0,passive:!1,signal:h}),window.addEventListener("contextmenu",bo,{signal:h}),r.addEventListener("pointermove",this.#D.bind(this,e),{signal:h}),this._freeHighlight=new QO({x:i,y:s},[o,a,l,c],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#D(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#$(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,r){let i=null;if(e instanceof NQ){const{data:{quadPoints:g,rect:m,rotation:v,id:y,color:O,opacity:_,popupRef:x,richText:k,contentsObj:S,creationDate:E,modificationDate:R},parent:{page:{pageNumber:C}}}=e;i=e={annotationType:on.HIGHLIGHT,color:Array.from(O),opacity:_,quadPoints:g,boxes:null,pageIndex:C-1,rect:m.slice(0),rotation:v,annotationElementId:y,id:y,deleted:!1,popupRef:x,richText:k,comment:S?.str||null,creationDate:E,modificationDate:R}}else if(e instanceof WS){const{data:{inkLists:g,rect:m,rotation:v,id:y,color:O,borderStyle:{rawWidth:_},popupRef:x,richText:k,contentsObj:S,creationDate:E,modificationDate:R},parent:{page:{pageNumber:C}}}=e;i=e={annotationType:on.HIGHLIGHT,color:Array.from(O),thickness:_,inkLists:g,boxes:null,pageIndex:C-1,rect:m.slice(0),rotation:v,annotationElementId:y,id:y,deleted:!1,popupRef:x,richText:k,comment:S?.str||null,creationDate:E,modificationDate:R}}const{color:s,quadPoints:o,inkLists:a,opacity:l}=e,c=await super.deserialize(e,t,r);c.color=Dt.makeHexColor(...s),c.opacity=l||1,a&&(c.#g=e.thickness),c._initialData=i,e.comment&&c.setCommentData(e);const[d,h]=c.pageDimensions,[f,p]=c.pageTranslation;if(o){const g=c.#r=[];for(let m=0;m<o.length;m+=8)g.push({x:(o[m]-f)/d,y:1-(o[m+1]-p)/h,width:(o[m+2]-o[m])/d,height:(o[m+1]-o[m+5])/h});c.#b(),c.#w(),c.rotate(c.rotation)}else if(a){c.#u=!0;const g=a[0],m={x:g[0]-f,y:h-(g[1]-p)},v=new QO(m,[0,0,d,h],1,c.#g/2,!0,.001);for(let _=0,x=g.length;_<x;_+=2)m.x=g[_]-f,m.y=h-(g[_+1]-p),v.add(m);const{id:y,clipPathId:O}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:v.toSVGPath()}},!0,!0);c.#v({highlightOutlines:v.getOutlines(),highlightId:y,clipPathId:O}),c.#w(),c.rotate(c.parentRotation)}return c}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=Ht._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),r=super.serialize(e);return Object.assign(r,{color:t,opacity:this.opacity,thickness:this.#g,quadPoints:this.#Q(),outlines:this.#M(r.rect)}),this.addComment(r),this.annotationElementId&&!this.#N(r)?null:(r.id=this.annotationElementId,r)}#N(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((r,i)=>r!==t[i])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class $Q{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,r]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,r)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){Jn("Not implemented")}}class Ln extends Ht{#e=null;#t;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#r=null;static#n=null;static#s=null;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#i(e),this.#l())}#i({drawOutlines:e,drawId:t,drawingOptions:r}){this.#e=e,this._drawingOptions||=r,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#o(e,this.parent),this.#u(e.box)}#o(e,t){const{id:r}=t.drawLayer.draw(Ln._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return r}static _mergeSVGProperties(e,t){const r=new Set(Object.keys(e));for(const[i,s]of Object.entries(t))r.has(i)?Object.assign(e[i],s):e[i]=s;return e}static getDefaultDrawingOptions(e){Jn("Not implemented")}static get typesMap(){Jn("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const r=this.typesMap.get(e);r&&this._defaultDrawingOptions.updateProperty(r,t),this._currentParent&&(Ln.#r.updateProperty(r,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const r=this.constructor.typesMap.get(e);r&&this._updateProperty(e,r,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[r,i]of this.typesMap)e.push([r,t[i]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[r,i]of this.constructor.typesMap)e.push([r,t[i]]);return e}_updateProperty(e,t,r){const i=this._drawingOptions,s=i[t],o=a=>{i.updateProperty(t,a);const l=this.#e.updateProperty(t,a);l&&this.#u(l),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,r),undo:o.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,Ln._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#h()),{bbox:this.#p()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,Ln._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#h()),{bbox:this.#p()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#p()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,Ln._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#h(),this.parentDimensions),{bbox:this.#p()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#a(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#l(),this.#u(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#a()):e&&(this._uiManager.addShouldRescale(this),this.#l(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#a(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#l(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#o(this.#e,e)}}#c([e,t,r,i]){const{parentDimensions:[s,o],rotation:a}=this;switch(a){case 90:return[t,1-e,r*(o/s),i*(s/o)];case 180:return[1-e,1-t,r,i];case 270:return[1-t,e,r*(o/s),i*(s/o)];default:return[e,t,r,i]}}#h(){const{x:e,y:t,width:r,height:i,parentDimensions:[s,o],rotation:a}=this;switch(a){case 90:return[1-t,e,r*(s/o),i*(o/s)];case 180:return[1-e,1-t,r,i];case 270:return[t,1-e,r*(s/o),i*(o/s)];default:return[e,t,r,i]}}#u(e){[this.x,this.y,this.width,this.height]=this.#c(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#p(){const{x:e,y:t,width:r,height:i,rotation:s,parentRotation:o,parentDimensions:[a,l]}=this;switch((s*4+o)/90){case 1:return[1-t-i,e,i,r];case 2:return[1-e-r,1-t-i,r,i];case 3:return[t,1-e-r,i,r];case 4:return[e,t-r*(a/l),i*(l/a),r*(a/l)];case 5:return[1-t,e,r*(a/l),i*(l/a)];case 6:return[1-e-i*(l/a),1-t,i*(l/a),r*(a/l)];case 7:return[t-r*(a/l),1-e-i*(l/a),r*(a/l),i*(l/a)];case 8:return[e-r,t-i,r,i];case 9:return[1-t,e-r,i,r];case 10:return[1-e,1-t,r,i];case 11:return[t-i,1-e,i,r];case 12:return[e-i*(l/a),t,i*(l/a),r*(a/l)];case 13:return[1-t-r*(a/l),e-i*(l/a),r*(a/l),i*(l/a)];case 14:return[1-e,1-t-r*(a/l),i*(l/a),r*(a/l)];case 15:return[t,1-e,r*(a/l),i*(l/a)];default:return[e,t,r,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Ln._mergeSVGProperties({bbox:this.#p()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#u(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const r=super.render();r.classList.add("draw");const i=document.createElement("div");return r.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),r}static createDrawerInstance(e,t,r,i,s){Jn("Not implemented")}static startDrawing(e,t,r,i){const{target:s,offsetX:o,offsetY:a,pointerId:l,pointerType:c}=i;if(Qn.isInitializedAndDifferentPointerType(c))return;const{viewport:{rotation:d}}=e,{width:h,height:f}=s.getBoundingClientRect(),p=Ln.#n=new AbortController,g=e.combinedSignal(p);if(Qn.setPointer(c,l),window.addEventListener("pointerup",m=>{Qn.isSamePointerIdOrRemove(m.pointerId)&&this._endDraw(m)},{signal:g}),window.addEventListener("pointercancel",m=>{Qn.isSamePointerIdOrRemove(m.pointerId)&&this._currentParent.endDrawingSession()},{signal:g}),window.addEventListener("pointerdown",m=>{Qn.isSamePointerType(m.pointerType)&&(Qn.initializeAndAddPointerId(m.pointerId),Ln.#r.isCancellable()&&(Ln.#r.removeLastElement(),Ln.#r.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",bo,{signal:g}),s.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),s.addEventListener("touchmove",m=>{Qn.isSameTimeStamp(m.timeStamp)&&br(m)},{signal:g}),e.toggleDrawing(),t._editorUndoBar?.hide(),Ln.#r){e.drawLayer.updateProperties(this._currentDrawId,Ln.#r.startNew(o,a,h,f,d));return}t.updateUIForDefaultProperties(this),Ln.#r=this.createDrawerInstance(o,a,h,f,d),Ln.#s=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(Ln.#s.toSVGProperties(),Ln.#r.defaultSVGProperties),!0,!1)}static _drawMove(e){if(Qn.isSameTimeStamp(e.timeStamp),!Ln.#r)return;const{offsetX:t,offsetY:r,pointerId:i}=e;if(Qn.isSamePointerId(i)){if(Qn.isUsingMultiplePointers()){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,Ln.#r.add(t,r)),Qn.setTimeStamp(e.timeStamp),br(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,Ln.#r=null,Ln.#s=null,Qn.clearPointerType(),Qn.clearTimeStamp()),Ln.#n&&(Ln.#n.abort(),Ln.#n=null,Qn.clearPointerIds())}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,Ln.#r.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const r=Ln.#r,i=this._currentDrawId,s=r.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(i,r.setLastElement(s))},undo:()=>{t.drawLayer.updateProperties(i,r.removeLastElement())},mustExec:!1,type:wn.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(wn.DRAW_STEP),!Ln.#r.isEmpty()){const{pageDimensions:[r,i],scale:s}=t,o=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:Ln.#r.getOutlines(r*s,i*s,s,this._INNER_MARGIN),drawingOptions:Ln.#s,mustBeCommitted:!e});return this._cleanup(!0),o}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,r,i,s,o){Jn("Not implemented")}static async deserialize(e,t,r){const{rawDims:{pageWidth:i,pageHeight:s,pageX:o,pageY:a}}=t.viewport,l=this.deserializeDraw(o,a,i,s,this._INNER_MARGIN,e),c=await super.deserialize(e,t,r);return c.createDrawingOptions(e),c.#i({drawOutlines:l}),c.#l(),c.onScaleChanging(),c.rotate(),c}serializeDraw(e){const[t,r]=this.pageTranslation,[i,s]=this.pageDimensions;return this.#e.serialize([t,r,i,s],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class Vne{#e=new Float64Array(6);#t;#r;#n;#s;#i;#o="";#a=0;#l=new nm;#c;#h;constructor(e,t,r,i,s,o){this.#c=r,this.#h=i,this.#n=s,this.#s=o,[e,t]=this.#u(e,t);const a=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#i=[e,t],this.#r=[{line:a,points:this.#i}],this.#e.set(a,0)}updateProperty(e,t){e==="stroke-width"&&(this.#s=t)}#u(e,t){return Mt._normalizePoint(e,t,this.#c,this.#h,this.#n)}isEmpty(){return!this.#r||this.#r.length===0}isCancellable(){return this.#i.length<=10}add(e,t){[e,t]=this.#u(e,t);const[r,i,s,o]=this.#e.subarray(2,6),a=e-s,l=t-o;return Math.hypot(this.#c*a,this.#h*l)<=2?null:(this.#i.push(e,t),isNaN(r)?(this.#e.set([s,o,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([r,i,s,o,e,t],0),this.#t.push(...Mt.createBezierPoints(r,i,s,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const r=this.add(e,t);return r||(this.#i.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,r,i,s){this.#c=r,this.#h=i,this.#n=s,[e,t]=this.#u(e,t);const o=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#i=[e,t];const a=this.#r.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#r.push({line:o,points:this.#i}),this.#e.set(o,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#r.at(-1)}setLastElement(e){return this.#r?(this.#r.push(e),this.#t=e.line,this.#i=e.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#l.setLastElement(e)}removeLastElement(){if(!this.#r)return this.#l.removeLastElement();this.#r.pop(),this.#o="";for(let e=0,t=this.#r.length;e<t;e++){const{line:r,points:i}=this.#r[e];this.#t=r,this.#i=i,this.#a=0,this.toSVGPath()}return{path:{d:this.#o}}}toSVGPath(){const e=Mt.svgRound(this.#t[4]),t=Mt.svgRound(this.#t[5]);if(this.#i.length===2)return this.#o=`${this.#o} M ${e} ${t} Z`,this.#o;if(this.#i.length<=6){const i=this.#o.lastIndexOf("M");this.#o=`${this.#o.slice(0,i)} M ${e} ${t}`,this.#a=6}if(this.#i.length===4){const i=Mt.svgRound(this.#t[10]),s=Mt.svgRound(this.#t[11]);return this.#o=`${this.#o} L ${i} ${s}`,this.#a=12,this.#o}const r=[];this.#a===0&&(r.push(`M ${e} ${t}`),this.#a=6);for(let i=this.#a,s=this.#t.length;i<s;i+=6){const[o,a,l,c,d,h]=this.#t.slice(i,i+6).map(Mt.svgRound);r.push(`C${o} ${a} ${l} ${c} ${d} ${h}`)}return this.#o+=r.join(" "),this.#a=this.#t.length,this.#o}getOutlines(e,t,r,i){const s=this.#r.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#l.build(this.#r,e,t,r,this.#n,this.#s,i),this.#e=null,this.#t=null,this.#r=null,this.#o=null,this.#l}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class nm extends Mt{#e;#t=0;#r;#n;#s;#i;#o;#a;#l;build(e,t,r,i,s,o,a){this.#s=t,this.#i=r,this.#o=i,this.#a=s,this.#l=o,this.#r=a??0,this.#n=e,this.#u()}get thickness(){return this.#l}setLastElement(e){return this.#n.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#n){if(e.push(`M${Mt.svgRound(t[4])} ${Mt.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${Mt.svgRound(t[10])} ${Mt.svgRound(t[11])}`);continue}for(let r=6,i=t.length;r<i;r+=6){const[s,o,a,l,c,d]=t.subarray(r,r+6).map(Mt.svgRound);e.push(`C${s} ${o} ${a} ${l} ${c} ${d}`)}}return e.join("")}serialize([e,t,r,i],s){const o=[],a=[],[l,c,d,h]=this.#h();let f,p,g,m,v,y,O,_,x;switch(this.#a){case 0:x=Mt._rescale,f=e,p=t+i,g=r,m=-i,v=e+l*r,y=t+(1-c-h)*i,O=e+(l+d)*r,_=t+(1-c)*i;break;case 90:x=Mt._rescaleAndSwap,f=e,p=t,g=r,m=i,v=e+c*r,y=t+l*i,O=e+(c+h)*r,_=t+(l+d)*i;break;case 180:x=Mt._rescale,f=e+r,p=t,g=-r,m=i,v=e+(1-l-d)*r,y=t+c*i,O=e+(1-l)*r,_=t+(c+h)*i;break;case 270:x=Mt._rescaleAndSwap,f=e+r,p=t+i,g=-r,m=-i,v=e+(1-c-h)*r,y=t+(1-l-d)*i,O=e+(1-c)*r,_=t+(1-l)*i;break}for(const{line:k,points:S}of this.#n)o.push(x(k,f,p,g,m,s?new Array(k.length):null)),a.push(x(S,f,p,g,m,s?new Array(S.length):null));return{lines:o,points:a,rect:[v,y,O,_]}}static deserialize(e,t,r,i,s,{paths:{lines:o,points:a},rotation:l,thickness:c}){const d=[];let h,f,p,g,m;switch(l){case 0:m=Mt._rescale,h=-e/r,f=t/i+1,p=1/r,g=-1/i;break;case 90:m=Mt._rescaleAndSwap,h=-t/i,f=-e/r,p=1/i,g=1/r;break;case 180:m=Mt._rescale,h=e/r+1,f=-t/i,p=-1/r,g=1/i;break;case 270:m=Mt._rescaleAndSwap,h=t/i+1,f=e/r+1,p=-1/i,g=-1/r;break}if(!o){o=[];for(const y of a){const O=y.length;if(O===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1]]));continue}if(O===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1],NaN,NaN,NaN,NaN,y[2],y[3]]));continue}const _=new Float32Array(3*(O-2));o.push(_);let[x,k,S,E]=y.subarray(0,4);_.set([NaN,NaN,NaN,NaN,x,k],0);for(let R=4;R<O;R+=2){const C=y[R],I=y[R+1];_.set(Mt.createBezierPoints(x,k,S,E,C,I),(R-2)*3),[x,k,S,E]=[S,E,C,I]}}}for(let y=0,O=o.length;y<O;y++)d.push({line:m(o[y].map(_=>_??NaN),h,f,p,g),points:m(a[y].map(_=>_??NaN),h,f,p,g)});const v=new this.prototype.constructor;return v.build(d,r,i,1,l,c,s),v}#c(e=this.#l){const t=this.#r+e/2*this.#o;return this.#a%180===0?[t/this.#s,t/this.#i]:[t/this.#i,t/this.#s]}#h(){const[e,t,r,i]=this.#e,[s,o]=this.#c(0);return[e+s,t+o,r-2*s,i-2*o]}#u(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#n){if(i.length<=12){for(let a=4,l=i.length;a<l;a+=6)Dt.pointBoundingBox(i[a],i[a+1],e);continue}let s=i[4],o=i[5];for(let a=6,l=i.length;a<l;a+=6){const[c,d,h,f,p,g]=i.subarray(a,a+6);Dt.bezierBoundingBox(s,o,c,d,h,f,p,g,e),s=p,o=g}}const[t,r]=this.#c();e[0]=Ri(e[0]-t,0,1),e[1]=Ri(e[1]-r,0,1),e[2]=Ri(e[2]+t,0,1),e[3]=Ri(e[3]+r,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#p(t):null}#p(e){const[t,r]=this.#c();this.#l=e;const[i,s]=this.#c(),[o,a]=[i-t,s-r],l=this.#e;return l[0]-=o,l[1]-=a,l[2]+=2*o,l[3]+=2*a,l}updateParentDimensions([e,t],r){const[i,s]=this.#c();this.#s=e,this.#i=t,this.#o=r;const[o,a]=this.#c(),l=o-i,c=a-s,d=this.#e;return d[0]-=l,d[1]-=c,d[2]+=2*l,d[3]+=2*c,d}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(Mt.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Mt.svgRound(e)} ${Mt.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let r=0,i=0,s=0,o=0,a=0,l=0;switch(this.#t){case 90:i=t/e,s=-e/t,a=e;break;case 180:r=-1,o=-1,a=e,l=t;break;case 270:i=-t/e,s=e/t,l=t;break;default:return""}return`matrix(${r} ${i} ${s} ${o} ${Mt.svgRound(a)} ${Mt.svgRound(l)})`}getPathResizingSVGProperties([e,t,r,i]){const[s,o]=this.#c(),[a,l,c,d]=this.#e;if(Math.abs(c-s)<=Mt.PRECISION||Math.abs(d-o)<=Mt.PRECISION){const m=e+r/2-(a+c/2),v=t+i/2-(l+d/2);return{path:{"transform-origin":`${Mt.svgRound(e)} ${Mt.svgRound(t)}`,transform:`${this.rotationTransform} translate(${m} ${v})`}}}const h=(r-2*s)/(c-2*s),f=(i-2*o)/(d-2*o),p=c/r,g=d/i;return{path:{"transform-origin":`${Mt.svgRound(a)} ${Mt.svgRound(l)}`,transform:`${this.rotationTransform} scale(${p} ${g}) translate(${Mt.svgRound(s)} ${Mt.svgRound(o)}) scale(${h} ${f}) translate(${Mt.svgRound(-s)} ${Mt.svgRound(-o)})`}}}getPathResizedSVGProperties([e,t,r,i]){const[s,o]=this.#c(),a=this.#e,[l,c,d,h]=a;if(a[0]=e,a[1]=t,a[2]=r,a[3]=i,Math.abs(d-s)<=Mt.PRECISION||Math.abs(h-o)<=Mt.PRECISION){const v=e+r/2-(l+d/2),y=t+i/2-(c+h/2);for(const{line:O,points:_}of this.#n)Mt._translate(O,v,y,O),Mt._translate(_,v,y,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Mt.svgRound(e)} ${Mt.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const f=(r-2*s)/(d-2*s),p=(i-2*o)/(h-2*o),g=-f*(l+s)+e+s,m=-p*(c+o)+t+o;if(f!==1||p!==1||g!==0||m!==0)for(const{line:v,points:y}of this.#n)Mt._rescale(v,g,m,f,p,v),Mt._rescale(y,g,m,f,p,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Mt.svgRound(e)} ${Mt.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],r){const[i,s]=r,o=this.#e,a=e-o[0],l=t-o[1];if(this.#s===i&&this.#i===s)for(const{line:c,points:d}of this.#n)Mt._translate(c,a,l,c),Mt._translate(d,a,l,d);else{const c=this.#s/i,d=this.#i/s;this.#s=i,this.#i=s;for(const{line:h,points:f}of this.#n)Mt._rescale(h,a,l,c,d,h),Mt._rescale(f,a,l,c,d,f);o[2]*=c,o[3]*=d}return o[0]=e,o[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Mt.svgRound(e)} ${Mt.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Mt.svgRound(e[0])} ${Mt.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class Sb extends $Q{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Ht._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Sb(this._viewParameters);return e.updateAll(this),e}}class YS extends Ln{static _type="ink";static _editorType=on.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){Ht.initialize(e,t),this._defaultDrawingOptions=new Sb(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return an(this,"typesMap",new Map([[wn.INK_THICKNESS,"stroke-width"],[wn.INK_COLOR,"stroke"],[wn.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,r,i,s){return new Vne(e,t,r,i,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,r,i,s,o){return nm.deserialize(e,t,r,i,s,o)}static async deserialize(e,t,r){let i=null;if(e instanceof WS){const{data:{inkLists:o,rect:a,rotation:l,id:c,color:d,opacity:h,borderStyle:{rawWidth:f},popupRef:p,richText:g,contentsObj:m,creationDate:v,modificationDate:y},parent:{page:{pageNumber:O}}}=e;i=e={annotationType:on.INK,color:Array.from(d),thickness:f,opacity:h,paths:{points:o},boxes:null,pageIndex:O-1,rect:a.slice(0),rotation:l,annotationElementId:c,id:c,deleted:!1,popupRef:p,richText:g,comment:m?.str||null,creationDate:v,modificationDate:y}}const s=await super.deserialize(e,t,r);return s._initialData=i,e.comment&&s.setCommentData(e),s}get toolbarButtons(){return this._colorPicker||=new ng(this),[["colorPicker",this._colorPicker]]}get colorType(){return wn.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:r}=this;t.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:r}){this._drawingOptions=YS.getDefaultDrawingOptions({stroke:Dt.makeHexColor(...e),"stroke-width":t,"stroke-opacity":r})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:r}=this.serializeDraw(e),{_drawingOptions:{stroke:i,"stroke-opacity":s,"stroke-width":o}}=this,a=Object.assign(super.serialize(e),{color:Ht._colorManager.convert(i),opacity:s,thickness:o,paths:{lines:t,points:r}});return this.addComment(a),e?(a.isCopy=!0,a):this.annotationElementId&&!this.#e(a)?null:(a.id=this.annotationElementId,a)}#e(e){const{color:t,thickness:r,opacity:i,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((o,a)=>o!==t[a])||e.thickness!==r||e.opacity!==i||e.pageIndex!==s}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:r}=this.serializeDraw(!1);return e.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class $O extends nm{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Ym=8,Sf=3;class Cd{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,r,i){return r-=e,i-=t,r===0?i>0?0:4:r===1?i+6:2-i}static#r=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(e,t,r,i,s,o,a){const l=this.#t(r,i,s,o);for(let c=0;c<8;c++){const d=(-c+l-a+16)%8,h=this.#r[2*d],f=this.#r[2*d+1];if(e[(r+h)*t+(i+f)]!==0)return d}return-1}static#s(e,t,r,i,s,o,a){const l=this.#t(r,i,s,o);for(let c=0;c<8;c++){const d=(c+l+a+16)%8,h=this.#r[2*d],f=this.#r[2*d+1];if(e[(r+h)*t+(i+f)]!==0)return d}return-1}static#i(e,t,r,i){const s=e.length,o=new Int32Array(s);for(let d=0;d<s;d++)o[d]=e[d]<=i?1:0;for(let d=1;d<r-1;d++)o[d*t]=o[d*t+t-1]=0;for(let d=0;d<t;d++)o[d]=o[t*r-1-d]=0;let a=1,l;const c=[];for(let d=1;d<r-1;d++){l=1;for(let h=1;h<t-1;h++){const f=d*t+h,p=o[f];if(p===0)continue;let g=d,m=h;if(p===1&&o[f-1]===0)a+=1,m-=1;else if(p>=1&&o[f+1]===0)a+=1,m+=1,p>1&&(l=p);else{p!==1&&(l=Math.abs(p));continue}const v=[h,d],y=m===h+1,O={isHole:y,points:v,id:a,parent:0};c.push(O);let _;for(const D of c)if(D.id===l){_=D;break}_?_.isHole?O.parent=y?_.parent:l:O.parent=y?l:_.parent:O.parent=y?l:0;const x=this.#n(o,t,d,h,g,m,0);if(x===-1){o[f]=-a,o[f]!==1&&(l=Math.abs(o[f]));continue}let k=this.#r[2*x],S=this.#r[2*x+1];const E=d+k,R=h+S;g=E,m=R;let C=d,I=h;for(;;){const D=this.#s(o,t,C,I,g,m,1);k=this.#r[2*D],S=this.#r[2*D+1];const Q=C+k,M=I+S;v.push(M,Q);const N=C*t+I;if(o[N+1]===0?o[N]=-a:o[N]===1&&(o[N]=a),Q===d&&M===h&&C===E&&I===R){o[f]!==1&&(l=Math.abs(o[f]));break}else g=C,m=I,C=Q,I=M}}}return c}static#o(e,t,r,i){if(r-t<=4){for(let E=t;E<r-2;E+=2)i.push(e[E],e[E+1]);return}const s=e[t],o=e[t+1],a=e[r-4]-s,l=e[r-3]-o,c=Math.hypot(a,l),d=a/c,h=l/c,f=d*o-h*s,p=l/a,g=1/c,m=Math.atan(p),v=Math.cos(m),y=Math.sin(m),O=g*(Math.abs(v)+Math.abs(y)),_=g*(1-O+O**2),x=Math.max(Math.atan(Math.abs(y+v)*_),Math.atan(Math.abs(y-v)*_));let k=0,S=t;for(let E=t+2;E<r-2;E+=2){const R=Math.abs(f-d*e[E+1]+h*e[E]);R>k&&(S=E,k=R)}k>(c*x)**2?(this.#o(e,t,S+2,i),this.#o(e,S,r,i)):i.push(s,o)}static#a(e){const t=[],r=e.length;return this.#o(e,0,r,t),t.push(e[r-2],e[r-1]),t.length<=4?null:t}static#l(e,t,r,i,s,o){const a=new Float32Array(o**2),l=-2*i**2,c=o>>1;for(let m=0;m<o;m++){const v=(m-c)**2;for(let y=0;y<o;y++)a[m*o+y]=Math.exp((v+(y-c)**2)/l)}const d=new Float32Array(256),h=-2*s**2;for(let m=0;m<256;m++)d[m]=Math.exp(m**2/h);const f=e.length,p=new Uint8Array(f),g=new Uint32Array(256);for(let m=0;m<r;m++)for(let v=0;v<t;v++){const y=m*t+v,O=e[y];let _=0,x=0;for(let S=0;S<o;S++){const E=m+S-c;if(!(E<0||E>=r))for(let R=0;R<o;R++){const C=v+R-c;if(C<0||C>=t)continue;const I=e[E*t+C],D=a[S*o+R]*d[Math.abs(I-O)];_+=I*D,x+=D}}const k=p[y]=Math.round(_/x);g[k]++}return[p,g]}static#c(e){const t=new Uint32Array(256);for(const r of e)t[r]++;return t}static#h(e){const t=e.length,r=new Uint8ClampedArray(t>>2);let i=-1/0,s=1/0;for(let a=0,l=r.length;a<l;a++){const c=r[a]=e[a<<2];i=Math.max(i,c),s=Math.min(s,c)}const o=255/(i-s);for(let a=0,l=r.length;a<l;a++)r[a]=(r[a]-s)*o;return r}static#u(e){let t,r=-1/0,i=-1/0;const s=e.findIndex(l=>l!==0);let o=s,a=s;for(t=s;t<256;t++){const l=e[t];l>r&&(t-o>i&&(i=t-o,a=t-1),r=l,o=t)}for(t=a-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#p(e){const t=e,{width:r,height:i}=e,{maxDim:s}=this.#e;let o=r,a=i;if(r>s||i>s){let f=r,p=i,g=Math.log2(Math.max(r,i)/s);const m=Math.floor(g);g=g===m?m-1:m;for(let y=0;y<g;y++){o=Math.ceil(f/2),a=Math.ceil(p/2);const O=new OffscreenCanvas(o,a);O.getContext("2d").drawImage(e,0,0,f,p,0,0,o,a),f=o,p=a,e!==t&&e.close(),e=O.transferToImageBitmap()}const v=Math.min(s/o,s/a);o=Math.round(o*v),a=Math.round(a*v)}const c=new OffscreenCanvas(o,a).getContext("2d",{willReadFrequently:!0});c.fillStyle="white",c.fillRect(0,0,o,a),c.filter="grayscale(1)",c.drawImage(e,0,0,e.width,e.height,0,0,o,a);const d=c.getImageData(0,0,o,a).data;return[this.#h(d),o,a]}static extractContoursFromText(e,{fontFamily:t,fontStyle:r,fontWeight:i},s,o,a,l){let c=new OffscreenCanvas(1,1),d=c.getContext("2d",{alpha:!1});const h=200,f=d.font=`${r} ${i} ${h}px ${t}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:g,actualBoundingBoxAscent:m,actualBoundingBoxDescent:v,fontBoundingBoxAscent:y,fontBoundingBoxDescent:O,width:_}=d.measureText(e),x=1.5,k=Math.ceil(Math.max(Math.abs(p)+Math.abs(g)||0,_)*x),S=Math.ceil(Math.max(Math.abs(m)+Math.abs(v)||h,Math.abs(y)+Math.abs(O)||h)*x);c=new OffscreenCanvas(k,S),d=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=f,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,k,S),d.fillStyle="black",d.fillText(e,k*(x-1)/2,S*(3-x)/2);const E=this.#h(d.getImageData(0,0,k,S).data),R=this.#c(E),C=this.#u(R),I=this.#i(E,k,S,C);return this.processDrawnLines({lines:{curves:I,width:k,height:S},pageWidth:s,pageHeight:o,rotation:a,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,r,i,s){const[o,a,l]=this.#p(e),[c,d]=this.#l(o,a,l,Math.hypot(a,l)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),h=this.#u(d),f=this.#i(c,a,l,h);return this.processDrawnLines({lines:{curves:f,width:a,height:l},pageWidth:t,pageHeight:r,rotation:i,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:r,rotation:i,innerMargin:s,mustSmooth:o,areContours:a}){i%180!==0&&([t,r]=[r,t]);const{curves:l,width:c,height:d}=e,h=e.thickness??0,f=[],p=Math.min(t/c,r/d),g=p/t,m=p/r,v=[];for(const{points:O}of l){const _=o?this.#a(O):O;if(!_)continue;v.push(_);const x=_.length,k=new Float32Array(x),S=new Float32Array(3*(x===2?2:x-2));if(f.push({line:S,points:k}),x===2){k[0]=_[0]*g,k[1]=_[1]*m,S.set([NaN,NaN,NaN,NaN,k[0],k[1]],0);continue}let[E,R,C,I]=_;E*=g,R*=m,C*=g,I*=m,k.set([E,R,C,I],0),S.set([NaN,NaN,NaN,NaN,E,R],0);for(let D=4;D<x;D+=2){const Q=k[D]=_[D]*g,M=k[D+1]=_[D+1]*m;S.set(Mt.createBezierPoints(E,R,C,I,Q,M),(D-2)*3),[E,R,C,I]=[C,I,Q,M]}}if(f.length===0)return null;const y=a?new $O:new nm;return y.build(f,t,r,1,i,a?0:h,s),{outline:y,newCurves:v,areContours:a,thickness:h,width:c,height:d}}static async compressSignature({outlines:e,areContours:t,thickness:r,width:i,height:s}){let o=1/0,a=-1/0,l=0;for(const _ of e){l+=_.length;for(let x=2,k=_.length;x<k;x++){const S=_[x]-_[x-2];o=Math.min(o,S),a=Math.max(a,S)}}let c;o>=-128&&a<=127?c=Int8Array:o>=-32768&&a<=32767?c=Int16Array:c=Int32Array;const d=e.length,h=Ym+Sf*d,f=new Uint32Array(h);let p=0;f[p++]=h*Uint32Array.BYTES_PER_ELEMENT+(l-2*d)*c.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=i,f[p++]=s,f[p++]=t?0:1,f[p++]=Math.max(0,Math.floor(r??0)),f[p++]=d,f[p++]=c.BYTES_PER_ELEMENT;for(const _ of e)f[p++]=_.length-2,f[p++]=_[0],f[p++]=_[1];const g=new CompressionStream("deflate-raw"),m=g.writable.getWriter();await m.ready,m.write(f);const v=c.prototype.constructor;for(const _ of e){const x=new v(_.length-2);for(let k=2,S=_.length;k<S;k++)x[k-2]=_[k]-_[k-2];m.write(x)}m.close();const y=await new Response(g.readable).arrayBuffer(),O=new Uint8Array(y);return hQ(O)}static async decompressSignature(e){try{const t=ote(e),{readable:r,writable:i}=new DecompressionStream("deflate-raw"),s=i.getWriter();await s.ready,s.write(t).then(async()=>{await s.ready,await s.close()}).catch(()=>{});let o=null,a=0;for await(const _ of r)o||=new Uint8Array(new Uint32Array(_.buffer,0,4)[0]),o.set(_,a),a+=_.length;const l=new Uint32Array(o.buffer,0,o.length>>2),c=l[1];if(c!==0)throw new Error(`Invalid version: ${c}`);const d=l[2],h=l[3],f=l[4]===0,p=l[5],g=l[6],m=l[7],v=[],y=(Ym+Sf*g)*Uint32Array.BYTES_PER_ELEMENT;let O;switch(m){case Int8Array.BYTES_PER_ELEMENT:O=new Int8Array(o.buffer,y);break;case Int16Array.BYTES_PER_ELEMENT:O=new Int16Array(o.buffer,y);break;case Int32Array.BYTES_PER_ELEMENT:O=new Int32Array(o.buffer,y);break}a=0;for(let _=0;_<g;_++){const x=l[Sf*_+Ym],k=new Float32Array(x+2);v.push(k);for(let S=0;S<Sf-1;S++)k[S]=l[Sf*_+Ym+S+1];for(let S=0;S<x;S++)k[S+2]=k[S]+O[a++]}return{areContours:f,thickness:p,outlines:v,width:d,height:h}}catch(t){return rn(`decompressSignature: ${t}`),null}}}class GS extends $Q{constructor(){super(),super.updateProperties({fill:Ht._defaultLineColor,"stroke-width":0})}clone(){const e=new GS;return e.updateAll(this),e}}class KS extends Sb{constructor(e){super(e),super.updateProperties({stroke:Ht._defaultLineColor,"stroke-width":1})}clone(){const e=new KS(this._viewParameters);return e.updateAll(this),e}}class pa extends Ln{#e=!1;#t=null;#r=null;#n=null;static _type="signature";static _editorType=on.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#r=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){Ht.initialize(e,t),this._defaultDrawingOptions=new GS,this._defaultDrawnSignatureOptions=new KS(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return an(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:r}=this;if(r&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#r){const{lines:i,mustSmooth:s,areContours:o,description:a,uuid:l,heightInPage:c}=this.#r,{rawDims:{pageWidth:d,pageHeight:h},rotation:f}=this.parent.viewport,p=Cd.processDrawnLines({lines:i,pageWidth:d,pageHeight:h,rotation:f,innerMargin:pa._INNER_MARGIN,mustSmooth:s,areContours:o});this.addSignature(p,c,a,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#t||""}));return r&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#n=e,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#t}set description(e){this.#t=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:r,width:i,height:s}=this.#r,o=Math.max(i,s),a=Cd.processDrawnLines({lines:{curves:e.map(l=>({points:l})),thickness:r,width:i,height:s},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,r,i){const{x:s,y:o}=this,{outline:a}=this.#r=e;this.#e=a instanceof $O,this.description=r;let l;this.#e?l=pa.getDefaultDrawingOptions():(l=pa._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:l});const[,c]=this.pageDimensions;let d=t/c;d=d>=1?.5:d,this.width*=d/this.height,this.width>=1&&(d*=.9/this.width,this.width=.9),this.height=d,this.setDims(),this.x=s,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!r}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:r},rotation:i}=this.parent.viewport;return Cd.process(e,t,r,i,pa._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:r,pageHeight:i},rotation:s}=this.parent.viewport;return Cd.extractContoursFromText(e,t,r,i,s,pa._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:r},rotation:i}=this.parent.viewport;return Cd.processDrawnLines({lines:e,pageWidth:t,pageHeight:r,rotation:i,innerMargin:pa._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=pa.getDefaultDrawingOptions():(this._drawingOptions=pa._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:r}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":i}}=this,s=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:i});return this.addComment(s),e?(s.paths={lines:t,points:r},s.uuid=this.#n,s.isCopy=!0):s.lines=t,this.#t&&(s.accessibilityData={type:"Figure",alt:this.#t}),s}static deserializeDraw(e,t,r,i,s,o){return o.areContours?$O.deserialize(e,t,r,i,s,o):nm.deserialize(e,t,r,i,s,o)}static async deserialize(e,t,r){const i=await super.deserialize(e,t,r);return i.#e=e.areContours,i.description=e.accessibilityData?.alt||"",i.#n=e.uuid,i}}class qne extends Ht{#e=null;#t=null;#r=null;#n=null;#s=null;#i="";#o=null;#a=!1;#l=null;#c=!1;#h=!1;static _type="stamp";static _editorType=on.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#n=e.bitmapUrl,this.#s=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){Ht.initialize(e,t)}static isHandlingMimeForPasting(e){return EO.includes(e)}static paste(e,t){t.pasteEditor({mode:on.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#u(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#c=e.isSvg),e.file&&(this.#i=e.file.name),this.#f()}#p(){if(this.#r=null,this._uiManager.enableWaiting(!1),!!this.#o){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:s,height:o}=e||this.copyCanvas(null,null,!0).imageData,a=await r.guess({name:"altText",request:{data:i,width:s,height:o,channels:i.length/(s*o)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const l=a.output;return await this.setGuessedAltText(l),t&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#m(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(r=>this.#u(r,!0)).finally(()=>this.#p());return}if(this.#n){const r=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#r=this._uiManager.imageManager.getFromUrl(r).then(i=>this.#u(i)).finally(()=>this.#p());return}if(this.#s){const r=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#r=this._uiManager.imageManager.getFromFile(r).then(i=>this.#u(i)).finally(()=>this.#p());return}const e=document.createElement("input");e.type="file",e.accept=EO.join(",");const t=this._uiManager._signal;this.#r=new Promise(r=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#u(i)}r()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),r()},{signal:t})}).finally(()=>this.#p()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#o?.remove(),this.#o=null,this.#l&&(clearTimeout(this.#l),this.#l=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#m();return}super.rebuild(),this.div!==null&&(this.#t&&this.#o===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#r||this.#e||this.#n||this.#s||this.#t||this.#a)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#a||(this.#e?this.#f():this.#m()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:r,bitmap:i}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),r&&this._uiManager.imageManager.isValidId(r)&&(this.#t=r,i&&(this.#e=i),this.#a=!1,this.#f())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#l!==null&&clearTimeout(this.#l);const e=200;this.#l=setTimeout(()=>{this.#l=null,this.#g()},e)}#f(){const{div:e}=this;let{width:t,height:r}=this.#e;const[i,s]=this.pageDimensions,o=.75;if(this.width)t=this.width*i,r=this.height*s;else if(t>o*i||r>o*s){const l=Math.min(o*i/t,o*s/r);t*=l,r*=l}this._uiManager.enableWaiting(!1);const a=this.#o=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=t/i,this.height=r/s,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#g(),this.#h||(this.parent.addUndoableEditor(this),this.#h=!0),this._reportTelemetry({action:"inserted_image"}),this.#i&&this.div.setAttribute("aria-description",this.#i),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,r=!1){e||(e=224);const{width:i,height:s}=this.#e,o=new za;let a=this.#e,l=i,c=s,d=null;if(t){if(i>t||s>t){const S=Math.min(t/i,t/s);l=Math.floor(i*S),c=Math.floor(s*S)}d=document.createElement("canvas");const f=d.width=Math.ceil(l*o.sx),p=d.height=Math.ceil(c*o.sy);this.#c||(a=this.#d(f,p));const g=d.getContext("2d");g.filter=this._uiManager.hcmFilter;let m="white",v="#cfcfd8";this._uiManager.hcmFilter!=="none"?v="black":hte.isDarkMode&&(m="#8f8f9d",v="#42414d");const y=15,O=y*o.sx,_=y*o.sy,x=new OffscreenCanvas(O*2,_*2),k=x.getContext("2d");k.fillStyle=m,k.fillRect(0,0,O*2,_*2),k.fillStyle=v,k.fillRect(0,0,O,_),k.fillRect(O,_,O,_),g.fillStyle=g.createPattern(x,"repeat"),g.fillRect(0,0,f,p),g.drawImage(a,0,0,a.width,a.height,0,0,f,p)}let h=null;if(r){let f,p;if(o.symmetric&&a.width<e&&a.height<e)f=a.width,p=a.height;else if(a=this.#e,i>e||s>e){const v=Math.min(e/i,e/s);f=Math.floor(i*v),p=Math.floor(s*v),this.#c||(a=this.#d(f,p))}const m=new OffscreenCanvas(f,p).getContext("2d",{willReadFrequently:!0});m.drawImage(a,0,0,a.width,a.height,0,0,f,p),h={width:f,height:p,data:m.getImageData(0,0,f,p).data}}return{canvas:d,width:l,height:c,imageData:h}}#d(e,t){const{width:r,height:i}=this.#e;let s=r,o=i,a=this.#e;for(;s>2*e||o>2*t;){const l=s,c=o;s>2*e&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const d=new OffscreenCanvas(s,o);d.getContext("2d").drawImage(a,0,0,l,c,0,0,s,o),a=d.transferToImageBitmap()}return a}#g(){const[e,t]=this.parentDimensions,{width:r,height:i}=this,s=new za,o=Math.ceil(r*e*s.sx),a=Math.ceil(i*t*s.sy),l=this.#o;if(!l||l.width===o&&l.height===a)return;l.width=o,l.height=a;const c=this.#c?this.#e:this.#d(o,a),d=l.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(c,0,0,c.width,c.height,0,0,o,a)}#y(e){if(e){if(this.#c){const i=this._uiManager.imageManager.getSvgUrl(this.#t);if(i)return i}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#c){const[t,r]=this.pageDimensions,i=Math.round(this.width*t*Eh.PDF_TO_CSS_UNITS),s=Math.round(this.height*r*Eh.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,s);return o.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,i,s),o.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,r){let i=null,s=!1;if(e instanceof LQ){const{data:{rect:m,rotation:v,id:y,structParent:O,popupRef:_,richText:x,contentsObj:k,creationDate:S,modificationDate:E},container:R,parent:{page:{pageNumber:C}},canvas:I}=e;let D,Q;I?(delete e.canvas,{id:D,bitmap:Q}=r.imageManager.getFromCanvas(R.id,I),I.remove()):(s=!0,e._hasNoCanvas=!0);const M=(await t._structTree.getAriaAttributes(`${zd}${y}`))?.get("aria-label")||"";i=e={annotationType:on.STAMP,bitmapId:D,bitmap:Q,pageIndex:C-1,rect:m.slice(0),rotation:v,annotationElementId:y,id:y,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:O,popupRef:_,richText:x,comment:k?.str||null,creationDate:S,modificationDate:E}}const o=await super.deserialize(e,t,r),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:h,accessibilityData:f}=e;s?(r.addMissingCanvas(e.id,o),o.#a=!0):d&&r.imageManager.isValidId(d)?(o.#t=d,l&&(o.#e=l)):o.#n=c,o.#c=h;const[p,g]=o.pageDimensions;return o.width=(a[2]-a[0])/p,o.height=(a[3]-a[1])/g,f&&(o.altTextData=f),o._initialData=i,e.comment&&o.setCommentData(e),o.#h=!!i,o}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r=Object.assign(super.serialize(e),{bitmapId:this.#t,isSvg:this.#c});if(this.addComment(r),e)return r.bitmapUrl=this.#y(!0),r.accessibilityData=this.serializeAltText(!0),r.isCopy=!0,r;const{decorative:i,altText:s}=this.serializeAltText(!1);if(!i&&s&&(r.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){const a=this.#b(r);return a.isSame?null:(a.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1,r.id=this.annotationElementId,delete r.bitmapId,r)}if(t===null)return r;t.stamps||=new Map;const o=this.#c?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:o,serialized:r}),r.bitmap=this.#y(!1);else if(this.#c){const a=t.stamps.get(this.#t);o>a.area&&(a.area=o,a.serialized.bitmap.close(),a.serialized.bitmap=this.#y(!1))}return r}#b(e){const{pageIndex:t,accessibilityData:{altText:r}}=this._initialData,i=e.pageIndex===t,s=(e.accessibilityData?.alt||"")===r;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&s,isSameAltText:s}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class sl{#e;#t=!1;#r=null;#n=null;#s=null;#i=new Map;#o=!1;#a=!1;#l=!1;#c=null;#h=null;#u=null;#p=null;#m=null;#f=-1;#d;static _initialized=!1;static#g=new Map([Xr,YS,qne,kr,pa].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:r,structTreeLayer:i,accessibilityManager:s,annotationLayer:o,drawLayer:a,textLayer:l,viewport:c,l10n:d}){const h=[...sl.#g.values()];if(!sl._initialized){sl._initialized=!0;for(const f of h)f.initialize(d,e)}e.registerEditorTypes(h),this.#d=e,this.pageIndex=t,this.div=r,this.#e=s,this.#r=o,this.viewport=c,this.#u=l,this.drawLayer=a,this._structTree=i,this.#d.addLayer(this)}get isEmpty(){return this.#i.size===0}get isInvisible(){return this.isEmpty&&this.#d.getMode()===on.NONE}updateToolbar(e){this.#d.updateToolbar(e)}updateMode(e=this.#d.getMode()){switch(this.#_(),e){case on.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case on.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case on.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===on.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const r of sl.#g.values())t.toggle(`${r._type}Editing`,e===r._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#u?.div}setEditingState(e){this.#d.setEditingState(e)}addCommands(e){this.#d.addCommands(e)}cleanUndoStack(e){this.#d.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#r?.togglePointerEvents(e)}get#y(){return this.#i.size!==0?this.#i.values():this.#d.getEditors(this.pageIndex)}async enable(){this.#l=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const e=new Set;for(const r of this.#y)r.enableEditing(),r.show(!0),r.annotationElementId&&(this.#d.removeChangedExistingAnnotation(r),e.add(r.annotationElementId));const t=this.#r;if(t)for(const r of t.getEditableAnnotations()){if(r.hide(),this.#d.isDeletedAnnotationElement(r.data.id)||e.has(r.data.id))continue;const i=await this.deserialize(r);i&&(this.addOrRebuild(i),i.enableEditing())}this.#l=!1,this.#d._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#u&&!this.#m){this.#m=new AbortController;const i=this.#d.combinedSignal(this.#m);this.#u.div.addEventListener("pointerdown",s=>{const{clientX:a,clientY:l,timeStamp:c}=s,d=this.#f;if(c-d>500){this.#f=c;return}this.#f=-1;const{classList:h}=this.div;h.toggle("getElements",!0);const f=document.elementsFromPoint(a,l);if(h.toggle("getElements",!1),!this.div.contains(f[0]))return;let p;const g=new RegExp(`^${Jp}[0-9]+$`);for(const v of f)if(g.test(v.id)){p=v.id;break}if(!p)return;const m=this.#i.get(p);m?.annotationElementId===null&&(s.stopPropagation(),s.preventDefault(),m.dblclick(s))},{signal:i,capture:!0})}const e=this.#r,t=[];if(e){const i=new Map,s=new Map;for(const a of this.#y){if(a.disableEditing(),!a.annotationElementId){t.push(a);continue}if(a.serialize()!==null){i.set(a.annotationElementId,a);continue}else s.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}const o=e.getEditableAnnotations();for(const a of o){const{id:l}=a.data;if(this.#d.isDeletedAnnotationElement(l)){a.updateEdited({deleted:!0});continue}let c=s.get(l);if(c){c.resetAnnotationElement(a),c.show(!1),a.show();continue}c=i.get(l),c&&(this.#d.addChangedExistingAnnotation(c),c.renderAnnotationElement(a)&&c.show(!1)),a.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);const{classList:r}=this.div;for(const i of sl.#g.values())r.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e?.updateFakeAnnotations(t),this.#a=!1}getEditableAnnotation(e){return this.#r?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#d.getActive()!==e&&this.#d.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#u?.div&&!this.#p){this.#p=new AbortController;const e=this.#d.combinedSignal(this.#p);this.#u.div.addEventListener("pointerdown",this.#b.bind(this),{signal:e}),this.#u.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#u?.div&&this.#p&&(this.#p.abort(),this.#p=null,this.#u.div.classList.remove("highlighting"))}#b(e){this.#d.unselectAll();const{target:t}=e;if(t===this.#u.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#u.div.contains(t)){const{isMac:r}=hi.platform;if(e.button!==0||e.ctrlKey&&r)return;this.#d.showAllEditors("highlight",!0,!0),this.#u.div.classList.add("free"),this.toggleDrawing(),kr.startHighlighting(this,this.#d.direction==="ltr",{target:this.#u.div,x:e.x,y:e.y}),this.#u.div.addEventListener("pointerup",()=>{this.#u.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#d._signal}),e.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const e=this.#d.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#n?.abort(),this.#n=null}attach(e){this.#i.set(e.id,e);const{annotationElementId:t}=e;t&&this.#d.isDeletedAnnotationElement(t)&&this.#d.removeDeletedAnnotationElement(e)}detach(e){this.#i.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#a&&e.annotationElementId&&this.#d.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#d.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#d.addDeletedAnnotationElement(e.annotationElementId),Ht.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#d.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#l),this.#d.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#s&&(e._focusEventsAllowed=!1,this.#s=setTimeout(()=>{this.#s=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#d._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),r=()=>{e.remove()};this.addCommands({cmd:t,undo:r,mustExec:!1})}getEditorByUID(e){for(const t of this.#i.values())if(t.uid===e)return t;return null}getNextId(){return this.#d.getId()}get#v(){return sl.#g.get(this.#d.getMode())}combinedSignal(e){return this.#d.combinedSignal(e)}#k(e){const t=this.#v;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#v?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#d.updateMode(e.mode);const{offsetX:r,offsetY:i}=this.#x(),s=this.getNextId(),o=this.#k({parent:this,id:s,x:r,y:i,uiManager:this.#d,isCentered:!0,...t});o&&this.add(o)}async deserialize(e){return await sl.#g.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#d)||null}createAndAddNewEditor(e,t,r={}){const i=this.getNextId(),s=this.#k({parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:this.#d,isCentered:t,...r});return s&&this.add(s),s}get boundingClientRect(){return this.div.getBoundingClientRect()}#x(){const{x:e,y:t,width:r,height:i}=this.boundingClientRect,s=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+r),l=Math.min(window.innerHeight,t+i),c=(s+a)/2-e,d=(o+l)/2-t,[h,f]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:h,offsetY:f}}addNewEditor(e={}){this.createAndAddNewEditor(this.#x(),!0,e)}setSelected(e){this.#d.setSelected(e)}toggleSelected(e){this.#d.toggleSelected(e)}unselect(e){this.#d.unselect(e)}pointerup(e){const{isMac:t}=hi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#o||(this.#o=!1,this.#v?.isDrawer&&this.#v.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const r=this.#d.getMode();if(r===on.STAMP||r===on.SIGNATURE){this.#d.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#d.getMode()===on.HIGHLIGHT&&this.enableTextSelection(),this.#o){this.#o=!1;return}const{isMac:t}=hi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#o=!0,this.#v?.isDrawer){this.startDrawingSession(e);return}const r=this.#d.getActive();this.#t=!r||r.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#c){this.#v.startDrawing(this,this.#d,!1,e);return}this.#d.setCurrentDrawingSession(this),this.#c=new AbortController;const t=this.#d.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:r})=>{r&&!this.div.contains(r)&&(this.#h=null,this.commitOrRemove())},{signal:t}),this.#v.startDrawing(this,this.#d,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#h=t);return}this.#h&&setTimeout(()=>{this.#h?.focus(),this.#h=null},0)}endDrawingSession(e=!1){return this.#c?(this.#d.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#h=null,this.#v.endDrawing(e)):null}findNewParent(e,t,r){const i=this.#d.findParent(t,r);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#v.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#d.getActive()?.parent===this&&(this.#d.commitOrRemove(),this.#d.setActiveEditor(null)),this.#s&&(clearTimeout(this.#s),this.#s=null);for(const e of this.#i.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#i.clear(),this.#d.removeLayer(this)}#_(){for(const e of this.#i.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,Su(this.div,e);for(const t of this.#d.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#d.commitOrRemove(),this.#_();const t=this.viewport.rotation,r=e.rotation;if(this.viewport=e,Su(this.div,{rotation:r}),t!==r)for(const i of this.#i.values())i.rotate(r)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#d.viewParameters.realScale}}class ti{#e=null;#t=new Map;#r=new Map;static#n=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return an(this,"_svgFactory",new Qy)}static#s(e,[t,r,i,s]){const{style:o}=e;o.top=`${100*r}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*s}%`}#i(){const e=ti._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#o(e,t){const r=ti._svgFactory.createElement("clipPath");e.append(r);const i=`clip_${t}`;r.setAttribute("id",i),r.setAttribute("clipPathUnits","objectBoundingBox");const s=ti._svgFactory.createElement("use");return r.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),i}#a(e,t){for(const[r,i]of Object.entries(t))i===null?e.removeAttribute(r):e.setAttribute(r,i)}draw(e,t=!1,r=!1){const i=ti.#n++,s=this.#i(),o=ti._svgFactory.createElement("defs");s.append(o);const a=ti._svgFactory.createElement("path");o.append(a);const l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#r.set(i,a);const c=r?this.#o(o,l):null,d=ti._svgFactory.createElement("use");return s.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(s,e),this.#t.set(i,s),{id:i,clipPathId:`url(#${c})`}}drawOutline(e,t){const r=ti.#n++,i=this.#i(),s=ti._svgFactory.createElement("defs");i.append(s);const o=ti._svgFactory.createElement("path");s.append(o);const a=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const h=ti._svgFactory.createElement("mask");s.append(h),l=`mask_p${this.pageIndex}_${r}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");const f=ti._svgFactory.createElement("rect");h.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=ti._svgFactory.createElement("use");h.append(p),p.setAttribute("href",`#${a}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const c=ti._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);const d=c.cloneNode();return i.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,e),this.#t.set(r,i),r}finalizeDraw(e,t){this.#r.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:r,bbox:i,rootClass:s,path:o}=t,a=typeof e=="number"?this.#t.get(e):e;if(a){if(r&&this.#a(a,r),i&&ti.#s(a,i),s){const{classList:l}=a;for(const[c,d]of Object.entries(s))l.toggle(c,d)}if(o){const c=a.firstChild.firstChild;this.#a(c,o)}}}updateParent(e,t){if(t===this)return;const r=this.#t.get(e);r&&(t.#e.append(r),this.#t.delete(e),t.#t.set(e,r))}remove(e){this.#r.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#r.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:LO};globalThis.pdfjsLib={AbortException:yc,AnnotationEditorLayer:sl,AnnotationEditorParamsType:wn,AnnotationEditorType:on,AnnotationEditorUIManager:bc,AnnotationLayer:XS,AnnotationMode:Wl,AnnotationType:Pr,applyOpacity:pte,build:_ne,ColorPicker:Js,createValidAbsoluteUrl:lQ,CSSConstants:fte,DOMSVGFactory:Qy,DrawLayer:ti,FeatureTest:hi,fetchData:Gg,findContrastColor:gte,getDocument:kb,getFilenameFromUrl:ate,getPdfFilenameFromUrl:lte,getRGB:Jg,getUuid:dQ,getXfaPageViewport:ute,GlobalWorkerOptions:ac,ImageKind:Uv,InvalidPDFException:AO,isDataScheme:_b,isPdfFile:FS,isValidExplicitDest:Ste,MathClamp:Ri,noContextMenu:bo,normalizeUnicode:ite,OPS:eg,OutputScale:za,PasswordResponses:Xee,PDFDataRangeTransport:IQ,PDFDateString:CO,PDFWorker:ri,PermissionFlag:Wee,PixelsPerInch:Eh,RenderingCancelledException:$S,renderRichText:pQ,ResponseException:Ny,setLayerDimensions:Su,shadow:an,SignatureExtractor:Cd,stopEvent:br,SupportedImageMimeTypes:EO,TextLayer:bi,TouchManager:Ob,updateUrlHash:cQ,Util:Dt,VerbosityLevel:yb,version:wne,XfaLayer:fQ};const JS="/app/assets/pdf.worker.min-Cpi8b8z3.mjs";ac.workerSrc=JS;async function FQ(n,e){try{const r=await kb({data:n}).promise,s=(await r.getMetadata()).info,o=s?.Title||s?.title||Xw(e),a=s?.Author||s?.author,l=s?.Creator||s?.creator,c=s?.Producer||s?.producer;return{title:o||Xw(e),author:a,creator:l,producer:c,pageCount:r.numPages}}catch(t){return console.warn("[PDF Import] Failed to extract metadata:",t),{title:Xw(e),pageCount:1}}}function Xw(n){let e=n.replace(/\.pdf$/i,"");return e=e.replace(/[-_]/g," "),e=e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "),e}async function zQ(n){const e=await n.arrayBuffer(),t=await Hu.store(e);Za()&&await Xu("pdf",t,new Uint8Array(e));const r=await FQ(e,n.name),i=R5({title:r.title||n.name,pdfHash:t,totalPages:r.pageCount,pdfTitle:r.title,pdfAuthor:r.author});return Dr({type:"note",id:i}),cn({type:"note",id:i}),{noteId:i,hash:t,title:r.title||n.name,author:r.author,pageCount:r.pageCount}}async function BQ(n,e){const t=n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),r=await Hu.store(t);Za()&&await Xu("pdf",r,new Uint8Array(t));const i=await FQ(t,e),s=R5({title:i.title||e,pdfHash:r,totalPages:i.pageCount,pdfTitle:i.title,pdfAuthor:i.author});return Dr({type:"note",id:s}),cn({type:"note",id:s}),{noteId:s,hash:r,title:i.title||e,author:i.author,pageCount:i.pageCount}}async function Hne(n){let e;try{e=new URL(n)}catch{throw new Error("Invalid URL")}if(!["http:","https:"].includes(e.protocol))throw new Error("Only HTTP and HTTPS URLs are supported");const t=await window.api?.archiveWebpage({url:n});if(!t)throw new Error("Failed to archive webpage - IPC not available");const{html:r,metadata:i}=t,s=await Fa.store(r);if(await Fa.storeMetadata(s,i),Za()){const a=new TextEncoder;await Xu("webpage",s,a.encode(r),{metadata:i})}const o=D5({title:i.title||"Untitled",webpageHash:s,webpageUrl:i.url,webpageTitle:i.title,webpageAuthor:i.author,webpageSiteName:i.siteName,webpageExcerpt:i.excerpt});return Dr({type:"note",id:o}),cn({type:"note",id:o}),{noteId:o,hash:s,title:i.title||"Untitled",url:i.url,author:i.author,siteName:i.siteName}}async function UQ(n,e,t){const r=await Fa.store(e);t&&await Fa.storeMetadata(r,t);const i=t?.title||"Imported Webpage",s=t?.url||"",o=t?.author,a=t?.siteName,l=t?.excerpt,c=D5({title:i,webpageHash:r,webpageUrl:s,webpageTitle:i,webpageAuthor:o,webpageSiteName:a,webpageExcerpt:l});return Dr({type:"note",id:c}),cn({type:"note",id:c}),{noteId:c,hash:r,title:i,url:s,author:o,siteName:a}}const Zne=/!\[[^\]]*\]\(opfs:\/\/images\/([a-f0-9]{8})\.(\w+)\)/gi;async function Wne(){const n={epubHashes:new Set,pdfHashes:new Set,webpageHashes:new Set,imageRefs:new Set},e=cs();for(const t of e){const r=t.props?.epubHash;r&&n.epubHashes.add(r);const i=t.props?.pdfHash;i&&n.pdfHashes.add(i);const s=t.props?.webpageHash;s&&n.webpageHashes.add(s);try{const o=await ns(t.id);if(o){let a;for(;(a=Zne.exec(o))!==null;){const l=a[1],c=a[2];n.imageRefs.add(`${l}.${c}`)}}}catch{}}return console.log(`[FileSync] Vault file hashes: ${n.epubHashes.size} EPUBs, ${n.pdfHashes.size} PDFs, ${n.webpageHashes.size} webpages, ${n.imageRefs.size} images`),n}function Tb(){return typeof window<"u"&&!!window.api?.automergeSync}async function Xu(n,e,t,r){if(!Tb()||!Za())return;const i=window.api?.automergeSync;if(i)try{await i.writeFileToFilesystem({fileType:n,hash:e,data:t,extension:r?.extension,metadata:r?.metadata})}catch(s){console.error(`[FileSync] Failed to sync ${n} to filesystem:`,s)}}async function jQ(n){console.log(`[FileSync] Handling file added from filesystem: ${n.fileType}/${n.hash}`);try{switch(n.fileType){case"pdf":{await Hu.exists(n.hash)||await BQ(n.data,`imported-${n.hash}.pdf`);break}case"epub":{await Vu.exists(n.hash)||await ZQ(n.data,`imported-${n.hash}.epub`);break}case"webpage":{if(!await Fa.exists(n.hash)){const r=new TextDecoder().decode(n.data);await UQ(n.hash,r,n.metadata)}break}case"image":{if(!n.extension){console.warn("[FileSync] Image file added without extension, skipping");return}if(!await vc.exists(n.hash,n.extension)){const t=n.data.buffer.slice(n.data.byteOffset,n.data.byteOffset+n.data.byteLength);await vc.storeWithFilename(t,`${n.hash}.${n.extension}`)}break}}}catch(e){console.error(`[FileSync] Failed to import ${n.fileType} from filesystem:`,e)}}async function Xne(){if(!Tb()||!Za())return;console.log("[FileSync] Performing initial file sync (OPFS -> filesystem)");const n=window.api?.automergeSync;if(n)try{const e=await Wne();let t=0;for(const o of e.epubHashes)if(!await n.fileExistsOnFilesystem({fileType:"epub",hash:o})){const l=await Vu.retrieve(o);l&&(await n.writeFileToFilesystem({fileType:"epub",hash:o,data:new Uint8Array(l)}),t++)}console.log(`[FileSync] Synced ${t}/${e.epubHashes.size} EPUBs (vault-scoped)`);let r=0;for(const o of e.pdfHashes)if(!await n.fileExistsOnFilesystem({fileType:"pdf",hash:o})){const l=await Hu.retrieve(o);l&&(await n.writeFileToFilesystem({fileType:"pdf",hash:o,data:new Uint8Array(l)}),r++)}console.log(`[FileSync] Synced ${r}/${e.pdfHashes.size} PDFs (vault-scoped)`);let i=0;for(const o of e.webpageHashes)if(!await n.fileExistsOnFilesystem({fileType:"webpage",hash:o})){const l=await Fa.retrieve(o),c=await Fa.retrieveMetadata(o);if(l){const d=new TextEncoder;await n.writeFileToFilesystem({fileType:"webpage",hash:o,data:d.encode(l),metadata:c??void 0}),i++}}console.log(`[FileSync] Synced ${i}/${e.webpageHashes.size} webpages (vault-scoped)`);let s=0;for(const o of e.imageRefs){const[a,l]=o.split(".");if(!await n.fileExistsOnFilesystem({fileType:"image",hash:a,extension:l})){const d=await vc.retrieve(a,l);d&&(await n.writeFileToFilesystem({fileType:"image",hash:a,data:new Uint8Array(d),extension:l}),s++)}}console.log(`[FileSync] Synced ${s}/${e.imageRefs.size} images (vault-scoped)`),console.log("[FileSync] Initial file sync complete")}catch(e){console.error("[FileSync] Initial file sync failed:",e)}}async function Yne(){if(!Tb()||!Za())return;console.log("[FileSync] Performing reverse file sync (filesystem -> OPFS)");const n=window.api?.automergeSync;if(n)try{const e=await n.listFilesInFilesystem({fileType:"pdf"});for(const s of e)if(!await Hu.exists(s.hash)){const a=await n.readFileFromFilesystem({fileType:"pdf",hash:s.hash});a&&await BQ(a.data,`imported-${s.hash}.pdf`)}console.log(`[FileSync] Checked ${e.length} PDFs from filesystem`);const t=await n.listFilesInFilesystem({fileType:"epub"});for(const s of t)if(!await Vu.exists(s.hash)){const a=await n.readFileFromFilesystem({fileType:"epub",hash:s.hash});a&&await ZQ(a.data,`imported-${s.hash}.epub`)}console.log(`[FileSync] Checked ${t.length} EPUBs from filesystem`);const r=await n.listFilesInFilesystem({fileType:"webpage"});for(const s of r)if(!await Fa.exists(s.hash)){const a=await n.readFileFromFilesystem({fileType:"webpage",hash:s.hash});if(a){const c=new TextDecoder().decode(a.data);await UQ(s.hash,c,a.metadata)}}console.log(`[FileSync] Checked ${r.length} webpages from filesystem`);const i=await n.listFilesInFilesystem({fileType:"image"});for(const s of i){if(!s.extension)continue;if(!await vc.exists(s.hash,s.extension)){const a=await n.readFileFromFilesystem({fileType:"image",hash:s.hash,extension:s.extension});if(a){const l=a.data.buffer.slice(a.data.byteOffset,a.data.byteOffset+a.data.byteLength);await vc.storeWithFilename(l,`${s.hash}.${s.extension}`)}}}console.log(`[FileSync] Checked ${i.length} images from filesystem`),console.log("[FileSync] Reverse file sync complete")}catch(e){console.error("[FileSync] Reverse file sync failed:",e)}}function Gne(){const n=window.api?.automergeSync;return n?(n.removeFileAddedListener(),n.onFileAddedFromFilesystem(async e=>{await jQ(e)}),()=>{n.removeFileAddedListener()}):()=>{}}const VQ=Object.freeze(Object.defineProperty({__proto__:null,handleFileAddedFromFilesystem:jQ,isFileSyncAvailable:Tb,performInitialFileSync:Xne,performReverseFileSync:Yne,setupFileSyncListener:Gne,syncFileToFilesystem:Xu},Symbol.toStringTag,{value:"Module"}));function _E(n,e){const t=n[e];return t?new TextDecoder().decode(t):null}function qQ(n,e){try{const t=new Uint8Array(n),r=rQ(t),i=_E(r,"META-INF/container.xml");if(!i)return{title:Tf(e)};const s=new DOMParser,l=s.parseFromString(i,"text/xml").querySelector("rootfile")?.getAttribute("full-path");if(!l)return{title:Tf(e)};const c=_E(r,l);if(!c)return{title:Tf(e)};const d=s.parseFromString(c,"text/xml"),h=d.querySelector("metadata title")||d.querySelector("dc\\:title")||d.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/","title")[0],f=d.querySelector("metadata creator")||d.querySelector("dc\\:creator")||d.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/","creator")[0],p=d.querySelector("metadata publisher")||d.querySelector("dc\\:publisher")||d.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/","publisher")[0],g=d.querySelector("metadata language")||d.querySelector("dc\\:language")||d.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/","language")[0],m=d.querySelector("metadata description")||d.querySelector("dc\\:description")||d.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/","description")[0];return{title:h?.textContent?.trim()||Tf(e),author:f?.textContent?.trim(),publisher:p?.textContent?.trim(),language:g?.textContent?.trim(),description:m?.textContent?.trim()}}catch(t){return console.warn("[EPUB Import] Failed to extract metadata:",t),{title:Tf(e)}}}function Tf(n){let e=n.replace(/\.epub$/i,"");return e=e.replace(/[-_]/g," "),e=e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "),e}async function HQ(n){const e=await n.arrayBuffer(),t=await Vu.store(e);Za()&&await Xu("epub",t,new Uint8Array(e));const r=qQ(e,n.name),i=M5({title:r.title||n.name,epubHash:t,epubTitle:r.title,epubAuthor:r.author});return Dr({type:"note",id:i}),cn({type:"note",id:i}),{noteId:i,hash:t,title:r.title||n.name,author:r.author}}async function ZQ(n,e){const t=n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),r=await Vu.store(t);Za()&&await Xu("epub",r,new Uint8Array(t));const i=qQ(t,e),s=M5({title:i.title||e,epubHash:r,epubTitle:i.title,epubAuthor:i.author});return Dr({type:"note",id:s}),cn({type:"note",id:s}),{noteId:s,hash:r,title:i.title||e,author:i.author}}const WQ={"image/png":"png","image/jpeg":"jpg","image/gif":"gif","image/webp":"webp"};function $y(n){return n in WQ}function Kne(n){return WQ[n]||null}function e2(n){const e=n.split(".").pop()?.toLowerCase();return e?e==="jpeg"?"jpg":["png","jpg","gif","webp"].includes(e)?e:null:null}function Jne(n,e,t=""){return`![${t}](opfs://images/${n}.${e})`}async function OE(n){let e=Kne(n.type);if(e||(e=e2(n.name)),!e)throw new Error(`Unsupported image type: ${n.type||n.name}`);const t=await n.arrayBuffer(),r=await vc.store(t,e);Za()&&await Xu("image",r.shortHash,new Uint8Array(t),{extension:r.extension});const i=Jne(r.shortHash,r.extension);return{shortHash:r.shortHash,extension:r.extension,markdownSyntax:i,originalName:n.name}}function ere(n){for(const e of Array.from(n.files))if($y(e.type)||e2(e.name))return!0;for(const e of Array.from(n.items))if(e.kind==="file"&&$y(e.type))return!0;return!1}function xE(n){const e=[];for(const t of Array.from(n.files))($y(t.type)||e2(t.name))&&e.push(t);if(e.length===0){for(const t of Array.from(n.items))if(t.kind==="file"&&$y(t.type)){const r=t.getAsFile();r&&e.push(r)}}return e}let FO=[],XQ=[];(()=>{let n="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,t=0;e<n.length;e++)(e%2?XQ:FO).push(t=t+n[e])})();function tre(n){if(n<768)return!1;for(let e=0,t=FO.length;;){let r=e+t>>1;if(n<FO[r])t=r;else if(n>=XQ[r])e=r+1;else return!0;if(e==t)return!1}}function kE(n){return n>=127462&&n<=127487}const SE=8205;function nre(n,e,t=!0,r=!0){return(t?YQ:rre)(n,e,r)}function YQ(n,e,t){if(e==n.length)return e;e&&GQ(n.charCodeAt(e))&&KQ(n.charCodeAt(e-1))&&e--;let r=Yw(n,e);for(e+=TE(r);e<n.length;){let i=Yw(n,e);if(r==SE||i==SE||t&&tre(i))e+=TE(i),r=i;else if(kE(i)){let s=0,o=e-2;for(;o>=0&&kE(Yw(n,o));)s++,o-=2;if(s%2==0)break;e+=2}else break}return e}function rre(n,e,t){for(;e>0;){let r=YQ(n,e-2,t);if(r<e)return r;e--}return 0}function Yw(n,e){let t=n.charCodeAt(e);if(!KQ(t)||e+1==n.length)return t;let r=n.charCodeAt(e+1);return GQ(r)?(t-55296<<10)+(r-56320)+65536:t}function GQ(n){return n>=56320&&n<57344}function KQ(n){return n>=55296&&n<56320}function TE(n){return n<65536?1:2}let In=class JQ{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,r){[e,t]=Ph(this,e,t);let i=[];return this.decompose(0,e,i,2),r.length&&r.decompose(0,r.length,i,3),this.decompose(t,this.length,i,1),xa.from(i,this.length-(t-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=Ph(this,e,t);let r=[];return this.decompose(e,t,r,0),xa.from(r,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),i=new bp(this),s=new bp(e);for(let o=t,a=t;;){if(i.next(o),s.next(o),o=0,i.lineBreak!=s.lineBreak||i.done!=s.done||i.value!=s.value)return!1;if(a+=i.value.length,i.done||a>=r)return!0}}iter(e=1){return new bp(this,e)}iterRange(e,t=this.length){return new e$(this,e,t)}iterLines(e,t){let r;if(e==null)r=this.iter();else{t==null&&(t=this.lines+1);let i=this.line(e).from;r=this.iterRange(i,Math.max(i,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new t$(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?JQ.empty:e.length<=32?new Sr(e):xa.from(Sr.split(e,[]))}};class Sr extends In{constructor(e,t=ire(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,r,i){for(let s=0;;s++){let o=this.text[s],a=i+o.length;if((t?r:a)>=e)return new sre(i,a,r,o);i=a+1,r++}}decompose(e,t,r,i){let s=e<=0&&t>=this.length?this:new Sr(AE(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(i&1){let o=r.pop(),a=jv(s.text,o.text.slice(),0,s.length);if(a.length<=32)r.push(new Sr(a,o.length+s.length));else{let l=a.length>>1;r.push(new Sr(a.slice(0,l)),new Sr(a.slice(l)))}}else r.push(s)}replace(e,t,r){if(!(r instanceof Sr))return super.replace(e,t,r);[e,t]=Ph(this,e,t);let i=jv(this.text,jv(r.text,AE(this.text,0,e)),t),s=this.length+r.length-(t-e);return i.length<=32?new Sr(i,s):xa.from(Sr.split(i,[]),s)}sliceString(e,t=this.length,r=`
`){[e,t]=Ph(this,e,t);let i="";for(let s=0,o=0;s<=t&&o<this.text.length;o++){let a=this.text[o],l=s+a.length;s>e&&o&&(i+=r),e<l&&t>s&&(i+=a.slice(Math.max(0,e-s),t-s)),s=l+1}return i}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let r=[],i=-1;for(let s of e)r.push(s),i+=s.length+1,r.length==32&&(t.push(new Sr(r,i)),r=[],i=-1);return i>-1&&t.push(new Sr(r,i)),t}}class xa extends In{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,t,r,i){for(let s=0;;s++){let o=this.children[s],a=i+o.length,l=r+o.lines-1;if((t?l:a)>=e)return o.lineInner(e,t,r,i);i=a+1,r=l+1}}decompose(e,t,r,i){for(let s=0,o=0;o<=t&&s<this.children.length;s++){let a=this.children[s],l=o+a.length;if(e<=l&&t>=o){let c=i&((o<=e?1:0)|(l>=t?2:0));o>=e&&l<=t&&!c?r.push(a):a.decompose(e-o,t-o,r,c)}o=l+1}}replace(e,t,r){if([e,t]=Ph(this,e,t),r.lines<this.lines)for(let i=0,s=0;i<this.children.length;i++){let o=this.children[i],a=s+o.length;if(e>=s&&t<=a){let l=o.replace(e-s,t-s,r),c=this.lines-o.lines+l.lines;if(l.lines<c>>4&&l.lines>c>>6){let d=this.children.slice();return d[i]=l,new xa(d,this.length-(t-e)+r.length)}return super.replace(s,a,l)}s=a+1}return super.replace(e,t,r)}sliceString(e,t=this.length,r=`
`){[e,t]=Ph(this,e,t);let i="";for(let s=0,o=0;s<this.children.length&&o<=t;s++){let a=this.children[s],l=o+a.length;o>e&&s&&(i+=r),e<l&&t>o&&(i+=a.sliceString(e-o,t-o,r)),o=l+1}return i}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof xa))return 0;let r=0,[i,s,o,a]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=t,s+=t){if(i==o||s==a)return r;let l=this.children[i],c=e.children[s];if(l!=c)return r+l.scanIdentical(c,t);r+=l.length+1}}static from(e,t=e.reduce((r,i)=>r+i.length+1,-1)){let r=0;for(let p of e)r+=p.lines;if(r<32){let p=[];for(let g of e)g.flatten(p);return new Sr(p,t)}let i=Math.max(32,r>>5),s=i<<1,o=i>>1,a=[],l=0,c=-1,d=[];function h(p){let g;if(p.lines>s&&p instanceof xa)for(let m of p.children)h(m);else p.lines>o&&(l>o||!l)?(f(),a.push(p)):p instanceof Sr&&l&&(g=d[d.length-1])instanceof Sr&&p.lines+g.lines<=32?(l+=p.lines,c+=p.length+1,d[d.length-1]=new Sr(g.text.concat(p.text),g.length+1+p.length)):(l+p.lines>i&&f(),l+=p.lines,c+=p.length+1,d.push(p))}function f(){l!=0&&(a.push(d.length==1?d[0]:xa.from(d,c)),c=-1,l=d.length=0)}for(let p of e)h(p);return f(),a.length==1?a[0]:new xa(a,t)}}In.empty=new Sr([""],0);function ire(n){let e=-1;for(let t of n)e+=t.length+1;return e}function jv(n,e,t=0,r=1e9){for(let i=0,s=0,o=!0;s<n.length&&i<=r;s++){let a=n[s],l=i+a.length;l>=t&&(l>r&&(a=a.slice(0,r-i)),i<t&&(a=a.slice(t-i)),o?(e[e.length-1]+=a,o=!1):e.push(a)),i=l+1}return e}function AE(n,e,t){return jv(n,[""],e,t)}class bp{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Sr?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,i=this.nodes[r],s=this.offsets[r],o=s>>1,a=i instanceof Sr?i.text.length:i.children.length;if(o==(t>0?a:0)){if(r==0)return this.done=!0,this.value="",this;t>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[r]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(i instanceof Sr){let l=i.text[o+(t<0?-1:0)];if(this.offsets[r]+=t,l.length>Math.max(0,e))return this.value=e==0?l:t>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=i.children[o+(t<0?-1:0)];e>l.length?(e-=l.length,this.offsets[r]+=t):(t<0&&this.offsets[r]--,this.nodes.push(l),this.offsets.push(t>0?1:(l instanceof Sr?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class e${constructor(e,t,r){this.value="",this.done=!1,this.cursor=new bp(e,t>r?-1:1),this.pos=t>r?e.length:0,this.from=Math.min(t,r),this.to=Math.max(t,r)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let r=t<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*t,this.value=i.length<=r?i:t<0?i.slice(i.length-r):i.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class t${constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:r,value:i}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(In.prototype[Symbol.iterator]=function(){return this.iter()},bp.prototype[Symbol.iterator]=e$.prototype[Symbol.iterator]=t$.prototype[Symbol.iterator]=function(){return this});let sre=class{constructor(e,t,r,i){this.from=e,this.to=t,this.number=r,this.text=i}get length(){return this.to-this.from}};function Ph(n,e,t){return e=Math.max(0,Math.min(n.length,e)),[e,Math.max(e,Math.min(n.length,t))]}function ci(n,e,t=!0,r=!0){return nre(n,e,t,r)}function ore(n){return n>=56320&&n<57344}function are(n){return n>=55296&&n<56320}function al(n,e){let t=n.charCodeAt(e);if(!are(t)||e+1==n.length)return t;let r=n.charCodeAt(e+1);return ore(r)?(t-55296<<10)+(r-56320)+65536:t}function n$(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function Yc(n){return n<65536?1:2}const zO=/\r\n?|\n/;var zi=(function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n})(zi||(zi={}));class Ra{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t+1];e+=r<0?this.sections[t]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,r=0,i=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(r,i,s),i+=s):i+=o,r+=s}}iterChangedRanges(e,t=!1){BO(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let r=this.sections[t++],i=this.sections[t++];i<0?e.push(r,i):e.push(i,r)}return new Ra(e)}composeDesc(e){return this.empty?e:e.empty?this:r$(this,e)}mapDesc(e,t=!1){return e.empty?this:UO(this,e,t)}mapPos(e,t=-1,r=zi.Simple){let i=0,s=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],l=this.sections[o++],c=i+a;if(l<0){if(c>e)return s+(e-i);s+=a}else{if(r!=zi.Simple&&c>=e&&(r==zi.TrackDel&&i<e&&c>e||r==zi.TrackBefore&&i<e||r==zi.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!a)return e==i||t<0?s:s+l;s+=l}i=c}if(e>i)throw new RangeError(`Position ${e} is out of range for changeset of length ${i}`);return s}touchesRange(e,t=e){for(let r=0,i=0;r<this.sections.length&&i<=t;){let s=this.sections[r++],o=this.sections[r++],a=i+s;if(o>=0&&i<=t&&a>=e)return i<e&&a>t?"cover":!0;i=a}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let r=this.sections[t++],i=this.sections[t++];e+=(e?" ":"")+r+(i>=0?":"+i:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Ra(e)}static create(e){return new Ra(e)}}class Mr extends Ra{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return BO(this,(t,r,i,s,o)=>e=e.replace(i,i+(r-t),o),!1),e}mapDesc(e,t=!1){return UO(this,e,t,!0)}invert(e){let t=this.sections.slice(),r=[];for(let i=0,s=0;i<t.length;i+=2){let o=t[i],a=t[i+1];if(a>=0){t[i]=a,t[i+1]=o;let l=i>>1;for(;r.length<l;)r.push(In.empty);r.push(o?e.slice(s,s+o):In.empty)}s+=o}return new Mr(t,r)}compose(e){return this.empty?e:e.empty?this:r$(this,e,!0)}map(e,t=!1){return e.empty?this:UO(this,e,t,!0)}iterChanges(e,t=!1){BO(this,e,t)}get desc(){return Ra.create(this.sections)}filter(e){let t=[],r=[],i=[],s=new rg(this);e:for(let o=0,a=0;;){let l=o==e.length?1e9:e[o++];for(;a<l||a==l&&s.len==0;){if(s.done)break e;let d=Math.min(s.len,l-a);wi(i,d,-1);let h=s.ins==-1?-1:s.off==0?s.ins:0;wi(t,d,h),h>0&&Kl(r,t,s.text),s.forward(d),a+=d}let c=e[o++];for(;a<c;){if(s.done)break e;let d=Math.min(s.len,c-a);wi(t,d,-1),wi(i,d,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(d),a+=d}}return{changes:new Mr(t,r),filtered:Ra.create(i)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t],i=this.sections[t+1];i<0?e.push(r):i==0?e.push([r]):e.push([r].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,r){let i=[],s=[],o=0,a=null;function l(d=!1){if(!d&&!i.length)return;o<t&&wi(i,t-o,-1);let h=new Mr(i,s);a=a?a.compose(h.map(a)):h,i=[],s=[],o=0}function c(d){if(Array.isArray(d))for(let h of d)c(h);else if(d instanceof Mr){if(d.length!=t)throw new RangeError(`Mismatched change set length (got ${d.length}, expected ${t})`);l(),a=a?a.compose(d.map(a)):d}else{let{from:h,to:f=h,insert:p}=d;if(h>f||h<0||f>t)throw new RangeError(`Invalid change range ${h} to ${f} (in doc of length ${t})`);let g=p?typeof p=="string"?In.of(p.split(r||zO)):p:In.empty,m=g.length;if(h==f&&m==0)return;h<o&&l(),h>o&&wi(i,h-o,-1),wi(i,f-h,m),Kl(s,i,g),o=f}}return c(e),l(!a),a}static empty(e){return new Mr(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],r=[];for(let i=0;i<e.length;i++){let s=e[i];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,a)=>a&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;r.length<i;)r.push(In.empty);r[i]=In.of(s.slice(1)),t.push(s[0],r[i].length)}}}return new Mr(t,r)}static createSet(e,t){return new Mr(e,t)}}function wi(n,e,t,r=!1){if(e==0&&t<=0)return;let i=n.length-2;i>=0&&t<=0&&t==n[i+1]?n[i]+=e:i>=0&&e==0&&n[i]==0?n[i+1]+=t:r?(n[i]+=e,n[i+1]+=t):n.push(e,t)}function Kl(n,e,t){if(t.length==0)return;let r=e.length-2>>1;if(r<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<r;)n.push(In.empty);n.push(t)}}function BO(n,e,t){let r=n.inserted;for(let i=0,s=0,o=0;o<n.sections.length;){let a=n.sections[o++],l=n.sections[o++];if(l<0)i+=a,s+=a;else{let c=i,d=s,h=In.empty;for(;c+=a,d+=l,l&&r&&(h=h.append(r[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)a=n.sections[o++],l=n.sections[o++];e(i,c,s,d,h),i=c,s=d}}}function UO(n,e,t,r=!1){let i=[],s=r?[]:null,o=new rg(n),a=new rg(e);for(let l=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&a.ins==-1){let c=Math.min(o.len,a.len);wi(i,c,-1),o.forward(c),a.forward(c)}else if(a.ins>=0&&(o.ins<0||l==o.i||o.off==0&&(a.len<o.len||a.len==o.len&&!t))){let c=a.len;for(wi(i,a.ins,-1);c;){let d=Math.min(o.len,c);o.ins>=0&&l<o.i&&o.len<=d&&(wi(i,0,o.ins),s&&Kl(s,i,o.text),l=o.i),o.forward(d),c-=d}a.next()}else if(o.ins>=0){let c=0,d=o.len;for(;d;)if(a.ins==-1){let h=Math.min(d,a.len);c+=h,d-=h,a.forward(h)}else if(a.ins==0&&a.len<d)d-=a.len,a.next();else break;wi(i,c,l<o.i?o.ins:0),s&&l<o.i&&Kl(s,i,o.text),l=o.i,o.forward(o.len-d)}else{if(o.done&&a.done)return s?Mr.createSet(i,s):Ra.create(i);throw new Error("Mismatched change set lengths")}}}function r$(n,e,t=!1){let r=[],i=t?[]:null,s=new rg(n),o=new rg(e);for(let a=!1;;){if(s.done&&o.done)return i?Mr.createSet(r,i):Ra.create(r);if(s.ins==0)wi(r,s.len,0,a),s.next();else if(o.len==0&&!o.done)wi(r,0,o.ins,a),i&&Kl(i,r,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let l=Math.min(s.len2,o.len),c=r.length;if(s.ins==-1){let d=o.ins==-1?-1:o.off?0:o.ins;wi(r,l,d,a),i&&d&&Kl(i,r,o.text)}else o.ins==-1?(wi(r,s.off?0:s.len,l,a),i&&Kl(i,r,s.textBit(l))):(wi(r,s.off?0:s.len,o.off?0:o.ins,a),i&&!o.off&&Kl(i,r,o.text));a=(s.ins>l||o.ins>=0&&o.len>l)&&(a||r.length>c),s.forward2(l),o.forward(l)}}}}class rg{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?In.empty:e[t]}textBit(e){let{inserted:t}=this.set,r=this.i-2>>1;return r>=t.length&&!e?In.empty:t[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class ou{constructor(e,t,r){this.from=e,this.to=t,this.flags=r}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let r,i;return this.empty?r=i=e.mapPos(this.from,t):(r=e.mapPos(this.from,1),i=e.mapPos(this.to,-1)),r==this.from&&i==this.to?this:new ou(r,i,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return rt.range(e,t);let r=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return rt.range(this.anchor,r)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return rt.range(e.anchor,e.head)}static create(e,t,r){return new ou(e,t,r)}}class rt{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:rt.create(this.ranges.map(r=>r.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new rt([this.main],0)}addRange(e,t=!0){return rt.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let r=this.ranges.slice();return r[t]=e,rt.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new rt(e.ranges.map(t=>ou.fromJSON(t)),e.main)}static single(e,t=e){return new rt([rt.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,i=0;i<e.length;i++){let s=e[i];if(s.empty?s.from<=r:s.from<r)return rt.normalized(e.slice(),t);r=s.to}return new rt(e,t)}static cursor(e,t=0,r,i){return ou.create(e,e,(t==0?0:t<0?8:16)|(r==null?7:Math.min(6,r))|(i??16777215)<<6)}static range(e,t,r,i){let s=(r??16777215)<<6|(i==null?7:Math.min(6,i));return t<e?ou.create(t,e,48|s):ou.create(e,t,(t>e?8:0)|s)}static normalized(e,t=0){let r=e[t];e.sort((i,s)=>i.from-s.from),t=e.indexOf(r);for(let i=1;i<e.length;i++){let s=e[i],o=e[i-1];if(s.empty?s.from<=o.to:s.from<o.to){let a=o.from,l=Math.max(s.to,o.to);i<=t&&t--,e.splice(--i,2,s.anchor>s.head?rt.range(l,a):rt.range(a,l))}}return new rt(e,t)}}function i$(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let t2=0;class Ut{constructor(e,t,r,i,s){this.combine=e,this.compareInput=t,this.compare=r,this.isStatic=i,this.id=t2++,this.default=e([]),this.extensions=typeof s=="function"?s(this):s}get reader(){return this}static define(e={}){return new Ut(e.combine||(t=>t),e.compareInput||((t,r)=>t===r),e.compare||(e.combine?(t,r)=>t===r:n2),!!e.static,e.enables)}of(e){return new Vv([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Vv(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Vv(e,this,2,t)}from(e,t){return t||(t=r=>r),this.compute([e],r=>t(r.field(e)))}}function n2(n,e){return n==e||n.length==e.length&&n.every((t,r)=>t===e[r])}class Vv{constructor(e,t,r,i){this.dependencies=e,this.facet=t,this.type=r,this.value=i,this.id=t2++}dynamicSlot(e){var t;let r=this.value,i=this.facet.compareInput,s=this.id,o=e[s]>>1,a=this.type==2,l=!1,c=!1,d=[];for(let h of this.dependencies)h=="doc"?l=!0:h=="selection"?c=!0:(((t=e[h.id])!==null&&t!==void 0?t:1)&1)==0&&d.push(e[h.id]);return{create(h){return h.values[o]=r(h),1},update(h,f){if(l&&f.docChanged||c&&(f.docChanged||f.selection)||jO(h,d)){let p=r(h);if(a?!CE(p,h.values[o],i):!i(p,h.values[o]))return h.values[o]=p,1}return 0},reconfigure:(h,f)=>{let p,g=f.config.address[s];if(g!=null){let m=zy(f,g);if(this.dependencies.every(v=>v instanceof Ut?f.facet(v)===h.facet(v):v instanceof Cr?f.field(v,!1)==h.field(v,!1):!0)||(a?CE(p=r(h),m,i):i(p=r(h),m)))return h.values[o]=m,0}else p=r(h);return h.values[o]=p,1}}}}function CE(n,e,t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!t(n[r],e[r]))return!1;return!0}function jO(n,e){let t=!1;for(let r of e)wp(n,r)&1&&(t=!0);return t}function lre(n,e,t){let r=t.map(l=>n[l.id]),i=t.map(l=>l.type),s=r.filter(l=>!(l&1)),o=n[e.id]>>1;function a(l){let c=[];for(let d=0;d<r.length;d++){let h=zy(l,r[d]);if(i[d]==2)for(let f of h)c.push(f);else c.push(h)}return e.combine(c)}return{create(l){for(let c of r)wp(l,c);return l.values[o]=a(l),1},update(l,c){if(!jO(l,s))return 0;let d=a(l);return e.compare(d,l.values[o])?0:(l.values[o]=d,1)},reconfigure(l,c){let d=jO(l,r),h=c.config.facets[e.id],f=c.facet(e);if(h&&!d&&n2(t,h))return l.values[o]=f,0;let p=a(l);return e.compare(p,f)?(l.values[o]=f,0):(l.values[o]=p,1)}}}const Gm=Ut.define({static:!0});class Cr{constructor(e,t,r,i,s){this.id=e,this.createF=t,this.updateF=r,this.compareF=i,this.spec=s,this.provides=void 0}static define(e){let t=new Cr(t2++,e.create,e.update,e.compare||((r,i)=>r===i),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Gm).find(r=>r.field==this);return(t?.create||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:r=>(r.values[t]=this.create(r),1),update:(r,i)=>{let s=r.values[t],o=this.updateF(s,i);return this.compareF(s,o)?0:(r.values[t]=o,1)},reconfigure:(r,i)=>{let s=r.facet(Gm),o=i.facet(Gm),a;return(a=s.find(l=>l.field==this))&&a!=o.find(l=>l.field==this)?(r.values[t]=a.create(r),1):i.config.address[this.id]!=null?(r.values[t]=i.field(this),0):(r.values[t]=this.create(r),1)}}}init(e){return[this,Gm.of({field:this,create:e})]}get extension(){return this}}const Gc={lowest:4,low:3,default:2,high:1,highest:0};function Af(n){return e=>new s$(e,n)}const Wo={highest:Af(Gc.highest),high:Af(Gc.high),default:Af(Gc.default),low:Af(Gc.low),lowest:Af(Gc.lowest)};class s${constructor(e,t){this.inner=e,this.prec=t}}class Ab{of(e){return new VO(this,e)}reconfigure(e){return Ab.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class VO{constructor(e,t){this.compartment=e,this.inner=t}}class Fy{constructor(e,t,r,i,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=r,this.address=i,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,r){let i=[],s=Object.create(null),o=new Map;for(let f of cre(e,t,o))f instanceof Cr?i.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let a=Object.create(null),l=[],c=[];for(let f of i)a[f.id]=c.length<<1,c.push(p=>f.slot(p));let d=r?.config.facets;for(let f in s){let p=s[f],g=p[0].facet,m=d&&d[f]||[];if(p.every(v=>v.type==0))if(a[g.id]=l.length<<1|1,n2(m,p))l.push(r.facet(g));else{let v=g.combine(p.map(y=>y.value));l.push(r&&g.compare(v,r.facet(g))?r.facet(g):v)}else{for(let v of p)v.type==0?(a[v.id]=l.length<<1|1,l.push(v.value)):(a[v.id]=c.length<<1,c.push(y=>v.dynamicSlot(y)));a[g.id]=c.length<<1,c.push(v=>lre(v,g,p))}}let h=c.map(f=>f(a));return new Fy(e,o,h,a,l,s)}}function cre(n,e,t){let r=[[],[],[],[],[]],i=new Map;function s(o,a){let l=i.get(o);if(l!=null){if(l<=a)return;let c=r[l].indexOf(o);c>-1&&r[l].splice(c,1),o instanceof VO&&t.delete(o.compartment)}if(i.set(o,a),Array.isArray(o))for(let c of o)s(c,a);else if(o instanceof VO){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(o.compartment)||o.inner;t.set(o.compartment,c),s(c,a)}else if(o instanceof s$)s(o.inner,o.prec);else if(o instanceof Cr)r[a].push(o),o.provides&&s(o.provides,a);else if(o instanceof Vv)r[a].push(o),o.facet.extensions&&s(o.facet.extensions,Gc.default);else{let c=o.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(c,a)}}return s(n,Gc.default),r.reduce((o,a)=>o.concat(a))}function wp(n,e){if(e&1)return 2;let t=e>>1,r=n.status[t];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;n.status[t]=4;let i=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|i}function zy(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const o$=Ut.define(),qO=Ut.define({combine:n=>n.some(e=>e),static:!0}),a$=Ut.define({combine:n=>n.length?n[0]:void 0,static:!0}),l$=Ut.define(),c$=Ut.define(),u$=Ut.define(),d$=Ut.define({combine:n=>n.length?n[0]:!1});class Xo{constructor(e,t){this.type=e,this.value=t}static define(){return new ure}}class ure{of(e){return new Xo(this,e)}}class dre{constructor(e){this.map=e}of(e){return new en(this,e)}}class en{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new en(this.type,t)}is(e){return this.type==e}static define(e={}){return new dre(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let r=[];for(let i of e){let s=i.map(t);s&&r.push(s)}return r}}en.reconfigure=en.define();en.appendConfig=en.define();class Nr{constructor(e,t,r,i,s,o){this.startState=e,this.changes=t,this.selection=r,this.effects=i,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,r&&i$(r,t.newLength),s.some(a=>a.type==Nr.time)||(this.annotations=s.concat(Nr.time.of(Date.now())))}static create(e,t,r,i,s,o){return new Nr(e,t,r,i,s,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Nr.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Nr.time=Xo.define();Nr.userEvent=Xo.define();Nr.addToHistory=Xo.define();Nr.remote=Xo.define();function hre(n,e){let t=[];for(let r=0,i=0;;){let s,o;if(r<n.length&&(i==e.length||e[i]>=n[r]))s=n[r++],o=n[r++];else if(i<e.length)s=e[i++],o=e[i++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function h$(n,e,t){var r;let i,s,o;return t?(i=e.changes,s=Mr.empty(e.changes.length),o=n.changes.compose(e.changes)):(i=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(i)),{changes:o,selection:e.selection?e.selection.map(s):(r=n.selection)===null||r===void 0?void 0:r.map(i),effects:en.mapEffects(n.effects,i).concat(en.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function HO(n,e,t){let r=e.selection,i=sh(e.annotations);return e.userEvent&&(i=i.concat(Nr.userEvent.of(e.userEvent))),{changes:e.changes instanceof Mr?e.changes:Mr.of(e.changes||[],t,n.facet(a$)),selection:r&&(r instanceof rt?r:rt.single(r.anchor,r.head)),effects:sh(e.effects),annotations:i,scrollIntoView:!!e.scrollIntoView}}function f$(n,e,t){let r=HO(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;r=h$(r,HO(n,e[s],o?r.changes.newLength:n.doc.length),o)}let i=Nr.create(n,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return pre(t?fre(i):i)}function fre(n){let e=n.startState,t=!0;for(let i of e.facet(l$)){let s=i(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:hre(t,s))}if(t!==!0){let i,s;if(t===!1)s=n.changes.invertedDesc,i=Mr.empty(e.doc.length);else{let o=n.changes.filter(t);i=o.changes,s=o.filtered.mapDesc(o.changes).invertedDesc}n=Nr.create(e,i,n.selection&&n.selection.map(s),en.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let r=e.facet(c$);for(let i=r.length-1;i>=0;i--){let s=r[i](n);s instanceof Nr?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Nr?n=s[0]:n=f$(e,sh(s),!1)}return n}function pre(n){let e=n.startState,t=e.facet(u$),r=n;for(let i=t.length-1;i>=0;i--){let s=t[i](n);s&&Object.keys(s).length&&(r=h$(r,HO(e,s,n.changes.newLength),!0))}return r==n?n:Nr.create(e,n.changes,n.selection,r.effects,r.annotations,r.scrollIntoView)}const gre=[];function sh(n){return n==null?gre:Array.isArray(n)?n:[n]}var ui=(function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n})(ui||(ui={}));const mre=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let ZO;try{ZO=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function vre(n){if(ZO)return ZO.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>"Â"&&(t.toUpperCase()!=t.toLowerCase()||mre.test(t)))return!0}return!1}function yre(n){return e=>{if(!/\S/.test(e))return ui.Space;if(vre(e))return ui.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return ui.Word;return ui.Other}}class un{constructor(e,t,r,i,s,o){this.config=e,this.doc=t,this.selection=r,this.values=i,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)wp(this,a<<1);this.computeSlot=null}field(e,t=!0){let r=this.config.address[e.id];if(r==null){if(t)throw new RangeError("Field is not present in this state");return}return wp(this,r),zy(this,r)}update(...e){return f$(this,e,!0)}applyTransaction(e){let t=this.config,{base:r,compartments:i}=t;for(let a of e.effects)a.is(Ab.reconfigure)?(t&&(i=new Map,t.compartments.forEach((l,c)=>i.set(c,l)),t=null),i.set(a.value.compartment,a.value.extension)):a.is(en.reconfigure)?(t=null,r=a.value):a.is(en.appendConfig)&&(t=null,r=sh(r).concat(a.value));let s;t?s=e.startState.values.slice():(t=Fy.resolve(r,i,this),s=new un(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,c)=>c.reconfigure(l,this),null).values);let o=e.startState.facet(qO)?e.newSelection:e.newSelection.asSingle();new un(t,e.newDoc,o,s,(a,l)=>l.update(a,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:rt.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,r=e(t.ranges[0]),i=this.changes(r.changes),s=[r.range],o=sh(r.effects);for(let a=1;a<t.ranges.length;a++){let l=e(t.ranges[a]),c=this.changes(l.changes),d=c.map(i);for(let f=0;f<a;f++)s[f]=s[f].map(d);let h=i.mapDesc(c,!0);s.push(l.range.map(h)),i=i.compose(d),o=en.mapEffects(o,d).concat(en.mapEffects(sh(l.effects),h))}return{changes:i,selection:rt.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof Mr?e:Mr.of(e,this.doc.length,this.facet(un.lineSeparator))}toText(e){return In.of(e.split(this.facet(un.lineSeparator)||zO))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(wp(this,t),zy(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let i=e[r];i instanceof Cr&&this.config.address[i.id]!=null&&(t[r]=i.spec.toJSON(this.field(e[r]),this))}return t}static fromJSON(e,t={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let i=[];if(r){for(let s in r)if(Object.prototype.hasOwnProperty.call(e,s)){let o=r[s],a=e[s];i.push(o.init(l=>o.spec.fromJSON(a,l)))}}return un.create({doc:e.doc,selection:rt.fromJSON(e.selection),extensions:t.extensions?i.concat([t.extensions]):i})}static create(e={}){let t=Fy.resolve(e.extensions||[],new Map),r=e.doc instanceof In?e.doc:In.of((e.doc||"").split(t.staticFacet(un.lineSeparator)||zO)),i=e.selection?e.selection instanceof rt?e.selection:rt.single(e.selection.anchor,e.selection.head):rt.single(0);return i$(i,r.length),t.staticFacet(qO)||(i=i.asSingle()),new un(t,r,i,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(un.tabSize)}get lineBreak(){return this.facet(un.lineSeparator)||`
`}get readOnly(){return this.facet(d$)}phrase(e,...t){for(let r of this.facet(un.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(r,i)=>{if(i=="$")return"$";let s=+(i||1);return!s||s>t.length?r:t[s-1]})),e}languageDataAt(e,t,r=-1){let i=[];for(let s of this.facet(o$))for(let o of s(this,t,r))Object.prototype.hasOwnProperty.call(o,e)&&i.push(o[e]);return i}charCategorizer(e){return yre(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:r,length:i}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-r,a=e-r;for(;o>0;){let l=ci(t,o,!1);if(s(t.slice(l,o))!=ui.Word)break;o=l}for(;a<i;){let l=ci(t,a);if(s(t.slice(a,l))!=ui.Word)break;a=l}return o==a?null:rt.range(o+r,a+r)}}un.allowMultipleSelections=qO;un.tabSize=Ut.define({combine:n=>n.length?n[0]:4});un.lineSeparator=a$;un.readOnly=d$;un.phrases=Ut.define({compare(n,e){let t=Object.keys(n),r=Object.keys(e);return t.length==r.length&&t.every(i=>n[i]==e[i])}});un.languageData=o$;un.changeFilter=l$;un.transactionFilter=c$;un.transactionExtender=u$;Ab.reconfigure=en.define();function rm(n,e,t={}){let r={};for(let i of n)for(let s of Object.keys(i)){let o=i[s],a=r[s];if(a===void 0)r[s]=o;else if(!(a===o||o===void 0))if(Object.hasOwnProperty.call(t,s))r[s]=t[s](a,o);else throw new Error("Config merge conflict for field "+s)}for(let i in e)r[i]===void 0&&(r[i]=e[i]);return r}class Au{eq(e){return this==e}range(e,t=e){return WO.create(e,t,this)}}Au.prototype.startSide=Au.prototype.endSide=0;Au.prototype.point=!1;Au.prototype.mapMode=zi.TrackDel;let WO=class p${constructor(e,t,r){this.from=e,this.to=t,this.value=r}static create(e,t,r){return new p$(e,t,r)}};function XO(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class r2{constructor(e,t,r,i){this.from=e,this.to=t,this.value=r,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(e,t,r,i=0){let s=r?this.to:this.from;for(let o=i,a=s.length;;){if(o==a)return o;let l=o+a>>1,c=s[l]-e||(r?this.value[l].endSide:this.value[l].startSide)-t;if(l==o)return c>=0?o:a;c>=0?a=l:o=l+1}}between(e,t,r,i){for(let s=this.findIndex(t,-1e9,!0),o=this.findIndex(r,1e9,!1,s);s<o;s++)if(i(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let r=[],i=[],s=[],o=-1,a=-1;for(let l=0;l<this.value.length;l++){let c=this.value[l],d=this.from[l]+e,h=this.to[l]+e,f,p;if(d==h){let g=t.mapPos(d,c.startSide,c.mapMode);if(g==null||(f=p=g,c.startSide!=c.endSide&&(p=t.mapPos(d,c.endSide),p<f)))continue}else if(f=t.mapPos(d,c.startSide),p=t.mapPos(h,c.endSide),f>p||f==p&&c.startSide>0&&c.endSide<=0)continue;(p-f||c.endSide-c.startSide)<0||(o<0&&(o=f),c.point&&(a=Math.max(a,p-f)),r.push(c),i.push(f-o),s.push(p-o))}return{mapped:r.length?new r2(i,s,r,a):null,pos:o}}}class $n{constructor(e,t,r,i){this.chunkPos=e,this.chunk=t,this.nextLayer=r,this.maxPoint=i}static create(e,t,r,i){return new $n(e,t,r,i)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:r=!1,filterFrom:i=0,filterTo:s=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(r&&(t=t.slice().sort(XO)),this.isEmpty)return t.length?$n.of(t):this;let a=new g$(this,null,-1).goto(0),l=0,c=[],d=new Cu;for(;a.value||l<t.length;)if(l<t.length&&(a.from-t[l].from||a.startSide-t[l].value.startSide)>=0){let h=t[l++];d.addInner(h.from,h.to,h.value)||c.push(h)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==t.length||this.chunkEnd(a.chunkIndex)<t[l].from)&&(!o||i>this.chunkEnd(a.chunkIndex)||s<this.chunkPos[a.chunkIndex])&&d.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||i>a.to||s<a.from||o(a.from,a.to,a.value))&&(d.addInner(a.from,a.to,a.value)||c.push(WO.create(a.from,a.to,a.value))),a.next());return d.finishInner(this.nextLayer.isEmpty&&!c.length?$n.empty:this.nextLayer.update({add:c,filter:o,filterFrom:i,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],r=[],i=-1;for(let o=0;o<this.chunk.length;o++){let a=this.chunkPos[o],l=this.chunk[o],c=e.touchesRange(a,a+l.length);if(c===!1)i=Math.max(i,l.maxPoint),t.push(l),r.push(e.mapPos(a));else if(c===!0){let{mapped:d,pos:h}=l.map(a,e);d&&(i=Math.max(i,d.maxPoint),t.push(d),r.push(h))}}let s=this.nextLayer.map(e);return t.length==0?s:new $n(r,t,s||$n.empty,i)}between(e,t,r){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let s=this.chunkPos[i],o=this.chunk[i];if(t>=s&&e<=s+o.length&&o.between(s,e-s,t-s,r)===!1)return}this.nextLayer.between(e,t,r)}}iter(e=0){return ig.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return ig.from(e).goto(t)}static compare(e,t,r,i,s=-1){let o=e.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=s),a=t.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=s),l=EE(o,a,r),c=new Cf(o,l,s),d=new Cf(a,l,s);r.iterGaps((h,f,p)=>PE(c,h,d,f,p,i)),r.empty&&r.length==0&&PE(c,0,d,0,0,i)}static eq(e,t,r=0,i){i==null&&(i=999999999);let s=e.filter(d=>!d.isEmpty&&t.indexOf(d)<0),o=t.filter(d=>!d.isEmpty&&e.indexOf(d)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let a=EE(s,o),l=new Cf(s,a,0).goto(r),c=new Cf(o,a,0).goto(r);for(;;){if(l.to!=c.to||!YO(l.active,c.active)||l.point&&(!c.point||!l.point.eq(c.point)))return!1;if(l.to>i)return!0;l.next(),c.next()}}static spans(e,t,r,i,s=-1){let o=new Cf(e,null,s).goto(t),a=t,l=o.openStart;for(;;){let c=Math.min(o.to,r);if(o.point){let d=o.activeForPoint(o.to),h=o.pointFrom<t?d.length+1:o.point.startSide<0?d.length:Math.min(d.length,l);i.point(a,c,o.point,d,h,o.pointRank),l=Math.min(o.openEnd(c),d.length)}else c>a&&(i.span(a,c,o.active,l),l=o.openEnd(c));if(o.to>r)return l+(o.point&&o.to>r?1:0);a=o.to,o.next()}}static of(e,t=!1){let r=new Cu;for(let i of e instanceof WO?[e]:t?bre(e):e)r.add(i.from,i.to,i.value);return r.finish()}static join(e){if(!e.length)return $n.empty;let t=e[e.length-1];for(let r=e.length-2;r>=0;r--)for(let i=e[r];i!=$n.empty;i=i.nextLayer)t=new $n(i.chunkPos,i.chunk,t,Math.max(i.maxPoint,t.maxPoint));return t}}$n.empty=new $n([],[],null,-1);function bre(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let r=n[t];if(XO(e,r)>0)return n.slice().sort(XO);e=r}return n}$n.empty.nextLayer=$n.empty;class Cu{finishChunk(e){this.chunks.push(new r2(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,r){this.addInner(e,t,r)||(this.nextLayer||(this.nextLayer=new Cu)).add(e,t,r)}addInner(e,t,r){let i=e-this.lastTo||r.startSide-this.last.endSide;if(i<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return i<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=t,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let r=t.value.length-1;return this.last=t.value[r],this.lastFrom=t.from[r]+e,this.lastTo=t.to[r]+e,!0}finish(){return this.finishInner($n.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=$n.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function EE(n,e,t){let r=new Map;for(let s of n)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&r.set(s.chunk[o],s.chunkPos[o]);let i=new Set;for(let s of e)for(let o=0;o<s.chunk.length;o++){let a=r.get(s.chunk[o]);a!=null&&(t?t.mapPos(a):a)==s.chunkPos[o]&&!t?.touchesRange(a,a+s.chunk[o].length)&&i.add(s.chunk[o])}return i}class g${constructor(e,t,r,i=0){this.layer=e,this.skip=t,this.minPoint=r,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,r){for(;this.chunkIndex<this.layer.chunk.length;){let i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<e||i.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!r||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],r=e+t.from[this.rangeIndex];if(this.from=r,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class ig{constructor(e){this.heap=e}static from(e,t=null,r=-1){let i=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=r&&i.push(new g$(o,t,r,s));return i.length==1?i[0]:new ig(i)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let r of this.heap)r.goto(e,t);for(let r=this.heap.length>>1;r>=0;r--)Gw(this.heap,r);return this.next(),this}forward(e,t){for(let r of this.heap)r.forward(e,t);for(let r=this.heap.length>>1;r>=0;r--)Gw(this.heap,r);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Gw(this.heap,0)}}}function Gw(n,e){for(let t=n[e];;){let r=(e<<1)+1;if(r>=n.length)break;let i=n[r];if(r+1<n.length&&i.compare(n[r+1])>=0&&(i=n[r+1],r++),t.compare(i)<0)break;n[r]=t,n[e]=i,e=r}}class Cf{constructor(e,t,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=ig.from(e,t,r)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Km(this.active,e),Km(this.activeTo,e),Km(this.activeRank,e),this.minActive=IE(this.active,this.activeTo)}addActive(e){let t=0,{value:r,to:i,rank:s}=this.cursor;for(;t<this.activeRank.length&&(s-this.activeRank[t]||i-this.activeTo[t])>0;)t++;Jm(this.active,t,r),Jm(this.activeTo,t,i),Jm(this.activeRank,t,s),e&&Jm(e,t,this.cursor.from),this.minActive=IE(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>e){this.to=this.activeTo[i],this.endSide=this.active[i].endSide;break}this.removeActive(i),r&&Km(r,i)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(r),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let i=r.length-1;i>=0&&r[i]<e;i--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&t.push(this.active[r]);return t.reverse()}openEnd(e){let t=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)t++;return t}}function PE(n,e,t,r,i,s){n.goto(e),t.goto(r);let o=r+i,a=r,l=r-e;for(;;){let c=n.to+l-t.to,d=c||n.endSide-t.endSide,h=d<0?n.to+l:t.to,f=Math.min(h,o);if(n.point||t.point?n.point&&t.point&&(n.point==t.point||n.point.eq(t.point))&&YO(n.activeForPoint(n.to),t.activeForPoint(t.to))||s.comparePoint(a,f,n.point,t.point):f>a&&!YO(n.active,t.active)&&s.compareRange(a,f,n.active,t.active),h>o)break;(c||n.openEnd!=t.openEnd)&&s.boundChange&&s.boundChange(h),a=h,d<=0&&n.next(),d>=0&&t.next()}}function YO(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!n[t].eq(e[t]))return!1;return!0}function Km(n,e){for(let t=e,r=n.length-1;t<r;t++)n[t]=n[t+1];n.pop()}function Jm(n,e,t){for(let r=n.length-1;r>=e;r--)n[r+1]=n[r];n[e]=t}function IE(n,e){let t=-1,r=1e9;for(let i=0;i<e.length;i++)(e[i]-r||n[i].endSide-n[t].endSide)<0&&(t=i,r=e[i]);return t}function Ba(n,e,t=n.length){let r=0;for(let i=0;i<t&&i<n.length;)n.charCodeAt(i)==9?(r+=e-r%e,i++):(r++,i=ci(n,i));return r}function wre(n,e,t,r){for(let i=0,s=0;;){if(s>=e)return i;if(i==n.length)break;s+=n.charCodeAt(i)==9?t-s%t:1,i=ci(n,i)}return n.length}const GO="Í¼",ME=typeof Symbol>"u"?"__"+GO:Symbol.for(GO),KO=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),RE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class wc{constructor(e,t){this.rules=[];let{finish:r}=t||{};function i(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,a,l,c){let d=[],h=/^@(\w+)\b/.exec(o[0]),f=h&&h[1]=="keyframes";if(h&&a==null)return l.push(o[0]+";");for(let p in a){let g=a[p];if(/&/.test(p))s(p.split(/,\s*/).map(m=>o.map(v=>m.replace(/&/,v))).reduce((m,v)=>m.concat(v)),g,l);else if(g&&typeof g=="object"){if(!h)throw new RangeError("The value of a property ("+p+") should be a primitive value.");s(i(p),g,d,f)}else g!=null&&d.push(p.replace(/_.*/,"").replace(/[A-Z]/g,m=>"-"+m.toLowerCase())+": "+g+";")}(d.length||f)&&l.push((r&&!h&&!c?o.map(r):o).join(", ")+" {"+d.join(" ")+"}")}for(let o in e)s(i(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=RE[ME]||1;return RE[ME]=e+1,GO+e.toString(36)}static mount(e,t,r){let i=e[KO],s=r&&r.nonce;i?s&&i.setNonce(s):i=new _re(e,s),i.mount(Array.isArray(t)?t:[t],e)}}let DE=new Map;class _re{constructor(e,t){let r=e.ownerDocument||e,i=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&i.CSSStyleSheet){let s=DE.get(r);if(s)return e[KO]=s;this.sheet=new i.CSSStyleSheet,DE.set(r,this)}else this.styleTag=r.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[KO]=this}mount(e,t){let r=this.sheet,i=0,s=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<s&&l>-1&&(this.modules.splice(l,1),s--,l=-1),l==-1){if(this.modules.splice(s++,0,a),r)for(let c=0;c<a.rules.length;c++)r.insertRule(a.rules[c],i++)}else{for(;s<l;)i+=this.modules[s++].rules.length;i+=a.rules.length,s++}}if(r)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=t.head||t;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var _c={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},sg={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Ore=typeof navigator<"u"&&/Mac/.test(navigator.platform),xre=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var li=0;li<10;li++)_c[48+li]=_c[96+li]=String(li);for(var li=1;li<=24;li++)_c[li+111]="F"+li;for(var li=65;li<=90;li++)_c[li]=String.fromCharCode(li+32),sg[li]=String.fromCharCode(li);for(var Kw in _c)sg.hasOwnProperty(Kw)||(sg[Kw]=_c[Kw]);function kre(n){var e=Ore&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||xre&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?sg:_c)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function ii(){var n=arguments[0];typeof n=="string"&&(n=document.createElement(n));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=t[r];typeof i=="string"?n.setAttribute(r,i):i!=null&&(n[r]=i)}e++}for(;e<arguments.length;e++)m$(n,arguments[e]);return n}function m$(n,e){if(typeof e=="string")n.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)n.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)m$(n,e[t]);else throw new RangeError("Unsupported child node: "+e)}let Qi=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},JO=typeof document<"u"?document:{documentElement:{style:{}}};const ex=/Edge\/(\d+)/.exec(Qi.userAgent),v$=/MSIE \d/.test(Qi.userAgent),tx=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Qi.userAgent),Cb=!!(v$||tx||ex),NE=!Cb&&/gecko\/(\d+)/i.test(Qi.userAgent),Jw=!Cb&&/Chrome\/(\d+)/.exec(Qi.userAgent),Sre="webkitFontSmoothing"in JO.documentElement.style,nx=!Cb&&/Apple Computer/.test(Qi.vendor),LE=nx&&(/Mobile\/\w+/.test(Qi.userAgent)||Qi.maxTouchPoints>2);var At={mac:LE||/Mac/.test(Qi.platform),windows:/Win/.test(Qi.platform),linux:/Linux|X11/.test(Qi.platform),ie:Cb,ie_version:v$?JO.documentMode||6:tx?+tx[1]:ex?+ex[1]:0,gecko:NE,gecko_version:NE?+(/Firefox\/(\d+)/.exec(Qi.userAgent)||[0,0])[1]:0,chrome:!!Jw,chrome_version:Jw?+Jw[1]:0,ios:LE,android:/Android\b/.test(Qi.userAgent),webkit_version:Sre?+(/\bAppleWebKit\/(\d+)/.exec(Qi.userAgent)||[0,0])[1]:0,safari:nx,safari_version:nx?+(/\bVersion\/(\d+(\.\d+)?)/.exec(Qi.userAgent)||[0,0])[1]:0,tabSize:JO.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function og(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function rx(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function qv(n,e){if(!e.anchorNode)return!1;try{return rx(n,e.anchorNode)}catch{return!1}}function Ih(n){return n.nodeType==3?Pu(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function _p(n,e,t,r){return t?QE(n,e,t,r,-1)||QE(n,e,t,r,1):!1}function Eu(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function By(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}function QE(n,e,t,r,i){for(;;){if(n==t&&e==r)return!0;if(e==(i<0?0:Ua(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=Eu(n)+(i<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(i<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=i<0?Ua(n):0}else return!1}}function Ua(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function im(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function Tre(n){let e=n.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function y$(n,e){let t=e.width/n.offsetWidth,r=e.height/n.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-n.offsetWidth)<1)&&(t=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(e.height-n.offsetHeight)<1)&&(r=1),{scaleX:t,scaleY:r}}function Are(n,e,t,r,i,s,o,a){let l=n.ownerDocument,c=l.defaultView||window;for(let d=n,h=!1;d&&!h;)if(d.nodeType==1){let f,p=d==l.body,g=1,m=1;if(p)f=Tre(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(d).position)&&(h=!0),d.scrollHeight<=d.clientHeight&&d.scrollWidth<=d.clientWidth){d=d.assignedSlot||d.parentNode;continue}let O=d.getBoundingClientRect();({scaleX:g,scaleY:m}=y$(d,O)),f={left:O.left,right:O.left+d.clientWidth*g,top:O.top,bottom:O.top+d.clientHeight*m}}let v=0,y=0;if(i=="nearest")e.top<f.top?(y=e.top-(f.top+o),t>0&&e.bottom>f.bottom+y&&(y=e.bottom-f.bottom+o)):e.bottom>f.bottom&&(y=e.bottom-f.bottom+o,t<0&&e.top-y<f.top&&(y=e.top-(f.top+o)));else{let O=e.bottom-e.top,_=f.bottom-f.top;y=(i=="center"&&O<=_?e.top+O/2-_/2:i=="start"||i=="center"&&t<0?e.top-o:e.bottom-_+o)-f.top}if(r=="nearest"?e.left<f.left?(v=e.left-(f.left+s),t>0&&e.right>f.right+v&&(v=e.right-f.right+s)):e.right>f.right&&(v=e.right-f.right+s,t<0&&e.left<f.left+v&&(v=e.left-(f.left+s))):v=(r=="center"?e.left+(e.right-e.left)/2-(f.right-f.left)/2:r=="start"==a?e.left-s:e.right-(f.right-f.left)+s)-f.left,v||y)if(p)c.scrollBy(v,y);else{let O=0,_=0;if(y){let x=d.scrollTop;d.scrollTop+=y/m,_=(d.scrollTop-x)*m}if(v){let x=d.scrollLeft;d.scrollLeft+=v/g,O=(d.scrollLeft-x)*g}e={left:e.left-O,top:e.top-_,right:e.right-O,bottom:e.bottom-_},O&&Math.abs(O-v)<1&&(r="nearest"),_&&Math.abs(_-y)<1&&(i="nearest")}if(p)break;(e.top<f.top||e.bottom>f.bottom||e.left<f.left||e.right>f.right)&&(e={left:Math.max(e.left,f.left),right:Math.min(e.right,f.right),top:Math.max(e.top,f.top),bottom:Math.min(e.bottom,f.bottom)}),d=d.assignedSlot||d.parentNode}else if(d.nodeType==11)d=d.host;else break}function Cre(n){let e=n.ownerDocument,t,r;for(let i=n.parentNode;i&&!(i==e.body||t&&r);)if(i.nodeType==1)!r&&i.scrollHeight>i.clientHeight&&(r=i),!t&&i.scrollWidth>i.clientWidth&&(t=i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;return{x:t,y:r}}class Ere{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:r}=e;this.set(t,Math.min(e.anchorOffset,t?Ua(t):0),r,Math.min(e.focusOffset,r?Ua(r):0))}set(e,t,r,i){this.anchorNode=e,this.anchorOffset=t,this.focusNode=r,this.focusOffset=i}}let Vc=null;At.safari&&At.safari_version>=26&&(Vc=!1);function b$(n){if(n.setActive)return n.setActive();if(Vc)return n.focus(Vc);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(Vc==null?{get preventScroll(){return Vc={preventScroll:!0},!0}}:void 0),!Vc){Vc=!1;for(let t=0;t<e.length;){let r=e[t++],i=e[t++],s=e[t++];r.scrollTop!=i&&(r.scrollTop=i),r.scrollLeft!=s&&(r.scrollLeft=s)}}}let $E;function Pu(n,e,t=e){let r=$E||($E=document.createRange());return r.setEnd(n,t),r.setStart(n,e),r}function oh(n,e,t,r){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0};r&&({altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,metaKey:i.metaKey}=r);let s=new KeyboardEvent("keydown",i);s.synthetic=!0,n.dispatchEvent(s);let o=new KeyboardEvent("keyup",i);return o.synthetic=!0,n.dispatchEvent(o),s.defaultPrevented||o.defaultPrevented}function Pre(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function w$(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}function Ire(n,e){let t=e.focusNode,r=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=r)return!1;for(r=Math.min(r,Ua(t));;)if(r){if(t.nodeType!=1)return!1;let i=t.childNodes[r-1];i.contentEditable=="false"?r--:(t=i,r=Ua(t))}else{if(t==n)return!0;r=Eu(t),t=t.parentNode}}function _$(n){return n.scrollTop>Math.max(1,n.scrollHeight-n.clientHeight-4)}function O$(n,e){for(let t=n,r=e;;){if(t.nodeType==3&&r>0)return{node:t,offset:r};if(t.nodeType==1&&r>0){if(t.contentEditable=="false")return null;t=t.childNodes[r-1],r=Ua(t)}else if(t.parentNode&&!By(t))r=Eu(t),t=t.parentNode;else return null}}function x$(n,e){for(let t=n,r=e;;){if(t.nodeType==3&&r<t.nodeValue.length)return{node:t,offset:r};if(t.nodeType==1&&r<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[r],r=0}else if(t.parentNode&&!By(t))r=Eu(t)+1,t=t.parentNode;else return null}}class _i{constructor(e,t,r=!0){this.node=e,this.offset=t,this.precise=r}static before(e,t){return new _i(e.parentNode,Eu(e),t)}static after(e,t){return new _i(e.parentNode,Eu(e)+1,t)}}const i2=[];class Wn{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let r of this.children){if(r==e)return t;t+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let r=this.dom,i=null,s;for(let o of this.children){if(o.flags&7){if(!o.dom&&(s=i?i.nextSibling:r.firstChild)){let a=Wn.get(s);(!a||!a.parent&&a.canReuseDOM(o))&&o.reuseDOM(s)}o.sync(e,t),o.flags&=-8}if(s=i?i.nextSibling:r.firstChild,t&&!t.written&&t.node==r&&s!=o.dom&&(t.written=!0),o.dom.parentNode==r)for(;s&&s!=o.dom;)s=FE(s);else r.insertBefore(o.dom,s);i=o.dom}for(s=i?i.nextSibling:r.firstChild,s&&t&&t.node==r&&(t.written=!0);s;)s=FE(s)}else if(this.flags&1)for(let r of this.children)r.flags&7&&(r.sync(e,t),r.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let r;if(e==this.dom)r=this.dom.childNodes[t];else{let i=Ua(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;i==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?i=-1:i=1),e=s}i<0?r=e:r=e.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!Wn.get(r);)r=r.nextSibling;if(!r)return this.length;for(let i=0,s=0;;i++){let o=this.children[i];if(o.dom==r)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,t,r=0){let i=-1,s=-1,o=-1,a=-1;for(let l=0,c=r,d=r;l<this.children.length;l++){let h=this.children[l],f=c+h.length;if(c<e&&f>t)return h.domBoundsAround(e,t,c);if(f>=e&&i==-1&&(i=l,s=c),c>t&&h.dom.parentNode==this.dom){o=l,a=d;break}d=f,c=f+h.breakAfter}return{from:s,to:a<0?r+this.length:a,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,r=i2){this.markDirty();for(let i=e;i<t;i++){let s=this.children[i];s.parent==this&&r.indexOf(s)<0&&s.destroy()}r.length<250?this.children.splice(e,t-e,...r):this.children=[].concat(this.children.slice(0,e),r,this.children.slice(t));for(let i=0;i<r.length;i++)r[i].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new k$(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,r,i,s,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}Wn.prototype.breakAfter=0;function FE(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class k${constructor(e,t,r){this.children=e,this.pos=t,this.i=r,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}}function S$(n,e,t,r,i,s,o,a,l){let{children:c}=n,d=c.length?c[e]:null,h=s.length?s[s.length-1]:null,f=h?h.breakAfter:o;if(!(e==r&&d&&!o&&!f&&s.length<2&&d.merge(t,i,s.length?h:null,t==0,a,l))){if(r<c.length){let p=c[r];p&&(i<p.length||p.breakAfter&&h?.breakAfter)?(e==r&&(p=p.split(i),i=0),!f&&h&&p.merge(0,i,h,!0,0,l)?s[s.length-1]=p:((i||p.children.length&&!p.children[0].length)&&p.merge(0,i,null,!1,0,l),s.push(p))):p?.breakAfter&&(h?h.breakAfter=1:o=1),r++}for(d&&(d.breakAfter=o,t>0&&(!o&&s.length&&d.merge(t,d.length,s[0],!1,a,0)?d.breakAfter=s.shift().breakAfter:(t<d.length||d.children.length&&d.children[d.children.length-1].length==0)&&d.merge(t,d.length,null,!1,a,0),e++));e<r&&s.length;)if(c[r-1].become(s[s.length-1]))r--,s.pop(),l=s.length?0:a;else if(c[e].become(s[0]))e++,s.shift(),a=s.length?0:l;else break;!s.length&&e&&r<c.length&&!c[e-1].breakAfter&&c[r].merge(0,0,c[e-1],!1,a,l)&&e--,(e<r||s.length)&&n.replaceChildren(e,r,s)}}function T$(n,e,t,r,i,s){let o=n.childCursor(),{i:a,off:l}=o.findPos(t,1),{i:c,off:d}=o.findPos(e,-1),h=e-t;for(let f of r)h+=f.length;n.length+=h,S$(n,c,d,a,l,r,0,i,s)}const Mre=256;class qo extends Wn{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,r){return this.flags&8||r&&(!(r instanceof qo)||this.length-(t-e)+r.length>Mre||r.flags&8)?!1:(this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new qo(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new _i(this.dom,e)}domBoundsAround(e,t,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return Rre(this.dom,e,t)}}class Pl extends Wn{constructor(e,t=[],r=0){super(),this.mark=e,this.children=t,this.length=r;for(let i of t)i.setParent(this)}setAttrs(e){if(w$(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,r,i,s,o){return r&&(!(r instanceof Pl&&r.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)?!1:(T$(this,e,t,r?r.children.slice():[],s-1,o-1),this.markDirty(),!0)}split(e){let t=[],r=0,i=-1,s=0;for(let a of this.children){let l=r+a.length;l>e&&t.push(r<e?a.split(e-r):a),i<0&&r>=e&&(i=s),r=l,s++}let o=this.length-e;return this.length=e,i>-1&&(this.children.length=i,this.markDirty()),new Pl(this.mark,t,o)}domAtPos(e){return A$(this,e)}coordsAt(e,t){return E$(this,e,t)}}function Rre(n,e,t){let r=n.nodeValue.length;e>r&&(e=r);let i=e,s=e,o=0;e==0&&t<0||e==r&&t>=0?At.chrome||At.gecko||(e?(i--,o=1):s<r&&(s++,o=-1)):t<0?i--:s<r&&s++;let a=Pu(n,i,s).getClientRects();if(!a.length)return null;let l=a[(o?o<0:t>=0)?0:a.length-1];return At.safari&&!o&&l.width==0&&(l=Array.prototype.find.call(a,c=>c.width)||l),o?im(l,o<0):l||null}class Jl extends Wn{static create(e,t,r){return new Jl(e,t,r)}constructor(e,t,r){super(),this.widget=e,this.length=t,this.side=r,this.prevWidget=null}split(e){let t=Jl.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,r,i,s,o){return r&&(!(r instanceof Jl)||!this.widget.compare(r.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-t),!0)}become(e){return e instanceof Jl&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return In.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,r=t&&t.state.doc,i=this.posAtStart;return r?r.slice(i,i+this.length):In.empty}domAtPos(e){return(this.length?e==0:this.side>0)?_i.before(this.dom):_i.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let r=this.widget.coordsAt(this.dom,e,t);if(r)return r;let i=this.dom.getClientRects(),s=null;if(!i.length)return null;let o=this.side?this.side<0:e>0;for(let a=o?i.length-1:0;s=i[a],!(e>0?a==0:a==i.length-1||s.top<s.bottom);a+=o?-1:1);return im(s,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Mh extends Wn{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Mh&&e.side==this.side}split(){return new Mh(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?_i.before(this.dom):_i.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return In.empty}get isHidden(){return!0}}qo.prototype.children=Jl.prototype.children=Mh.prototype.children=i2;function A$(n,e){let t=n.dom,{children:r}=n,i=0;for(let s=0;i<r.length;i++){let o=r[i],a=s+o.length;if(!(a==s&&o.getSide()<=0)){if(e>s&&e<a&&o.dom.parentNode==t)return o.domAtPos(e-s);if(e<=s)break;s=a}}for(let s=i;s>0;s--){let o=r[s-1];if(o.dom.parentNode==t)return o.domAtPos(o.length)}for(let s=i;s<r.length;s++){let o=r[s];if(o.dom.parentNode==t)return o.domAtPos(0)}return new _i(t,0)}function C$(n,e,t){let r,{children:i}=n;t>0&&e instanceof Pl&&i.length&&(r=i[i.length-1])instanceof Pl&&r.mark.eq(e.mark)?C$(r,e.children[0],t-1):(i.push(e),e.setParent(n)),n.length+=e.length}function E$(n,e,t){let r=null,i=-1,s=null,o=-1;function a(c,d){for(let h=0,f=0;h<c.children.length&&f<=d;h++){let p=c.children[h],g=f+p.length;g>=d&&(p.children.length?a(p,d-f):(!s||s.isHidden&&(t>0||Nre(s,p)))&&(g>d||f==g&&p.getSide()>0)?(s=p,o=d-f):(f<d||f==g&&p.getSide()<0&&!p.isHidden)&&(r=p,i=d-f)),f=g}}a(n,e);let l=(t<0?r:s)||r||s;return l?l.coordsAt(Math.max(0,l==r?i:o),t):Dre(n)}function Dre(n){let e=n.dom.lastChild;if(!e)return n.dom.getBoundingClientRect();let t=Ih(e);return t[t.length-1]||null}function Nre(n,e){let t=n.coordsAt(0,1),r=e.coordsAt(0,1);return t&&r&&r.top<t.bottom}function ix(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}const zE=Object.create(null);function Uy(n,e,t){if(n==e)return!0;n||(n=zE),e||(e=zE);let r=Object.keys(n),i=Object.keys(e);if(r.length-(t&&r.indexOf(t)>-1?1:0)!=i.length-(t&&i.indexOf(t)>-1?1:0))return!1;for(let s of r)if(s!=t&&(i.indexOf(s)==-1||n[s]!==e[s]))return!1;return!0}function sx(n,e,t){let r=!1;if(e)for(let i in e)t&&i in t||(r=!0,i=="style"?n.style.cssText="":n.removeAttribute(i));if(t)for(let i in t)e&&e[i]==t[i]||(r=!0,i=="style"?n.style.cssText=t[i]:n.setAttribute(i,t[i]));return r}function Lre(n){let e=Object.create(null);for(let t=0;t<n.attributes.length;t++){let r=n.attributes[t];e[r.name]=r.value}return e}class Yo{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,r){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var Ls=(function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n})(Ls||(Ls={}));class hn extends Au{constructor(e,t,r,i){super(),this.startSide=e,this.endSide=t,this.widget=r,this.spec=i}get heightRelevant(){return!1}static mark(e){return new sm(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return t+=r&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new Oc(e,t,t,r,e.widget||null,!1)}static replace(e){let t=!!e.block,r,i;if(e.isBlockGap)r=-5e8,i=4e8;else{let{start:s,end:o}=P$(e,t);r=(s?t?-3e8:-1:5e8)-1,i=(o?t?2e8:1:-6e8)+1}return new Oc(e,r,i,t,e.widget||null,!0)}static line(e){return new om(e)}static set(e,t=!1){return $n.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}hn.none=$n.empty;class sm extends hn{constructor(e){let{start:t,end:r}=P$(e);super(t?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,r;return this==e||e instanceof sm&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((r=e.attrs)===null||r===void 0?void 0:r.class))&&Uy(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}sm.prototype.point=!1;class om extends hn{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof om&&this.spec.class==e.spec.class&&Uy(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}om.prototype.mapMode=zi.TrackBefore;om.prototype.point=!0;class Oc extends hn{constructor(e,t,r,i,s,o){super(t,r,s,e),this.block=i,this.isReplace=o,this.mapMode=i?t<=0?zi.TrackBefore:zi.TrackAfter:zi.TrackDel}get type(){return this.startSide!=this.endSide?Ls.WidgetRange:this.startSide<=0?Ls.WidgetBefore:Ls.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof Oc&&Qre(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}Oc.prototype.point=!0;function P$(n,e=!1){let{inclusiveStart:t,inclusiveEnd:r}=n;return t==null&&(t=n.inclusive),r==null&&(r=n.inclusive),{start:t??e,end:r??e}}function Qre(n,e){return n==e||!!(n&&e&&n.compare(e))}function Hv(n,e,t,r=0){let i=t.length-1;i>=0&&t[i]+r>=n?t[i]=Math.max(t[i],e):t.push(n,e)}class Ir extends Wn{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,r,i,s,o){if(r){if(!(r instanceof Ir))return!1;this.dom||r.transferDOM(this)}return i&&this.setDeco(r?r.attrs:null),T$(this,e,t,r?r.children.slice():[],s,o),!0}split(e){let t=new Ir;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i:r,off:i}=this.childPos(e);i&&(t.append(this.children[r].split(i),0),this.children[r].merge(i,this.children[r].length,null,!1,0,0),r++);for(let s=r;s<this.children.length;s++)t.append(this.children[s],0);for(;r>0&&this.children[r-1].length==0;)this.children[--r].destroy();return this.children.length=r,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Uy(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){C$(this,e,t)}addLineDeco(e){let t=e.spec.attributes,r=e.spec.class;t&&(this.attrs=ix(t,this.attrs||{})),r&&(this.attrs=ix({class:r},this.attrs||{}))}domAtPos(e){return A$(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var r;this.dom?this.flags&4&&(w$(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(sx(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let i=this.dom.lastChild;for(;i&&Wn.get(i)instanceof Pl;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((r=Wn.get(i))===null||r===void 0?void 0:r.isEditable)==!1&&(!At.ios||!this.children.some(s=>s instanceof qo))){let s=document.createElement("BR");s.cmIgnore=!0,this.dom.appendChild(s)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let r of this.children){if(!(r instanceof qo)||/[^ -~]/.test(r.text))return null;let i=Ih(r.dom);if(i.length!=1)return null;e+=i[0].width,t=i[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let r=E$(this,e,t);if(!this.children.length&&r&&this.parent){let{heightOracle:i}=this.parent.view.viewState,s=r.bottom-r.top;if(Math.abs(s-i.lineHeight)<2&&i.textHeight<s){let o=(s-i.textHeight)/2;return{top:r.top+o,bottom:r.bottom-o,left:r.left,right:r.left}}}return r}become(e){return e instanceof Ir&&this.children.length==0&&e.children.length==0&&Uy(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let r=0,i=0;r<e.children.length;r++){let s=e.children[r],o=i+s.length;if(o>=t){if(s instanceof Ir)return s;if(o>t)break}i=o+s.breakAfter}return null}}class wl extends Wn{constructor(e,t,r){super(),this.widget=e,this.length=t,this.deco=r,this.breakAfter=0,this.prevWidget=null}merge(e,t,r,i,s,o){return r&&(!(r instanceof wl)||!this.widget.compare(r.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?_i.before(this.dom):_i.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let r=new wl(this.widget,t,this.deco);return r.breakAfter=this.breakAfter,r}get children(){return i2}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):In.empty}domBoundsAround(){return null}become(e){return e instanceof wl&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){let r=this.widget.coordsAt(this.dom,e,t);return r||(this.widget instanceof ox?null:im(this.dom.getBoundingClientRect(),this.length?e==0:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:r}=this.deco;return t==r?!1:e<0?t<0:r>0}}class ox extends Yo{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class Op{constructor(e,t,r,i){this.doc=e,this.pos=t,this.end=r,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof wl&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ir),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(ev(new Mh(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof wl)&&this.getLine()}buildText(e,t,r){for(;e>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:a,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(a){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=o,this.textOff=0}let i=Math.min(this.text.length-this.textOff,e),s=Math.min(i,512);this.flushBuffer(t.slice(t.length-r)),this.getLine().append(ev(new qo(this.text.slice(this.textOff,this.textOff+s)),t),r),this.atCursorPos=!0,this.textOff+=s,e-=s,r=i<=s?0:t.length}}span(e,t,r,i){this.buildText(t-e,r,i),this.pos=t,this.openStart<0&&(this.openStart=i)}point(e,t,r,i,s,o){if(this.disallowBlockEffectsFor[o]&&r instanceof Oc){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=t-e;if(r instanceof Oc)if(r.block)r.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new wl(r.widget||Rh.block,a,r));else{let l=Jl.create(r.widget||Rh.inline,a,a?0:r.startSide),c=this.atCursorPos&&!l.isEditable&&s<=i.length&&(e<t||r.startSide>0),d=!l.isEditable&&(e<t||s>i.length||r.startSide<=0),h=this.getLine();this.pendingBuffer==2&&!c&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(i),c&&(h.append(ev(new Mh(1),i),s),s=i.length+Math.max(0,s-i.length)),h.append(ev(l,i),s),this.atCursorPos=d,this.pendingBuffer=d?e<t||s>i.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=i.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}static build(e,t,r,i,s){let o=new Op(e,t,r,s);return o.openEnd=$n.spans(i,t,r,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function ev(n,e){for(let t of e)n=new Pl(t,[n],n.length);return n}class Rh extends Yo{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Rh.inline=new Rh("span");Rh.block=new Rh("div");var pr=(function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n})(pr||(pr={}));const Iu=pr.LTR,s2=pr.RTL;function I$(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const $re=I$("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Fre=I$("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),ax=Object.create(null),aa=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);ax[e]=t,ax[t]=-e}function M$(n){return n<=247?$re[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?Fre[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8204?256:64336<=n&&n<=65023?4:1}const zre=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class ec{get dir(){return this.level%2?s2:Iu}constructor(e,t,r){this.from=e,this.to=t,this.level=r}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,r,i){let s=-1;for(let o=0;o<e.length;o++){let a=e[o];if(a.from<=t&&a.to>=t){if(a.level==r)return o;(s<0||(i!=0?i<0?a.from<t:a.to>t:e[s].level>a.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}function R$(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++){let r=n[t],i=e[t];if(r.from!=i.from||r.to!=i.to||r.direction!=i.direction||!R$(r.inner,i.inner))return!1}return!0}const Kn=[];function Bre(n,e,t,r,i){for(let s=0;s<=r.length;s++){let o=s?r[s-1].to:e,a=s<r.length?r[s].from:t,l=s?256:i;for(let c=o,d=l,h=l;c<a;c++){let f=M$(n.charCodeAt(c));f==512?f=d:f==8&&h==4&&(f=16),Kn[c]=f==4?2:f,f&7&&(h=f),d=f}for(let c=o,d=l,h=l;c<a;c++){let f=Kn[c];if(f==128)c<a-1&&d==Kn[c+1]&&d&24?f=Kn[c]=d:Kn[c]=256;else if(f==64){let p=c+1;for(;p<a&&Kn[p]==64;)p++;let g=c&&d==8||p<t&&Kn[p]==8?h==1?1:8:256;for(let m=c;m<p;m++)Kn[m]=g;c=p-1}else f==8&&h==1&&(Kn[c]=1);d=f,f&7&&(h=f)}}}function Ure(n,e,t,r,i){let s=i==1?2:1;for(let o=0,a=0,l=0;o<=r.length;o++){let c=o?r[o-1].to:e,d=o<r.length?r[o].from:t;for(let h=c,f,p,g;h<d;h++)if(p=ax[f=n.charCodeAt(h)])if(p<0){for(let m=a-3;m>=0;m-=3)if(aa[m+1]==-p){let v=aa[m+2],y=v&2?i:v&4?v&1?s:i:0;y&&(Kn[h]=Kn[aa[m]]=y),a=m;break}}else{if(aa.length==189)break;aa[a++]=h,aa[a++]=f,aa[a++]=l}else if((g=Kn[h])==2||g==1){let m=g==i;l=m?0:1;for(let v=a-3;v>=0;v-=3){let y=aa[v+2];if(y&2)break;if(m)aa[v+2]|=2;else{if(y&4)break;aa[v+2]|=4}}}}}function jre(n,e,t,r){for(let i=0,s=r;i<=t.length;i++){let o=i?t[i-1].to:n,a=i<t.length?t[i].from:e;for(let l=o;l<a;){let c=Kn[l];if(c==256){let d=l+1;for(;;)if(d==a){if(i==t.length)break;d=t[i++].to,a=i<t.length?t[i].from:e}else if(Kn[d]==256)d++;else break;let h=s==1,f=(d<e?Kn[d]:r)==1,p=h==f?h?1:2:r;for(let g=d,m=i,v=m?t[m-1].to:n;g>l;)g==v&&(g=t[--m].from,v=m?t[m-1].to:n),Kn[--g]=p;l=d}else s=c,l++}}}function lx(n,e,t,r,i,s,o){let a=r%2?2:1;if(r%2==i%2)for(let l=e,c=0;l<t;){let d=!0,h=!1;if(c==s.length||l<s[c].from){let m=Kn[l];m!=a&&(d=!1,h=m==16)}let f=!d&&a==1?[]:null,p=d?r:r+1,g=l;e:for(;;)if(c<s.length&&g==s[c].from){if(h)break e;let m=s[c];if(!d)for(let v=m.to,y=c+1;;){if(v==t)break e;if(y<s.length&&s[y].from==v)v=s[y++].to;else{if(Kn[v]==a)break e;break}}if(c++,f)f.push(m);else{m.from>l&&o.push(new ec(l,m.from,p));let v=m.direction==Iu!=!(p%2);cx(n,v?r+1:r,i,m.inner,m.from,m.to,o),l=m.to}g=m.to}else{if(g==t||(d?Kn[g]!=a:Kn[g]==a))break;g++}f?lx(n,l,g,r+1,i,f,o):l<g&&o.push(new ec(l,g,p)),l=g}else for(let l=t,c=s.length;l>e;){let d=!0,h=!1;if(!c||l>s[c-1].to){let m=Kn[l-1];m!=a&&(d=!1,h=m==16)}let f=!d&&a==1?[]:null,p=d?r:r+1,g=l;e:for(;;)if(c&&g==s[c-1].to){if(h)break e;let m=s[--c];if(!d)for(let v=m.from,y=c;;){if(v==e)break e;if(y&&s[y-1].to==v)v=s[--y].from;else{if(Kn[v-1]==a)break e;break}}if(f)f.push(m);else{m.to<l&&o.push(new ec(m.to,l,p));let v=m.direction==Iu!=!(p%2);cx(n,v?r+1:r,i,m.inner,m.from,m.to,o),l=m.from}g=m.from}else{if(g==e||(d?Kn[g-1]!=a:Kn[g-1]==a))break;g--}f?lx(n,g,l,r+1,i,f,o):g<l&&o.push(new ec(g,l,p)),l=g}}function cx(n,e,t,r,i,s,o){let a=e%2?2:1;Bre(n,i,s,r,a),Ure(n,i,s,r,a),jre(i,s,r,a),lx(n,i,s,e,t,r,o)}function Vre(n,e,t){if(!n)return[new ec(0,0,e==s2?1:0)];if(e==Iu&&!t.length&&!zre.test(n))return D$(n.length);if(t.length)for(;n.length>Kn.length;)Kn[Kn.length]=256;let r=[],i=e==Iu?0:1;return cx(n,i,i,t,0,n.length,r),r}function D$(n){return[new ec(0,n,0)]}let N$="";function qre(n,e,t,r,i){var s;let o=r.head-n.from,a=ec.find(e,o,(s=r.bidiLevel)!==null&&s!==void 0?s:-1,r.assoc),l=e[a],c=l.side(i,t);if(o==c){let f=a+=i?1:-1;if(f<0||f>=e.length)return null;l=e[a=f],o=l.side(!i,t),c=l.side(i,t)}let d=ci(n.text,o,l.forward(i,t));(d<l.from||d>l.to)&&(d=c),N$=n.text.slice(Math.min(o,d),Math.max(o,d));let h=a==(i?e.length-1:0)?null:e[a+(i?1:-1)];return h&&d==c&&h.level+(i?0:1)<l.level?rt.cursor(h.side(!i,t)+n.from,h.forward(i,t)?1:-1,h.level):rt.cursor(d+n.from,l.forward(i,t)?-1:1,l.level)}function Hre(n,e,t){for(let r=e;r<t;r++){let i=M$(n.charCodeAt(r));if(i==1)return Iu;if(i==2||i==4)return s2}return Iu}const L$=Ut.define(),Q$=Ut.define(),$$=Ut.define(),F$=Ut.define(),ux=Ut.define(),z$=Ut.define(),B$=Ut.define(),o2=Ut.define(),a2=Ut.define(),U$=Ut.define({combine:n=>n.some(e=>e)}),j$=Ut.define({combine:n=>n.some(e=>e)}),V$=Ut.define();class ah{constructor(e,t="nearest",r="nearest",i=5,s=5,o=!1){this.range=e,this.y=t,this.x=r,this.yMargin=i,this.xMargin=s,this.isSnapshot=o}map(e){return e.empty?this:new ah(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new ah(rt.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const tv=en.define({map:(n,e)=>n.map(e)}),q$=en.define();function Ds(n,e,t){let r=n.facet(F$);r.length?r[0](e):window.onerror&&window.onerror(String(e),t,void 0,void 0,e)||(t?console.error(t+":",e):console.error(e))}const hl=Ut.define({combine:n=>n.length?n[0]:!0});let Zre=0;const jd=Ut.define({combine(n){return n.filter((e,t)=>{for(let r=0;r<t;r++)if(n[r].plugin==e.plugin)return!1;return!0})}});class Kr{constructor(e,t,r,i,s){this.id=e,this.create=t,this.domEventHandlers=r,this.domEventObservers=i,this.baseExtensions=s(this),this.extension=this.baseExtensions.concat(jd.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(jd.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:r,eventObservers:i,provide:s,decorations:o}=t||{};return new Kr(Zre++,e,r,i,a=>{let l=[];return o&&l.push(ag.of(c=>{let d=c.plugin(a);return d?o(d):hn.none})),s&&l.push(s(a)),l})}static fromClass(e,t){return Kr.define((r,i)=>new e(r,i),t)}}class e1{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(r){if(Ds(t.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){Ds(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(r){Ds(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const H$=Ut.define(),l2=Ut.define(),ag=Ut.define(),Z$=Ut.define(),am=Ut.define(),W$=Ut.define();function BE(n,e){let t=n.state.facet(W$);if(!t.length)return t;let r=t.map(s=>s instanceof Function?s(n):s),i=[];return $n.spans(r,e.from,e.to,{point(){},span(s,o,a,l){let c=s-e.from,d=o-e.from,h=i;for(let f=a.length-1;f>=0;f--,l--){let p=a[f].spec.bidiIsolate,g;if(p==null&&(p=Hre(e.text,c,d)),l>0&&h.length&&(g=h[h.length-1]).to==c&&g.direction==p)g.to=d,h=g.inner;else{let m={from:c,to:d,direction:p,inner:[]};h.push(m),h=m.inner}}}}),i}const X$=Ut.define();function c2(n){let e=0,t=0,r=0,i=0;for(let s of n.state.facet(X$)){let o=s(n);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(t=Math.max(t,o.right)),o.top!=null&&(r=Math.max(r,o.top)),o.bottom!=null&&(i=Math.max(i,o.bottom)))}return{left:e,right:t,top:r,bottom:i}}const rp=Ut.define();class vo{constructor(e,t,r,i){this.fromA=e,this.toA=t,this.fromB=r,this.toB=i}join(e){return new vo(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,r=this;for(;t>0;t--){let i=e[t-1];if(!(i.fromA>r.toA)){if(i.toA<r.fromA)break;r=r.join(i),e.splice(t-1,1)}}return e.splice(t,0,r),e}static extendWithRanges(e,t){if(t.length==0)return e;let r=[];for(let i=0,s=0,o=0,a=0;;i++){let l=i==e.length?null:e[i],c=o-a,d=l?l.fromB:1e9;for(;s<t.length&&t[s]<d;){let h=t[s],f=t[s+1],p=Math.max(a,h),g=Math.min(d,f);if(p<=g&&new vo(p+c,g+c,p,g).addToSet(r),f>d)break;s+=2}if(!l)return r;new vo(l.fromA,l.toA,l.fromB,l.toB).addToSet(r),o=l.toA,a=l.toB}}}class jy{constructor(e,t,r){this.view=e,this.state=t,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=Mr.empty(this.startState.doc.length);for(let s of r)this.changes=this.changes.compose(s.changes);let i=[];this.changes.iterChangedRanges((s,o,a,l)=>i.push(new vo(s,o,a,l))),this.changedRanges=i}static create(e,t,r){return new jy(e,t,r)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class UE extends Wn{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=hn.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Ir],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new vo(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:c,toA:d})=>d<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let i=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?i=this.domChanged.newSel.head:!eie(e.changes,this.hasComposition)&&!e.selectionSet&&(i=e.state.selection.main.head));let s=i>-1?Xre(this.view,e.changes,i):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:c,to:d}=this.hasComposition;r=new vo(c,d,e.changes.mapPos(c,-1),e.changes.mapPos(d,1)).addToSet(r.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(At.ie||At.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,a=this.updateDeco(),l=Kre(o,a,e.changes);return r=vo.extendWithRanges(r,l),!(this.flags&7)&&r.length==0?!1:(this.updateInner(r,e.startState.doc.length,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,r){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,r);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=At.chrome||At.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||i.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof wl&&o.widget instanceof ox&&s.push(o.dom);i.updateGaps(s)}updateChildren(e,t,r){let i=r?r.range.addToSet(e.slice()):e,s=this.childCursor(t);for(let o=i.length-1;;o--){let a=o>=0?i[o]:null;if(!a)break;let{fromA:l,toA:c,fromB:d,toB:h}=a,f,p,g,m;if(r&&r.range.fromB<h&&r.range.toB>d){let x=Op.build(this.view.state.doc,d,r.range.fromB,this.decorations,this.dynamicDecorationMap),k=Op.build(this.view.state.doc,r.range.toB,h,this.decorations,this.dynamicDecorationMap);p=x.breakAtStart,g=x.openStart,m=k.openEnd;let S=this.compositionView(r);k.breakAtStart?S.breakAfter=1:k.content.length&&S.merge(S.length,S.length,k.content[0],!1,k.openStart,0)&&(S.breakAfter=k.content[0].breakAfter,k.content.shift()),x.content.length&&S.merge(0,0,x.content[x.content.length-1],!0,0,x.openEnd)&&x.content.pop(),f=x.content.concat(S).concat(k.content)}else({content:f,breakAtStart:p,openStart:g,openEnd:m}=Op.build(this.view.state.doc,d,h,this.decorations,this.dynamicDecorationMap));let{i:v,off:y}=s.findPos(c,1),{i:O,off:_}=s.findPos(l,-1);S$(this,O,_,v,y,f,p,g,m)}r&&this.fixCompositionDOM(r)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let r of t.effects)r.is(q$)&&(this.editContextFormatting=r.value)}compositionView(e){let t=new qo(e.text.nodeValue);t.flags|=8;for(let{deco:i}of e.marks)t=new Pl(i,[t],t.length);let r=new Ir;return r.append(t,0),r}fixCompositionDOM(e){let t=(s,o)=>{o.flags|=8|(o.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(o);let a=Wn.get(s);a&&a!=o&&(a.dom=null),o.setDOM(s)},r=this.childPos(e.range.fromB,1),i=this.children[r.i];t(e.line,i);for(let s=e.marks.length-1;s>=-1;s--)r=i.childPos(r.off,1),i=i.children[r.i],t(s>=0?e.marks[s].node:e.text,i)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let r=this.view.root.activeElement,i=r==this.dom,s=!i&&!(this.view.state.facet(hl)||this.dom.tabIndex>-1)&&qv(this.dom,this.view.observer.selectionRange)&&!(r&&this.dom.contains(r));if(!(i||t||s))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(a.anchor)),c=a.empty?l:this.moveToLine(this.domAtPos(a.head));if(At.gecko&&a.empty&&!this.hasComposition&&Wre(l)){let h=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(h,l.node.childNodes[l.offset]||null)),l=c=new _i(h,0),o=!0}let d=this.view.observer.selectionRange;(o||!d.focusNode||(!_p(l.node,l.offset,d.anchorNode,d.anchorOffset)||!_p(c.node,c.offset,d.focusNode,d.focusOffset))&&!this.suppressWidgetCursorChange(d,a))&&(this.view.observer.ignore(()=>{At.android&&At.chrome&&this.dom.contains(d.focusNode)&&Jre(d.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=og(this.view.root);if(h)if(a.empty){if(At.gecko){let f=Yre(l.node,l.offset);if(f&&f!=3){let p=(f==1?O$:x$)(l.node,l.offset);p&&(l=new _i(p.node,p.offset))}}h.collapse(l.node,l.offset),a.bidiLevel!=null&&h.caretBidiLevel!==void 0&&(h.caretBidiLevel=a.bidiLevel)}else if(h.extend){h.collapse(l.node,l.offset);try{h.extend(c.node,c.offset)}catch{}}else{let f=document.createRange();a.anchor>a.head&&([l,c]=[c,l]),f.setEnd(c.node,c.offset),f.setStart(l.node,l.offset),h.removeAllRanges(),h.addRange(f)}s&&this.view.root.activeElement==this.dom&&(this.dom.blur(),r&&r.focus())}),this.view.observer.setSelectionRange(l,c)),this.impreciseAnchor=l.precise?null:new _i(d.anchorNode,d.anchorOffset),this.impreciseHead=c.precise?null:new _i(d.focusNode,d.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&_p(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,r=og(e.root),{anchorNode:i,anchorOffset:s}=e.observer.selectionRange;if(!r||!t.empty||!t.assoc||!r.modify)return;let o=Ir.find(this,t.head);if(!o)return;let a=o.posAtStart;if(t.head==a||t.head==a+o.length)return;let l=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!l||!c||l.bottom>c.top)return;let d=this.domAtPos(t.head+t.assoc);r.collapse(d.node,d.offset),r.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=t.from&&r.collapse(i,s)}moveToLine(e){let t=this.dom,r;if(e.node!=t)return e;for(let i=e.offset;!r&&i<t.childNodes.length;i++){let s=Wn.get(t.childNodes[i]);s instanceof Ir&&(r=s.domAtPos(0))}for(let i=e.offset-1;!r&&i>=0;i--){let s=Wn.get(t.childNodes[i]);s instanceof Ir&&(r=s.domAtPos(s.length))}return r?new _i(r.node,r.offset,!0):e}nearest(e){for(let t=e;t;){let r=Wn.get(t);if(r&&r.rootView==this)return r;t=t.parentNode}return null}posFromDOM(e,t){let r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,t)+r.posAtStart}domAtPos(e){let{i:t,off:r}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let i=this.children[t];if(r<i.length||i instanceof Ir)break;t++,r=0}return this.children[t].domAtPos(r)}coordsAt(e,t){let r=null,i=0;for(let s=this.length,o=this.children.length-1;o>=0;o--){let a=this.children[o],l=s-a.breakAfter,c=l-a.length;if(l<e)break;if(c<=e&&(c<e||a.covers(-1))&&(l>e||a.covers(1))&&(!r||a instanceof Ir&&!(r instanceof Ir&&t>=0)))r=a,i=c;else if(r&&c==e&&l==e&&a instanceof wl&&Math.abs(t)<2){if(a.deco.startSide<0)break;o&&(r=null)}s=c}return r?r.coordsAt(e-i,t):null}coordsForChar(e){let{i:t,off:r}=this.childPos(e,1),i=this.children[t];if(!(i instanceof Ir))return null;for(;i.children.length;){let{i:a,off:l}=i.childPos(r,1);for(;;a++){if(a==i.children.length)return null;if((i=i.children[a]).length)break}r=l}if(!(i instanceof qo))return null;let s=ci(i.text,r);if(s==r)return null;let o=Pu(i.dom,r,s).getClientRects();for(let a=0;a<o.length;a++){let l=o[a];if(a==o.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(e){let t=[],{from:r,to:i}=e,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==pr.LTR;for(let c=0,d=0;d<this.children.length;d++){let h=this.children[d],f=c+h.length;if(f>i)break;if(c>=r){let p=h.dom.getBoundingClientRect();if(t.push(p.height),o){let g=h.dom.lastChild,m=g?Ih(g):[];if(m.length){let v=m[m.length-1],y=l?v.right-p.left:p.right-v.left;y>a&&(a=y,this.minWidth=s,this.minWidthFrom=c,this.minWidthTo=f)}}}c=f+h.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?pr.RTL:pr.LTR}measureTextSize(){for(let s of this.children)if(s instanceof Ir){let o=s.measureTextSize();if(o)return o}let e=document.createElement("div"),t,r,i;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let s=Ih(e.firstChild)[0];t=e.getBoundingClientRect().height,r=s?s.width/27:7,i=s?s.height:t,e.remove()}),{lineHeight:t,charWidth:r,textHeight:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new k$(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let r=0,i=0;;i++){let s=i==t.viewports.length?null:t.viewports[i],o=s?s.from-1:this.length;if(o>r){let a=(t.lineBlockAt(o).bottom-t.lineBlockAt(r).top)/this.view.scaleY;e.push(hn.replace({widget:new ox(a),block:!0,inclusive:!0,isBlockGap:!0}).range(r,o))}if(!s)break;r=s.to+1}return hn.set(e)}updateDeco(){let e=1,t=this.view.state.facet(ag).map(s=>(this.dynamicDecorationMap[e++]=typeof s=="function")?s(this.view):s),r=!1,i=this.view.state.facet(Z$).map((s,o)=>{let a=typeof s=="function";return a&&(r=!0),a?s(this.view):s});for(i.length&&(this.dynamicDecorationMap[e++]=r,t.push($n.join(i))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(V$))try{if(c(this.view,e.range,e))return!0}catch(d){Ds(this.view.state,d,"scroll handler")}let{range:t}=e,r=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),i;if(!r)return;!t.empty&&(i=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(r={left:Math.min(r.left,i.left),top:Math.min(r.top,i.top),right:Math.max(r.right,i.right),bottom:Math.max(r.bottom,i.bottom)});let s=c2(this.view),o={left:r.left-s.left,top:r.top-s.top,right:r.right+s.right,bottom:r.bottom+s.bottom},{offsetWidth:a,offsetHeight:l}=this.view.scrollDOM;Are(this.view.scrollDOM,o,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,a),-a),Math.max(Math.min(e.yMargin,l),-l),this.view.textDirection==pr.LTR)}lineHasWidget(e){let{i:t}=this.childCursor().findPos(e);if(t==this.children.length)return!1;let r=i=>i instanceof Jl||i.children.some(r);return r(this.children[t])}}function Wre(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}function Y$(n,e){let t=n.observer.selectionRange;if(!t.focusNode)return null;let r=O$(t.focusNode,t.focusOffset),i=x$(t.focusNode,t.focusOffset),s=r||i;if(i&&r&&i.node!=r.node){let a=Wn.get(i.node);if(!a||a instanceof qo&&a.text!=i.node.nodeValue)s=i;else if(n.docView.lastCompositionAfterCursor){let l=Wn.get(r.node);!l||l instanceof qo&&l.text!=r.node.nodeValue||(s=i)}}if(n.docView.lastCompositionAfterCursor=s!=r,!s)return null;let o=e-s.offset;return{from:o,to:o+s.node.nodeValue.length,node:s.node}}function Xre(n,e,t){let r=Y$(n,t);if(!r)return null;let{node:i,from:s,to:o}=r,a=i.nodeValue;if(/[\n\r]/.test(a)||n.state.doc.sliceString(r.from,r.to)!=a)return null;let l=e.invertedDesc,c=new vo(l.mapPos(s),l.mapPos(o),s,o),d=[];for(let h=i.parentNode;;h=h.parentNode){let f=Wn.get(h);if(f instanceof Pl)d.push({node:h,deco:f.mark});else{if(f instanceof Ir||h.nodeName=="DIV"&&h.parentNode==n.contentDOM)return{range:c,text:i,marks:d,line:h};if(h!=n.contentDOM)d.push({node:h,deco:new sm({inclusive:!0,attributes:Lre(h),tagName:h.tagName.toLowerCase()})});else return null}}}function Yre(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}let Gre=class{constructor(){this.changes=[]}compareRange(e,t){Hv(e,t,this.changes)}comparePoint(e,t){Hv(e,t,this.changes)}boundChange(e){Hv(e,e,this.changes)}};function Kre(n,e,t){let r=new Gre;return $n.compare(n,e,t,r),r.changes}function Jre(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function eie(n,e){let t=!1;return e&&n.iterChangedRanges((r,i)=>{r<e.to&&i>e.from&&(t=!0)}),t}function tie(n,e,t=1){let r=n.charCategorizer(e),i=n.doc.lineAt(e),s=e-i.from;if(i.length==0)return rt.cursor(e);s==0?t=1:s==i.length&&(t=-1);let o=s,a=s;t<0?o=ci(i.text,s,!1):a=ci(i.text,s);let l=r(i.text.slice(o,a));for(;o>0;){let c=ci(i.text,o,!1);if(r(i.text.slice(c,o))!=l)break;o=c}for(;a<i.length;){let c=ci(i.text,a);if(r(i.text.slice(a,c))!=l)break;a=c}return rt.range(o+i.from,a+i.from)}function nie(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function rie(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function t1(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function jE(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function VE(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function dx(n,e,t){let r,i,s,o,a=!1,l,c,d,h;for(let g=n.firstChild;g;g=g.nextSibling){let m=Ih(g);for(let v=0;v<m.length;v++){let y=m[v];i&&t1(i,y)&&(y=jE(VE(y,i.bottom),i.top));let O=nie(e,y),_=rie(t,y);if(O==0&&_==0)return g.nodeType==3?qE(g,e,t):dx(g,e,t);(!r||o>_||o==_&&s>O)&&(r=g,i=y,s=O,o=_,a=O?e<y.left?v>0:v<m.length-1:!0),O==0?t>y.bottom&&(!d||d.bottom<y.bottom)?(l=g,d=y):t<y.top&&(!h||h.top>y.top)&&(c=g,h=y):d&&t1(d,y)?d=VE(d,y.bottom):h&&t1(h,y)&&(h=jE(h,y.top))}}if(d&&d.bottom>=t?(r=l,i=d):h&&h.top<=t&&(r=c,i=h),!r)return{node:n,offset:0};let f=Math.max(i.left,Math.min(i.right,e));if(r.nodeType==3)return qE(r,f,t);if(a&&r.contentEditable!="false")return dx(r,f,t);let p=Array.prototype.indexOf.call(n.childNodes,r)+(e>=(i.left+i.right)/2?1:0);return{node:n,offset:p}}function qE(n,e,t){let r=n.nodeValue.length,i=-1,s=1e9,o=0;for(let a=0;a<r;a++){let l=Pu(n,a,a+1).getClientRects();for(let c=0;c<l.length;c++){let d=l[c];if(d.top==d.bottom)continue;o||(o=e-d.left);let h=(d.top>t?d.top-t:t-d.bottom)-1;if(d.left-1<=e&&d.right+1>=e&&h<s){let f=e>=(d.left+d.right)/2,p=f;if(At.chrome||At.gecko){let g=Pu(n,a).getBoundingClientRect();Math.abs(g.left-d.right)<.1&&(p=!f)}if(h<=0)return{node:n,offset:a+(p?1:0)};i=a+(p?1:0),s=h}}}return{node:n,offset:i>-1?i:o>0?n.nodeValue.length:0}}function G$(n,e,t,r=-1){var i,s;let o=n.contentDOM.getBoundingClientRect(),a=o.top+n.viewState.paddingTop,l,{docHeight:c}=n.viewState,{x:d,y:h}=e,f=h-a;if(f<0)return 0;if(f>c)return n.state.doc.length;for(let x=n.viewState.heightOracle.textHeight/2,k=!1;l=n.elementAtHeight(f),l.type!=Ls.Text;)for(;f=r>0?l.bottom+x:l.top-x,!(f>=0&&f<=c);){if(k)return t?null:0;k=!0,r=-r}h=a+f;let p=l.from;if(p<n.viewport.from)return n.viewport.from==0?0:t?null:HE(n,o,l,d,h);if(p>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:t?null:HE(n,o,l,d,h);let g=n.dom.ownerDocument,m=n.root.elementFromPoint?n.root:g,v=m.elementFromPoint(d,h);v&&!n.contentDOM.contains(v)&&(v=null),v||(d=Math.max(o.left+1,Math.min(o.right-1,d)),v=m.elementFromPoint(d,h),v&&!n.contentDOM.contains(v)&&(v=null));let y,O=-1;if(v&&((i=n.docView.nearest(v))===null||i===void 0?void 0:i.isEditable)!=!1){if(g.caretPositionFromPoint){let x=g.caretPositionFromPoint(d,h);x&&({offsetNode:y,offset:O}=x)}else if(g.caretRangeFromPoint){let x=g.caretRangeFromPoint(d,h);x&&({startContainer:y,startOffset:O}=x)}y&&(!n.contentDOM.contains(y)||At.safari&&iie(y,O,d)||At.chrome&&sie(y,O,d))&&(y=void 0),y&&(O=Math.min(Ua(y),O))}if(!y||!n.docView.dom.contains(y)){let x=Ir.find(n.docView,p);if(!x)return f>l.top+l.height/2?l.to:l.from;({node:y,offset:O}=dx(x.dom,d,h))}let _=n.docView.nearest(y);if(!_)return null;if(_.isWidget&&((s=_.dom)===null||s===void 0?void 0:s.nodeType)==1){let x=_.dom.getBoundingClientRect();return e.y<x.top||e.y<=x.bottom&&e.x<=(x.left+x.right)/2?_.posAtStart:_.posAtEnd}else return _.localPosFromDOM(y,O)+_.posAtStart}function HE(n,e,t,r,i){let s=Math.round((r-e.left)*n.defaultCharacterWidth);if(n.lineWrapping&&t.height>n.defaultLineHeight*1.5){let a=n.viewState.heightOracle.textHeight,l=Math.floor((i-t.top-(n.defaultLineHeight-a)*.5)/a);s+=l*n.viewState.heightOracle.lineLength}let o=n.state.sliceDoc(t.from,t.to);return t.from+wre(o,s,n.state.tabSize)}function K$(n,e,t){let r,i=n;if(n.nodeType!=3||e!=(r=n.nodeValue.length))return!1;for(;;){let s=i.nextSibling;if(s){if(s.nodeName=="BR")break;return!1}else{let o=i.parentNode;if(!o||o.nodeName=="DIV")break;i=o}}return Pu(n,r-1,r).getBoundingClientRect().right>t}function iie(n,e,t){return K$(n,e,t)}function sie(n,e,t){if(e!=0)return K$(n,e,t);for(let i=n;;){let s=i.parentNode;if(!s||s.nodeType!=1||s.firstChild!=i)return!1;if(s.classList.contains("cm-line"))break;i=s}let r=n.nodeType==1?n.getBoundingClientRect():Pu(n,0,Math.max(n.nodeValue.length,1)).getBoundingClientRect();return t-r.left>5}function hx(n,e,t){let r=n.lineBlockAt(e);if(Array.isArray(r.type)){let i;for(let s of r.type){if(s.from>e)break;if(!(s.to<e)){if(s.from<e&&s.to>e)return s;(!i||s.type==Ls.Text&&(i.type!=s.type||(t<0?s.from<e:s.to>e)))&&(i=s)}}return i||r}return r}function oie(n,e,t,r){let i=hx(n,e.head,e.assoc||-1),s=!r||i.type!=Ls.Text||!(n.lineWrapping||i.widgetLineBreaks)?null:n.coordsAtPos(e.assoc<0&&e.head>i.from?e.head-1:e.head);if(s){let o=n.dom.getBoundingClientRect(),a=n.textDirectionAt(i.from),l=n.posAtCoords({x:t==(a==pr.LTR)?o.right-1:o.left+1,y:(s.top+s.bottom)/2});if(l!=null)return rt.cursor(l,t?-1:1)}return rt.cursor(t?i.to:i.from,t?-1:1)}function ZE(n,e,t,r){let i=n.state.doc.lineAt(e.head),s=n.bidiSpans(i),o=n.textDirectionAt(i.from);for(let a=e,l=null;;){let c=qre(i,s,o,a,t),d=N$;if(!c){if(i.number==(t?n.state.doc.lines:1))return a;d=`
`,i=n.state.doc.line(i.number+(t?1:-1)),s=n.bidiSpans(i),c=n.visualLineSide(i,!t)}if(l){if(!l(d))return a}else{if(!r)return c;l=r(d)}a=c}}function aie(n,e,t){let r=n.state.charCategorizer(e),i=r(t);return s=>{let o=r(s);return i==ui.Space&&(i=o),i==o}}function lie(n,e,t,r){let i=e.head,s=t?1:-1;if(i==(t?n.state.doc.length:0))return rt.cursor(i,e.assoc);let o=e.goalColumn,a,l=n.contentDOM.getBoundingClientRect(),c=n.coordsAtPos(i,e.assoc||-1),d=n.documentTop;if(c)o==null&&(o=c.left-l.left),a=s<0?c.top:c.bottom;else{let p=n.viewState.lineBlockAt(i);o==null&&(o=Math.min(l.right-l.left,n.defaultCharacterWidth*(i-p.from))),a=(s<0?p.top:p.bottom)+d}let h=l.left+o,f=r??n.viewState.heightOracle.textHeight>>1;for(let p=0;;p+=10){let g=a+(f+p)*s,m=G$(n,{x:h,y:g},!1,s);if(g<l.top||g>l.bottom||(s<0?m<i:m>i)){let v=n.docView.coordsForChar(m),y=!v||g<v.top?-1:1;return rt.cursor(m,y,void 0,o)}}}function xp(n,e,t){for(;;){let r=0;for(let i of n)i.between(e-1,e+1,(s,o,a)=>{if(e>s&&e<o){let l=r||t||(e-s<o-e?-1:1);e=l<0?s:o,r=l}});if(!r)return e}}function J$(n,e){let t=null;for(let r=0;r<e.ranges.length;r++){let i=e.ranges[r],s=null;if(i.empty){let o=xp(n,i.from,0);o!=i.from&&(s=rt.cursor(o,-1))}else{let o=xp(n,i.from,-1),a=xp(n,i.to,1);(o!=i.from||a!=i.to)&&(s=rt.range(i.from==i.anchor?o:a,i.from==i.head?o:a))}s&&(t||(t=e.ranges.slice()),t[r]=s)}return t?rt.create(t,e.mainIndex):e}function n1(n,e,t){let r=xp(n.state.facet(am).map(i=>i(n)),t.from,e.head>t.from?-1:1);return r==t.from?t:rt.cursor(r,r<t.from?1:-1)}const ip="ï¿¿";class cie{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(un.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=ip}readRange(e,t){if(!e)return this;let r=e.parentNode;for(let i=e;;){this.findPointBefore(r,i);let s=this.text.length;this.readNode(i);let o=i.nextSibling;if(o==t)break;let a=Wn.get(i),l=Wn.get(o);(a&&l?a.breakAfter:(a?a.breakAfter:By(i))||By(o)&&(i.nodeName!="BR"||i.cmIgnore)&&this.text.length>s)&&!die(o,t)&&this.lineBreak(),i=o}return this.findPointBefore(r,t),this}readTextNode(e){let t=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,t.length));for(let r=0,i=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,a;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,r),o=this.lineSeparator.length):(a=i.exec(t))&&(s=a.index,o=a[0].length),this.append(t.slice(r,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=o-1);r=s+o}}readNode(e){if(e.cmIgnore)return;let t=Wn.get(e),r=t&&t.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let i=r.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==t&&(r.pos=this.text.length)}findPointInside(e,t){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(uie(e,r.node,r.offset)?t:0))}}function uie(n,e,t){for(;;){if(!e||t<Ua(e))return!1;if(e==n)return!0;t=Eu(e)+1,e=e.parentNode}}function die(n,e){let t;for(;!(n==e||!n);n=n.nextSibling){let r=Wn.get(n);if(!(r?.isWidget||n.cmIgnore))return!1;r&&(t||(t=[])).push(r)}if(t)for(let r of t){let i=r.overrideDOMText;if(i?.length)return!1}return!0}class WE{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class hie{constructor(e,t,r,i){this.typeOver=i,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:s,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,r,0))){let a=s||o?[]:pie(e),l=new cie(a,e.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=gie(a,this.bounds.from)}else{let a=e.observer.selectionRange,l=s&&s.node==a.focusNode&&s.offset==a.focusOffset||!rx(e.contentDOM,a.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(a.focusNode,a.focusOffset),c=o&&o.node==a.anchorNode&&o.offset==a.anchorOffset||!rx(e.contentDOM,a.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(a.anchorNode,a.anchorOffset),d=e.viewport;if((At.ios||At.chrome)&&e.state.selection.main.empty&&l!=c&&(d.from>0||d.to<e.state.doc.length)){let h=Math.min(l,c),f=Math.max(l,c),p=d.from-h,g=d.to-f;(p==0||p==1||h==0)&&(g==0||g==-1||f==e.state.doc.length)&&(l=0,c=e.state.doc.length)}e.inputState.composing>-1&&e.state.selection.ranges.length>1?this.newSel=e.state.selection.replaceRange(rt.range(c,l)):this.newSel=rt.single(c,l)}}}function e6(n,e){let t,{newSel:r}=e,i=n.state.selection.main,s=n.inputState.lastKeyTime>Date.now()-100?n.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:a}=e.bounds,l=i.from,c=null;(s===8||At.android&&e.text.length<a-o)&&(l=i.to,c="end");let d=t6(n.state.doc.sliceString(o,a,ip),e.text,l-o,c);d&&(At.chrome&&s==13&&d.toB==d.from+2&&e.text.slice(d.from,d.toB)==ip+ip&&d.toB--,t={from:o+d.from,to:o+d.toA,insert:In.of(e.text.slice(d.from,d.toB).split(ip))})}else r&&(!n.hasFocus&&n.state.facet(hl)||r.main.eq(i))&&(r=null);if(!t&&!r)return!1;if(!t&&e.typeOver&&!i.empty&&r&&r.main.empty?t={from:i.from,to:i.to,insert:n.state.doc.slice(i.from,i.to)}:(At.mac||At.android)&&t&&t.from==t.to&&t.from==i.head-1&&/^\. ?$/.test(t.insert.toString())&&n.contentDOM.getAttribute("autocorrect")=="off"?(r&&t.insert.length==2&&(r=rt.single(r.main.anchor-1,r.main.head-1)),t={from:t.from,to:t.to,insert:In.of([t.insert.toString().replace("."," ")])}):t&&t.from>=i.from&&t.to<=i.to&&(t.from!=i.from||t.to!=i.to)&&i.to-i.from-(t.to-t.from)<=4?t={from:i.from,to:i.to,insert:n.state.doc.slice(i.from,t.from).append(t.insert).append(n.state.doc.slice(t.to,i.to))}:n.state.doc.lineAt(i.from).to<i.to&&n.docView.lineHasWidget(i.to)&&n.inputState.insertingTextAt>Date.now()-50?t={from:i.from,to:i.to,insert:n.state.toText(n.inputState.insertingText)}:At.chrome&&t&&t.from==t.to&&t.from==i.head&&t.insert.toString()==`
 `&&n.lineWrapping&&(r&&(r=rt.single(r.main.anchor-1,r.main.head-1)),t={from:i.from,to:i.to,insert:In.of([" "])}),t)return u2(n,t,r,s);if(r&&!r.main.eq(i)){let o=!1,a="select";return n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(o=!0),a=n.inputState.lastSelectionOrigin,a=="select.pointer"&&(r=J$(n.state.facet(am).map(l=>l(n)),r))),n.dispatch({selection:r,scrollIntoView:o,userEvent:a}),!0}else return!1}function u2(n,e,t,r=-1){if(At.ios&&n.inputState.flushIOSKey(e))return!0;let i=n.state.selection.main;if(At.android&&(e.to==i.to&&(e.from==i.from||e.from==i.from-1&&n.state.sliceDoc(e.from,i.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&oh(n.contentDOM,"Enter",13)||(e.from==i.from-1&&e.to==i.to&&e.insert.length==0||r==8&&e.insert.length<e.to-e.from&&e.to>i.head)&&oh(n.contentDOM,"Backspace",8)||e.from==i.from&&e.to==i.to+1&&e.insert.length==0&&oh(n.contentDOM,"Delete",46)))return!0;let s=e.insert.toString();n.inputState.composing>=0&&n.inputState.composing++;let o,a=()=>o||(o=fie(n,e,t));return n.state.facet(z$).some(l=>l(n,e.from,e.to,s,a))||n.dispatch(a()),!0}function fie(n,e,t){let r,i=n.state,s=i.selection.main,o=-1;if(e.from==e.to&&e.from<s.from||e.from>s.to){let l=e.from<s.from?-1:1,c=l<0?s.from:s.to,d=xp(i.facet(am).map(h=>h(n)),c,l);e.from==d&&(o=d)}if(o>-1)r={changes:e,selection:rt.cursor(e.from+e.insert.length,-1)};else if(e.from>=s.from&&e.to<=s.to&&e.to-e.from>=(s.to-s.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&n.inputState.composing<0){let l=s.from<e.from?i.sliceDoc(s.from,e.from):"",c=s.to>e.to?i.sliceDoc(e.to,s.to):"";r=i.replaceSelection(n.state.toText(l+e.insert.sliceString(0,void 0,n.state.lineBreak)+c))}else{let l=i.changes(e),c=t&&t.main.to<=l.newLength?t.main:void 0;if(i.selection.ranges.length>1&&(n.inputState.composing>=0||n.inputState.compositionPendingChange)&&e.to<=s.to+10&&e.to>=s.to-10){let d=n.state.sliceDoc(e.from,e.to),h,f=t&&Y$(n,t.main.head);if(f){let g=e.insert.length-(e.to-e.from);h={from:f.from,to:f.to-g}}else h=n.state.doc.lineAt(s.head);let p=s.to-e.to;r=i.changeByRange(g=>{if(g.from==s.from&&g.to==s.to)return{changes:l,range:c||g.map(l)};let m=g.to-p,v=m-d.length;if(n.state.sliceDoc(v,m)!=d||m>=h.from&&v<=h.to)return{range:g};let y=i.changes({from:v,to:m,insert:e.insert}),O=g.to-s.to;return{changes:y,range:c?rt.range(Math.max(0,c.anchor+O),Math.max(0,c.head+O)):g.map(y)}})}else r={changes:l,selection:c&&i.selection.replaceRange(c)}}let a="input.type";return(n.composing||n.inputState.compositionPendingChange&&n.inputState.compositionEndedAt>Date.now()-50)&&(n.inputState.compositionPendingChange=!1,a+=".compose",n.inputState.compositionFirstChange&&(a+=".start",n.inputState.compositionFirstChange=!1)),i.update(r,{userEvent:a,scrollIntoView:!0})}function t6(n,e,t,r){let i=Math.min(n.length,e.length),s=0;for(;s<i&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==i&&n.length==e.length)return null;let o=n.length,a=e.length;for(;o>0&&a>0&&n.charCodeAt(o-1)==e.charCodeAt(a-1);)o--,a--;if(r=="end"){let l=Math.max(0,s-Math.min(o,a));t-=o+l-s}if(o<s&&n.length<e.length){let l=t<=s&&t>=o?s-t:0;s-=l,a=s+(a-o),o=s}else if(a<s){let l=t<=s&&t>=a?s-t:0;s-=l,o=s+(o-a),a=s}return{from:s,toA:o,toB:a}}function pie(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:r,focusNode:i,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new WE(t,r)),(i!=t||s!=r)&&e.push(new WE(i,s))),e}function gie(n,e){if(n.length==0)return null;let t=n[0].pos,r=n.length==2?n[1].pos:t;return t>-1&&r>-1?rt.single(t+e,r+e):null}class mie{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,At.safari&&e.contentDOM.addEventListener("input",()=>null),At.gecko&&Mie(e.contentDOM.ownerDocument)}handleEvent(e){!kie(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,t){let r=this.handlers[e];if(r){for(let i of r.observers)i(this.view,t);for(let i of r.handlers){if(t.defaultPrevented)break;if(i(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=vie(e),r=this.handlers,i=this.view.contentDOM;for(let s in t)if(s!="scroll"){let o=!t[s].handlers.length,a=r[s];a&&o!=!a.handlers.length&&(i.removeEventListener(s,this.handleEvent),a=null),a||i.addEventListener(s,this.handleEvent,{passive:o})}for(let s in r)s!="scroll"&&!t[s]&&i.removeEventListener(s,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&r6.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),At.android&&At.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return At.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=n6.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||yie.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,oh(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:At.safari&&!At.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function XE(n,e){return(t,r)=>{try{return e.call(n,r,t)}catch(i){Ds(t.state,i)}}}function vie(n){let e=Object.create(null);function t(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of n){let i=r.spec,s=i&&i.plugin.domEventHandlers,o=i&&i.plugin.domEventObservers;if(s)for(let a in s){let l=s[a];l&&t(a).handlers.push(XE(r.value,l))}if(o)for(let a in o){let l=o[a];l&&t(a).observers.push(XE(r.value,l))}}for(let r in Ho)t(r).handlers.push(Ho[r]);for(let r in wo)t(r).observers.push(wo[r]);return e}const n6=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],yie="dthko",r6=[16,17,18,20,91,92,224,225],nv=6;function rv(n){return Math.max(0,n)*.7+8}function bie(n,e){return Math.max(Math.abs(n.clientX-e.clientX),Math.abs(n.clientY-e.clientY))}class wie{constructor(e,t,r,i){this.view=e,this.startEvent=t,this.style=r,this.mustSelect=i,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=Cre(e.contentDOM),this.atoms=e.state.facet(am).map(o=>o(e));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(un.allowMultipleSelections)&&_ie(e,t),this.dragging=xie(e,t)&&o6(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&bie(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,r=0,i=0,s=0,o=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:i,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:s,bottom:a}=this.scrollParents.y.getBoundingClientRect());let l=c2(this.view);e.clientX-l.left<=i+nv?t=-rv(i-e.clientX):e.clientX+l.right>=o-nv&&(t=rv(e.clientX-o)),e.clientY-l.top<=s+nv?r=-rv(s-e.clientY):e.clientY+l.bottom>=a-nv&&(r=rv(e.clientY-a)),this.setScrollSpeed(t,r)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:t}=this,r=J$(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function _ie(n,e){let t=n.state.facet(L$);return t.length?t[0](e):At.mac?e.metaKey:e.ctrlKey}function Oie(n,e){let t=n.state.facet(Q$);return t.length?t[0](e):At.mac?!e.altKey:!e.ctrlKey}function xie(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let r=og(n.root);if(!r||r.rangeCount==0)return!0;let i=r.getRangeAt(0).getClientRects();for(let s=0;s<i.length;s++){let o=i[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function kie(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,r;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(r=Wn.get(t))&&r.ignoreEvent(e))return!1;return!0}const Ho=Object.create(null),wo=Object.create(null),i6=At.ie&&At.ie_version<15||At.ios&&At.webkit_version<604;function Sie(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),s6(n,t.value)},50)}function Eb(n,e,t){for(let r of n.facet(e))t=r(t,n);return t}function s6(n,e){e=Eb(n.state,o2,e);let{state:t}=n,r,i=1,s=t.toText(e),o=s.lines==t.selection.ranges.length;if(fx!=null&&t.selection.ranges.every(l=>l.empty)&&fx==s.toString()){let l=-1;r=t.changeByRange(c=>{let d=t.doc.lineAt(c.from);if(d.from==l)return{range:c};l=d.from;let h=t.toText((o?s.line(i++).text:e)+t.lineBreak);return{changes:{from:d.from,insert:h},range:rt.cursor(c.from+h.length)}})}else o?r=t.changeByRange(l=>{let c=s.line(i++);return{changes:{from:l.from,to:l.to,insert:c.text},range:rt.cursor(l.from+c.length)}}):r=t.replaceSelection(s);n.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}wo.scroll=n=>{n.inputState.lastScrollTop=n.scrollDOM.scrollTop,n.inputState.lastScrollLeft=n.scrollDOM.scrollLeft};Ho.keydown=(n,e)=>(n.inputState.setSelectionOrigin("select"),e.keyCode==27&&n.inputState.tabFocusMode!=0&&(n.inputState.tabFocusMode=Date.now()+2e3),!1);wo.touchstart=(n,e)=>{n.inputState.lastTouchTime=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};wo.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};Ho.mousedown=(n,e)=>{if(n.observer.flush(),n.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let r of n.state.facet($$))if(t=r(n,e),t)break;if(!t&&e.button==0&&(t=Cie(n,e)),t){let r=!n.hasFocus;n.inputState.startMouseSelection(new wie(n,e,t,r)),r&&n.observer.ignore(()=>{b$(n.contentDOM);let s=n.root.activeElement;s&&!s.contains(n.contentDOM)&&s.blur()});let i=n.inputState.mouseSelection;if(i)return i.start(e),i.dragging===!1}else n.inputState.setSelectionOrigin("select.pointer");return!1};function YE(n,e,t,r){if(r==1)return rt.cursor(e,t);if(r==2)return tie(n.state,e,t);{let i=Ir.find(n.docView,e),s=n.state.doc.lineAt(i?i.posAtEnd:e),o=i?i.posAtStart:s.from,a=i?i.posAtEnd:s.to;return a<n.state.doc.length&&a==s.to&&a++,rt.range(o,a)}}let GE=(n,e,t)=>e>=t.top&&e<=t.bottom&&n>=t.left&&n<=t.right;function Tie(n,e,t,r){let i=Ir.find(n.docView,e);if(!i)return 1;let s=e-i.posAtStart;if(s==0)return 1;if(s==i.length)return-1;let o=i.coordsAt(s,-1);if(o&&GE(t,r,o))return-1;let a=i.coordsAt(s,1);return a&&GE(t,r,a)?1:o&&o.bottom>=r?-1:1}function KE(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:Tie(n,t,e.clientX,e.clientY)}}const Aie=At.ie&&At.ie_version<=11;let JE=null,eP=0,tP=0;function o6(n){if(!Aie)return n.detail;let e=JE,t=tP;return JE=n,tP=Date.now(),eP=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(eP+1)%3:1}function Cie(n,e){let t=KE(n,e),r=o6(e),i=n.state.selection;return{update(s){s.docChanged&&(t.pos=s.changes.mapPos(t.pos),i=i.map(s.changes))},get(s,o,a){let l=KE(n,s),c,d=YE(n,l.pos,l.bias,r);if(t.pos!=l.pos&&!o){let h=YE(n,t.pos,t.bias,r),f=Math.min(h.from,d.from),p=Math.max(h.to,d.to);d=f<d.from?rt.range(f,p):rt.range(p,f)}return o?i.replaceRange(i.main.extend(d.from,d.to)):a&&r==1&&i.ranges.length>1&&(c=Eie(i,l.pos))?c:a?i.addRange(d):rt.create([d])}}}function Eie(n,e){for(let t=0;t<n.ranges.length;t++){let{from:r,to:i}=n.ranges[t];if(r<=e&&i>=e)return rt.create(n.ranges.slice(0,t).concat(n.ranges.slice(t+1)),n.mainIndex==t?0:n.mainIndex-(n.mainIndex>t?1:0))}return null}Ho.dragstart=(n,e)=>{let{selection:{main:t}}=n.state;if(e.target.draggable){let i=n.docView.nearest(e.target);if(i&&i.isWidget){let s=i.posAtStart,o=s+i.length;(s>=t.to||o<=t.from)&&(t=rt.range(s,o))}}let{inputState:r}=n;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",Eb(n.state,a2,n.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Ho.dragend=n=>(n.inputState.draggedContent=null,!1);function nP(n,e,t,r){if(t=Eb(n.state,o2,t),!t)return;let i=n.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:s}=n.inputState,o=r&&s&&Oie(n,e)?{from:s.from,to:s.to}:null,a={from:i,insert:t},l=n.state.changes(o?[o,a]:a);n.focus(),n.dispatch({changes:l,selection:{anchor:l.mapPos(i,-1),head:l.mapPos(i,1)},userEvent:o?"move.drop":"input.drop"}),n.inputState.draggedContent=null}Ho.drop=(n,e)=>{if(!e.dataTransfer)return!1;if(n.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let r=Array(t.length),i=0,s=()=>{++i==t.length&&nP(n,e,r.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let a=new FileReader;a.onerror=s,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(r[o]=a.result),s()},a.readAsText(t[o])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return nP(n,e,r,!0),!0}return!1};Ho.paste=(n,e)=>{if(n.state.readOnly)return!0;n.observer.flush();let t=i6?null:e.clipboardData;return t?(s6(n,t.getData("text/plain")||t.getData("text/uri-list")),!0):(Sie(n),!1)};function Pie(n,e){let t=n.dom.parentNode;if(!t)return;let r=t.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),n.focus()},50)}function Iie(n){let e=[],t=[],r=!1;for(let i of n.selection.ranges)i.empty||(e.push(n.sliceDoc(i.from,i.to)),t.push(i));if(!e.length){let i=-1;for(let{from:s}of n.selection.ranges){let o=n.doc.lineAt(s);o.number>i&&(e.push(o.text),t.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),i=o.number}r=!0}return{text:Eb(n,a2,e.join(n.lineBreak)),ranges:t,linewise:r}}let fx=null;Ho.copy=Ho.cut=(n,e)=>{let{text:t,ranges:r,linewise:i}=Iie(n.state);if(!t&&!i)return!1;fx=i?t:null,e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"});let s=i6?null:e.clipboardData;return s?(s.clearData(),s.setData("text/plain",t),!0):(Pie(n,t),!1)};const a6=Xo.define();function l6(n,e){let t=[];for(let r of n.facet(B$)){let i=r(n,e);i&&t.push(i)}return t.length?n.update({effects:t,annotations:a6.of(!0)}):null}function c6(n){setTimeout(()=>{let e=n.hasFocus;if(e!=n.inputState.notifiedFocused){let t=l6(n.state,e);t?n.dispatch(t):n.update([])}},10)}wo.focus=n=>{n.inputState.lastFocusTime=Date.now(),!n.scrollDOM.scrollTop&&(n.inputState.lastScrollTop||n.inputState.lastScrollLeft)&&(n.scrollDOM.scrollTop=n.inputState.lastScrollTop,n.scrollDOM.scrollLeft=n.inputState.lastScrollLeft),c6(n)};wo.blur=n=>{n.observer.clearSelectionRange(),c6(n)};wo.compositionstart=wo.compositionupdate=n=>{n.observer.editContext||(n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0))};wo.compositionend=n=>{n.observer.editContext||(n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionPendingKey=!0,n.inputState.compositionPendingChange=n.observer.pendingRecords().length>0,n.inputState.compositionFirstChange=null,At.chrome&&At.android?n.observer.flushSoon():n.inputState.compositionPendingChange?Promise.resolve().then(()=>n.observer.flush()):setTimeout(()=>{n.inputState.composing<0&&n.docView.hasComposition&&n.update([])},50))};wo.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};Ho.beforeinput=(n,e)=>{var t,r;if((e.inputType=="insertText"||e.inputType=="insertCompositionText")&&(n.inputState.insertingText=e.data,n.inputState.insertingTextAt=Date.now()),e.inputType=="insertReplacementText"&&n.observer.editContext){let s=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),o=e.getTargetRanges();if(s&&o.length){let a=o[0],l=n.posAtDOM(a.startContainer,a.startOffset),c=n.posAtDOM(a.endContainer,a.endOffset);return u2(n,{from:l,to:c,insert:n.state.toText(s)},null),!0}}let i;if(At.chrome&&At.android&&(i=n6.find(s=>s.inputType==e.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let s=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>s+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}return At.ios&&e.inputType=="deleteContentForward"&&n.observer.flushSoon(),At.safari&&e.inputType=="insertText"&&n.inputState.composing>=0&&setTimeout(()=>wo.compositionend(n,e),20),!1};const rP=new Set;function Mie(n){rP.has(n)||(rP.add(n),n.addEventListener("copy",()=>{}),n.addEventListener("cut",()=>{}))}const iP=["pre-wrap","normal","pre-line","break-spaces"];let Dh=!1;function sP(){Dh=!1}class Rie{constructor(e){this.lineWrapping=e,this.doc=In.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let r=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((t-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return iP.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let r=0;r<e.length;r++){let i=e[r];i<0?r++:this.heightSamples[Math.floor(i*10)]||(t=!0,this.heightSamples[Math.floor(i*10)]=!0)}return t}refresh(e,t,r,i,s,o){let a=iP.indexOf(e)>-1,l=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=t,this.charWidth=r,this.textHeight=i,this.lineLength=s,l){this.heightSamples={};for(let c=0;c<o.length;c++){let d=o[c];d<0?c++:this.heightSamples[Math.floor(d*10)]=!0}}return l}}class Die{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class ka{constructor(e,t,r,i,s){this.from=e,this.length=t,this.top=r,this.height=i,this._content=s}get type(){return typeof this._content=="number"?Ls.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Oc?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new ka(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var ir=(function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n})(ir||(ir={}));const Zv=.001;class Vi{constructor(e,t,r=2){this.length=e,this.height=t,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Zv&&(Dh=!0),this.height=e)}replace(e,t,r){return Vi.of(r)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,r,i){let s=this,o=r.doc;for(let a=i.length-1;a>=0;a--){let{fromA:l,toA:c,fromB:d,toB:h}=i[a],f=s.lineAt(l,ir.ByPosNoHeight,r.setDoc(t),0,0),p=f.to>=c?f:s.lineAt(c,ir.ByPosNoHeight,r,0,0);for(h+=p.to-c,c=p.to;a>0&&f.from<=i[a-1].toA;)l=i[a-1].fromA,d=i[a-1].fromB,a--,l<f.from&&(f=s.lineAt(l,ir.ByPosNoHeight,r,0,0));d+=f.from-l,l=f.from;let g=d2.build(r.setDoc(o),e,d,h);s=Vy(s,s.replace(l,c,g))}return s.updateHeight(r,0)}static empty(){return new ks(0,0)}static of(e){if(e.length==1)return e[0];let t=0,r=e.length,i=0,s=0;for(;;)if(t==r)if(i>s*2){let a=e[t-1];a.break?e.splice(--t,1,a.left,null,a.right):e.splice(--t,1,a.left,a.right),r+=1+a.break,i-=a.size}else if(s>i*2){let a=e[r];a.break?e.splice(r,1,a.left,null,a.right):e.splice(r,1,a.left,a.right),r+=2+a.break,s-=a.size}else break;else if(i<s){let a=e[t++];a&&(i+=a.size)}else{let a=e[--r];a&&(s+=a.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,r++),new Nie(Vi.of(e.slice(0,t)),o,Vi.of(e.slice(r)))}}function Vy(n,e){return n==e?n:(n.constructor!=e.constructor&&(Dh=!0),e)}Vi.prototype.size=1;class u6 extends Vi{constructor(e,t,r){super(e,t),this.deco=r}blockAt(e,t,r,i){return new ka(i,this.length,r,this.height,this.deco||0)}lineAt(e,t,r,i,s){return this.blockAt(0,r,i,s)}forEachLine(e,t,r,i,s,o){e<=s+this.length&&t>=s&&o(this.blockAt(0,r,i,s))}updateHeight(e,t=0,r=!1,i){return i&&i.from<=t&&i.more&&this.setHeight(i.heights[i.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class ks extends u6{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,r,i){return new ka(i,this.length,r,this.height,this.breaks)}replace(e,t,r){let i=r[0];return r.length==1&&(i instanceof ks||i instanceof si&&i.flags&4)&&Math.abs(this.length-i.length)<10?(i instanceof si?i=new ks(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):Vi.of(r)}updateHeight(e,t=0,r=!1,i){return i&&i.from<=t&&i.more?this.setHeight(i.heights[i.index++]):(r||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class si extends Vi{constructor(e){super(e,0)}heightMetrics(e,t){let r=e.doc.lineAt(t).number,i=e.doc.lineAt(t+this.length).number,s=i-r+1,o,a=0;if(e.lineWrapping){let l=Math.min(this.height,e.lineHeight*s);o=l/s,this.length>s+1&&(a=(this.height-l)/(this.length-s-1))}else o=this.height/s;return{firstLine:r,lastLine:i,perLine:o,perChar:a}}blockAt(e,t,r,i){let{firstLine:s,lastLine:o,perLine:a,perChar:l}=this.heightMetrics(t,i);if(t.lineWrapping){let c=i+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length)),d=t.doc.lineAt(c),h=a+d.length*l,f=Math.max(r,e-h/2);return new ka(d.from,d.length,f,h,0)}else{let c=Math.max(0,Math.min(o-s,Math.floor((e-r)/a))),{from:d,length:h}=t.doc.line(s+c);return new ka(d,h,r+a*c,a,0)}}lineAt(e,t,r,i,s){if(t==ir.ByHeight)return this.blockAt(e,r,i,s);if(t==ir.ByPosNoHeight){let{from:p,to:g}=r.doc.lineAt(e);return new ka(p,g-p,0,0,0)}let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(r,s),c=r.doc.lineAt(e),d=a+c.length*l,h=c.number-o,f=i+a*h+l*(c.from-s-h);return new ka(c.from,c.length,Math.max(i,Math.min(f,i+this.height-d)),d,0)}forEachLine(e,t,r,i,s,o){e=Math.max(e,s),t=Math.min(t,s+this.length);let{firstLine:a,perLine:l,perChar:c}=this.heightMetrics(r,s);for(let d=e,h=i;d<=t;){let f=r.doc.lineAt(d);if(d==e){let g=f.number-a;h+=l*g+c*(e-s-g)}let p=l+c*f.length;o(new ka(f.from,f.length,h,p,0)),h+=p,d=f.to+1}}replace(e,t,r){let i=this.length-t;if(i>0){let s=r[r.length-1];s instanceof si?r[r.length-1]=new si(s.length+i):r.push(null,new si(i-1))}if(e>0){let s=r[0];s instanceof si?r[0]=new si(e+s.length):r.unshift(new si(e-1),null)}return Vi.of(r)}decomposeLeft(e,t){t.push(new si(e-1),null)}decomposeRight(e,t){t.push(null,new si(this.length-e-1))}updateHeight(e,t=0,r=!1,i){let s=t+this.length;if(i&&i.from<=t+this.length&&i.more){let o=[],a=Math.max(t,i.from),l=-1;for(i.from>t&&o.push(new si(i.from-t-1).updateHeight(e,t));a<=s&&i.more;){let d=e.doc.lineAt(a).length;o.length&&o.push(null);let h=i.heights[i.index++];l==-1?l=h:Math.abs(h-l)>=Zv&&(l=-2);let f=new ks(d,h);f.outdated=!1,o.push(f),a+=d+1}a<=s&&o.push(null,new si(s-a).updateHeight(e,a));let c=Vi.of(o);return(l<0||Math.abs(c.height-this.height)>=Zv||Math.abs(l-this.heightMetrics(e,t).perLine)>=Zv)&&(Dh=!0),Vy(this,c)}else(r||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class Nie extends Vi{constructor(e,t,r){super(e.length+t+r.length,e.height+r.height,t|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,t,r,i){let s=r+this.left.height;return e<s?this.left.blockAt(e,t,r,i):this.right.blockAt(e,t,s,i+this.left.length+this.break)}lineAt(e,t,r,i,s){let o=i+this.left.height,a=s+this.left.length+this.break,l=t==ir.ByHeight?e<o:e<a,c=l?this.left.lineAt(e,t,r,i,s):this.right.lineAt(e,t,r,o,a);if(this.break||(l?c.to<a:c.from>a))return c;let d=t==ir.ByPosNoHeight?ir.ByPosNoHeight:ir.ByPos;return l?c.join(this.right.lineAt(a,d,r,o,a)):this.left.lineAt(a,d,r,i,s).join(c)}forEachLine(e,t,r,i,s,o){let a=i+this.left.height,l=s+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,t,r,i,s,o),t>=l&&this.right.forEachLine(e,t,r,a,l,o);else{let c=this.lineAt(l,ir.ByPos,r,i,s);e<c.from&&this.left.forEachLine(e,c.from-1,r,i,s,o),c.to>=e&&c.from<=t&&o(c),t>c.to&&this.right.forEachLine(c.to+1,t,r,a,l,o)}}replace(e,t,r){let i=this.left.length+this.break;if(t<i)return this.balanced(this.left.replace(e,t,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-i,t-i,r));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let a of r)s.push(a);if(e>0&&oP(s,o-1),t<this.length){let a=s.length;this.decomposeRight(t,s),oP(s,a)}return Vi.of(s)}decomposeLeft(e,t){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(r++,e>=r&&t.push(null)),e>r&&this.right.decomposeLeft(e-r,t)}decomposeRight(e,t){let r=this.left.length,i=r+this.break;if(e>=i)return this.right.decomposeRight(e-i,t);e<r&&this.left.decomposeRight(e,t),this.break&&e<i&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Vi.of(this.break?[e,null,t]:[e,t]):(this.left=Vy(this.left,e),this.right=Vy(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,r=!1,i){let{left:s,right:o}=this,a=t+s.length+this.break,l=null;return i&&i.from<=t+s.length&&i.more?l=s=s.updateHeight(e,t,r,i):s.updateHeight(e,t,r),i&&i.from<=a+o.length&&i.more?l=o=o.updateHeight(e,a,r,i):o.updateHeight(e,a,r),l?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function oP(n,e){let t,r;n[e]==null&&(t=n[e-1])instanceof si&&(r=n[e+1])instanceof si&&n.splice(e-1,3,new si(t.length+1+r.length))}const Lie=5;class d2{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let r=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof ks?i.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new ks(r-this.pos,-1)),this.writtenTo=r,t>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,r){if(e<t||r.heightRelevant){let i=r.widget?r.widget.estimatedHeight:0,s=r.widget?r.widget.lineBreaks:0;i<0&&(i=this.oracle.lineHeight);let o=t-e;r.block?this.addBlock(new u6(o,i,r)):(o||s||i>=Lie)&&this.addLineDeco(i,s,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new ks(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let r=new si(t-e);return this.oracle.doc.lineAt(e).to==t&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof ks)return e;let t=new ks(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,r){let i=this.ensureLine();i.length+=r,i.collapsed+=r,i.widgetHeight=Math.max(i.widgetHeight,e),i.breaks+=t,this.writtenTo=this.pos=this.pos+r}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof ks)&&!this.isCovered?this.nodes.push(new ks(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let i of this.nodes)i instanceof ks&&i.updateHeight(this.oracle,r),r+=i?i.length:1;return this.nodes}static build(e,t,r,i){let s=new d2(r,e);return $n.spans(t,r,i,s,0),s.finish(r)}}function Qie(n,e,t){let r=new $ie;return $n.compare(n,e,t,r,0),r.changes}class $ie{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,r,i){(e<t||r&&r.heightRelevant||i&&i.heightRelevant)&&Hv(e,t,this.changes,5)}}function Fie(n,e){let t=n.getBoundingClientRect(),r=n.ownerDocument,i=r.defaultView||window,s=Math.max(0,t.left),o=Math.min(i.innerWidth,t.right),a=Math.max(0,t.top),l=Math.min(i.innerHeight,t.bottom);for(let c=n.parentNode;c&&c!=r.body;)if(c.nodeType==1){let d=c,h=window.getComputedStyle(d);if((d.scrollHeight>d.clientHeight||d.scrollWidth>d.clientWidth)&&h.overflow!="visible"){let f=d.getBoundingClientRect();s=Math.max(s,f.left),o=Math.min(o,f.right),a=Math.max(a,f.top),l=Math.min(c==n.parentNode?i.innerHeight:l,f.bottom)}c=h.position=="absolute"||h.position=="fixed"?d.offsetParent:d.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:s-t.left,right:Math.max(s,o)-t.left,top:a-(t.top+e),bottom:Math.max(a,l)-(t.top+e)}}function zie(n){let e=n.getBoundingClientRect(),t=n.ownerDocument.defaultView||window;return e.left<t.innerWidth&&e.right>0&&e.top<t.innerHeight&&e.bottom>0}function Bie(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class r1{constructor(e,t,r,i){this.from=e,this.to=t,this.size=r,this.displaySize=i}static same(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=t[r];if(i.from!=s.from||i.to!=s.to||i.size!=s.size)return!1}return!0}draw(e,t){return hn.replace({widget:new Uie(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class Uie extends Yo{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class aP{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=lP,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=pr.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(l2).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new Rie(t),this.stateDeco=e.facet(ag).filter(r=>typeof r!="function"),this.heightMap=Vi.empty().applyChanges(this.stateDeco,In.empty,this.heightOracle.setDoc(e.doc),[new vo(0,0,0,e.doc.length)]);for(let r=0;r<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());r++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=hn.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let r=0;r<=1;r++){let i=r?t.head:t.anchor;if(!e.some(({from:s,to:o})=>i>=s&&i<=o)){let{from:s,to:o}=this.lineBlockAt(i);e.push(new iv(s,o))}}return this.viewports=e.sort((r,i)=>r.from-i.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?lP:new h2(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(sp(e,this.scaler))})}update(e,t=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=this.state.facet(ag).filter(d=>typeof d!="function");let i=e.changedRanges,s=vo.extendWithRanges(i,Qie(r,this.stateDeco,e?e.changes:Mr.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);sP(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=o||Dh)&&(e.flags|=2),a?(this.scrollAnchorPos=e.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=o);let l=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<l.from||t.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,t));let c=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(j$)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,r=window.getComputedStyle(t),i=this.heightOracle,s=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?pr.RTL:pr.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),a=t.getBoundingClientRect(),l=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let c=0,d=0;if(a.width&&a.height){let{scaleX:x,scaleY:k}=y$(t,a);(x>.005&&Math.abs(this.scaleX-x)>.005||k>.005&&Math.abs(this.scaleY-k)>.005)&&(this.scaleX=x,this.scaleY=k,c|=16,o=l=!0)}let h=(parseInt(r.paddingTop)||0)*this.scaleY,f=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=h||this.paddingBottom!=f)&&(this.paddingTop=h,this.paddingBottom=f,c|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(i.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=16);let p=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=p&&(this.scrollAnchorHeight=-1,this.scrollTop=p),this.scrolledToBottom=_$(e.scrollDOM);let g=(this.printing?Bie:Fie)(t,this.paddingTop),m=g.top-this.pixelViewport.top,v=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let y=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(y!=this.inView&&(this.inView=y,y&&(l=!0)),!this.inView&&!this.scrollTarget&&!zie(e.dom))return 0;let O=a.width;if((this.contentDOMWidth!=O||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=e.scrollDOM.clientHeight,c|=16),l){let x=e.docView.measureVisibleLineHeights(this.viewport);if(i.mustRefreshForHeights(x)&&(o=!0),o||i.lineWrapping&&Math.abs(O-this.contentDOMWidth)>i.charWidth){let{lineHeight:k,charWidth:S,textHeight:E}=e.docView.measureTextSize();o=k>0&&i.refresh(s,k,S,E,Math.max(5,O/S),x),o&&(e.docView.minWidth=0,c|=16)}m>0&&v>0?d=Math.max(m,v):m<0&&v<0&&(d=Math.min(m,v)),sP();for(let k of this.viewports){let S=k.from==this.viewport.from?x:e.docView.measureVisibleLineHeights(k);this.heightMap=(o?Vi.empty().applyChanges(this.stateDeco,In.empty,this.heightOracle,[new vo(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(i,0,o,new Die(k.from,S))}Dh&&(c|=2)}let _=!this.viewportIsAppropriate(this.viewport,d)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return _&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(d,this.scrollTarget),c|=this.updateForViewport()),(c&2||_)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),i=this.heightMap,s=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,l=new iv(i.lineAt(o-r*1e3,ir.ByHeight,s,0,0).from,i.lineAt(a+(1-r)*1e3,ir.ByHeight,s,0,0).to);if(t){let{head:c}=t.range;if(c<l.from||c>l.to){let d=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),h=i.lineAt(c,ir.ByPos,s,0,0),f;t.y=="center"?f=(h.top+h.bottom)/2-d/2:t.y=="start"||t.y=="nearest"&&c<l.from?f=h.top:f=h.bottom-d,l=new iv(i.lineAt(f-1e3/2,ir.ByHeight,s,0,0).from,i.lineAt(f+d+1e3/2,ir.ByHeight,s,0,0).to)}}return l}mapViewport(e,t){let r=t.mapPos(e.from,-1),i=t.mapPos(e.to,1);return new iv(this.heightMap.lineAt(r,ir.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(i,ir.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},r=0){if(!this.inView)return!0;let{top:i}=this.heightMap.lineAt(e,ir.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(t,ir.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(e==0||i<=o-Math.max(10,Math.min(-r,250)))&&(t==this.state.doc.length||s>=a+Math.max(10,Math.min(r,250)))&&i>o-2*1e3&&s<a+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let r=[];for(let i of e)t.touchesRange(i.from,i.to)||r.push(new r1(t.mapPos(i.from),t.mapPos(i.to),i.size,i.displaySize));return r}ensureLineGaps(e,t){let r=this.heightOracle.lineWrapping,i=r?1e4:2e3,s=i>>1,o=i<<1;if(this.defaultTextDirection!=pr.LTR&&!r)return[];let a=[],l=(d,h,f,p)=>{if(h-d<s)return;let g=this.state.selection.main,m=[g.from];g.empty||m.push(g.to);for(let y of m)if(y>d&&y<h){l(d,y-10,f,p),l(y+10,h,f,p);return}let v=Vie(e,y=>y.from>=f.from&&y.to<=f.to&&Math.abs(y.from-d)<s&&Math.abs(y.to-h)<s&&!m.some(O=>y.from<O&&y.to>O));if(!v){if(h<f.to&&t&&r&&t.visibleRanges.some(_=>_.from<=h&&_.to>=h)){let _=t.moveToLineBoundary(rt.cursor(h),!1,!0).head;_>d&&(h=_)}let y=this.gapSize(f,d,h,p),O=r||y<2e6?y:2e6;v=new r1(d,h,y,O)}a.push(v)},c=d=>{if(d.length<o||d.type!=Ls.Text)return;let h=jie(d.from,d.to,this.stateDeco);if(h.total<o)return;let f=this.scrollTarget?this.scrollTarget.range.head:null,p,g;if(r){let m=i/this.heightOracle.lineLength*this.heightOracle.lineHeight,v,y;if(f!=null){let O=ov(h,f),_=((this.visibleBottom-this.visibleTop)/2+m)/d.height;v=O-_,y=O+_}else v=(this.visibleTop-d.top-m)/d.height,y=(this.visibleBottom-d.top+m)/d.height;p=sv(h,v),g=sv(h,y)}else{let m=h.total*this.heightOracle.charWidth,v=i*this.heightOracle.charWidth,y=0;if(m>2e6)for(let S of e)S.from>=d.from&&S.from<d.to&&S.size!=S.displaySize&&S.from*this.heightOracle.charWidth+y<this.pixelViewport.left&&(y=S.size-S.displaySize);let O=this.pixelViewport.left+y,_=this.pixelViewport.right+y,x,k;if(f!=null){let S=ov(h,f),E=((_-O)/2+v)/m;x=S-E,k=S+E}else x=(O-v)/m,k=(_+v)/m;p=sv(h,x),g=sv(h,k)}p>d.from&&l(d.from,p,d,h),g<d.to&&l(g,d.to,d,h)};for(let d of this.viewportLines)Array.isArray(d.type)?d.type.forEach(c):c(d);return a}gapSize(e,t,r,i){let s=ov(i,r)-ov(i,t);return this.heightOracle.lineWrapping?e.height*s:i.total*this.heightOracle.charWidth*s}updateLineGaps(e){r1.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=hn.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let r=[];$n.spans(t,this.viewport.from,this.viewport.to,{span(s,o){r.push({from:s,to:o})},point(){}},20);let i=0;if(r.length!=this.visibleRanges.length)i=12;else for(let s=0;s<r.length&&!(i&8);s++){let o=this.visibleRanges[s],a=r[s];(o.from!=a.from||o.to!=a.to)&&(i|=4,e&&e.mapPos(o.from,-1)==a.from&&e.mapPos(o.to,1)==a.to||(i|=8))}return this.visibleRanges=r,i}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||sp(this.heightMap.lineAt(e,ir.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||sp(this.heightMap.lineAt(this.scaler.fromDOM(e),ir.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return sp(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class iv{constructor(e,t){this.from=e,this.to=t}}function jie(n,e,t){let r=[],i=n,s=0;return $n.spans(t,n,e,{span(){},point(o,a){o>i&&(r.push({from:i,to:o}),s+=o-i),i=a}},20),i<e&&(r.push({from:i,to:e}),s+=e-i),{total:s,ranges:r}}function sv({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let r=Math.floor(n*t);for(let i=0;;i++){let{from:s,to:o}=e[i],a=o-s;if(r<=a)return s+r;r-=a}}function ov(n,e){let t=0;for(let{from:r,to:i}of n.ranges){if(e<=i){t+=e-r;break}t+=i-r}return t/n.total}function Vie(n,e){for(let t of n)if(e(t))return t}const lP={toDOM(n){return n},fromDOM(n){return n},scale:1,eq(n){return n==this}};class h2{constructor(e,t,r){let i=0,s=0,o=0;this.viewports=r.map(({from:a,to:l})=>{let c=t.lineAt(a,ir.ByPos,e,0,0).top,d=t.lineAt(l,ir.ByPos,e,0,0).bottom;return i+=d-c,{from:a,to:l,top:c,bottom:d,domTop:0,domBottom:0}}),this.scale=(7e6-i)/(t.height-i);for(let a of this.viewports)a.domTop=o+(a.top-s)*this.scale,o=a.domBottom=a.domTop+(a.bottom-a.top),s=a.bottom}toDOM(e){for(let t=0,r=0,i=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return i+(e-r)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);r=s.bottom,i=s.domBottom}}fromDOM(e){for(let t=0,r=0,i=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return r+(e-i)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);r=s.bottom,i=s.domBottom}}eq(e){return e instanceof h2?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,r)=>t.from==e.viewports[r].from&&t.to==e.viewports[r].to):!1}}function sp(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),r=e.toDOM(n.bottom);return new ka(n.from,n.length,t,r-t,Array.isArray(n._content)?n._content.map(i=>sp(i,e)):n._content)}const av=Ut.define({combine:n=>n.join(" ")}),px=Ut.define({combine:n=>n.indexOf(!0)>-1}),gx=wc.newName(),d6=wc.newName(),h6=wc.newName(),f6={"&light":"."+d6,"&dark":"."+h6};function mx(n,e,t){return new wc(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,i=>{if(i=="&")return n;if(!t||!t[i])throw new RangeError(`Unsupported selector: ${i}`);return t[i]}):n+" "+r}})}const qie=mx("."+gx,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},f6),Hie={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},i1=At.ie&&At.ie_version<=11;class Zie{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new Ere,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let r of t)this.queue.push(r);(At.ie&&At.ie_version<=11||At.ios&&e.composing)&&t.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&At.android&&e.constructor.EDIT_CONTEXT!==!1&&!(At.chrome&&At.chrome_version<126)&&(this.editContext=new Xie(e),e.state.facet(hl)&&(e.contentDOM.editContext=this.editContext.editContext)),i1&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,r)=>t!=e[r]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,i=this.selectionRange;if(r.state.facet(hl)?r.root.activeElement!=this.dom:!qv(this.dom,i))return;let s=i.anchorNode&&r.docView.nearest(i.anchorNode);if(s&&s.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(At.ie&&At.ie_version<=11||At.android&&At.chrome)&&!r.state.selection.main.empty&&i.focusNode&&_p(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=og(e.root);if(!t)return!1;let r=At.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&Wie(this.view,t)||t;if(!r||this.selectionRange.eq(r))return!1;let i=qv(this.dom,r);return i&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&Ire(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),i&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let r=this.dom;r;)if(r.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=t)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Hie),i1&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),i1&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var r;if(!this.delayedAndroidKey){let i=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&oh(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(i)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,r=-1,i=!1;for(let s of e){let o=this.readMutation(s);o&&(o.typeOver&&(i=!0),t==-1?{from:t,to:r}=o:(t=Math.min(o.from,t),r=Math.max(o.to,r)))}return{from:t,to:r,typeOver:i}}readChange(){let{from:e,to:t,typeOver:r}=this.processRecords(),i=this.selectionChanged&&qv(this.dom,this.selectionRange);if(e<0&&!i)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new hie(this.view,e,t,r);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let r=this.view.state,i=e6(this.view,t);return this.view.state==r&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),i}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let r=cP(t,e.previousSibling||e.target.previousSibling,-1),i=cP(t,e.nextSibling||e.target.nextSibling,1);return{from:r?t.posAfter(r):t.posAtStart,to:i?t.posBefore(i):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(hl)!=e.state.facet(hl)&&(e.view.contentDOM.editContext=e.state.facet(hl)?this.editContext.editContext:null))}destroy(){var e,t,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect();for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function cP(n,e,t){for(;e;){let r=Wn.get(e);if(r&&r.parent==n)return r;let i=e.parentNode;e=i!=n.dom?i:t>0?e.nextSibling:e.previousSibling}return null}function uP(n,e){let t=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=n.docView.domAtPos(n.state.selection.main.anchor);return _p(o.node,o.offset,i,s)&&([t,r,i,s]=[i,s,t,r]),{anchorNode:t,anchorOffset:r,focusNode:i,focusOffset:s}}function Wie(n,e){if(e.getComposedRanges){let i=e.getComposedRanges(n.root)[0];if(i)return uP(n,i)}let t=null;function r(i){i.preventDefault(),i.stopImmediatePropagation(),t=i.getTargetRanges()[0]}return n.contentDOM.addEventListener("beforeinput",r,!0),n.dom.ownerDocument.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",r,!0),t?uP(n,t):null}class Xie{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=r=>{let i=e.state.selection.main,{anchor:s,head:o}=i,a=this.toEditorPos(r.updateRangeStart),l=this.toEditorPos(r.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:r.updateRangeStart,editorBase:a,drifted:!1});let c=l-a>r.text.length;a==this.from&&s<this.from?a=s:l==this.to&&s>this.to&&(l=s);let d=t6(e.state.sliceDoc(a,l),r.text,(c?i.from:i.to)-a,c?"end":null);if(!d){let f=rt.single(this.toEditorPos(r.selectionStart),this.toEditorPos(r.selectionEnd));f.main.eq(i)||e.dispatch({selection:f,userEvent:"select"});return}let h={from:d.from+a,to:d.toA+a,insert:In.of(r.text.slice(d.from,d.toB).split(`
`))};if((At.mac||At.android)&&h.from==o-1&&/^\. ?$/.test(r.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(h={from:a,to:l,insert:In.of([r.text.replace("."," ")])}),this.pendingContextChange=h,!e.state.readOnly){let f=this.to-this.from+(h.to-h.from+h.insert.length);u2(e,h,rt.single(this.toEditorPos(r.selectionStart,f),this.toEditorPos(r.selectionEnd,f)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),h.from<h.to&&!h.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(t.text.slice(Math.max(0,r.updateRangeStart-1),Math.min(t.text.length,r.updateRangeStart+1)))&&this.handlers.compositionend(r)},this.handlers.characterboundsupdate=r=>{let i=[],s=null;for(let o=this.toEditorPos(r.rangeStart),a=this.toEditorPos(r.rangeEnd);o<a;o++){let l=e.coordsForChar(o);s=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||s||new DOMRect,i.push(s)}t.updateCharacterBounds(r.rangeStart,i)},this.handlers.textformatupdate=r=>{let i=[];for(let s of r.getTextFormats()){let o=s.underlineStyle,a=s.underlineThickness;if(!/none/i.test(o)&&!/none/i.test(a)){let l=this.toEditorPos(s.rangeStart),c=this.toEditorPos(s.rangeEnd);if(l<c){let d=`text-decoration: underline ${/^[a-z]/.test(o)?o+" ":o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${/thin/i.test(a)?1:2}px`;i.push(hn.mark({attributes:{style:d}}).range(l,c))}}}e.dispatch({effects:q$.of(hn.set(i))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:r}=this.composing;this.composing=null,r&&this.reset(e.state)}};for(let r in this.handlers)t.addEventListener(r,this.handlers[r]);this.measureReq={read:r=>{this.editContext.updateControlBounds(r.contentDOM.getBoundingClientRect());let i=og(r.root);i&&i.rangeCount&&this.editContext.updateSelectionBounds(i.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,r=!1,i=this.pendingContextChange;return e.changes.iterChanges((s,o,a,l,c)=>{if(r)return;let d=c.length-(o-s);if(i&&o>=i.to)if(i.from==s&&i.to==o&&i.insert.eq(c)){i=this.pendingContextChange=null,t+=d,this.to+=d;return}else i=null,this.revertPending(e.state);if(s+=t,o+=t,o<=this.from)this.from+=d,this.to+=d;else if(s<this.to){if(s<this.from||o>this.to||this.to-this.from+c.length>3e4){r=!0;return}this.editContext.updateText(this.toContextPos(s),this.toContextPos(o),c.toString()),this.to+=d}t+=d}),i&&!r&&this.revertPending(e.state),!r}update(e){let t=this.pendingContextChange,r=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(r.from,r.to)&&e.transactions.some(i=>!i.isUserEvent("input.type")&&i.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,r=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),i=this.toContextPos(t.head);(this.editContext.selectionStart!=r||this.editContext.selectionEnd!=i)&&this.editContext.updateSelection(r,i)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let r=this.composing;return r&&r.drifted?r.editorBase+(e-r.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class gt{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:r}=e;this.dispatchTransactions=e.dispatchTransactions||r&&(i=>i.forEach(s=>r(s,this)))||(i=>this.update(i)),this.dispatch=this.dispatch.bind(this),this._root=e.root||Pre(e.parent)||document,this.viewState=new aP(e.state||un.create(e)),e.scrollTo&&e.scrollTo.is(tv)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(jd).map(i=>new e1(i));for(let i of this.plugins)i.update(this);this.observer=new Zie(this),this.inputState=new mie(this),this.inputState.ensureHandlers(this.plugins),this.docView=new UE(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=e.length==1&&e[0]instanceof Nr?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,r=!1,i,s=this.state;for(let f of e){if(f.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=f.state}if(this.destroyed){this.viewState.state=s;return}let o=this.hasFocus,a=0,l=null;e.some(f=>f.annotation(a6))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,l=l6(s,o),l||(a=1));let c=this.observer.delayedAndroidKey,d=null;if(c?(this.observer.clearDelayedAndroidKey(),d=this.observer.readChange(),(d&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(d=null)):this.observer.clear(),s.facet(un.phrases)!=this.state.facet(un.phrases))return this.setState(s);i=jy.create(this,s,e),i.flags|=a;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let f of e){if(h&&(h=h.map(f.changes)),f.scrollIntoView){let{main:p}=f.state.selection;h=new ah(p.empty?p:rt.cursor(p.head,p.head>p.anchor?-1:1))}for(let p of f.effects)p.is(tv)&&(h=p.value.clip(this.state))}this.viewState.update(i,h),this.bidiCache=qy.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),t=this.docView.update(i),this.state.facet(rp)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(f=>f.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(av)!=i.state.facet(av)&&(this.viewState.mustMeasureContent=!0),(t||r||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!i.empty)for(let f of this.state.facet(ux))try{f(i)}catch(p){Ds(this.state,p,"update listener")}(l||d)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),d&&!e6(this,d)&&c.force&&oh(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new aP(e),this.plugins=e.facet(jd).map(r=>new e1(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView.destroy(),this.docView=new UE(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(jd),r=e.state.facet(jd);if(t!=r){let i=[];for(let s of r){let o=t.indexOf(s);if(o<0)i.push(new e1(s));else{let a=this.plugins[o];a.mustUpdate=e,i.push(a)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=i,this.pluginMap.clear()}else for(let i of this.plugins)i.mustUpdate=e;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this);t!=r&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(r){Ds(this.state,r,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,r=this.scrollDOM,i=r.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:o}=this.viewState;Math.abs(i-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(o<0)if(_$(r))s=-1,o=this.viewState.heightMap.height;else{let p=this.viewState.scrollAnchorAt(i);s=p.from,o=p.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];l&4||([this.measureRequests,c]=[c,this.measureRequests]);let d=c.map(p=>{try{return p.read(this)}catch(g){return Ds(this.state,g),dP}}),h=jy.create(this,this.state,[]),f=!1;h.flags|=l,t?t.flags|=l:t=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),f=this.docView.update(h),f&&this.docViewUpdate());for(let p=0;p<c.length;p++)if(d[p]!=dP)try{let g=c[p];g.write&&g.write(d[p],this)}catch(g){Ds(this.state,g)}if(f&&this.docView.updateSelection(!0),!h.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let g=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-o;if(g>1||g<-1){i=i+g,r.scrollTop=i/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let a of this.state.facet(ux))a(t)}get themeClasses(){return gx+" "+(this.state.facet(px)?h6:d6)+" "+this.state.facet(av)}updateAttrs(){let e=hP(this,H$,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(hl)?"true":"false",class:"cm-content",style:`${At.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),hP(this,l2,t);let r=this.observer.ignore(()=>{let i=sx(this.contentDOM,this.contentAttrs,t),s=sx(this.dom,this.editorAttrs,e);return i||s});return this.editorAttrs=e,this.contentAttrs=t,r}showAnnouncements(e){let t=!0;for(let r of e)for(let i of r.effects)if(i.is(gt.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=i.value}}mountStyles(){this.styleModules=this.state.facet(rp);let e=this.state.facet(gt.cspNonce);wc.mount(this.root,this.styleModules.concat(qie).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(r=>r.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,r){return n1(this,e,ZE(this,e,t,r))}moveByGroup(e,t){return n1(this,e,ZE(this,e,t,r=>aie(this,e.head,r)))}visualLineSide(e,t){let r=this.bidiSpans(e),i=this.textDirectionAt(e.from),s=r[t?r.length-1:0];return rt.cursor(s.side(t,i)+e.from,s.forward(!t,i)?1:-1)}moveToLineBoundary(e,t,r=!0){return oie(this,e,t,r)}moveVertically(e,t,r){return n1(this,e,lie(this,e,t,r))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),G$(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let r=this.docView.coordsAt(e,t);if(!r||r.left==r.right)return r;let i=this.state.doc.lineAt(e),s=this.bidiSpans(i),o=s[ec.find(s,e-i.from,-1,t)];return im(r,o.dir==pr.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(U$)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>Yie)return D$(e.length);let t=this.textDirectionAt(e.from),r;for(let s of this.bidiCache)if(s.from==e.from&&s.dir==t&&(s.fresh||R$(s.isolates,r=BE(this,e))))return s.order;r||(r=BE(this,e));let i=Vre(e.text,t,r);return this.bidiCache.push(new qy(e.from,e.to,t,r,!0,i)),i}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||At.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{b$(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return tv.of(new ah(typeof e=="number"?rt.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,r=this.viewState.scrollAnchorAt(e);return tv.of(new ah(rt.cursor(r.from),"start","start",r.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return Kr.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return Kr.define(()=>({}),{eventObservers:e})}static theme(e,t){let r=wc.newName(),i=[av.of(r),rp.of(mx(`.${r}`,e))];return t&&t.dark&&i.push(px.of(!0)),i}static baseTheme(e){return Wo.lowest(rp.of(mx("."+gx,e,f6)))}static findFromDOM(e){var t;let r=e.querySelector(".cm-content"),i=r&&Wn.get(r)||Wn.get(e);return((t=i?.rootView)===null||t===void 0?void 0:t.view)||null}}gt.styleModule=rp;gt.inputHandler=z$;gt.clipboardInputFilter=o2;gt.clipboardOutputFilter=a2;gt.scrollHandler=V$;gt.focusChangeEffect=B$;gt.perLineTextDirection=U$;gt.exceptionSink=F$;gt.updateListener=ux;gt.editable=hl;gt.mouseSelectionStyle=$$;gt.dragMovesSelection=Q$;gt.clickAddsSelectionRange=L$;gt.decorations=ag;gt.outerDecorations=Z$;gt.atomicRanges=am;gt.bidiIsolatedRanges=W$;gt.scrollMargins=X$;gt.darkTheme=px;gt.cspNonce=Ut.define({combine:n=>n.length?n[0]:""});gt.contentAttributes=l2;gt.editorAttributes=H$;gt.lineWrapping=gt.contentAttributes.of({class:"cm-lineWrapping"});gt.announce=en.define();const Yie=4096,dP={};class qy{constructor(e,t,r,i,s,o){this.from=e,this.to=t,this.dir=r,this.isolates=i,this.fresh=s,this.order=o}static update(e,t){if(t.empty&&!e.some(s=>s.fresh))return e;let r=[],i=e.length?e[e.length-1].dir:pr.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==i&&!t.touchesRange(o.from,o.to)&&r.push(new qy(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return r}}function hP(n,e,t){for(let r=n.state.facet(e),i=r.length-1;i>=0;i--){let s=r[i],o=typeof s=="function"?s(n):s;o&&ix(o,t)}return t}const Gie=At.mac?"mac":At.windows?"win":At.linux?"linux":"key";function Kie(n,e){const t=n.split(/-(?!$)/);let r=t[t.length-1];r=="Space"&&(r=" ");let i,s,o,a;for(let l=0;l<t.length-1;++l){const c=t[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))i=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))e=="mac"?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+c)}return i&&(r="Alt-"+r),s&&(r="Ctrl-"+r),a&&(r="Meta-"+r),o&&(r="Shift-"+r),r}function lv(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const Jie=Wo.default(gt.domEventHandlers({keydown(n,e){return g6(p6(e.state),n,e,"editor")}})),Nl=Ut.define({enables:Jie}),fP=new WeakMap;function p6(n){let e=n.facet(Nl),t=fP.get(e);return t||fP.set(e,t=nse(e.reduce((r,i)=>r.concat(i),[]))),t}function ese(n,e,t){return g6(p6(n.state),e,n,t)}let Xl=null;const tse=4e3;function nse(n,e=Gie){let t=Object.create(null),r=Object.create(null),i=(o,a)=>{let l=r[o];if(l==null)r[o]=a;else if(l!=a)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,a,l,c,d)=>{var h,f;let p=t[o]||(t[o]=Object.create(null)),g=a.split(/ (?!$)/).map(y=>Kie(y,e));for(let y=1;y<g.length;y++){let O=g.slice(0,y).join(" ");i(O,!0),p[O]||(p[O]={preventDefault:!0,stopPropagation:!1,run:[_=>{let x=Xl={view:_,prefix:O,scope:o};return setTimeout(()=>{Xl==x&&(Xl=null)},tse),!0}]})}let m=g.join(" ");i(m,!1);let v=p[m]||(p[m]={preventDefault:!1,stopPropagation:!1,run:((f=(h=p._any)===null||h===void 0?void 0:h.run)===null||f===void 0?void 0:f.slice())||[]});l&&v.run.push(l),c&&(v.preventDefault=!0),d&&(v.stopPropagation=!0)};for(let o of n){let a=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let c of a){let d=t[c]||(t[c]=Object.create(null));d._any||(d._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:h}=o;for(let f in d)d[f].run.push(p=>h(p,vx))}let l=o[e]||o.key;if(l)for(let c of a)s(c,l,o.run,o.preventDefault,o.stopPropagation),o.shift&&s(c,"Shift-"+l,o.shift,o.preventDefault,o.stopPropagation)}return t}let vx=null;function g6(n,e,t,r){vx=e;let i=kre(e),s=al(i,0),o=Yc(s)==i.length&&i!=" ",a="",l=!1,c=!1,d=!1;Xl&&Xl.view==t&&Xl.scope==r&&(a=Xl.prefix+" ",r6.indexOf(e.keyCode)<0&&(c=!0,Xl=null));let h=new Set,f=v=>{if(v){for(let y of v.run)if(!h.has(y)&&(h.add(y),y(t)))return v.stopPropagation&&(d=!0),!0;v.preventDefault&&(v.stopPropagation&&(d=!0),c=!0)}return!1},p=n[r],g,m;return p&&(f(p[a+lv(i,e,!o)])?l=!0:o&&(e.altKey||e.metaKey||e.ctrlKey)&&!(At.windows&&e.ctrlKey&&e.altKey)&&!(At.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(g=_c[e.keyCode])&&g!=i?(f(p[a+lv(g,e,!0)])||e.shiftKey&&(m=sg[e.keyCode])!=i&&m!=g&&f(p[a+lv(m,e,!1)]))&&(l=!0):o&&e.shiftKey&&f(p[a+lv(i,e,!0)])&&(l=!0),!l&&f(p._any)&&(l=!0)),c&&(l=!0),l&&d&&e.stopPropagation(),vx=null,l}class lm{constructor(e,t,r,i,s){this.className=e,this.left=t,this.top=r,this.width=i,this.height=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,r){if(r.empty){let i=e.coordsAtPos(r.head,r.assoc||1);if(!i)return[];let s=m6(e);return[new lm(t,i.left-s.left,i.top-s.top,null,i.bottom-i.top)]}else return rse(e,t,r)}}function m6(n){let e=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==pr.LTR?e.left:e.right-n.scrollDOM.clientWidth*n.scaleX)-n.scrollDOM.scrollLeft*n.scaleX,top:e.top-n.scrollDOM.scrollTop*n.scaleY}}function pP(n,e,t,r){let i=n.coordsAtPos(e,t*2);if(!i)return r;let s=n.dom.getBoundingClientRect(),o=(i.top+i.bottom)/2,a=n.posAtCoords({x:s.left+1,y:o}),l=n.posAtCoords({x:s.right-1,y:o});return a==null||l==null?r:{from:Math.max(r.from,Math.min(a,l)),to:Math.min(r.to,Math.max(a,l))}}function rse(n,e,t){if(t.to<=n.viewport.from||t.from>=n.viewport.to)return[];let r=Math.max(t.from,n.viewport.from),i=Math.min(t.to,n.viewport.to),s=n.textDirection==pr.LTR,o=n.contentDOM,a=o.getBoundingClientRect(),l=m6(n),c=o.querySelector(".cm-line"),d=c&&window.getComputedStyle(c),h=a.left+(d?parseInt(d.paddingLeft)+Math.min(0,parseInt(d.textIndent)):0),f=a.right-(d?parseInt(d.paddingRight):0),p=hx(n,r,1),g=hx(n,i,-1),m=p.type==Ls.Text?p:null,v=g.type==Ls.Text?g:null;if(m&&(n.lineWrapping||p.widgetLineBreaks)&&(m=pP(n,r,1,m)),v&&(n.lineWrapping||g.widgetLineBreaks)&&(v=pP(n,i,-1,v)),m&&v&&m.from==v.from&&m.to==v.to)return O(_(t.from,t.to,m));{let k=m?_(t.from,null,m):x(p,!1),S=v?_(null,t.to,v):x(g,!0),E=[];return(m||p).to<(v||g).from-(m&&v?1:0)||p.widgetLineBreaks>1&&k.bottom+n.defaultLineHeight/2<S.top?E.push(y(h,k.bottom,f,S.top)):k.bottom<S.top&&n.elementAtHeight((k.bottom+S.top)/2).type==Ls.Text&&(k.bottom=S.top=(k.bottom+S.top)/2),O(k).concat(E).concat(O(S))}function y(k,S,E,R){return new lm(e,k-l.left,S-l.top,E-k,R-S)}function O({top:k,bottom:S,horizontal:E}){let R=[];for(let C=0;C<E.length;C+=2)R.push(y(E[C],k,E[C+1],S));return R}function _(k,S,E){let R=1e9,C=-1e9,I=[];function D(N,B,H,F,Z){let $=n.coordsAtPos(N,N==E.to?-2:2),W=n.coordsAtPos(H,H==E.from?2:-2);!$||!W||(R=Math.min($.top,W.top,R),C=Math.max($.bottom,W.bottom,C),Z==pr.LTR?I.push(s&&B?h:$.left,s&&F?f:W.right):I.push(!s&&F?h:W.left,!s&&B?f:$.right))}let Q=k??E.from,M=S??E.to;for(let N of n.visibleRanges)if(N.to>Q&&N.from<M)for(let B=Math.max(N.from,Q),H=Math.min(N.to,M);;){let F=n.state.doc.lineAt(B);for(let Z of n.bidiSpans(F)){let $=Z.from+F.from,W=Z.to+F.from;if($>=H)break;W>B&&D(Math.max($,B),k==null&&$<=Q,Math.min(W,H),S==null&&W>=M,Z.dir)}if(B=F.to+1,B>=H)break}return I.length==0&&D(Q,k==null,M,S==null,n.textDirection),{top:R,bottom:C,horizontal:I}}function x(k,S){let E=a.top+(S?k.top:k.bottom);return{top:E,bottom:E,horizontal:[]}}}function ise(n,e){return n.constructor==e.constructor&&n.eq(e)}class sse{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(Wv)!=e.state.facet(Wv)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,r=e.facet(Wv);for(;t<r.length&&r[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;(e!=this.scaleX||t!=this.scaleY)&&(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((t,r)=>!ise(t,this.drawn[r]))){let t=this.dom.firstChild,r=0;for(let i of e)i.update&&t&&i.constructor&&this.drawn[r].constructor&&i.update(t,this.drawn[r])?(t=t.nextSibling,r++):this.dom.insertBefore(i.draw(),t);for(;t;){let i=t.nextSibling;t.remove(),t=i}this.drawn=e,At.safari&&At.safari_version>=26&&(this.dom.style.display=this.dom.firstChild?"":"none")}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const Wv=Ut.define();function v6(n){return[Kr.define(e=>new sse(e,n)),Wv.of(n)]}const lg=Ut.define({combine(n){return rm(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function ose(n={}){return[lg.of(n),ase,lse,cse,j$.of(!0)]}function y6(n){return n.startState.facet(lg)!=n.state.facet(lg)}const ase=v6({above:!0,markers(n){let{state:e}=n,t=e.facet(lg),r=[];for(let i of e.selection.ranges){let s=i==e.selection.main;if(i.empty||t.drawRangeCursor){let o=s?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",a=i.empty?i:rt.cursor(i.head,i.head>i.anchor?-1:1);for(let l of lm.forRange(n,o,a))r.push(l)}}return r},update(n,e){n.transactions.some(r=>r.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let t=y6(n);return t&&gP(n.state,e),n.docChanged||n.selectionSet||t},mount(n,e){gP(e.state,n)},class:"cm-cursorLayer"});function gP(n,e){e.style.animationDuration=n.facet(lg).cursorBlinkRate+"ms"}const lse=v6({above:!1,markers(n){return n.state.selection.ranges.map(e=>e.empty?[]:lm.forRange(n,"cm-selectionBackground",e)).reduce((e,t)=>e.concat(t))},update(n,e){return n.docChanged||n.selectionSet||n.viewportChanged||y6(n)},class:"cm-selectionLayer"}),cse=Wo.highest(gt.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}})),b6=en.define({map(n,e){return n==null?null:e.mapPos(n)}}),op=Cr.define({create(){return null},update(n,e){return n!=null&&(n=e.changes.mapPos(n)),e.effects.reduce((t,r)=>r.is(b6)?r.value:t,n)}}),use=Kr.fromClass(class{constructor(n){this.view=n,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(n){var e;let t=n.state.field(op);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(n.startState.field(op)!=t||n.docChanged||n.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:n}=this,e=n.state.field(op),t=e!=null&&n.coordsAtPos(e);if(!t)return null;let r=n.scrollDOM.getBoundingClientRect();return{left:t.left-r.left+n.scrollDOM.scrollLeft*n.scaleX,top:t.top-r.top+n.scrollDOM.scrollTop*n.scaleY,height:t.bottom-t.top}}drawCursor(n){if(this.cursor){let{scaleX:e,scaleY:t}=this.view;n?(this.cursor.style.left=n.left/e+"px",this.cursor.style.top=n.top/t+"px",this.cursor.style.height=n.height/t+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(n){this.view.state.field(op)!=n&&this.view.dispatch({effects:b6.of(n)})}},{eventObservers:{dragover(n){this.setDropPos(this.view.posAtCoords({x:n.clientX,y:n.clientY}))},dragleave(n){(n.target==this.view.contentDOM||!this.view.contentDOM.contains(n.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dse(){return[op,use]}function mP(n,e,t,r,i){e.lastIndex=0;for(let s=n.iterRange(t,r),o=t,a;!s.next().done;o+=s.value.length)if(!s.lineBreak)for(;a=e.exec(s.value);)i(o+a.index,a)}function hse(n,e){let t=n.visibleRanges;if(t.length==1&&t[0].from==n.viewport.from&&t[0].to==n.viewport.to)return t;let r=[];for(let{from:i,to:s}of t)i=Math.max(n.state.doc.lineAt(i).from,i-e),s=Math.min(n.state.doc.lineAt(s).to,s+e),r.length&&r[r.length-1].to>=i?r[r.length-1].to=s:r.push({from:i,to:s});return r}class fse{constructor(e){const{regexp:t,decoration:r,decorate:i,boundary:s,maxLength:o=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,i)this.addMatch=(a,l,c,d)=>i(d,c,c+a[0].length,a,l);else if(typeof r=="function")this.addMatch=(a,l,c,d)=>{let h=r(a,l,c);h&&d(c,c+a[0].length,h)};else if(r)this.addMatch=(a,l,c,d)=>d(c,c+a[0].length,r);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=s,this.maxLength=o}createDeco(e){let t=new Cu,r=t.add.bind(t);for(let{from:i,to:s}of hse(e,this.maxLength))mP(e.state.doc,this.regexp,i,s,(o,a)=>this.addMatch(a,e,o,r));return t.finish()}updateDeco(e,t){let r=1e9,i=-1;return e.docChanged&&e.changes.iterChanges((s,o,a,l)=>{l>=e.view.viewport.from&&a<=e.view.viewport.to&&(r=Math.min(a,r),i=Math.max(l,i))}),e.viewportMoved||i-r>1e3?this.createDeco(e.view):i>-1?this.updateRange(e.view,t.map(e.changes),r,i):t}updateRange(e,t,r,i){for(let s of e.visibleRanges){let o=Math.max(s.from,r),a=Math.min(s.to,i);if(a>=o){let l=e.state.doc.lineAt(o),c=l.to<a?e.state.doc.lineAt(a):l,d=Math.max(s.from,l.from),h=Math.min(s.to,c.to);if(this.boundary){for(;o>l.from;o--)if(this.boundary.test(l.text[o-1-l.from])){d=o;break}for(;a<c.to;a++)if(this.boundary.test(c.text[a-c.from])){h=a;break}}let f=[],p,g=(m,v,y)=>f.push(y.range(m,v));if(l==c)for(this.regexp.lastIndex=d-l.from;(p=this.regexp.exec(l.text))&&p.index<h-l.from;)this.addMatch(p,e,p.index+l.from,g);else mP(e.state.doc,this.regexp,d,h,(m,v)=>this.addMatch(v,e,m,g));t=t.update({filterFrom:d,filterTo:h,filter:(m,v)=>m<d||v>h,add:f})}}return t}}const yx=/x/.unicode!=null?"gu":"g",pse=new RegExp(`[\0-\b
--ÂÂ­Øâââ\u2028\u2029â­â®â¦â§â©\uFEFFï¿¹-ï¿¼]`,yx),gse={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let s1=null;function mse(){var n;if(s1==null&&typeof document<"u"&&document.body){let e=document.body.style;s1=((n=e.tabSize)!==null&&n!==void 0?n:e.MozTabSize)!=null}return s1||!1}const Xv=Ut.define({combine(n){let e=rm(n,{render:null,specialChars:pse,addSpecialChars:null});return(e.replaceTabs=!mse())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,yx)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,yx)),e}});function vse(n={}){return[Xv.of(n),yse()]}let vP=null;function yse(){return vP||(vP=Kr.fromClass(class{constructor(n){this.view=n,this.decorations=hn.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet(Xv)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new fse({regexp:n.specialChars,decoration:(e,t,r)=>{let{doc:i}=t.state,s=al(e[0],0);if(s==9){let o=i.lineAt(r),a=t.state.tabSize,l=Ba(o.text,a,r-o.from);return hn.replace({widget:new Ose((a-l%a)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[s]||(this.decorationCache[s]=hn.replace({widget:new _se(n,s)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let e=n.state.facet(Xv);n.startState.facet(Xv)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const bse="â¢";function wse(n){return n>=32?bse:n==10?"â¤":String.fromCharCode(9216+n)}class _se extends Yo{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=wse(this.code),r=e.state.phrase("Control character")+" "+(gse[this.code]||"0x"+this.code.toString(16)),i=this.options.render&&this.options.render(this.code,r,t);if(i)return i;let s=document.createElement("span");return s.textContent=t,s.title=r,s.setAttribute("aria-label",r),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class Ose extends Yo{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}class xse extends Yo{constructor(e){super(),this.content=e}toDOM(e){let t=document.createElement("span");return t.className="cm-placeholder",t.style.pointerEvents="none",t.appendChild(typeof this.content=="string"?document.createTextNode(this.content):typeof this.content=="function"?this.content(e):this.content.cloneNode(!0)),t.setAttribute("aria-hidden","true"),t}coordsAt(e){let t=e.firstChild?Ih(e.firstChild):[];if(!t.length)return null;let r=window.getComputedStyle(e.parentNode),i=im(t[0],r.direction!="rtl"),s=parseInt(r.lineHeight);return i.bottom-i.top>s*1.5?{left:i.left,right:i.right,top:i.top,bottom:i.top+s}:i}ignoreEvent(){return!1}}function w6(n){let e=Kr.fromClass(class{constructor(t){this.view=t,this.placeholder=n?hn.set([hn.widget({widget:new xse(n),side:1}).range(0)]):hn.none}get decorations(){return this.view.state.doc.length?hn.none:this.placeholder}},{decorations:t=>t.decorations});return typeof n=="string"?[e,gt.contentAttributes.of({"aria-placeholder":n})]:e}const cv="-10000px";class kse{constructor(e,t,r,i){this.facet=t,this.createTooltipView=r,this.removeTooltipView=i,this.input=e.state.facet(t),this.tooltips=this.input.filter(o=>o);let s=null;this.tooltipViews=this.tooltips.map(o=>s=r(o,s))}update(e,t){var r;let i=e.state.facet(this.facet),s=i.filter(l=>l);if(i===this.input){for(let l of this.tooltipViews)l.update&&l.update(e);return!1}let o=[],a=t?[]:null;for(let l=0;l<s.length;l++){let c=s[l],d=-1;if(c){for(let h=0;h<this.tooltips.length;h++){let f=this.tooltips[h];f&&f.create==c.create&&(d=h)}if(d<0)o[l]=this.createTooltipView(c,l?o[l-1]:null),a&&(a[l]=!!c.above);else{let h=o[l]=this.tooltipViews[d];a&&(a[l]=t[d]),h.update&&h.update(e)}}}for(let l of this.tooltipViews)o.indexOf(l)<0&&(this.removeTooltipView(l),(r=l.destroy)===null||r===void 0||r.call(l));return t&&(a.forEach((l,c)=>t[c]=l),t.length=a.length),this.input=i,this.tooltips=s,this.tooltipViews=o,!0}}function Sse(n={}){return Yv.of(n)}function Tse(n){let e=n.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:e.clientHeight,right:e.clientWidth}}const Yv=Ut.define({combine:n=>{var e,t,r;return{position:At.ios?"absolute":((e=n.find(i=>i.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=n.find(i=>i.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((r=n.find(i=>i.tooltipSpace))===null||r===void 0?void 0:r.tooltipSpace)||Tse}}}),yP=new WeakMap,_6=Kr.fromClass(class{constructor(n){this.view=n,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=n.state.facet(Yv);this.position=e.position,this.parent=e.parent,this.classes=n.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new kse(n,O6,(t,r)=>this.createTooltip(t,r),t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()}),this.above=this.manager.tooltips.map(t=>!!t.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),n.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let n of this.manager.tooltipViews)this.intersectionObserver.observe(n.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(n){n.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(n,this.above);e&&this.observeIntersection();let t=e||n.geometryChanged,r=n.state.facet(Yv);if(r.position!=this.position&&!this.madeAbsolute){this.position=r.position;for(let i of this.manager.tooltipViews)i.dom.style.position=this.position;t=!0}if(r.parent!=this.parent){this.parent&&this.container.remove(),this.parent=r.parent,this.createContainer();for(let i of this.manager.tooltipViews)this.container.appendChild(i.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(n,e){let t=n.create(this.view),r=e?e.dom:null;if(t.dom.classList.add("cm-tooltip"),n.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let i=document.createElement("div");i.className="cm-tooltip-arrow",t.dom.appendChild(i)}return t.dom.style.position=this.position,t.dom.style.top=cv,t.dom.style.left="0px",this.container.insertBefore(t.dom,r),t.mount&&t.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(t.dom),t}destroy(){var n,e,t;this.view.win.removeEventListener("resize",this.measureSoon);for(let r of this.manager.tooltipViews)r.dom.remove(),(n=r.destroy)===null||n===void 0||n.call(r);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let n=1,e=1,t=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:s}=this.manager.tooltipViews[0];if(At.safari){let o=s.getBoundingClientRect();t=Math.abs(o.top+1e4)>1||Math.abs(o.left)>1}else t=!!s.offsetParent&&s.offsetParent!=this.container.ownerDocument.body}if(t||this.position=="absolute")if(this.parent){let s=this.parent.getBoundingClientRect();s.width&&s.height&&(n=s.width/this.parent.offsetWidth,e=s.height/this.parent.offsetHeight)}else({scaleX:n,scaleY:e}=this.view.viewState);let r=this.view.scrollDOM.getBoundingClientRect(),i=c2(this.view);return{visible:{left:r.left+i.left,top:r.top+i.top,right:r.right-i.right,bottom:r.bottom-i.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((s,o)=>{let a=this.manager.tooltipViews[o];return a.getCoords?a.getCoords(s.pos):this.view.coordsAtPos(s.pos)}),size:this.manager.tooltipViews.map(({dom:s})=>s.getBoundingClientRect()),space:this.view.state.facet(Yv).tooltipSpace(this.view),scaleX:n,scaleY:e,makeAbsolute:t}}writeMeasure(n){var e;if(n.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let a of this.manager.tooltipViews)a.dom.style.position="absolute"}let{visible:t,space:r,scaleX:i,scaleY:s}=n,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],c=this.manager.tooltipViews[a],{dom:d}=c,h=n.pos[a],f=n.size[a];if(!h||l.clip!==!1&&(h.bottom<=Math.max(t.top,r.top)||h.top>=Math.min(t.bottom,r.bottom)||h.right<Math.max(t.left,r.left)-.1||h.left>Math.min(t.right,r.right)+.1)){d.style.top=cv;continue}let p=l.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,g=p?7:0,m=f.right-f.left,v=(e=yP.get(c))!==null&&e!==void 0?e:f.bottom-f.top,y=c.offset||Cse,O=this.view.textDirection==pr.LTR,_=f.width>r.right-r.left?O?r.left:r.right-f.width:O?Math.max(r.left,Math.min(h.left-(p?14:0)+y.x,r.right-m)):Math.min(Math.max(r.left,h.left-m+(p?14:0)-y.x),r.right-m),x=this.above[a];!l.strictSide&&(x?h.top-v-g-y.y<r.top:h.bottom+v+g+y.y>r.bottom)&&x==r.bottom-h.bottom>h.top-r.top&&(x=this.above[a]=!x);let k=(x?h.top-r.top:r.bottom-h.bottom)-g;if(k<v&&c.resize!==!1){if(k<this.view.defaultLineHeight){d.style.top=cv;continue}yP.set(c,v),d.style.height=(v=k)/s+"px"}else d.style.height&&(d.style.height="");let S=x?h.top-v-g-y.y:h.bottom+g+y.y,E=_+m;if(c.overlap!==!0)for(let R of o)R.left<E&&R.right>_&&R.top<S+v&&R.bottom>S&&(S=x?R.top-v-2-g:R.bottom+g+2);if(this.position=="absolute"?(d.style.top=(S-n.parent.top)/s+"px",bP(d,(_-n.parent.left)/i)):(d.style.top=S/s+"px",bP(d,_/i)),p){let R=h.left+(O?y.x:-y.x)-(_+14-7);p.style.left=R/i+"px"}c.overlap!==!0&&o.push({left:_,top:S,right:E,bottom:S+v}),d.classList.toggle("cm-tooltip-above",x),d.classList.toggle("cm-tooltip-below",!x),c.positioned&&c.positioned(n.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let n of this.manager.tooltipViews)n.dom.style.top=cv}},{eventObservers:{scroll(){this.maybeMeasure()}}});function bP(n,e){let t=parseInt(n.style.left,10);(isNaN(t)||Math.abs(e-t)>1)&&(n.style.left=e+"px")}const Ase=gt.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),Cse={x:0,y:0},O6=Ut.define({enables:[_6,Ase]});function x6(n,e){let t=n.plugin(_6);if(!t)return null;let r=t.manager.tooltips.indexOf(e);return r<0?null:t.manager.tooltipViews[r]}const wP=Ut.define({combine(n){let e,t;for(let r of n)e=e||r.topContainer,t=t||r.bottomContainer;return{topContainer:e,bottomContainer:t}}});function Hy(n,e){let t=n.plugin(k6),r=t?t.specs.indexOf(e):-1;return r>-1?t.panels[r]:null}const k6=Kr.fromClass(class{constructor(n){this.input=n.state.facet(Zy),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(n));let e=n.state.facet(wP);this.top=new uv(n,!0,e.topContainer),this.bottom=new uv(n,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(n){let e=n.state.facet(wP);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new uv(n.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new uv(n.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=n.state.facet(Zy);if(t!=this.input){let r=t.filter(l=>l),i=[],s=[],o=[],a=[];for(let l of r){let c=this.specs.indexOf(l),d;c<0?(d=l(n.view),a.push(d)):(d=this.panels[c],d.update&&d.update(n)),i.push(d),(d.top?s:o).push(d)}this.specs=r,this.panels=i,this.top.sync(s),this.bottom.sync(o);for(let l of a)l.dom.classList.add("cm-panel"),l.mount&&l.mount()}else for(let r of this.panels)r.update&&r.update(n)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:n=>gt.scrollMargins.of(e=>{let t=e.plugin(n);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class uv{constructor(e,t,r){this.view=e,this.top=t,this.container=r,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=_P(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=_P(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function _P(n){let e=n.nextSibling;return n.remove(),e}const Zy=Ut.define({enables:k6});class Nh extends Au{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Nh.prototype.elementClass="";Nh.prototype.toDOM=void 0;Nh.prototype.mapMode=zi.TrackBefore;Nh.prototype.startSide=Nh.prototype.endSide=-1;Nh.prototype.point=!0;const S6=1024;let Ese=0,co=class{constructor(e,t){this.from=e,this.to=t}};class tn{constructor(e={}){this.id=Ese++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Vr.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}tn.closedBy=new tn({deserialize:n=>n.split(" ")});tn.openedBy=new tn({deserialize:n=>n.split(" ")});tn.group=new tn({deserialize:n=>n.split(" ")});tn.isolate=new tn({deserialize:n=>{if(n&&n!="rtl"&&n!="ltr"&&n!="auto")throw new RangeError("Invalid value for isolate: "+n);return n||"auto"}});tn.contextHash=new tn({perNode:!0});tn.lookAhead=new tn({perNode:!0});tn.mounted=new tn({perNode:!0});class cg{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[tn.mounted.id]}}const Pse=Object.create(null);class Vr{constructor(e,t,r,i=0){this.name=e,this.props=t,this.id=r,this.flags=i}static define(e){let t=e.props&&e.props.length?Object.create(null):Pse,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),i=new Vr(e.name||"",t,e.id,r);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(i)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return i}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(tn.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let i of r.split(" "))t[i]=e[r];return r=>{for(let i=r.prop(tn.group),s=-1;s<(i?i.length:0);s++){let o=t[s<0?r.name:i[s]];if(o)return o}}}}Vr.none=new Vr("",Object.create(null),0,8);class cm{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let i=null;for(let s of e){let o=s(r);if(o){i||(i=Object.assign({},r.props));let a=o[1],l=o[0];l.combine&&l.id in i&&(a=l.combine(i[l.id],a)),i[l.id]=a}}t.push(i?new Vr(r.name,i,r.id,r.flags):r)}return new cm(t)}}const dv=new WeakMap,OP=new WeakMap;var tr;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays"})(tr||(tr={}));class Bn{constructor(e,t,r,i,s){if(this.type=e,this.children=t,this.positions=r,this.length=i,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,a]of s)this.props[typeof o=="number"?o:o.id]=a}}toString(){let e=cg.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let i=r.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Wy(this.topNode,e)}cursorAt(e,t=0,r=0){let i=dv.get(this)||this.topNode,s=new Wy(i);return s.moveTo(e,t),dv.set(this,s._tree),s}get topNode(){return new Si(this,0,0,null)}resolve(e,t=0){let r=ug(dv.get(this)||this.topNode,e,t,!1);return dv.set(this,r),r}resolveInner(e,t=0){let r=ug(OP.get(this)||this.topNode,e,t,!0);return OP.set(this,r),r}resolveStack(e,t=0){return Rse(this,e,t)}iterate(e){let{enter:t,leave:r,from:i=0,to:s=this.length}=e,o=e.mode||0,a=(o&tr.IncludeAnonymous)>0;for(let l=this.cursor(o|tr.IncludeAnonymous);;){let c=!1;if(l.from<=s&&l.to>=i&&(!a&&l.type.isAnonymous||t(l)!==!1)){if(l.firstChild())continue;c=!0}for(;c&&r&&(a||!l.type.isAnonymous)&&r(l),!l.nextSibling();){if(!l.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:g2(Vr.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,i)=>new Bn(this.type,t,r,i,this.propValues),e.makeTree||((t,r,i)=>new Bn(Vr.none,t,r,i)))}static build(e){return Dse(e)}}Bn.empty=new Bn(Vr.none,[],[],0);class f2{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new f2(this.buffer,this.index)}}class xc{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return Vr.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],i=this.set.types[t],s=i.name;if(/\W/.test(s)&&!i.isError&&(s=JSON.stringify(s)),e+=4,r==e)return s;let o=[];for(;e<r;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,r,i,s){let{buffer:o}=this,a=-1;for(let l=e;l!=t&&!(T6(s,i,o[l+1],o[l+2])&&(a=l,r>0));l=o[l+3]);return a}slice(e,t,r){let i=this.buffer,s=new Uint16Array(t-e),o=0;for(let a=e,l=0;a<t;){s[l++]=i[a++],s[l++]=i[a++]-r;let c=s[l++]=i[a++]-r;s[l++]=i[a++]-e,o=Math.max(o,c)}return new xc(s,o,this.set)}}function T6(n,e,t,r){switch(n){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function ug(n,e,t,r){for(var i;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let o=!r&&n instanceof Si&&n.index<0?null:n.parent;if(!o)return n;n=o}let s=r?0:tr.IgnoreOverlays;if(r)for(let o=n,a=o.parent;a;o=a,a=o.parent)o instanceof Si&&o.index<0&&((i=a.enter(e,t,s))===null||i===void 0?void 0:i.from)!=o.from&&(n=a);for(;;){let o=n.enter(e,t,s);if(!o)return n;n=o}}class A6{cursor(e=0){return new Wy(this,e)}getChild(e,t=null,r=null){let i=xP(this,e,t,r);return i.length?i[0]:null}getChildren(e,t=null,r=null){return xP(this,e,t,r)}resolve(e,t=0){return ug(this,e,t,!1)}resolveInner(e,t=0){return ug(this,e,t,!0)}matchContext(e){return bx(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let i=t.lastChild;if(!i||i.to!=t.to)break;i.type.isError&&i.from==i.to?(r=t,t=i.prevSibling):t=i}return r}get node(){return this}get next(){return this.parent}}class Si extends A6{constructor(e,t,r,i){super(),this._tree=e,this.from=t,this.index=r,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,i,s=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,c=t>0?a.length:-1;e!=c;e+=t){let d=a[e],h=l[e]+o.from;if(T6(i,r,h,h+d.length)){if(d instanceof xc){if(s&tr.ExcludeBuffers)continue;let f=d.findChild(0,d.buffer.length,t,r-h,i);if(f>-1)return new Ea(new Ise(o,d,e,h),null,f)}else if(s&tr.IncludeAnonymous||!d.type.isAnonymous||p2(d)){let f;if(!(s&tr.IgnoreMounts)&&(f=cg.get(d))&&!f.overlay)return new Si(f.tree,h,e,o);let p=new Si(d,h,e,o);return s&tr.IncludeAnonymous||!p.type.isAnonymous?p:p.nextChild(t<0?d.children.length-1:0,t,r,i)}}}if(s&tr.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,t,r=0){let i;if(!(r&tr.IgnoreOverlays)&&(i=cg.get(this._tree))&&i.overlay){let s=e-this.from;for(let{from:o,to:a}of i.overlay)if((t>0?o<=s:o<s)&&(t<0?a>=s:a>s))return new Si(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function xP(n,e,t,r){let i=n.cursor(),s=[];if(!i.firstChild())return s;if(t!=null){for(let o=!1;!o;)if(o=i.type.is(t),!i.nextSibling())return s}for(;;){if(r!=null&&i.type.is(r))return s;if(i.type.is(e)&&s.push(i.node),!i.nextSibling())return r==null?s:[]}}function bx(n,e,t=e.length-1){for(let r=n;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class Ise{constructor(e,t,r,i){this.parent=e,this.buffer=t,this.index=r,this.start=i}}class Ea extends A6{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:i}=this.context,s=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.context.start,r);return s<0?null:new Ea(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,t,r=0){if(r&tr.ExcludeBuffers)return null;let{buffer:i}=this.context,s=i.findChild(this.index+4,i.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new Ea(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Ea(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new Ea(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,i=this.index+4,s=r.buffer[this.index+3];if(s>i){let o=r.buffer[this.index+1];e.push(r.slice(i,s,o)),t.push(0)}return new Bn(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function C6(n){if(!n.length)return null;let e=0,t=n[0];for(let s=1;s<n.length;s++){let o=n[s];(o.from>t.from||o.to<t.to)&&(t=o,e=s)}let r=t instanceof Si&&t.index<0?null:t.parent,i=n.slice();return r?i[e]=r:i.splice(e,1),new Mse(i,t)}class Mse{constructor(e,t){this.heads=e,this.node=t}get next(){return C6(this.heads)}}function Rse(n,e,t){let r=n.resolveInner(e,t),i=null;for(let s=r instanceof Si?r:r.context.parent;s;s=s.parent)if(s.index<0){let o=s.parent;(i||(i=[r])).push(o.resolve(e,t)),s=o}else{let o=cg.get(s.tree);if(o&&o.overlay&&o.overlay[0].from<=e&&o.overlay[o.overlay.length-1].to>=e){let a=new Si(o.tree,o.overlay[0].from+s.from,-1,s);(i||(i=[r])).push(ug(a,e,t,!1))}}return i?C6(i):r}class Wy{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Si)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:i}=this.buffer;return this.type=t||i.set.types[i.buffer[e]],this.from=r+i.buffer[e+1],this.to=r+i.buffer[e+2],!0}yield(e){return e?e instanceof Si?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:i}=this.buffer,s=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.buffer.start,r);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&tr.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&tr.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&tr.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let i=r<0?0:this.stack[r]+4;if(this.index!=i)return this.yieldBuf(t.findChild(i,this.index,-1,0,4))}else{let i=t.buffer[this.index+3];if(i<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(i)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(i.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:r}=i)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let s=t+e,o=e<0?-1:r._tree.children.length;s!=o;s+=e){let a=r._tree.children[s];if(this.mode&tr.IncludeAnonymous||a instanceof xc||!a.type.isAnonymous||p2(a))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let i=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==i){if(i==this.index)return o;t=o,r=s+1;break e}i=this.stack[--s]}for(let i=r;i<this.stack.length;i++)t=new Ea(this.buffer,t,this.stack[i]);return this.bufferNode=new Ea(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let i=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(i=!0)}for(;;){if(i&&t&&t(this),i=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,i=!0}}}matchContext(e){if(!this.buffer)return bx(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let i=e.length-1,s=this.stack.length-1;i>=0;s--){if(s<0)return bx(this._tree,e,i);let o=r[t.buffer[this.stack[s]]];if(!o.isAnonymous){if(e[i]&&e[i]!=o.name)return!1;i--}}return!0}}function p2(n){return n.children.some(e=>e instanceof xc||!e.type.isAnonymous||p2(e))}function Dse(n){var e;let{buffer:t,nodeSet:r,maxBufferLength:i=S6,reused:s=[],minRepeatType:o=r.types.length}=n,a=Array.isArray(t)?new f2(t,t.length):t,l=r.types,c=0,d=0;function h(k,S,E,R,C,I){let{id:D,start:Q,end:M,size:N}=a,B=d,H=c;if(N<0)if(a.next(),N==-1){let G=s[D];E.push(G),R.push(Q-k);return}else if(N==-3){c=D;return}else if(N==-4){d=D;return}else throw new RangeError(`Unrecognized record size: ${N}`);let F=l[D],Z,$,W=Q-k;if(M-Q<=i&&($=v(a.pos-S,C))){let G=new Uint16Array($.size-$.skip),L=a.pos-$.size,q=G.length;for(;a.pos>L;)q=y($.start,G,q);Z=new xc(G,M-$.start,r),W=$.start-k}else{let G=a.pos-N;a.next();let L=[],q=[],ue=D>=o?D:-1,oe=0,fe=M;for(;a.pos>G;)ue>=0&&a.id==ue&&a.size>=0?(a.end<=fe-i&&(g(L,q,Q,oe,a.end,fe,ue,B,H),oe=L.length,fe=a.end),a.next()):I>2500?f(Q,G,L,q):h(Q,G,L,q,ue,I+1);if(ue>=0&&oe>0&&oe<L.length&&g(L,q,Q,oe,Q,fe,ue,B,H),L.reverse(),q.reverse(),ue>-1&&oe>0){let be=p(F,H);Z=g2(F,L,q,0,L.length,0,M-Q,be,be)}else Z=m(F,L,q,M-Q,B-M,H)}E.push(Z),R.push(W)}function f(k,S,E,R){let C=[],I=0,D=-1;for(;a.pos>S;){let{id:Q,start:M,end:N,size:B}=a;if(B>4)a.next();else{if(D>-1&&M<D)break;D<0&&(D=N-i),C.push(Q,M,N),I++,a.next()}}if(I){let Q=new Uint16Array(I*4),M=C[C.length-2];for(let N=C.length-3,B=0;N>=0;N-=3)Q[B++]=C[N],Q[B++]=C[N+1]-M,Q[B++]=C[N+2]-M,Q[B++]=B;E.push(new xc(Q,C[2]-M,r)),R.push(M-k)}}function p(k,S){return(E,R,C)=>{let I=0,D=E.length-1,Q,M;if(D>=0&&(Q=E[D])instanceof Bn){if(!D&&Q.type==k&&Q.length==C)return Q;(M=Q.prop(tn.lookAhead))&&(I=R[D]+Q.length+M)}return m(k,E,R,C,I,S)}}function g(k,S,E,R,C,I,D,Q,M){let N=[],B=[];for(;k.length>R;)N.push(k.pop()),B.push(S.pop()+E-C);k.push(m(r.types[D],N,B,I-C,Q-I,M)),S.push(C-E)}function m(k,S,E,R,C,I,D){if(I){let Q=[tn.contextHash,I];D=D?[Q].concat(D):[Q]}if(C>25){let Q=[tn.lookAhead,C];D=D?[Q].concat(D):[Q]}return new Bn(k,S,E,R,D)}function v(k,S){let E=a.fork(),R=0,C=0,I=0,D=E.end-i,Q={size:0,start:0,skip:0};e:for(let M=E.pos-k;E.pos>M;){let N=E.size;if(E.id==S&&N>=0){Q.size=R,Q.start=C,Q.skip=I,I+=4,R+=4,E.next();continue}let B=E.pos-N;if(N<0||B<M||E.start<D)break;let H=E.id>=o?4:0,F=E.start;for(E.next();E.pos>B;){if(E.size<0)if(E.size==-3||E.size==-4)H+=4;else break e;else E.id>=o&&(H+=4);E.next()}C=F,R+=N,I+=H}return(S<0||R==k)&&(Q.size=R,Q.start=C,Q.skip=I),Q.size>4?Q:void 0}function y(k,S,E){let{id:R,start:C,end:I,size:D}=a;if(a.next(),D>=0&&R<o){let Q=E;if(D>4){let M=a.pos-(D-4);for(;a.pos>M;)E=y(k,S,E)}S[--E]=Q,S[--E]=I-k,S[--E]=C-k,S[--E]=R}else D==-3?c=R:D==-4&&(d=R);return E}let O=[],_=[];for(;a.pos>0;)h(n.start||0,n.bufferStart||0,O,_,-1,0);let x=(e=n.length)!==null&&e!==void 0?e:O.length?_[0]+O[0].length:0;return new Bn(l[n.topID],O.reverse(),_.reverse(),x)}const kP=new WeakMap;function Gv(n,e){if(!n.isAnonymous||e instanceof xc||e.type!=n)return 1;let t=kP.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=n||!(r instanceof Bn)){t=1;break}t+=Gv(n,r)}kP.set(e,t)}return t}function g2(n,e,t,r,i,s,o,a,l){let c=0;for(let g=r;g<i;g++)c+=Gv(n,e[g]);let d=Math.ceil(c*1.5/8),h=[],f=[];function p(g,m,v,y,O){for(let _=v;_<y;){let x=_,k=m[_],S=Gv(n,g[_]);for(_++;_<y;_++){let E=Gv(n,g[_]);if(S+E>=d)break;S+=E}if(_==x+1){if(S>d){let E=g[x];p(E.children,E.positions,0,E.children.length,m[x]+O);continue}h.push(g[x])}else{let E=m[_-1]+g[_-1].length-k;h.push(g2(n,g,m,x,_,k,E,null,l))}f.push(k+O-s)}}return p(e,t,r,i,0),(a||l)(h,f,o)}class E6{constructor(){this.map=new WeakMap}setBuffer(e,t,r){let i=this.map.get(e);i||this.map.set(e,i=new Map),i.set(t,r)}getBuffer(e,t){let r=this.map.get(e);return r&&r.get(t)}set(e,t){e instanceof Ea?this.setBuffer(e.context.buffer,e.index,t):e instanceof Si&&this.map.set(e.tree,t)}get(e){return e instanceof Ea?this.getBuffer(e.context.buffer,e.index):e instanceof Si?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class _l{constructor(e,t,r,i,s=!1,o=!1){this.from=e,this.to=t,this.tree=r,this.offset=i,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let i=[new _l(0,e.length,e,0,!1,r)];for(let s of t)s.to>e.length&&i.push(s);return i}static applyChanges(e,t,r=128){if(!t.length)return e;let i=[],s=1,o=e.length?e[0]:null;for(let a=0,l=0,c=0;;a++){let d=a<t.length?t[a]:null,h=d?d.fromA:1e9;if(h-l>=r)for(;o&&o.from<h;){let f=o;if(l>=f.from||h<=f.to||c){let p=Math.max(f.from,l)-c,g=Math.min(f.to,h)-c;f=p>=g?null:new _l(p,g,f.tree,f.offset+c,a>0,!!d)}if(f&&i.push(f),o.to>h)break;o=s<e.length?e[s++]:null}if(!d)break;l=d.toA,c=d.toA-d.toB}return i}}class m2{startParse(e,t,r){return typeof e=="string"&&(e=new Nse(e)),r=r?r.length?r.map(i=>new co(i.from,i.to)):[new co(0,0)]:[new co(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let i=this.startParse(e,t,r);for(;;){let s=i.advance();if(s)return s}}}let Nse=class{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}};function P6(n){return(e,t,r,i)=>new Qse(e,n,t,r,i)}class SP{constructor(e,t,r,i,s){this.parser=e,this.parse=t,this.overlay=r,this.target=i,this.from=s}}function TP(n){if(!n.length||n.some(e=>e.from>=e.to))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(n))}class Lse{constructor(e,t,r,i,s,o,a){this.parser=e,this.predicate=t,this.mounts=r,this.index=i,this.start=s,this.target=o,this.prev=a,this.depth=0,this.ranges=[]}}const wx=new tn({perNode:!0});class Qse{constructor(e,t,r,i,s){this.nest=t,this.input=r,this.fragments=i,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let r=this.baseParse.advance();if(!r)return null;if(this.baseParse=null,this.baseTree=r,this.startInner(),this.stoppedAt!=null)for(let i of this.inner)i.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let r=this.baseTree;return this.stoppedAt!=null&&(r=new Bn(r.type,r.children,r.positions,r.length,r.propValues.concat([[wx,this.stoppedAt]]))),r}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let r=Object.assign(Object.create(null),e.target.props);r[tn.mounted.id]=new cg(t,e.overlay,e.parser),e.target.props=r}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new zse(this.fragments),t=null,r=null,i=new Wy(new Si(this.baseTree,this.ranges[0].from,0,null),tr.IncludeAnonymous|tr.IgnoreMounts);e:for(let s,o;;){let a=!0,l;if(this.stoppedAt!=null&&i.from>=this.stoppedAt)a=!1;else if(e.hasNode(i)){if(t){let c=t.mounts.find(d=>d.frag.from<=i.from&&d.frag.to>=i.to&&d.mount.overlay);if(c)for(let d of c.mount.overlay){let h=d.from+c.pos,f=d.to+c.pos;h>=i.from&&f<=i.to&&!t.ranges.some(p=>p.from<f&&p.to>h)&&t.ranges.push({from:h,to:f})}}a=!1}else if(r&&(o=$se(r.ranges,i.from,i.to)))a=o!=2;else if(!i.type.isAnonymous&&(s=this.nest(i,this.input))&&(i.from<i.to||!s.overlay)){i.tree||(Fse(i),t&&t.depth++,r&&r.depth++);let c=e.findMounts(i.from,s.parser);if(typeof s.overlay=="function")t=new Lse(s.parser,s.overlay,c,this.inner.length,i.from,i.tree,t);else{let d=EP(this.ranges,s.overlay||(i.from<i.to?[new co(i.from,i.to)]:[]));d.length&&TP(d),(d.length||!s.overlay)&&this.inner.push(new SP(s.parser,d.length?s.parser.startParse(this.input,PP(c,d),d):s.parser.startParse(""),s.overlay?s.overlay.map(h=>new co(h.from-i.from,h.to-i.from)):null,i.tree,d.length?d[0].from:i.from)),s.overlay?d.length&&(r={ranges:d,depth:0,prev:r}):a=!1}}else if(t&&(l=t.predicate(i))&&(l===!0&&(l=new co(i.from,i.to)),l.from<l.to)){let c=t.ranges.length-1;c>=0&&t.ranges[c].to==l.from?t.ranges[c]={from:t.ranges[c].from,to:l.to}:t.ranges.push(l)}if(a&&i.firstChild())t&&t.depth++,r&&r.depth++;else for(;!i.nextSibling();){if(!i.parent())break e;if(t&&!--t.depth){let c=EP(this.ranges,t.ranges);c.length&&(TP(c),this.inner.splice(t.index,0,new SP(t.parser,t.parser.startParse(this.input,PP(t.mounts,c),c),t.ranges.map(d=>new co(d.from-t.start,d.to-t.start)),t.target,c[0].from))),t=t.prev}r&&!--r.depth&&(r=r.prev)}}}}function $se(n,e,t){for(let r of n){if(r.from>=t)break;if(r.to>e)return r.from<=e&&r.to>=t?2:1}return 0}function AP(n,e,t,r,i,s){if(e<t){let o=n.buffer[e+1];r.push(n.slice(e,t,o)),i.push(o-s)}}function Fse(n){let{node:e}=n,t=[],r=e.context.buffer;do t.push(n.index),n.parent();while(!n.tree);let i=n.tree,s=i.children.indexOf(r),o=i.children[s],a=o.buffer,l=[s];function c(d,h,f,p,g,m){let v=t[m],y=[],O=[];AP(o,d,v,y,O,p);let _=a[v+1],x=a[v+2];l.push(y.length);let k=m?c(v+4,a[v+3],o.set.types[a[v]],_,x-_,m-1):e.toTree();return y.push(k),O.push(_-p),AP(o,a[v+3],h,y,O,p),new Bn(f,y,O,g)}i.children[s]=c(0,a.length,Vr.none,0,o.length,t.length-1);for(let d of l){let h=n.tree.children[d],f=n.tree.positions[d];n.yield(new Si(h,f+n.from,d,n._tree))}}class CP{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.cursor(tr.IncludeAnonymous|tr.IgnoreMounts)}moveTo(e){let{cursor:t}=this,r=e-this.offset;for(;!this.done&&t.from<r;)t.to>=e&&t.enter(r,1,tr.IgnoreOverlays|tr.ExcludeBuffers)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof Bn)t=t.children[0];else break}return!1}}let zse=class{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let r=this.curFrag=e[0];this.curTo=(t=r.tree.prop(wx))!==null&&t!==void 0?t:r.to,this.inner=new CP(r.tree,-r.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(wx))!==null&&e!==void 0?e:t.to,this.inner=new CP(t.tree,-t.offset)}}findMounts(e,t){var r;let i=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let s=this.inner.cursor.node;s;s=s.parent){let o=(r=s.tree)===null||r===void 0?void 0:r.prop(tn.mounted);if(o&&o.parser==t)for(let a=this.fragI;a<this.fragments.length;a++){let l=this.fragments[a];if(l.from>=s.to)break;l.tree==this.curFrag.tree&&i.push({frag:l,pos:s.from-l.offset,mount:o})}}}return i}};function EP(n,e){let t=null,r=e;for(let i=1,s=0;i<n.length;i++){let o=n[i-1].to,a=n[i].from;for(;s<r.length;s++){let l=r[s];if(l.from>=a)break;l.to<=o||(t||(r=t=e.slice()),l.from<o?(t[s]=new co(l.from,o),l.to>a&&t.splice(s+1,0,new co(a,l.to))):l.to>a?t[s--]=new co(a,l.to):t.splice(s--,1))}}return r}function Bse(n,e,t,r){let i=0,s=0,o=!1,a=!1,l=-1e9,c=[];for(;;){let d=i==n.length?1e9:o?n[i].to:n[i].from,h=s==e.length?1e9:a?e[s].to:e[s].from;if(o!=a){let f=Math.max(l,t),p=Math.min(d,h,r);f<p&&c.push(new co(f,p))}if(l=Math.min(d,h),l==1e9)break;d==l&&(o?(o=!1,i++):o=!0),h==l&&(a?(a=!1,s++):a=!0)}return c}function PP(n,e){let t=[];for(let{pos:r,mount:i,frag:s}of n){let o=r+(i.overlay?i.overlay[0].from:0),a=o+i.tree.length,l=Math.max(s.from,o),c=Math.min(s.to,a);if(i.overlay){let d=i.overlay.map(f=>new co(f.from+r,f.to+r)),h=Bse(e,d,l,c);for(let f=0,p=l;;f++){let g=f==h.length,m=g?c:h[f].from;if(m>p&&t.push(new _l(p,m,i.tree,-o,s.from>=p||s.openStart,s.to<=m||s.openEnd)),g)break;p=h[f].to}}else t.push(new _l(l,c,i.tree,-o,s.from>=o||s.openStart,s.to<=a||s.openEnd))}return t}let Use=0;class As{constructor(e,t,r,i){this.name=e,this.set=t,this.base=r,this.modified=i,this.id=Use++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let r=typeof e=="string"?e:"?";if(e instanceof As&&(t=e),t?.base)throw new Error("Can not derive from a modified tag");let i=new As(r,[],null,[]);if(i.set.push(i),t)for(let s of t.set)i.set.push(s);return i}static defineModifier(e){let t=new Xy(e);return r=>r.modified.indexOf(t)>-1?r:Xy.get(r.base||r,r.modified.concat(t).sort((i,s)=>i.id-s.id))}}let jse=0;class Xy{constructor(e){this.name=e,this.instances=[],this.id=jse++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(a=>a.base==e&&Vse(t,a.modified));if(r)return r;let i=[],s=new As(e.name,i,e,t);for(let a of t)a.instances.push(s);let o=qse(t);for(let a of e.set)if(!a.modified.length)for(let l of o)i.push(Xy.get(a,l));return s}}function Vse(n,e){return n.length==e.length&&n.every((t,r)=>t==e[r])}function qse(n){let e=[[]];for(let t=0;t<n.length;t++)for(let r=0,i=e.length;r<i;r++)e.push(e[r].concat(n[t]));return e.sort((t,r)=>r.length-t.length)}function rf(n){let e=Object.create(null);for(let t in n){let r=n[t];Array.isArray(r)||(r=[r]);for(let i of t.split(" "))if(i){let s=[],o=2,a=i;for(let h=0;;){if(a=="..."&&h>0&&h+3==i.length){o=1;break}let f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!f)throw new RangeError("Invalid path: "+i);if(s.push(f[0]=="*"?"":f[0][0]=='"'?JSON.parse(f[0]):f[0]),h+=f[0].length,h==i.length)break;let p=i[h++];if(h==i.length&&p=="!"){o=0;break}if(p!="/")throw new RangeError("Invalid path: "+i);a=i.slice(h)}let l=s.length-1,c=s[l];if(!c)throw new RangeError("Invalid path: "+i);let d=new dg(r,o,l>0?s.slice(0,l):null);e[c]=d.sort(e[c])}}return I6.add(e)}const I6=new tn({combine(n,e){let t,r,i;for(;n||e;){if(!n||e&&n.depth>=e.depth?(i=e,e=e.next):(i=n,n=n.next),t&&t.mode==i.mode&&!i.context&&!t.context)continue;let s=new dg(i.tags,i.mode,i.context);t?t.next=s:r=s,t=s}return r}});class dg{constructor(e,t,r,i){this.tags=e,this.mode=t,this.context=r,this.next=i}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}dg.empty=new dg([],2,null);function M6(n,e){let t=Object.create(null);for(let s of n)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let o of s.tag)t[o.id]=s.class;let{scope:r,all:i=null}=e||{};return{style:s=>{let o=i;for(let a of s)for(let l of a.set){let c=t[l.id];if(c){o=o?o+" "+c:c;break}}return o},scope:r}}function Hse(n,e){let t=null;for(let r of n){let i=r.style(e);i&&(t=t?t+" "+i:i)}return t}function Zse(n,e,t,r=0,i=n.length){let s=new Wse(r,Array.isArray(e)?e:[e],t);s.highlightRange(n.cursor(),r,i,"",s.highlighters),s.flush(i)}class Wse{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,i,s){let{type:o,from:a,to:l}=e;if(a>=r||l<=t)return;o.isTop&&(s=this.highlighters.filter(p=>!p.scope||p.scope(o)));let c=i,d=Xse(e)||dg.empty,h=Hse(s,d.tags);if(h&&(c&&(c+=" "),c+=h,d.mode==1&&(i+=(i?" ":"")+h)),this.startSpan(Math.max(t,a),c),d.opaque)return;let f=e.tree&&e.tree.prop(tn.mounted);if(f&&f.overlay){let p=e.node.enter(f.overlay[0].from+a,1),g=this.highlighters.filter(v=>!v.scope||v.scope(f.tree.type)),m=e.firstChild();for(let v=0,y=a;;v++){let O=v<f.overlay.length?f.overlay[v]:null,_=O?O.from+a:l,x=Math.max(t,y),k=Math.min(r,_);if(x<k&&m)for(;e.from<k&&(this.highlightRange(e,x,k,i,s),this.startSpan(Math.min(k,e.to),c),!(e.to>=_||!e.nextSibling())););if(!O||_>r)break;y=O.to+a,y>t&&(this.highlightRange(p.cursor(),Math.max(t,O.from+a),Math.min(r,y),"",g),this.startSpan(Math.min(r,y),c))}m&&e.parent()}else if(e.firstChild()){f&&(i="");do if(!(e.to<=t)){if(e.from>=r)break;this.highlightRange(e,t,r,i,s),this.startSpan(Math.min(r,e.to),c)}while(e.nextSibling());e.parent()}}}function Xse(n){let e=n.type.prop(I6);for(;e&&e.context&&!n.matchContext(e.context);)e=e.next;return e||null}const kt=As.define,hv=kt(),jl=kt(),IP=kt(jl),MP=kt(jl),Vl=kt(),fv=kt(Vl),o1=kt(Vl),da=kt(),Dc=kt(da),la=kt(),ca=kt(),_x=kt(),Ef=kt(_x),pv=kt(),K={comment:hv,lineComment:kt(hv),blockComment:kt(hv),docComment:kt(hv),name:jl,variableName:kt(jl),typeName:IP,tagName:kt(IP),propertyName:MP,attributeName:kt(MP),className:kt(jl),labelName:kt(jl),namespace:kt(jl),macroName:kt(jl),literal:Vl,string:fv,docString:kt(fv),character:kt(fv),attributeValue:kt(fv),number:o1,integer:kt(o1),float:kt(o1),bool:kt(Vl),regexp:kt(Vl),escape:kt(Vl),color:kt(Vl),url:kt(Vl),keyword:la,self:kt(la),null:kt(la),atom:kt(la),unit:kt(la),modifier:kt(la),operatorKeyword:kt(la),controlKeyword:kt(la),definitionKeyword:kt(la),moduleKeyword:kt(la),operator:ca,derefOperator:kt(ca),arithmeticOperator:kt(ca),logicOperator:kt(ca),bitwiseOperator:kt(ca),compareOperator:kt(ca),updateOperator:kt(ca),definitionOperator:kt(ca),typeOperator:kt(ca),controlOperator:kt(ca),punctuation:_x,separator:kt(_x),bracket:Ef,angleBracket:kt(Ef),squareBracket:kt(Ef),paren:kt(Ef),brace:kt(Ef),content:da,heading:Dc,heading1:kt(Dc),heading2:kt(Dc),heading3:kt(Dc),heading4:kt(Dc),heading5:kt(Dc),heading6:kt(Dc),contentSeparator:kt(da),list:kt(da),quote:kt(da),emphasis:kt(da),strong:kt(da),link:kt(da),monospace:kt(da),strikethrough:kt(da),inserted:kt(),deleted:kt(),changed:kt(),invalid:kt(),meta:pv,documentMeta:kt(pv),annotation:kt(pv),processingInstruction:kt(pv),definition:As.defineModifier("definition"),constant:As.defineModifier("constant"),function:As.defineModifier("function"),standard:As.defineModifier("standard"),local:As.defineModifier("local"),special:As.defineModifier("special")};for(let n in K){let e=K[n];e instanceof As&&(e.name=n)}M6([{tag:K.link,class:"tok-link"},{tag:K.heading,class:"tok-heading"},{tag:K.emphasis,class:"tok-emphasis"},{tag:K.strong,class:"tok-strong"},{tag:K.keyword,class:"tok-keyword"},{tag:K.atom,class:"tok-atom"},{tag:K.bool,class:"tok-bool"},{tag:K.url,class:"tok-url"},{tag:K.labelName,class:"tok-labelName"},{tag:K.inserted,class:"tok-inserted"},{tag:K.deleted,class:"tok-deleted"},{tag:K.literal,class:"tok-literal"},{tag:K.string,class:"tok-string"},{tag:K.number,class:"tok-number"},{tag:[K.regexp,K.escape,K.special(K.string)],class:"tok-string2"},{tag:K.variableName,class:"tok-variableName"},{tag:K.local(K.variableName),class:"tok-variableName tok-local"},{tag:K.definition(K.variableName),class:"tok-variableName tok-definition"},{tag:K.special(K.variableName),class:"tok-variableName2"},{tag:K.definition(K.propertyName),class:"tok-propertyName tok-definition"},{tag:K.typeName,class:"tok-typeName"},{tag:K.namespace,class:"tok-namespace"},{tag:K.className,class:"tok-className"},{tag:K.macroName,class:"tok-macroName"},{tag:K.propertyName,class:"tok-propertyName"},{tag:K.operator,class:"tok-operator"},{tag:K.comment,class:"tok-comment"},{tag:K.meta,class:"tok-meta"},{tag:K.invalid,class:"tok-invalid"},{tag:K.punctuation,class:"tok-punctuation"}]);var a1;const au=new tn;function v2(n){return Ut.define({combine:n?e=>e.concat(n):void 0})}const y2=new tn;class uo{constructor(e,t,r=[],i=""){this.data=e,this.name=i,un.prototype.hasOwnProperty("tree")||Object.defineProperty(un.prototype,"tree",{get(){return dr(this)}}),this.parser=t,this.extension=[$h.of(this),un.languageData.of((s,o,a)=>{let l=RP(s,o,a),c=l.type.prop(au);if(!c)return[];let d=s.facet(c),h=l.type.prop(y2);if(h){let f=l.resolve(o-l.from,a);for(let p of h)if(p.test(f,s)){let g=s.facet(p.facet);return p.type=="replace"?g:g.concat(d)}}return d})].concat(r)}isActiveAt(e,t,r=-1){return RP(e,t,r).type.prop(au)==this.data}findRegions(e){let t=e.facet($h);if(t?.data==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],i=(s,o)=>{if(s.prop(au)==this.data){r.push({from:o,to:o+s.length});return}let a=s.prop(tn.mounted);if(a){if(a.tree.prop(au)==this.data){if(a.overlay)for(let l of a.overlay)r.push({from:l.from+o,to:l.to+o});else r.push({from:o,to:o+s.length});return}else if(a.overlay){let l=r.length;if(i(a.tree,a.overlay[0].from+o),r.length>l)return}}for(let l=0;l<s.children.length;l++){let c=s.children[l];c instanceof Bn&&i(c,s.positions[l]+o)}};return i(dr(e),0),r}get allowsNesting(){return!0}}uo.setState=en.define();function RP(n,e,t){let r=n.facet($h),i=dr(n).topNode;if(!r||r.allowsNesting)for(let s=i;s;s=s.enter(e,t,tr.ExcludeBuffers))s.type.isTop&&(i=s);return i}class Lh extends uo{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=v2(e.languageData);return new Lh(t,e.parser.configure({props:[au.add(r=>r.isTop?t:void 0)]}),e.name)}configure(e,t){return new Lh(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function dr(n){let e=n.field(uo.state,!1);return e?e.tree:Bn.empty}class Yse{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let Pf=null;class hg{constructor(e,t,r=[],i,s,o,a,l){this.parser=e,this.state=t,this.fragments=r,this.tree=i,this.treeLen=s,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new hg(e,t,[],Bn.empty,0,r,[],null)}startParse(){return this.parser.startParse(new Yse(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=Bn.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let i=Date.now()+e;e=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(_l.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(_l.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=Pf;Pf=this;try{return e()}finally{Pf=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=DP(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:i,treeLen:s,viewport:o,skipped:a}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((c,d,h,f)=>l.push({fromA:c,toA:d,fromB:h,toB:f})),r=_l.applyChanges(r,l),i=Bn.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){a=[];for(let c of this.skipped){let d=e.mapPos(c.from,1),h=e.mapPos(c.to,-1);d<h&&a.push({from:d,to:h})}}}return new hg(this.parser,t,r,i,s,o,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:i,to:s}=this.skipped[r];i<e.to&&s>e.from&&(this.fragments=DP(this.fragments,i,s),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends m2{createParse(t,r,i){let s=i[0].from,o=i[i.length-1].to;return{parsedPos:s,advance(){let l=Pf;if(l){for(let c of i)l.tempSkipped.push(c);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=o,new Bn(Vr.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return Pf}}function DP(n,e,t){return _l.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Qh{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new Qh(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=hg.create(e.facet($h).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new Qh(r)}}uo.state=Cr.define({create:Qh.init,update(n,e){for(let t of e.effects)if(t.is(uo.setState))return t.value;return e.startState.facet($h)!=e.state.facet($h)?Qh.init(e.state):n.apply(e)}});let R6=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(R6=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const l1=typeof navigator<"u"&&(!((a1=navigator.scheduling)===null||a1===void 0)&&a1.isInputPending)?()=>navigator.scheduling.isInputPending():null,Gse=Kr.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(uo.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(uo.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=R6(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:i}}=this.view,s=r.field(uo.state);if(s.tree==s.context.tree&&s.context.isDone(i+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!l1?Math.max(25,e.timeRemaining()-5):1e9),a=s.context.treeLen<i&&r.doc.length>i+1e3,l=s.context.work(()=>l1&&l1()||Date.now()>o,i+(a?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:uo.setState.of(new Qh(s.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Ds(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),$h=Ut.define({combine(n){return n.length?n[0]:null},enables:n=>[uo.state,Gse,gt.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]});class fg{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}class Yy{constructor(e,t,r,i,s,o=void 0){this.name=e,this.alias=t,this.extensions=r,this.filename=i,this.loadFunc=s,this.support=o,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:r}=e;if(!t){if(!r)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(r)}return new Yy(e.name,(e.alias||[]).concat(e.name).map(i=>i.toLowerCase()),e.extensions||[],e.filename,t,r)}static matchFilename(e,t){for(let i of e)if(i.filename&&i.filename.test(t))return i;let r=/\.([^.]+)$/.exec(t);if(r){for(let i of e)if(i.extensions.indexOf(r[1])>-1)return i}return null}static matchLanguageName(e,t,r=!0){t=t.toLowerCase();for(let i of e)if(i.alias.some(s=>s==t))return i;if(r)for(let i of e)for(let s of i.alias){let o=t.indexOf(s);if(o>-1&&(s.length>2||!/\w/.test(t[o-1])&&!/\w/.test(t[o+s.length])))return i}return null}}const Kse=Ut.define(),um=Ut.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function Gy(n){let e=n.facet(um);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function pg(n,e){let t="",r=n.tabSize,i=n.facet(um)[0];if(i=="	"){for(;e>=r;)t+="	",e-=r;i=" "}for(let s=0;s<e;s++)t+=i;return t}function b2(n,e){n instanceof un&&(n=new Pb(n));for(let r of n.state.facet(Kse)){let i=r(n,e);if(i!==void 0)return i}let t=dr(n.state);return t.length>=e?Jse(n,t,e):null}class Pb{constructor(e,t={}){this.state=e,this.options=t,this.unit=Gy(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:s}=this.options;return i!=null&&i>=r.from&&i<=r.to?s&&i==e?{text:"",from:e}:(t<0?i<e:i<=e)?{text:r.text.slice(i-r.from),from:i}:{text:r.text.slice(0,i-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:i}=this.lineAt(e,t);return r.slice(e-i,Math.min(r.length,e+100-i))}column(e,t=1){let{text:r,from:i}=this.lineAt(e,t),s=this.countColumn(r,e-i),o=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return o>-1&&(s+=o-this.countColumn(r,r.search(/\S|$/))),s}countColumn(e,t=e.length){return Ba(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:i}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(i);if(o>-1)return o}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const dm=new tn;function Jse(n,e,t){let r=e.resolveStack(t),i=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(i!=r.node){let s=[];for(let o=i;o&&!(o.from<r.node.from||o.to>r.node.to||o.from==r.node.from&&o.type==r.node.type);o=o.parent)s.push(o);for(let o=s.length-1;o>=0;o--)r={node:s[o],next:r}}return D6(r,n,t)}function D6(n,e,t){for(let r=n;r;r=r.next){let i=toe(r.node);if(i)return i(w2.create(e,t,r))}return 0}function eoe(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function toe(n){let e=n.type.prop(dm);if(e)return e;let t=n.firstChild,r;if(t&&(r=t.type.prop(tn.closedBy))){let i=n.lastChild,s=i&&r.indexOf(i.name)>-1;return o=>N6(o,!0,1,void 0,s&&!eoe(o)?i.from:void 0)}return n.parent==null?noe:null}function noe(){return 0}class w2 extends Pb{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new w2(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(roe(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return D6(this.context.next,this.base,this.pos)}}function roe(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function ioe(n){let e=n.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let i=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=i==null||i<=s.from?s.to:Math.min(s.to,i);for(let a=t.to;;){let l=e.childAfter(a);if(!l||l==r)return null;if(!l.type.isSkipped){if(l.from>=o)return null;let c=/^ */.exec(s.text.slice(t.to-s.from))[0].length;return{from:t.from,to:t.to+c}}a=l.to}}function soe({closing:n,align:e=!0,units:t=1}){return r=>N6(r,e,t,n)}function N6(n,e,t,r,i){let s=n.textAfter,o=s.match(/^\s*/)[0].length,a=r&&s.slice(o,o+r.length)==r||i==n.pos+o,l=e?ioe(n):null;return l?a?n.column(l.from):n.column(l.to):n.baseIndent+(a?0:n.unit*t)}const ooe=n=>n.baseIndent;function Kv({except:n,units:e=1}={}){return t=>{let r=n&&n.test(t.textAfter);return t.baseIndent+(r?0:e*t.unit)}}const aoe=200;function loe(){return un.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:r}=n.newSelection.main,i=t.lineAt(r);if(r>i.from+aoe)return n;let s=t.sliceString(i.from,r);if(!e.some(c=>c.test(s)))return n;let{state:o}=n,a=-1,l=[];for(let{head:c}of o.selection.ranges){let d=o.doc.lineAt(c);if(d.from==a)continue;a=d.from;let h=b2(o,d.from);if(h==null)continue;let f=/^\s*/.exec(d.text)[0],p=pg(o,h);f!=p&&l.push({from:d.from,to:d.from+f.length,insert:p})}return l.length?[n,{changes:l,sequential:!0}]:n})}const coe=Ut.define(),hm=new tn;function L6(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}class sf{constructor(e,t){this.specs=e;let r;function i(a){let l=wc.newName();return(r||(r=Object.create(null)))["."+l]=a,l}const s=typeof t.all=="string"?t.all:t.all?i(t.all):void 0,o=t.scope;this.scope=o instanceof uo?a=>a.prop(au)==o.data:o?a=>a==o:void 0,this.style=M6(e.map(a=>({tag:a.tag,class:a.class||i(Object.assign({},a,{tag:null}))})),{all:s}).style,this.module=r?new wc(r):null,this.themeType=t.themeType}static define(e,t){return new sf(e,t||{})}}const Ox=Ut.define(),Q6=Ut.define({combine(n){return n.length?[n[0]]:null}});function c1(n){let e=n.facet(Ox);return e.length?e:n.facet(Q6)}function _2(n,e){let t=[doe],r;return n instanceof sf&&(n.module&&t.push(gt.styleModule.of(n.module)),r=n.themeType),e?.fallback?t.push(Q6.of(n)):r?t.push(Ox.computeN([gt.darkTheme],i=>i.facet(gt.darkTheme)==(r=="dark")?[n]:[])):t.push(Ox.of(n)),t}class uoe{constructor(e){this.markCache=Object.create(null),this.tree=dr(e.state),this.decorations=this.buildDeco(e,c1(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=dr(e.state),r=c1(e.state),i=r!=c1(e.startState),{viewport:s}=e.view,o=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!i&&t.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(t!=this.tree||e.viewportChanged||i)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return hn.none;let r=new Cu;for(let{from:i,to:s}of e.visibleRanges)Zse(this.tree,t,(o,a,l)=>{r.add(o,a,this.markCache[l]||(this.markCache[l]=hn.mark({class:l})))},i,s);return r.finish()}}const doe=Wo.high(Kr.fromClass(uoe,{decorations:n=>n.decorations})),hoe=sf.define([{tag:K.meta,color:"#404740"},{tag:K.link,textDecoration:"underline"},{tag:K.heading,textDecoration:"underline",fontWeight:"bold"},{tag:K.emphasis,fontStyle:"italic"},{tag:K.strong,fontWeight:"bold"},{tag:K.strikethrough,textDecoration:"line-through"},{tag:K.keyword,color:"#708"},{tag:[K.atom,K.bool,K.url,K.contentSeparator,K.labelName],color:"#219"},{tag:[K.literal,K.inserted],color:"#164"},{tag:[K.string,K.deleted],color:"#a11"},{tag:[K.regexp,K.escape,K.special(K.string)],color:"#e40"},{tag:K.definition(K.variableName),color:"#00f"},{tag:K.local(K.variableName),color:"#30a"},{tag:[K.typeName,K.namespace],color:"#085"},{tag:K.className,color:"#167"},{tag:[K.special(K.variableName),K.macroName],color:"#256"},{tag:K.definition(K.propertyName),color:"#00c"},{tag:K.comment,color:"#940"},{tag:K.invalid,color:"#f00"}]),foe=1e4,poe="()[]{}",$6=new tn;function xx(n,e,t){let r=n.prop(e<0?tn.openedBy:tn.closedBy);if(r)return r;if(n.name.length==1){let i=t.indexOf(n.name);if(i>-1&&i%2==(e<0?1:0))return[t[i+e]]}return null}function kx(n){let e=n.type.prop($6);return e?e(n.node):n}function Vd(n,e,t,r={}){let i=r.maxScanDistance||foe,s=r.brackets||poe,o=dr(n),a=o.resolveInner(e,t);for(let l=a;l;l=l.parent){let c=xx(l.type,t,s);if(c&&l.from<l.to){let d=kx(l);if(d&&(t>0?e>=d.from&&e<d.to:e>d.from&&e<=d.to))return goe(n,e,t,l,d,c,s)}}return moe(n,e,t,o,a.type,i,s)}function goe(n,e,t,r,i,s,o){let a=r.parent,l={from:i.from,to:i.to},c=0,d=a?.cursor();if(d&&(t<0?d.childBefore(r.from):d.childAfter(r.to)))do if(t<0?d.to<=r.from:d.from>=r.to){if(c==0&&s.indexOf(d.type.name)>-1&&d.from<d.to){let h=kx(d);return{start:l,end:h?{from:h.from,to:h.to}:void 0,matched:!0}}else if(xx(d.type,t,o))c++;else if(xx(d.type,-t,o)){if(c==0){let h=kx(d);return{start:l,end:h&&h.from<h.to?{from:h.from,to:h.to}:void 0,matched:!1}}c--}}while(t<0?d.prevSibling():d.nextSibling());return{start:l,matched:!1}}function moe(n,e,t,r,i,s,o){let a=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),l=o.indexOf(a);if(l<0||l%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},d=n.doc.iterRange(e,t>0?n.doc.length:0),h=0;for(let f=0;!d.next().done&&f<=s;){let p=d.value;t<0&&(f+=p.length);let g=e+f*t;for(let m=t>0?0:p.length-1,v=t>0?p.length:-1;m!=v;m+=t){let y=o.indexOf(p[m]);if(!(y<0||r.resolveInner(g+m,1).type!=i))if(y%2==0==t>0)h++;else{if(h==1)return{start:c,end:{from:g+m,to:g+m+1},matched:y>>1==l>>1};h--}}t>0&&(f+=p.length)}return d.done?{start:c,matched:!1}:null}const voe=Object.create(null),NP=[Vr.none],LP=[],QP=Object.create(null),yoe=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])yoe[n]=boe(voe,e);function u1(n,e){LP.indexOf(n)>-1||(LP.push(n),console.warn(e))}function boe(n,e){let t=[];for(let a of e.split(" ")){let l=[];for(let c of a.split(".")){let d=n[c]||K[c];d?typeof d=="function"?l.length?l=l.map(d):u1(c,`Modifier ${c} used at start of tag`):l.length?u1(c,`Tag ${c} used as modifier`):l=Array.isArray(d)?d:[d]:u1(c,`Unknown highlighting tag ${c}`)}for(let c of l)t.push(c)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),i=r+" "+t.map(a=>a.id),s=QP[i];if(s)return s.id;let o=QP[i]=Vr.define({id:NP.length,name:r,props:[rf({[r]:t})]});return NP.push(o),o.id}pr.RTL,pr.LTR;const $P=/!\[([^\]]*)\]\((opfs:\/\/images\/([a-f0-9]{8})\.(\w+))\)/gi,Sx=en.define(),FP=new Map,d1=new Set;function F6(n,e){return`${n}.${e}`}function z6(n,e){const t=F6(n,e);let r=FP.get(t);return r||(r={shortHash:n,extension:e,blobUrl:null,isLoading:!1,error:null},FP.set(t,r)),r}async function woe(n,e,t){const r=F6(n,e);if(d1.has(r))return;const i=z6(n,e);if(!(i.blobUrl||i.error)){d1.add(r),i.isLoading=!0;try{const s=await vc.getBlobUrl(n,e);i.blobUrl=s,i.isLoading=!1,i.error=s?null:"Image not found",setTimeout(()=>{try{t.dispatch({effects:Sx.of(!0)})}catch{}},0)}catch(s){i.isLoading=!1,i.error=s instanceof Error?s.message:"Failed to load image",setTimeout(()=>{try{t.dispatch({effects:Sx.of(!0)})}catch{}},0)}finally{d1.delete(r)}}}function _oe(n){const e=[];$P.lastIndex=0;let t;for(;(t=$P.exec(n))!==null;)e.push({from:t.index,to:t.index+t[0].length,altText:t[1],url:t[2],shortHash:t[3].toLowerCase(),extension:t[4].toLowerCase()});return e}function Ooe(n,e){const t=dr(n);let r=!1;return t.iterate({from:e,to:e,enter:i=>{const s=i.name;if(s==="InlineCode"||s==="CodeBlock"||s==="FencedCode"||s==="CodeText"||s==="CodeInfo"||s==="CodeMark")return r=!0,!1}}),r}class xoe extends Yo{constructor(e,t,r,i,s,o,a,l,c,d){super(),this.shortHash=e,this.extension=t,this.altText=r,this.blobUrl=i,this.isLoading=s,this.error=o,this.view=a,this.from=l,this.to=c,this.vaultBasePath=d}toDOM(){const e=document.createElement("div");if(e.className="cm-image-widget",this.isLoading){e.classList.add("cm-image-loading");const t=document.createElement("span");t.className="cm-image-placeholder",t.textContent="Loading...",e.appendChild(t)}else if(this.error){e.classList.add("cm-image-error");const t=document.createElement("span");t.className="cm-image-error-text",t.textContent=`[Image: ${this.error}]`,e.appendChild(t)}else if(this.blobUrl){const t=document.createElement("img");t.src=this.blobUrl,t.alt=this.altText||"",t.className="cm-inline-image",t.draggable=!1,t.onerror=()=>{t.style.display="none";const o=document.createElement("span");o.className="cm-image-error-text",o.textContent="[Image failed to load]",e.appendChild(o)},e.appendChild(t);const r=document.createElement("div");r.className="cm-image-controls";const i=document.createElement("input");i.type="text",i.className="cm-image-alt-input",i.placeholder="Alt text...",i.value=this.altText;const s=()=>{const o=i.value;if(o!==this.altText){const a=`![${o}](opfs://images/${this.shortHash}.${this.extension})`;try{this.view.dispatch({changes:{from:this.from,to:this.to,insert:a}})}catch{}}};if(i.addEventListener("blur",s),i.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),i.blur()),o.stopPropagation()}),i.addEventListener("input",o=>o.stopPropagation()),r.appendChild(i),this.vaultBasePath){const o=`files/images/${this.shortHash}.${this.extension}`,a=`${this.vaultBasePath}/${o}`,l=document.createElement("a");l.className="cm-image-file-link",l.href="#",l.textContent=o,l.title=`Open in Finder: ${a}`,l.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),window.api?.showItemInFolder({path:a})}),r.appendChild(l)}e.appendChild(r)}else{e.classList.add("cm-image-missing");const t=document.createElement("span");t.className="cm-image-missing-text",t.textContent=`[Image not found: ${this.shortHash}.${this.extension}]`,e.appendChild(t)}return e}eq(e){return this.shortHash===e.shortHash&&this.extension===e.extension&&this.altText===e.altText&&this.blobUrl===e.blobUrl&&this.isLoading===e.isLoading&&this.error===e.error&&this.from===e.from&&this.to===e.to&&this.vaultBasePath===e.vaultBasePath}ignoreEvent(e){return!(e.type==="input"||e.type==="click"||e.type==="keydown"||e.type==="keyup"||e.type==="focus"||e.type==="blur")}}function h1(n,e){const t=[],r=n.doc.toString(),i=_oe(r),o=bl()?.baseDirectory;for(const a of i){if(Ooe(n,a.from))continue;const l=z6(a.shortHash,a.extension);!l.blobUrl&&!l.isLoading&&!l.error&&woe(a.shortHash,a.extension,e);const c=new xoe(a.shortHash,a.extension,a.altText,l.blobUrl,l.isLoading,l.error,e,a.from,a.to,o);t.push(hn.replace({widget:c,inclusive:!1,block:!0}).range(a.from,a.to))}return $n.of(t.sort((a,l)=>a.from-l.from))}function koe(n){return Cr.define({create:e=>h1(e,n),update:(e,t)=>{for(const r of t.effects)if(r.is(Sx))return h1(t.state,n);return t.docChanged?h1(t.state,n):e},provide:e=>gt.decorations.from(e)})}function Soe(){return gt.domEventHandlers({drop:(n,e)=>{if(!n.dataTransfer)return!1;const t=xE(n.dataTransfer);if(t.length===0)return!1;n.preventDefault();const r=e.posAtCoords({x:n.clientX,y:n.clientY});return r===null||(async()=>{for(const i of t)try{const s=await OE(i);e.dispatch({changes:{from:r,to:r,insert:s.markdownSyntax+`
`}})}catch(s){console.error("[Image Extension] Failed to import dropped image:",s)}})(),!0},paste:(n,e)=>{if(!n.clipboardData||!ere(n.clipboardData))return!1;const t=xE(n.clipboardData);if(t.length===0)return!1;n.preventDefault();const r=e.state.selection.main.head;return(async()=>{try{const i=await OE(t[0]);e.dispatch({changes:{from:r,to:r,insert:i.markdownSyntax},selection:{anchor:r+i.markdownSyntax.length}})}catch(i){console.error("[Image Extension] Failed to import pasted image:",i)}})(),!0}})}const Toe=gt.baseTheme({".cm-image-widget":{display:"block",margin:"8px 0"},".cm-inline-image":{maxWidth:"100%",maxHeight:"400px",objectFit:"contain",borderRadius:"4px",display:"block"},".cm-image-controls":{display:"flex",alignItems:"center",gap:"8px",marginTop:"4px",padding:"4px 0",fontSize:"12px",width:"100%"},".cm-image-alt-input":{flex:"1 1 auto",minWidth:"100px",padding:"4px 8px",border:"1px solid var(--border-color, #ddd)",borderRadius:"4px",fontSize:"12px",backgroundColor:"var(--bg-primary, #fff)",color:"var(--text-primary, #333)",outline:"none","&:focus":{borderColor:"var(--accent-color, #007bff)",boxShadow:"0 0 0 2px var(--accent-color-subtle, rgba(0,123,255,0.25))"},"&::placeholder":{color:"var(--text-tertiary, #999)"}},".cm-image-file-link":{color:"var(--text-secondary, #666)",textDecoration:"none",fontFamily:"monospace",fontSize:"11px",padding:"2px 6px",borderRadius:"3px",backgroundColor:"var(--bg-secondary, #f5f5f5)","&:hover":{color:"var(--accent-color, #007bff)",backgroundColor:"var(--bg-tertiary, #eee)",textDecoration:"underline"}},".cm-image-loading, .cm-image-error, .cm-image-missing":{display:"inline-block",padding:"8px 12px",borderRadius:"4px",fontSize:"12px"},".cm-image-loading":{backgroundColor:"var(--bg-secondary, #f0f0f0)",color:"var(--text-secondary, #666)"},".cm-image-error, .cm-image-missing":{backgroundColor:"var(--bg-error-subtle, #fee)",color:"var(--text-error, #c00)"},".cm-image-placeholder":{fontStyle:"italic"}});function Aoe(){return[Toe,Soe(),Kr.fromClass(class{constructor(n){setTimeout(()=>{try{const e=koe(n);n.state.field(e,!1)||n.dispatch({effects:en.appendConfig.of(e)})}catch{}},0)}})]}const Coe=n=>{let{state:e}=n,t=e.doc.lineAt(e.selection.main.from),r=x2(n.state,t.from);return r.line?Eoe(n):r.block?Ioe(n):!1};function O2(n,e){return({state:t,dispatch:r})=>{if(t.readOnly)return!1;let i=n(e,t);return i?(r(t.update(i)),!0):!1}}const Eoe=O2(Doe,0),Poe=O2(B6,0),Ioe=O2((n,e)=>B6(n,e,Roe(e)),0);function x2(n,e){let t=n.languageDataAt("commentTokens",e,1);return t.length?t[0]:{}}const If=50;function Moe(n,{open:e,close:t},r,i){let s=n.sliceDoc(r-If,r),o=n.sliceDoc(i,i+If),a=/\s*$/.exec(s)[0].length,l=/^\s*/.exec(o)[0].length,c=s.length-a;if(s.slice(c-e.length,c)==e&&o.slice(l,l+t.length)==t)return{open:{pos:r-a,margin:a&&1},close:{pos:i+l,margin:l&&1}};let d,h;i-r<=2*If?d=h=n.sliceDoc(r,i):(d=n.sliceDoc(r,r+If),h=n.sliceDoc(i-If,i));let f=/^\s*/.exec(d)[0].length,p=/\s*$/.exec(h)[0].length,g=h.length-p-t.length;return d.slice(f,f+e.length)==e&&h.slice(g,g+t.length)==t?{open:{pos:r+f+e.length,margin:/\s/.test(d.charAt(f+e.length))?1:0},close:{pos:i-p-t.length,margin:/\s/.test(h.charAt(g-1))?1:0}}:null}function Roe(n){let e=[];for(let t of n.selection.ranges){let r=n.doc.lineAt(t.from),i=t.to<=r.to?r:n.doc.lineAt(t.to);i.from>r.from&&i.from==t.to&&(i=t.to==r.to+1?r:n.doc.lineAt(t.to-1));let s=e.length-1;s>=0&&e[s].to>r.from?e[s].to=i.to:e.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:i.to})}return e}function B6(n,e,t=e.selection.ranges){let r=t.map(s=>x2(e,s.from).block);if(!r.every(s=>s))return null;let i=t.map((s,o)=>Moe(e,r[o],s.from,s.to));if(n!=2&&!i.every(s=>s))return{changes:e.changes(t.map((s,o)=>i[o]?[]:[{from:s.from,insert:r[o].open+" "},{from:s.to,insert:" "+r[o].close}]))};if(n!=1&&i.some(s=>s)){let s=[];for(let o=0,a;o<i.length;o++)if(a=i[o]){let l=r[o],{open:c,close:d}=a;s.push({from:c.pos-l.open.length,to:c.pos+c.margin},{from:d.pos-d.margin,to:d.pos+l.close.length})}return{changes:s}}return null}function Doe(n,e,t=e.selection.ranges){let r=[],i=-1;for(let{from:s,to:o}of t){let a=r.length,l=1e9,c=x2(e,s).line;if(c){for(let d=s;d<=o;){let h=e.doc.lineAt(d);if(h.from>i&&(s==o||o>h.from)){i=h.from;let f=/^\s*/.exec(h.text)[0].length,p=f==h.length,g=h.text.slice(f,f+c.length)==c?f:-1;f<h.text.length&&f<l&&(l=f),r.push({line:h,comment:g,token:c,indent:f,empty:p,single:!1})}d=h.to+1}if(l<1e9)for(let d=a;d<r.length;d++)r[d].indent<r[d].line.text.length&&(r[d].indent=l);r.length==a+1&&(r[a].single=!0)}}if(n!=2&&r.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:a,token:l,indent:c,empty:d,single:h}of r)(h||!d)&&s.push({from:a.from+c,insert:l+" "});let o=e.changes(s);return{changes:o,selection:e.selection.map(o,1)}}else if(n!=1&&r.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:a,token:l}of r)if(a>=0){let c=o.from+a,d=c+l.length;o.text[d-o.from]==" "&&d++,s.push({from:c,to:d})}return{changes:s}}return null}const Tx=Xo.define(),Noe=Xo.define(),Loe=Ut.define(),U6=Ut.define({combine(n){return rm(n,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(r,i)=>e(r,i)||t(r,i)})}}),j6=Cr.define({create(){return Pa.empty},update(n,e){let t=e.state.facet(U6),r=e.annotation(Tx);if(r){let l=ss.fromTransaction(e,r.selection),c=r.side,d=c==0?n.undone:n.done;return l?d=Ky(d,d.length,t.minDepth,l):d=H6(d,e.startState.selection),new Pa(c==0?r.rest:d,c==0?d:r.rest)}let i=e.annotation(Noe);if((i=="full"||i=="before")&&(n=n.isolate()),e.annotation(Nr.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let s=ss.fromTransaction(e),o=e.annotation(Nr.time),a=e.annotation(Nr.userEvent);return s?n=n.addChanges(s,o,a,t,e):e.selection&&(n=n.addSelection(e.startState.selection,o,a,t.newGroupDelay)),(i=="full"||i=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new Pa(n.done.map(ss.fromJSON),n.undone.map(ss.fromJSON))}});function k2(n={}){return[j6,U6.of(n),gt.domEventHandlers({beforeinput(e,t){let r=e.inputType=="historyUndo"?V6:e.inputType=="historyRedo"?Ax:null;return r?(e.preventDefault(),r(t)):!1}})]}function Ib(n,e){return function({state:t,dispatch:r}){if(!e&&t.readOnly)return!1;let i=t.field(j6,!1);if(!i)return!1;let s=i.pop(n,t,e);return s?(r(s),!0):!1}}const V6=Ib(0,!1),Ax=Ib(1,!1),Qoe=Ib(0,!0),$oe=Ib(1,!0);class ss{constructor(e,t,r,i,s){this.changes=e,this.effects=t,this.mapped=r,this.startSelection=i,this.selectionsAfter=s}setSelAfter(e){return new ss(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(i=>i.toJSON())}}static fromJSON(e){return new ss(e.changes&&Mr.fromJSON(e.changes),[],e.mapped&&Ra.fromJSON(e.mapped),e.startSelection&&rt.fromJSON(e.startSelection),e.selectionsAfter.map(rt.fromJSON))}static fromTransaction(e,t){let r=ho;for(let i of e.startState.facet(Loe)){let s=i(e);s.length&&(r=r.concat(s))}return!r.length&&e.changes.empty?null:new ss(e.changes.invert(e.startState.doc),r,void 0,t||e.startState.selection,ho)}static selection(e){return new ss(void 0,ho,void 0,void 0,e)}}function Ky(n,e,t,r){let i=e+1>t+20?e-t-1:0,s=n.slice(i,e);return s.push(r),s}function Foe(n,e){let t=[],r=!1;return n.iterChangedRanges((i,s)=>t.push(i,s)),e.iterChangedRanges((i,s,o,a)=>{for(let l=0;l<t.length;){let c=t[l++],d=t[l++];a>=c&&o<=d&&(r=!0)}}),r}function zoe(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((t,r)=>t.empty!=e.ranges[r].empty).length===0}function q6(n,e){return n.length?e.length?n.concat(e):n:e}const ho=[],Boe=200;function H6(n,e){if(n.length){let t=n[n.length-1],r=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-Boe));return r.length&&r[r.length-1].eq(e)?n:(r.push(e),Ky(n,n.length-1,1e9,t.setSelAfter(r)))}else return[ss.selection([e])]}function Uoe(n){let e=n[n.length-1],t=n.slice();return t[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function f1(n,e){if(!n.length)return n;let t=n.length,r=ho;for(;t;){let i=joe(n[t-1],e,r);if(i.changes&&!i.changes.empty||i.effects.length){let s=n.slice(0,t);return s[t-1]=i,s}else e=i.mapped,t--,r=i.selectionsAfter}return r.length?[ss.selection(r)]:ho}function joe(n,e,t){let r=q6(n.selectionsAfter.length?n.selectionsAfter.map(a=>a.map(e)):ho,t);if(!n.changes)return ss.selection(r);let i=n.changes.map(e),s=e.mapDesc(n.changes,!0),o=n.mapped?n.mapped.composeDesc(s):s;return new ss(i,en.mapEffects(n.effects,e),o,n.startSelection.map(s),r)}const Voe=/^(input\.type|delete)($|\.)/;class Pa{constructor(e,t,r=0,i=void 0){this.done=e,this.undone=t,this.prevTime=r,this.prevUserEvent=i}isolate(){return this.prevTime?new Pa(this.done,this.undone):this}addChanges(e,t,r,i,s){let o=this.done,a=o[o.length-1];return a&&a.changes&&!a.changes.empty&&e.changes&&(!r||Voe.test(r))&&(!a.selectionsAfter.length&&t-this.prevTime<i.newGroupDelay&&i.joinToEvent(s,Foe(a.changes,e.changes))||r=="input.type.compose")?o=Ky(o,o.length-1,i.minDepth,new ss(e.changes.compose(a.changes),q6(en.mapEffects(e.effects,a.changes),a.effects),a.mapped,a.startSelection,ho)):o=Ky(o,o.length,i.minDepth,e),new Pa(o,ho,t,r)}addSelection(e,t,r,i){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:ho;return s.length>0&&t-this.prevTime<i&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&zoe(s[s.length-1],e)?this:new Pa(H6(this.done,e),this.undone,t,r)}addMapping(e){return new Pa(f1(this.done,e),f1(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,r){let i=e==0?this.done:this.undone;if(i.length==0)return null;let s=i[i.length-1],o=s.selectionsAfter[0]||t.selection;if(r&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Tx.of({side:e,rest:Uoe(i),selection:o}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let a=i.length==1?ho:i.slice(0,i.length-1);return s.mapped&&(a=f1(a,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Tx.of({side:e,rest:a,selection:o}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}Pa.empty=new Pa(ho,ho);const S2=[{key:"Mod-z",run:V6,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Ax,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Ax,preventDefault:!0},{key:"Mod-u",run:Qoe,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:$oe,preventDefault:!0}];function of(n,e){return rt.create(n.ranges.map(e),n.mainIndex)}function Go(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Ko({state:n,dispatch:e},t){let r=of(n.selection,t);return r.eq(n.selection,!0)?!1:(e(Go(n,r)),!0)}function Mb(n,e){return rt.cursor(e?n.to:n.from)}function Z6(n,e){return Ko(n,t=>t.empty?n.moveByChar(t,e):Mb(t,e))}function Ai(n){return n.textDirectionAt(n.state.selection.main.head)==pr.LTR}const W6=n=>Z6(n,!Ai(n)),X6=n=>Z6(n,Ai(n));function Y6(n,e){return Ko(n,t=>t.empty?n.moveByGroup(t,e):Mb(t,e))}const qoe=n=>Y6(n,!Ai(n)),Hoe=n=>Y6(n,Ai(n));function Zoe(n,e,t){if(e.type.prop(t))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function Rb(n,e,t){let r=dr(n).resolveInner(e.head),i=t?tn.closedBy:tn.openedBy;for(let l=e.head;;){let c=t?r.childAfter(l):r.childBefore(l);if(!c)break;Zoe(n,c,i)?r=c:l=t?c.to:c.from}let s=r.type.prop(i),o,a;return s&&(o=t?Vd(n,r.from,1):Vd(n,r.to,-1))&&o.matched?a=t?o.end.to:o.end.from:a=t?r.to:r.from,rt.cursor(a,t?-1:1)}const Woe=n=>Ko(n,e=>Rb(n.state,e,!Ai(n))),Xoe=n=>Ko(n,e=>Rb(n.state,e,Ai(n)));function G6(n,e){return Ko(n,t=>{if(!t.empty)return Mb(t,e);let r=n.moveVertically(t,e);return r.head!=t.head?r:n.moveToLineBoundary(t,e)})}const K6=n=>G6(n,!1),J6=n=>G6(n,!0);function eF(n){let e=n.scrollDOM.clientHeight<n.scrollDOM.scrollHeight-2,t=0,r=0,i;if(e){for(let s of n.state.facet(gt.scrollMargins)){let o=s(n);o?.top&&(t=Math.max(o?.top,t)),o?.bottom&&(r=Math.max(o?.bottom,r))}i=n.scrollDOM.clientHeight-t-r}else i=(n.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:r,selfScroll:e,height:Math.max(n.defaultLineHeight,i-5)}}function tF(n,e){let t=eF(n),{state:r}=n,i=of(r.selection,o=>o.empty?n.moveVertically(o,e,t.height):Mb(o,e));if(i.eq(r.selection))return!1;let s;if(t.selfScroll){let o=n.coordsAtPos(r.selection.main.head),a=n.scrollDOM.getBoundingClientRect(),l=a.top+t.marginTop,c=a.bottom-t.marginBottom;o&&o.top>l&&o.bottom<c&&(s=gt.scrollIntoView(i.main.head,{y:"start",yMargin:o.top-l}))}return n.dispatch(Go(r,i),{effects:s}),!0}const zP=n=>tF(n,!1),Cx=n=>tF(n,!0);function Pc(n,e,t){let r=n.lineBlockAt(e.head),i=n.moveToLineBoundary(e,t);if(i.head==e.head&&i.head!=(t?r.to:r.from)&&(i=n.moveToLineBoundary(e,t,!1)),!t&&i.head==r.from&&r.length){let s=/^\s*/.exec(n.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;s&&e.head!=r.from+s&&(i=rt.cursor(r.from+s))}return i}const Yoe=n=>Ko(n,e=>Pc(n,e,!0)),Goe=n=>Ko(n,e=>Pc(n,e,!1)),Koe=n=>Ko(n,e=>Pc(n,e,!Ai(n))),Joe=n=>Ko(n,e=>Pc(n,e,Ai(n))),eae=n=>Ko(n,e=>rt.cursor(n.lineBlockAt(e.head).from,1)),tae=n=>Ko(n,e=>rt.cursor(n.lineBlockAt(e.head).to,-1));function nae(n,e,t){let r=!1,i=of(n.selection,s=>{let o=Vd(n,s.head,-1)||Vd(n,s.head,1)||s.head>0&&Vd(n,s.head-1,1)||s.head<n.doc.length&&Vd(n,s.head+1,-1);if(!o||!o.end)return s;r=!0;let a=o.start.from==s.head?o.end.to:o.end.from;return rt.cursor(a)});return r?(e(Go(n,i)),!0):!1}const rae=({state:n,dispatch:e})=>nae(n,e);function xo(n,e){let t=of(n.state.selection,r=>{let i=e(r);return rt.range(r.anchor,i.head,i.goalColumn,i.bidiLevel||void 0)});return t.eq(n.state.selection)?!1:(n.dispatch(Go(n.state,t)),!0)}function nF(n,e){return xo(n,t=>n.moveByChar(t,e))}const rF=n=>nF(n,!Ai(n)),iF=n=>nF(n,Ai(n));function sF(n,e){return xo(n,t=>n.moveByGroup(t,e))}const iae=n=>sF(n,!Ai(n)),sae=n=>sF(n,Ai(n)),oae=n=>xo(n,e=>Rb(n.state,e,!Ai(n))),aae=n=>xo(n,e=>Rb(n.state,e,Ai(n)));function oF(n,e){return xo(n,t=>n.moveVertically(t,e))}const aF=n=>oF(n,!1),lF=n=>oF(n,!0);function cF(n,e){return xo(n,t=>n.moveVertically(t,e,eF(n).height))}const BP=n=>cF(n,!1),UP=n=>cF(n,!0),lae=n=>xo(n,e=>Pc(n,e,!0)),cae=n=>xo(n,e=>Pc(n,e,!1)),uae=n=>xo(n,e=>Pc(n,e,!Ai(n))),dae=n=>xo(n,e=>Pc(n,e,Ai(n))),hae=n=>xo(n,e=>rt.cursor(n.lineBlockAt(e.head).from)),fae=n=>xo(n,e=>rt.cursor(n.lineBlockAt(e.head).to)),jP=({state:n,dispatch:e})=>(e(Go(n,{anchor:0})),!0),VP=({state:n,dispatch:e})=>(e(Go(n,{anchor:n.doc.length})),!0),qP=({state:n,dispatch:e})=>(e(Go(n,{anchor:n.selection.main.anchor,head:0})),!0),HP=({state:n,dispatch:e})=>(e(Go(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),pae=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),gae=({state:n,dispatch:e})=>{let t=Db(n).map(({from:r,to:i})=>rt.range(r,Math.min(i+1,n.doc.length)));return e(n.update({selection:rt.create(t),userEvent:"select"})),!0},mae=({state:n,dispatch:e})=>{let t=of(n.selection,r=>{let i=dr(n),s=i.resolveStack(r.from,1);if(r.empty){let o=i.resolveStack(r.from,-1);o.node.from>=s.node.from&&o.node.to<=s.node.to&&(s=o)}for(let o=s;o;o=o.next){let{node:a}=o;if((a.from<r.from&&a.to>=r.to||a.to>r.to&&a.from<=r.from)&&o.next)return rt.range(a.to,a.from)}return r});return t.eq(n.selection)?!1:(e(Go(n,t)),!0)};function uF(n,e){let{state:t}=n,r=t.selection,i=t.selection.ranges.slice();for(let s of t.selection.ranges){let o=t.doc.lineAt(s.head);if(e?o.to<n.state.doc.length:o.from>0)for(let a=s;;){let l=n.moveVertically(a,e);if(l.head<o.from||l.head>o.to){i.some(c=>c.head==l.head)||i.push(l);break}else{if(l.head==a.head)break;a=l}}}return i.length==r.ranges.length?!1:(n.dispatch(Go(t,rt.create(i,i.length-1))),!0)}const vae=n=>uF(n,!1),yae=n=>uF(n,!0),bae=({state:n,dispatch:e})=>{let t=n.selection,r=null;return t.ranges.length>1?r=rt.create([t.main]):t.main.empty||(r=rt.create([rt.cursor(t.main.head)])),r?(e(Go(n,r)),!0):!1};function fm(n,e){if(n.state.readOnly)return!1;let t="delete.selection",{state:r}=n,i=r.changeByRange(s=>{let{from:o,to:a}=s;if(o==a){let l=e(s);l<o?(t="delete.backward",l=gv(n,l,!1)):l>o&&(t="delete.forward",l=gv(n,l,!0)),o=Math.min(o,l),a=Math.max(a,l)}else o=gv(n,o,!1),a=gv(n,a,!0);return o==a?{range:s}:{changes:{from:o,to:a},range:rt.cursor(o,o<s.head?-1:1)}});return i.changes.empty?!1:(n.dispatch(r.update(i,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?gt.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function gv(n,e,t){if(n instanceof gt)for(let r of n.state.facet(gt.atomicRanges).map(i=>i(n)))r.between(e,e,(i,s)=>{i<e&&s>e&&(e=t?s:i)});return e}const dF=(n,e,t)=>fm(n,r=>{let i=r.from,{state:s}=n,o=s.doc.lineAt(i),a,l;if(t&&!e&&i>o.from&&i<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,i-o.from))){if(a[a.length-1]=="	")return i-1;let c=Ba(a,s.tabSize),d=c%Gy(s)||Gy(s);for(let h=0;h<d&&a[a.length-1-h]==" ";h++)i--;l=i}else l=ci(o.text,i-o.from,e,e)+o.from,l==i&&o.number!=(e?s.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(o.text.slice(l-o.from,i-o.from))&&(l=ci(o.text,l-o.from,!1,!1)+o.from);return l}),Ex=n=>dF(n,!1,!0),hF=n=>dF(n,!0,!1),fF=(n,e)=>fm(n,t=>{let r=t.head,{state:i}=n,s=i.doc.lineAt(r),o=i.charCategorizer(r);for(let a=null;;){if(r==(e?s.to:s.from)){r==t.head&&s.number!=(e?i.doc.lines:1)&&(r+=e?1:-1);break}let l=ci(s.text,r-s.from,e)+s.from,c=s.text.slice(Math.min(r,l)-s.from,Math.max(r,l)-s.from),d=o(c);if(a!=null&&d!=a)break;(c!=" "||r!=t.head)&&(a=d),r=l}return r}),pF=n=>fF(n,!1),wae=n=>fF(n,!0),_ae=n=>fm(n,e=>{let t=n.lineBlockAt(e.head).to;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),Oae=n=>fm(n,e=>{let t=n.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),xae=n=>fm(n,e=>{let t=n.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),kae=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:In.of(["",""])},range:rt.cursor(r.from)}));return e(n.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},Sae=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(r=>{if(!r.empty||r.from==0||r.from==n.doc.length)return{range:r};let i=r.from,s=n.doc.lineAt(i),o=i==s.from?i-1:ci(s.text,i-s.from,!1)+s.from,a=i==s.to?i+1:ci(s.text,i-s.from,!0)+s.from;return{changes:{from:o,to:a,insert:n.doc.slice(i,a).append(n.doc.slice(o,i))},range:rt.cursor(a)}});return t.changes.empty?!1:(e(n.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Db(n){let e=[],t=-1;for(let r of n.selection.ranges){let i=n.doc.lineAt(r.from),s=n.doc.lineAt(r.to);if(!r.empty&&r.to==s.from&&(s=n.doc.lineAt(r.to-1)),t>=i.number){let o=e[e.length-1];o.to=s.to,o.ranges.push(r)}else e.push({from:i.from,to:s.to,ranges:[r]});t=s.number+1}return e}function gF(n,e,t){if(n.readOnly)return!1;let r=[],i=[];for(let s of Db(n)){if(t?s.to==n.doc.length:s.from==0)continue;let o=n.doc.lineAt(t?s.to+1:s.from-1),a=o.length+1;if(t){r.push({from:s.to,to:o.to},{from:s.from,insert:o.text+n.lineBreak});for(let l of s.ranges)i.push(rt.range(Math.min(n.doc.length,l.anchor+a),Math.min(n.doc.length,l.head+a)))}else{r.push({from:o.from,to:s.from},{from:s.to,insert:n.lineBreak+o.text});for(let l of s.ranges)i.push(rt.range(l.anchor-a,l.head-a))}}return r.length?(e(n.update({changes:r,scrollIntoView:!0,selection:rt.create(i,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Tae=({state:n,dispatch:e})=>gF(n,e,!1),Aae=({state:n,dispatch:e})=>gF(n,e,!0);function mF(n,e,t){if(n.readOnly)return!1;let r=[];for(let i of Db(n))t?r.push({from:i.from,insert:n.doc.slice(i.from,i.to)+n.lineBreak}):r.push({from:i.to,insert:n.lineBreak+n.doc.slice(i.from,i.to)});return e(n.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const Cae=({state:n,dispatch:e})=>mF(n,e,!1),Eae=({state:n,dispatch:e})=>mF(n,e,!0),Pae=n=>{if(n.state.readOnly)return!1;let{state:e}=n,t=e.changes(Db(e).map(({from:i,to:s})=>(i>0?i--:s<e.doc.length&&s++,{from:i,to:s}))),r=of(e.selection,i=>{let s;if(n.lineWrapping){let o=n.lineBlockAt(i.head),a=n.coordsAtPos(i.head,i.assoc||1);a&&(s=o.bottom+n.documentTop-a.bottom+n.defaultLineHeight/2)}return n.moveVertically(i,!0,s)}).map(t);return n.dispatch({changes:t,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Iae(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=dr(n).resolveInner(e),r=t.childBefore(e),i=t.childAfter(e),s;return r&&i&&r.to<=e&&i.from>=e&&(s=r.type.prop(tn.closedBy))&&s.indexOf(i.name)>-1&&n.doc.lineAt(r.to).from==n.doc.lineAt(i.from).from&&!/\S/.test(n.sliceDoc(r.to,i.from))?{from:r.to,to:i.from}:null}const ZP=vF(!1),Mae=vF(!0);function vF(n){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=e.changeByRange(i=>{let{from:s,to:o}=i,a=e.doc.lineAt(s),l=!n&&s==o&&Iae(e,s);n&&(s=o=(o<=a.to?a:e.doc.lineAt(o)).to);let c=new Pb(e,{simulateBreak:s,simulateDoubleBreak:!!l}),d=b2(c,s);for(d==null&&(d=Ba(/^\s*/.exec(e.doc.lineAt(s).text)[0],e.tabSize));o<a.to&&/\s/.test(a.text[o-a.from]);)o++;l?{from:s,to:o}=l:s>a.from&&s<a.from+100&&!/\S/.test(a.text.slice(0,s))&&(s=a.from);let h=["",pg(e,d)];return l&&h.push(pg(e,c.lineIndent(a.from,-1))),{changes:{from:s,to:o,insert:In.of(h)},range:rt.cursor(s+1+h[1].length)}});return t(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function T2(n,e){let t=-1;return n.changeByRange(r=>{let i=[];for(let o=r.from;o<=r.to;){let a=n.doc.lineAt(o);a.number>t&&(r.empty||r.to>a.from)&&(e(a,i,r),t=a.number),o=a.to+1}let s=n.changes(i);return{changes:i,range:rt.range(s.mapPos(r.anchor,1),s.mapPos(r.head,1))}})}const Rae=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=Object.create(null),r=new Pb(n,{overrideIndentation:s=>{let o=t[s];return o??-1}}),i=T2(n,(s,o,a)=>{let l=b2(r,s.from);if(l==null)return;/\S/.test(s.text)||(l=0);let c=/^\s*/.exec(s.text)[0],d=pg(n,l);(c!=d||a.from<s.from+c.length)&&(t[s.from]=l,o.push({from:s.from,to:s.from+c.length,insert:d}))});return i.changes.empty||e(n.update(i,{userEvent:"indent"})),!0},yF=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(T2(n,(t,r)=>{r.push({from:t.from,insert:n.facet(um)})}),{userEvent:"input.indent"})),!0),bF=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(T2(n,(t,r)=>{let i=/^\s*/.exec(t.text)[0];if(!i)return;let s=Ba(i,n.tabSize),o=0,a=pg(n,Math.max(0,s-Gy(n)));for(;o<i.length&&o<a.length&&i.charCodeAt(o)==a.charCodeAt(o);)o++;r.push({from:t.from+o,to:t.from+i.length,insert:a.slice(o)})}),{userEvent:"delete.dedent"})),!0),Dae=n=>(n.setTabFocusMode(),!0),Nae=[{key:"Ctrl-b",run:W6,shift:rF,preventDefault:!0},{key:"Ctrl-f",run:X6,shift:iF},{key:"Ctrl-p",run:K6,shift:aF},{key:"Ctrl-n",run:J6,shift:lF},{key:"Ctrl-a",run:eae,shift:hae},{key:"Ctrl-e",run:tae,shift:fae},{key:"Ctrl-d",run:hF},{key:"Ctrl-h",run:Ex},{key:"Ctrl-k",run:_ae},{key:"Ctrl-Alt-h",run:pF},{key:"Ctrl-o",run:kae},{key:"Ctrl-t",run:Sae},{key:"Ctrl-v",run:Cx}],Lae=[{key:"ArrowLeft",run:W6,shift:rF,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:qoe,shift:iae,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:Koe,shift:uae,preventDefault:!0},{key:"ArrowRight",run:X6,shift:iF,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Hoe,shift:sae,preventDefault:!0},{mac:"Cmd-ArrowRight",run:Joe,shift:dae,preventDefault:!0},{key:"ArrowUp",run:K6,shift:aF,preventDefault:!0},{mac:"Cmd-ArrowUp",run:jP,shift:qP},{mac:"Ctrl-ArrowUp",run:zP,shift:BP},{key:"ArrowDown",run:J6,shift:lF,preventDefault:!0},{mac:"Cmd-ArrowDown",run:VP,shift:HP},{mac:"Ctrl-ArrowDown",run:Cx,shift:UP},{key:"PageUp",run:zP,shift:BP},{key:"PageDown",run:Cx,shift:UP},{key:"Home",run:Goe,shift:cae,preventDefault:!0},{key:"Mod-Home",run:jP,shift:qP},{key:"End",run:Yoe,shift:lae,preventDefault:!0},{key:"Mod-End",run:VP,shift:HP},{key:"Enter",run:ZP,shift:ZP},{key:"Mod-a",run:pae},{key:"Backspace",run:Ex,shift:Ex,preventDefault:!0},{key:"Delete",run:hF,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:pF,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:wae,preventDefault:!0},{mac:"Mod-Backspace",run:Oae,preventDefault:!0},{mac:"Mod-Delete",run:xae,preventDefault:!0}].concat(Nae.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),A2=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Woe,shift:oae},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Xoe,shift:aae},{key:"Alt-ArrowUp",run:Tae},{key:"Shift-Alt-ArrowUp",run:Cae},{key:"Alt-ArrowDown",run:Aae},{key:"Shift-Alt-ArrowDown",run:Eae},{key:"Mod-Alt-ArrowUp",run:vae},{key:"Mod-Alt-ArrowDown",run:yae},{key:"Escape",run:bae},{key:"Mod-Enter",run:Mae},{key:"Alt-l",mac:"Ctrl-l",run:gae},{key:"Mod-i",run:mae,preventDefault:!0},{key:"Mod-[",run:bF},{key:"Mod-]",run:yF},{key:"Mod-Alt-\\",run:Rae},{key:"Shift-Mod-k",run:Pae},{key:"Shift-Mod-\\",run:rae},{key:"Mod-/",run:Coe},{key:"Alt-A",run:Poe},{key:"Ctrl-m",mac:"Shift-Alt-m",run:Dae}].concat(Lae),Qae={key:"Tab",run:yF,shift:bF},WP=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class gg{constructor(e,t,r=0,i=e.length,s,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,i),this.bufferStart=r,this.normalize=s?a=>s(WP(a)):WP,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return al(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=n$(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=Yc(e);let i=this.normalize(t);if(i.length)for(let s=0,o=r;;s++){let a=i.charCodeAt(s),l=this.match(a,o,this.bufferPos+this.bufferStart);if(s==i.length-1){if(l)return this.value=l,this;break}o==r&&s<t.length&&t.charCodeAt(s)==a&&o++}}}match(e,t,r){let i=null;for(let s=0;s<this.matches.length;s+=2){let o=this.matches[s],a=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?i={from:this.matches[s+1],to:r}:(this.matches[s]++,a=!0)),a||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?i={from:t,to:r}:this.matches.push(1,t)),i&&this.test&&!this.test(i.from,i.to,this.buffer,this.bufferStart)&&(i=null),i}}typeof Symbol<"u"&&(gg.prototype[Symbol.iterator]=function(){return this});const wF={from:-1,to:-1,match:/.*/.exec("")},C2="gm"+(/x/.unicode==null?"":"u");class _F{constructor(e,t,r,i=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=wF,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new OF(e,t,r,i,s);this.re=new RegExp(t,C2+(r?.ignoreCase?"i":"")),this.test=r?.test,this.iter=e.iter();let o=e.lineAt(i);this.curLineStart=o.from,this.matchPos=Jy(e,i),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let r=this.curLineStart+t.index,i=r+t[0].length;if(this.matchPos=Jy(this.text,i+(r==i?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<i||r>this.value.to)&&(!this.test||this.test(r,i,t)))return this.value={from:r,to:i,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const p1=new WeakMap;class lh{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,r){let i=p1.get(e);if(!i||i.from>=r||i.to<=t){let a=new lh(t,e.sliceString(t,r));return p1.set(e,a),a}if(i.from==t&&i.to==r)return i;let{text:s,from:o}=i;return o>t&&(s=e.sliceString(t,o)+s,o=t),i.to<r&&(s+=e.sliceString(i.to,r)),p1.set(e,new lh(o,s)),new lh(t,s.slice(t-o,r-o))}}class OF{constructor(e,t,r,i,s){this.text=e,this.to=s,this.done=!1,this.value=wF,this.matchPos=Jy(e,i),this.re=new RegExp(t,C2+(r?.ignoreCase?"i":"")),this.test=r?.test,this.flat=lh.get(e,i,this.chunkEnd(i+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let r=this.flat.from+t.index,i=r+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(r,i,t)))return this.value={from:r,to:i,match:t},this.matchPos=Jy(this.text,i+(r==i?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=lh.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(_F.prototype[Symbol.iterator]=OF.prototype[Symbol.iterator]=function(){return this});function $ae(n){try{return new RegExp(n,C2),!0}catch{return!1}}function Jy(n,e){if(e>=n.length)return e;let t=n.lineAt(e),r;for(;e<t.to&&(r=t.text.charCodeAt(e-t.from))>=56320&&r<57344;)e++;return e}function Px(n){let e=String(n.state.doc.lineAt(n.state.selection.main.head).number),t=ii("input",{class:"cm-textfield",name:"line",value:e}),r=ii("form",{class:"cm-gotoLine",onkeydown:s=>{s.keyCode==27?(s.preventDefault(),n.dispatch({effects:kp.of(!1)}),n.focus()):s.keyCode==13&&(s.preventDefault(),i())},onsubmit:s=>{s.preventDefault(),i()}},ii("label",n.state.phrase("Go to line"),": ",t)," ",ii("button",{class:"cm-button",type:"submit"},n.state.phrase("go")),ii("button",{name:"close",onclick:()=>{n.dispatch({effects:kp.of(!1)}),n.focus()},"aria-label":n.state.phrase("close"),type:"button"},["Ã"]));function i(){let s=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!s)return;let{state:o}=n,a=o.doc.lineAt(o.selection.main.head),[,l,c,d,h]=s,f=d?+d.slice(1):0,p=c?+c:a.number;if(c&&h){let v=p/100;l&&(v=v*(l=="-"?-1:1)+a.number/o.doc.lines),p=Math.round(o.doc.lines*v)}else c&&l&&(p=p*(l=="-"?-1:1)+a.number);let g=o.doc.line(Math.max(1,Math.min(o.doc.lines,p))),m=rt.cursor(g.from+Math.max(0,Math.min(f,g.length)));n.dispatch({effects:[kp.of(!1),gt.scrollIntoView(m.from,{y:"center"})],selection:m}),n.focus()}return{dom:r}}const kp=en.define(),XP=Cr.define({create(){return!0},update(n,e){for(let t of e.effects)t.is(kp)&&(n=t.value);return n},provide:n=>Zy.from(n,e=>e?Px:null)}),Fae=n=>{let e=Hy(n,Px);if(!e){let t=[kp.of(!0)];n.state.field(XP,!1)==null&&t.push(en.appendConfig.of([XP,zae])),n.dispatch({effects:t}),e=Hy(n,Px)}return e&&e.dom.querySelector("input").select(),!0},zae=gt.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),Bae=({state:n,dispatch:e})=>{let{selection:t}=n,r=rt.create(t.ranges.map(i=>n.wordAt(i.head)||rt.cursor(i.head)),t.mainIndex);return r.eq(t)?!1:(e(n.update({selection:r})),!0)};function Uae(n,e){let{main:t,ranges:r}=n.selection,i=n.wordAt(t.head),s=i&&i.from==t.from&&i.to==t.to;for(let o=!1,a=new gg(n.doc,e,r[r.length-1].to);;)if(a.next(),a.done){if(o)return null;a=new gg(n.doc,e,0,Math.max(0,r[r.length-1].from-1)),o=!0}else{if(o&&r.some(l=>l.from==a.value.from))continue;if(s){let l=n.wordAt(a.value.from);if(!l||l.from!=a.value.from||l.to!=a.value.to)continue}return a.value}}const jae=({state:n,dispatch:e})=>{let{ranges:t}=n.selection;if(t.some(s=>s.from===s.to))return Bae({state:n,dispatch:e});let r=n.sliceDoc(t[0].from,t[0].to);if(n.selection.ranges.some(s=>n.sliceDoc(s.from,s.to)!=r))return!1;let i=Uae(n,r);return i?(e(n.update({selection:n.selection.addRange(rt.range(i.from,i.to),!1),effects:gt.scrollIntoView(i.to)})),!0):!1},af=Ut.define({combine(n){return rm(n,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new tle(e),scrollToMatch:e=>gt.scrollIntoView(e)})}});class xF{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||$ae(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Zae(this):new qae(this)}getCursor(e,t=0,r){let i=e.doc?e:un.create({doc:e});return r==null&&(r=i.doc.length),this.regexp?Pd(this,i,t,r):Ed(this,i,t,r)}}class kF{constructor(e){this.spec=e}}function Ed(n,e,t,r){return new gg(e.doc,n.unquoted,t,r,n.caseSensitive?void 0:i=>i.toLowerCase(),n.wholeWord?Vae(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Vae(n,e){return(t,r,i,s)=>((s>t||s+i.length<r)&&(s=Math.max(0,t-2),i=n.sliceString(s,Math.min(n.length,r+2))),(e(e0(i,t-s))!=ui.Word||e(t0(i,t-s))!=ui.Word)&&(e(t0(i,r-s))!=ui.Word||e(e0(i,r-s))!=ui.Word))}class qae extends kF{constructor(e){super(e)}nextMatch(e,t,r){let i=Ed(this.spec,e,r,e.doc.length).nextOverlapping();if(i.done){let s=Math.min(e.doc.length,t+this.spec.unquoted.length);i=Ed(this.spec,e,0,s).nextOverlapping()}return i.done||i.value.from==t&&i.value.to==r?null:i.value}prevMatchInRange(e,t,r){for(let i=r;;){let s=Math.max(t,i-1e4-this.spec.unquoted.length),o=Ed(this.spec,e,s,i),a=null;for(;!o.nextOverlapping().done;)a=o.value;if(a)return a;if(s==t)return null;i-=1e4}}prevMatch(e,t,r){let i=this.prevMatchInRange(e,0,t);return i||(i=this.prevMatchInRange(e,Math.max(0,r-this.spec.unquoted.length),e.doc.length)),i&&(i.from!=t||i.to!=r)?i:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let r=Ed(this.spec,e,0,e.doc.length),i=[];for(;!r.next().done;){if(i.length>=t)return null;i.push(r.value)}return i}highlight(e,t,r,i){let s=Ed(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)i(s.value.from,s.value.to)}}function Pd(n,e,t,r){return new _F(e.doc,n.search,{ignoreCase:!n.caseSensitive,test:n.wholeWord?Hae(e.charCategorizer(e.selection.main.head)):void 0},t,r)}function e0(n,e){return n.slice(ci(n,e,!1),e)}function t0(n,e){return n.slice(e,ci(n,e))}function Hae(n){return(e,t,r)=>!r[0].length||(n(e0(r.input,r.index))!=ui.Word||n(t0(r.input,r.index))!=ui.Word)&&(n(t0(r.input,r.index+r[0].length))!=ui.Word||n(e0(r.input,r.index+r[0].length))!=ui.Word)}class Zae extends kF{nextMatch(e,t,r){let i=Pd(this.spec,e,r,e.doc.length).next();return i.done&&(i=Pd(this.spec,e,0,t).next()),i.done?null:i.value}prevMatchInRange(e,t,r){for(let i=1;;i++){let s=Math.max(t,r-i*1e4),o=Pd(this.spec,e,s,r),a=null;for(;!o.next().done;)a=o.value;if(a&&(s==t||a.from>s+10))return a;if(s==t)return null}}prevMatch(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(t,r)=>{if(r=="&")return e.match[0];if(r=="$")return"$";for(let i=r.length;i>0;i--){let s=+r.slice(0,i);if(s>0&&s<e.match.length)return e.match[s]+r.slice(i)}return t})}matchAll(e,t){let r=Pd(this.spec,e,0,e.doc.length),i=[];for(;!r.next().done;){if(i.length>=t)return null;i.push(r.value)}return i}highlight(e,t,r,i){let s=Pd(this.spec,e,Math.max(0,t-250),Math.min(r+250,e.doc.length));for(;!s.next().done;)i(s.value.from,s.value.to)}}const mg=en.define(),E2=en.define(),lc=Cr.define({create(n){return new g1(Ix(n).create(),null)},update(n,e){for(let t of e.effects)t.is(mg)?n=new g1(t.value.create(),n.panel):t.is(E2)&&(n=new g1(n.query,t.value?P2:null));return n},provide:n=>Zy.from(n,e=>e.panel)});class g1{constructor(e,t){this.query=e,this.panel=t}}const Wae=hn.mark({class:"cm-searchMatch"}),Xae=hn.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Yae=Kr.fromClass(class{constructor(n){this.view=n,this.decorations=this.highlight(n.state.field(lc))}update(n){let e=n.state.field(lc);(e!=n.startState.field(lc)||n.docChanged||n.selectionSet||n.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:n,panel:e}){if(!e||!n.spec.valid)return hn.none;let{view:t}=this,r=new Cu;for(let i=0,s=t.visibleRanges,o=s.length;i<o;i++){let{from:a,to:l}=s[i];for(;i<o-1&&l>s[i+1].from-500;)l=s[++i].to;n.highlight(t.state,a,l,(c,d)=>{let h=t.state.selection.ranges.some(f=>f.from==c&&f.to==d);r.add(c,d,h?Xae:Wae)})}return r.finish()}},{decorations:n=>n.decorations});function pm(n){return e=>{let t=e.state.field(lc,!1);return t&&t.query.spec.valid?n(e,t):AF(e)}}const n0=pm((n,{query:e})=>{let{to:t}=n.state.selection.main,r=e.nextMatch(n.state,t,t);if(!r)return!1;let i=rt.single(r.from,r.to),s=n.state.facet(af);return n.dispatch({selection:i,effects:[I2(n,r),s.scrollToMatch(i.main,n)],userEvent:"select.search"}),TF(n),!0}),r0=pm((n,{query:e})=>{let{state:t}=n,{from:r}=t.selection.main,i=e.prevMatch(t,r,r);if(!i)return!1;let s=rt.single(i.from,i.to),o=n.state.facet(af);return n.dispatch({selection:s,effects:[I2(n,i),o.scrollToMatch(s.main,n)],userEvent:"select.search"}),TF(n),!0}),Gae=pm((n,{query:e})=>{let t=e.matchAll(n.state,1e3);return!t||!t.length?!1:(n.dispatch({selection:rt.create(t.map(r=>rt.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),Kae=({state:n,dispatch:e})=>{let t=n.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:r,to:i}=t.main,s=[],o=0;for(let a=new gg(n.doc,n.sliceDoc(r,i));!a.next().done;){if(s.length>1e3)return!1;a.value.from==r&&(o=s.length),s.push(rt.range(a.value.from,a.value.to))}return e(n.update({selection:rt.create(s,o),userEvent:"select.search.matches"})),!0},YP=pm((n,{query:e})=>{let{state:t}=n,{from:r,to:i}=t.selection.main;if(t.readOnly)return!1;let s=e.nextMatch(t,r,r);if(!s)return!1;let o=s,a=[],l,c,d=[];o.from==r&&o.to==i&&(c=t.toText(e.getReplacement(o)),a.push({from:o.from,to:o.to,insert:c}),o=e.nextMatch(t,o.from,o.to),d.push(gt.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(r).number)+".")));let h=n.state.changes(a);return o&&(l=rt.single(o.from,o.to).map(h),d.push(I2(n,o)),d.push(t.facet(af).scrollToMatch(l.main,n))),n.dispatch({changes:h,selection:l,effects:d,userEvent:"input.replace"}),!0}),Jae=pm((n,{query:e})=>{if(n.state.readOnly)return!1;let t=e.matchAll(n.state,1e9).map(i=>{let{from:s,to:o}=i;return{from:s,to:o,insert:e.getReplacement(i)}});if(!t.length)return!1;let r=n.state.phrase("replaced $ matches",t.length)+".";return n.dispatch({changes:t,effects:gt.announce.of(r),userEvent:"input.replace.all"}),!0});function P2(n){return n.state.facet(af).createPanel(n)}function Ix(n,e){var t,r,i,s,o;let a=n.selection.main,l=a.empty||a.to>a.from+100?"":n.sliceDoc(a.from,a.to);if(e&&!l)return e;let c=n.facet(af);return new xF({search:((t=e?.literal)!==null&&t!==void 0?t:c.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(r=e?.caseSensitive)!==null&&r!==void 0?r:c.caseSensitive,literal:(i=e?.literal)!==null&&i!==void 0?i:c.literal,regexp:(s=e?.regexp)!==null&&s!==void 0?s:c.regexp,wholeWord:(o=e?.wholeWord)!==null&&o!==void 0?o:c.wholeWord})}function SF(n){let e=Hy(n,P2);return e&&e.dom.querySelector("[main-field]")}function TF(n){let e=SF(n);e&&e==n.root.activeElement&&e.select()}const AF=n=>{let e=n.state.field(lc,!1);if(e&&e.panel){let t=SF(n);if(t&&t!=n.root.activeElement){let r=Ix(n.state,e.query.spec);r.valid&&n.dispatch({effects:mg.of(r)}),t.focus(),t.select()}}else n.dispatch({effects:[E2.of(!0),e?mg.of(Ix(n.state,e.query.spec)):en.appendConfig.of(rle)]});return!0},CF=n=>{let e=n.state.field(lc,!1);if(!e||!e.panel)return!1;let t=Hy(n,P2);return t&&t.dom.contains(n.root.activeElement)&&n.focus(),n.dispatch({effects:E2.of(!1)}),!0},ele=[{key:"Mod-f",run:AF,scope:"editor search-panel"},{key:"F3",run:n0,shift:r0,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:n0,shift:r0,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:CF,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Kae},{key:"Mod-Alt-g",run:Fae},{key:"Mod-d",run:jae,preventDefault:!0}];class tle{constructor(e){this.view=e;let t=this.query=e.state.field(lc).query.spec;this.commit=this.commit.bind(this),this.searchField=ii("input",{value:t.search,placeholder:ms(e,"Find"),"aria-label":ms(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=ii("input",{value:t.replace,placeholder:ms(e,"Replace"),"aria-label":ms(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=ii("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=ii("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=ii("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function r(i,s,o){return ii("button",{class:"cm-button",name:i,onclick:s,type:"button"},o)}this.dom=ii("div",{onkeydown:i=>this.keydown(i),class:"cm-search"},[this.searchField,r("next",()=>n0(e),[ms(e,"next")]),r("prev",()=>r0(e),[ms(e,"previous")]),r("select",()=>Gae(e),[ms(e,"all")]),ii("label",null,[this.caseField,ms(e,"match case")]),ii("label",null,[this.reField,ms(e,"regexp")]),ii("label",null,[this.wordField,ms(e,"by word")]),...e.state.readOnly?[]:[ii("br"),this.replaceField,r("replace",()=>YP(e),[ms(e,"replace")]),r("replaceAll",()=>Jae(e),[ms(e,"replace all")])],ii("button",{name:"close",onclick:()=>CF(e),"aria-label":ms(e,"close"),type:"button"},["Ã"])])}commit(){let e=new xF({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:mg.of(e)}))}keydown(e){ese(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?r0:n0)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),YP(this.view))}update(e){for(let t of e.transactions)for(let r of t.effects)r.is(mg)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(af).top}}function ms(n,e){return n.state.phrase(e)}const mv=30,vv=/[\s\.,:;?!]/;function I2(n,{from:e,to:t}){let r=n.state.doc.lineAt(e),i=n.state.doc.lineAt(t).to,s=Math.max(r.from,e-mv),o=Math.min(i,t+mv),a=n.state.sliceDoc(s,o);if(s!=r.from){for(let l=0;l<mv;l++)if(!vv.test(a[l+1])&&vv.test(a[l])){a=a.slice(l);break}}if(o!=i){for(let l=a.length-1;l>a.length-mv;l--)if(!vv.test(a[l-1])&&vv.test(a[l])){a=a.slice(0,l);break}}return gt.announce.of(`${n.state.phrase("current match")}. ${a} ${n.state.phrase("on line")} ${r.number}.`)}const nle=gt.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),rle=[lc,Wo.low(Yae),nle];class M2{constructor(e,t,r,i){this.state=e,this.pos=t,this.explicit=r,this.view=i,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=dr(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),r=Math.max(t.from,this.pos-250),i=t.text.slice(r-t.from,this.pos-t.from),s=i.search(PF(e,!1));return s<0?null:{from:r+s,to:this.pos,text:i.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,t,r){e=="abort"&&this.abortListeners&&(this.abortListeners.push(t),r&&r.onDocChange&&(this.abortOnDocChange=!0))}}function GP(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function ile(n){let e=Object.create(null),t=Object.create(null);for(let{label:i}of n){e[i[0]]=!0;for(let s=1;s<i.length;s++)t[i[s]]=!0}let r=GP(e)+GP(t)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function EF(n){let e=n.map(i=>typeof i=="string"?{label:i}:i),[t,r]=e.every(i=>/^\w+$/.test(i.label))?[/\w*$/,/\w+$/]:ile(e);return i=>{let s=i.matchBefore(r);return s||i.explicit?{from:s?s.from:i.pos,options:e,validFor:t}:null}}function sle(n,e){return t=>{for(let r=dr(t.state).resolveInner(t.pos,-1);r;r=r.parent){if(n.indexOf(r.name)>-1)return null;if(r.type.isTop)break}return e(t)}}class KP{constructor(e,t,r,i){this.completion=e,this.source=t,this.match=r,this.score=i}}function vu(n){return n.selection.main.from}function PF(n,e){var t;let{source:r}=n,i=e&&r[0]!="^",s=r[r.length-1]!="$";return!i&&!s?n:new RegExp(`${i?"^":""}(?:${r})${s?"$":""}`,(t=n.flags)!==null&&t!==void 0?t:n.ignoreCase?"i":"")}const R2=Xo.define();function ole(n,e,t,r){let{main:i}=n.selection,s=t-i.from,o=r-i.from;return{...n.changeByRange(a=>{if(a!=i&&t!=r&&n.sliceDoc(a.from+s,a.from+o)!=n.sliceDoc(t,r))return{range:a};let l=n.toText(e);return{changes:{from:a.from+s,to:r==i.from?a.to:a.from+o,insert:l},range:rt.cursor(a.from+s+l.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const JP=new WeakMap;function ale(n){if(!Array.isArray(n))return n;let e=JP.get(n);return e||JP.set(n,e=EF(n)),e}const i0=en.define(),vg=en.define();class lle{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let r=al(e,t),i=Yc(r);this.chars.push(r);let s=e.slice(t,t+i),o=s.toUpperCase();this.folded.push(al(o==s?s.toLowerCase():o,0)),t+=i}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:r,any:i,precise:s,byWord:o}=this;if(t.length==1){let O=al(e,0),_=Yc(O),x=_==e.length?0:-100;if(O!=t[0])if(O==r[0])x+=-200;else return null;return this.ret(x,[0,_])}let a=e.indexOf(this.pattern);if(a==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let l=t.length,c=0;if(a<0){for(let O=0,_=Math.min(e.length,200);O<_&&c<l;){let x=al(e,O);(x==t[c]||x==r[c])&&(i[c++]=O),O+=Yc(x)}if(c<l)return null}let d=0,h=0,f=!1,p=0,g=-1,m=-1,v=/[a-z]/.test(e),y=!0;for(let O=0,_=Math.min(e.length,200),x=0;O<_&&h<l;){let k=al(e,O);a<0&&(d<l&&k==t[d]&&(s[d++]=O),p<l&&(k==t[p]||k==r[p]?(p==0&&(g=O),m=O+1,p++):p=0));let S,E=k<255?k>=48&&k<=57||k>=97&&k<=122?2:k>=65&&k<=90?1:0:(S=n$(k))!=S.toLowerCase()?1:S!=S.toUpperCase()?2:0;(!O||E==1&&v||x==0&&E!=0)&&(t[h]==k||r[h]==k&&(f=!0)?o[h++]=O:o.length&&(y=!1)),x=E,O+=Yc(k)}return h==l&&o[0]==0&&y?this.result(-100+(f?-200:0),o,e):p==l&&g==0?this.ret(-200-e.length+(m==e.length?0:-100),[0,m]):a>-1?this.ret(-700-e.length,[a,a+this.pattern.length]):p==l?this.ret(-900-e.length,[g,m]):h==l?this.result(-100+(f?-200:0)+-700+(y?0:-1100),o,e):t.length==2?null:this.result((i[0]?-700:0)+-200+-1100,i,e)}result(e,t,r){let i=[],s=0;for(let o of t){let a=o+(this.astral?Yc(al(r,o)):1);s&&i[s-1]==o?i[s-1]=a:(i[s++]=o,i[s++]=a)}return this.ret(e-r.length,i)}}class cle{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),r=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return r==null?null:(this.matched=[0,t.length],this.score=r+(e.length==this.pattern.length?0:-100),this)}}const Gr=Ut.define({combine(n){return rm(n,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:ule,filterStrict:!1,compareCompletions:(e,t)=>(e.sortText||e.label).localeCompare(t.sortText||t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>r=>eI(e(r),t(r)),optionClass:(e,t)=>r=>eI(e(r),t(r)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})}});function eI(n,e){return n?e?n+" "+e:n:e}function ule(n,e,t,r,i,s){let o=n.textDirection==pr.RTL,a=o,l=!1,c="top",d,h,f=e.left-i.left,p=i.right-e.right,g=r.right-r.left,m=r.bottom-r.top;if(a&&f<Math.min(g,p)?a=!1:!a&&p<Math.min(g,f)&&(a=!0),g<=(a?f:p))d=Math.max(i.top,Math.min(t.top,i.bottom-m))-e.top,h=Math.min(400,a?f:p);else{l=!0,h=Math.min(400,(o?e.right:i.right-e.left)-30);let O=i.bottom-e.bottom;O>=m||O>e.top?d=t.bottom-e.top:(c="bottom",d=e.bottom-t.top)}let v=(e.bottom-e.top)/s.offsetHeight,y=(e.right-e.left)/s.offsetWidth;return{style:`${c}: ${d/v}px; max-width: ${h/y}px`,class:"cm-completionInfo-"+(l?o?"left-narrow":"right-narrow":a?"left":"right")}}function dle(n){let e=n.addToOptions.slice();return n.icons&&e.push({render(t){let r=document.createElement("div");return r.classList.add("cm-completionIcon"),t.type&&r.classList.add(...t.type.split(/\s+/g).map(i=>"cm-completionIcon-"+i)),r.setAttribute("aria-hidden","true"),r},position:20}),e.push({render(t,r,i,s){let o=document.createElement("span");o.className="cm-completionLabel";let a=t.displayLabel||t.label,l=0;for(let c=0;c<s.length;){let d=s[c++],h=s[c++];d>l&&o.appendChild(document.createTextNode(a.slice(l,d)));let f=o.appendChild(document.createElement("span"));f.appendChild(document.createTextNode(a.slice(d,h))),f.className="cm-completionMatchedText",l=h}return l<a.length&&o.appendChild(document.createTextNode(a.slice(l))),o},position:50},{render(t){if(!t.detail)return null;let r=document.createElement("span");return r.className="cm-completionDetail",r.textContent=t.detail,r},position:80}),e.sort((t,r)=>t.position-r.position).map(t=>t.render)}function m1(n,e,t){if(n<=t)return{from:0,to:n};if(e<0&&(e=0),e<=n>>1){let i=Math.floor(e/t);return{from:i*t,to:(i+1)*t}}let r=Math.floor((n-e)/t);return{from:n-(r+1)*t,to:n-r*t}}class hle{constructor(e,t,r){this.view=e,this.stateField=t,this.applyCompletion=r,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:l=>this.placeInfo(l),key:this},this.space=null,this.currentClass="";let i=e.state.field(t),{options:s,selected:o}=i.open,a=e.state.facet(Gr);this.optionContent=dle(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=m1(s.length,o,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",l=>{let{options:c}=e.state.field(t).open;for(let d=l.target,h;d&&d!=this.dom;d=d.parentNode)if(d.nodeName=="LI"&&(h=/-(\d+)$/.exec(d.id))&&+h[1]<c.length){this.applyCompletion(e,c[+h[1]]),l.preventDefault();return}}),this.dom.addEventListener("focusout",l=>{let c=e.state.field(this.stateField,!1);c&&c.tooltip&&e.state.facet(Gr).closeOnBlur&&l.relatedTarget!=e.contentDOM&&e.dispatch({effects:vg.of(null)})}),this.showOptions(s,i.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let r=e.state.field(this.stateField),i=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),r!=i){let{options:s,selected:o,disabled:a}=r.open;(!i.open||i.open.options!=s)&&(this.range=m1(s.length,o,e.state.facet(Gr).maxRenderedOptions),this.showOptions(s,r.id)),this.updateSel(),a!=((t=i.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!a)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let r of this.currentClass.split(" "))r&&this.dom.classList.remove(r);for(let r of t.split(" "))r&&this.dom.classList.add(r);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;(t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=m1(t.options.length,t.selected,this.view.state.facet(Gr).maxRenderedOptions),this.showOptions(t.options,e.id));let r=this.updateSelectedOption(t.selected);if(r){this.destroyInfo();let{completion:i}=t.options[t.selected],{info:s}=i;if(!s)return;let o=typeof s=="string"?document.createTextNode(s):s(i);if(!o)return;"then"in o?o.then(a=>{a&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(a,i)}).catch(a=>Ds(this.view.state,a,"completion info")):(this.addInfoPane(o,i),r.setAttribute("aria-describedby",this.info.id))}}addInfoPane(e,t){this.destroyInfo();let r=this.info=document.createElement("div");if(r.className="cm-tooltip cm-completionInfo",r.id="cm-completionInfo-"+Math.floor(Math.random()*65535).toString(16),e.nodeType!=null)r.appendChild(e),this.infoDestroy=null;else{let{dom:i,destroy:s}=e;r.appendChild(i),this.infoDestroy=s||null}this.dom.appendChild(r),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let r=this.list.firstChild,i=this.range.from;r;r=r.nextSibling,i++)r.nodeName!="LI"||!r.id?i--:i==e?r.hasAttribute("aria-selected")||(r.setAttribute("aria-selected","true"),t=r):r.hasAttribute("aria-selected")&&(r.removeAttribute("aria-selected"),r.removeAttribute("aria-describedby"));return t&&ple(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),i=e.getBoundingClientRect(),s=this.space;if(!s){let o=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:o.clientWidth,bottom:o.clientHeight}}return i.top>Math.min(s.bottom,t.bottom)-10||i.bottom<Math.max(s.top,t.top)+10?null:this.view.state.facet(Gr).positionInfo(this.view,t,i,r,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,r){const i=document.createElement("ul");i.id=t,i.setAttribute("role","listbox"),i.setAttribute("aria-expanded","true"),i.setAttribute("aria-label",this.view.state.phrase("Completions")),i.addEventListener("mousedown",o=>{o.target==i&&o.preventDefault()});let s=null;for(let o=r.from;o<r.to;o++){let{completion:a,match:l}=e[o],{section:c}=a;if(c){let f=typeof c=="string"?c:c.name;if(f!=s&&(o>r.from||r.from==0))if(s=f,typeof c!="string"&&c.header)i.appendChild(c.header(c));else{let p=i.appendChild(document.createElement("completion-section"));p.textContent=f}}const d=i.appendChild(document.createElement("li"));d.id=t+"-"+o,d.setAttribute("role","option");let h=this.optionClass(a);h&&(d.className=h);for(let f of this.optionContent){let p=f(a,this.view.state,this.view,l);p&&d.appendChild(p)}}return r.from&&i.classList.add("cm-completionListIncompleteTop"),r.to<e.length&&i.classList.add("cm-completionListIncompleteBottom"),i}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function fle(n,e){return t=>new hle(t,n,e)}function ple(n,e){let t=n.getBoundingClientRect(),r=e.getBoundingClientRect(),i=t.height/n.offsetHeight;r.top<t.top?n.scrollTop-=(t.top-r.top)/i:r.bottom>t.bottom&&(n.scrollTop+=(r.bottom-t.bottom)/i)}function tI(n){return(n.boost||0)*100+(n.apply?10:0)+(n.info?5:0)+(n.type?1:0)}function gle(n,e){let t=[],r=null,i=null,s=d=>{t.push(d);let{section:h}=d.completion;if(h){r||(r=[]);let f=typeof h=="string"?h:h.name;r.some(p=>p.name==f)||r.push(typeof h=="string"?{name:f}:h)}},o=e.facet(Gr);for(let d of n)if(d.hasResult()){let h=d.result.getMatch;if(d.result.filter===!1)for(let f of d.result.options)s(new KP(f,d.source,h?h(f):[],1e9-t.length));else{let f=e.sliceDoc(d.from,d.to),p,g=o.filterStrict?new cle(f):new lle(f);for(let m of d.result.options)if(p=g.match(m.label)){let v=m.displayLabel?h?h(m,p.matched):[]:p.matched,y=p.score+(m.boost||0);if(s(new KP(m,d.source,v,y)),typeof m.section=="object"&&m.section.rank==="dynamic"){let{name:O}=m.section;i||(i=Object.create(null)),i[O]=Math.max(y,i[O]||-1e9)}}}}if(r){let d=Object.create(null),h=0,f=(p,g)=>(p.rank==="dynamic"&&g.rank==="dynamic"?i[g.name]-i[p.name]:0)||(typeof p.rank=="number"?p.rank:1e9)-(typeof g.rank=="number"?g.rank:1e9)||(p.name<g.name?-1:1);for(let p of r.sort(f))h-=1e5,d[p.name]=h;for(let p of t){let{section:g}=p.completion;g&&(p.score+=d[typeof g=="string"?g:g.name])}}let a=[],l=null,c=o.compareCompletions;for(let d of t.sort((h,f)=>f.score-h.score||c(h.completion,f.completion))){let h=d.completion;!l||l.label!=h.label||l.detail!=h.detail||l.type!=null&&h.type!=null&&l.type!=h.type||l.apply!=h.apply||l.boost!=h.boost?a.push(d):tI(d.completion)>tI(l)&&(a[a.length-1]=d),l=d.completion}return a}class qd{constructor(e,t,r,i,s,o){this.options=e,this.attrs=t,this.tooltip=r,this.timestamp=i,this.selected=s,this.disabled=o}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new qd(this.options,nI(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,r,i,s,o){if(i&&!o&&e.some(c=>c.isPending))return i.setDisabled();let a=gle(e,t);if(!a.length)return i&&e.some(c=>c.isPending)?i.setDisabled():null;let l=t.facet(Gr).selectOnOpen?0:-1;if(i&&i.selected!=l&&i.selected!=-1){let c=i.options[i.selected].completion;for(let d=0;d<a.length;d++)if(a[d].completion==c){l=d;break}}return new qd(a,nI(r,l),{pos:e.reduce((c,d)=>d.hasResult()?Math.min(c,d.from):c,1e8),create:_le,above:s.aboveCursor},i?i.timestamp:Date.now(),l,!1)}map(e){return new qd(this.options,this.attrs,{...this.tooltip,pos:e.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new qd(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class s0{constructor(e,t,r){this.active=e,this.id=t,this.open=r}static start(){return new s0(ble,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,r=t.facet(Gr),s=(r.override||t.languageDataAt("autocomplete",vu(t)).map(ale)).map(l=>(this.active.find(d=>d.source==l)||new fo(l,this.active.some(d=>d.state!=0)?1:0)).update(e,r));s.length==this.active.length&&s.every((l,c)=>l==this.active[c])&&(s=this.active);let o=this.open,a=e.effects.some(l=>l.is(D2));o&&e.docChanged&&(o=o.map(e.changes)),e.selection||s.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!mle(s,this.active)||a?o=qd.build(s,t,this.id,o,r,a):o&&o.disabled&&!s.some(l=>l.isPending)&&(o=null),!o&&s.every(l=>!l.isPending)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new fo(l.source,0):l));for(let l of e.effects)l.is(MF)&&(o=o&&o.setSelected(l.value,this.id));return s==this.active&&o==this.open?this:new s0(s,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?vle:yle}}function mle(n,e){if(n==e)return!0;for(let t=0,r=0;;){for(;t<n.length&&!n[t].hasResult();)t++;for(;r<e.length&&!e[r].hasResult();)r++;let i=t==n.length,s=r==e.length;if(i||s)return i==s;if(n[t++].result!=e[r++].result)return!1}}const vle={"aria-autocomplete":"list"},yle={};function nI(n,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":n};return e>-1&&(t["aria-activedescendant"]=n+"-"+e),t}const ble=[];function IF(n,e){if(n.isUserEvent("input.complete")){let r=n.annotation(R2);if(r&&e.activateOnCompletion(r))return 12}let t=n.isUserEvent("input.type");return t&&e.activateOnTyping?5:t?1:n.isUserEvent("delete.backward")?2:n.selection?8:n.docChanged?16:0}class fo{constructor(e,t,r=!1){this.source=e,this.state=t,this.explicit=r}hasResult(){return!1}get isPending(){return this.state==1}update(e,t){let r=IF(e,t),i=this;(r&8||r&16&&this.touches(e))&&(i=new fo(i.source,0)),r&4&&i.state==0&&(i=new fo(this.source,1)),i=i.updateFor(e,r);for(let s of e.effects)if(s.is(i0))i=new fo(i.source,1,s.value);else if(s.is(vg))i=new fo(i.source,0);else if(s.is(D2))for(let o of s.value)o.source==i.source&&(i=o);return i}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(vu(e.state))}}class ch extends fo{constructor(e,t,r,i,s,o){super(e,3,t),this.limit=r,this.result=i,this.from=s,this.to=o}hasResult(){return!0}updateFor(e,t){var r;if(!(t&3))return this.map(e.changes);let i=this.result;i.map&&!e.changes.empty&&(i=i.map(i,e.changes));let s=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),a=vu(e.state);if(a>o||!i||t&2&&(vu(e.startState)==this.from||a<this.limit))return new fo(this.source,t&4?1:0);let l=e.changes.mapPos(this.limit);return wle(i.validFor,e.state,s,o)?new ch(this.source,this.explicit,l,i,s,o):i.update&&(i=i.update(i,s,o,new M2(e.state,a,!1)))?new ch(this.source,this.explicit,l,i,i.from,(r=i.to)!==null&&r!==void 0?r:vu(e.state)):new fo(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new ch(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new fo(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function wle(n,e,t,r){if(!n)return!1;let i=e.sliceDoc(t,r);return typeof n=="function"?n(i,t,r,e):PF(n,!0).test(i)}const D2=en.define({map(n,e){return n.map(t=>t.map(e))}}),MF=en.define(),$i=Cr.define({create(){return s0.start()},update(n,e){return n.update(e)},provide:n=>[O6.from(n,e=>e.tooltip),gt.contentAttributes.from(n,e=>e.attrs)]});function N2(n,e){const t=e.completion.apply||e.completion.label;let r=n.state.field($i).active.find(i=>i.source==e.source);return r instanceof ch?(typeof t=="string"?n.dispatch({...ole(n.state,t,r.from,r.to),annotations:R2.of(e.completion)}):t(n,e.completion,r.from,r.to),!0):!1}const _le=fle($i,N2);function Hd(n,e="option"){return t=>{let r=t.state.field($i,!1);if(!r||!r.open||r.open.disabled||Date.now()-r.open.timestamp<t.state.facet(Gr).interactionDelay)return!1;let i=1,s;e=="page"&&(s=x6(t,r.open.tooltip))&&(i=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:o}=r.open.options,a=r.open.selected>-1?r.open.selected+i*(n?1:-1):n?0:o-1;return a<0?a=e=="page"?0:o-1:a>=o&&(a=e=="page"?o-1:0),t.dispatch({effects:MF.of(a)}),!0}}const Ole=n=>{let e=n.state.field($i,!1);return n.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<n.state.facet(Gr).interactionDelay?!1:N2(n,e.open.options[e.open.selected])},v1=n=>n.state.field($i,!1)?(n.dispatch({effects:i0.of(!0)}),!0):!1,xle=n=>{let e=n.state.field($i,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(n.dispatch({effects:vg.of(null)}),!0)};class kle{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const Sle=50,Tle=1e3,Ale=Kr.fromClass(class{constructor(n){this.view=n,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of n.state.field($i).active)e.isPending&&this.startQuery(e)}update(n){let e=n.state.field($i),t=n.state.facet(Gr);if(!n.selectionSet&&!n.docChanged&&n.startState.field($i)==e)return;let r=n.transactions.some(s=>{let o=IF(s,t);return o&8||(s.selection||s.docChanged)&&!(o&3)});for(let s=0;s<this.running.length;s++){let o=this.running[s];if(r||o.context.abortOnDocChange&&n.docChanged||o.updates.length+n.transactions.length>Sle&&Date.now()-o.time>Tle){for(let a of o.context.abortListeners)try{a()}catch(l){Ds(this.view.state,l)}o.context.abortListeners=null,this.running.splice(s--,1)}else o.updates.push(...n.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),n.transactions.some(s=>s.effects.some(o=>o.is(i0)))&&(this.pendingStart=!0);let i=this.pendingStart?50:t.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(s=>s.isPending&&!this.running.some(o=>o.active.source==s.source))?setTimeout(()=>this.startUpdate(),i):-1,this.composing!=0)for(let s of n.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:n}=this.view,e=n.field($i);for(let t of e.active)t.isPending&&!this.running.some(r=>r.active.source==t.source)&&this.startQuery(t);this.running.length&&e.open&&e.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Gr).updateSyncTime))}startQuery(n){let{state:e}=this.view,t=vu(e),r=new M2(e,t,n.explicit,this.view),i=new kle(n,r);this.running.push(i),Promise.resolve(n.source(r)).then(s=>{i.context.aborted||(i.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:vg.of(null)}),Ds(this.view.state,s)})}scheduleAccept(){this.running.every(n=>n.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Gr).updateSyncTime))}accept(){var n;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(Gr),r=this.view.state.field($i);for(let i=0;i<this.running.length;i++){let s=this.running[i];if(s.done===void 0)continue;if(this.running.splice(i--,1),s.done){let a=vu(s.updates.length?s.updates[0].startState:this.view.state),l=Math.min(a,s.done.from+(s.active.explicit?0:1)),c=new ch(s.active.source,s.active.explicit,l,s.done,s.done.from,(n=s.done.to)!==null&&n!==void 0?n:a);for(let d of s.updates)c=c.update(d,t);if(c.hasResult()){e.push(c);continue}}let o=r.active.find(a=>a.source==s.active.source);if(o&&o.isPending)if(s.done==null){let a=new fo(s.active.source,0);for(let l of s.updates)a=a.update(l,t);a.isPending||e.push(a)}else this.startQuery(o)}(e.length||r.open&&r.open.disabled)&&this.view.dispatch({effects:D2.of(e)})}},{eventHandlers:{blur(n){let e=this.view.state.field($i,!1);if(e&&e.tooltip&&this.view.state.facet(Gr).closeOnBlur){let t=e.open&&x6(this.view,e.open.tooltip);(!t||!t.dom.contains(n.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:vg.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:i0.of(!1)}),20),this.composing=0}}}),Cle=typeof navigator=="object"&&/Win/.test(navigator.platform),Ele=Wo.highest(gt.domEventHandlers({keydown(n,e){let t=e.state.field($i,!1);if(!t||!t.open||t.open.disabled||t.open.selected<0||n.key.length>1||n.ctrlKey&&!(Cle&&n.altKey)||n.metaKey)return!1;let r=t.open.options[t.open.selected],i=t.active.find(o=>o.source==r.source),s=r.completion.commitCharacters||i.result.commitCharacters;return s&&s.indexOf(n.key)>-1&&N2(e,r),!1}})),RF=gt.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"Â·Â·Â·"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'Æ'"}},".cm-completionIcon-class":{"&:after":{content:"'â'"}},".cm-completionIcon-interface":{"&:after":{content:"'â'"}},".cm-completionIcon-variable":{"&:after":{content:"'ð¥'"}},".cm-completionIcon-constant":{"&:after":{content:"'ð¶'"}},".cm-completionIcon-type":{"&:after":{content:"'ð¡'"}},".cm-completionIcon-enum":{"&:after":{content:"'âª'"}},".cm-completionIcon-property":{"&:after":{content:"'â¡'"}},".cm-completionIcon-keyword":{"&:after":{content:"'ðï¸'"}},".cm-completionIcon-namespace":{"&:after":{content:"'â¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class Ple{constructor(e,t,r,i){this.field=e,this.line=t,this.from=r,this.to=i}}class L2{constructor(e,t,r){this.field=e,this.from=t,this.to=r}map(e){let t=e.mapPos(this.from,-1,zi.TrackDel),r=e.mapPos(this.to,1,zi.TrackDel);return t==null||r==null?null:new L2(this.field,t,r)}}class Q2{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let r=[],i=[t],s=e.doc.lineAt(t),o=/^\s*/.exec(s.text)[0];for(let l of this.lines){if(r.length){let c=o,d=/^\t*/.exec(l)[0].length;for(let h=0;h<d;h++)c+=e.facet(um);i.push(t+c.length-d),l=c+l.slice(d)}r.push(l),t+=l.length+1}let a=this.fieldPositions.map(l=>new L2(l.field,i[l.line]+l.from,i[l.line]+l.to));return{text:r,ranges:a}}static parse(e){let t=[],r=[],i=[],s;for(let o of e.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(o);){let a=s[1]?+s[1]:null,l=s[2]||s[3]||"",c=-1,d=l.replace(/\\[{}]/g,h=>h[1]);for(let h=0;h<t.length;h++)(a!=null?t[h].seq==a:d&&t[h].name==d)&&(c=h);if(c<0){let h=0;for(;h<t.length&&(a==null||t[h].seq!=null&&t[h].seq<a);)h++;t.splice(h,0,{seq:a,name:d}),c=h;for(let f of i)f.field>=c&&f.field++}for(let h of i)if(h.line==r.length&&h.from>s.index){let f=s[2]?3+(s[1]||"").length:2;h.from-=f,h.to-=f}i.push(new Ple(c,r.length,s.index,s.index+d.length)),o=o.slice(0,s.index)+l+o.slice(s.index+s[0].length)}o=o.replace(/\\([{}])/g,(a,l,c)=>{for(let d of i)d.line==r.length&&d.from>c&&(d.from--,d.to--);return l}),r.push(o)}return new Q2(r,i)}}let Ile=hn.widget({widget:new class extends Yo{toDOM(){let n=document.createElement("span");return n.className="cm-snippetFieldPosition",n}ignoreEvent(){return!1}}}),Mle=hn.mark({class:"cm-snippetField"});class lf{constructor(e,t){this.ranges=e,this.active=t,this.deco=hn.set(e.map(r=>(r.from==r.to?Ile:Mle).range(r.from,r.to)),!0)}map(e){let t=[];for(let r of this.ranges){let i=r.map(e);if(!i)return null;t.push(i)}return new lf(t,this.active)}selectionInsideField(e){return e.ranges.every(t=>this.ranges.some(r=>r.field==this.active&&r.from<=t.from&&r.to>=t.to))}}const gm=en.define({map(n,e){return n&&n.map(e)}}),Rle=en.define(),yg=Cr.define({create(){return null},update(n,e){for(let t of e.effects){if(t.is(gm))return t.value;if(t.is(Rle)&&n)return new lf(n.ranges,t.value)}return n&&e.docChanged&&(n=n.map(e.changes)),n&&e.selection&&!n.selectionInsideField(e.selection)&&(n=null),n},provide:n=>gt.decorations.from(n,e=>e?e.deco:hn.none)});function $2(n,e){return rt.create(n.filter(t=>t.field==e).map(t=>rt.range(t.from,t.to)))}function Dle(n){let e=Q2.parse(n);return(t,r,i,s)=>{let{text:o,ranges:a}=e.instantiate(t.state,i),{main:l}=t.state.selection,c={changes:{from:i,to:s==l.from?l.to:s,insert:In.of(o)},scrollIntoView:!0,annotations:r?[R2.of(r),Nr.userEvent.of("input.complete")]:void 0};if(a.length&&(c.selection=$2(a,0)),a.some(d=>d.field>0)){let d=new lf(a,0),h=c.effects=[gm.of(d)];t.state.field(yg,!1)===void 0&&h.push(en.appendConfig.of([yg,Fle,zle,RF]))}t.dispatch(t.state.update(c))}}function DF(n){return({state:e,dispatch:t})=>{let r=e.field(yg,!1);if(!r||n<0&&r.active==0)return!1;let i=r.active+n,s=n>0&&!r.ranges.some(o=>o.field==i+n);return t(e.update({selection:$2(r.ranges,i),effects:gm.of(s?null:new lf(r.ranges,i)),scrollIntoView:!0})),!0}}const Nle=({state:n,dispatch:e})=>n.field(yg,!1)?(e(n.update({effects:gm.of(null)})),!0):!1,Lle=DF(1),Qle=DF(-1),$le=[{key:"Tab",run:Lle,shift:Qle},{key:"Escape",run:Nle}],rI=Ut.define({combine(n){return n.length?n[0]:$le}}),Fle=Wo.highest(Nl.compute([rI],n=>n.facet(rI)));function Gi(n,e){return{...e,apply:Dle(n)}}const zle=gt.domEventHandlers({mousedown(n,e){let t=e.state.field(yg,!1),r;if(!t||(r=e.posAtCoords({x:n.clientX,y:n.clientY}))==null)return!1;let i=t.ranges.find(s=>s.from<=r&&s.to>=r);return!i||i.field==t.active?!1:(e.dispatch({selection:$2(t.ranges,i.field),effects:gm.of(t.ranges.some(s=>s.field>i.field)?new lf(t.ranges,i.field):null),scrollIntoView:!0}),!0)}}),NF=new class extends Au{};NF.startSide=1;NF.endSide=-1;function Ble(n={}){return[Ele,$i,Gr.of(n),Ale,jle,RF]}const Ule=[{key:"Ctrl-Space",run:v1},{mac:"Alt-`",run:v1},{mac:"Alt-i",run:v1},{key:"Escape",run:xle},{key:"ArrowDown",run:Hd(!0)},{key:"ArrowUp",run:Hd(!1)},{key:"PageDown",run:Hd(!0,"page")},{key:"PageUp",run:Hd(!1,"page")},{key:"Enter",run:Ole}],jle=Wo.highest(Nl.computeN([Gr],n=>n.facet(Gr).defaultKeymap?[Ule]:[]));function Mx(n){let e=n.field($i,!1);return e&&e.active.some(t=>t.isPending)?"pending":e&&e.active.some(t=>t.state!=0)?"active":null}const F2=[vse(),k2(),ose(),_2(hoe,{fallback:!0}),Nl.of([...A2,...S2])];class o0{static create(e,t,r,i,s){let o=i+(i<<8)+e+(t<<4)|0;return new o0(e,t,r,o,s,[],[])}constructor(e,t,r,i,s,o,a){this.type=e,this.value=t,this.from=r,this.hash=i,this.end=s,this.children=o,this.positions=a,this.hashProp=[[tn.contextHash,i]]}addChild(e,t){e.prop(tn.contextHash)!=this.hash&&(e=new Bn(e.type,e.children,e.positions,e.length,this.hashProp)),this.children.push(e),this.positions.push(t)}toTree(e,t=this.end){let r=this.children.length-1;return r>=0&&(t=Math.max(t,this.positions[r]+this.children[r].length+this.from)),new Bn(e.types[this.type],this.children,this.positions,t-this.from).balance({makeTree:(i,s,o)=>new Bn(Vr.none,i,s,o,this.hashProp)})}}var vt;(function(n){n[n.Document=1]="Document",n[n.CodeBlock=2]="CodeBlock",n[n.FencedCode=3]="FencedCode",n[n.Blockquote=4]="Blockquote",n[n.HorizontalRule=5]="HorizontalRule",n[n.BulletList=6]="BulletList",n[n.OrderedList=7]="OrderedList",n[n.ListItem=8]="ListItem",n[n.ATXHeading1=9]="ATXHeading1",n[n.ATXHeading2=10]="ATXHeading2",n[n.ATXHeading3=11]="ATXHeading3",n[n.ATXHeading4=12]="ATXHeading4",n[n.ATXHeading5=13]="ATXHeading5",n[n.ATXHeading6=14]="ATXHeading6",n[n.SetextHeading1=15]="SetextHeading1",n[n.SetextHeading2=16]="SetextHeading2",n[n.HTMLBlock=17]="HTMLBlock",n[n.LinkReference=18]="LinkReference",n[n.Paragraph=19]="Paragraph",n[n.CommentBlock=20]="CommentBlock",n[n.ProcessingInstructionBlock=21]="ProcessingInstructionBlock",n[n.Escape=22]="Escape",n[n.Entity=23]="Entity",n[n.HardBreak=24]="HardBreak",n[n.Emphasis=25]="Emphasis",n[n.StrongEmphasis=26]="StrongEmphasis",n[n.Link=27]="Link",n[n.Image=28]="Image",n[n.InlineCode=29]="InlineCode",n[n.HTMLTag=30]="HTMLTag",n[n.Comment=31]="Comment",n[n.ProcessingInstruction=32]="ProcessingInstruction",n[n.Autolink=33]="Autolink",n[n.HeaderMark=34]="HeaderMark",n[n.QuoteMark=35]="QuoteMark",n[n.ListMark=36]="ListMark",n[n.LinkMark=37]="LinkMark",n[n.EmphasisMark=38]="EmphasisMark",n[n.CodeMark=39]="CodeMark",n[n.CodeText=40]="CodeText",n[n.CodeInfo=41]="CodeInfo",n[n.LinkTitle=42]="LinkTitle",n[n.LinkLabel=43]="LinkLabel",n[n.URL=44]="URL"})(vt||(vt={}));class Vle{constructor(e,t){this.start=e,this.content=t,this.marks=[],this.parsers=[]}}class qle{constructor(){this.text="",this.baseIndent=0,this.basePos=0,this.depth=0,this.markers=[],this.pos=0,this.indent=0,this.next=-1}forward(){this.basePos>this.pos&&this.forwardInner()}forwardInner(){let e=this.skipSpace(this.basePos);this.indent=this.countIndent(e,this.pos,this.indent),this.pos=e,this.next=e==this.text.length?-1:this.text.charCodeAt(e)}skipSpace(e){return Sp(this.text,e)}reset(e){for(this.text=e,this.baseIndent=this.basePos=this.pos=this.indent=0,this.forwardInner(),this.depth=1;this.markers.length;)this.markers.pop()}moveBase(e){this.basePos=e,this.baseIndent=this.countIndent(e,this.pos,this.indent)}moveBaseColumn(e){this.baseIndent=e,this.basePos=this.findColumn(e)}addMarker(e){this.markers.push(e)}countIndent(e,t=0,r=0){for(let i=t;i<e;i++)r+=this.text.charCodeAt(i)==9?4-r%4:1;return r}findColumn(e){let t=0;for(let r=0;t<this.text.length&&r<e;t++)r+=this.text.charCodeAt(t)==9?4-r%4:1;return t}scrub(){if(!this.baseIndent)return this.text;let e="";for(let t=0;t<this.basePos;t++)e+=" ";return e+this.text.slice(this.basePos)}}function iI(n,e,t){if(t.pos==t.text.length||n!=e.block&&t.indent>=e.stack[t.depth+1].value+t.baseIndent)return!0;if(t.indent>=t.baseIndent+4)return!1;let r=(n.type==vt.OrderedList?U2:B2)(t,e,!1);return r>0&&(n.type!=vt.BulletList||z2(t,e,!1)<0)&&t.text.charCodeAt(t.pos+r-1)==n.value}const LF={[vt.Blockquote](n,e,t){return t.next!=62?!1:(t.markers.push(Sn(vt.QuoteMark,e.lineStart+t.pos,e.lineStart+t.pos+1)),t.moveBase(t.pos+(ko(t.text.charCodeAt(t.pos+1))?2:1)),n.end=e.lineStart+t.text.length,!0)},[vt.ListItem](n,e,t){return t.indent<t.baseIndent+n.value&&t.next>-1?!1:(t.moveBaseColumn(t.baseIndent+n.value),!0)},[vt.OrderedList]:iI,[vt.BulletList]:iI,[vt.Document](){return!0}};function ko(n){return n==32||n==9||n==10||n==13}function Sp(n,e=0){for(;e<n.length&&ko(n.charCodeAt(e));)e++;return e}function sI(n,e,t){for(;e>t&&ko(n.charCodeAt(e-1));)e--;return e}function QF(n){if(n.next!=96&&n.next!=126)return-1;let e=n.pos+1;for(;e<n.text.length&&n.text.charCodeAt(e)==n.next;)e++;if(e<n.pos+3)return-1;if(n.next==96){for(let t=e;t<n.text.length;t++)if(n.text.charCodeAt(t)==96)return-1}return e}function $F(n){return n.next!=62?-1:n.text.charCodeAt(n.pos+1)==32?2:1}function z2(n,e,t){if(n.next!=42&&n.next!=45&&n.next!=95)return-1;let r=1;for(let i=n.pos+1;i<n.text.length;i++){let s=n.text.charCodeAt(i);if(s==n.next)r++;else if(!ko(s))return-1}return t&&n.next==45&&BF(n)>-1&&n.depth==e.stack.length&&e.parser.leafBlockParsers.indexOf(qF.SetextHeading)>-1||r<3?-1:1}function FF(n,e){for(let t=n.stack.length-1;t>=0;t--)if(n.stack[t].type==e)return!0;return!1}function B2(n,e,t){return(n.next==45||n.next==43||n.next==42)&&(n.pos==n.text.length-1||ko(n.text.charCodeAt(n.pos+1)))&&(!t||FF(e,vt.BulletList)||n.skipSpace(n.pos+2)<n.text.length)?1:-1}function U2(n,e,t){let r=n.pos,i=n.next;for(;i>=48&&i<=57;){r++;if(r==n.text.length)return-1;i=n.text.charCodeAt(r)}return r==n.pos||r>n.pos+9||i!=46&&i!=41||r<n.text.length-1&&!ko(n.text.charCodeAt(r+1))||t&&!FF(e,vt.OrderedList)&&(n.skipSpace(r+1)==n.text.length||r>n.pos+1||n.next!=49)?-1:r+1-n.pos}function zF(n){if(n.next!=35)return-1;let e=n.pos+1;for(;e<n.text.length&&n.text.charCodeAt(e)==35;)e++;if(e<n.text.length&&n.text.charCodeAt(e)!=32)return-1;let t=e-n.pos;return t>6?-1:t}function BF(n){if(n.next!=45&&n.next!=61||n.indent>=n.baseIndent+4)return-1;let e=n.pos+1;for(;e<n.text.length&&n.text.charCodeAt(e)==n.next;)e++;let t=e;for(;e<n.text.length&&ko(n.text.charCodeAt(e));)e++;return e==n.text.length?t:-1}const Rx=/^[ \t]*$/,UF=/-->/,jF=/\?>/,Dx=[[/^<(?:script|pre|style)(?:\s|>|$)/i,/<\/(?:script|pre|style)>/i],[/^\s*<!--/,UF],[/^\s*<\?/,jF],[/^\s*<![A-Z]/,/>/],[/^\s*<!\[CDATA\[/,/\]\]>/],[/^\s*<\/?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|\/?>|$)/i,Rx],[/^\s*(?:<\/[a-z][\w-]*\s*>|<[a-z][\w-]*(\s+[a-z:_][\w-.]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*>)\s*$/i,Rx]];function VF(n,e,t){if(n.next!=60)return-1;let r=n.text.slice(n.pos);for(let i=0,s=Dx.length-(t?1:0);i<s;i++)if(Dx[i][0].test(r))return i;return-1}function oI(n,e){let t=n.countIndent(e,n.pos,n.indent),r=n.countIndent(n.skipSpace(e),e,t);return r>=t+5?t+1:r}function Nc(n,e,t){let r=n.length-1;r>=0&&n[r].to==e&&n[r].type==vt.CodeText?n[r].to=t:n.push(Sn(vt.CodeText,e,t))}const yv={LinkReference:void 0,IndentedCode(n,e){let t=e.baseIndent+4;if(e.indent<t)return!1;let r=e.findColumn(t),i=n.lineStart+r,s=n.lineStart+e.text.length,o=[],a=[];for(Nc(o,i,s);n.nextLine()&&e.depth>=n.stack.length;)if(e.pos==e.text.length){Nc(a,n.lineStart-1,n.lineStart);for(let l of e.markers)a.push(l)}else{if(e.indent<t)break;{if(a.length){for(let c of a)c.type==vt.CodeText?Nc(o,c.from,c.to):o.push(c);a=[]}Nc(o,n.lineStart-1,n.lineStart);for(let c of e.markers)o.push(c);s=n.lineStart+e.text.length;let l=n.lineStart+e.findColumn(e.baseIndent+4);l<s&&Nc(o,l,s)}}return a.length&&(a=a.filter(l=>l.type!=vt.CodeText),a.length&&(e.markers=a.concat(e.markers))),n.addNode(n.buffer.writeElements(o,-i).finish(vt.CodeBlock,s-i),i),!0},FencedCode(n,e){let t=QF(e);if(t<0)return!1;let r=n.lineStart+e.pos,i=e.next,s=t-e.pos,o=e.skipSpace(t),a=sI(e.text,e.text.length,o),l=[Sn(vt.CodeMark,r,r+s)];o<a&&l.push(Sn(vt.CodeInfo,n.lineStart+o,n.lineStart+a));for(let c=!0;n.nextLine()&&e.depth>=n.stack.length;c=!1){let d=e.pos;if(e.indent-e.baseIndent<4)for(;d<e.text.length&&e.text.charCodeAt(d)==i;)d++;if(d-e.pos>=s&&e.skipSpace(d)==e.text.length){for(let h of e.markers)l.push(h);l.push(Sn(vt.CodeMark,n.lineStart+e.pos,n.lineStart+d)),n.nextLine();break}else{c||Nc(l,n.lineStart-1,n.lineStart);for(let p of e.markers)l.push(p);let h=n.lineStart+e.basePos,f=n.lineStart+e.text.length;h<f&&Nc(l,h,f)}}return n.addNode(n.buffer.writeElements(l,-r).finish(vt.FencedCode,n.prevLineEnd()-r),r),!0},Blockquote(n,e){let t=$F(e);return t<0?!1:(n.startContext(vt.Blockquote,e.pos),n.addNode(vt.QuoteMark,n.lineStart+e.pos,n.lineStart+e.pos+1),e.moveBase(e.pos+t),null)},HorizontalRule(n,e){if(z2(e,n,!1)<0)return!1;let t=n.lineStart+e.pos;return n.nextLine(),n.addNode(vt.HorizontalRule,t),!0},BulletList(n,e){let t=B2(e,n,!1);if(t<0)return!1;n.block.type!=vt.BulletList&&n.startContext(vt.BulletList,e.basePos,e.next);let r=oI(e,e.pos+1);return n.startContext(vt.ListItem,e.basePos,r-e.baseIndent),n.addNode(vt.ListMark,n.lineStart+e.pos,n.lineStart+e.pos+t),e.moveBaseColumn(r),null},OrderedList(n,e){let t=U2(e,n,!1);if(t<0)return!1;n.block.type!=vt.OrderedList&&n.startContext(vt.OrderedList,e.basePos,e.text.charCodeAt(e.pos+t-1));let r=oI(e,e.pos+t);return n.startContext(vt.ListItem,e.basePos,r-e.baseIndent),n.addNode(vt.ListMark,n.lineStart+e.pos,n.lineStart+e.pos+t),e.moveBaseColumn(r),null},ATXHeading(n,e){let t=zF(e);if(t<0)return!1;let r=e.pos,i=n.lineStart+r,s=sI(e.text,e.text.length,r),o=s;for(;o>r&&e.text.charCodeAt(o-1)==e.next;)o--;(o==s||o==r||!ko(e.text.charCodeAt(o-1)))&&(o=e.text.length);let a=n.buffer.write(vt.HeaderMark,0,t).writeElements(n.parser.parseInline(e.text.slice(r+t+1,o),i+t+1),-i);o<e.text.length&&a.write(vt.HeaderMark,o-r,s-r);let l=a.finish(vt.ATXHeading1-1+t,e.text.length-r);return n.nextLine(),n.addNode(l,i),!0},HTMLBlock(n,e){let t=VF(e,n,!1);if(t<0)return!1;let r=n.lineStart+e.pos,i=Dx[t][1],s=[],o=i!=Rx;for(;!i.test(e.text)&&n.nextLine();){if(e.depth<n.stack.length){o=!1;break}for(let c of e.markers)s.push(c)}o&&n.nextLine();let a=i==UF?vt.CommentBlock:i==jF?vt.ProcessingInstructionBlock:vt.HTMLBlock,l=n.prevLineEnd();return n.addNode(n.buffer.writeElements(s,-r).finish(a,l-r),r),!0},SetextHeading:void 0};class Hle{constructor(e){this.stage=0,this.elts=[],this.pos=0,this.start=e.start,this.advance(e.content)}nextLine(e,t,r){if(this.stage==-1)return!1;let i=r.content+`
`+t.scrub(),s=this.advance(i);return s>-1&&s<i.length?this.complete(e,r,s):!1}finish(e,t){return(this.stage==2||this.stage==3)&&Sp(t.content,this.pos)==t.content.length?this.complete(e,t,t.content.length):!1}complete(e,t,r){return e.addLeafElement(t,Sn(vt.LinkReference,this.start,this.start+r,this.elts)),!0}nextStage(e){return e?(this.pos=e.to-this.start,this.elts.push(e),this.stage++,!0):(e===!1&&(this.stage=-1),!1)}advance(e){for(;;){if(this.stage==-1)return-1;if(this.stage==0){if(!this.nextStage(ez(e,this.pos,this.start,!0)))return-1;if(e.charCodeAt(this.pos)!=58)return this.stage=-1;this.elts.push(Sn(vt.LinkMark,this.pos+this.start,this.pos+this.start+1)),this.pos++}else if(this.stage==1){if(!this.nextStage(KF(e,Sp(e,this.pos),this.start)))return-1}else if(this.stage==2){let t=Sp(e,this.pos),r=0;if(t>this.pos){let i=JF(e,t,this.start);if(i){let s=y1(e,i.to-this.start);s>0&&(this.nextStage(i),r=s)}}return r||(r=y1(e,this.pos)),r>0&&r<e.length?r:-1}else return y1(e,this.pos)}}}function y1(n,e){for(;e<n.length;e++){let t=n.charCodeAt(e);if(t==10)break;if(!ko(t))return-1}return e}class Zle{nextLine(e,t,r){let i=t.depth<e.stack.length?-1:BF(t),s=t.next;if(i<0)return!1;let o=Sn(vt.HeaderMark,e.lineStart+t.pos,e.lineStart+i);return e.nextLine(),e.addLeafElement(r,Sn(s==61?vt.SetextHeading1:vt.SetextHeading2,r.start,e.prevLineEnd(),[...e.parser.parseInline(r.content,r.start),o])),!0}finish(){return!1}}const qF={LinkReference(n,e){return e.content.charCodeAt(0)==91?new Hle(e):null},SetextHeading(){return new Zle}},Wle=[(n,e)=>zF(e)>=0,(n,e)=>QF(e)>=0,(n,e)=>$F(e)>=0,(n,e)=>B2(e,n,!0)>=0,(n,e)=>U2(e,n,!0)>=0,(n,e)=>z2(e,n,!0)>=0,(n,e)=>VF(e,n,!0)>=0],Xle={text:"",end:0};class Yle{constructor(e,t,r,i){this.parser=e,this.input=t,this.ranges=i,this.line=new qle,this.atEnd=!1,this.reusePlaceholders=new Map,this.stoppedAt=null,this.rangeI=0,this.to=i[i.length-1].to,this.lineStart=this.absoluteLineStart=this.absoluteLineEnd=i[0].from,this.block=o0.create(vt.Document,0,this.lineStart,0,0),this.stack=[this.block],this.fragments=r.length?new Jle(r,t):null,this.readLine()}get parsedPos(){return this.absoluteLineStart}advance(){if(this.stoppedAt!=null&&this.absoluteLineStart>this.stoppedAt)return this.finish();let{line:e}=this;for(;;){for(let r=0;;){let i=e.depth<this.stack.length?this.stack[this.stack.length-1]:null;for(;r<e.markers.length&&(!i||e.markers[r].from<i.end);){let s=e.markers[r++];this.addNode(s.type,s.from,s.to)}if(!i)break;this.finishContext()}if(e.pos<e.text.length)break;if(!this.nextLine())return this.finish()}if(this.fragments&&this.reuseFragment(e.basePos))return null;e:for(;;){for(let r of this.parser.blockParsers)if(r){let i=r(this,e);if(i!=!1){if(i==!0)return null;e.forward();continue e}}break}let t=new Vle(this.lineStart+e.pos,e.text.slice(e.pos));for(let r of this.parser.leafBlockParsers)if(r){let i=r(this,t);i&&t.parsers.push(i)}e:for(;this.nextLine()&&e.pos!=e.text.length;){if(e.indent<e.baseIndent+4){for(let r of this.parser.endLeafBlock)if(r(this,e,t))break e}for(let r of t.parsers)if(r.nextLine(this,e,t))return null;t.content+=`
`+e.scrub();for(let r of e.markers)t.marks.push(r)}return this.finishLeaf(t),null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}reuseFragment(e){if(!this.fragments.moveTo(this.absoluteLineStart+e,this.absoluteLineStart)||!this.fragments.matches(this.block.hash))return!1;let t=this.fragments.takeNodes(this);return t?(this.absoluteLineStart+=t,this.lineStart=tz(this.absoluteLineStart,this.ranges),this.moveRangeI(),this.absoluteLineStart<this.to?(this.lineStart++,this.absoluteLineStart++,this.readLine()):(this.atEnd=!0,this.readLine()),!0):!1}get depth(){return this.stack.length}parentType(e=this.depth-1){return this.parser.nodeSet.types[this.stack[e].type]}nextLine(){return this.lineStart+=this.line.text.length,this.absoluteLineEnd>=this.to?(this.absoluteLineStart=this.absoluteLineEnd,this.atEnd=!0,this.readLine(),!1):(this.lineStart++,this.absoluteLineStart=this.absoluteLineEnd+1,this.moveRangeI(),this.readLine(),!0)}peekLine(){return this.scanLine(this.absoluteLineEnd+1).text}moveRangeI(){for(;this.rangeI<this.ranges.length-1&&this.absoluteLineStart>=this.ranges[this.rangeI].to;)this.rangeI++,this.absoluteLineStart=Math.max(this.absoluteLineStart,this.ranges[this.rangeI].from)}scanLine(e){let t=Xle;if(t.end=e,e>=this.to)t.text="";else if(t.text=this.lineChunkAt(e),t.end+=t.text.length,this.ranges.length>1){let r=this.absoluteLineStart,i=this.rangeI;for(;this.ranges[i].to<t.end;){i++;let s=this.ranges[i].from,o=this.lineChunkAt(s);t.end=s+o.length,t.text=t.text.slice(0,this.ranges[i-1].to-r)+o,r=t.end-t.text.length}}return t}readLine(){let{line:e}=this,{text:t,end:r}=this.scanLine(this.absoluteLineStart);for(this.absoluteLineEnd=r,e.reset(t);e.depth<this.stack.length;e.depth++){let i=this.stack[e.depth],s=this.parser.skipContextMarkup[i.type];if(!s)throw new Error("Unhandled block context "+vt[i.type]);let o=this.line.markers.length;if(!s(i,this,e)){this.line.markers.length>o&&(i.end=this.line.markers[this.line.markers.length-1].to);break}e.forward()}}lineChunkAt(e){let t=this.input.chunk(e),r;if(this.input.lineChunks)r=t==`
`?"":t;else{let i=t.indexOf(`
`);r=i<0?t:t.slice(0,i)}return e+r.length>this.to?r.slice(0,this.to-e):r}prevLineEnd(){return this.atEnd?this.lineStart:this.lineStart-1}startContext(e,t,r=0){this.block=o0.create(e,r,this.lineStart+t,this.block.hash,this.lineStart+this.line.text.length),this.stack.push(this.block)}startComposite(e,t,r=0){this.startContext(this.parser.getNodeType(e),t,r)}addNode(e,t,r){typeof e=="number"&&(e=new Bn(this.parser.nodeSet.types[e],Fh,Fh,(r??this.prevLineEnd())-t)),this.block.addChild(e,t-this.block.from)}addElement(e){this.block.addChild(e.toTree(this.parser.nodeSet),e.from-this.block.from)}addLeafElement(e,t){this.addNode(this.buffer.writeElements(Lx(t.children,e.marks),-t.from).finish(t.type,t.to-t.from),t.from)}finishContext(){let e=this.stack.pop(),t=this.stack[this.stack.length-1];t.addChild(e.toTree(this.parser.nodeSet),e.from-t.from),this.block=t}finish(){for(;this.stack.length>1;)this.finishContext();return this.addGaps(this.block.toTree(this.parser.nodeSet,this.lineStart))}addGaps(e){return this.ranges.length>1?HF(this.ranges,0,e.topNode,this.ranges[0].from,this.reusePlaceholders):e}finishLeaf(e){for(let r of e.parsers)if(r.finish(this,e))return;let t=Lx(this.parser.parseInline(e.content,e.start),e.marks);this.addNode(this.buffer.writeElements(t,-e.start).finish(vt.Paragraph,e.content.length),e.start)}elt(e,t,r,i){return typeof e=="string"?Sn(this.parser.getNodeType(e),t,r,i):new XF(e,t)}get buffer(){return new WF(this.parser.nodeSet)}}function HF(n,e,t,r,i){let s=n[e].to,o=[],a=[],l=t.from+r;function c(d,h){for(;h?d>=s:d>s;){let f=n[e+1].from-s;r+=f,d+=f,e++,s=n[e].to}}for(let d=t.firstChild;d;d=d.nextSibling){c(d.from+r,!0);let h=d.from+r,f,p=i.get(d.tree);p?f=p:d.to+r>s?(f=HF(n,e,d,r,i),c(d.to+r,!1)):f=d.toTree(),o.push(f),a.push(h-l)}return c(t.to+r,!1),new Bn(t.type,o,a,t.to+r-l,t.tree?t.tree.propValues:void 0)}class Nb extends m2{constructor(e,t,r,i,s,o,a,l,c){super(),this.nodeSet=e,this.blockParsers=t,this.leafBlockParsers=r,this.blockNames=i,this.endLeafBlock=s,this.skipContextMarkup=o,this.inlineParsers=a,this.inlineNames=l,this.wrappers=c,this.nodeTypes=Object.create(null);for(let d of e.types)this.nodeTypes[d.name]=d.id}createParse(e,t,r){let i=new Yle(this,e,t,r);for(let s of this.wrappers)i=s(i,e,t,r);return i}configure(e){let t=Nx(e);if(!t)return this;let{nodeSet:r,skipContextMarkup:i}=this,s=this.blockParsers.slice(),o=this.leafBlockParsers.slice(),a=this.blockNames.slice(),l=this.inlineParsers.slice(),c=this.inlineNames.slice(),d=this.endLeafBlock.slice(),h=this.wrappers;if(Mf(t.defineNodes)){i=Object.assign({},i);let f=r.types.slice(),p;for(let g of t.defineNodes){let{name:m,block:v,composite:y,style:O}=typeof g=="string"?{name:g}:g;if(f.some(k=>k.name==m))continue;y&&(i[f.length]=(k,S,E)=>y(S,E,k.value));let _=f.length,x=y?["Block","BlockContext"]:v?_>=vt.ATXHeading1&&_<=vt.SetextHeading2?["Block","LeafBlock","Heading"]:["Block","LeafBlock"]:void 0;f.push(Vr.define({id:_,name:m,props:x&&[[tn.group,x]]})),O&&(p||(p={}),Array.isArray(O)||O instanceof As?p[m]=O:Object.assign(p,O))}r=new cm(f),p&&(r=r.extend(rf(p)))}if(Mf(t.props)&&(r=r.extend(...t.props)),Mf(t.remove))for(let f of t.remove){let p=this.blockNames.indexOf(f),g=this.inlineNames.indexOf(f);p>-1&&(s[p]=o[p]=void 0),g>-1&&(l[g]=void 0)}if(Mf(t.parseBlock))for(let f of t.parseBlock){let p=a.indexOf(f.name);if(p>-1)s[p]=f.parse,o[p]=f.leaf;else{let g=f.before?bv(a,f.before):f.after?bv(a,f.after)+1:a.length-1;s.splice(g,0,f.parse),o.splice(g,0,f.leaf),a.splice(g,0,f.name)}f.endLeaf&&d.push(f.endLeaf)}if(Mf(t.parseInline))for(let f of t.parseInline){let p=c.indexOf(f.name);if(p>-1)l[p]=f.parse;else{let g=f.before?bv(c,f.before):f.after?bv(c,f.after)+1:c.length-1;l.splice(g,0,f.parse),c.splice(g,0,f.name)}}return t.wrap&&(h=h.concat(t.wrap)),new Nb(r,s,o,a,d,i,l,c,h)}getNodeType(e){let t=this.nodeTypes[e];if(t==null)throw new RangeError(`Unknown node type '${e}'`);return t}parseInline(e,t){let r=new j2(this,e,t);e:for(let i=t;i<r.end;){let s=r.char(i);for(let o of this.inlineParsers)if(o){let a=o(r,s,i);if(a>=0){i=a;continue e}}i++}return r.resolveMarkers(0)}}function Mf(n){return n!=null&&n.length>0}function Nx(n){if(!Array.isArray(n))return n;if(n.length==0)return null;let e=Nx(n[0]);if(n.length==1)return e;let t=Nx(n.slice(1));if(!t||!e)return e||t;let r=(o,a)=>(o||Fh).concat(a||Fh),i=e.wrap,s=t.wrap;return{props:r(e.props,t.props),defineNodes:r(e.defineNodes,t.defineNodes),parseBlock:r(e.parseBlock,t.parseBlock),parseInline:r(e.parseInline,t.parseInline),remove:r(e.remove,t.remove),wrap:i?s?(o,a,l,c)=>i(s(o,a,l,c),a,l,c):i:s}}function bv(n,e){let t=n.indexOf(e);if(t<0)throw new RangeError(`Position specified relative to unknown parser ${e}`);return t}let ZF=[Vr.none];for(let n=1,e;e=vt[n];n++)ZF[n]=Vr.define({id:n,name:e,props:n>=vt.Escape?[]:[[tn.group,n in LF?["Block","BlockContext"]:["Block","LeafBlock"]]],top:e=="Document"});const Fh=[];let WF=class{constructor(e){this.nodeSet=e,this.content=[],this.nodes=[]}write(e,t,r,i=0){return this.content.push(e,t,r,4+i*4),this}writeElements(e,t=0){for(let r of e)r.writeTo(this,t);return this}finish(e,t){return Bn.build({buffer:this.content,nodeSet:this.nodeSet,reused:this.nodes,topID:e,length:t})}},bg=class{constructor(e,t,r,i=Fh){this.type=e,this.from=t,this.to=r,this.children=i}writeTo(e,t){let r=e.content.length;e.writeElements(this.children,t),e.content.push(this.type,this.from+t,this.to+t,e.content.length+4-r)}toTree(e){return new WF(e).writeElements(this.children,-this.from).finish(this.type,this.to-this.from)}};class XF{constructor(e,t){this.tree=e,this.from=t}get to(){return this.from+this.tree.length}get type(){return this.tree.type.id}get children(){return Fh}writeTo(e,t){e.nodes.push(this.tree),e.content.push(e.nodes.length-1,this.from+t,this.to+t,-1)}toTree(){return this.tree}}function Sn(n,e,t,r){return new bg(n,e,t,r)}const YF={resolve:"Emphasis",mark:"EmphasisMark"},GF={resolve:"Emphasis",mark:"EmphasisMark"},Kc={},a0={};class Ss{constructor(e,t,r,i){this.type=e,this.from=t,this.to=r,this.side=i}}const aI="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";let wg=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\u2010-\u2027]/;try{wg=new RegExp("[\\p{S}|\\p{P}]","u")}catch{}const b1={Escape(n,e,t){if(e!=92||t==n.end-1)return-1;let r=n.char(t+1);for(let i=0;i<aI.length;i++)if(aI.charCodeAt(i)==r)return n.append(Sn(vt.Escape,t,t+2));return-1},Entity(n,e,t){if(e!=38)return-1;let r=/^(?:#\d+|#x[a-f\d]+|\w+);/i.exec(n.slice(t+1,t+31));return r?n.append(Sn(vt.Entity,t,t+1+r[0].length)):-1},InlineCode(n,e,t){if(e!=96||t&&n.char(t-1)==96)return-1;let r=t+1;for(;r<n.end&&n.char(r)==96;)r++;let i=r-t,s=0;for(;r<n.end;r++)if(n.char(r)==96){if(s++,s==i&&n.char(r+1)!=96)return n.append(Sn(vt.InlineCode,t,r+1,[Sn(vt.CodeMark,t,t+i),Sn(vt.CodeMark,r+1-i,r+1)]))}else s=0;return-1},HTMLTag(n,e,t){if(e!=60||t==n.end-1)return-1;let r=n.slice(t+1,n.end),i=/^(?:[a-z][-\w+.]+:[^\s>]+|[a-z\d.!#$%&'*+/=?^_`{|}~-]+@[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?(?:\.[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?)*)>/i.exec(r);if(i)return n.append(Sn(vt.Autolink,t,t+1+i[0].length,[Sn(vt.LinkMark,t,t+1),Sn(vt.URL,t+1,t+i[0].length),Sn(vt.LinkMark,t+i[0].length,t+1+i[0].length)]));let s=/^!--[^>](?:-[^-]|[^-])*?-->/i.exec(r);if(s)return n.append(Sn(vt.Comment,t,t+1+s[0].length));let o=/^\?[^]*?\?>/.exec(r);if(o)return n.append(Sn(vt.ProcessingInstruction,t,t+1+o[0].length));let a=/^(?:![A-Z][^]*?>|!\[CDATA\[[^]*?\]\]>|\/\s*[a-zA-Z][\w-]*\s*>|\s*[a-zA-Z][\w-]*(\s+[a-zA-Z:_][\w-.:]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*(\/\s*)?>)/.exec(r);return a?n.append(Sn(vt.HTMLTag,t,t+1+a[0].length)):-1},Emphasis(n,e,t){if(e!=95&&e!=42)return-1;let r=t+1;for(;n.char(r)==e;)r++;let i=n.slice(t-1,t),s=n.slice(r,r+1),o=wg.test(i),a=wg.test(s),l=/\s|^$/.test(i),c=/\s|^$/.test(s),d=!c&&(!a||l||o),h=!l&&(!o||c||a),f=d&&(e==42||!h||o),p=h&&(e==42||!d||a);return n.append(new Ss(e==95?YF:GF,t,r,(f?1:0)|(p?2:0)))},HardBreak(n,e,t){if(e==92&&n.char(t+1)==10)return n.append(Sn(vt.HardBreak,t,t+2));if(e==32){let r=t+1;for(;n.char(r)==32;)r++;if(n.char(r)==10&&r>=t+2)return n.append(Sn(vt.HardBreak,t,r+1))}return-1},Link(n,e,t){return e==91?n.append(new Ss(Kc,t,t+1,1)):-1},Image(n,e,t){return e==33&&n.char(t+1)==91?n.append(new Ss(a0,t,t+2,1)):-1},LinkEnd(n,e,t){if(e!=93)return-1;for(let r=n.parts.length-1;r>=0;r--){let i=n.parts[r];if(i instanceof Ss&&(i.type==Kc||i.type==a0)){if(!i.side||n.skipSpace(i.to)==t&&!/[(\[]/.test(n.slice(t+1,t+2)))return n.parts[r]=null,-1;let s=n.takeContent(r),o=n.parts[r]=Gle(n,s,i.type==Kc?vt.Link:vt.Image,i.from,t+1);if(i.type==Kc)for(let a=0;a<r;a++){let l=n.parts[a];l instanceof Ss&&l.type==Kc&&(l.side=0)}return o.to}}return-1}};function Gle(n,e,t,r,i){let{text:s}=n,o=n.char(i),a=i;if(e.unshift(Sn(vt.LinkMark,r,r+(t==vt.Image?2:1))),e.push(Sn(vt.LinkMark,i-1,i)),o==40){let l=n.skipSpace(i+1),c=KF(s,l-n.offset,n.offset),d;c&&(l=n.skipSpace(c.to),l!=c.to&&(d=JF(s,l-n.offset,n.offset),d&&(l=n.skipSpace(d.to)))),n.char(l)==41&&(e.push(Sn(vt.LinkMark,i,i+1)),a=l+1,c&&e.push(c),d&&e.push(d),e.push(Sn(vt.LinkMark,l,a)))}else if(o==91){let l=ez(s,i-n.offset,n.offset,!1);l&&(e.push(l),a=l.to)}return Sn(t,r,a,e)}function KF(n,e,t){if(n.charCodeAt(e)==60){for(let i=e+1;i<n.length;i++){let s=n.charCodeAt(i);if(s==62)return Sn(vt.URL,e+t,i+1+t);if(s==60||s==10)return!1}return null}else{let i=0,s=e;for(let o=!1;s<n.length;s++){let a=n.charCodeAt(s);if(ko(a))break;if(o)o=!1;else if(a==40)i++;else if(a==41){if(!i)break;i--}else a==92&&(o=!0)}return s>e?Sn(vt.URL,e+t,s+t):s==n.length?null:!1}}function JF(n,e,t){let r=n.charCodeAt(e);if(r!=39&&r!=34&&r!=40)return!1;let i=r==40?41:r;for(let s=e+1,o=!1;s<n.length;s++){let a=n.charCodeAt(s);if(o)o=!1;else{if(a==i)return Sn(vt.LinkTitle,e+t,s+1+t);a==92&&(o=!0)}}return null}function ez(n,e,t,r){for(let i=!1,s=e+1,o=Math.min(n.length,s+999);s<o;s++){let a=n.charCodeAt(s);if(i)i=!1;else{if(a==93)return r?!1:Sn(vt.LinkLabel,e+t,s+1+t);if(r&&!ko(a)&&(r=!1),a==91)return!1;a==92&&(i=!0)}}return null}class j2{constructor(e,t,r){this.parser=e,this.text=t,this.offset=r,this.parts=[]}char(e){return e>=this.end?-1:this.text.charCodeAt(e-this.offset)}get end(){return this.offset+this.text.length}slice(e,t){return this.text.slice(e-this.offset,t-this.offset)}append(e){return this.parts.push(e),e.to}addDelimiter(e,t,r,i,s){return this.append(new Ss(e,t,r,(i?1:0)|(s?2:0)))}get hasOpenLink(){for(let e=this.parts.length-1;e>=0;e--){let t=this.parts[e];if(t instanceof Ss&&(t.type==Kc||t.type==a0))return!0}return!1}addElement(e){return this.append(e)}resolveMarkers(e){for(let r=e;r<this.parts.length;r++){let i=this.parts[r];if(!(i instanceof Ss&&i.type.resolve&&i.side&2))continue;let s=i.type==YF||i.type==GF,o=i.to-i.from,a,l=r-1;for(;l>=e;l--){let m=this.parts[l];if(m instanceof Ss&&m.side&1&&m.type==i.type&&!(s&&(i.side&1||m.side&2)&&(m.to-m.from+o)%3==0&&((m.to-m.from)%3||o%3))){a=m;break}}if(!a)continue;let c=i.type.resolve,d=[],h=a.from,f=i.to;if(s){let m=Math.min(2,a.to-a.from,o);h=a.to-m,f=i.from+m,c=m==1?"Emphasis":"StrongEmphasis"}a.type.mark&&d.push(this.elt(a.type.mark,h,a.to));for(let m=l+1;m<r;m++)this.parts[m]instanceof bg&&d.push(this.parts[m]),this.parts[m]=null;i.type.mark&&d.push(this.elt(i.type.mark,i.from,f));let p=this.elt(c,h,f,d);this.parts[l]=s&&a.from!=h?new Ss(a.type,a.from,h,a.side):null,(this.parts[r]=s&&i.to!=f?new Ss(i.type,f,i.to,i.side):null)?this.parts.splice(r,0,p):this.parts[r]=p}let t=[];for(let r=e;r<this.parts.length;r++){let i=this.parts[r];i instanceof bg&&t.push(i)}return t}findOpeningDelimiter(e){for(let t=this.parts.length-1;t>=0;t--){let r=this.parts[t];if(r instanceof Ss&&r.type==e&&r.side&1)return t}return null}takeContent(e){let t=this.resolveMarkers(e);return this.parts.length=e,t}getDelimiterAt(e){let t=this.parts[e];return t instanceof Ss?t:null}skipSpace(e){return Sp(this.text,e-this.offset)+this.offset}elt(e,t,r,i){return typeof e=="string"?Sn(this.parser.getNodeType(e),t,r,i):new XF(e,t)}}j2.linkStart=Kc;j2.imageStart=a0;function Lx(n,e){if(!e.length)return n;if(!n.length)return e;let t=n.slice(),r=0;for(let i of e){for(;r<t.length&&t[r].to<i.to;)r++;if(r<t.length&&t[r].from<i.from){let s=t[r];s instanceof bg&&(t[r]=new bg(s.type,s.from,s.to,Lx(s.children,[i])))}else t.splice(r++,0,i)}return t}const Kle=[vt.CodeBlock,vt.ListItem,vt.OrderedList,vt.BulletList];let Jle=class{constructor(e,t){this.fragments=e,this.input=t,this.i=0,this.fragment=null,this.fragmentEnd=-1,this.cursor=null,e.length&&(this.fragment=e[this.i++])}nextFragment(){this.fragment=this.i<this.fragments.length?this.fragments[this.i++]:null,this.cursor=null,this.fragmentEnd=-1}moveTo(e,t){for(;this.fragment&&this.fragment.to<=e;)this.nextFragment();if(!this.fragment||this.fragment.from>(e?e-1:0))return!1;if(this.fragmentEnd<0){let s=this.fragment.to;for(;s>0&&this.input.read(s-1,s)!=`
`;)s--;this.fragmentEnd=s?s-1:0}let r=this.cursor;r||(r=this.cursor=this.fragment.tree.cursor(),r.firstChild());let i=e+this.fragment.offset;for(;r.to<=i;)if(!r.parent())return!1;for(;;){if(r.from>=i)return this.fragment.from<=t;if(!r.childAfter(i))return!1}}matches(e){let t=this.cursor.tree;return t&&t.prop(tn.contextHash)==e}takeNodes(e){let t=this.cursor,r=this.fragment.offset,i=this.fragmentEnd-(this.fragment.openEnd?1:0),s=e.absoluteLineStart,o=s,a=e.block.children.length,l=o,c=a;for(;;){if(t.to-r>i){if(t.type.isAnonymous&&t.firstChild())continue;break}let d=tz(t.from-r,e.ranges);if(t.to-r<=e.ranges[e.rangeI].to)e.addNode(t.tree,d);else{let h=new Bn(e.parser.nodeSet.types[vt.Paragraph],[],[],0,e.block.hashProp);e.reusePlaceholders.set(h,t.tree),e.addNode(h,d)}if(t.type.is("Block")&&(Kle.indexOf(t.type.id)<0?(o=t.to-r,a=e.block.children.length):(o=l,a=c,l=t.to-r,c=e.block.children.length)),!t.nextSibling())break}for(;e.block.children.length>a;)e.block.children.pop(),e.block.positions.pop();return o-s}};function tz(n,e){let t=n;for(let r=1;r<e.length;r++){let i=e[r-1].to,s=e[r].from;i<n&&(t-=s-i)}return t}const ece=rf({"Blockquote/...":K.quote,HorizontalRule:K.contentSeparator,"ATXHeading1/... SetextHeading1/...":K.heading1,"ATXHeading2/... SetextHeading2/...":K.heading2,"ATXHeading3/...":K.heading3,"ATXHeading4/...":K.heading4,"ATXHeading5/...":K.heading5,"ATXHeading6/...":K.heading6,"Comment CommentBlock":K.comment,Escape:K.escape,Entity:K.character,"Emphasis/...":K.emphasis,"StrongEmphasis/...":K.strong,"Link/... Image/...":K.link,"OrderedList/... BulletList/...":K.list,"BlockQuote/...":K.quote,"InlineCode CodeText":K.monospace,"URL Autolink":K.url,"HeaderMark HardBreak QuoteMark ListMark LinkMark EmphasisMark CodeMark":K.processingInstruction,"CodeInfo LinkLabel":K.labelName,LinkTitle:K.string,Paragraph:K.content}),tce=new Nb(new cm(ZF).extend(ece),Object.keys(yv).map(n=>yv[n]),Object.keys(yv).map(n=>qF[n]),Object.keys(yv),Wle,LF,Object.keys(b1).map(n=>b1[n]),Object.keys(b1),[]);function nce(n,e,t){let r=[];for(let i=n.firstChild,s=e;;i=i.nextSibling){let o=i?i.from:t;if(o>s&&r.push({from:s,to:o}),!i)break;s=i.to}return r}function rce(n){let{codeParser:e,htmlParser:t}=n;return{wrap:P6((i,s)=>{let o=i.type.id;if(e&&(o==vt.CodeBlock||o==vt.FencedCode)){let a="";if(o==vt.FencedCode){let c=i.node.getChild(vt.CodeInfo);c&&(a=s.read(c.from,c.to))}let l=e(a);if(l)return{parser:l,overlay:c=>c.type.id==vt.CodeText}}else if(t&&(o==vt.HTMLBlock||o==vt.HTMLTag||o==vt.CommentBlock))return{parser:t,overlay:nce(i.node,i.from,i.to)};return null})}}const ice={resolve:"Strikethrough",mark:"StrikethroughMark"},sce={defineNodes:[{name:"Strikethrough",style:{"Strikethrough/...":K.strikethrough}},{name:"StrikethroughMark",style:K.processingInstruction}],parseInline:[{name:"Strikethrough",parse(n,e,t){if(e!=126||n.char(t+1)!=126||n.char(t+2)==126)return-1;let r=n.slice(t-1,t),i=n.slice(t+2,t+3),s=/\s|^$/.test(r),o=/\s|^$/.test(i),a=wg.test(r),l=wg.test(i);return n.addDelimiter(ice,t,t+2,!o&&(!l||s||a),!s&&(!a||o||l))},after:"Emphasis"}]};function Tp(n,e,t=0,r,i=0){let s=0,o=!0,a=-1,l=-1,c=!1,d=()=>{r.push(n.elt("TableCell",i+a,i+l,n.parser.parseInline(e.slice(a,l),i+a)))};for(let h=t;h<e.length;h++){let f=e.charCodeAt(h);f==124&&!c?((!o||a>-1)&&s++,o=!1,r&&(a>-1&&d(),r.push(n.elt("TableDelimiter",h+i,h+i+1))),a=l=-1):(c||f!=32&&f!=9)&&(a<0&&(a=h),l=h+1),c=!c&&f==92}return a>-1&&(s++,r&&d()),s}function lI(n,e){for(let t=e;t<n.length;t++){let r=n.charCodeAt(t);if(r==124)return!0;r==92&&t++}return!1}const nz=/^\|?(\s*:?-+:?\s*\|)+(\s*:?-+:?\s*)?$/;class cI{constructor(){this.rows=null}nextLine(e,t,r){if(this.rows==null){this.rows=!1;let i;if((t.next==45||t.next==58||t.next==124)&&nz.test(i=t.text.slice(t.pos))){let s=[];Tp(e,r.content,0,s,r.start)==Tp(e,i,t.pos)&&(this.rows=[e.elt("TableHeader",r.start,r.start+r.content.length,s),e.elt("TableDelimiter",e.lineStart+t.pos,e.lineStart+t.text.length)])}}else if(this.rows){let i=[];Tp(e,t.text,t.pos,i,e.lineStart),this.rows.push(e.elt("TableRow",e.lineStart+t.pos,e.lineStart+t.text.length,i))}return!1}finish(e,t){return this.rows?(e.addLeafElement(t,e.elt("Table",t.start,t.start+t.content.length,this.rows)),!0):!1}}const oce={defineNodes:[{name:"Table",block:!0},{name:"TableHeader",style:{"TableHeader/...":K.heading}},"TableRow",{name:"TableCell",style:K.content},{name:"TableDelimiter",style:K.processingInstruction}],parseBlock:[{name:"Table",leaf(n,e){return lI(e.content,0)?new cI:null},endLeaf(n,e,t){if(t.parsers.some(i=>i instanceof cI)||!lI(e.text,e.basePos))return!1;let r=n.peekLine();return nz.test(r)&&Tp(n,e.text,e.basePos)==Tp(n,r,e.basePos)},before:"SetextHeading"}]};class ace{nextLine(){return!1}finish(e,t){return e.addLeafElement(t,e.elt("Task",t.start,t.start+t.content.length,[e.elt("TaskMarker",t.start,t.start+3),...e.parser.parseInline(t.content.slice(3),t.start+3)])),!0}}const lce={defineNodes:[{name:"Task",block:!0,style:K.list},{name:"TaskMarker",style:K.atom}],parseBlock:[{name:"TaskList",leaf(n,e){return/^\[[ xX]\][ \t]/.test(e.content)&&n.parentType().name=="ListItem"?new ace:null},after:"SetextHeading"}]},uI=/(www\.)|(https?:\/\/)|([\w.+-]{1,100}@)|(mailto:|xmpp:)/gy,dI=/[\w-]+(\.[\w-]+)+(\/[^\s<]*)?/gy,cce=/[\w-]+\.[\w-]+($|\/)/,hI=/[\w.+-]+@[\w-]+(\.[\w.-]+)+/gy,fI=/\/[a-zA-Z\d@.]+/gy;function pI(n,e,t,r){let i=0;for(let s=e;s<t;s++)n[s]==r&&i++;return i}function uce(n,e){dI.lastIndex=e;let t=dI.exec(n);if(!t||cce.exec(t[0])[0].indexOf("_")>-1)return-1;let r=e+t[0].length;for(;;){let i=n[r-1],s;if(/[?!.,:*_~]/.test(i)||i==")"&&pI(n,e,r,")")>pI(n,e,r,"("))r--;else if(i==";"&&(s=/&(?:#\d+|#x[a-f\d]+|\w+);$/.exec(n.slice(e,r))))r=e+s.index;else break}return r}function gI(n,e){hI.lastIndex=e;let t=hI.exec(n);if(!t)return-1;let r=t[0][t[0].length-1];return r=="_"||r=="-"?-1:e+t[0].length-(r=="."?1:0)}const dce={parseInline:[{name:"Autolink",parse(n,e,t){let r=t-n.offset;if(r&&/\w/.test(n.text[r-1]))return-1;uI.lastIndex=r;let i=uI.exec(n.text),s=-1;if(!i)return-1;if(i[1]||i[2]){if(s=uce(n.text,r+i[0].length),s>-1&&n.hasOpenLink){let o=/([^\[\]]|\[[^\]]*\])*/.exec(n.text.slice(r,s));s=r+o[0].length}}else i[3]?s=gI(n.text,r):(s=gI(n.text,r+i[0].length),s>-1&&i[0]=="xmpp:"&&(fI.lastIndex=s,i=fI.exec(n.text),i&&(s=i.index+i[0].length)));return s<0?-1:(n.addElement(n.elt("URL",t,s+n.offset)),s+n.offset)}}]},hce=[oce,lce,sce,dce];function rz(n,e,t){return(r,i,s)=>{if(i!=n||r.char(s+1)==n)return-1;let o=[r.elt(t,s,s+1)];for(let a=s+1;a<r.end;a++){let l=r.char(a);if(l==n)return r.addElement(r.elt(e,s,a+1,o.concat(r.elt(t,a,a+1))));if(l==92&&o.push(r.elt("Escape",a,a+++2)),ko(l))break}return-1}}const fce={defineNodes:[{name:"Superscript",style:K.special(K.content)},{name:"SuperscriptMark",style:K.processingInstruction}],parseInline:[{name:"Superscript",parse:rz(94,"Superscript","SuperscriptMark")}]},pce={defineNodes:[{name:"Subscript",style:K.special(K.content)},{name:"SubscriptMark",style:K.processingInstruction}],parseInline:[{name:"Subscript",parse:rz(126,"Subscript","SubscriptMark")}]},gce={defineNodes:[{name:"Emoji",style:K.character}],parseInline:[{name:"Emoji",parse(n,e,t){let r;return e!=58||!(r=/^[a-zA-Z_0-9]+:/.exec(n.slice(t+1,n.end)))?-1:n.addElement(n.elt("Emoji",t,t+1+r[0].length))}}]};var mI={};class l0{constructor(e,t,r,i,s,o,a,l,c,d=0,h){this.p=e,this.stack=t,this.state=r,this.reducePos=i,this.pos=s,this.score=o,this.buffer=a,this.bufferBase=l,this.curContext=c,this.lookAhead=d,this.parent=h}toString(){return`[${this.stack.filter((e,t)=>t%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,r=0){let i=e.parser.context;return new l0(e,[],t,r,r,0,[],0,i?new vI(i,i.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let r=e>>19,i=e&65535,{parser:s}=this.p,o=this.reducePos<this.pos-25&&this.setLookAhead(this.pos),a=s.dynamicPrecedence(i);if(a&&(this.score+=a),r==0){this.pushState(s.getGoto(this.state,i,!0),this.reducePos),i<s.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,o?8:4,!0),this.reduceContext(i,this.reducePos);return}let l=this.stack.length-(r-1)*3-(e&262144?6:0),c=l?this.stack[l-2]:this.p.ranges[0].from,d=this.reducePos-c;d>=2e3&&!(!((t=this.p.parser.nodeSet.types[i])===null||t===void 0)&&t.isAnonymous)&&(c==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=d):this.p.lastBigReductionSize<d&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=c,this.p.lastBigReductionSize=d));let h=l?this.stack[l-1]:0,f=this.bufferBase+this.buffer.length-h;if(i<s.minRepeatTerm||e&131072){let p=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,c,p,f+4,!0)}if(e&262144)this.state=this.stack[l];else{let p=this.stack[l-3];this.state=s.getGoto(p,i,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(i,c)}storeNode(e,t,r,i=4,s=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,a=this.buffer.length;if(a==0&&o.parent&&(a=o.bufferBase-o.parent.bufferBase,o=o.parent),a>0&&o.buffer[a-4]==0&&o.buffer[a-1]>-1){if(t==r)return;if(o.buffer[a-2]>=t){o.buffer[a-2]=r;return}}}if(!s||this.pos==r)this.buffer.push(e,t,r,i);else{let o=this.buffer.length;if(o>0&&(this.buffer[o-4]!=0||this.buffer[o-1]<0)){let a=!1;for(let l=o;l>0&&this.buffer[l-2]>r;l-=4)if(this.buffer[l-1]>=0){a=!0;break}if(a)for(;o>0&&this.buffer[o-2]>r;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,i>4&&(i-=4)}this.buffer[o]=e,this.buffer[o+1]=t,this.buffer[o+2]=r,this.buffer[o+3]=i}}shift(e,t,r,i){if(e&131072)this.pushState(e&65535,this.pos);else if((e&262144)==0){let s=e,{parser:o}=this.p;(i>this.pos||t<=o.maxNode)&&(this.pos=i,o.stateFlag(s,1)||(this.reducePos=i)),this.pushState(s,r),this.shiftContext(t,r),t<=o.maxNode&&this.buffer.push(t,r,i,4)}else this.pos=i,this.shiftContext(t,r),t<=this.p.parser.maxNode&&this.buffer.push(t,r,i,4)}apply(e,t,r,i){e&65536?this.reduce(e):this.shift(e,t,r,i)}useNode(e,t){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=e)&&(this.p.reused.push(e),r++);let i=this.pos;this.reducePos=this.pos=i+e.length,this.pushState(t,i),this.buffer.push(r,i,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let r=e.buffer.slice(t),i=e.bufferBase+t;for(;e&&i==e.bufferBase;)e=e.parent;return new l0(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,i,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let r=e<=this.p.parser.maxNode;r&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,r?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new mce(this);;){let r=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(r==0)return!1;if((r&65536)==0)return!0;t.reduce(r)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let i=[];for(let s=0,o;s<t.length;s+=2)(o=t[s+1])!=this.state&&this.p.parser.hasAction(o,e)&&i.push(t[s],o);if(this.stack.length<120)for(let s=0;i.length<8&&s<t.length;s+=2){let o=t[s+1];i.some((a,l)=>l&1&&a==o)||i.push(t[s],o)}t=i}let r=[];for(let i=0;i<t.length&&r.length<4;i+=2){let s=t[i+1];if(s==this.state)continue;let o=this.split();o.pushState(s,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(t[i],this.pos),o.reducePos=this.pos,o.score-=200,r.push(o)}return r}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if((t&65536)==0)return!1;if(!e.validAction(this.state,t)){let r=t>>19,i=t&65535,s=this.stack.length-r*3;if(s<0||e.getGoto(this.stack[s],i,!1)<0){let o=this.findForcedReduction();if(o==null)return!1;t=o}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],r=(i,s)=>{if(!t.includes(i))return t.push(i),e.allActions(i,o=>{if(!(o&393216))if(o&65536){let a=(o>>19)-s;if(a>1){let l=o&65535,c=this.stack.length-a*3;if(c>=0&&e.getGoto(this.stack[c],l,!1)>=0)return a<<19|65536|l}}else{let a=r(o,s+1);if(a!=null)return a}})};return r(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new vI(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){return e<=this.lookAhead?!1:(this.emitLookAhead(),this.lookAhead=e,!0)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class vI{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class mce{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=e&65535,r=e>>19;r==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(r-1)*3;let i=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=i}}class c0{constructor(e,t,r){this.stack=e,this.pos=t,this.index=r,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new c0(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new c0(this.stack,this.pos,this.index)}}function ap(n,e=Uint16Array){if(typeof n!="string")return n;let t=null;for(let r=0,i=0;r<n.length;){let s=0;for(;;){let o=n.charCodeAt(r++),a=!1;if(o==126){s=65535;break}o>=92&&o--,o>=34&&o--;let l=o-32;if(l>=46&&(l-=46,a=!0),s+=l,a)break;s*=46}t?t[i++]=s:t=new e(s)}return t}class Jv{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const yI=new Jv;class vce{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=yI,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let r=this.range,i=this.rangeIndex,s=this.pos+e;for(;s<r.from;){if(!i)return null;let o=this.ranges[--i];s-=r.from-o.to,r=o}for(;t<0?s>r.to:s>=r.to;){if(i==this.ranges.length-1)return null;let o=this.ranges[++i];s+=o.from-r.to,r=o}return s}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t=this.chunkOff+e,r,i;if(t>=0&&t<this.chunk.length)r=this.pos+e,i=this.chunk.charCodeAt(t);else{let s=this.resolveOffset(e,1);if(s==null)return-1;if(r=s,r>=this.chunk2Pos&&r<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(r-this.chunk2Pos);else{let o=this.rangeIndex,a=this.range;for(;a.to<=r;)a=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=r),r+this.chunk2.length>a.to&&(this.chunk2=this.chunk2.slice(0,a.to-r)),i=this.chunk2.charCodeAt(0)}}return r>=this.token.lookAhead&&(this.token.lookAhead=r+1),i}acceptToken(e,t=0){let r=t?this.resolveOffset(t,-1):this.pos;if(r==null||r<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=r}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=yI,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let r="";for(let i of this.ranges){if(i.from>=t)break;i.to>e&&(r+=this.input.read(Math.max(i.from,e),Math.min(i.to,t)))}return r}}class uh{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:r}=t.p;iz(this.data,e,t,this.id,r.data,r.tokenPrecTable)}}uh.prototype.contextual=uh.prototype.fallback=uh.prototype.extend=!1;class u0{constructor(e,t,r){this.precTable=t,this.elseToken=r,this.data=typeof e=="string"?ap(e):e}token(e,t){let r=e.pos,i=0;for(;;){let s=e.next<0,o=e.resolveOffset(1,1);if(iz(this.data,e,t,0,this.data,this.precTable),e.token.value>-1)break;if(this.elseToken==null)return;if(s||i++,o==null)break;e.reset(o,e.token)}i&&(e.reset(r,e.token),e.acceptToken(this.elseToken,i))}}u0.prototype.contextual=uh.prototype.fallback=uh.prototype.extend=!1;class Bs{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function iz(n,e,t,r,i,s){let o=0,a=1<<r,{dialect:l}=t.p.parser;e:for(;(a&n[o])!=0;){let c=n[o+1];for(let p=o+3;p<c;p+=2)if((n[p+1]&a)>0){let g=n[p];if(l.allows(g)&&(e.token.value==-1||e.token.value==g||yce(g,e.token.value,i,s))){e.acceptToken(g);break}}let d=e.next,h=0,f=n[o+2];if(e.next<0&&f>h&&n[c+f*3-3]==65535){o=n[c+f*3-1];continue e}for(;h<f;){let p=h+f>>1,g=c+p+(p<<1),m=n[g],v=n[g+1]||65536;if(d<m)f=p;else if(d>=v)h=p+1;else{o=n[g+2],e.advance();continue e}}break}}function bI(n,e,t){for(let r=e,i;(i=n[r])!=65535;r++)if(i==t)return r-e;return-1}function yce(n,e,t,r){let i=bI(t,r,e);return i<0||bI(t,r,n)<i}const vs=typeof process<"u"&&mI&&/\bparse\b/.test(mI.LOG);let w1=null;function wI(n,e,t){let r=n.cursor(tr.IncludeAnonymous);for(r.moveTo(e);;)if(!(t<0?r.childBefore(e):r.childAfter(e)))for(;;){if((t<0?r.to<e:r.from>e)&&!r.type.isError)return t<0?Math.max(0,Math.min(r.to-1,e-25)):Math.min(n.length,Math.max(r.from+1,e+25));if(t<0?r.prevSibling():r.nextSibling())break;if(!r.parent())return t<0?0:n.length}}class bce{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?wI(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?wI(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let r=this.trees[t],i=this.index[t];if(i==r.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=r.children[i],o=this.start[t]+r.positions[i];if(o>e)return this.nextStart=o,null;if(s instanceof Bn){if(o==e){if(o<this.safeFrom)return null;let a=o+s.length;if(a<=this.safeTo){let l=s.prop(tn.lookAhead);if(!l||a+l<this.fragment.to)return s}}this.index[t]++,o+s.length>=Math.max(this.safeFrom,e)&&(this.trees.push(s),this.start.push(o),this.index.push(0))}else this.index[t]++,this.nextStart=o+s.length}}}class wce{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(r=>new Jv)}getActions(e){let t=0,r=null,{parser:i}=e.p,{tokenizers:s}=i,o=i.stateSlot(e.state,3),a=e.curContext?e.curContext.hash:0,l=0;for(let c=0;c<s.length;c++){if((1<<c&o)==0)continue;let d=s[c],h=this.tokens[c];if(!(r&&!d.fallback)&&((d.contextual||h.start!=e.pos||h.mask!=o||h.context!=a)&&(this.updateCachedToken(h,d,e),h.mask=o,h.context=a),h.lookAhead>h.end+25&&(l=Math.max(h.lookAhead,l)),h.value!=0)){let f=t;if(h.extended>-1&&(t=this.addActions(e,h.extended,h.end,t)),t=this.addActions(e,h.value,h.end,t),!d.extend&&(r=h,t>f))break}}for(;this.actions.length>t;)this.actions.pop();return l&&e.setLookAhead(l),!r&&e.pos==this.stream.end&&(r=new Jv,r.value=e.p.parser.eofTerm,r.start=r.end=e.pos,t=this.addActions(e,r.value,r.end,t)),this.mainToken=r,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new Jv,{pos:r,p:i}=e;return t.start=r,t.end=Math.min(r+1,i.stream.end),t.value=r==i.stream.end?i.parser.eofTerm:0,t}updateCachedToken(e,t,r){let i=this.stream.clipPos(r.pos);if(t.token(this.stream.reset(i,e),r),e.value>-1){let{parser:s}=r.p;for(let o=0;o<s.specialized.length;o++)if(s.specialized[o]==e.value){let a=s.specializers[o](this.stream.read(e.start,e.end),r);if(a>=0&&r.p.parser.dialect.allows(a>>1)){(a&1)==0?e.value=a>>1:e.extended=a>>1;break}}}else e.value=0,e.end=this.stream.clipPos(i+1)}putAction(e,t,r,i){for(let s=0;s<i;s+=3)if(this.actions[s]==e)return i;return this.actions[i++]=e,this.actions[i++]=t,this.actions[i++]=r,i}addActions(e,t,r,i){let{state:s}=e,{parser:o}=e.p,{data:a}=o;for(let l=0;l<2;l++)for(let c=o.stateSlot(s,l?2:1);;c+=3){if(a[c]==65535)if(a[c+1]==1)c=ll(a,c+2);else{i==0&&a[c+1]==2&&(i=this.putAction(ll(a,c+2),t,r,i));break}a[c]==t&&(i=this.putAction(ll(a,c+1),t,r,i))}return i}}class _ce{constructor(e,t,r,i){this.parser=e,this.input=t,this.ranges=i,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new vce(t,i),this.tokens=new wce(e,this.stream),this.topTerm=e.top[1];let{from:s}=i[0];this.stacks=[l0.start(this,e.top[0],s)],this.fragments=r.length&&this.stream.end-s>e.bufferLength*4?new bce(r,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,t=this.minStackPos,r=this.stacks=[],i,s;if(this.bigReductionCount>300&&e.length==1){let[o]=e;for(;o.forceReduce()&&o.stack.length&&o.stack[o.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<e.length;o++){let a=e[o];for(;;){if(this.tokens.mainToken=null,a.pos>t)r.push(a);else{if(this.advanceStack(a,r,e))continue;{i||(i=[],s=[]),i.push(a);let l=this.tokens.getMainToken(a);s.push(l.value,l.end)}}break}}if(!r.length){let o=i&&xce(i);if(o)return vs&&console.log("Finish with "+this.stackID(o)),this.stackToTree(o);if(this.parser.strict)throw vs&&i&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+t);this.recovering||(this.recovering=5)}if(this.recovering&&i){let o=this.stoppedAt!=null&&i[0].pos>this.stoppedAt?i[0]:this.runRecovery(i,s,r);if(o)return vs&&console.log("Force-finish "+this.stackID(o)),this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(r.length>o)for(r.sort((a,l)=>l.score-a.score);r.length>o;)r.pop();r.some(a=>a.reducePos>t)&&this.recovering--}else if(r.length>1){e:for(let o=0;o<r.length-1;o++){let a=r[o];for(let l=o+1;l<r.length;l++){let c=r[l];if(a.sameState(c)||a.buffer.length>500&&c.buffer.length>500)if((a.score-c.score||a.buffer.length-c.buffer.length)>0)r.splice(l--,1);else{r.splice(o--,1);continue e}}}r.length>12&&r.splice(12,r.length-12)}this.minStackPos=r[0].pos;for(let o=1;o<r.length;o++)r[o].pos<this.minStackPos&&(this.minStackPos=r[o].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,r){let i=e.pos,{parser:s}=this,o=vs?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&i>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let c=e.curContext&&e.curContext.tracker.strict,d=c?e.curContext.hash:0;for(let h=this.fragments.nodeAt(i);h;){let f=this.parser.nodeSet.types[h.type.id]==h.type?s.getGoto(e.state,h.type.id):-1;if(f>-1&&h.length&&(!c||(h.prop(tn.contextHash)||0)==d))return e.useNode(h,f),vs&&console.log(o+this.stackID(e)+` (via reuse of ${s.getName(h.type.id)})`),!0;if(!(h instanceof Bn)||h.children.length==0||h.positions[0]>0)break;let p=h.children[0];if(p instanceof Bn&&h.positions[0]==0)h=p;else break}}let a=s.stateSlot(e.state,4);if(a>0)return e.reduce(a),vs&&console.log(o+this.stackID(e)+` (via always-reduce ${s.getName(a&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let l=this.tokens.getActions(e);for(let c=0;c<l.length;){let d=l[c++],h=l[c++],f=l[c++],p=c==l.length||!r,g=p?e:e.split(),m=this.tokens.mainToken;if(g.apply(d,h,m?m.start:g.pos,f),vs&&console.log(o+this.stackID(g)+` (via ${(d&65536)==0?"shift":`reduce of ${s.getName(d&65535)}`} for ${s.getName(h)} @ ${i}${g==e?"":", split"})`),p)return!0;g.pos>i?t.push(g):r.push(g)}return!1}advanceFully(e,t){let r=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>r)return _I(e,t),!0}}runRecovery(e,t,r){let i=null,s=!1;for(let o=0;o<e.length;o++){let a=e[o],l=t[o<<1],c=t[(o<<1)+1],d=vs?this.stackID(a)+" -> ":"";if(a.deadEnd&&(s||(s=!0,a.restart(),vs&&console.log(d+this.stackID(a)+" (restarted)"),this.advanceFully(a,r))))continue;let h=a.split(),f=d;for(let p=0;p<10&&h.forceReduce()&&(vs&&console.log(f+this.stackID(h)+" (via force-reduce)"),!this.advanceFully(h,r));p++)vs&&(f=this.stackID(h)+" -> ");for(let p of a.recoverByInsert(l))vs&&console.log(d+this.stackID(p)+" (via recover-insert)"),this.advanceFully(p,r);this.stream.end>a.pos?(c==a.pos&&(c++,l=0),a.recoverByDelete(l,c),vs&&console.log(d+this.stackID(a)+` (via recover-delete ${this.parser.getName(l)})`),_I(a,r)):(!i||i.score<a.score)&&(i=a)}return i}stackToTree(e){return e.close(),Bn.build({buffer:c0.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(w1||(w1=new WeakMap)).get(e);return t||w1.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function _I(n,e){for(let t=0;t<e.length;t++){let r=e[t];if(r.pos==n.pos&&r.sameState(n)){e[t].score<n.score&&(e[t]=n);return}}e.push(n)}class Oce{constructor(e,t,r){this.source=e,this.flags=t,this.disabled=r}allows(e){return!this.disabled||this.disabled[e]==0}}const _1=n=>n;class sz{constructor(e){this.start=e.start,this.shift=e.shift||_1,this.reduce=e.reduce||_1,this.reuse=e.reuse||_1,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}}class zh extends m2{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let a=0;a<e.repeatNodeCount;a++)t.push("");let r=Object.keys(e.topRules).map(a=>e.topRules[a][1]),i=[];for(let a=0;a<t.length;a++)i.push([]);function s(a,l,c){i[a].push([l,l.deserialize(String(c))])}if(e.nodeProps)for(let a of e.nodeProps){let l=a[0];typeof l=="string"&&(l=tn[l]);for(let c=1;c<a.length;){let d=a[c++];if(d>=0)s(d,l,a[c++]);else{let h=a[c+-d];for(let f=-d;f>0;f--)s(a[c++],l,h);c++}}}this.nodeSet=new cm(t.map((a,l)=>Vr.define({name:l>=this.minRepeatTerm?void 0:a,id:l,props:i[l],top:r.indexOf(l)>-1,error:l==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(l)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=S6;let o=ap(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let a=0;a<this.specializerSpecs.length;a++)this.specialized[a]=this.specializerSpecs[a].term;this.specializers=this.specializerSpecs.map(OI),this.states=ap(e.states,Uint32Array),this.data=ap(e.stateData),this.goto=ap(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(a=>typeof a=="number"?new uh(o,a):a),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,r){let i=new _ce(this,e,t,r);for(let s of this.wrappers)i=s(i,e,t,r);return i}getGoto(e,t,r=!1){let i=this.goto;if(t>=i[0])return-1;for(let s=i[t+1];;){let o=i[s++],a=o&1,l=i[s++];if(a&&r)return l;for(let c=s+(o>>1);s<c;s++)if(i[s]==e)return l;if(a)return-1}}hasAction(e,t){let r=this.data;for(let i=0;i<2;i++)for(let s=this.stateSlot(e,i?2:1),o;;s+=3){if((o=r[s])==65535)if(r[s+1]==1)o=r[s=ll(r,s+2)];else{if(r[s+1]==2)return ll(r,s+2);break}if(o==t||o==0)return ll(r,s+1)}return 0}stateSlot(e,t){return this.states[e*6+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,r=>r==t?!0:null)}allActions(e,t){let r=this.stateSlot(e,4),i=r?t(r):void 0;for(let s=this.stateSlot(e,1);i==null;s+=3){if(this.data[s]==65535)if(this.data[s+1]==1)s=ll(this.data,s+2);else break;i=t(ll(this.data,s+1))}return i}nextStates(e){let t=[];for(let r=this.stateSlot(e,1);;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=ll(this.data,r+2);else break;if((this.data[r+2]&1)==0){let i=this.data[r+1];t.some((s,o)=>o&1&&s==i)||t.push(this.data[r],i)}}return t}configure(e){let t=Object.assign(Object.create(zh.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let r=this.topRules[e.top];if(!r)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=r}return e.tokenizers&&(t.tokenizers=this.tokenizers.map(r=>{let i=e.tokenizers.find(s=>s.from==r);return i?i.to:r})),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map((r,i)=>{let s=e.specializers.find(a=>a.from==r.external);if(!s)return r;let o=Object.assign(Object.assign({},r),{external:s.to});return t.specializers[i]=OI(o),o})),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),e.bufferLength!=null&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return t==null?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),r=t.map(()=>!1);if(e)for(let s of e.split(" ")){let o=t.indexOf(s);o>=0&&(r[o]=!0)}let i=null;for(let s=0;s<t.length;s++)if(!r[s])for(let o=this.dialects[t[s]],a;(a=this.data[o++])!=65535;)(i||(i=new Uint8Array(this.maxTerm+1)))[a]=1;return new Oce(e,r,i)}static deserialize(e){return new zh(e)}}function ll(n,e){return n[e]|n[e+1]<<16}function xce(n){let e=null;for(let t of n){let r=t.p.stoppedAt;(t.pos==t.p.stream.end||r!=null&&t.pos>r)&&t.p.parser.stateFlag(t.state,2)&&(!e||e.score<t.score)&&(e=t)}return e}function OI(n){if(n.external){let e=n.extend?1:0;return(t,r)=>n.external(t,r)<<1|e}return n.get}const kce=55,Sce=1,Tce=56,Ace=2,Cce=57,Ece=3,xI=4,Pce=5,V2=6,oz=7,az=8,lz=9,cz=10,Ice=11,Mce=12,Rce=13,O1=58,Dce=14,Nce=15,kI=59,uz=21,Lce=23,dz=24,Qce=25,Qx=27,hz=28,$ce=29,Fce=32,zce=35,Bce=37,Uce=38,jce=0,Vce=1,qce={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},Hce={dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},SI={dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}};function Zce(n){return n==45||n==46||n==58||n>=65&&n<=90||n==95||n>=97&&n<=122||n>=161}let TI=null,AI=null,CI=0;function $x(n,e){let t=n.pos+e;if(CI==t&&AI==n)return TI;let r=n.peek(e),i="";for(;Zce(r);)i+=String.fromCharCode(r),r=n.peek(++e);return AI=n,CI=t,TI=i?i.toLowerCase():r==Wce||r==Xce?void 0:null}const fz=60,d0=62,q2=47,Wce=63,Xce=33,Yce=45;function EI(n,e){this.name=n,this.parent=e}const Gce=[V2,cz,oz,az,lz],Kce=new sz({start:null,shift(n,e,t,r){return Gce.indexOf(e)>-1?new EI($x(r,1)||"",n):n},reduce(n,e){return e==uz&&n?n.parent:n},reuse(n,e,t,r){let i=e.type.id;return i==V2||i==Bce?new EI($x(r,1)||"",n):n},strict:!1}),Jce=new Bs((n,e)=>{if(n.next!=fz){n.next<0&&e.context&&n.acceptToken(O1);return}n.advance();let t=n.next==q2;t&&n.advance();let r=$x(n,0);if(r===void 0)return;if(!r)return n.acceptToken(t?Nce:Dce);let i=e.context?e.context.name:null;if(t){if(r==i)return n.acceptToken(Ice);if(i&&Hce[i])return n.acceptToken(O1,-2);if(e.dialectEnabled(jce))return n.acceptToken(Mce);for(let s=e.context;s;s=s.parent)if(s.name==r)return;n.acceptToken(Rce)}else{if(r=="script")return n.acceptToken(oz);if(r=="style")return n.acceptToken(az);if(r=="textarea")return n.acceptToken(lz);if(qce.hasOwnProperty(r))return n.acceptToken(cz);i&&SI[i]&&SI[i][r]?n.acceptToken(O1,-1):n.acceptToken(V2)}},{contextual:!0}),eue=new Bs(n=>{for(let e=0,t=0;;t++){if(n.next<0){t&&n.acceptToken(kI);break}if(n.next==Yce)e++;else if(n.next==d0&&e>=2){t>=3&&n.acceptToken(kI,-2);break}else e=0;n.advance()}});function tue(n){for(;n;n=n.parent)if(n.name=="svg"||n.name=="math")return!0;return!1}const nue=new Bs((n,e)=>{if(n.next==q2&&n.peek(1)==d0){let t=e.dialectEnabled(Vce)||tue(e.context);n.acceptToken(t?Pce:xI,2)}else n.next==d0&&n.acceptToken(xI,1)});function H2(n,e,t){let r=2+n.length;return new Bs(i=>{for(let s=0,o=0,a=0;;a++){if(i.next<0){a&&i.acceptToken(e);break}if(s==0&&i.next==fz||s==1&&i.next==q2||s>=2&&s<r&&i.next==n.charCodeAt(s-2))s++,o++;else if(s==r&&i.next==d0){a>o?i.acceptToken(e,-o):i.acceptToken(t,-(o-2));break}else if((i.next==10||i.next==13)&&a){i.acceptToken(e,1);break}else s=o=0;i.advance()}})}const rue=H2("script",kce,Sce),iue=H2("style",Tce,Ace),sue=H2("textarea",Cce,Ece),oue=rf({"Text RawText IncompleteTag IncompleteCloseTag":K.content,"StartTag StartCloseTag SelfClosingEndTag EndTag":K.angleBracket,TagName:K.tagName,"MismatchedCloseTag/TagName":[K.tagName,K.invalid],AttributeName:K.attributeName,"AttributeValue UnquotedAttributeValue":K.attributeValue,Is:K.definitionOperator,"EntityReference CharacterReference":K.character,Comment:K.blockComment,ProcessingInst:K.processingInstruction,DoctypeDecl:K.documentMeta}),aue=zh.deserialize({version:14,states:",xOVO!rOOO!ZQ#tO'#CrO!`Q#tO'#C{O!eQ#tO'#DOO!jQ#tO'#DRO!oQ#tO'#DTO!tOaO'#CqO#PObO'#CqO#[OdO'#CqO$kO!rO'#CqOOO`'#Cq'#CqO$rO$fO'#DUO$zQ#tO'#DWO%PQ#tO'#DXOOO`'#Dl'#DlOOO`'#DZ'#DZQVO!rOOO%UQ&rO,59^O%aQ&rO,59gO%lQ&rO,59jO%wQ&rO,59mO&SQ&rO,59oOOOa'#D_'#D_O&_OaO'#CyO&jOaO,59]OOOb'#D`'#D`O&rObO'#C|O&}ObO,59]OOOd'#Da'#DaO'VOdO'#DPO'bOdO,59]OOO`'#Db'#DbO'jO!rO,59]O'qQ#tO'#DSOOO`,59],59]OOOp'#Dc'#DcO'vO$fO,59pOOO`,59p,59pO(OQ#|O,59rO(TQ#|O,59sOOO`-E7X-E7XO(YQ&rO'#CtOOQW'#D['#D[O(hQ&rO1G.xOOOa1G.x1G.xOOO`1G/Z1G/ZO(sQ&rO1G/ROOOb1G/R1G/RO)OQ&rO1G/UOOOd1G/U1G/UO)ZQ&rO1G/XOOO`1G/X1G/XO)fQ&rO1G/ZOOOa-E7]-E7]O)qQ#tO'#CzOOO`1G.w1G.wOOOb-E7^-E7^O)vQ#tO'#C}OOOd-E7_-E7_O){Q#tO'#DQOOO`-E7`-E7`O*QQ#|O,59nOOOp-E7a-E7aOOO`1G/[1G/[OOO`1G/^1G/^OOO`1G/_1G/_O*VQ,UO,59`OOQW-E7Y-E7YOOOa7+$d7+$dOOO`7+$u7+$uOOOb7+$m7+$mOOOd7+$p7+$pOOO`7+$s7+$sO*bQ#|O,59fO*gQ#|O,59iO*lQ#|O,59lOOO`1G/Y1G/YO*qO7[O'#CwO+SOMhO'#CwOOQW1G.z1G.zOOO`1G/Q1G/QOOO`1G/T1G/TOOO`1G/W1G/WOOOO'#D]'#D]O+eO7[O,59cOOQW,59c,59cOOOO'#D^'#D^O+vOMhO,59cOOOO-E7Z-E7ZOOQW1G.}1G.}OOOO-E7[-E7[",stateData:",c~O!_OS~OUSOVPOWQOXROYTO[]O][O^^O_^Oa^Ob^Oc^Od^Oy^O|_O!eZO~OgaO~OgbO~OgcO~OgdO~OgeO~O!XfOPmP![mP~O!YiOQpP![pP~O!ZlORsP![sP~OUSOVPOWQOXROYTOZqO[]O][O^^O_^Oa^Ob^Oc^Od^Oy^O!eZO~O![rO~P#gO!]sO!fuO~OgvO~OgwO~OS|OT}OiyO~OS!POT}OiyO~OS!ROT}OiyO~OS!TOT}OiyO~OS}OT}OiyO~O!XfOPmX![mX~OP!WO![!XO~O!YiOQpX![pX~OQ!ZO![!XO~O!ZlORsX![sX~OR!]O![!XO~O![!XO~P#gOg!_O~O!]sO!f!aO~OS!bO~OS!cO~Oj!dOShXThXihX~OS!fOT!gOiyO~OS!hOT!gOiyO~OS!iOT!gOiyO~OS!jOT!gOiyO~OS!gOT!gOiyO~Og!kO~Og!lO~Og!mO~OS!nO~Ol!qO!a!oO!c!pO~OS!rO~OS!sO~OS!tO~Ob!uOc!uOd!uO!a!wO!b!uO~Ob!xOc!xOd!xO!c!wO!d!xO~Ob!uOc!uOd!uO!a!{O!b!uO~Ob!xOc!xOd!xO!c!{O!d!xO~OT~cbd!ey|!e~",goto:"%q!aPPPPPPPPPPPPPPPPPPPPP!b!hP!nPP!zP!}#Q#T#Z#^#a#g#j#m#s#y!bP!b!bP$P$V$m$s$y%P%V%]%cPPPPPPPP%iX^OX`pXUOX`pezabcde{!O!Q!S!UR!q!dRhUR!XhXVOX`pRkVR!XkXWOX`pRnWR!XnXXOX`pQrXR!XpXYOX`pQ`ORx`Q{aQ!ObQ!QcQ!SdQ!UeZ!e{!O!Q!S!UQ!v!oR!z!vQ!y!pR!|!yQgUR!VgQjVR!YjQmWR![mQpXR!^pQtZR!`tS_O`ToXp",nodeNames:"â  StartCloseTag StartCloseTag StartCloseTag EndTag SelfClosingEndTag StartTag StartTag StartTag StartTag StartTag StartCloseTag StartCloseTag StartCloseTag IncompleteTag IncompleteCloseTag Document Text EntityReference CharacterReference InvalidEntity Element OpenTag TagName Attribute AttributeName Is AttributeValue UnquotedAttributeValue ScriptText CloseTag OpenTag StyleText CloseTag OpenTag TextareaText CloseTag OpenTag CloseTag SelfClosingTag Comment ProcessingInst MismatchedCloseTag CloseTag DoctypeDecl",maxTerm:68,context:Kce,nodeProps:[["closedBy",-10,1,2,3,7,8,9,10,11,12,13,"EndTag",6,"EndTag SelfClosingEndTag",-4,22,31,34,37,"CloseTag"],["openedBy",4,"StartTag StartCloseTag",5,"StartTag",-4,30,33,36,38,"OpenTag"],["group",-10,14,15,18,19,20,21,40,41,42,43,"Entity",17,"Entity TextContent",-3,29,32,35,"TextContent Entity"],["isolate",-11,22,30,31,33,34,36,37,38,39,42,43,"ltr",-3,27,28,40,""]],propSources:[oue],skippedNodes:[0],repeatNodeCount:9,tokenData:"!<p!aR!YOX$qXY,QYZ,QZ[$q[]&X]^,Q^p$qpq,Qqr-_rs3_sv-_vw3}wxHYx}-_}!OH{!O!P-_!P!Q$q!Q![-_![!]Mz!]!^-_!^!_!$S!_!`!;x!`!a&X!a!c-_!c!}Mz!}#R-_#R#SMz#S#T1k#T#oMz#o#s-_#s$f$q$f%W-_%W%oMz%o%p-_%p&aMz&a&b-_&b1pMz1p4U-_4U4dMz4d4e-_4e$ISMz$IS$I`-_$I`$IbMz$Ib$Kh-_$Kh%#tMz%#t&/x-_&/x&EtMz&Et&FV-_&FV;'SMz;'S;:j!#|;:j;=`3X<%l?&r-_?&r?AhMz?Ah?BY$q?BY?MnMz?MnO$q!Z$|caPlW!b`!dpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr$qrs&}sv$qvw+Pwx(tx!^$q!^!_*V!_!a&X!a#S$q#S#T&X#T;'S$q;'S;=`+z<%lO$q!R&bXaP!b`!dpOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&Xq'UVaP!dpOv&}wx'kx!^&}!^!_(V!_;'S&};'S;=`(n<%lO&}P'pTaPOv'kw!^'k!_;'S'k;'S;=`(P<%lO'kP(SP;=`<%l'kp([S!dpOv(Vx;'S(V;'S;=`(h<%lO(Vp(kP;=`<%l(Vq(qP;=`<%l&}a({WaP!b`Or(trs'ksv(tw!^(t!^!_)e!_;'S(t;'S;=`*P<%lO(t`)jT!b`Or)esv)ew;'S)e;'S;=`)y<%lO)e`)|P;=`<%l)ea*SP;=`<%l(t!Q*^V!b`!dpOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!Q*vP;=`<%l*V!R*|P;=`<%l&XW+UYlWOX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+PW+wP;=`<%l+P!Z+}P;=`<%l$q!a,]`aP!b`!dp!_^OX&XXY,QYZ,QZ]&X]^,Q^p&Xpq,Qqr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X!_-ljiSaPlW!b`!dpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx!P-_!P!Q$q!Q!^-_!^!_*V!_!a&X!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q[/ebiSlWOX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+PS0rXiSqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0mS1bP;=`<%l0m[1hP;=`<%l/^!V1vciSaP!b`!dpOq&Xqr1krs&}sv1kvw0mwx(tx!P1k!P!Q&X!Q!^1k!^!_*V!_!a&X!a#s1k#s$f&X$f;'S1k;'S;=`3R<%l?Ah1k?Ah?BY&X?BY?Mn1k?MnO&X!V3UP;=`<%l1k!_3[P;=`<%l-_!Z3hV!ahaP!dpOv&}wx'kx!^&}!^!_(V!_;'S&};'S;=`(n<%lO&}!_4WiiSlWd!ROX5uXZ7SZ[5u[^7S^p5uqr8trs7Sst>]tw8twx7Sx!P8t!P!Q5u!Q!]8t!]!^/^!^!a7S!a#S8t#S#T;{#T#s8t#s$f5u$f;'S8t;'S;=`>V<%l?Ah8t?Ah?BY5u?BY?Mn8t?MnO5u!Z5zblWOX5uXZ7SZ[5u[^7S^p5uqr5urs7Sst+Ptw5uwx7Sx!]5u!]!^7w!^!a7S!a#S5u#S#T7S#T;'S5u;'S;=`8n<%lO5u!R7VVOp7Sqs7St!]7S!]!^7l!^;'S7S;'S;=`7q<%lO7S!R7qOb!R!R7tP;=`<%l7S!Z8OYlWb!ROX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+P!Z8qP;=`<%l5u!_8{iiSlWOX5uXZ7SZ[5u[^7S^p5uqr8trs7Sst/^tw8twx7Sx!P8t!P!Q5u!Q!]8t!]!^:j!^!a7S!a#S8t#S#T;{#T#s8t#s$f5u$f;'S8t;'S;=`>V<%l?Ah8t?Ah?BY5u?BY?Mn8t?MnO5u!_:sbiSlWb!ROX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+P!V<QciSOp7Sqr;{rs7Sst0mtw;{wx7Sx!P;{!P!Q7S!Q!];{!]!^=]!^!a7S!a#s;{#s$f7S$f;'S;{;'S;=`>P<%l?Ah;{?Ah?BY7S?BY?Mn;{?MnO7S!V=dXiSb!Rqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0m!V>SP;=`<%l;{!_>YP;=`<%l8t!_>dhiSlWOX@OXZAYZ[@O[^AY^p@OqrBwrsAYswBwwxAYx!PBw!P!Q@O!Q!]Bw!]!^/^!^!aAY!a#SBw#S#TE{#T#sBw#s$f@O$f;'SBw;'S;=`HS<%l?AhBw?Ah?BY@O?BY?MnBw?MnO@O!Z@TalWOX@OXZAYZ[@O[^AY^p@Oqr@OrsAYsw@OwxAYx!]@O!]!^Az!^!aAY!a#S@O#S#TAY#T;'S@O;'S;=`Bq<%lO@O!RA]UOpAYq!]AY!]!^Ao!^;'SAY;'S;=`At<%lOAY!RAtOc!R!RAwP;=`<%lAY!ZBRYlWc!ROX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+P!ZBtP;=`<%l@O!_COhiSlWOX@OXZAYZ[@O[^AY^p@OqrBwrsAYswBwwxAYx!PBw!P!Q@O!Q!]Bw!]!^Dj!^!aAY!a#SBw#S#TE{#T#sBw#s$f@O$f;'SBw;'S;=`HS<%l?AhBw?Ah?BY@O?BY?MnBw?MnO@O!_DsbiSlWc!ROX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+P!VFQbiSOpAYqrE{rsAYswE{wxAYx!PE{!P!QAY!Q!]E{!]!^GY!^!aAY!a#sE{#s$fAY$f;'SE{;'S;=`G|<%l?AhE{?Ah?BYAY?BY?MnE{?MnOAY!VGaXiSc!Rqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0m!VHPP;=`<%lE{!_HVP;=`<%lBw!ZHcW!cxaP!b`Or(trs'ksv(tw!^(t!^!_)e!_;'S(t;'S;=`*P<%lO(t!aIYliSaPlW!b`!dpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx}-_}!OKQ!O!P-_!P!Q$q!Q!^-_!^!_*V!_!a&X!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q!aK_kiSaPlW!b`!dpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx!P-_!P!Q$q!Q!^-_!^!_*V!_!`&X!`!aMS!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q!TM_XaP!b`!dp!fQOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X!aNZ!ZiSgQaPlW!b`!dpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx}-_}!OMz!O!PMz!P!Q$q!Q![Mz![!]Mz!]!^-_!^!_*V!_!a&X!a!c-_!c!}Mz!}#R-_#R#SMz#S#T1k#T#oMz#o#s-_#s$f$q$f$}-_$}%OMz%O%W-_%W%oMz%o%p-_%p&aMz&a&b-_&b1pMz1p4UMz4U4dMz4d4e-_4e$ISMz$IS$I`-_$I`$IbMz$Ib$Je-_$Je$JgMz$Jg$Kh-_$Kh%#tMz%#t&/x-_&/x&EtMz&Et&FV-_&FV;'SMz;'S;:j!#|;:j;=`3X<%l?&r-_?&r?AhMz?Ah?BY$q?BY?MnMz?MnO$q!a!$PP;=`<%lMz!R!$ZY!b`!dpOq*Vqr!$yrs(Vsv*Vwx)ex!a*V!a!b!4t!b;'S*V;'S;=`*s<%lO*V!R!%Q]!b`!dpOr*Vrs(Vsv*Vwx)ex}*V}!O!%y!O!f*V!f!g!']!g#W*V#W#X!0`#X;'S*V;'S;=`*s<%lO*V!R!&QX!b`!dpOr*Vrs(Vsv*Vwx)ex}*V}!O!&m!O;'S*V;'S;=`*s<%lO*V!R!&vV!b`!dp!ePOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!'dX!b`!dpOr*Vrs(Vsv*Vwx)ex!q*V!q!r!(P!r;'S*V;'S;=`*s<%lO*V!R!(WX!b`!dpOr*Vrs(Vsv*Vwx)ex!e*V!e!f!(s!f;'S*V;'S;=`*s<%lO*V!R!(zX!b`!dpOr*Vrs(Vsv*Vwx)ex!v*V!v!w!)g!w;'S*V;'S;=`*s<%lO*V!R!)nX!b`!dpOr*Vrs(Vsv*Vwx)ex!{*V!{!|!*Z!|;'S*V;'S;=`*s<%lO*V!R!*bX!b`!dpOr*Vrs(Vsv*Vwx)ex!r*V!r!s!*}!s;'S*V;'S;=`*s<%lO*V!R!+UX!b`!dpOr*Vrs(Vsv*Vwx)ex!g*V!g!h!+q!h;'S*V;'S;=`*s<%lO*V!R!+xY!b`!dpOr!+qrs!,hsv!+qvw!-Swx!.[x!`!+q!`!a!/j!a;'S!+q;'S;=`!0Y<%lO!+qq!,mV!dpOv!,hvx!-Sx!`!,h!`!a!-q!a;'S!,h;'S;=`!.U<%lO!,hP!-VTO!`!-S!`!a!-f!a;'S!-S;'S;=`!-k<%lO!-SP!-kO|PP!-nP;=`<%l!-Sq!-xS!dp|POv(Vx;'S(V;'S;=`(h<%lO(Vq!.XP;=`<%l!,ha!.aX!b`Or!.[rs!-Ssv!.[vw!-Sw!`!.[!`!a!.|!a;'S!.[;'S;=`!/d<%lO!.[a!/TT!b`|POr)esv)ew;'S)e;'S;=`)y<%lO)ea!/gP;=`<%l!.[!R!/sV!b`!dp|POr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!0]P;=`<%l!+q!R!0gX!b`!dpOr*Vrs(Vsv*Vwx)ex#c*V#c#d!1S#d;'S*V;'S;=`*s<%lO*V!R!1ZX!b`!dpOr*Vrs(Vsv*Vwx)ex#V*V#V#W!1v#W;'S*V;'S;=`*s<%lO*V!R!1}X!b`!dpOr*Vrs(Vsv*Vwx)ex#h*V#h#i!2j#i;'S*V;'S;=`*s<%lO*V!R!2qX!b`!dpOr*Vrs(Vsv*Vwx)ex#m*V#m#n!3^#n;'S*V;'S;=`*s<%lO*V!R!3eX!b`!dpOr*Vrs(Vsv*Vwx)ex#d*V#d#e!4Q#e;'S*V;'S;=`*s<%lO*V!R!4XX!b`!dpOr*Vrs(Vsv*Vwx)ex#X*V#X#Y!+q#Y;'S*V;'S;=`*s<%lO*V!R!4{Y!b`!dpOr!4trs!5ksv!4tvw!6Vwx!8]x!a!4t!a!b!:]!b;'S!4t;'S;=`!;r<%lO!4tq!5pV!dpOv!5kvx!6Vx!a!5k!a!b!7W!b;'S!5k;'S;=`!8V<%lO!5kP!6YTO!a!6V!a!b!6i!b;'S!6V;'S;=`!7Q<%lO!6VP!6lTO!`!6V!`!a!6{!a;'S!6V;'S;=`!7Q<%lO!6VP!7QOyPP!7TP;=`<%l!6Vq!7]V!dpOv!5kvx!6Vx!`!5k!`!a!7r!a;'S!5k;'S;=`!8V<%lO!5kq!7yS!dpyPOv(Vx;'S(V;'S;=`(h<%lO(Vq!8YP;=`<%l!5ka!8bX!b`Or!8]rs!6Vsv!8]vw!6Vw!a!8]!a!b!8}!b;'S!8];'S;=`!:V<%lO!8]a!9SX!b`Or!8]rs!6Vsv!8]vw!6Vw!`!8]!`!a!9o!a;'S!8];'S;=`!:V<%lO!8]a!9vT!b`yPOr)esv)ew;'S)e;'S;=`)y<%lO)ea!:YP;=`<%l!8]!R!:dY!b`!dpOr!4trs!5ksv!4tvw!6Vwx!8]x!`!4t!`!a!;S!a;'S!4t;'S;=`!;r<%lO!4t!R!;]V!b`!dpyPOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!;uP;=`<%l!4t!V!<TXjSaP!b`!dpOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X",tokenizers:[rue,iue,sue,nue,Jce,eue,0,1,2,3,4,5],topRules:{Document:[0,16]},dialects:{noMatch:0,selfClosing:515},tokenPrec:517});function pz(n,e){let t=Object.create(null);for(let r of n.getChildren(dz)){let i=r.getChild(Qce),s=r.getChild(Qx)||r.getChild(hz);i&&(t[e.read(i.from,i.to)]=s?s.type.id==Qx?e.read(s.from+1,s.to-1):e.read(s.from,s.to):"")}return t}function PI(n,e){let t=n.getChild(Lce);return t?e.read(t.from,t.to):" "}function x1(n,e,t){let r;for(let i of t)if(!i.attrs||i.attrs(r||(r=pz(n.node.parent.firstChild,e))))return{parser:i.parser};return null}function gz(n=[],e=[]){let t=[],r=[],i=[],s=[];for(let a of n)(a.tag=="script"?t:a.tag=="style"?r:a.tag=="textarea"?i:s).push(a);let o=e.length?Object.create(null):null;for(let a of e)(o[a.name]||(o[a.name]=[])).push(a);return P6((a,l)=>{let c=a.type.id;if(c==$ce)return x1(a,l,t);if(c==Fce)return x1(a,l,r);if(c==zce)return x1(a,l,i);if(c==uz&&s.length){let d=a.node,h=d.firstChild,f=h&&PI(h,l),p;if(f){for(let g of s)if(g.tag==f&&(!g.attrs||g.attrs(p||(p=pz(h,l))))){let m=d.lastChild,v=m.type.id==Uce?m.from:d.to;if(v>h.to)return{parser:g.parser,overlay:[{from:h.to,to:v}]}}}}if(o&&c==dz){let d=a.node,h;if(h=d.firstChild){let f=o[l.read(h.from,h.to)];if(f)for(let p of f){if(p.tagName&&p.tagName!=PI(d.parent,l))continue;let g=d.lastChild;if(g.type.id==Qx){let m=g.from+1,v=g.lastChild,y=g.to-(v&&v.isError?0:1);if(y>m)return{parser:p.parser,overlay:[{from:m,to:y}]}}else if(g.type.id==hz)return{parser:p.parser,overlay:[{from:g.from,to:g.to}]}}}}return null})}const lue=122,II=1,cue=123,uue=124,mz=2,due=125,hue=3,fue=4,vz=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],pue=58,gue=40,yz=95,mue=91,ey=45,vue=46,yue=35,bue=37,wue=38,_ue=92,Oue=10,xue=42;function _g(n){return n>=65&&n<=90||n>=97&&n<=122||n>=161}function Z2(n){return n>=48&&n<=57}function MI(n){return Z2(n)||n>=97&&n<=102||n>=65&&n<=70}const bz=(n,e,t)=>(r,i)=>{for(let s=!1,o=0,a=0;;a++){let{next:l}=r;if(_g(l)||l==ey||l==yz||s&&Z2(l))!s&&(l!=ey||a>0)&&(s=!0),o===a&&l==ey&&o++,r.advance();else if(l==_ue&&r.peek(1)!=Oue){if(r.advance(),MI(r.next)){do r.advance();while(MI(r.next));r.next==32&&r.advance()}else r.next>-1&&r.advance();s=!0}else{s&&r.acceptToken(o==2&&i.canShift(mz)?e:l==gue?t:n);break}}},kue=new Bs(bz(cue,mz,uue)),Sue=new Bs(bz(due,hue,fue)),Tue=new Bs(n=>{if(vz.includes(n.peek(-1))){let{next:e}=n;(_g(e)||e==yz||e==yue||e==vue||e==xue||e==mue||e==pue&&_g(n.peek(1))||e==ey||e==wue)&&n.acceptToken(lue)}}),Aue=new Bs(n=>{if(!vz.includes(n.peek(-1))){let{next:e}=n;if(e==bue&&(n.advance(),n.acceptToken(II)),_g(e)){do n.advance();while(_g(n.next)||Z2(n.next));n.acceptToken(II)}}}),Cue=rf({"AtKeyword import charset namespace keyframes media supports":K.definitionKeyword,"from to selector":K.keyword,NamespaceName:K.namespace,KeyframeName:K.labelName,KeyframeRangeName:K.operatorKeyword,TagName:K.tagName,ClassName:K.className,PseudoClassName:K.constant(K.className),IdName:K.labelName,"FeatureName PropertyName":K.propertyName,AttributeName:K.attributeName,NumberLiteral:K.number,KeywordQuery:K.keyword,UnaryQueryOp:K.operatorKeyword,"CallTag ValueName":K.atom,VariableName:K.variableName,Callee:K.operatorKeyword,Unit:K.unit,"UniversalSelector NestingSelector":K.definitionOperator,"MatchOp CompareOp":K.compareOperator,"ChildOp SiblingOp, LogicOp":K.logicOperator,BinOp:K.arithmeticOperator,Important:K.modifier,Comment:K.blockComment,ColorLiteral:K.color,"ParenthesizedContent StringLiteral":K.string,":":K.punctuation,"PseudoOp #":K.derefOperator,"; ,":K.separator,"( )":K.paren,"[ ]":K.squareBracket,"{ }":K.brace}),Eue={__proto__:null,lang:38,"nth-child":38,"nth-last-child":38,"nth-of-type":38,"nth-last-of-type":38,dir:38,"host-context":38,if:84,url:124,"url-prefix":124,domain:124,regexp:124},Pue={__proto__:null,or:98,and:98,not:106,only:106,layer:170},Iue={__proto__:null,selector:112,layer:166},Mue={__proto__:null,"@import":162,"@media":174,"@charset":178,"@namespace":182,"@keyframes":188,"@supports":200,"@scope":204},Rue={__proto__:null,to:207},Due=zh.deserialize({version:14,states:"EbQYQdOOO#qQdOOP#xO`OOOOQP'#Cf'#CfOOQP'#Ce'#CeO#}QdO'#ChO$nQaO'#CcO$xQdO'#CkO%TQdO'#DpO%YQdO'#DrO%_QdO'#DuO%_QdO'#DxOOQP'#FV'#FVO&eQhO'#EhOOQS'#FU'#FUOOQS'#Ek'#EkQYQdOOO&lQdO'#EOO&PQhO'#EUO&lQdO'#EWO'aQdO'#EYO'lQdO'#E]O'tQhO'#EcO(VQdO'#EeO(bQaO'#CfO)VQ`O'#D{O)[Q`O'#F`O)gQdO'#F`QOQ`OOP)qO&jO'#CaPOOO)C@t)C@tOOQP'#Cj'#CjOOQP,59S,59SO#}QdO,59SO)|QdO,59VO%TQdO,5:[O%YQdO,5:^O%_QdO,5:aO%_QdO,5:cO%_QdO,5:dO%_QdO'#ErO*XQ`O,58}O*aQdO'#DzOOQS,58},58}OOQP'#Cn'#CnOOQO'#Dn'#DnOOQP,59V,59VO*hQ`O,59VO*mQ`O,59VOOQP'#Dq'#DqOOQP,5:[,5:[OOQO'#Ds'#DsO*rQpO,5:^O+]QaO,5:aO+sQaO,5:dOOQW'#DZ'#DZO,ZQhO'#DdO,xQhO'#FaO'tQhO'#DbO-WQ`O'#DhOOQW'#F['#F[O-]Q`O,5;SO-eQ`O'#DeOOQS-E8i-E8iOOQ['#Cs'#CsO-jQdO'#CtO.QQdO'#CzO.hQdO'#C}O/OQ!pO'#DPO1RQ!jO,5:jOOQO'#DU'#DUO*mQ`O'#DTO1cQ!nO'#FXO3`Q`O'#DVO3eQ`O'#DkOOQ['#FX'#FXO-`Q`O,5:pO3jQ!bO,5:rOOQS'#E['#E[O3rQ`O,5:tO3wQdO,5:tOOQO'#E_'#E_O4PQ`O,5:wO4UQhO,5:}O%_QdO'#DgOOQS,5;P,5;PO-eQ`O,5;PO4^QdO,5;PO4fQdO,5:gO4vQdO'#EtO5TQ`O,5;zO5TQ`O,5;zPOOO'#Ej'#EjP5`O&jO,58{POOO,58{,58{OOQP1G.n1G.nOOQP1G.q1G.qO*hQ`O1G.qO*mQ`O1G.qOOQP1G/v1G/vO5kQpO1G/xO5sQaO1G/{O6ZQaO1G/}O6qQaO1G0OO7XQaO,5;^OOQO-E8p-E8pOOQS1G.i1G.iO7cQ`O,5:fO7hQdO'#DoO7oQdO'#CrOOQP1G/x1G/xO&lQdO1G/xO7vQ!jO'#DZO8UQ!bO,59vO8^QhO,5:OOOQO'#F]'#F]O8XQ!bO,59zO'tQhO,59xO8fQhO'#EvO8sQ`O,5;{O9OQhO,59|O9uQhO'#DiOOQW,5:S,5:SOOQS1G0n1G0nOOQW,5:P,5:PO9|Q!fO'#FYOOQS'#FY'#FYOOQS'#Em'#EmO;^QdO,59`OOQ[,59`,59`O;tQdO,59fOOQ[,59f,59fO<[QdO,59iOOQ[,59i,59iOOQ[,59k,59kO&lQdO,59mO<rQhO'#EQOOQW'#EQ'#EQO=WQ`O1G0UO1[QhO1G0UOOQ[,59o,59oO'tQhO'#DXOOQ[,59q,59qO=]Q#tO,5:VOOQS1G0[1G0[OOQS1G0^1G0^OOQS1G0`1G0`O=hQ`O1G0`O=mQdO'#E`OOQS1G0c1G0cOOQS1G0i1G0iO=xQaO,5:RO-`Q`O1G0kOOQS1G0k1G0kO-eQ`O1G0kO>PQ!fO1G0ROOQO1G0R1G0ROOQO,5;`,5;`O>gQdO,5;`OOQO-E8r-E8rO>tQ`O1G1fPOOO-E8h-E8hPOOO1G.g1G.gOOQP7+$]7+$]OOQP7+%d7+%dO&lQdO7+%dOOQS1G0Q1G0QO?PQaO'#F_O?ZQ`O,5:ZO?`Q!fO'#ElO@^QdO'#FWO@hQ`O,59^O@mQ!bO7+%dO&lQdO1G/bO@uQhO1G/fOOQW1G/j1G/jOOQW1G/d1G/dOAWQhO,5;bOOQO-E8t-E8tOAfQhO'#DZOAtQhO'#F^OBPQ`O'#F^OBUQ`O,5:TOOQS-E8k-E8kOOQ[1G.z1G.zOOQ[1G/Q1G/QOOQ[1G/T1G/TOOQ[1G/X1G/XOBZQdO,5:lOOQS7+%p7+%pOB`Q`O7+%pOBeQhO'#DYOBmQ`O,59sO'tQhO,59sOOQ[1G/q1G/qOBuQ`O1G/qOOQS7+%z7+%zOBzQbO'#DPOOQO'#Eb'#EbOCYQ`O'#EaOOQO'#Ea'#EaOCeQ`O'#EwOCmQdO,5:zOOQS,5:z,5:zOOQ[1G/m1G/mOOQS7+&V7+&VO-`Q`O7+&VOCxQ!fO'#EsO&lQdO'#EsOEPQdO7+%mOOQO7+%m7+%mOOQO1G0z1G0zOEdQ!bO<<IOOElQdO'#EqOEvQ`O,5;yOOQP1G/u1G/uOOQS-E8j-E8jOFOQdO'#EpOFYQ`O,5;rOOQ]1G.x1G.xOOQP<<IO<<IOOFbQdO7+$|OOQO'#D]'#D]OFiQ!bO7+%QOFqQhO'#EoOF{Q`O,5;xO&lQdO,5;xOOQW1G/o1G/oOOQO'#ES'#ESOGTQ`O1G0WOOQS<<I[<<I[O&lQdO,59tOGnQhO1G/_OOQ[1G/_1G/_OGuQ`O1G/_OOQW-E8l-E8lOOQ[7+%]7+%]OOQO,5:{,5:{O=pQdO'#ExOCeQ`O,5;cOOQS,5;c,5;cOOQS-E8u-E8uOOQS1G0f1G0fOOQS<<Iq<<IqOG}Q!fO,5;_OOQS-E8q-E8qOOQO<<IX<<IXOOQPAN>jAN>jOIUQaO,5;]OOQO-E8o-E8oOI`QdO,5;[OOQO-E8n-E8nOOQW<<Hh<<HhOOQW<<Hl<<HlOIjQhO<<HlOI{QhO,5;ZOJWQ`O,5;ZOOQO-E8m-E8mOJ]QdO1G1dOBZQdO'#EuOJgQ`O7+%rOOQW7+%r7+%rOJoQ!bO1G/`OOQ[7+$y7+$yOJzQhO7+$yPKRQ`O'#EnOOQO,5;d,5;dOOQO-E8v-E8vOOQS1G0}1G0}OKWQ`OAN>WO&lQdO1G0uOK]Q`O7+'OOOQO,5;a,5;aOOQO-E8s-E8sOOQW<<I^<<I^OOQ[<<He<<HePOQW,5;Y,5;YOOQWG23rG23rOKeQdO7+&a",stateData:"Kx~O#sOS#tQQ~OW[OZ[O]TO`VOaVOi]OjWOmXO!jYO!mZO!saO!ybO!{cO!}dO#QeO#WfO#YgO#oRO~OQiOW[OZ[O]TO`VOaVOi]OjWOmXO!jYO!mZO!saO!ybO!{cO!}dO#QeO#WfO#YgO#ohO~O#m$SP~P!dO#tmO~O#ooO~O]qO`rOarOjsOmtO!juO!mwO#nvO~OpzO!^xO~P$SOc!QO#o|O#p}O~O#o!RO~O#o!TO~OW[OZ[O]TO`VOaVOjWOmXO!jYO!mZO#oRO~OS!]Oe!YO!V![O!Y!`O#q!XOp$TP~Ok$TP~P&POQ!jOe!cOm!dOp!eOr!mOt!mOz!kO!`!lO#o!bO#p!hO#}!fO~Ot!qO!`!lO#o!pO~Ot!sO#o!sO~OS!]Oe!YO!V![O!Y!`O#q!XO~Oe!vOpzO#Z!xO~O]YX`YX`!pXaYXjYXmYXpYX!^YX!jYX!mYX#nYX~O`!zO~Ok!{O#m$SXo$SX~O#m$SXo$SX~P!dO#u#OO#v#OO#w#QO~Oc#UO#o|O#p}O~OpzO!^xO~Oo$SP~P!dOe#`O~Oe#aO~Ol#bO!h#cO~O]qO`rOarOjsOmtO~Op!ia!^!ia!j!ia!m!ia#n!iad!ia~P*zOp!la!^!la!j!la!m!la#n!lad!la~P*zOR#gOS!]Oe!YOr#gOt#gO!V![O!Y!`O#q#dO#}!fO~O!R#iO!^#jOk$TXp$TX~Oe#mO~Ok#oOpzO~Oe!vO~O]#rO`#rOd#uOi#rOj#rOk#rO~P&lO]#rO`#rOi#rOj#rOk#rOl#wO~P&lO]#rO`#rOi#rOj#rOk#rOo#yO~P&lOP#zOSsXesXksXvsX!VsX!YsX!usX!wsX#qsX!TsXQsX]sX`sXdsXisXjsXmsXpsXrsXtsXzsX!`sX#osX#psX#}sXlsXosX!^sX!qsX#msX~Ov#{O!u#|O!w#}Ok$TP~P'tOe#aOS#{Xk#{Xv#{X!V#{X!Y#{X!u#{X!w#{X#q#{XQ#{X]#{X`#{Xd#{Xi#{Xj#{Xm#{Xp#{Xr#{Xt#{Xz#{X!`#{X#o#{X#p#{X#}#{Xl#{Xo#{X!^#{X!q#{X#m#{X~Oe$RO~Oe$TO~Ok$VOv#{O~Ok$WO~Ot$XO!`!lO~Op$YO~OpzO!R#iO~OpzO#Z$`O~O!q$bOk!oa#m!oao!oa~P&lOk#hX#m#hXo#hX~P!dOk!{O#m$Sao$Sa~O#u#OO#v#OO#w$hO~Ol$jO!h$kO~Op!ii!^!ii!j!ii!m!ii#n!iid!ii~P*zOp!ki!^!ki!j!ki!m!ki#n!kid!ki~P*zOp!li!^!li!j!li!m!li#n!lid!li~P*zOp#fa!^#fa~P$SOo$lO~Od$RP~P%_Od#zP~P&lO`!PXd}X!R}X!T!PX~O`$sO!T$tO~Od$uO!R#iO~Ok#jXp#jX!^#jX~P'tO!^#jOk$Tap$Ta~O!R#iOk!Uap!Ua!^!Uad!Ua`!Ua~OS!]Oe!YO!V![O!Y!`O#q$yO~Od$QP~P9dOv#{OQ#|X]#|X`#|Xd#|Xe#|Xi#|Xj#|Xk#|Xm#|Xp#|Xr#|Xt#|Xz#|X!`#|X#o#|X#p#|X#}#|Xl#|Xo#|X~O]#rO`#rOd%OOi#rOj#rOk#rO~P&lO]#rO`#rOi#rOj#rOk#rOl%PO~P&lO]#rO`#rOi#rOj#rOk#rOo%QO~P&lOe%SOS!tXk!tX!V!tX!Y!tX#q!tX~Ok%TO~Od%YOt%ZO!a%ZO~Ok%[O~Oo%cO#o%^O#}%]O~Od%dO~P$SOv#{O!^%hO!q%jOk!oi#m!oio!oi~P&lOk#ha#m#hao#ha~P!dOk!{O#m$Sio$Si~O!^%mOd$RX~P$SOd%oO~Ov#{OQ#`Xd#`Xe#`Xm#`Xp#`Xr#`Xt#`Xz#`X!^#`X!`#`X#o#`X#p#`X#}#`X~O!^%qOd#zX~P&lOd%sO~Ol%tOv#{O~OR#gOr#gOt#gO#q%vO#}!fO~O!R#iOk#jap#ja!^#ja~O`!PXd}X!R}X!^}X~O!R#iO!^%xOd$QX~O`%zO~Od%{O~O#o%|O~Ok&OO~O`&PO!R#iO~Od&ROk&QO~Od&UO~OP#zOpsX!^sXdsX~O#}%]Op#TX!^#TX~OpzO!^&WO~Oo&[O#o%^O#}%]O~Ov#{OQ#gXe#gXk#gXm#gXp#gXr#gXt#gXz#gX!^#gX!`#gX!q#gX#m#gX#o#gX#p#gX#}#gXo#gX~O!^%hO!q&`Ok!oq#m!oqo!oq~P&lOl&aOv#{O~Od#eX!^#eX~P%_O!^%mOd$Ra~Od#dX!^#dX~P&lO!^%qOd#za~Od&fO~P&lOd&gO!T&hO~Od#cX!^#cX~P9dO!^%xOd$Qa~O]&mOd&oO~OS#bae#ba!V#ba!Y#ba#q#ba~Od&qO~PG]Od&qOk&rO~Ov#{OQ#gae#gak#gam#gap#gar#gat#gaz#ga!^#ga!`#ga!q#ga#m#ga#o#ga#p#ga#}#gao#ga~Od#ea!^#ea~P$SOd#da!^#da~P&lOR#gOr#gOt#gO#q%vO#}%]O~O!R#iOd#ca!^#ca~O`&xO~O!^%xOd$Qi~P&lO]&mOd&|O~Ov#{Od|ik|i~Od&}O~PG]Ok'OO~Od'PO~O!^%xOd$Qq~Od#cq!^#cq~P&lO#s!a#t#}]#}v!m~",goto:"2h$UPPPPP$VP$YP$c$uP$cP%X$cPP%_PPP%e%o%oPPPPP%oPP%oP&]P%oP%o'W%oP't'w'}'}(^'}P'}P'}P'}'}P(m'}(yP(|PP)p)v$c)|$c*SP$cP$c$cP*Y*{+YP$YP+aP+dP$YP$YP$YP+j$YP+m+p+s+z$YP$YPP$YP,P,V,f,|-[-b-l-r-x.O.U.`.f.l.rPPPPPPPPPPP.x/R/w/z0|P1U1u2O2R2U2[RnQ_^OP`kz!{$dq[OPYZ`kuvwxz!v!{#`$d%mqSOPYZ`kuvwxz!v!{#`$d%mQpTR#RqQ!OVR#SrQ#S!QS$Q!i!jR$i#U!V!mac!c!d!e!z#a#c#t#v#x#{$a$k$p$s%h%i%q%u%z&P&d&l&x'Q!U!mac!c!d!e!z#a#c#t#v#x#{$a$k$p$s%h%i%q%u%z&P&d&l&x'QU#g!Y$t&hU%`$Y%b&WR&V%_!V!iac!c!d!e!z#a#c#t#v#x#{$a$k$p$s%h%i%q%u%z&P&d&l&x'QR$S!kQ%W$RR&S%Xk!^]bf!Y![!g#i#j#m$P$R%X%xQ#e!YQ${#mQ%w$tQ&j%xR&w&hQ!ygQ#p!`Q$^!xR%f$`R#n!]!U!mac!c!d!e!z#a#c#t#v#x#{$a$k$p$s%h%i%q%u%z&P&d&l&x'QQ!qdR$X!rQ!PVR#TrQ#S!PR$i#TQ!SWR#VsQ!UXR#WtQ{UQ!wgQ#^yQ#o!_Q$U!nQ$[!uQ$_!yQ%e$^Q&Y%aQ&]%fR&v&XSjPzQ!}kQ$c!{R%k$dZiPkz!{$dR$P!gQ%}%SR&z&mR!rdR!teR$Z!tS%a$Y%bR&t&WV%_$Y%b&WQ#PmR$g#PQ`OSkPzU!a`k$dR$d!{Q$p#aY%p$p%u&d&l'QQ%u$sQ&d%qQ&l%zR'Q&xQ#t!cQ#v!dQ#x!eV$}#t#v#xQ%X$RR&T%XQ%y$zS&k%y&yR&y&lQ%r$pR&e%rQ%n$mR&c%nQyUR#]yQ%i$aR&_%iQ!|jS$e!|$fR$f!}Q&n%}R&{&nQ#k!ZR$x#kQ%b$YR&Z%bQ&X%aR&u&X__OP`kz!{$d^UOP`kz!{$dQ!VYQ!WZQ#XuQ#YvQ#ZwQ#[xQ$]!vQ$m#`R&b%mR$q#aQ!gaQ!oc[#q!c!d!e#t#v#xQ$a!zd$o#a$p$s%q%u%z&d&l&x'QQ$r#cQ%R#{S%g$a%iQ%l$kQ&^%hR&p&P]#s!c!d!e#t#v#xW!Z]b!g$PQ!ufQ#f!YQ#l![Q$v#iQ$w#jQ$z#mS%V$R%XR&i%xQ#h!YQ%w$tR&w&hR$|#mR$n#`QlPR#_zQ!_]Q!nbQ$O!gR%U$P",nodeNames:"â  Unit VariableName VariableName QueryCallee Comment StyleSheet RuleSet UniversalSelector TagSelector TagName NestingSelector ClassSelector . ClassName PseudoClassSelector : :: PseudoClassName PseudoClassName ) ( ArgList ValueName ParenthesizedValue AtKeyword # ; ] [ BracketedValue } { BracedValue ColorLiteral NumberLiteral StringLiteral BinaryExpression BinOp CallExpression Callee IfExpression if ArgList IfBranch KeywordQuery FeatureQuery FeatureName BinaryQuery LogicOp ComparisonQuery CompareOp UnaryQuery UnaryQueryOp ParenthesizedQuery SelectorQuery selector ParenthesizedSelector CallQuery ArgList , CallLiteral CallTag ParenthesizedContent PseudoClassName ArgList IdSelector IdName AttributeSelector AttributeName MatchOp ChildSelector ChildOp DescendantSelector SiblingSelector SiblingOp Block Declaration PropertyName Important ImportStatement import Layer layer LayerName layer MediaStatement media CharsetStatement charset NamespaceStatement namespace NamespaceName KeyframesStatement keyframes KeyframeName KeyframeList KeyframeSelector KeyframeRangeName SupportsStatement supports ScopeStatement scope to AtRule Styles",maxTerm:143,nodeProps:[["isolate",-2,5,36,""],["openedBy",20,"(",28,"[",31,"{"],["closedBy",21,")",29,"]",32,"}"]],propSources:[Cue],skippedNodes:[0,5,106],repeatNodeCount:15,tokenData:"JQ~R!YOX$qX^%i^p$qpq%iqr({rs-ust/itu6Wuv$qvw7Qwx7cxy9Qyz9cz{9h{|:R|}>t}!O?V!O!P?t!P!Q@]!Q![AU![!]BP!]!^B{!^!_C^!_!`DY!`!aDm!a!b$q!b!cEn!c!}$q!}#OG{#O#P$q#P#QH^#Q#R6W#R#o$q#o#pHo#p#q6W#q#rIQ#r#sIc#s#y$q#y#z%i#z$f$q$f$g%i$g#BY$q#BY#BZ%i#BZ$IS$q$IS$I_%i$I_$I|$q$I|$JO%i$JO$JT$q$JT$JU%i$JU$KV$q$KV$KW%i$KW&FU$q&FU&FV%i&FV;'S$q;'S;=`Iz<%lO$q`$tSOy%Qz;'S%Q;'S;=`%c<%lO%Q`%VS!a`Oy%Qz;'S%Q;'S;=`%c<%lO%Q`%fP;=`<%l%Q~%nh#s~OX%QX^'Y^p%Qpq'Yqy%Qz#y%Q#y#z'Y#z$f%Q$f$g'Y$g#BY%Q#BY#BZ'Y#BZ$IS%Q$IS$I_'Y$I_$I|%Q$I|$JO'Y$JO$JT%Q$JT$JU'Y$JU$KV%Q$KV$KW'Y$KW&FU%Q&FU&FV'Y&FV;'S%Q;'S;=`%c<%lO%Q~'ah#s~!a`OX%QX^'Y^p%Qpq'Yqy%Qz#y%Q#y#z'Y#z$f%Q$f$g'Y$g#BY%Q#BY#BZ'Y#BZ$IS%Q$IS$I_'Y$I_$I|%Q$I|$JO'Y$JO$JT%Q$JT$JU'Y$JU$KV%Q$KV$KW'Y$KW&FU%Q&FU&FV'Y&FV;'S%Q;'S;=`%c<%lO%Qj)OUOy%Qz#]%Q#]#^)b#^;'S%Q;'S;=`%c<%lO%Qj)gU!a`Oy%Qz#a%Q#a#b)y#b;'S%Q;'S;=`%c<%lO%Qj*OU!a`Oy%Qz#d%Q#d#e*b#e;'S%Q;'S;=`%c<%lO%Qj*gU!a`Oy%Qz#c%Q#c#d*y#d;'S%Q;'S;=`%c<%lO%Qj+OU!a`Oy%Qz#f%Q#f#g+b#g;'S%Q;'S;=`%c<%lO%Qj+gU!a`Oy%Qz#h%Q#h#i+y#i;'S%Q;'S;=`%c<%lO%Qj,OU!a`Oy%Qz#T%Q#T#U,b#U;'S%Q;'S;=`%c<%lO%Qj,gU!a`Oy%Qz#b%Q#b#c,y#c;'S%Q;'S;=`%c<%lO%Qj-OU!a`Oy%Qz#h%Q#h#i-b#i;'S%Q;'S;=`%c<%lO%Qj-iS!qY!a`Oy%Qz;'S%Q;'S;=`%c<%lO%Q~-xWOY-uZr-urs.bs#O-u#O#P.g#P;'S-u;'S;=`/c<%lO-u~.gOt~~.jRO;'S-u;'S;=`.s;=`O-u~.vXOY-uZr-urs.bs#O-u#O#P.g#P;'S-u;'S;=`/c;=`<%l-u<%lO-u~/fP;=`<%l-uj/nYjYOy%Qz!Q%Q!Q![0^![!c%Q!c!i0^!i#T%Q#T#Z0^#Z;'S%Q;'S;=`%c<%lO%Qj0cY!a`Oy%Qz!Q%Q!Q![1R![!c%Q!c!i1R!i#T%Q#T#Z1R#Z;'S%Q;'S;=`%c<%lO%Qj1WY!a`Oy%Qz!Q%Q!Q![1v![!c%Q!c!i1v!i#T%Q#T#Z1v#Z;'S%Q;'S;=`%c<%lO%Qj1}YrY!a`Oy%Qz!Q%Q!Q![2m![!c%Q!c!i2m!i#T%Q#T#Z2m#Z;'S%Q;'S;=`%c<%lO%Qj2tYrY!a`Oy%Qz!Q%Q!Q![3d![!c%Q!c!i3d!i#T%Q#T#Z3d#Z;'S%Q;'S;=`%c<%lO%Qj3iY!a`Oy%Qz!Q%Q!Q![4X![!c%Q!c!i4X!i#T%Q#T#Z4X#Z;'S%Q;'S;=`%c<%lO%Qj4`YrY!a`Oy%Qz!Q%Q!Q![5O![!c%Q!c!i5O!i#T%Q#T#Z5O#Z;'S%Q;'S;=`%c<%lO%Qj5TY!a`Oy%Qz!Q%Q!Q![5s![!c%Q!c!i5s!i#T%Q#T#Z5s#Z;'S%Q;'S;=`%c<%lO%Qj5zSrY!a`Oy%Qz;'S%Q;'S;=`%c<%lO%Qd6ZUOy%Qz!_%Q!_!`6m!`;'S%Q;'S;=`%c<%lO%Qd6tS!hS!a`Oy%Qz;'S%Q;'S;=`%c<%lO%Qb7VSZQOy%Qz;'S%Q;'S;=`%c<%lO%Q~7fWOY7cZw7cwx.bx#O7c#O#P8O#P;'S7c;'S;=`8z<%lO7c~8RRO;'S7c;'S;=`8[;=`O7c~8_XOY7cZw7cwx.bx#O7c#O#P8O#P;'S7c;'S;=`8z;=`<%l7c<%lO7c~8}P;=`<%l7cj9VSeYOy%Qz;'S%Q;'S;=`%c<%lO%Q~9hOd~n9oUWQvWOy%Qz!_%Q!_!`6m!`;'S%Q;'S;=`%c<%lO%Qj:YWvW!mQOy%Qz!O%Q!O!P:r!P!Q%Q!Q![=w![;'S%Q;'S;=`%c<%lO%Qj:wU!a`Oy%Qz!Q%Q!Q![;Z![;'S%Q;'S;=`%c<%lO%Qj;bY!a`#}YOy%Qz!Q%Q!Q![;Z![!g%Q!g!h<Q!h#X%Q#X#Y<Q#Y;'S%Q;'S;=`%c<%lO%Qj<VY!a`Oy%Qz{%Q{|<u|}%Q}!O<u!O!Q%Q!Q![=^![;'S%Q;'S;=`%c<%lO%Qj<zU!a`Oy%Qz!Q%Q!Q![=^![;'S%Q;'S;=`%c<%lO%Qj=eU!a`#}YOy%Qz!Q%Q!Q![=^![;'S%Q;'S;=`%c<%lO%Qj>O[!a`#}YOy%Qz!O%Q!O!P;Z!P!Q%Q!Q![=w![!g%Q!g!h<Q!h#X%Q#X#Y<Q#Y;'S%Q;'S;=`%c<%lO%Qj>yS!^YOy%Qz;'S%Q;'S;=`%c<%lO%Qj?[WvWOy%Qz!O%Q!O!P:r!P!Q%Q!Q![=w![;'S%Q;'S;=`%c<%lO%Qj?yU]YOy%Qz!Q%Q!Q![;Z![;'S%Q;'S;=`%c<%lO%Q~@bTvWOy%Qz{@q{;'S%Q;'S;=`%c<%lO%Q~@xS!a`#t~Oy%Qz;'S%Q;'S;=`%c<%lO%QjAZ[#}YOy%Qz!O%Q!O!P;Z!P!Q%Q!Q![=w![!g%Q!g!h<Q!h#X%Q#X#Y<Q#Y;'S%Q;'S;=`%c<%lO%QjBUU`YOy%Qz![%Q![!]Bh!];'S%Q;'S;=`%c<%lO%QbBoSaQ!a`Oy%Qz;'S%Q;'S;=`%c<%lO%QjCQSkYOy%Qz;'S%Q;'S;=`%c<%lO%QhCcU!TWOy%Qz!_%Q!_!`Cu!`;'S%Q;'S;=`%c<%lO%QhC|S!TW!a`Oy%Qz;'S%Q;'S;=`%c<%lO%QlDaS!TW!hSOy%Qz;'S%Q;'S;=`%c<%lO%QjDtV!jQ!TWOy%Qz!_%Q!_!`Cu!`!aEZ!a;'S%Q;'S;=`%c<%lO%QbEbS!jQ!a`Oy%Qz;'S%Q;'S;=`%c<%lO%QjEqYOy%Qz}%Q}!OFa!O!c%Q!c!}GO!}#T%Q#T#oGO#o;'S%Q;'S;=`%c<%lO%QjFfW!a`Oy%Qz!c%Q!c!}GO!}#T%Q#T#oGO#o;'S%Q;'S;=`%c<%lO%QjGV[iY!a`Oy%Qz}%Q}!OGO!O!Q%Q!Q![GO![!c%Q!c!}GO!}#T%Q#T#oGO#o;'S%Q;'S;=`%c<%lO%QjHQSmYOy%Qz;'S%Q;'S;=`%c<%lO%QnHcSl^Oy%Qz;'S%Q;'S;=`%c<%lO%QjHtSpYOy%Qz;'S%Q;'S;=`%c<%lO%QjIVSoYOy%Qz;'S%Q;'S;=`%c<%lO%QfIhU!mQOy%Qz!_%Q!_!`6m!`;'S%Q;'S;=`%c<%lO%Q`I}P;=`<%l$q",tokenizers:[Tue,Aue,kue,Sue,1,2,3,4,new u0("m~RRYZ[z{a~~g~aO#v~~dP!P!Qg~lO#w~~",28,129)],topRules:{StyleSheet:[0,6],Styles:[1,105]},specialized:[{term:124,get:n=>Eue[n]||-1},{term:125,get:n=>Pue[n]||-1},{term:4,get:n=>Iue[n]||-1},{term:25,get:n=>Mue[n]||-1},{term:123,get:n=>Rue[n]||-1}],tokenPrec:1963});let k1=null;function S1(){if(!k1&&typeof document=="object"&&document.body){let{style:n}=document.body,e=[],t=new Set;for(let r in n)r!="cssText"&&r!="cssFloat"&&typeof n[r]=="string"&&(/[A-Z]/.test(r)&&(r=r.replace(/[A-Z]/g,i=>"-"+i.toLowerCase())),t.has(r)||(e.push(r),t.add(r)));k1=e.sort().map(r=>({type:"property",label:r,apply:r+": "}))}return k1||[]}const RI=["active","after","any-link","autofill","backdrop","before","checked","cue","default","defined","disabled","empty","enabled","file-selector-button","first","first-child","first-letter","first-line","first-of-type","focus","focus-visible","focus-within","fullscreen","has","host","host-context","hover","in-range","indeterminate","invalid","is","lang","last-child","last-of-type","left","link","marker","modal","not","nth-child","nth-last-child","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","part","placeholder","placeholder-shown","read-only","read-write","required","right","root","scope","selection","slotted","target","target-text","valid","visited","where"].map(n=>({type:"class",label:n})),DI=["above","absolute","activeborder","additive","activecaption","after-white-space","ahead","alias","all","all-scroll","alphabetic","alternate","always","antialiased","appworkspace","asterisks","attr","auto","auto-flow","avoid","avoid-column","avoid-page","avoid-region","axis-pan","background","backwards","baseline","below","bidi-override","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","bullets","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","calc","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-decimal","clear","clip","close-quote","col-resize","collapse","color","color-burn","color-dodge","column","column-reverse","compact","condensed","contain","content","contents","content-box","context-menu","continuous","copy","counter","counters","cover","crop","cross","crosshair","currentcolor","cursive","cyclic","darken","dashed","decimal","decimal-leading-zero","default","default-button","dense","destination-atop","destination-in","destination-out","destination-over","difference","disc","discard","disclosure-closed","disclosure-open","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic-abegede-gez","ethiopic-halehame-aa-er","ethiopic-halehame-gez","ew-resize","exclusion","expanded","extends","extra-condensed","extra-expanded","fantasy","fast","fill","fill-box","fixed","flat","flex","flex-end","flex-start","footnotes","forwards","from","geometricPrecision","graytext","grid","groove","hand","hard-light","help","hidden","hide","higher","highlight","highlighttext","horizontal","hsl","hsla","hue","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-flex","inline-grid","inline-table","inset","inside","intrinsic","invert","italic","justify","keep-all","landscape","large","larger","left","level","lighter","lighten","line-through","linear","linear-gradient","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-hexadecimal","lower-latin","lower-norwegian","lowercase","ltr","luminosity","manipulation","match","matrix","matrix3d","medium","menu","menutext","message-box","middle","min-intrinsic","mix","monospace","move","multiple","multiple_mask_images","multiply","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","numbers","numeric","nw-resize","nwse-resize","oblique","opacity","open-quote","optimizeLegibility","optimizeSpeed","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","perspective","pinch-zoom","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radial-gradient","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeating-linear-gradient","repeating-radial-gradient","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","rotate","rotate3d","rotateX","rotateY","rotateZ","round","row","row-resize","row-reverse","rtl","run-in","running","s-resize","sans-serif","saturation","scale","scale3d","scaleX","scaleY","scaleZ","screen","scroll","scrollbar","scroll-position","se-resize","self-start","self-end","semi-condensed","semi-expanded","separate","serif","show","single","skew","skewX","skewY","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","soft-light","solid","source-atop","source-in","source-out","source-over","space","space-around","space-between","space-evenly","spell-out","square","start","static","status-bar","stretch","stroke","stroke-box","sub","subpixel-antialiased","svg_masks","super","sw-resize","symbolic","symbols","system-ui","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","text","text-bottom","text-top","textarea","textfield","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","to","top","transform","translate","translate3d","translateX","translateY","translateZ","transparent","ultra-condensed","ultra-expanded","underline","unidirectional-pan","unset","up","upper-latin","uppercase","url","var","vertical","vertical-text","view-box","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","words","wrap","wrap-reverse","x-large","x-small","xor","xx-large","xx-small"].map(n=>({type:"keyword",label:n})).concat(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"].map(n=>({type:"constant",label:n}))),Nue=["a","abbr","address","article","aside","b","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","dd","del","details","dfn","dialog","div","dl","dt","em","figcaption","figure","footer","form","header","hgroup","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","main","meter","nav","ol","output","p","pre","ruby","section","select","small","source","span","strong","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","tr","u","ul"].map(n=>({type:"type",label:n})),Lue=["@charset","@color-profile","@container","@counter-style","@font-face","@font-feature-values","@font-palette-values","@import","@keyframes","@layer","@media","@namespace","@page","@position-try","@property","@scope","@starting-style","@supports","@view-transition"].map(n=>({type:"keyword",label:n})),Ka=/^(\w[\w-]*|-\w[\w-]*|)$/,Que=/^-(-[\w-]*)?$/;function $ue(n,e){var t;if((n.name=="("||n.type.isError)&&(n=n.parent||n),n.name!="ArgList")return!1;let r=(t=n.parent)===null||t===void 0?void 0:t.firstChild;return r?.name!="Callee"?!1:e.sliceString(r.from,r.to)=="var"}const NI=new E6,Fue=["Declaration"];function zue(n){for(let e=n;;){if(e.type.isTop)return e;if(!(e=e.parent))return n}}function wz(n,e,t){if(e.to-e.from>4096){let r=NI.get(e);if(r)return r;let i=[],s=new Set,o=e.cursor(tr.IncludeAnonymous);if(o.firstChild())do for(let a of wz(n,o.node,t))s.has(a.label)||(s.add(a.label),i.push(a));while(o.nextSibling());return NI.set(e,i),i}else{let r=[],i=new Set;return e.cursor().iterate(s=>{var o;if(t(s)&&s.matchContext(Fue)&&((o=s.node.nextSibling)===null||o===void 0?void 0:o.name)==":"){let a=n.sliceString(s.from,s.to);i.has(a)||(i.add(a),r.push({label:a,type:"variable"}))}}),r}}const Bue=n=>e=>{let{state:t,pos:r}=e,i=dr(t).resolveInner(r,-1),s=i.type.isError&&i.from==i.to-1&&t.doc.sliceString(i.from,i.to)=="-";if(i.name=="PropertyName"||(s||i.name=="TagName")&&/^(Block|Styles)$/.test(i.resolve(i.to).name))return{from:i.from,options:S1(),validFor:Ka};if(i.name=="ValueName")return{from:i.from,options:DI,validFor:Ka};if(i.name=="PseudoClassName")return{from:i.from,options:RI,validFor:Ka};if(n(i)||(e.explicit||s)&&$ue(i,t.doc))return{from:n(i)||s?i.from:r,options:wz(t.doc,zue(i),n),validFor:Que};if(i.name=="TagName"){for(let{parent:l}=i;l;l=l.parent)if(l.name=="Block")return{from:i.from,options:S1(),validFor:Ka};return{from:i.from,options:Nue,validFor:Ka}}if(i.name=="AtKeyword")return{from:i.from,options:Lue,validFor:Ka};if(!e.explicit)return null;let o=i.resolve(r),a=o.childBefore(r);return a&&a.name==":"&&o.name=="PseudoClassSelector"?{from:r,options:RI,validFor:Ka}:a&&a.name==":"&&o.name=="Declaration"||o.name=="ArgList"?{from:r,options:DI,validFor:Ka}:o.name=="Block"||o.name=="Styles"?{from:r,options:S1(),validFor:Ka}:null},Uue=Bue(n=>n.name=="VariableName"),h0=Lh.define({name:"css",parser:Due.configure({props:[dm.add({Declaration:Kv()}),hm.add({"Block KeyframeList":L6})]}),languageData:{commentTokens:{block:{open:"/*",close:"*/"}},indentOnInput:/^\s*\}$/,wordChars:"-"}});function jue(){return new fg(h0,h0.data.of({autocomplete:Uue}))}const Vue=316,que=317,LI=1,Hue=2,Zue=3,Wue=4,Xue=318,Yue=320,Gue=321,Kue=5,Jue=6,ede=0,Fx=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],_z=125,tde=59,zx=47,nde=42,rde=43,ide=45,sde=60,ode=44,ade=63,lde=46,cde=91,ude=new sz({start:!1,shift(n,e){return e==Kue||e==Jue||e==Yue?n:e==Gue},strict:!1}),dde=new Bs((n,e)=>{let{next:t}=n;(t==_z||t==-1||e.context)&&n.acceptToken(Xue)},{contextual:!0,fallback:!0}),hde=new Bs((n,e)=>{let{next:t}=n,r;Fx.indexOf(t)>-1||t==zx&&((r=n.peek(1))==zx||r==nde)||t!=_z&&t!=tde&&t!=-1&&!e.context&&n.acceptToken(Vue)},{contextual:!0}),fde=new Bs((n,e)=>{n.next==cde&&!e.context&&n.acceptToken(que)},{contextual:!0}),pde=new Bs((n,e)=>{let{next:t}=n;if(t==rde||t==ide){if(n.advance(),t==n.next){n.advance();let r=!e.context&&e.canShift(LI);n.acceptToken(r?LI:Hue)}}else t==ade&&n.peek(1)==lde&&(n.advance(),n.advance(),(n.next<48||n.next>57)&&n.acceptToken(Zue))},{contextual:!0});function T1(n,e){return n>=65&&n<=90||n>=97&&n<=122||n==95||n>=192||!e&&n>=48&&n<=57}const gde=new Bs((n,e)=>{if(n.next!=sde||!e.dialectEnabled(ede)||(n.advance(),n.next==zx))return;let t=0;for(;Fx.indexOf(n.next)>-1;)n.advance(),t++;if(T1(n.next,!0)){for(n.advance(),t++;T1(n.next,!1);)n.advance(),t++;for(;Fx.indexOf(n.next)>-1;)n.advance(),t++;if(n.next==ode)return;for(let r=0;;r++){if(r==7){if(!T1(n.next,!0))return;break}if(n.next!="extends".charCodeAt(r))break;n.advance(),t++}}n.acceptToken(Wue,-t)}),mde=rf({"get set async static":K.modifier,"for while do if else switch try catch finally return throw break continue default case defer":K.controlKeyword,"in of await yield void typeof delete instanceof as satisfies":K.operatorKeyword,"let var const using function class extends":K.definitionKeyword,"import export from":K.moduleKeyword,"with debugger new":K.keyword,TemplateString:K.special(K.string),super:K.atom,BooleanLiteral:K.bool,this:K.self,null:K.null,Star:K.modifier,VariableName:K.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":K.function(K.variableName),VariableDefinition:K.definition(K.variableName),Label:K.labelName,PropertyName:K.propertyName,PrivatePropertyName:K.special(K.propertyName),"CallExpression/MemberExpression/PropertyName":K.function(K.propertyName),"FunctionDeclaration/VariableDefinition":K.function(K.definition(K.variableName)),"ClassDeclaration/VariableDefinition":K.definition(K.className),"NewExpression/VariableName":K.className,PropertyDefinition:K.definition(K.propertyName),PrivatePropertyDefinition:K.definition(K.special(K.propertyName)),UpdateOp:K.updateOperator,"LineComment Hashbang":K.lineComment,BlockComment:K.blockComment,Number:K.number,String:K.string,Escape:K.escape,ArithOp:K.arithmeticOperator,LogicOp:K.logicOperator,BitOp:K.bitwiseOperator,CompareOp:K.compareOperator,RegExp:K.regexp,Equals:K.definitionOperator,Arrow:K.function(K.punctuation),": Spread":K.punctuation,"( )":K.paren,"[ ]":K.squareBracket,"{ }":K.brace,"InterpolationStart InterpolationEnd":K.special(K.brace),".":K.derefOperator,", ;":K.separator,"@":K.meta,TypeName:K.typeName,TypeDefinition:K.definition(K.typeName),"type enum interface implements namespace module declare":K.definitionKeyword,"abstract global Privacy readonly override":K.modifier,"is keyof unique infer asserts":K.operatorKeyword,JSXAttributeValue:K.attributeValue,JSXText:K.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":K.angleBracket,"JSXIdentifier JSXNameSpacedName":K.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":K.attributeName,"JSXBuiltin/JSXIdentifier":K.standard(K.tagName)}),vde={__proto__:null,export:20,as:25,from:33,default:36,async:41,function:42,in:52,out:55,const:56,extends:60,this:64,true:72,false:72,null:84,void:88,typeof:92,super:108,new:142,delete:154,yield:163,await:167,class:172,public:235,private:235,protected:235,readonly:237,instanceof:256,satisfies:259,import:292,keyof:349,unique:353,infer:359,asserts:395,is:397,abstract:417,implements:419,type:421,let:424,var:426,using:429,interface:435,enum:439,namespace:445,module:447,declare:451,global:455,defer:471,for:476,of:485,while:488,with:492,do:496,if:500,else:502,switch:506,case:512,try:518,catch:522,finally:526,return:530,throw:534,break:538,continue:542,debugger:546},yde={__proto__:null,async:129,get:131,set:133,declare:195,public:197,private:197,protected:197,static:199,abstract:201,override:203,readonly:209,accessor:211,new:401},bde={__proto__:null,"<":193},wde=zh.deserialize({version:14,states:"$F|Q%TQlOOO%[QlOOO'_QpOOP(lO`OOO*zQ!0MxO'#CiO+RO#tO'#CjO+aO&jO'#CjO+oO#@ItO'#DaO.QQlO'#DgO.bQlO'#DrO%[QlO'#DzO0fQlO'#ESOOQ!0Lf'#E['#E[O1PQ`O'#EXOOQO'#Ep'#EpOOQO'#Il'#IlO1XQ`O'#GsO1dQ`O'#EoO1iQ`O'#EoO3hQ!0MxO'#JrO6[Q!0MxO'#JsO6uQ`O'#F]O6zQ,UO'#FtOOQ!0Lf'#Ff'#FfO7VO7dO'#FfO9XQMhO'#F|O9`Q`O'#F{OOQ!0Lf'#Js'#JsOOQ!0Lb'#Jr'#JrO9eQ`O'#GwOOQ['#K_'#K_O9pQ`O'#IYO9uQ!0LrO'#IZOOQ['#J`'#J`OOQ['#I_'#I_Q`QlOOQ`QlOOO9}Q!L^O'#DvO:UQlO'#EOO:]QlO'#EQO9kQ`O'#GsO:dQMhO'#CoO:rQ`O'#EnO:}Q`O'#EyO;hQMhO'#FeO;xQ`O'#GsOOQO'#K`'#K`O;}Q`O'#K`O<]Q`O'#G{O<]Q`O'#G|O<]Q`O'#HOO9kQ`O'#HRO=SQ`O'#HUO>kQ`O'#CeO>{Q`O'#HcO?TQ`O'#HiO?TQ`O'#HkO`QlO'#HmO?TQ`O'#HoO?TQ`O'#HrO?YQ`O'#HxO?_Q!0LsO'#IOO%[QlO'#IQO?jQ!0LsO'#ISO?uQ!0LsO'#IUO9uQ!0LrO'#IWO@QQ!0MxO'#CiOASQpO'#DlQOQ`OOO%[QlO'#EQOAjQ`O'#ETO:dQMhO'#EnOAuQ`O'#EnOBQQ!bO'#FeOOQ['#Cg'#CgOOQ!0Lb'#Dq'#DqOOQ!0Lb'#Jv'#JvO%[QlO'#JvOOQO'#Jy'#JyOOQO'#Ih'#IhOCQQpO'#EgOOQ!0Lb'#Ef'#EfOOQ!0Lb'#J}'#J}OC|Q!0MSO'#EgODWQpO'#EWOOQO'#Jx'#JxODlQpO'#JyOEyQpO'#EWODWQpO'#EgPFWO&2DjO'#CbPOOO)CD})CD}OOOO'#I`'#I`OFcO#tO,59UOOQ!0Lh,59U,59UOOOO'#Ia'#IaOFqO&jO,59UOGPQ!L^O'#DcOOOO'#Ic'#IcOGWO#@ItO,59{OOQ!0Lf,59{,59{OGfQlO'#IdOGyQ`O'#JtOIxQ!fO'#JtO+}QlO'#JtOJPQ`O,5:ROJgQ`O'#EpOJtQ`O'#KTOKPQ`O'#KSOKPQ`O'#KSOKXQ`O,5;^OK^Q`O'#KROOQ!0Ln,5:^,5:^OKeQlO,5:^OMcQ!0MxO,5:fONSQ`O,5:nONmQ!0LrO'#KQONtQ`O'#KPO9eQ`O'#KPO! YQ`O'#KPO! bQ`O,5;]O! gQ`O'#KPO!#lQ!fO'#JsOOQ!0Lh'#Ci'#CiO%[QlO'#ESO!$[Q!fO,5:sOOQS'#Jz'#JzOOQO-E<j-E<jO9kQ`O,5=_O!$rQ`O,5=_O!$wQlO,5;ZO!&zQMhO'#EkO!(eQ`O,5;ZO!(jQlO'#DyO!(tQpO,5;dO!(|QpO,5;dO%[QlO,5;dOOQ['#FT'#FTOOQ['#FV'#FVO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eOOQ['#FZ'#FZO!)[QlO,5;tOOQ!0Lf,5;y,5;yOOQ!0Lf,5;z,5;zOOQ!0Lf,5;|,5;|O%[QlO'#IpO!+_Q!0LrO,5<iO%[QlO,5;eO!&zQMhO,5;eO!+|QMhO,5;eO!-nQMhO'#E^O%[QlO,5;wOOQ!0Lf,5;{,5;{O!-uQ,UO'#FjO!.rQ,UO'#KXO!.^Q,UO'#KXO!.yQ,UO'#KXOOQO'#KX'#KXO!/_Q,UO,5<SOOOW,5<`,5<`O!/pQlO'#FvOOOW'#Io'#IoO7VO7dO,5<QO!/wQ,UO'#FxOOQ!0Lf,5<Q,5<QO!0hQ$IUO'#CyOOQ!0Lh'#C}'#C}O!0{O#@ItO'#DRO!1iQMjO,5<eO!1pQ`O,5<hO!3YQ(CWO'#GXO!3jQ`O'#GYO!3oQ`O'#GYO!5_Q(CWO'#G^O!6dQpO'#GbOOQO'#Gn'#GnO!,TQMhO'#GmOOQO'#Gp'#GpO!,TQMhO'#GoO!7VQ$IUO'#JlOOQ!0Lh'#Jl'#JlO!7aQ`O'#JkO!7oQ`O'#JjO!7wQ`O'#CuOOQ!0Lh'#C{'#C{O!8YQ`O'#C}OOQ!0Lh'#DV'#DVOOQ!0Lh'#DX'#DXO!8_Q`O,5<eO1SQ`O'#DZO!,TQMhO'#GPO!,TQMhO'#GRO!8gQ`O'#GTO!8lQ`O'#GUO!3oQ`O'#G[O!,TQMhO'#GaO<]Q`O'#JkO!8qQ`O'#EqO!9`Q`O,5<gOOQ!0Lb'#Cr'#CrO!9hQ`O'#ErO!:bQpO'#EsOOQ!0Lb'#KR'#KRO!:iQ!0LrO'#KaO9uQ!0LrO,5=cO`QlO,5>tOOQ['#Jh'#JhOOQ[,5>u,5>uOOQ[-E<]-E<]O!<hQ!0MxO,5:bO!:]QpO,5:`O!?RQ!0MxO,5:jO%[QlO,5:jO!AiQ!0MxO,5:lOOQO,5@z,5@zO!BYQMhO,5=_O!BhQ!0LrO'#JiO9`Q`O'#JiO!ByQ!0LrO,59ZO!CUQpO,59ZO!C^QMhO,59ZO:dQMhO,59ZO!CiQ`O,5;ZO!CqQ`O'#HbO!DVQ`O'#KdO%[QlO,5;}O!:]QpO,5<PO!D_Q`O,5=zO!DdQ`O,5=zO!DiQ`O,5=zO!DwQ`O,5=zO9uQ!0LrO,5=zO<]Q`O,5=jOOQO'#Cy'#CyO!EOQpO,5=gO!EWQMhO,5=hO!EcQ`O,5=jO!EhQ!bO,5=mO!EpQ`O'#K`O?YQ`O'#HWO9kQ`O'#HYO!EuQ`O'#HYO:dQMhO'#H[O!EzQ`O'#H[OOQ[,5=p,5=pO!FPQ`O'#H]O!FbQ`O'#CoO!FgQ`O,59PO!FqQ`O,59PO!HvQlO,59POOQ[,59P,59PO!IWQ!0LrO,59PO%[QlO,59PO!KcQlO'#HeOOQ['#Hf'#HfOOQ['#Hg'#HgO`QlO,5=}O!KyQ`O,5=}O`QlO,5>TO`QlO,5>VO!LOQ`O,5>XO`QlO,5>ZO!LTQ`O,5>^O!LYQlO,5>dOOQ[,5>j,5>jO%[QlO,5>jO9uQ!0LrO,5>lOOQ[,5>n,5>nO#!dQ`O,5>nOOQ[,5>p,5>pO#!dQ`O,5>pOOQ[,5>r,5>rO##QQpO'#D_O%[QlO'#JvO##sQpO'#JvO##}QpO'#DmO#$`QpO'#DmO#&qQlO'#DmO#&xQ`O'#JuO#'QQ`O,5:WO#'VQ`O'#EtO#'eQ`O'#KUO#'mQ`O,5;_O#'rQpO'#DmO#(PQpO'#EVOOQ!0Lf,5:o,5:oO%[QlO,5:oO#(WQ`O,5:oO?YQ`O,5;YO!CUQpO,5;YO!C^QMhO,5;YO:dQMhO,5;YO#(`Q`O,5@bO#(eQ07dO,5:sOOQO-E<f-E<fO#)kQ!0MSO,5;RODWQpO,5:rO#)uQpO,5:rODWQpO,5;RO!ByQ!0LrO,5:rOOQ!0Lb'#Ej'#EjOOQO,5;R,5;RO%[QlO,5;RO#*SQ!0LrO,5;RO#*_Q!0LrO,5;RO!CUQpO,5:rOOQO,5;X,5;XO#*mQ!0LrO,5;RPOOO'#I^'#I^P#+RO&2DjO,58|POOO,58|,58|OOOO-E<^-E<^OOQ!0Lh1G.p1G.pOOOO-E<_-E<_OOOO,59},59}O#+^Q!bO,59}OOOO-E<a-E<aOOQ!0Lf1G/g1G/gO#+cQ!fO,5?OO+}QlO,5?OOOQO,5?U,5?UO#+mQlO'#IdOOQO-E<b-E<bO#+zQ`O,5@`O#,SQ!fO,5@`O#,ZQ`O,5@nOOQ!0Lf1G/m1G/mO%[QlO,5@oO#,cQ`O'#IjOOQO-E<h-E<hO#,ZQ`O,5@nOOQ!0Lb1G0x1G0xOOQ!0Ln1G/x1G/xOOQ!0Ln1G0Y1G0YO%[QlO,5@lO#,wQ!0LrO,5@lO#-YQ!0LrO,5@lO#-aQ`O,5@kO9eQ`O,5@kO#-iQ`O,5@kO#-wQ`O'#ImO#-aQ`O,5@kOOQ!0Lb1G0w1G0wO!(tQpO,5:uO!)PQpO,5:uOOQS,5:w,5:wO#.iQdO,5:wO#.qQMhO1G2yO9kQ`O1G2yOOQ!0Lf1G0u1G0uO#/PQ!0MxO1G0uO#0UQ!0MvO,5;VOOQ!0Lh'#GW'#GWO#0rQ!0MzO'#JlO!$wQlO1G0uO#2}Q!fO'#JwO%[QlO'#JwO#3XQ`O,5:eOOQ!0Lh'#D_'#D_OOQ!0Lf1G1O1G1OO%[QlO1G1OOOQ!0Lf1G1f1G1fO#3^Q`O1G1OO#5rQ!0MxO1G1PO#5yQ!0MxO1G1PO#8aQ!0MxO1G1PO#8hQ!0MxO1G1PO#;OQ!0MxO1G1PO#=fQ!0MxO1G1PO#=mQ!0MxO1G1PO#=tQ!0MxO1G1PO#@[Q!0MxO1G1PO#@cQ!0MxO1G1PO#BpQ?MtO'#CiO#DkQ?MtO1G1`O#DrQ?MtO'#JsO#EVQ!0MxO,5?[OOQ!0Lb-E<n-E<nO#GdQ!0MxO1G1PO#HaQ!0MzO1G1POOQ!0Lf1G1P1G1PO#IdQMjO'#J|O#InQ`O,5:xO#IsQ!0MxO1G1cO#JgQ,UO,5<WO#JoQ,UO,5<XO#JwQ,UO'#FoO#K`Q`O'#FnOOQO'#KY'#KYOOQO'#In'#InO#KeQ,UO1G1nOOQ!0Lf1G1n1G1nOOOW1G1y1G1yO#KvQ?MtO'#JrO#LQQ`O,5<bO!)[QlO,5<bOOOW-E<m-E<mOOQ!0Lf1G1l1G1lO#LVQpO'#KXOOQ!0Lf,5<d,5<dO#L_QpO,5<dO#LdQMhO'#DTOOOO'#Ib'#IbO#LkO#@ItO,59mOOQ!0Lh,59m,59mO%[QlO1G2PO!8lQ`O'#IrO#LvQ`O,5<zOOQ!0Lh,5<w,5<wO!,TQMhO'#IuO#MdQMjO,5=XO!,TQMhO'#IwO#NVQMjO,5=ZO!&zQMhO,5=]OOQO1G2S1G2SO#NaQ!dO'#CrO#NtQ(CWO'#ErO$ |QpO'#GbO$!dQ!dO,5<sO$!kQ`O'#K[O9eQ`O'#K[O$!yQ`O,5<uO$#aQ!dO'#C{O!,TQMhO,5<tO$#kQ`O'#GZO$$PQ`O,5<tO$$UQ!dO'#GWO$$cQ!dO'#K]O$$mQ`O'#K]O!&zQMhO'#K]O$$rQ`O,5<xO$$wQlO'#JvO$%RQpO'#GcO#$`QpO'#GcO$%dQ`O'#GgO!3oQ`O'#GkO$%iQ!0LrO'#ItO$%tQpO,5<|OOQ!0Lp,5<|,5<|O$%{QpO'#GcO$&YQpO'#GdO$&kQpO'#GdO$&pQMjO,5=XO$'QQMjO,5=ZOOQ!0Lh,5=^,5=^O!,TQMhO,5@VO!,TQMhO,5@VO$'bQ`O'#IyO$'vQ`O,5@UO$(OQ`O,59aOOQ!0Lh,59i,59iO$(TQ`O,5@VO$)TQ$IYO,59uOOQ!0Lh'#Jp'#JpO$)vQMjO,5<kO$*iQMjO,5<mO@zQ`O,5<oOOQ!0Lh,5<p,5<pO$*sQ`O,5<vO$*xQMjO,5<{O$+YQ`O'#KPO!$wQlO1G2RO$+_Q`O1G2RO9eQ`O'#KSO9eQ`O'#EtO%[QlO'#EtO9eQ`O'#I{O$+dQ!0LrO,5@{OOQ[1G2}1G2}OOQ[1G4`1G4`OOQ!0Lf1G/|1G/|OOQ!0Lf1G/z1G/zO$-fQ!0MxO1G0UOOQ[1G2y1G2yO!&zQMhO1G2yO%[QlO1G2yO#.tQ`O1G2yO$/jQMhO'#EkOOQ!0Lb,5@T,5@TO$/wQ!0LrO,5@TOOQ[1G.u1G.uO!ByQ!0LrO1G.uO!CUQpO1G.uO!C^QMhO1G.uO$0YQ`O1G0uO$0_Q`O'#CiO$0jQ`O'#KeO$0rQ`O,5=|O$0wQ`O'#KeO$0|Q`O'#KeO$1[Q`O'#JRO$1jQ`O,5AOO$1rQ!fO1G1iOOQ!0Lf1G1k1G1kO9kQ`O1G3fO@zQ`O1G3fO$1yQ`O1G3fO$2OQ`O1G3fO!DiQ`O1G3fO9uQ!0LrO1G3fOOQ[1G3f1G3fO!EcQ`O1G3UO!&zQMhO1G3RO$2TQ`O1G3ROOQ[1G3S1G3SO!&zQMhO1G3SO$2YQ`O1G3SO$2bQpO'#HQOOQ[1G3U1G3UO!6_QpO'#I}O!EhQ!bO1G3XOOQ[1G3X1G3XOOQ[,5=r,5=rO$2jQMhO,5=tO9kQ`O,5=tO$%dQ`O,5=vO9`Q`O,5=vO!CUQpO,5=vO!C^QMhO,5=vO:dQMhO,5=vO$2xQ`O'#KcO$3TQ`O,5=wOOQ[1G.k1G.kO$3YQ!0LrO1G.kO@zQ`O1G.kO$3eQ`O1G.kO9uQ!0LrO1G.kO$5mQ!fO,5AQO$5zQ`O,5AQO9eQ`O,5AQO$6VQlO,5>PO$6^Q`O,5>POOQ[1G3i1G3iO`QlO1G3iOOQ[1G3o1G3oOOQ[1G3q1G3qO?TQ`O1G3sO$6cQlO1G3uO$:gQlO'#HtOOQ[1G3x1G3xO$:tQ`O'#HzO?YQ`O'#H|OOQ[1G4O1G4OO$:|QlO1G4OO9uQ!0LrO1G4UOOQ[1G4W1G4WOOQ!0Lb'#G_'#G_O9uQ!0LrO1G4YO9uQ!0LrO1G4[O$?TQ`O,5@bO!)[QlO,5;`O9eQ`O,5;`O?YQ`O,5:XO!)[QlO,5:XO!CUQpO,5:XO$?YQ?MtO,5:XOOQO,5;`,5;`O$?dQpO'#IeO$?zQ`O,5@aOOQ!0Lf1G/r1G/rO$@SQpO'#IkO$@^Q`O,5@pOOQ!0Lb1G0y1G0yO#$`QpO,5:XOOQO'#Ig'#IgO$@fQpO,5:qOOQ!0Ln,5:q,5:qO#(ZQ`O1G0ZOOQ!0Lf1G0Z1G0ZO%[QlO1G0ZOOQ!0Lf1G0t1G0tO?YQ`O1G0tO!CUQpO1G0tO!C^QMhO1G0tOOQ!0Lb1G5|1G5|O!ByQ!0LrO1G0^OOQO1G0m1G0mO%[QlO1G0mO$@mQ!0LrO1G0mO$@xQ!0LrO1G0mO!CUQpO1G0^ODWQpO1G0^O$AWQ!0LrO1G0mOOQO1G0^1G0^O$AlQ!0MxO1G0mPOOO-E<[-E<[POOO1G.h1G.hOOOO1G/i1G/iO$AvQ!bO,5<iO$BOQ!fO1G4jOOQO1G4p1G4pO%[QlO,5?OO$BYQ`O1G5zO$BbQ`O1G6YO$BjQ!fO1G6ZO9eQ`O,5?UO$BtQ!0MxO1G6WO%[QlO1G6WO$CUQ!0LrO1G6WO$CgQ`O1G6VO$CgQ`O1G6VO9eQ`O1G6VO$CoQ`O,5?XO9eQ`O,5?XOOQO,5?X,5?XO$DTQ`O,5?XO$+YQ`O,5?XOOQO-E<k-E<kOOQS1G0a1G0aOOQS1G0c1G0cO#.lQ`O1G0cOOQ[7+(e7+(eO!&zQMhO7+(eO%[QlO7+(eO$DcQ`O7+(eO$DnQMhO7+(eO$D|Q!0MzO,5=XO$GXQ!0MzO,5=ZO$IdQ!0MzO,5=XO$KuQ!0MzO,5=ZO$NWQ!0MzO,59uO%!]Q!0MzO,5<kO%$hQ!0MzO,5<mO%&sQ!0MzO,5<{OOQ!0Lf7+&a7+&aO%)UQ!0MxO7+&aO%)xQlO'#IfO%*VQ`O,5@cO%*_Q!fO,5@cOOQ!0Lf1G0P1G0PO%*iQ`O7+&jOOQ!0Lf7+&j7+&jO%*nQ?MtO,5:fO%[QlO7+&zO%*xQ?MtO,5:bO%+VQ?MtO,5:jO%+aQ?MtO,5:lO%+kQMhO'#IiO%+uQ`O,5@hOOQ!0Lh1G0d1G0dOOQO1G1r1G1rOOQO1G1s1G1sO%+}Q!jO,5<ZO!)[QlO,5<YOOQO-E<l-E<lOOQ!0Lf7+'Y7+'YOOOW7+'e7+'eOOOW1G1|1G1|O%,YQ`O1G1|OOQ!0Lf1G2O1G2OOOOO,59o,59oO%,_Q!dO,59oOOOO-E<`-E<`OOQ!0Lh1G/X1G/XO%,fQ!0MxO7+'kOOQ!0Lh,5?^,5?^O%-YQMhO1G2fP%-aQ`O'#IrPOQ!0Lh-E<p-E<pO%-}QMjO,5?aOOQ!0Lh-E<s-E<sO%.pQMjO,5?cOOQ!0Lh-E<u-E<uO%.zQ!dO1G2wO%/RQ!dO'#CrO%/iQMhO'#KSO$$wQlO'#JvOOQ!0Lh1G2_1G2_O%/sQ`O'#IqO%0[Q`O,5@vO%0[Q`O,5@vO%0dQ`O,5@vO%0oQ`O,5@vOOQO1G2a1G2aO%0}QMjO1G2`O$+YQ`O'#K[O!,TQMhO1G2`O%1_Q(CWO'#IsO%1lQ`O,5@wO!&zQMhO,5@wO%1tQ!dO,5@wOOQ!0Lh1G2d1G2dO%4UQ!fO'#CiO%4`Q`O,5=POOQ!0Lb,5<},5<}O%4hQpO,5<}OOQ!0Lb,5=O,5=OOCwQ`O,5<}O%4sQpO,5<}OOQ!0Lb,5=R,5=RO$+YQ`O,5=VOOQO,5?`,5?`OOQO-E<r-E<rOOQ!0Lp1G2h1G2hO#$`QpO,5<}O$$wQlO,5=PO%5RQ`O,5=OO%5^QpO,5=OO!,TQMhO'#IuO%6WQMjO1G2sO!,TQMhO'#IwO%6yQMjO1G2uO%7TQMjO1G5qO%7_QMjO1G5qOOQO,5?e,5?eOOQO-E<w-E<wOOQO1G.{1G.{O!,TQMhO1G5qO!,TQMhO1G5qO!:]QpO,59wO%[QlO,59wOOQ!0Lh,5<j,5<jO%7lQ`O1G2ZO!,TQMhO1G2bO%7qQ!0MxO7+'mOOQ!0Lf7+'m7+'mO!$wQlO7+'mO%8eQ`O,5;`OOQ!0Lb,5?g,5?gOOQ!0Lb-E<y-E<yO%8jQ!dO'#K^O#(ZQ`O7+(eO4UQ!fO7+(eO$DfQ`O7+(eO%8tQ!0MvO'#CiO%9XQ!0MvO,5=SO%9lQ`O,5=SO%9tQ`O,5=SOOQ!0Lb1G5o1G5oOOQ[7+$a7+$aO!ByQ!0LrO7+$aO!CUQpO7+$aO!$wQlO7+&aO%9yQ`O'#JQO%:bQ`O,5APOOQO1G3h1G3hO9kQ`O,5APO%:bQ`O,5APO%:jQ`O,5APOOQO,5?m,5?mOOQO-E=P-E=POOQ!0Lf7+'T7+'TO%:oQ`O7+)QO9uQ!0LrO7+)QO9kQ`O7+)QO@zQ`O7+)QO%:tQ`O7+)QOOQ[7+)Q7+)QOOQ[7+(p7+(pO%:yQ!0MvO7+(mO!&zQMhO7+(mO!E^Q`O7+(nOOQ[7+(n7+(nO!&zQMhO7+(nO%;TQ`O'#KbO%;`Q`O,5=lOOQO,5?i,5?iOOQO-E<{-E<{OOQ[7+(s7+(sO%<rQpO'#HZOOQ[1G3`1G3`O!&zQMhO1G3`O%[QlO1G3`O%<yQ`O1G3`O%=UQMhO1G3`O9uQ!0LrO1G3bO$%dQ`O1G3bO9`Q`O1G3bO!CUQpO1G3bO!C^QMhO1G3bO%=dQ`O'#JPO%=xQ`O,5@}O%>QQpO,5@}OOQ!0Lb1G3c1G3cOOQ[7+$V7+$VO@zQ`O7+$VO9uQ!0LrO7+$VO%>]Q`O7+$VO%[QlO1G6lO%[QlO1G6mO%>bQ!0LrO1G6lO%>lQlO1G3kO%>sQ`O1G3kO%>xQlO1G3kOOQ[7+)T7+)TO9uQ!0LrO7+)_O`QlO7+)aOOQ['#Kh'#KhOOQ['#JS'#JSO%?PQlO,5>`OOQ[,5>`,5>`O%[QlO'#HuO%?^Q`O'#HwOOQ[,5>f,5>fO9eQ`O,5>fOOQ[,5>h,5>hOOQ[7+)j7+)jOOQ[7+)p7+)pOOQ[7+)t7+)tOOQ[7+)v7+)vO%?cQpO1G5|O%?}Q?MtO1G0zO%@XQ`O1G0zOOQO1G/s1G/sO%@dQ?MtO1G/sO?YQ`O1G/sO!)[QlO'#DmOOQO,5?P,5?POOQO-E<c-E<cOOQO,5?V,5?VOOQO-E<i-E<iO!CUQpO1G/sOOQO-E<e-E<eOOQ!0Ln1G0]1G0]OOQ!0Lf7+%u7+%uO#(ZQ`O7+%uOOQ!0Lf7+&`7+&`O?YQ`O7+&`O!CUQpO7+&`OOQO7+%x7+%xO$AlQ!0MxO7+&XOOQO7+&X7+&XO%[QlO7+&XO%@nQ!0LrO7+&XO!ByQ!0LrO7+%xO!CUQpO7+%xO%@yQ!0LrO7+&XO%AXQ!0MxO7++rO%[QlO7++rO%AiQ`O7++qO%AiQ`O7++qOOQO1G4s1G4sO9eQ`O1G4sO%AqQ`O1G4sOOQS7+%}7+%}O#(ZQ`O<<LPO4UQ!fO<<LPO%BPQ`O<<LPOOQ[<<LP<<LPO!&zQMhO<<LPO%[QlO<<LPO%BXQ`O<<LPO%BdQ!0MzO,5?aO%DoQ!0MzO,5?cO%FzQ!0MzO1G2`O%I]Q!0MzO1G2sO%KhQ!0MzO1G2uO%MsQ!fO,5?QO%[QlO,5?QOOQO-E<d-E<dO%M}Q`O1G5}OOQ!0Lf<<JU<<JUO%NVQ?MtO1G0uO&!^Q?MtO1G1PO&!eQ?MtO1G1PO&$fQ?MtO1G1PO&$mQ?MtO1G1PO&&nQ?MtO1G1PO&(oQ?MtO1G1PO&(vQ?MtO1G1PO&(}Q?MtO1G1PO&+OQ?MtO1G1PO&+VQ?MtO1G1PO&+^Q!0MxO<<JfO&-UQ?MtO1G1PO&.RQ?MvO1G1PO&/UQ?MvO'#JlO&1[Q?MtO1G1cO&1iQ?MtO1G0UO&1sQMjO,5?TOOQO-E<g-E<gO!)[QlO'#FqOOQO'#KZ'#KZOOQO1G1u1G1uO&1}Q`O1G1tO&2SQ?MtO,5?[OOOW7+'h7+'hOOOO1G/Z1G/ZO&2^Q!dO1G4xOOQ!0Lh7+(Q7+(QP!&zQMhO,5?^O!,TQMhO7+(cO&2eQ`O,5?]O9eQ`O,5?]O$+YQ`O,5?]OOQO-E<o-E<oO&2sQ`O1G6bO&2sQ`O1G6bO&2{Q`O1G6bO&3WQMjO7+'zO&3hQ!dO,5?_O&3rQ`O,5?_O!&zQMhO,5?_OOQO-E<q-E<qO&3wQ!dO1G6cO&4RQ`O1G6cO&4ZQ`O1G2kO!&zQMhO1G2kOOQ!0Lb1G2i1G2iOOQ!0Lb1G2j1G2jO%4hQpO1G2iO!CUQpO1G2iOCwQ`O1G2iOOQ!0Lb1G2q1G2qO&4`QpO1G2iO&4nQ`O1G2kO$+YQ`O1G2jOCwQ`O1G2jO$$wQlO1G2kO&4vQ`O1G2jO&5jQMjO,5?aOOQ!0Lh-E<t-E<tO&6]QMjO,5?cOOQ!0Lh-E<v-E<vO!,TQMhO7++]O&6gQMjO7++]O&6qQMjO7++]OOQ!0Lh1G/c1G/cO&7OQ`O1G/cOOQ!0Lh7+'u7+'uO&7TQMjO7+'|O&7eQ!0MxO<<KXOOQ!0Lf<<KX<<KXO&8XQ`O1G0zO!&zQMhO'#IzO&8^Q`O,5@xO&:`Q!fO<<LPO!&zQMhO1G2nO&:gQ!0LrO1G2nOOQ[<<G{<<G{O!ByQ!0LrO<<G{O&:xQ!0MxO<<I{OOQ!0Lf<<I{<<I{OOQO,5?l,5?lO&;lQ`O,5?lO&;qQ`O,5?lOOQO-E=O-E=OO&<PQ`O1G6kO&<PQ`O1G6kO9kQ`O1G6kO@zQ`O<<LlOOQ[<<Ll<<LlO&<XQ`O<<LlO9uQ!0LrO<<LlO9kQ`O<<LlOOQ[<<LX<<LXO%:yQ!0MvO<<LXOOQ[<<LY<<LYO!E^Q`O<<LYO&<^QpO'#I|O&<iQ`O,5@|O!)[QlO,5@|OOQ[1G3W1G3WOOQO'#JO'#JOO9uQ!0LrO'#JOO&<qQpO,5=uOOQ[,5=u,5=uO&<xQpO'#EgO&=PQpO'#GeO&=UQ`O7+(zO&=ZQ`O7+(zOOQ[7+(z7+(zO!&zQMhO7+(zO%[QlO7+(zO&=cQ`O7+(zOOQ[7+(|7+(|O9uQ!0LrO7+(|O$%dQ`O7+(|O9`Q`O7+(|O!CUQpO7+(|O&=nQ`O,5?kOOQO-E<}-E<}OOQO'#H^'#H^O&=yQ`O1G6iO9uQ!0LrO<<GqOOQ[<<Gq<<GqO@zQ`O<<GqO&>RQ`O7+,WO&>WQ`O7+,XO%[QlO7+,WO%[QlO7+,XOOQ[7+)V7+)VO&>]Q`O7+)VO&>bQlO7+)VO&>iQ`O7+)VOOQ[<<Ly<<LyOOQ[<<L{<<L{OOQ[-E=Q-E=QOOQ[1G3z1G3zO&>nQ`O,5>aOOQ[,5>c,5>cO&>sQ`O1G4QO9eQ`O7+&fO!)[QlO7+&fOOQO7+%_7+%_O&>xQ?MtO1G6ZO?YQ`O7+%_OOQ!0Lf<<Ia<<IaOOQ!0Lf<<Iz<<IzO?YQ`O<<IzOOQO<<Is<<IsO$AlQ!0MxO<<IsO%[QlO<<IsOOQO<<Id<<IdO!ByQ!0LrO<<IdO&?SQ!0LrO<<IsO&?_Q!0MxO<= ^O&?oQ`O<= ]OOQO7+*_7+*_O9eQ`O7+*_OOQ[ANAkANAkO&?wQ!fOANAkO!&zQMhOANAkO#(ZQ`OANAkO4UQ!fOANAkO&@OQ`OANAkO%[QlOANAkO&@WQ!0MzO7+'zO&BiQ!0MzO,5?aO&DtQ!0MzO,5?cO&GPQ!0MzO7+'|O&IbQ!fO1G4lO&IlQ?MtO7+&aO&KpQ?MvO,5=XO&MwQ?MvO,5=ZO&NXQ?MvO,5=XO&NiQ?MvO,5=ZO&NyQ?MvO,59uO'#PQ?MvO,5<kO'%SQ?MvO,5<mO''hQ?MvO,5<{O')^Q?MtO7+'kO')kQ?MtO7+'mO')xQ`O,5<]OOQO7+'`7+'`OOQ!0Lh7+*d7+*dO')}QMjO<<K}OOQO1G4w1G4wO'*UQ`O1G4wO'*aQ`O1G4wO'*oQ`O7++|O'*oQ`O7++|O!&zQMhO1G4yO'*wQ!dO1G4yO'+RQ`O7++}O'+ZQ`O7+(VO'+fQ!dO7+(VOOQ!0Lb7+(T7+(TOOQ!0Lb7+(U7+(UO!CUQpO7+(TOCwQ`O7+(TO'+pQ`O7+(VO!&zQMhO7+(VO$+YQ`O7+(UO'+uQ`O7+(VOCwQ`O7+(UO'+}QMjO<<NwO!,TQMhO<<NwOOQ!0Lh7+$}7+$}O',XQ!dO,5?fOOQO-E<x-E<xO',cQ!0MvO7+(YO!&zQMhO7+(YOOQ[AN=gAN=gO9kQ`O1G5WOOQO1G5W1G5WO',sQ`O1G5WO',xQ`O7+,VO',xQ`O7+,VO9uQ!0LrOANBWO@zQ`OANBWOOQ[ANBWANBWO'-QQ`OANBWOOQ[ANAsANAsOOQ[ANAtANAtO'-VQ`O,5?hOOQO-E<z-E<zO'-bQ?MtO1G6hOOQO,5?j,5?jOOQO-E<|-E<|OOQ[1G3a1G3aO'-lQ`O,5=POOQ[<<Lf<<LfO!&zQMhO<<LfO&=UQ`O<<LfO'-qQ`O<<LfO%[QlO<<LfOOQ[<<Lh<<LhO9uQ!0LrO<<LhO$%dQ`O<<LhO9`Q`O<<LhO'-yQpO1G5VO'.UQ`O7+,TOOQ[AN=]AN=]O9uQ!0LrOAN=]OOQ[<= r<= rOOQ[<= s<= sO'.^Q`O<= rO'.cQ`O<= sOOQ[<<Lq<<LqO'.hQ`O<<LqO'.mQlO<<LqOOQ[1G3{1G3{O?YQ`O7+)lO'.tQ`O<<JQO'/PQ?MtO<<JQOOQO<<Hy<<HyOOQ!0LfAN?fAN?fOOQOAN?_AN?_O$AlQ!0MxOAN?_OOQOAN?OAN?OO%[QlOAN?_OOQO<<My<<MyOOQ[G27VG27VO!&zQMhOG27VO#(ZQ`OG27VO'/ZQ!fOG27VO4UQ!fOG27VO'/bQ`OG27VO'/jQ?MtO<<JfO'/wQ?MvO1G2`O'1mQ?MvO,5?aO'3pQ?MvO,5?cO'5sQ?MvO1G2sO'7vQ?MvO1G2uO'9yQ?MtO<<KXO':WQ?MtO<<I{OOQO1G1w1G1wO!,TQMhOANAiOOQO7+*c7+*cO':eQ`O7+*cO':pQ`O<= hO':xQ!dO7+*eOOQ!0Lb<<Kq<<KqO$+YQ`O<<KqOCwQ`O<<KqO';SQ`O<<KqO!&zQMhO<<KqOOQ!0Lb<<Ko<<KoO!CUQpO<<KoO';_Q!dO<<KqOOQ!0Lb<<Kp<<KpO';iQ`O<<KqO!&zQMhO<<KqO$+YQ`O<<KpO';nQMjOANDcO';xQ!0MvO<<KtOOQO7+*r7+*rO9kQ`O7+*rO'<YQ`O<= qOOQ[G27rG27rO9uQ!0LrOG27rO@zQ`OG27rO!)[QlO1G5SO'<bQ`O7+,SO'<jQ`O1G2kO&=UQ`OANBQOOQ[ANBQANBQO!&zQMhOANBQO'<oQ`OANBQOOQ[ANBSANBSO9uQ!0LrOANBSO$%dQ`OANBSOOQO'#H_'#H_OOQO7+*q7+*qOOQ[G22wG22wOOQ[ANE^ANE^OOQ[ANE_ANE_OOQ[ANB]ANB]O'<wQ`OANB]OOQ[<<MW<<MWO!)[QlOAN?lOOQOG24yG24yO$AlQ!0MxOG24yO#(ZQ`OLD,qOOQ[LD,qLD,qO!&zQMhOLD,qO'<|Q!fOLD,qO'=TQ?MvO7+'zO'>yQ?MvO,5?aO'@|Q?MvO,5?cO'CPQ?MvO7+'|O'DuQMjOG27TOOQO<<M}<<M}OOQ!0LbANA]ANA]O$+YQ`OANA]OCwQ`OANA]O'EVQ!dOANA]OOQ!0LbANAZANAZO'E^Q`OANA]O!&zQMhOANA]O'EiQ!dOANA]OOQ!0LbANA[ANA[OOQO<<N^<<N^OOQ[LD-^LD-^O9uQ!0LrOLD-^O'EsQ?MtO7+*nOOQO'#Gf'#GfOOQ[G27lG27lO&=UQ`OG27lO!&zQMhOG27lOOQ[G27nG27nO9uQ!0LrOG27nOOQ[G27wG27wO'E}Q?MtOG25WOOQOLD*eLD*eOOQ[!$(!]!$(!]O#(ZQ`O!$(!]O!&zQMhO!$(!]O'FXQ!0MzOG27TOOQ!0LbG26wG26wO$+YQ`OG26wO'HjQ`OG26wOCwQ`OG26wO'HuQ!dOG26wO!&zQMhOG26wOOQ[!$(!x!$(!xOOQ[LD-WLD-WO&=UQ`OLD-WOOQ[LD-YLD-YOOQ[!)9Ew!)9EwO#(ZQ`O!)9EwOOQ!0LbLD,cLD,cO$+YQ`OLD,cOCwQ`OLD,cO'H|Q`OLD,cO'IXQ!dOLD,cOOQ[!$(!r!$(!rOOQ[!.K;c!.K;cO'I`Q?MvOG27TOOQ!0Lb!$( }!$( }O$+YQ`O!$( }OCwQ`O!$( }O'KUQ`O!$( }OOQ!0Lb!)9Ei!)9EiO$+YQ`O!)9EiOCwQ`O!)9EiOOQ!0Lb!.K;T!.K;TO$+YQ`O!.K;TOOQ!0Lb!4/0o!4/0oO!)[QlO'#DzO1PQ`O'#EXO'KaQ!fO'#JrO'KhQ!L^O'#DvO'KoQlO'#EOO'KvQ!fO'#CiO'N^Q!fO'#CiO!)[QlO'#EQO'NnQlO,5;ZO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO'#IpO(!qQ`O,5<iO!)[QlO,5;eO(!yQMhO,5;eO($dQMhO,5;eO!)[QlO,5;wO!&zQMhO'#GmO(!yQMhO'#GmO!&zQMhO'#GoO(!yQMhO'#GoO1SQ`O'#DZO1SQ`O'#DZO!&zQMhO'#GPO(!yQMhO'#GPO!&zQMhO'#GRO(!yQMhO'#GRO!&zQMhO'#GaO(!yQMhO'#GaO!)[QlO,5:jO($kQpO'#D_O($uQpO'#JvO!)[QlO,5@oO'NnQlO1G0uO(%PQ?MtO'#CiO!)[QlO1G2PO!&zQMhO'#IuO(!yQMhO'#IuO!&zQMhO'#IwO(!yQMhO'#IwO(%ZQ!dO'#CrO!&zQMhO,5<tO(!yQMhO,5<tO'NnQlO1G2RO!)[QlO7+&zO!&zQMhO1G2`O(!yQMhO1G2`O!&zQMhO'#IuO(!yQMhO'#IuO!&zQMhO'#IwO(!yQMhO'#IwO!&zQMhO1G2bO(!yQMhO1G2bO'NnQlO7+'mO'NnQlO7+&aO!&zQMhOANAiO(!yQMhOANAiO(%nQ`O'#EoO(%sQ`O'#EoO(%{Q`O'#F]O(&QQ`O'#EyO(&VQ`O'#KTO(&bQ`O'#KRO(&mQ`O,5;ZO(&rQMjO,5<eO(&yQ`O'#GYO('OQ`O'#GYO('TQ`O,5<eO(']Q`O,5<gO('eQ`O,5;ZO('mQ?MtO1G1`O('tQ`O,5<tO('yQ`O,5<tO((OQ`O,5<vO((TQ`O,5<vO((YQ`O1G2RO((_Q`O1G0uO((dQMjO<<K}O((kQMjO<<K}O((rQMhO'#F|O9`Q`O'#F{OAuQ`O'#EnO!)[QlO,5;tO!3oQ`O'#GYO!3oQ`O'#GYO!3oQ`O'#G[O!3oQ`O'#G[O!,TQMhO7+(cO!,TQMhO7+(cO%.zQ!dO1G2wO%.zQ!dO1G2wO!&zQMhO,5=]O!&zQMhO,5=]",stateData:"()x~O'|OS'}OSTOS(ORQ~OPYOQYOSfOY!VOaqOdzOeyOl!POpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_XO!iuO!lZO!oYO!pYO!qYO!svO!uwO!xxO!|]O$W|O$niO%h}O%j!QO%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO%y!UO&W!WO&^!XO&`!YO&b!ZO&d![O&g!]O&m!^O&s!_O&u!`O&w!aO&y!bO&{!cO(TSO(VTO(YUO(aVO(o[O~OWtO~P`OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oa!wOs!nO!S!oO!b!yO!c!vO!d!vO!|<VO#T!pO#U!pO#V!xO#W!pO#X!pO#[!zO#]!zO(U!lO(VTO(YUO(e!mO(o!sO~O(O!{O~OP]XR]X[]Xa]Xj]Xr]X!Q]X!S]X!]]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X'z]X(a]X(r]X(y]X(z]X~O!g%RX~P(qO_!}O(V#PO(W!}O(X#PO~O_#QO(X#PO(Y#PO(Z#QO~Ox#SO!U#TO(b#TO(c#VO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T<ZO(VTO(YUO(aVO(o[O~O![#ZO!]#WO!Y(hP!Y(vP~P+}O!^#cO~P`OPYOQYOSfOd!jOe!iOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(VTO(YUO(aVO(o[O~Op#mO![#iO!|]O#i#lO#j#iO(T<[O!k(sP~P.iO!l#oO(T#nO~O!x#sO!|]O%h#tO~O#k#uO~O!g#vO#k#uO~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!]$_O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~Oa(fX'z(fX'w(fX!k(fX!Y(fX!_(fX%i(fX!g(fX~P1qO#S$dO#`$eO$Q$eOP(gXR(gX[(gXj(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX!_(gX%i(gX~Oa(gX'z(gX'w(gX!Y(gX!k(gXv(gX!g(gX~P4UO#`$eO~O$]$hO$_$gO$f$mO~OSfO!_$nO$i$oO$k$qO~Oh%VOj%dOk%dOp%WOr%XOs$tOt$tOz%YO|%ZO!O%]O!S${O!_$|O!i%bO!l$xO#j%cO$W%`O$t%^O$v%_O$y%aO(T$sO(VTO(YUO(a$uO(y$}O(z%POg(^P~Ol%[O~P7eO!l%eO~O!S%hO!_%iO(T%gO~O!g%mO~Oa%nO'z%nO~O!Q%rO~P%[O(U!lO~P%[O%n%vO~P%[Oh%VO!l%eO(T%gO(U!lO~Oe%}O!l%eO(T%gO~Oj$RO~O!_&PO(T%gO(U!lO(VTO(YUO`)WP~O!Q&SO!l&RO%j&VO&T&WO~P;SO!x#sO~O%s&YO!S)SX!_)SX(T)SX~O(T&ZO~Ol!PO!u&`O%j!QO%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO~Od&eOe&dO!x&bO%h&cO%{&aO~P<bOd&hOeyOl!PO!_&gO!u&`O!xxO!|]O%h}O%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO%y!UO~Ob&kO#`&nO%j&iO(U!lO~P=gO!l&oO!u&sO~O!l#oO~O!_XO~Oa%nO'x&{O'z%nO~Oa%nO'x'OO'z%nO~Oa%nO'x'QO'z%nO~O'w]X!Y]Xv]X!k]X&[]X!_]X%i]X!g]X~P(qO!b'_O!c'WO!d'WO(U!lO(VTO(YUO~Os'UO!S'TO!['XO(e'SO!^(iP!^(xP~P@nOn'bO!_'`O(T%gO~Oe'gO!l%eO(T%gO~O!Q&SO!l&RO~Os!nO!S!oO!|<VO#T!pO#U!pO#W!pO#X!pO(U!lO(VTO(YUO(e!mO(o!sO~O!b'mO!c'lO!d'lO#V!pO#['nO#]'nO~PBYOa%nOh%VO!g#vO!l%eO'z%nO(r'pO~O!p'tO#`'rO~PChOs!nO!S!oO(VTO(YUO(e!mO(o!sO~O!_XOs(mX!S(mX!b(mX!c(mX!d(mX!|(mX#T(mX#U(mX#V(mX#W(mX#X(mX#[(mX#](mX(U(mX(V(mX(Y(mX(e(mX(o(mX~O!c'lO!d'lO(U!lO~PDWO(P'xO(Q'xO(R'zO~O_!}O(V'|O(W!}O(X'|O~O_#QO(X'|O(Y'|O(Z#QO~Ov(OO~P%[Ox#SO!U#TO(b#TO(c(RO~O![(TO!Y'WX!Y'^X!]'WX!]'^X~P+}O!](VO!Y(hX~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!](VO!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~O!Y(hX~PHRO!Y([O~O!Y(uX!](uX!g(uX!k(uX(r(uX~O#`(uX#k#dX!^(uX~PJUO#`(]O!Y(wX!](wX~O!](^O!Y(vX~O!Y(aO~O#`$eO~PJUO!^(bO~P`OR#zO!Q#yO!S#{O!l#xO(aVOP!na[!naj!nar!na!]!na!p!na#R!na#n!na#o!na#p!na#q!na#r!na#s!na#t!na#u!na#v!na#x!na#z!na#{!na(r!na(y!na(z!na~Oa!na'z!na'w!na!Y!na!k!nav!na!_!na%i!na!g!na~PKlO!k(cO~O!g#vO#`(dO(r'pO!](tXa(tX'z(tX~O!k(tX~PNXO!S%hO!_%iO!|]O#i(iO#j(hO(T%gO~O!](jO!k(sX~O!k(lO~O!S%hO!_%iO#j(hO(T%gO~OP(gXR(gX[(gXj(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX~O!g#vO!k(gX~P! uOR(nO!Q(mO!l#xO#S$dO!|!{a!S!{a~O!x!{a%h!{a!_!{a#i!{a#j!{a(T!{a~P!#vO!x(rO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_XO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~O#k(xO~O![(zO!k(kP~P%[O(e(|O(o[O~O!S)OO!l#xO(e(|O(o[O~OP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_!eO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(T)]O(VTO(YUO(aVO(o[O~O!]$_Oa$qa'z$qa'w$qa!k$qa!Y$qa!_$qa%i$qa!g$qa~Ol)dO~P!&zOh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O%]O!S${O!_$|O!i%bO!l$xO#j%cO$W%`O$t%^O$v%_O$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~Og(pP~P!,TO!Q)iO!g)hO!_$^X$Z$^X$]$^X$_$^X$f$^X~O!g)hO!_({X$Z({X$]({X$_({X$f({X~O!Q)iO~P!.^O!Q)iO!_({X$Z({X$]({X$_({X$f({X~O!_)kO$Z)oO$])jO$_)jO$f)pO~O![)sO~P!)[O$]$hO$_$gO$f)wO~On$zX!Q$zX#S$zX'y$zX(y$zX(z$zX~OgmXg$zXnmX!]mX#`mX~P!0SOx)yO(b)zO(c)|O~On*VO!Q*OO'y*PO(y$}O(z%PO~Og)}O~P!1WOg*WO~Oh%VOr%XOs$tOt$tOz%YO|%ZO!O<sO!S*YO!_*ZO!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(VTO(YUO(a$uO(y$}O(z%PO~Op*`O![*^O(T*XO!k)OP~P!1uO#k*aO~O!l*bO~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(T*dO(VTO(YUO(a$uO(y$}O(z%PO~O![*gO!Y)PP~P!3tOr*sOs!nO!S*iO!b*qO!c*kO!d*kO!l*bO#[*rO%`*mO(U!lO(VTO(YUO(e!mO~O!^*pO~P!5iO#S$dOn(`X!Q(`X'y(`X(y(`X(z(`X!](`X#`(`X~Og(`X$O(`X~P!6kOn*xO#`*wOg(_X!](_X~O!]*yOg(^X~Oj%dOk%dOl%dO(T&ZOg(^P~Os*|O~Og)}O(T&ZO~O!l+SO~O(T(vO~Op+WO!S%hO![#iO!_%iO!|]O#i#lO#j#iO(T%gO!k(sP~O!g#vO#k+XO~O!S%hO![+ZO!](^O!_%iO(T%gO!Y(vP~Os'[O!S+]O![+[O(VTO(YUO(e(|O~O!^(xP~P!9|O!]+^Oa)TX'z)TX~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~Oa!ja!]!ja'z!ja'w!ja!Y!ja!k!jav!ja!_!ja%i!ja!g!ja~P!:tOR#zO!Q#yO!S#{O!l#xO(aVOP!ra[!raj!rar!ra!]!ra!p!ra#R!ra#n!ra#o!ra#p!ra#q!ra#r!ra#s!ra#t!ra#u!ra#v!ra#x!ra#z!ra#{!ra(r!ra(y!ra(z!ra~Oa!ra'z!ra'w!ra!Y!ra!k!rav!ra!_!ra%i!ra!g!ra~P!=[OR#zO!Q#yO!S#{O!l#xO(aVOP!ta[!taj!tar!ta!]!ta!p!ta#R!ta#n!ta#o!ta#p!ta#q!ta#r!ta#s!ta#t!ta#u!ta#v!ta#x!ta#z!ta#{!ta(r!ta(y!ta(z!ta~Oa!ta'z!ta'w!ta!Y!ta!k!tav!ta!_!ta%i!ta!g!ta~P!?rOh%VOn+gO!_'`O%i+fO~O!g+iOa(]X!_(]X'z(]X!](]X~Oa%nO!_XO'z%nO~Oh%VO!l%eO~Oh%VO!l%eO(T%gO~O!g#vO#k(xO~Ob+tO%j+uO(T+qO(VTO(YUO!^)XP~O!]+vO`)WX~O[+zO~O`+{O~O!_&PO(T%gO(U!lO`)WP~O%j,OO~P;SOh%VO#`,SO~Oh%VOn,VO!_$|O~O!_,XO~O!Q,ZO!_XO~O%n%vO~O!x,`O~Oe,eO~Ob,fO(T#nO(VTO(YUO!^)VP~Oe%}O~O%j!QO(T&ZO~P=gO[,kO`,jO~OPYOQYOSfOdzOeyOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!iuO!lZO!oYO!pYO!qYO!svO!xxO!|]O$niO%h}O(VTO(YUO(aVO(o[O~O!_!eO!u!gO$W!kO(T!dO~P!FyO`,jOa%nO'z%nO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oa,pOl!OO!uwO%l!OO%m!OO%n!OO~P!IcO!l&oO~O&^,vO~O!_,xO~O&o,zO&q,{OP&laQ&laS&laY&laa&lad&lae&lal&lap&lar&las&lat&laz&la|&la!O&la!S&la!W&la!X&la!_&la!i&la!l&la!o&la!p&la!q&la!s&la!u&la!x&la!|&la$W&la$n&la%h&la%j&la%l&la%m&la%n&la%q&la%s&la%v&la%w&la%y&la&W&la&^&la&`&la&b&la&d&la&g&la&m&la&s&la&u&la&w&la&y&la&{&la'w&la(T&la(V&la(Y&la(a&la(o&la!^&la&e&lab&la&j&la~O(T-QO~Oh!eX!]!RX!^!RX!g!RX!g!eX!l!eX#`!RX~O!]!eX!^!eX~P#!iO!g-VO#`-UOh(jX!]#hX!^#hX!g(jX!l(jX~O!](jX!^(jX~P##[Oh%VO!g-XO!l%eO!]!aX!^!aX~Os!nO!S!oO(VTO(YUO(e!mO~OP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_!eO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(VTO(YUO(aVO(o[O~O(T=QO~P#$qO!]-]O!^(iX~O!^-_O~O!g-VO#`-UO!]#hX!^#hX~O!]-`O!^(xX~O!^-bO~O!c-cO!d-cO(U!lO~P#$`O!^-fO~P'_On-iO!_'`O~O!Y-nO~Os!{a!b!{a!c!{a!d!{a#T!{a#U!{a#V!{a#W!{a#X!{a#[!{a#]!{a(U!{a(V!{a(Y!{a(e!{a(o!{a~P!#vO!p-sO#`-qO~PChO!c-uO!d-uO(U!lO~PDWOa%nO#`-qO'z%nO~Oa%nO!g#vO#`-qO'z%nO~Oa%nO!g#vO!p-sO#`-qO'z%nO(r'pO~O(P'xO(Q'xO(R-zO~Ov-{O~O!Y'Wa!]'Wa~P!:tO![.PO!Y'WX!]'WX~P%[O!](VO!Y(ha~O!Y(ha~PHRO!](^O!Y(va~O!S%hO![.TO!_%iO(T%gO!Y'^X!]'^X~O#`.VO!](ta!k(taa(ta'z(ta~O!g#vO~P#,wO!](jO!k(sa~O!S%hO!_%iO#j.ZO(T%gO~Op.`O!S%hO![.]O!_%iO!|]O#i._O#j.]O(T%gO!]'aX!k'aX~OR.dO!l#xO~Oh%VOn.gO!_'`O%i.fO~Oa#ci!]#ci'z#ci'w#ci!Y#ci!k#civ#ci!_#ci%i#ci!g#ci~P!:tOn>]O!Q*OO'y*PO(y$}O(z%PO~O#k#_aa#_a#`#_a'z#_a!]#_a!k#_a!_#_a!Y#_a~P#/sO#k(`XP(`XR(`X[(`Xa(`Xj(`Xr(`X!S(`X!l(`X!p(`X#R(`X#n(`X#o(`X#p(`X#q(`X#r(`X#s(`X#t(`X#u(`X#v(`X#x(`X#z(`X#{(`X'z(`X(a(`X(r(`X!k(`X!Y(`X'w(`Xv(`X!_(`X%i(`X!g(`X~P!6kO!].tO!k(kX~P!:tO!k.wO~O!Y.yO~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O(aVO[#mia#mij#mir#mi!]#mi#R#mi#o#mi#p#mi#q#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#n#mi~P#3cO#n$OO~P#3cOP$[OR#zOr$aO!Q#yO!S#{O!l#xO!p$[O#n$OO#o$PO#p$PO#q$PO(aVO[#mia#mij#mi!]#mi#R#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#r#mi~P#6QO#r$QO~P#6QOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO(aVOa#mi!]#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#v#mi~P#8oOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO(aVO(z#}Oa#mi!]#mi#z#mi#{#mi'z#mi(r#mi(y#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#x$UO~P#;VO#x#mi~P#;VO#v$SO~P#8oOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO(aVO(y#|O(z#}Oa#mi!]#mi#{#mi'z#mi(r#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#z#mi~P#={O#z$WO~P#={OP]XR]X[]Xj]Xr]X!Q]X!S]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X!]]X!^]X~O$O]X~P#@jOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO#x<eO#z<gO#{<hO(aVO(r$YO(y#|O(z#}O~O$O.{O~P#BwO#S$dO#`<nO$Q<nO$O(gX!^(gX~P! uOa'da!]'da'z'da'w'da!k'da!Y'dav'da!_'da%i'da!g'da~P!:tO[#mia#mij#mir#mi!]#mi#R#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O#n$OO#o$PO#p$PO#q$PO(aVO(y#mi(z#mi~P#EyOn>]O!Q*OO'y*PO(y$}O(z%POP#miR#mi!S#mi!l#mi!p#mi#n#mi#o#mi#p#mi#q#mi(a#mi~P#EyO!]/POg(pX~P!1WOg/RO~Oa$Pi!]$Pi'z$Pi'w$Pi!Y$Pi!k$Piv$Pi!_$Pi%i$Pi!g$Pi~P!:tO$]/SO$_/SO~O$]/TO$_/TO~O!g)hO#`/UO!_$cX$Z$cX$]$cX$_$cX$f$cX~O![/VO~O!_)kO$Z/XO$])jO$_)jO$f/YO~O!]<iO!^(fX~P#BwO!^/ZO~O!g)hO$f({X~O$f/]O~Ov/^O~P!&zOx)yO(b)zO(c/aO~O!S/dO~O(y$}On%aa!Q%aa'y%aa(z%aa!]%aa#`%aa~Og%aa$O%aa~P#L{O(z%POn%ca!Q%ca'y%ca(y%ca!]%ca#`%ca~Og%ca$O%ca~P#MnO!]fX!gfX!kfX!k$zX(rfX~P!0SOp%WO![/mO!](^O(T/lO!Y(vP!Y)PP~P!1uOr*sO!b*qO!c*kO!d*kO!l*bO#[*rO%`*mO(U!lO(VTO(YUO~Os<}O!S/nO![+[O!^*pO(e<|O!^(xP~P$ [O!k/oO~P#/sO!]/pO!g#vO(r'pO!k)OX~O!k/uO~OnoX!QoX'yoX(yoX(zoX~O!g#vO!koX~P$#OOp/wO!S%hO![*^O!_%iO(T%gO!k)OP~O#k/xO~O!Y$zX!]$zX!g%RX~P!0SO!]/yO!Y)PX~P#/sO!g/{O~O!Y/}O~OpkO(T0OO~P.iOh%VOr0TO!g#vO!l%eO(r'pO~O!g+iO~Oa%nO!]0XO'z%nO~O!^0ZO~P!5iO!c0[O!d0[O(U!lO~P#$`Os!nO!S0]O(VTO(YUO(e!mO~O#[0_O~Og%aa!]%aa#`%aa$O%aa~P!1WOg%ca!]%ca#`%ca$O%ca~P!1WOj%dOk%dOl%dO(T&ZOg'mX!]'mX~O!]*yOg(^a~Og0hO~On0jO#`0iOg(_a!](_a~OR0kO!Q0kO!S0lO#S$dOn}a'y}a(y}a(z}a!]}a#`}a~Og}a$O}a~P$(cO!Q*OO'y*POn$sa(y$sa(z$sa!]$sa#`$sa~Og$sa$O$sa~P$)_O!Q*OO'y*POn$ua(y$ua(z$ua!]$ua#`$ua~Og$ua$O$ua~P$*QO#k0oO~Og%Ta!]%Ta#`%Ta$O%Ta~P!1WO!g#vO~O#k0rO~O!]+^Oa)Ta'z)Ta~OR#zO!Q#yO!S#{O!l#xO(aVOP!ri[!rij!rir!ri!]!ri!p!ri#R!ri#n!ri#o!ri#p!ri#q!ri#r!ri#s!ri#t!ri#u!ri#v!ri#x!ri#z!ri#{!ri(r!ri(y!ri(z!ri~Oa!ri'z!ri'w!ri!Y!ri!k!riv!ri!_!ri%i!ri!g!ri~P$+oOh%VOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(VTO(YUO(a$uO(y$}O(z%PO~Op0{O%]0|O(T0zO~P$.VO!g+iOa(]a!_(]a'z(]a!](]a~O#k1SO~O[]X!]fX!^fX~O!]1TO!^)XX~O!^1VO~O[1WO~Ob1YO(T+qO(VTO(YUO~O!_&PO(T%gO`'uX!]'uX~O!]+vO`)Wa~O!k1]O~P!:tO[1`O~O`1aO~O#`1fO~On1iO!_$|O~O(e(|O!^)UP~Oh%VOn1rO!_1oO%i1qO~O[1|O!]1zO!^)VX~O!^1}O~O`2POa%nO'z%nO~O(T#nO(VTO(YUO~O#S$dO#`$eO$Q$eOP(gXR(gX[(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX~Oj2SO&[2TOa(gX~P$3pOj2SO#`$eO&[2TO~Oa2VO~P%[Oa2XO~O&e2[OP&ciQ&ciS&ciY&cia&cid&cie&cil&cip&cir&cis&cit&ciz&ci|&ci!O&ci!S&ci!W&ci!X&ci!_&ci!i&ci!l&ci!o&ci!p&ci!q&ci!s&ci!u&ci!x&ci!|&ci$W&ci$n&ci%h&ci%j&ci%l&ci%m&ci%n&ci%q&ci%s&ci%v&ci%w&ci%y&ci&W&ci&^&ci&`&ci&b&ci&d&ci&g&ci&m&ci&s&ci&u&ci&w&ci&y&ci&{&ci'w&ci(T&ci(V&ci(Y&ci(a&ci(o&ci!^&cib&ci&j&ci~Ob2bO!^2`O&j2aO~P`O!_XO!l2dO~O&q,{OP&liQ&liS&liY&lia&lid&lie&lil&lip&lir&lis&lit&liz&li|&li!O&li!S&li!W&li!X&li!_&li!i&li!l&li!o&li!p&li!q&li!s&li!u&li!x&li!|&li$W&li$n&li%h&li%j&li%l&li%m&li%n&li%q&li%s&li%v&li%w&li%y&li&W&li&^&li&`&li&b&li&d&li&g&li&m&li&s&li&u&li&w&li&y&li&{&li'w&li(T&li(V&li(Y&li(a&li(o&li!^&li&e&lib&li&j&li~O!Y2jO~O!]!aa!^!aa~P#BwOs!nO!S!oO![2pO(e!mO!]'XX!^'XX~P@nO!]-]O!^(ia~O!]'_X!^'_X~P!9|O!]-`O!^(xa~O!^2wO~P'_Oa%nO#`3QO'z%nO~Oa%nO!g#vO#`3QO'z%nO~Oa%nO!g#vO!p3UO#`3QO'z%nO(r'pO~Oa%nO'z%nO~P!:tO!]$_Ov$qa~O!Y'Wi!]'Wi~P!:tO!](VO!Y(hi~O!](^O!Y(vi~O!Y(wi!](wi~P!:tO!](ti!k(tia(ti'z(ti~P!:tO#`3WO!](ti!k(tia(ti'z(ti~O!](jO!k(si~O!S%hO!_%iO!|]O#i3]O#j3[O(T%gO~O!S%hO!_%iO#j3[O(T%gO~On3dO!_'`O%i3cO~Oh%VOn3dO!_'`O%i3cO~O#k%aaP%aaR%aa[%aaa%aaj%aar%aa!S%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa'z%aa(a%aa(r%aa!k%aa!Y%aa'w%aav%aa!_%aa%i%aa!g%aa~P#L{O#k%caP%caR%ca[%caa%caj%car%ca!S%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca'z%ca(a%ca(r%ca!k%ca!Y%ca'w%cav%ca!_%ca%i%ca!g%ca~P#MnO#k%aaP%aaR%aa[%aaa%aaj%aar%aa!S%aa!]%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa'z%aa(a%aa(r%aa!k%aa!Y%aa'w%aa#`%aav%aa!_%aa%i%aa!g%aa~P#/sO#k%caP%caR%ca[%caa%caj%car%ca!S%ca!]%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca'z%ca(a%ca(r%ca!k%ca!Y%ca'w%ca#`%cav%ca!_%ca%i%ca!g%ca~P#/sO#k}aP}a[}aa}aj}ar}a!l}a!p}a#R}a#n}a#o}a#p}a#q}a#r}a#s}a#t}a#u}a#v}a#x}a#z}a#{}a'z}a(a}a(r}a!k}a!Y}a'w}av}a!_}a%i}a!g}a~P$(cO#k$saP$saR$sa[$saa$saj$sar$sa!S$sa!l$sa!p$sa#R$sa#n$sa#o$sa#p$sa#q$sa#r$sa#s$sa#t$sa#u$sa#v$sa#x$sa#z$sa#{$sa'z$sa(a$sa(r$sa!k$sa!Y$sa'w$sav$sa!_$sa%i$sa!g$sa~P$)_O#k$uaP$uaR$ua[$uaa$uaj$uar$ua!S$ua!l$ua!p$ua#R$ua#n$ua#o$ua#p$ua#q$ua#r$ua#s$ua#t$ua#u$ua#v$ua#x$ua#z$ua#{$ua'z$ua(a$ua(r$ua!k$ua!Y$ua'w$uav$ua!_$ua%i$ua!g$ua~P$*QO#k%TaP%TaR%Ta[%Taa%Taj%Tar%Ta!S%Ta!]%Ta!l%Ta!p%Ta#R%Ta#n%Ta#o%Ta#p%Ta#q%Ta#r%Ta#s%Ta#t%Ta#u%Ta#v%Ta#x%Ta#z%Ta#{%Ta'z%Ta(a%Ta(r%Ta!k%Ta!Y%Ta'w%Ta#`%Tav%Ta!_%Ta%i%Ta!g%Ta~P#/sOa#cq!]#cq'z#cq'w#cq!Y#cq!k#cqv#cq!_#cq%i#cq!g#cq~P!:tO![3lO!]'YX!k'YX~P%[O!].tO!k(ka~O!].tO!k(ka~P!:tO!Y3oO~O$O!na!^!na~PKlO$O!ja!]!ja!^!ja~P#BwO$O!ra!^!ra~P!=[O$O!ta!^!ta~P!?rOg']X!]']X~P!,TO!]/POg(pa~OSfO!_4TO$d4UO~O!^4YO~Ov4ZO~P#/sOa$mq!]$mq'z$mq'w$mq!Y$mq!k$mqv$mq!_$mq%i$mq!g$mq~P!:tO!Y4]O~P!&zO!S4^O~O!Q*OO'y*PO(z%POn'ia(y'ia!]'ia#`'ia~Og'ia$O'ia~P%-fO!Q*OO'y*POn'ka(y'ka(z'ka!]'ka#`'ka~Og'ka$O'ka~P%.XO(r$YO~P#/sO!YfX!Y$zX!]fX!]$zX!g%RX#`fX~P!0SOp%WO(T=WO~P!1uOp4bO!S%hO![4aO!_%iO(T%gO!]'eX!k'eX~O!]/pO!k)Oa~O!]/pO!g#vO!k)Oa~O!]/pO!g#vO(r'pO!k)Oa~Og$|i!]$|i#`$|i$O$|i~P!1WO![4jO!Y'gX!]'gX~P!3tO!]/yO!Y)Pa~O!]/yO!Y)Pa~P#/sOP]XR]X[]Xj]Xr]X!Q]X!S]X!Y]X!]]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X~Oj%YX!g%YX~P%2OOj4oO!g#vO~Oh%VO!g#vO!l%eO~Oh%VOr4tO!l%eO(r'pO~Or4yO!g#vO(r'pO~Os!nO!S4zO(VTO(YUO(e!mO~O(y$}On%ai!Q%ai'y%ai(z%ai!]%ai#`%ai~Og%ai$O%ai~P%5oO(z%POn%ci!Q%ci'y%ci(y%ci!]%ci#`%ci~Og%ci$O%ci~P%6bOg(_i!](_i~P!1WO#`5QOg(_i!](_i~P!1WO!k5VO~Oa$oq!]$oq'z$oq'w$oq!Y$oq!k$oqv$oq!_$oq%i$oq!g$oq~P!:tO!Y5ZO~O!]5[O!_)QX~P#/sOa$zX!_$zX%^]X'z$zX!]$zX~P!0SO%^5_OaoX!_oX'zoX!]oX~P$#OOp5`O(T#nO~O%^5_O~Ob5fO%j5gO(T+qO(VTO(YUO!]'tX!^'tX~O!]1TO!^)Xa~O[5kO~O`5lO~O[5pO~Oa%nO'z%nO~P#/sO!]5uO#`5wO!^)UX~O!^5xO~Or6OOs!nO!S*iO!b!yO!c!vO!d!vO!|<VO#T!pO#U!pO#V!pO#W!pO#X!pO#[5}O#]!zO(U!lO(VTO(YUO(e!mO(o!sO~O!^5|O~P%;eOn6TO!_1oO%i6SO~Oh%VOn6TO!_1oO%i6SO~Ob6[O(T#nO(VTO(YUO!]'sX!^'sX~O!]1zO!^)Va~O(VTO(YUO(e6^O~O`6bO~Oj6eO&[6fO~PNXO!k6gO~P%[Oa6iO~Oa6iO~P%[Ob2bO!^6nO&j2aO~P`O!g6pO~O!g6rOh(ji!](ji!^(ji!g(ji!l(jir(ji(r(ji~O!]#hi!^#hi~P#BwO#`6sO!]#hi!^#hi~O!]!ai!^!ai~P#BwOa%nO#`6|O'z%nO~Oa%nO!g#vO#`6|O'z%nO~O!](tq!k(tqa(tq'z(tq~P!:tO!](jO!k(sq~O!S%hO!_%iO#j7TO(T%gO~O!_'`O%i7WO~On7[O!_'`O%i7WO~O#k'iaP'iaR'ia['iaa'iaj'iar'ia!S'ia!l'ia!p'ia#R'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#v'ia#x'ia#z'ia#{'ia'z'ia(a'ia(r'ia!k'ia!Y'ia'w'iav'ia!_'ia%i'ia!g'ia~P%-fO#k'kaP'kaR'ka['kaa'kaj'kar'ka!S'ka!l'ka!p'ka#R'ka#n'ka#o'ka#p'ka#q'ka#r'ka#s'ka#t'ka#u'ka#v'ka#x'ka#z'ka#{'ka'z'ka(a'ka(r'ka!k'ka!Y'ka'w'kav'ka!_'ka%i'ka!g'ka~P%.XO#k$|iP$|iR$|i[$|ia$|ij$|ir$|i!S$|i!]$|i!l$|i!p$|i#R$|i#n$|i#o$|i#p$|i#q$|i#r$|i#s$|i#t$|i#u$|i#v$|i#x$|i#z$|i#{$|i'z$|i(a$|i(r$|i!k$|i!Y$|i'w$|i#`$|iv$|i!_$|i%i$|i!g$|i~P#/sO#k%aiP%aiR%ai[%aia%aij%air%ai!S%ai!l%ai!p%ai#R%ai#n%ai#o%ai#p%ai#q%ai#r%ai#s%ai#t%ai#u%ai#v%ai#x%ai#z%ai#{%ai'z%ai(a%ai(r%ai!k%ai!Y%ai'w%aiv%ai!_%ai%i%ai!g%ai~P%5oO#k%ciP%ciR%ci[%cia%cij%cir%ci!S%ci!l%ci!p%ci#R%ci#n%ci#o%ci#p%ci#q%ci#r%ci#s%ci#t%ci#u%ci#v%ci#x%ci#z%ci#{%ci'z%ci(a%ci(r%ci!k%ci!Y%ci'w%civ%ci!_%ci%i%ci!g%ci~P%6bO!]'Ya!k'Ya~P!:tO!].tO!k(ki~O$O#ci!]#ci!^#ci~P#BwOP$[OR#zO!Q#yO!S#{O!l#xO!p$[O(aVO[#mij#mir#mi#R#mi#o#mi#p#mi#q#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#n#mi~P%NdO#n<_O~P%NdOP$[OR#zOr<kO!Q#yO!S#{O!l#xO!p$[O#n<_O#o<`O#p<`O#q<`O(aVO[#mij#mi#R#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#r#mi~P&!lO#r<aO~P&!lOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO(aVO#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#v#mi~P&$tOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO(aVO(z#}O#z#mi#{#mi$O#mi(r#mi(y#mi!]#mi!^#mi~O#x<eO~P&&uO#x#mi~P&&uO#v<cO~P&$tOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO#x<eO(aVO(y#|O(z#}O#{#mi$O#mi(r#mi!]#mi!^#mi~O#z#mi~P&)UO#z<gO~P&)UOa#|y!]#|y'z#|y'w#|y!Y#|y!k#|yv#|y!_#|y%i#|y!g#|y~P!:tO[#mij#mir#mi#R#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi!]#mi!^#mi~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O#n<_O#o<`O#p<`O#q<`O(aVO(y#mi(z#mi~P&,QOn>^O!Q*OO'y*PO(y$}O(z%POP#miR#mi!S#mi!l#mi!p#mi#n#mi#o#mi#p#mi#q#mi(a#mi~P&,QO#S$dOP(`XR(`X[(`Xj(`Xn(`Xr(`X!Q(`X!S(`X!l(`X!p(`X#R(`X#n(`X#o(`X#p(`X#q(`X#r(`X#s(`X#t(`X#u(`X#v(`X#x(`X#z(`X#{(`X$O(`X'y(`X(a(`X(r(`X(y(`X(z(`X!](`X!^(`X~O$O$Pi!]$Pi!^$Pi~P#BwO$O!ri!^!ri~P$+oOg']a!]']a~P!1WO!^7nO~O!]'da!^'da~P#BwO!Y7oO~P#/sO!g#vO(r'pO!]'ea!k'ea~O!]/pO!k)Oi~O!]/pO!g#vO!k)Oi~Og$|q!]$|q#`$|q$O$|q~P!1WO!Y'ga!]'ga~P#/sO!g7vO~O!]/yO!Y)Pi~P#/sO!]/yO!Y)Pi~O!Y7yO~Oh%VOr8OO!l%eO(r'pO~Oj8QO!g#vO~Or8TO!g#vO(r'pO~O!Q*OO'y*PO(z%POn'ja(y'ja!]'ja#`'ja~Og'ja$O'ja~P&5RO!Q*OO'y*POn'la(y'la(z'la!]'la#`'la~Og'la$O'la~P&5tOg(_q!](_q~P!1WO#`8VOg(_q!](_q~P!1WO!Y8WO~Og%Oq!]%Oq#`%Oq$O%Oq~P!1WOa$oy!]$oy'z$oy'w$oy!Y$oy!k$oyv$oy!_$oy%i$oy!g$oy~P!:tO!g6rO~O!]5[O!_)Qa~O!_'`OP$TaR$Ta[$Taj$Tar$Ta!Q$Ta!S$Ta!]$Ta!l$Ta!p$Ta#R$Ta#n$Ta#o$Ta#p$Ta#q$Ta#r$Ta#s$Ta#t$Ta#u$Ta#v$Ta#x$Ta#z$Ta#{$Ta(a$Ta(r$Ta(y$Ta(z$Ta~O%i7WO~P&8fO%^8[Oa%[i!_%[i'z%[i!]%[i~Oa#cy!]#cy'z#cy'w#cy!Y#cy!k#cyv#cy!_#cy%i#cy!g#cy~P!:tO[8^O~Ob8`O(T+qO(VTO(YUO~O!]1TO!^)Xi~O`8dO~O(e(|O!]'pX!^'pX~O!]5uO!^)Ua~O!^8nO~P%;eO(o!sO~P$&YO#[8oO~O!_1oO~O!_1oO%i8qO~On8tO!_1oO%i8qO~O[8yO!]'sa!^'sa~O!]1zO!^)Vi~O!k8}O~O!k9OO~O!k9RO~O!k9RO~P%[Oa9TO~O!g9UO~O!k9VO~O!](wi!^(wi~P#BwOa%nO#`9_O'z%nO~O!](ty!k(tya(ty'z(ty~P!:tO!](jO!k(sy~O%i9bO~P&8fO!_'`O%i9bO~O#k$|qP$|qR$|q[$|qa$|qj$|qr$|q!S$|q!]$|q!l$|q!p$|q#R$|q#n$|q#o$|q#p$|q#q$|q#r$|q#s$|q#t$|q#u$|q#v$|q#x$|q#z$|q#{$|q'z$|q(a$|q(r$|q!k$|q!Y$|q'w$|q#`$|qv$|q!_$|q%i$|q!g$|q~P#/sO#k'jaP'jaR'ja['jaa'jaj'jar'ja!S'ja!l'ja!p'ja#R'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#v'ja#x'ja#z'ja#{'ja'z'ja(a'ja(r'ja!k'ja!Y'ja'w'jav'ja!_'ja%i'ja!g'ja~P&5RO#k'laP'laR'la['laa'laj'lar'la!S'la!l'la!p'la#R'la#n'la#o'la#p'la#q'la#r'la#s'la#t'la#u'la#v'la#x'la#z'la#{'la'z'la(a'la(r'la!k'la!Y'la'w'lav'la!_'la%i'la!g'la~P&5tO#k%OqP%OqR%Oq[%Oqa%Oqj%Oqr%Oq!S%Oq!]%Oq!l%Oq!p%Oq#R%Oq#n%Oq#o%Oq#p%Oq#q%Oq#r%Oq#s%Oq#t%Oq#u%Oq#v%Oq#x%Oq#z%Oq#{%Oq'z%Oq(a%Oq(r%Oq!k%Oq!Y%Oq'w%Oq#`%Oqv%Oq!_%Oq%i%Oq!g%Oq~P#/sO!]'Yi!k'Yi~P!:tO$O#cq!]#cq!^#cq~P#BwO(y$}OP%aaR%aa[%aaj%aar%aa!S%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa$O%aa(a%aa(r%aa!]%aa!^%aa~On%aa!Q%aa'y%aa(z%aa~P&IyO(z%POP%caR%ca[%caj%car%ca!S%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca$O%ca(a%ca(r%ca!]%ca!^%ca~On%ca!Q%ca'y%ca(y%ca~P&LQOn>^O!Q*OO'y*PO(z%PO~P&IyOn>^O!Q*OO'y*PO(y$}O~P&LQOR0kO!Q0kO!S0lO#S$dOP}a[}aj}an}ar}a!l}a!p}a#R}a#n}a#o}a#p}a#q}a#r}a#s}a#t}a#u}a#v}a#x}a#z}a#{}a$O}a'y}a(a}a(r}a(y}a(z}a!]}a!^}a~O!Q*OO'y*POP$saR$sa[$saj$san$sar$sa!S$sa!l$sa!p$sa#R$sa#n$sa#o$sa#p$sa#q$sa#r$sa#s$sa#t$sa#u$sa#v$sa#x$sa#z$sa#{$sa$O$sa(a$sa(r$sa(y$sa(z$sa!]$sa!^$sa~O!Q*OO'y*POP$uaR$ua[$uaj$uan$uar$ua!S$ua!l$ua!p$ua#R$ua#n$ua#o$ua#p$ua#q$ua#r$ua#s$ua#t$ua#u$ua#v$ua#x$ua#z$ua#{$ua$O$ua(a$ua(r$ua(y$ua(z$ua!]$ua!^$ua~On>^O!Q*OO'y*PO(y$}O(z%PO~OP%TaR%Ta[%Taj%Tar%Ta!S%Ta!l%Ta!p%Ta#R%Ta#n%Ta#o%Ta#p%Ta#q%Ta#r%Ta#s%Ta#t%Ta#u%Ta#v%Ta#x%Ta#z%Ta#{%Ta$O%Ta(a%Ta(r%Ta!]%Ta!^%Ta~P''VO$O$mq!]$mq!^$mq~P#BwO$O$oq!]$oq!^$oq~P#BwO!^9oO~O$O9pO~P!1WO!g#vO!]'ei!k'ei~O!g#vO(r'pO!]'ei!k'ei~O!]/pO!k)Oq~O!Y'gi!]'gi~P#/sO!]/yO!Y)Pq~Or9wO!g#vO(r'pO~O[9yO!Y9xO~P#/sO!Y9xO~Oj:PO!g#vO~Og(_y!](_y~P!1WO!]'na!_'na~P#/sOa%[q!_%[q'z%[q!]%[q~P#/sO[:UO~O!]1TO!^)Xq~O`:YO~O#`:ZO!]'pa!^'pa~O!]5uO!^)Ui~P#BwO!S:]O~O!_1oO%i:`O~O(VTO(YUO(e:eO~O!]1zO!^)Vq~O!k:hO~O!k:iO~O!k:jO~O!k:jO~P%[O#`:mO!]#hy!^#hy~O!]#hy!^#hy~P#BwO%i:rO~P&8fO!_'`O%i:rO~O$O#|y!]#|y!^#|y~P#BwOP$|iR$|i[$|ij$|ir$|i!S$|i!l$|i!p$|i#R$|i#n$|i#o$|i#p$|i#q$|i#r$|i#s$|i#t$|i#u$|i#v$|i#x$|i#z$|i#{$|i$O$|i(a$|i(r$|i!]$|i!^$|i~P''VO!Q*OO'y*PO(z%POP'iaR'ia['iaj'ian'iar'ia!S'ia!l'ia!p'ia#R'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#v'ia#x'ia#z'ia#{'ia$O'ia(a'ia(r'ia(y'ia!]'ia!^'ia~O!Q*OO'y*POP'kaR'ka['kaj'kan'kar'ka!S'ka!l'ka!p'ka#R'ka#n'ka#o'ka#p'ka#q'ka#r'ka#s'ka#t'ka#u'ka#v'ka#x'ka#z'ka#{'ka$O'ka(a'ka(r'ka(y'ka(z'ka!]'ka!^'ka~O(y$}OP%aiR%ai[%aij%ain%air%ai!Q%ai!S%ai!l%ai!p%ai#R%ai#n%ai#o%ai#p%ai#q%ai#r%ai#s%ai#t%ai#u%ai#v%ai#x%ai#z%ai#{%ai$O%ai'y%ai(a%ai(r%ai(z%ai!]%ai!^%ai~O(z%POP%ciR%ci[%cij%cin%cir%ci!Q%ci!S%ci!l%ci!p%ci#R%ci#n%ci#o%ci#p%ci#q%ci#r%ci#s%ci#t%ci#u%ci#v%ci#x%ci#z%ci#{%ci$O%ci'y%ci(a%ci(r%ci(y%ci!]%ci!^%ci~O$O$oy!]$oy!^$oy~P#BwO$O#cy!]#cy!^#cy~P#BwO!g#vO!]'eq!k'eq~O!]/pO!k)Oy~O!Y'gq!]'gq~P#/sOr:|O!g#vO(r'pO~O[;QO!Y;PO~P#/sO!Y;PO~Og(_!R!](_!R~P!1WOa%[y!_%[y'z%[y!]%[y~P#/sO!]1TO!^)Xy~O!]5uO!^)Uq~O(T;XO~O!_1oO%i;[O~O!k;_O~O%i;dO~P&8fOP$|qR$|q[$|qj$|qr$|q!S$|q!l$|q!p$|q#R$|q#n$|q#o$|q#p$|q#q$|q#r$|q#s$|q#t$|q#u$|q#v$|q#x$|q#z$|q#{$|q$O$|q(a$|q(r$|q!]$|q!^$|q~P''VO!Q*OO'y*PO(z%POP'jaR'ja['jaj'jan'jar'ja!S'ja!l'ja!p'ja#R'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#v'ja#x'ja#z'ja#{'ja$O'ja(a'ja(r'ja(y'ja!]'ja!^'ja~O!Q*OO'y*POP'laR'la['laj'lan'lar'la!S'la!l'la!p'la#R'la#n'la#o'la#p'la#q'la#r'la#s'la#t'la#u'la#v'la#x'la#z'la#{'la$O'la(a'la(r'la(y'la(z'la!]'la!^'la~OP%OqR%Oq[%Oqj%Oqr%Oq!S%Oq!l%Oq!p%Oq#R%Oq#n%Oq#o%Oq#p%Oq#q%Oq#r%Oq#s%Oq#t%Oq#u%Oq#v%Oq#x%Oq#z%Oq#{%Oq$O%Oq(a%Oq(r%Oq!]%Oq!^%Oq~P''VOg%e!Z!]%e!Z#`%e!Z$O%e!Z~P!1WO!Y;hO~P#/sOr;iO!g#vO(r'pO~O[;kO!Y;hO~P#/sO!]'pq!^'pq~P#BwO!]#h!Z!^#h!Z~P#BwO#k%e!ZP%e!ZR%e!Z[%e!Za%e!Zj%e!Zr%e!Z!S%e!Z!]%e!Z!l%e!Z!p%e!Z#R%e!Z#n%e!Z#o%e!Z#p%e!Z#q%e!Z#r%e!Z#s%e!Z#t%e!Z#u%e!Z#v%e!Z#x%e!Z#z%e!Z#{%e!Z'z%e!Z(a%e!Z(r%e!Z!k%e!Z!Y%e!Z'w%e!Z#`%e!Zv%e!Z!_%e!Z%i%e!Z!g%e!Z~P#/sOr;tO!g#vO(r'pO~O!Y;uO~P#/sOr;|O!g#vO(r'pO~O!Y;}O~P#/sOP%e!ZR%e!Z[%e!Zj%e!Zr%e!Z!S%e!Z!l%e!Z!p%e!Z#R%e!Z#n%e!Z#o%e!Z#p%e!Z#q%e!Z#r%e!Z#s%e!Z#t%e!Z#u%e!Z#v%e!Z#x%e!Z#z%e!Z#{%e!Z$O%e!Z(a%e!Z(r%e!Z!]%e!Z!^%e!Z~P''VOr<QO!g#vO(r'pO~Ov(fX~P1qO!Q%rO~P!)[O(U!lO~P!)[O!YfX!]fX#`fX~P%2OOP]XR]X[]Xj]Xr]X!Q]X!S]X!]]X!]fX!l]X!p]X#R]X#S]X#`]X#`fX#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X~O!gfX!k]X!kfX(rfX~P'LTOP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_XO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(T)]O(VTO(YUO(aVO(o[O~O!]<iO!^$qa~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<tO!S${O!_$|O!i>WO!l$xO#j<zO$W%`O$t<vO$v<xO$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~Ol)dO~P(!yOr!eX(r!eX~P#!iOr(jX(r(jX~P##[O!^]X!^fX~P'LTO!YfX!Y$zX!]fX!]$zX#`fX~P!0SO#k<^O~O!g#vO#k<^O~O#`<nO~Oj<bO~O#`=OO!](wX!^(wX~O#`<nO!](uX!^(uX~O#k=PO~Og=RO~P!1WO#k=XO~O#k=YO~Og=RO(T&ZO~O!g#vO#k=ZO~O!g#vO#k=PO~O$O=[O~P#BwO#k=]O~O#k=^O~O#k=cO~O#k=dO~O#k=eO~O#k=fO~O$O=gO~P!1WO$O=hO~P!1WOl=sO~P7eOk#S#T#U#W#X#[#i#j#u$n$t$v$y%]%^%h%i%j%q%s%v%w%y%{~(OT#o!X'|(U#ps#n#qr!Q'}$]'}(T$_(e~",goto:"$9Y)]PPPPPP)^PP)aP)rP+W/]PPPP6mPP7TPP=QPPP@tPA^PA^PPPA^PCfPA^PA^PA^PCjPCoPD^PIWPPPI[PPPPI[L_PPPLeMVPI[PI[PP! eI[PPPI[PI[P!#lI[P!'S!(X!(bP!)U!)Y!)U!,gPPPPPPP!-W!(XPP!-h!/YP!2iI[I[!2n!5z!:h!:h!>gPPP!>oI[PPPPPPPPP!BOP!C]PPI[!DnPI[PI[I[I[I[I[PI[!FQP!I[P!LbP!Lf!Lp!Lt!LtP!IXP!Lx!LxP#!OP#!SI[PI[#!Y#%_CjA^PA^PA^A^P#&lA^A^#)OA^#+vA^#.SA^A^#.r#1W#1W#1]#1f#1W#1qPP#1WPA^#2ZA^#6YA^A^6mPPP#:_PPP#:x#:xP#:xP#;`#:xPP#;fP#;]P#;]#;y#;]#<e#<k#<n)aP#<q)aP#<z#<z#<zP)aP)aP)aP)aPP)aP#=Q#=TP#=T)aP#=XP#=[P)aP)aP)aP)aP)aP)a)aPP#=b#=h#=s#=y#>P#>V#>]#>k#>q#>{#?R#?]#?c#?s#?y#@k#@}#AT#AZ#Ai#BO#Cs#DR#DY#Et#FS#Gt#HS#HY#H`#Hf#Hp#Hv#H|#IW#Ij#IpPPPPPPPPPPP#IvPPPPPPP#Jk#Mx$ b$ i$ qPPP$']P$'f$*_$0x$0{$1O$1}$2Q$2X$2aP$2g$2jP$3W$3[$4S$5b$5g$5}PP$6S$6Y$6^$6a$6e$6i$7e$7|$8e$8i$8l$8o$8y$8|$9Q$9UR!|RoqOXst!Z#d%m&r&t&u&w,s,x2[2_Y!vQ'`-e1o5{Q%tvQ%|yQ&T|Q&j!VS'W!e-]Q'f!iS'l!r!yU*k$|*Z*oQ+o%}S+|&V&WQ,d&dQ-c'_Q-m'gQ-u'mQ0[*qQ1b,OQ1y,eR<{<Y%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+],p,s,x-i-q.P.V.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3l4z6T6e6f6i6|8t9T9_S#q]<V!r)_$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SU+P%]<s<tQ+t&PQ,f&gQ,m&oQ0x+gQ0}+iQ1Y+uQ2R,kQ3`.gQ5`0|Q5f1TQ6[1zQ7Y3dQ8`5gR9e7['QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S!S!nQ!r!v!y!z$|'W'_'`'l'm'n*k*o*q*r-]-c-e-u0[0_1o5{5}%[$ti#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^Q&X|Q'U!eS'[%i-`Q+t&PQ,P&WQ,f&gQ0n+SQ1Y+uQ1_+{Q2Q,jQ2R,kQ5f1TQ5o1aQ6[1zQ6_1|Q6`2PQ8`5gQ8c5lQ8|6bQ:X8dQ:f8yQ;V:YR<}*ZrnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_R,h&k&z^OPXYstuvwz!Z!`!g!j!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'b'r(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>R>S[#]WZ#W#Z'X(T!b%jm#h#i#l$x%e%h(^(h(i(j*Y*^*b+Z+[+^,o-V.T.Z.[.]._/m/p2d3[3]4a6r7TQ%wxQ%{yW&Q|&V&W,OQ&_!TQ'c!hQ'e!iQ(q#sS+n%|%}Q+r&PQ,_&bQ,c&dS-l'f'gQ.i(rQ1R+oQ1X+uQ1Z+vQ1^+zQ1t,`S1x,d,eQ2|-mQ5e1TQ5i1WQ5n1`Q6Z1yQ8_5gQ8b5kQ8f5pQ:T8^R;T:U!U$zi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y!^%yy!i!u%{%|%}'V'e'f'g'k'u*j+n+o-Y-l-m-t0R0U1R2u2|3T4r4s4v7}9{Q+h%wQ,T&[Q,W&]Q,b&dQ.h(qQ1s,_U1w,c,d,eQ3e.iQ6U1tS6Y1x1yQ8x6Z#f>T#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^o>U<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hW%Ti%V*y>PS&[!Q&iQ&]!RQ&^!SU*}%[%d=sR,R&Y%]%Si#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^T)z$u){V+P%]<s<tW'[!e%i*Z-`S(}#y#zQ+c%rQ+y&SS.b(m(nQ1j,XQ5T0kR8i5u'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S$i$^c#Y#e%q%s%u(S(Y(t(y)R)S)T)U)V)W)X)Y)Z)[)^)`)b)g)q+d+x-Z-x-}.S.U.s.v.z.|.}/O/b0p2k2n3O3V3k3p3q3r3s3t3u3v3w3x3y3z3{3|4P4Q4X5X5c6u6{7Q7a7b7k7l8k9X9]9g9m9n:o;W;`<W=vT#TV#U'RkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ'Y!eR2q-]!W!nQ!e!r!v!y!z$|'W'_'`'l'm'n*Z*k*o*q*r-]-c-e-u0[0_1o5{5}R1l,ZnqOXst!Z#d%m&r&t&u&w,s,x2[2_Q&y!^Q'v!xS(s#u<^Q+l%zQ,]&_Q,^&aQ-j'dQ-w'oS.r(x=PS0q+X=ZQ1P+mQ1n,[Q2c,zQ2e,{Q2m-WQ2z-kQ2}-oS5Y0r=eQ5a1QS5d1S=fQ6t2oQ6x2{Q6}3SQ8]5bQ9Y6vQ9Z6yQ9^7OR:l9V$d$]c#Y#e%s%u(S(Y(t(y)R)S)T)U)V)W)X)Y)Z)[)^)`)b)g)q+d+x-Z-x-}.S.U.s.v.z.}/O/b0p2k2n3O3V3k3p3q3r3s3t3u3v3w3x3y3z3{3|4P4Q4X5X5c6u6{7Q7a7b7k7l8k9X9]9g9m9n:o;W;`<W=vS(o#p'iQ)P#zS+b%q.|S.c(n(pR3^.d'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SS#q]<VQ&t!XQ&u!YQ&w![Q&x!]R2Z,vQ'a!hQ+e%wQ-h'cS.e(q+hQ2x-gW3b.h.i0w0yQ6w2yW7U3_3a3e5^U9a7V7X7ZU:q9c9d9fS;b:p:sQ;p;cR;x;qU!wQ'`-eT5y1o5{!Q_OXZ`st!V!Z#d#h%e%m&i&k&r&t&u&w(j,s,x.[2[2_]!pQ!r'`-e1o5{T#q]<V%^{OPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_S(}#y#zS.b(m(n!s=l$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SU$fd)_,mS(p#p'iU*v%R(w4OU0m+O.n7gQ5^0xQ7V3`Q9d7YR:s9em!tQ!r!v!y!z'`'l'm'n-e-u1o5{5}Q't!uS(f#g2US-s'k'wQ/s*]Q0R*jQ3U-vQ4f/tQ4r0TQ4s0UQ4x0^Q7r4`S7}4t4vS8R4y4{Q9r7sQ9v7yQ9{8OQ:Q8TS:{9w9xS;g:|;PS;s;h;iS;{;t;uS<P;|;}R<S<QQ#wbQ's!uS(e#g2US(g#m+WQ+Y%fQ+j%xQ+p&OU-r'k't'wQ.W(fU/r*]*`/wQ0S*jQ0V*lQ1O+kQ1u,aS3R-s-vQ3Z.`S4e/s/tQ4n0PS4q0R0^Q4u0WQ6W1vQ7P3US7q4`4bQ7u4fU7|4r4x4{Q8P4wQ8v6XS9q7r7sQ9u7yQ9}8RQ:O8SQ:c8wQ:y9rS:z9v9xQ;S:QQ;^:dS;f:{;PS;r;g;hS;z;s;uS<O;{;}Q<R<PQ<T<SQ=o=jQ={=tR=|=uV!wQ'`-e%^aOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_S#wz!j!r=i$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SR=o>R%^bOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_Q%fj!^%xy!i!u%{%|%}'V'e'f'g'k'u*j+n+o-Y-l-m-t0R0U1R2u2|3T4r4s4v7}9{S&Oz!jQ+k%yQ,a&dW1v,b,c,d,eU6X1w1x1yS8w6Y6ZQ:d8x!r=j$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ=t>QR=u>R%QeOPXYstuvw!Z!`!g!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_Y#bWZ#W#Z(T!b%jm#h#i#l$x%e%h(^(h(i(j*Y*^*b+Z+[+^,o-V.T.Z.[.]._/m/p2d3[3]4a6r7TQ,n&o!p=k$Z$n)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SR=n'XU']!e%i*ZR2s-`%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+],p,s,x-i-q.P.V.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3l4z6T6e6f6i6|8t9T9_!r)_$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ,m&oQ0x+gQ3`.gQ7Y3dR9e7[!b$Tc#Y%q(S(Y(t(y)Z)[)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<W!P<d)^)q-Z.|2k2n3p3y3z4P4X6u7b7k7l8k9X9g9m9n;W;`=v!f$Vc#Y%q(S(Y(t(y)W)X)Z)[)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<W!T<f)^)q-Z.|2k2n3p3v3w3y3z4P4X6u7b7k7l8k9X9g9m9n;W;`=v!^$Zc#Y%q(S(Y(t(y)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<WQ4_/kz>S)^)q-Z.|2k2n3p4P4X6u7b7k7l8k9X9g9m9n;W;`=vQ>X>ZR>Y>['QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SS$oh$pR4U/U'XgOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/U/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>ST$kf$qQ$ifS)j$l)nR)v$qT$jf$qT)l$l)n'XhOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/U/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>ST$oh$pQ$rhR)u$p%^jOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_!s>Q$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S#glOPXZst!Z!`!o#S#d#o#{$n%m&k&n&o&r&t&u&w&{'T'b)O)s*i+]+g,p,s,x-i.g/V/n0]0l1r2S2T2V2X2[2_2a3d4T4z6T6e6f6i7[8t9T!U%Ri$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y#f(w#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^Q+T%aQ/c*Oo4O<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!U$yi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>YQ*c$zU*l$|*Z*oQ+U%bQ0W*m#f=q#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n=r<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hQ=w>TQ=x>UQ=y>VR=z>W!U%Ri$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y#f(w#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^o4O<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hnoOXst!Z#d%m&r&t&u&w,s,x2[2_S*f${*YQ-R'OQ-S'QR4i/y%[%Si#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^Q,U&]Q1h,WQ5s1gR8h5tV*n$|*Z*oU*n$|*Z*oT5z1o5{S0P*i/nQ4w0]T8S4z:]Q+j%xQ0V*lQ1O+kQ1u,aQ6W1vQ8v6XQ:c8wR;^:d!U%Oi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Yx*R$v)e*S*u+V/v0d0e4R4g5R5S5W7p8U:R:x=p=}>OS0`*t0a#f<o#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n<p<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!d=S(u)c*[*e.j.m.q/_/k/|0v1e3h4[4h4l5r7]7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[`=T3}7c7f7j9h:t:w;yS=_.l3iT=`7e9k!U%Qi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y|*T$v)e*U*t+V/g/v0d0e4R4g4|5R5S5W7p8U:R:x=p=}>OS0b*u0c#f<q#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n<r<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!h=U(u)c*[*e.k.l.q/_/k/|0v1e3f3h4[4h4l5r7]7^7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[d=V3}7d7e7j9h9i:t:u:w;yS=a.m3jT=b7f9lrnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_Q&f!UR,p&ornOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_R&f!UQ,Y&^R1d,RsnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_Q1p,_S6R1s1tU8p6P6Q6US:_8r8sS;Y:^:aQ;m;ZR;w;nQ&m!VR,i&iR6_1|R:f8yW&Q|&V&W,OR1Z+vQ&r!WR,s&sR,y&xT2],x2_R,}&yQ,|&yR2f,}Q'y!{R-y'ySsOtQ#dXT%ps#dQ#OTR'{#OQ#RUR'}#RQ){$uR/`){Q#UVR(Q#UQ#XWU(W#X(X.QQ(X#YR.Q(YQ-^'YR2r-^Q.u(yS3m.u3nR3n.vQ-e'`R2v-eY!rQ'`-e1o5{R'j!rQ/Q)eR4S/QU#_W%h*YU(_#_(`.RQ(`#`R.R(ZQ-a']R2t-at`OXst!V!Z#d%m&i&k&r&t&u&w,s,x2[2_S#hZ%eU#r`#h.[R.[(jQ(k#jQ.X(gW.a(k.X3X7RQ3X.YR7R3YQ)n$lR/W)nQ$phR)t$pQ$`cU)a$`-|<jQ-|<WR<j)qQ/q*]W4c/q4d7t9sU4d/r/s/tS7t4e4fR9s7u$e*Q$v(u)c)e*[*e*t*u+Q+R+V.l.m.o.p.q/_/g/i/k/v/|0d0e0v1e3f3g3h3}4R4[4g4h4l4|5O5R5S5W5r7]7^7_7`7e7f7h7i7j7p7w7z8U8X8Z9h9i9j9t9|:R:S:t:u:v:w:x:};R;e;j;v;y=p=}>O>Z>[Q/z*eU4k/z4m7xQ4m/|R7x4lS*o$|*ZR0Y*ox*S$v)e*t*u+V/v0d0e4R4g5R5S5W7p8U:R:x=p=}>O!d.j(u)c*[*e.l.m.q/_/k/|0v1e3h4[4h4l5r7]7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[U/h*S.j7ca7c3}7e7f7j9h:t:w;yQ0a*tQ3i.lU4}0a3i9kR9k7e|*U$v)e*t*u+V/g/v0d0e4R4g4|5R5S5W7p8U:R:x=p=}>O!h.k(u)c*[*e.l.m.q/_/k/|0v1e3f3h4[4h4l5r7]7^7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[U/j*U.k7de7d3}7e7f7j9h9i:t:u:w;yQ0c*uQ3j.mU5P0c3j9lR9l7fQ*z%UR0g*zQ5]0vR8Y5]Q+_%kR0u+_Q5v1jS8j5v:[R:[8kQ,[&_R1m,[Q5{1oR8m5{Q1{,fS6]1{8zR8z6_Q1U+rW5h1U5j8a:VQ5j1XQ8a5iR:V8bQ+w&QR1[+wQ2_,xR6m2_YrOXst#dQ&v!ZQ+a%mQ,r&rQ,t&tQ,u&uQ,w&wQ2Y,sS2],x2_R6l2[Q%opQ&z!_Q&}!aQ'P!bQ'R!cQ'q!uQ+`%lQ+l%zQ,Q&XQ,h&mQ-P&|W-p'k's't'wQ-w'oQ0X*nQ1P+mQ1c,PS2O,i,lQ2g-OQ2h-RQ2i-SQ2}-oW3P-r-s-v-xQ5a1QQ5m1_Q5q1eQ6V1uQ6a2QQ6k2ZU6z3O3R3UQ6}3SQ8]5bQ8e5oQ8g5rQ8l5zQ8u6WQ8{6`S9[6{7PQ9^7OQ:W8cQ:b8vQ:g8|Q:n9]Q;U:XQ;]:cQ;a:oQ;l;VR;o;^Q%zyQ'd!iQ'o!uU+m%{%|%}Q-W'VU-k'e'f'gS-o'k'uQ0Q*jS1Q+n+oQ2o-YS2{-l-mQ3S-tS4p0R0UQ5b1RQ6v2uQ6y2|Q7O3TU7{4r4s4vQ9z7}R;O9{S$wi>PR*{%VU%Ui%V>PR0f*yQ$viS(u#v+iS)c$b$cQ)e$dQ*[$xS*e${*YQ*t%OQ*u%QQ+Q%^Q+R%_Q+V%cQ.l<oQ.m<qQ.o<uQ.p<wQ.q<yQ/_)yQ/g*RQ/i*TQ/k*VQ/v*aS/|*g/mQ0d*wQ0e*xl0v+f,V.f1i1q3c6S7W8q9b:`:r;[;dQ1e,SQ3f=SQ3g=UQ3h=XS3}<l<mQ4R/PS4[/d4^Q4g/xQ4h/yQ4l/{Q4|0`Q5O0bQ5R0iQ5S0jQ5W0oQ5r1fQ7]=]Q7^=_Q7_=aQ7`=cQ7e<pQ7f<rQ7h<vQ7i<xQ7j<zQ7p4_Q7w4jQ7z4oQ8U5QQ8X5[Q8Z5_Q9h=YQ9i=TQ9j=VQ9t7vQ9|8QQ:R8VQ:S8[Q:t=^Q:u=`Q:v=bQ:w=dQ:x9pQ:}9yQ;R:PQ;e=gQ;j;QQ;v;kQ;y=hQ=p>PQ=}>XQ>O>YQ>Z>]R>[>^Q+O%]Q.n<sR7g<tnpOXst!Z#d%m&r&t&u&w,s,x2[2_Q!fPS#fZ#oQ&|!`W'h!o*i0]4zQ(P#SQ)Q#{Q)r$nS,l&k&nQ,q&oQ-O&{S-T'T/nQ-g'bQ.x)OQ/[)sQ0s+]Q0y+gQ2W,pQ2y-iQ3a.gQ4W/VQ5U0lQ6Q1rQ6c2SQ6d2TQ6h2VQ6j2XQ6o2aQ7Z3dQ7m4TQ8s6TQ9P6eQ9Q6fQ9S6iQ9f7[Q:a8tR:k9T#[cOPXZst!Z!`!o#d#o#{%m&k&n&o&r&t&u&w&{'T'b)O*i+]+g,p,s,x-i.g/n0]0l1r2S2T2V2X2[2_2a3d4z6T6e6f6i7[8t9TQ#YWQ#eYQ%quQ%svS%uw!gS(S#W(VQ(Y#ZQ(t#uQ(y#xQ)R$OQ)S$PQ)T$QQ)U$RQ)V$SQ)W$TQ)X$UQ)Y$VQ)Z$WQ)[$XQ)^$ZQ)`$_Q)b$aQ)g$eW)q$n)s/V4TQ+d%tQ+x&RS-Z'X2pQ-x'rS-}(T.PQ.S(]Q.U(dQ.s(xQ.v(zQ.z<UQ.|<XQ.}<YQ/O<]Q/b)}Q0p+XQ2k-UQ2n-XQ3O-qQ3V.VQ3k.tQ3p<^Q3q<_Q3r<`Q3s<aQ3t<bQ3u<cQ3v<dQ3w<eQ3x<fQ3y<gQ3z<hQ3{.{Q3|<kQ4P<nQ4Q<{Q4X<iQ5X0rQ5c1SQ6u=OQ6{3QQ7Q3WQ7a3lQ7b=PQ7k=RQ7l=ZQ8k5wQ9X6sQ9]6|Q9g=[Q9m=eQ9n=fQ:o9_Q;W:ZQ;`:mQ<W#SR=v>SR#[WR'Z!el!tQ!r!v!y!z'`'l'm'n-e-u1o5{5}S'V!e-]U*j$|*Z*oS-Y'W'_S0U*k*qQ0^*rQ2u-cQ4v0[R4{0_R({#xQ!fQT-d'`-e]!qQ!r'`-e1o5{Q#p]R'i<VR)f$dY!uQ'`-e1o5{Q'k!rS'u!v!yS'w!z5}S-t'l'mQ-v'nR3T-uT#kZ%eS#jZ%eS%km,oU(g#h#i#lS.Y(h(iQ.^(jQ0t+^Q3Y.ZU3Z.[.]._S7S3[3]R9`7Td#^W#W#Z%h(T(^*Y+Z.T/mr#gZm#h#i#l%e(h(i(j+^.Z.[.]._3[3]7TS*]$x*bQ/t*^Q2U,oQ2l-VQ4`/pQ6q2dQ7s4aQ9W6rT=m'X+[V#aW%h*YU#`W%h*YS(U#W(^U(Z#Z+Z/mS-['X+[T.O(T.TV'^!e%i*ZQ$lfR)x$qT)m$l)nR4V/UT*_$x*bT*h${*YQ0w+fQ1g,VQ3_.fQ5t1iQ6P1qQ7X3cQ8r6SQ9c7WQ:^8qQ:p9bQ;Z:`Q;c:rQ;n;[R;q;dnqOXst!Z#d%m&r&t&u&w,s,x2[2_Q&l!VR,h&itmOXst!U!V!Z#d%m&i&r&t&u&w,s,x2[2_R,o&oT%lm,oR1k,XR,g&gQ&U|S+}&V&WR1^,OR+s&PT&p!W&sT&q!W&sT2^,x2_",nodeNames:"â  ArithOp ArithOp ?. JSXStartTag LineComment BlockComment Script Hashbang ExportDeclaration export Star as VariableName String Escape from ; default FunctionDeclaration async function VariableDefinition > < TypeParamList in out const TypeDefinition extends ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation InterpolationStart NullType null VoidType void TypeofType typeof MemberExpression . PropertyName [ TemplateString Escape Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewTarget new NewExpression ) ( ArgList UnaryExpression delete LogicOp BitOp YieldExpression yield AwaitExpression await ParenthesizedExpression ClassExpression class ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression TypeArgList CompareOp < declare Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression InstantiationExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast < ArrowFunction TypeParamList SequenceExpression InstantiationExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate asserts is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var using TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration defer ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression SingleClassItem",maxTerm:380,context:ude,nodeProps:[["isolate",-8,5,6,14,37,39,51,53,55,""],["group",-26,9,17,19,68,207,211,215,216,218,221,224,234,237,243,245,247,249,252,258,264,266,268,270,272,274,275,"Statement",-34,13,14,32,35,36,42,51,54,55,57,62,70,72,76,80,82,84,85,110,111,120,121,136,139,141,142,143,144,145,147,148,167,169,171,"Expression",-23,31,33,37,41,43,45,173,175,177,178,180,181,182,184,185,186,188,189,190,201,203,205,206,"Type",-3,88,103,109,"ClassItem"],["openedBy",23,"<",38,"InterpolationStart",56,"[",60,"{",73,"(",160,"JSXStartCloseTag"],["closedBy",-2,24,168,">",40,"InterpolationEnd",50,"]",61,"}",74,")",165,"JSXEndTag"]],propSources:[mde],skippedNodes:[0,5,6,278],repeatNodeCount:37,tokenData:"$Fq07[R!bOX%ZXY+gYZ-yZ[+g[]%Z]^.c^p%Zpq+gqr/mrs3cst:_tuEruvJSvwLkwx! Yxy!'iyz!(sz{!)}{|!,q|}!.O}!O!,q!O!P!/Y!P!Q!9j!Q!R#:O!R![#<_![!]#I_!]!^#Jk!^!_#Ku!_!`$![!`!a$$v!a!b$*T!b!c$,r!c!}Er!}#O$-|#O#P$/W#P#Q$4o#Q#R$5y#R#SEr#S#T$7W#T#o$8b#o#p$<r#p#q$=h#q#r$>x#r#s$@U#s$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$I|Er$I|$I}$Dk$I}$JO$Dk$JO$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr(n%d_$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&j&hT$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c&j&zP;=`<%l&c'|'U]$i&j(Z!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!b(SU(Z!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!b(iP;=`<%l'}'|(oP;=`<%l&}'[(y]$i&j(WpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rp)wU(WpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)rp*^P;=`<%l)r'[*dP;=`<%l(r#S*nX(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g#S+^P;=`<%l*g(n+dP;=`<%l%Z07[+rq$i&j(Wp(Z!b'|0/lOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p$f%Z$f$g+g$g#BY%Z#BY#BZ+g#BZ$IS%Z$IS$I_+g$I_$JT%Z$JT$JU+g$JU$KV%Z$KV$KW+g$KW&FU%Z&FU&FV+g&FV;'S%Z;'S;=`+a<%l?HT%Z?HT?HU+g?HUO%Z07[.ST(X#S$i&j'}0/lO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c07[.n_$i&j(Wp(Z!b'}0/lOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)3p/x`$i&j!p),Q(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW1V`#v(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`2X!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW2d_#v(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At3l_(V':f$i&j(Z!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k(^4r_$i&j(Z!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k&z5vX$i&jOr5qrs6cs!^5q!^!_6y!_#o5q#o#p6y#p;'S5q;'S;=`7h<%lO5q&z6jT$d`$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c`6|TOr6yrs7]s;'S6y;'S;=`7b<%lO6y`7bO$d``7eP;=`<%l6y&z7kP;=`<%l5q(^7w]$d`$i&j(Z!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!r8uZ(Z!bOY8pYZ6yZr8prs9hsw8pwx6yx#O8p#O#P6y#P;'S8p;'S;=`:R<%lO8p!r9oU$d`(Z!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!r:UP;=`<%l8p(^:[P;=`<%l4k%9[:hh$i&j(Wp(Z!bOY%ZYZ&cZq%Zqr<Srs&}st%ZtuCruw%Zwx(rx!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr(r<__WS$i&j(Wp(Z!bOY<SYZ&cZr<Srs=^sw<Swx@nx!^<S!^!_Bm!_#O<S#O#P>`#P#o<S#o#pBm#p;'S<S;'S;=`Cl<%lO<S(Q=g]WS$i&j(Z!bOY=^YZ&cZw=^wx>`x!^=^!^!_?q!_#O=^#O#P>`#P#o=^#o#p?q#p;'S=^;'S;=`@h<%lO=^&n>gXWS$i&jOY>`YZ&cZ!^>`!^!_?S!_#o>`#o#p?S#p;'S>`;'S;=`?k<%lO>`S?XSWSOY?SZ;'S?S;'S;=`?e<%lO?SS?hP;=`<%l?S&n?nP;=`<%l>`!f?xWWS(Z!bOY?qZw?qwx?Sx#O?q#O#P?S#P;'S?q;'S;=`@b<%lO?q!f@eP;=`<%l?q(Q@kP;=`<%l=^'`@w]WS$i&j(WpOY@nYZ&cZr@nrs>`s!^@n!^!_Ap!_#O@n#O#P>`#P#o@n#o#pAp#p;'S@n;'S;=`Bg<%lO@ntAwWWS(WpOYApZrAprs?Ss#OAp#O#P?S#P;'SAp;'S;=`Ba<%lOAptBdP;=`<%lAp'`BjP;=`<%l@n#WBvYWS(Wp(Z!bOYBmZrBmrs?qswBmwxApx#OBm#O#P?S#P;'SBm;'S;=`Cf<%lOBm#WCiP;=`<%lBm(rCoP;=`<%l<S%9[C}i$i&j(o%1l(Wp(Z!bOY%ZYZ&cZr%Zrs&}st%ZtuCruw%Zwx(rx!Q%Z!Q![Cr![!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr%9[EoP;=`<%lCr07[FRk$i&j(Wp(Z!b$]#t(T,2j(e$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr+dHRk$i&j(Wp(Z!b$]#tOY%ZYZ&cZr%Zrs&}st%ZtuGvuw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Gv![!^%Z!^!_*g!_!c%Z!c!}Gv!}#O%Z#O#P&c#P#R%Z#R#SGv#S#T%Z#T#oGv#o#p*g#p$g%Z$g;'SGv;'S;=`Iv<%lOGv+dIyP;=`<%lGv07[JPP;=`<%lEr(KWJ_`$i&j(Wp(Z!b#p(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWKl_$i&j$Q(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,#xLva(z+JY$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sv%ZvwM{wx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWNW`$i&j#z(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At! c_(Y';W$i&j(WpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b'l!!i_$i&j(WpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b&z!#mX$i&jOw!#hwx6cx!^!#h!^!_!$Y!_#o!#h#o#p!$Y#p;'S!#h;'S;=`!$r<%lO!#h`!$]TOw!$Ywx7]x;'S!$Y;'S;=`!$l<%lO!$Y`!$oP;=`<%l!$Y&z!$uP;=`<%l!#h'l!%R]$d`$i&j(WpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r!Q!&PZ(WpOY!%zYZ!$YZr!%zrs!$Ysw!%zwx!&rx#O!%z#O#P!$Y#P;'S!%z;'S;=`!']<%lO!%z!Q!&yU$d`(WpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)r!Q!'`P;=`<%l!%z'l!'fP;=`<%l!!b/5|!'t_!l/.^$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#&U!)O_!k!Lf$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z-!n!*[b$i&j(Wp(Z!b(U%&f#q(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rxz%Zz{!+d{!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW!+o`$i&j(Wp(Z!b#n(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;x!,|`$i&j(Wp(Z!br+4YOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,$U!.Z_!]+Jf$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!/ec$i&j(Wp(Z!b!Q.2^OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!0p!P!Q%Z!Q![!3Y![!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!0ya$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!2O!P!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!2Z_![!L^$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!3eg$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!3Y![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S!3Y#S#X%Z#X#Y!4|#Y#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!5Vg$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx{%Z{|!6n|}%Z}!O!6n!O!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!6wc$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!8_c$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!9uf$i&j(Wp(Z!b#o(ChOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcxz!;Zz{#-}{!P!;Z!P!Q#/d!Q!^!;Z!^!_#(i!_!`#7S!`!a#8i!a!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z?O!;fb$i&j(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z>^!<w`$i&j(Z!b!X7`OY!<nYZ&cZw!<nwx!=yx!P!<n!P!Q!Eq!Q!^!<n!^!_!Gr!_!}!<n!}#O!KS#O#P!Dy#P#o!<n#o#p!Gr#p;'S!<n;'S;=`!L]<%lO!<n<z!>Q^$i&j!X7`OY!=yYZ&cZ!P!=y!P!Q!>|!Q!^!=y!^!_!@c!_!}!=y!}#O!CW#O#P!Dy#P#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!?Td$i&j!X7`O!^&c!_#W&c#W#X!>|#X#Z&c#Z#[!>|#[#]&c#]#^!>|#^#a&c#a#b!>|#b#g&c#g#h!>|#h#i&c#i#j!>|#j#k!>|#k#m&c#m#n!>|#n#o&c#p;'S&c;'S;=`&w<%lO&c7`!@hX!X7`OY!@cZ!P!@c!P!Q!AT!Q!}!@c!}#O!Ar#O#P!Bq#P;'S!@c;'S;=`!CQ<%lO!@c7`!AYW!X7`#W#X!AT#Z#[!AT#]#^!AT#a#b!AT#g#h!AT#i#j!AT#j#k!AT#m#n!AT7`!AuVOY!ArZ#O!Ar#O#P!B[#P#Q!@c#Q;'S!Ar;'S;=`!Bk<%lO!Ar7`!B_SOY!ArZ;'S!Ar;'S;=`!Bk<%lO!Ar7`!BnP;=`<%l!Ar7`!BtSOY!@cZ;'S!@c;'S;=`!CQ<%lO!@c7`!CTP;=`<%l!@c<z!C][$i&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#O!CW#O#P!DR#P#Q!=y#Q#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DWX$i&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DvP;=`<%l!CW<z!EOX$i&jOY!=yYZ&cZ!^!=y!^!_!@c!_#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!EnP;=`<%l!=y>^!Ezl$i&j(Z!b!X7`OY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#W&}#W#X!Eq#X#Z&}#Z#[!Eq#[#]&}#]#^!Eq#^#a&}#a#b!Eq#b#g&}#g#h!Eq#h#i&}#i#j!Eq#j#k!Eq#k#m&}#m#n!Eq#n#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}8r!GyZ(Z!b!X7`OY!GrZw!Grwx!@cx!P!Gr!P!Q!Hl!Q!}!Gr!}#O!JU#O#P!Bq#P;'S!Gr;'S;=`!J|<%lO!Gr8r!Hse(Z!b!X7`OY'}Zw'}x#O'}#P#W'}#W#X!Hl#X#Z'}#Z#[!Hl#[#]'}#]#^!Hl#^#a'}#a#b!Hl#b#g'}#g#h!Hl#h#i'}#i#j!Hl#j#k!Hl#k#m'}#m#n!Hl#n;'S'};'S;=`(f<%lO'}8r!JZX(Z!bOY!JUZw!JUwx!Arx#O!JU#O#P!B[#P#Q!Gr#Q;'S!JU;'S;=`!Jv<%lO!JU8r!JyP;=`<%l!JU8r!KPP;=`<%l!Gr>^!KZ^$i&j(Z!bOY!KSYZ&cZw!KSwx!CWx!^!KS!^!_!JU!_#O!KS#O#P!DR#P#Q!<n#Q#o!KS#o#p!JU#p;'S!KS;'S;=`!LV<%lO!KS>^!LYP;=`<%l!KS>^!L`P;=`<%l!<n=l!Ll`$i&j(Wp!X7`OY!LcYZ&cZr!Lcrs!=ys!P!Lc!P!Q!Mn!Q!^!Lc!^!_# o!_!}!Lc!}#O#%P#O#P!Dy#P#o!Lc#o#p# o#p;'S!Lc;'S;=`#&Y<%lO!Lc=l!Mwl$i&j(Wp!X7`OY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#W(r#W#X!Mn#X#Z(r#Z#[!Mn#[#](r#]#^!Mn#^#a(r#a#b!Mn#b#g(r#g#h!Mn#h#i(r#i#j!Mn#j#k!Mn#k#m(r#m#n!Mn#n#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r8Q# vZ(Wp!X7`OY# oZr# ors!@cs!P# o!P!Q#!i!Q!}# o!}#O#$R#O#P!Bq#P;'S# o;'S;=`#$y<%lO# o8Q#!pe(Wp!X7`OY)rZr)rs#O)r#P#W)r#W#X#!i#X#Z)r#Z#[#!i#[#])r#]#^#!i#^#a)r#a#b#!i#b#g)r#g#h#!i#h#i)r#i#j#!i#j#k#!i#k#m)r#m#n#!i#n;'S)r;'S;=`*Z<%lO)r8Q#$WX(WpOY#$RZr#$Rrs!Ars#O#$R#O#P!B[#P#Q# o#Q;'S#$R;'S;=`#$s<%lO#$R8Q#$vP;=`<%l#$R8Q#$|P;=`<%l# o=l#%W^$i&j(WpOY#%PYZ&cZr#%Prs!CWs!^#%P!^!_#$R!_#O#%P#O#P!DR#P#Q!Lc#Q#o#%P#o#p#$R#p;'S#%P;'S;=`#&S<%lO#%P=l#&VP;=`<%l#%P=l#&]P;=`<%l!Lc?O#&kn$i&j(Wp(Z!b!X7`OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#W%Z#W#X#&`#X#Z%Z#Z#[#&`#[#]%Z#]#^#&`#^#a%Z#a#b#&`#b#g%Z#g#h#&`#h#i%Z#i#j#&`#j#k#&`#k#m%Z#m#n#&`#n#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z9d#(r](Wp(Z!b!X7`OY#(iZr#(irs!Grsw#(iwx# ox!P#(i!P!Q#)k!Q!}#(i!}#O#+`#O#P!Bq#P;'S#(i;'S;=`#,`<%lO#(i9d#)th(Wp(Z!b!X7`OY*gZr*grs'}sw*gwx)rx#O*g#P#W*g#W#X#)k#X#Z*g#Z#[#)k#[#]*g#]#^#)k#^#a*g#a#b#)k#b#g*g#g#h#)k#h#i*g#i#j#)k#j#k#)k#k#m*g#m#n#)k#n;'S*g;'S;=`+Z<%lO*g9d#+gZ(Wp(Z!bOY#+`Zr#+`rs!JUsw#+`wx#$Rx#O#+`#O#P!B[#P#Q#(i#Q;'S#+`;'S;=`#,Y<%lO#+`9d#,]P;=`<%l#+`9d#,cP;=`<%l#(i?O#,o`$i&j(Wp(Z!bOY#,fYZ&cZr#,frs!KSsw#,fwx#%Px!^#,f!^!_#+`!_#O#,f#O#P!DR#P#Q!;Z#Q#o#,f#o#p#+`#p;'S#,f;'S;=`#-q<%lO#,f?O#-tP;=`<%l#,f?O#-zP;=`<%l!;Z07[#.[b$i&j(Wp(Z!b(O0/l!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z07[#/o_$i&j(Wp(Z!bT0/lOY#/dYZ&cZr#/drs#0nsw#/dwx#4Ox!^#/d!^!_#5}!_#O#/d#O#P#1p#P#o#/d#o#p#5}#p;'S#/d;'S;=`#6|<%lO#/d06j#0w]$i&j(Z!bT0/lOY#0nYZ&cZw#0nwx#1px!^#0n!^!_#3R!_#O#0n#O#P#1p#P#o#0n#o#p#3R#p;'S#0n;'S;=`#3x<%lO#0n05W#1wX$i&jT0/lOY#1pYZ&cZ!^#1p!^!_#2d!_#o#1p#o#p#2d#p;'S#1p;'S;=`#2{<%lO#1p0/l#2iST0/lOY#2dZ;'S#2d;'S;=`#2u<%lO#2d0/l#2xP;=`<%l#2d05W#3OP;=`<%l#1p01O#3YW(Z!bT0/lOY#3RZw#3Rwx#2dx#O#3R#O#P#2d#P;'S#3R;'S;=`#3r<%lO#3R01O#3uP;=`<%l#3R06j#3{P;=`<%l#0n05x#4X]$i&j(WpT0/lOY#4OYZ&cZr#4Ors#1ps!^#4O!^!_#5Q!_#O#4O#O#P#1p#P#o#4O#o#p#5Q#p;'S#4O;'S;=`#5w<%lO#4O00^#5XW(WpT0/lOY#5QZr#5Qrs#2ds#O#5Q#O#P#2d#P;'S#5Q;'S;=`#5q<%lO#5Q00^#5tP;=`<%l#5Q05x#5zP;=`<%l#4O01p#6WY(Wp(Z!bT0/lOY#5}Zr#5}rs#3Rsw#5}wx#5Qx#O#5}#O#P#2d#P;'S#5};'S;=`#6v<%lO#5}01p#6yP;=`<%l#5}07[#7PP;=`<%l#/d)3h#7ab$i&j$Q(Ch(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;ZAt#8vb$Z#t$i&j(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z'Ad#:Zp$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#U%Z#U#V#?i#V#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#d#Bq#d#l%Z#l#m#Es#m#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#<jk$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#>j_$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#?rd$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#A]f$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Bzc$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Dbe$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#E|g$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Gpi$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x#Il_!g$b$i&j$O)Lv(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)[#Jv_al$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f#LS^h#)`#R-<U(Wp(Z!b$n7`OY*gZr*grs'}sw*gwx)rx!P*g!P!Q#MO!Q!^*g!^!_#Mt!_!`$ f!`#O*g#P;'S*g;'S;=`+Z<%lO*g(n#MXX$k&j(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El#M}Z#r(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx!_*g!_!`#Np!`#O*g#P;'S*g;'S;=`+Z<%lO*g(El#NyX$Q(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El$ oX#s(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g*)x$!ga#`*!Y$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`!a$#l!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(K[$#w_#k(Cl$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x$%Vag!*r#s(Ch$f#|$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`$&[!`!a$'f!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$&g_#s(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$'qa#r(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`!a$(v!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$)R`#r(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(Kd$*`a(r(Ct$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!a%Z!a!b$+e!b#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$+p`$i&j#{(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#`$,}_!|$Ip$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f$.X_!S0,v$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(n$/]Z$i&jO!^$0O!^!_$0f!_#i$0O#i#j$0k#j#l$0O#l#m$2^#m#o$0O#o#p$0f#p;'S$0O;'S;=`$4i<%lO$0O(n$0VT_#S$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c#S$0kO_#S(n$0p[$i&jO!Q&c!Q![$1f![!^&c!_!c&c!c!i$1f!i#T&c#T#Z$1f#Z#o&c#o#p$3|#p;'S&c;'S;=`&w<%lO&c(n$1kZ$i&jO!Q&c!Q![$2^![!^&c!_!c&c!c!i$2^!i#T&c#T#Z$2^#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$2cZ$i&jO!Q&c!Q![$3U![!^&c!_!c&c!c!i$3U!i#T&c#T#Z$3U#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$3ZZ$i&jO!Q&c!Q![$0O![!^&c!_!c&c!c!i$0O!i#T&c#T#Z$0O#Z#o&c#p;'S&c;'S;=`&w<%lO&c#S$4PR!Q![$4Y!c!i$4Y#T#Z$4Y#S$4]S!Q![$4Y!c!i$4Y#T#Z$4Y#q#r$0f(n$4lP;=`<%l$0O#1[$4z_!Y#)l$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$6U`#x(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;p$7c_$i&j(Wp(Z!b(a+4QOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$8qk$i&j(Wp(Z!b(T,2j$_#t(e$I[OY%ZYZ&cZr%Zrs&}st%Ztu$8buw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$8b![!^%Z!^!_*g!_!c%Z!c!}$8b!}#O%Z#O#P&c#P#R%Z#R#S$8b#S#T%Z#T#o$8b#o#p*g#p$g%Z$g;'S$8b;'S;=`$<l<%lO$8b+d$:qk$i&j(Wp(Z!b$_#tOY%ZYZ&cZr%Zrs&}st%Ztu$:fuw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$:f![!^%Z!^!_*g!_!c%Z!c!}$:f!}#O%Z#O#P&c#P#R%Z#R#S$:f#S#T%Z#T#o$:f#o#p*g#p$g%Z$g;'S$:f;'S;=`$<f<%lO$:f+d$<iP;=`<%l$:f07[$<oP;=`<%l$8b#Jf$<{X!_#Hb(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g,#x$=sa(y+JY$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p#q$+e#q;'S%Z;'S;=`+a<%lO%Z)>v$?V_!^(CdvBr$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z?O$@a_!q7`$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$Aq|$i&j(Wp(Z!b'|0/l$]#t(T,2j(e$I[OX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr07[$D|k$i&j(Wp(Z!b'}0/l$]#t(T,2j(e$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr",tokenizers:[hde,fde,pde,gde,2,3,4,5,6,7,8,9,10,11,12,13,14,dde,new u0("$S~RRtu[#O#Pg#S#T#|~_P#o#pb~gOx~~jVO#i!P#i#j!U#j#l!P#l#m!q#m;'S!P;'S;=`#v<%lO!P~!UO!U~~!XS!Q![!e!c!i!e#T#Z!e#o#p#Z~!hR!Q![!q!c!i!q#T#Z!q~!tR!Q![!}!c!i!}#T#Z!}~#QR!Q![!P!c!i!P#T#Z!P~#^R!Q![#g!c!i#g#T#Z#g~#jS!Q![#g!c!i#g#T#Z#g#q#r!P~#yP;=`<%l!P~$RO(c~~",141,340),new u0("j~RQYZXz{^~^O(Q~~aP!P!Qd~iO(R~~",25,323)],topRules:{Script:[0,7],SingleExpression:[1,276],SingleClassItem:[2,277]},dialects:{jsx:0,ts:15175},dynamicPrecedences:{80:1,82:1,94:1,169:1,199:1},specialized:[{term:327,get:n=>vde[n]||-1},{term:343,get:n=>yde[n]||-1},{term:95,get:n=>bde[n]||-1}],tokenPrec:15201}),Oz=[Gi("function ${name}(${params}) {\n	${}\n}",{label:"function",detail:"definition",type:"keyword"}),Gi("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n	${}\n}",{label:"for",detail:"loop",type:"keyword"}),Gi("for (let ${name} of ${collection}) {\n	${}\n}",{label:"for",detail:"of loop",type:"keyword"}),Gi("do {\n	${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),Gi("while (${}) {\n	${}\n}",{label:"while",detail:"loop",type:"keyword"}),Gi(`try {
	\${}
} catch (\${error}) {
	\${}
}`,{label:"try",detail:"/ catch block",type:"keyword"}),Gi("if (${}) {\n	${}\n}",{label:"if",detail:"block",type:"keyword"}),Gi(`if (\${}) {
	\${}
} else {
	\${}
}`,{label:"if",detail:"/ else block",type:"keyword"}),Gi(`class \${name} {
	constructor(\${params}) {
		\${}
	}
}`,{label:"class",detail:"definition",type:"keyword"}),Gi('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),Gi('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],_de=Oz.concat([Gi("interface ${name} {\n	${}\n}",{label:"interface",detail:"definition",type:"keyword"}),Gi("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),Gi("enum ${name} {\n	${}\n}",{label:"enum",detail:"definition",type:"keyword"})]),QI=new E6,xz=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function Rf(n){return(e,t)=>{let r=e.node.getChild("VariableDefinition");return r&&t(r,n),!0}}const Ode=["FunctionDeclaration"],xde={FunctionDeclaration:Rf("function"),ClassDeclaration:Rf("class"),ClassExpression:()=>!0,EnumDeclaration:Rf("constant"),TypeAliasDeclaration:Rf("type"),NamespaceDeclaration:Rf("namespace"),VariableDefinition(n,e){n.matchContext(Ode)||e(n,"variable")},TypeDefinition(n,e){e(n,"type")},__proto__:null};function kz(n,e){let t=QI.get(e);if(t)return t;let r=[],i=!0;function s(o,a){let l=n.sliceString(o.from,o.to);r.push({label:l,type:a})}return e.cursor(tr.IncludeAnonymous).iterate(o=>{if(i)i=!1;else if(o.name){let a=xde[o.name];if(a&&a(o,s)||xz.has(o.name))return!1}else if(o.to-o.from>8192){for(let a of kz(n,o.node))r.push(a);return!1}}),QI.set(e,r),r}const $I=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/,Sz=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName","JSXText","JSXAttributeValue","JSXOpenTag","JSXCloseTag","JSXSelfClosingTag",".","?."];function kde(n){let e=dr(n.state).resolveInner(n.pos,-1);if(Sz.indexOf(e.name)>-1)return null;let t=e.name=="VariableName"||e.to-e.from<20&&$I.test(n.state.sliceDoc(e.from,e.to));if(!t&&!n.explicit)return null;let r=[];for(let i=e;i;i=i.parent)xz.has(i.name)&&(r=r.concat(kz(n.state.doc,i)));return{options:r,from:t?e.from:n.pos,validFor:$I}}const Da=Lh.define({name:"javascript",parser:wde.configure({props:[dm.add({IfStatement:Kv({except:/^\s*({|else\b)/}),TryStatement:Kv({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:ooe,SwitchBody:n=>{let e=n.textAfter,t=/^\s*\}/.test(e),r=/^\s*(case|default)\b/.test(e);return n.baseIndent+(t?0:r?1:2)*n.unit},Block:soe({closing:"}"}),ArrowFunction:n=>n.baseIndent+n.unit,"TemplateString BlockComment":()=>null,"Statement Property":Kv({except:/^\s*{/}),JSXElement(n){let e=/^\s*<\//.test(n.textAfter);return n.lineIndent(n.node.from)+(e?0:n.unit)},JSXEscape(n){let e=/\s*\}/.test(n.textAfter);return n.lineIndent(n.node.from)+(e?0:n.unit)},"JSXOpenTag JSXSelfClosingTag"(n){return n.column(n.node.from)+n.unit}}),hm.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":L6,BlockComment(n){return{from:n.from+2,to:n.to-2}}})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),Tz={test:n=>/^JSX/.test(n.name),facet:v2({commentTokens:{block:{open:"{/*",close:"*/}"}}})},Az=Da.configure({dialect:"ts"},"typescript"),Cz=Da.configure({dialect:"jsx",props:[y2.add(n=>n.isTop?[Tz]:void 0)]}),Ez=Da.configure({dialect:"jsx ts",props:[y2.add(n=>n.isTop?[Tz]:void 0)]},"typescript");let Pz=n=>({label:n,type:"keyword"});const Iz="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(Pz),Sde=Iz.concat(["declare","implements","private","protected","public"].map(Pz));function Tde(n={}){let e=n.jsx?n.typescript?Ez:Cz:n.typescript?Az:Da,t=n.typescript?_de.concat(Sde):Oz.concat(Iz);return new fg(e,[Da.data.of({autocomplete:sle(Sz,EF(t))}),Da.data.of({autocomplete:kde}),n.jsx?Ede:[]])}function Ade(n){for(;;){if(n.name=="JSXOpenTag"||n.name=="JSXSelfClosingTag"||n.name=="JSXFragmentTag")return n;if(n.name=="JSXEscape"||!n.parent)return null;n=n.parent}}function FI(n,e,t=n.length){for(let r=e?.firstChild;r;r=r.nextSibling)if(r.name=="JSXIdentifier"||r.name=="JSXBuiltin"||r.name=="JSXNamespacedName"||r.name=="JSXMemberExpression")return n.sliceString(r.from,Math.min(r.to,t));return""}const Cde=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),Ede=gt.inputHandler.of((n,e,t,r,i)=>{if((Cde?n.composing:n.compositionStarted)||n.state.readOnly||e!=t||r!=">"&&r!="/"||!Da.isActiveAt(n.state,e,-1))return!1;let s=i(),{state:o}=s,a=o.changeByRange(l=>{var c;let{head:d}=l,h=dr(o).resolveInner(d-1,-1),f;if(h.name=="JSXStartTag"&&(h=h.parent),!(o.doc.sliceString(d-1,d)!=r||h.name=="JSXAttributeValue"&&h.to>d)){if(r==">"&&h.name=="JSXFragmentTag")return{range:l,changes:{from:d,insert:"</>"}};if(r=="/"&&h.name=="JSXStartCloseTag"){let p=h.parent,g=p.parent;if(g&&p.from==d-2&&((f=FI(o.doc,g.firstChild,d))||((c=g.firstChild)===null||c===void 0?void 0:c.name)=="JSXFragmentTag")){let m=`${f}>`;return{range:rt.cursor(d+m.length,-1),changes:{from:d,insert:m}}}}else if(r==">"){let p=Ade(h);if(p&&p.name=="JSXOpenTag"&&!/^\/?>|^<\//.test(o.doc.sliceString(d,d+2))&&(f=FI(o.doc,p,d)))return{range:l,changes:{from:d,insert:`</${f}>`}}}}return{range:l}});return a.changes.empty?!1:(n.dispatch([s,o.update(a,{userEvent:"input.complete",scrollIntoView:!0})]),!0)}),Df=["_blank","_self","_top","_parent"],A1=["ascii","utf-8","utf-16","latin1","latin1"],C1=["get","post","put","delete"],E1=["application/x-www-form-urlencoded","multipart/form-data","text/plain"],ys=["true","false"],Bt={},Pde={a:{attrs:{href:null,ping:null,type:null,media:null,target:Df,hreflang:null}},abbr:Bt,address:Bt,area:{attrs:{alt:null,coords:null,href:null,target:null,ping:null,media:null,hreflang:null,type:null,shape:["default","rect","circle","poly"]}},article:Bt,aside:Bt,audio:{attrs:{src:null,mediagroup:null,crossorigin:["anonymous","use-credentials"],preload:["none","metadata","auto"],autoplay:["autoplay"],loop:["loop"],controls:["controls"]}},b:Bt,base:{attrs:{href:null,target:Df}},bdi:Bt,bdo:Bt,blockquote:{attrs:{cite:null}},body:Bt,br:Bt,button:{attrs:{form:null,formaction:null,name:null,value:null,autofocus:["autofocus"],disabled:["autofocus"],formenctype:E1,formmethod:C1,formnovalidate:["novalidate"],formtarget:Df,type:["submit","reset","button"]}},canvas:{attrs:{width:null,height:null}},caption:Bt,center:Bt,cite:Bt,code:Bt,col:{attrs:{span:null}},colgroup:{attrs:{span:null}},command:{attrs:{type:["command","checkbox","radio"],label:null,icon:null,radiogroup:null,command:null,title:null,disabled:["disabled"],checked:["checked"]}},data:{attrs:{value:null}},datagrid:{attrs:{disabled:["disabled"],multiple:["multiple"]}},datalist:{attrs:{data:null}},dd:Bt,del:{attrs:{cite:null,datetime:null}},details:{attrs:{open:["open"]}},dfn:Bt,div:Bt,dl:Bt,dt:Bt,em:Bt,embed:{attrs:{src:null,type:null,width:null,height:null}},eventsource:{attrs:{src:null}},fieldset:{attrs:{disabled:["disabled"],form:null,name:null}},figcaption:Bt,figure:Bt,footer:Bt,form:{attrs:{action:null,name:null,"accept-charset":A1,autocomplete:["on","off"],enctype:E1,method:C1,novalidate:["novalidate"],target:Df}},h1:Bt,h2:Bt,h3:Bt,h4:Bt,h5:Bt,h6:Bt,head:{children:["title","base","link","style","meta","script","noscript","command"]},header:Bt,hgroup:Bt,hr:Bt,html:{attrs:{manifest:null}},i:Bt,iframe:{attrs:{src:null,srcdoc:null,name:null,width:null,height:null,sandbox:["allow-top-navigation","allow-same-origin","allow-forms","allow-scripts"],seamless:["seamless"]}},img:{attrs:{alt:null,src:null,ismap:null,usemap:null,width:null,height:null,crossorigin:["anonymous","use-credentials"]}},input:{attrs:{alt:null,dirname:null,form:null,formaction:null,height:null,list:null,max:null,maxlength:null,min:null,name:null,pattern:null,placeholder:null,size:null,src:null,step:null,value:null,width:null,accept:["audio/*","video/*","image/*"],autocomplete:["on","off"],autofocus:["autofocus"],checked:["checked"],disabled:["disabled"],formenctype:E1,formmethod:C1,formnovalidate:["novalidate"],formtarget:Df,multiple:["multiple"],readonly:["readonly"],required:["required"],type:["hidden","text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","number","range","color","checkbox","radio","file","submit","image","reset","button"]}},ins:{attrs:{cite:null,datetime:null}},kbd:Bt,keygen:{attrs:{challenge:null,form:null,name:null,autofocus:["autofocus"],disabled:["disabled"],keytype:["RSA"]}},label:{attrs:{for:null,form:null}},legend:Bt,li:{attrs:{value:null}},link:{attrs:{href:null,type:null,hreflang:null,media:null,sizes:["all","16x16","16x16 32x32","16x16 32x32 64x64"]}},map:{attrs:{name:null}},mark:Bt,menu:{attrs:{label:null,type:["list","context","toolbar"]}},meta:{attrs:{content:null,charset:A1,name:["viewport","application-name","author","description","generator","keywords"],"http-equiv":["content-language","content-type","default-style","refresh"]}},meter:{attrs:{value:null,min:null,low:null,high:null,max:null,optimum:null}},nav:Bt,noscript:Bt,object:{attrs:{data:null,type:null,name:null,usemap:null,form:null,width:null,height:null,typemustmatch:["typemustmatch"]}},ol:{attrs:{reversed:["reversed"],start:null,type:["1","a","A","i","I"]},children:["li","script","template","ul","ol"]},optgroup:{attrs:{disabled:["disabled"],label:null}},option:{attrs:{disabled:["disabled"],label:null,selected:["selected"],value:null}},output:{attrs:{for:null,form:null,name:null}},p:Bt,param:{attrs:{name:null,value:null}},pre:Bt,progress:{attrs:{value:null,max:null}},q:{attrs:{cite:null}},rp:Bt,rt:Bt,ruby:Bt,samp:Bt,script:{attrs:{type:["text/javascript"],src:null,async:["async"],defer:["defer"],charset:A1}},section:Bt,select:{attrs:{form:null,name:null,size:null,autofocus:["autofocus"],disabled:["disabled"],multiple:["multiple"]}},slot:{attrs:{name:null}},small:Bt,source:{attrs:{src:null,type:null,media:null}},span:Bt,strong:Bt,style:{attrs:{type:["text/css"],media:null,scoped:null}},sub:Bt,summary:Bt,sup:Bt,table:Bt,tbody:Bt,td:{attrs:{colspan:null,rowspan:null,headers:null}},template:Bt,textarea:{attrs:{dirname:null,form:null,maxlength:null,name:null,placeholder:null,rows:null,cols:null,autofocus:["autofocus"],disabled:["disabled"],readonly:["readonly"],required:["required"],wrap:["soft","hard"]}},tfoot:Bt,th:{attrs:{colspan:null,rowspan:null,headers:null,scope:["row","col","rowgroup","colgroup"]}},thead:Bt,time:{attrs:{datetime:null}},title:Bt,tr:Bt,track:{attrs:{src:null,label:null,default:null,kind:["subtitles","captions","descriptions","chapters","metadata"],srclang:null}},ul:{children:["li","script","template","ul","ol"]},var:Bt,video:{attrs:{src:null,poster:null,width:null,height:null,crossorigin:["anonymous","use-credentials"],preload:["auto","metadata","none"],autoplay:["autoplay"],mediagroup:["movie"],muted:["muted"],controls:["controls"]}},wbr:Bt},Mz={accesskey:null,class:null,contenteditable:ys,contextmenu:null,dir:["ltr","rtl","auto"],draggable:["true","false","auto"],dropzone:["copy","move","link","string:","file:"],hidden:["hidden"],id:null,inert:["inert"],itemid:null,itemprop:null,itemref:null,itemscope:["itemscope"],itemtype:null,lang:["ar","bn","de","en-GB","en-US","es","fr","hi","id","ja","pa","pt","ru","tr","zh"],spellcheck:ys,autocorrect:ys,autocapitalize:ys,style:null,tabindex:null,title:null,translate:["yes","no"],rel:["stylesheet","alternate","author","bookmark","help","license","next","nofollow","noreferrer","prefetch","prev","search","tag"],role:"alert application article banner button cell checkbox complementary contentinfo dialog document feed figure form grid gridcell heading img list listbox listitem main navigation region row rowgroup search switch tab table tabpanel textbox timer".split(" "),"aria-activedescendant":null,"aria-atomic":ys,"aria-autocomplete":["inline","list","both","none"],"aria-busy":ys,"aria-checked":["true","false","mixed","undefined"],"aria-controls":null,"aria-describedby":null,"aria-disabled":ys,"aria-dropeffect":null,"aria-expanded":["true","false","undefined"],"aria-flowto":null,"aria-grabbed":["true","false","undefined"],"aria-haspopup":ys,"aria-hidden":ys,"aria-invalid":["true","false","grammar","spelling"],"aria-label":null,"aria-labelledby":null,"aria-level":null,"aria-live":["off","polite","assertive"],"aria-multiline":ys,"aria-multiselectable":ys,"aria-owns":null,"aria-posinset":null,"aria-pressed":["true","false","mixed","undefined"],"aria-readonly":ys,"aria-relevant":null,"aria-required":ys,"aria-selected":["true","false","undefined"],"aria-setsize":null,"aria-sort":["ascending","descending","none","other"],"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null,"aria-valuetext":null},Rz="beforeunload copy cut dragstart dragover dragleave dragenter dragend drag paste focus blur change click load mousedown mouseenter mouseleave mouseup keydown keyup resize scroll unload".split(" ").map(n=>"on"+n);for(let n of Rz)Mz[n]=null;class Og{constructor(e,t){this.tags={...Pde,...e},this.globalAttrs={...Mz,...t},this.allTags=Object.keys(this.tags),this.globalAttrNames=Object.keys(this.globalAttrs)}}Og.default=new Og;function Bh(n,e,t=n.length){if(!e)return"";let r=e.firstChild,i=r&&r.getChild("TagName");return i?n.sliceString(i.from,Math.min(i.to,t)):""}function Uh(n,e=!1){for(;n;n=n.parent)if(n.name=="Element")if(e)e=!1;else return n;return null}function Dz(n,e,t){let r=t.tags[Bh(n,Uh(e))];return r?.children||t.allTags}function W2(n,e){let t=[];for(let r=Uh(e);r&&!r.type.isTop;r=Uh(r.parent)){let i=Bh(n,r);if(i&&r.lastChild.name=="CloseTag")break;i&&t.indexOf(i)<0&&(e.name=="EndTag"||e.from>=r.firstChild.to)&&t.push(i)}return t}const Nz=/^[:\-\.\w\u00b7-\uffff]*$/;function zI(n,e,t,r,i){let s=/\s*>/.test(n.sliceDoc(i,i+5))?"":">",o=Uh(t,t.name=="StartTag"||t.name=="TagName");return{from:r,to:i,options:Dz(n.doc,o,e).map(a=>({label:a,type:"type"})).concat(W2(n.doc,t).map((a,l)=>({label:"/"+a,apply:"/"+a+s,type:"type",boost:99-l}))),validFor:/^\/?[:\-\.\w\u00b7-\uffff]*$/}}function BI(n,e,t,r){let i=/\s*>/.test(n.sliceDoc(r,r+5))?"":">";return{from:t,to:r,options:W2(n.doc,e).map((s,o)=>({label:s,apply:s+i,type:"type",boost:99-o})),validFor:Nz}}function Ide(n,e,t,r){let i=[],s=0;for(let o of Dz(n.doc,t,e))i.push({label:"<"+o,type:"type"});for(let o of W2(n.doc,t))i.push({label:"</"+o+">",type:"type",boost:99-s++});return{from:r,to:r,options:i,validFor:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}function Mde(n,e,t,r,i){let s=Uh(t),o=s?e.tags[Bh(n.doc,s)]:null,a=o&&o.attrs?Object.keys(o.attrs):[],l=o&&o.globalAttrs===!1?a:a.length?a.concat(e.globalAttrNames):e.globalAttrNames;return{from:r,to:i,options:l.map(c=>({label:c,type:"property"})),validFor:Nz}}function Rde(n,e,t,r,i){var s;let o=(s=t.parent)===null||s===void 0?void 0:s.getChild("AttributeName"),a=[],l;if(o){let c=n.sliceDoc(o.from,o.to),d=e.globalAttrs[c];if(!d){let h=Uh(t),f=h?e.tags[Bh(n.doc,h)]:null;d=f?.attrs&&f.attrs[c]}if(d){let h=n.sliceDoc(r,i).toLowerCase(),f='"',p='"';/^['"]/.test(h)?(l=h[0]=='"'?/^[^"]*$/:/^[^']*$/,f="",p=n.sliceDoc(i,i+1)==h[0]?"":h[0],h=h.slice(1),r++):l=/^[^\s<>='"]*$/;for(let g of d)a.push({label:g,apply:f+g+p,type:"constant"})}}return{from:r,to:i,options:a,validFor:l}}function Lz(n,e){let{state:t,pos:r}=e,i=dr(t).resolveInner(r,-1),s=i.resolve(r);for(let o=r,a;s==i&&(a=i.childBefore(o));){let l=a.lastChild;if(!l||!l.type.isError||l.from<l.to)break;s=i=a,o=l.from}return i.name=="TagName"?i.parent&&/CloseTag$/.test(i.parent.name)?BI(t,i,i.from,r):zI(t,n,i,i.from,r):i.name=="StartTag"||i.name=="IncompleteTag"?zI(t,n,i,r,r):i.name=="StartCloseTag"||i.name=="IncompleteCloseTag"?BI(t,i,r,r):i.name=="OpenTag"||i.name=="SelfClosingTag"||i.name=="AttributeName"?Mde(t,n,i,i.name=="AttributeName"?i.from:r,r):i.name=="Is"||i.name=="AttributeValue"||i.name=="UnquotedAttributeValue"?Rde(t,n,i,i.name=="Is"?r:i.from,r):e.explicit&&(s.name=="Element"||s.name=="Text"||s.name=="Document")?Ide(t,n,i,r):null}function Dde(n){return Lz(Og.default,n)}function Nde(n){let{extraTags:e,extraGlobalAttributes:t}=n,r=t||e?new Og(e,t):Og.default;return i=>Lz(r,i)}const Lde=Da.parser.configure({top:"SingleExpression"}),Qz=[{tag:"script",attrs:n=>n.type=="text/typescript"||n.lang=="ts",parser:Az.parser},{tag:"script",attrs:n=>n.type=="text/babel"||n.type=="text/jsx",parser:Cz.parser},{tag:"script",attrs:n=>n.type=="text/typescript-jsx",parser:Ez.parser},{tag:"script",attrs(n){return/^(importmap|speculationrules|application\/(.+\+)?json)$/i.test(n.type)},parser:Lde},{tag:"script",attrs(n){return!n.type||/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i.test(n.type)},parser:Da.parser},{tag:"style",attrs(n){return(!n.lang||n.lang=="css")&&(!n.type||/^(text\/)?(x-)?(stylesheet|css)$/i.test(n.type))},parser:h0.parser}],$z=[{name:"style",parser:h0.parser.configure({top:"Styles"})}].concat(Rz.map(n=>({name:n,parser:Da.parser}))),Fz=Lh.define({name:"html",parser:aue.configure({props:[dm.add({Element(n){let e=/^(\s*)(<\/)?/.exec(n.textAfter);return n.node.to<=n.pos+e[0].length?n.continue():n.lineIndent(n.node.from)+(e[2]?0:n.unit)},"OpenTag CloseTag SelfClosingTag"(n){return n.column(n.node.from)+n.unit},Document(n){if(n.pos+/\s*/.exec(n.textAfter)[0].length<n.node.to)return n.continue();let e=null,t;for(let r=n.node;;){let i=r.lastChild;if(!i||i.name!="Element"||i.to!=r.to)break;e=r=i}return e&&!((t=e.lastChild)&&(t.name=="CloseTag"||t.name=="SelfClosingTag"))?n.lineIndent(e.from)+n.unit:null}}),hm.add({Element(n){let e=n.firstChild,t=n.lastChild;return!e||e.name!="OpenTag"?null:{from:e.to,to:t.name=="CloseTag"?t.from:n.to}}}),$6.add({"OpenTag CloseTag":n=>n.getChild("TagName")})]}),languageData:{commentTokens:{block:{open:"<!--",close:"-->"}},indentOnInput:/^\s*<\/\w+\W$/,wordChars:"-_"}}),ty=Fz.configure({wrap:gz(Qz,$z)});function Qde(n={}){let e="",t;n.matchClosingTags===!1&&(e="noMatch"),n.selfClosingTags===!0&&(e=(e?e+" ":"")+"selfClosing"),(n.nestedLanguages&&n.nestedLanguages.length||n.nestedAttributes&&n.nestedAttributes.length)&&(t=gz((n.nestedLanguages||[]).concat(Qz),(n.nestedAttributes||[]).concat($z)));let r=t?Fz.configure({wrap:t,dialect:e}):e?ty.configure({dialect:e}):ty;return new fg(r,[ty.data.of({autocomplete:Nde(n)}),n.autoCloseTags!==!1?$de:[],Tde().support,jue().support])}const UI=new Set("area base br col command embed frame hr img input keygen link meta param source track wbr menuitem".split(" ")),$de=gt.inputHandler.of((n,e,t,r,i)=>{if(n.composing||n.state.readOnly||e!=t||r!=">"&&r!="/"||!ty.isActiveAt(n.state,e,-1))return!1;let s=i(),{state:o}=s,a=o.changeByRange(l=>{var c,d,h;let f=o.doc.sliceString(l.from-1,l.to)==r,{head:p}=l,g=dr(o).resolveInner(p,-1),m;if(f&&r==">"&&g.name=="EndTag"){let v=g.parent;if(((d=(c=v.parent)===null||c===void 0?void 0:c.lastChild)===null||d===void 0?void 0:d.name)!="CloseTag"&&(m=Bh(o.doc,v.parent,p))&&!UI.has(m)){let y=p+(o.doc.sliceString(p,p+1)===">"?1:0),O=`</${m}>`;return{range:l,changes:{from:p,to:y,insert:O}}}}else if(f&&r=="/"&&g.name=="IncompleteCloseTag"){let v=g.parent;if(g.from==p-2&&((h=v.lastChild)===null||h===void 0?void 0:h.name)!="CloseTag"&&(m=Bh(o.doc,v,p))&&!UI.has(m)){let y=p+(o.doc.sliceString(p,p+1)===">"?1:0),O=`${m}>`;return{range:rt.cursor(p+O.length,-1),changes:{from:p,to:y,insert:O}}}}return{range:l}});return a.changes.empty?!1:(n.dispatch([s,o.update(a,{userEvent:"input.complete",scrollIntoView:!0})]),!0)}),zz=v2({commentTokens:{block:{open:"<!--",close:"-->"}}}),Bz=new tn,Uz=tce.configure({props:[hm.add(n=>!n.is("Block")||n.is("Document")||Bx(n)!=null||Fde(n)?void 0:(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to})),Bz.add(Bx),dm.add({Document:()=>null}),au.add({Document:zz})]});function Bx(n){let e=/^(?:ATX|Setext)Heading(\d)$/.exec(n.name);return e?+e[1]:void 0}function Fde(n){return n.name=="OrderedList"||n.name=="BulletList"}function zde(n,e){let t=n;for(;;){let r=t.nextSibling,i;if(!r||(i=Bx(r.type))!=null&&i<=e)break;t=r}return t.to}const Bde=coe.of((n,e,t)=>{for(let r=dr(n).resolveInner(t,-1);r&&!(r.from<e);r=r.parent){let i=r.type.prop(Bz);if(i==null)continue;let s=zde(r,i);if(s>t)return{from:t,to:s}}return null});function X2(n){return new uo(zz,n,[],"markdown")}const Ude=X2(Uz),jde=Uz.configure([hce,pce,fce,gce,{props:[hm.add({Table:(n,e)=>({from:e.doc.lineAt(n.from).to,to:n.to})})]}]),f0=X2(jde);function Vde(n,e){return t=>{if(t&&n){let r=null;if(t=/\S*/.exec(t)[0],typeof n=="function"?r=n(t):r=Yy.matchLanguageName(n,t,!0),r instanceof Yy)return r.support?r.support.language.parser:hg.getSkippingParser(r.load());if(r)return r.parser}return e?e.parser:null}}class P1{constructor(e,t,r,i,s,o,a){this.node=e,this.from=t,this.to=r,this.spaceBefore=i,this.spaceAfter=s,this.type=o,this.item=a}blank(e,t=!0){let r=this.spaceBefore+(this.node.name=="Blockquote"?">":"");if(e!=null){for(;r.length<e;)r+=" ";return r}else{for(let i=this.to-this.from-r.length-this.spaceAfter.length;i>0;i--)r+=" ";return r+(t?this.spaceAfter:"")}}marker(e,t){let r=this.node.name=="OrderedList"?String(+Vz(this.item,e)[2]+t):"";return this.spaceBefore+r+this.type+this.spaceAfter}}function jz(n,e){let t=[],r=[];for(let i=n;i;i=i.parent){if(i.name=="FencedCode")return r;(i.name=="ListItem"||i.name=="Blockquote")&&t.push(i)}for(let i=t.length-1;i>=0;i--){let s=t[i],o,a=e.lineAt(s.from),l=s.from-a.from;if(s.name=="Blockquote"&&(o=/^ *>( ?)/.exec(a.text.slice(l))))r.push(new P1(s,l,l+o[0].length,"",o[1],">",null));else if(s.name=="ListItem"&&s.parent.name=="OrderedList"&&(o=/^( *)\d+([.)])( *)/.exec(a.text.slice(l)))){let c=o[3],d=o[0].length;c.length>=4&&(c=c.slice(0,c.length-4),d-=4),r.push(new P1(s.parent,l,l+d,o[1],c,o[2],s))}else if(s.name=="ListItem"&&s.parent.name=="BulletList"&&(o=/^( *)([-+*])( {1,4}\[[ xX]\])?( +)/.exec(a.text.slice(l)))){let c=o[4],d=o[0].length;c.length>4&&(c=c.slice(0,c.length-4),d-=4);let h=o[2];o[3]&&(h+=o[3].replace(/[xX]/," ")),r.push(new P1(s.parent,l,l+d,o[1],c,h,s))}}return r}function Vz(n,e){return/^(\s*)(\d+)(?=[.)])/.exec(e.sliceString(n.from,n.from+10))}function I1(n,e,t,r=0){for(let i=-1,s=n;;){if(s.name=="ListItem"){let a=Vz(s,e),l=+a[2];if(i>=0){if(l!=i+1)return;t.push({from:s.from+a[1].length,to:s.from+a[0].length,insert:String(i+2+r)})}i=l}let o=s.nextSibling;if(!o)break;s=o}}function Y2(n,e){let t=/^[ \t]*/.exec(n)[0].length;if(!t||e.facet(um)!="	")return n;let r=Ba(n,4,t),i="";for(let s=r;s>0;)s>=4?(i+="	",s-=4):(i+=" ",s--);return i+n.slice(t)}const qde=(n={})=>({state:e,dispatch:t})=>{let r=dr(e),{doc:i}=e,s=null,o=e.changeByRange(a=>{if(!a.empty||!f0.isActiveAt(e,a.from,-1)&&!f0.isActiveAt(e,a.from,1))return s={range:a};let l=a.from,c=i.lineAt(l),d=jz(r.resolveInner(l,-1),i);for(;d.length&&d[d.length-1].from>l-c.from;)d.pop();if(!d.length)return s={range:a};let h=d[d.length-1];if(h.to-h.spaceAfter.length>l-c.from)return s={range:a};let f=l>=h.to-h.spaceAfter.length&&!/\S/.test(c.text.slice(h.to));if(h.item&&f){let y=h.node.firstChild,O=h.node.getChild("ListItem","ListItem");if(y.to>=l||O&&O.to<l||c.from>0&&!/[^\s>]/.test(i.lineAt(c.from-1).text)||n.nonTightLists===!1){let _=d.length>1?d[d.length-2]:null,x,k="";_&&_.item?(x=c.from+_.from,k=_.marker(i,1)):x=c.from+(_?_.to:0);let S=[{from:x,to:l,insert:k}];return h.node.name=="OrderedList"&&I1(h.item,i,S,-2),_&&_.node.name=="OrderedList"&&I1(_.item,i,S),{range:rt.cursor(x+k.length),changes:S}}else{let _=VI(d,e,c);return{range:rt.cursor(l+_.length+1),changes:{from:c.from,insert:_+e.lineBreak}}}}if(h.node.name=="Blockquote"&&f&&c.from){let y=i.lineAt(c.from-1),O=/>\s*$/.exec(y.text);if(O&&O.index==h.from){let _=e.changes([{from:y.from+O.index,to:y.to},{from:c.from+h.from,to:c.to}]);return{range:a.map(_),changes:_}}}let p=[];h.node.name=="OrderedList"&&I1(h.item,i,p);let g=h.item&&h.item.from<c.from,m="";if(!g||/^[\s\d.)\-+*>]*/.exec(c.text)[0].length>=h.to)for(let y=0,O=d.length-1;y<=O;y++)m+=y==O&&!g?d[y].marker(i,1):d[y].blank(y<O?Ba(c.text,4,d[y+1].from)-m.length:null);let v=l;for(;v>c.from&&/\s/.test(c.text.charAt(v-c.from-1));)v--;return m=Y2(m,e),Zde(h.node,e.doc)&&(m=VI(d,e,c)+e.lineBreak+m),p.push({from:v,to:l,insert:e.lineBreak+m}),{range:rt.cursor(v+m.length+1),changes:p}});return s?!1:(t(e.update(o,{scrollIntoView:!0,userEvent:"input"})),!0)},Hde=qde();function jI(n){return n.name=="QuoteMark"||n.name=="ListMark"}function Zde(n,e){if(n.name!="OrderedList"&&n.name!="BulletList")return!1;let t=n.firstChild,r=n.getChild("ListItem","ListItem");if(!r)return!1;let i=e.lineAt(t.to),s=e.lineAt(r.from),o=/^[\s>]*$/.test(i.text);return i.number+(o?0:1)<s.number}function VI(n,e,t){let r="";for(let i=0,s=n.length-2;i<=s;i++)r+=n[i].blank(i<s?Ba(t.text,4,n[i+1].from)-r.length:null,i<s);return Y2(r,e)}function Wde(n,e){let t=n.resolveInner(e,-1),r=e;jI(t)&&(r=t.from,t=t.parent);for(let i;i=t.childBefore(r);)if(jI(i))r=i.from;else if(i.name=="OrderedList"||i.name=="BulletList")t=i.lastChild,r=t.to;else break;return t}const Xde=({state:n,dispatch:e})=>{let t=dr(n),r=null,i=n.changeByRange(s=>{let o=s.from,{doc:a}=n;if(s.empty&&f0.isActiveAt(n,s.from)){let l=a.lineAt(o),c=jz(Wde(t,o),a);if(c.length){let d=c[c.length-1],h=d.to-d.spaceAfter.length+(d.spaceAfter?1:0);if(o-l.from>h&&!/\S/.test(l.text.slice(h,o-l.from)))return{range:rt.cursor(l.from+h),changes:{from:l.from+h,to:o}};if(o-l.from==h&&(!d.item||l.from<=d.item.from||!/\S/.test(l.text.slice(0,d.to)))){let f=l.from+d.from;if(d.item&&d.node.from<d.item.from&&/\S/.test(l.text.slice(d.from,d.to))){let p=d.blank(Ba(l.text,4,d.to)-Ba(l.text,4,d.from));return f==l.from&&(p=Y2(p,n)),{range:rt.cursor(f+p.length),changes:{from:f,to:l.from+d.to,insert:p}}}if(f<o)return{range:rt.cursor(f),changes:{from:f,to:o}}}}}return r={range:s}});return r?!1:(e(n.update(i,{scrollIntoView:!0,userEvent:"delete"})),!0)},Yde=[{key:"Enter",run:Hde},{key:"Backspace",run:Xde}],qz=Qde({matchClosingTags:!1});function Hz(n={}){let{codeLanguages:e,defaultCodeLanguage:t,addKeymap:r=!0,base:{parser:i}=Ude,completeHTMLTags:s=!0,pasteURLAsLink:o=!0,htmlTagLanguage:a=qz}=n;if(!(i instanceof Nb))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let l=n.extensions?[n.extensions]:[],c=[a.support,Bde],d;o&&c.push(ehe),t instanceof fg?(c.push(t.support),d=t.language):t&&(d=t);let h=e||d?Vde(e,d):void 0;l.push(rce({codeParser:h,htmlParser:a.language.parser})),r&&c.push(Wo.high(Nl.of(Yde)));let f=X2(i.configure(l));return s&&c.push(f.data.of({autocomplete:Gde})),new fg(f,c)}function Gde(n){let{state:e,pos:t}=n,r=/<[:\-\.\w\u00b7-\uffff]*$/.exec(e.sliceDoc(t-25,t));if(!r)return null;let i=dr(e).resolveInner(t,-1);for(;i&&!i.type.isTop;){if(i.name=="CodeBlock"||i.name=="FencedCode"||i.name=="ProcessingInstructionBlock"||i.name=="CommentBlock"||i.name=="Link"||i.name=="Image")return null;i=i.parent}return{from:t-r[0].length,to:t,options:Kde(),validFor:/^<[:\-\.\w\u00b7-\uffff]*$/}}let M1=null;function Kde(){if(M1)return M1;let n=Dde(new M2(un.create({extensions:qz}),0,!0));return M1=n?n.options:[]}const Jde=/code|horizontalrule|html|link|comment|processing|escape|entity|image|mark|url/i,ehe=gt.domEventHandlers({paste:(n,e)=>{var t;let{main:r}=e.state.selection;if(r.empty)return!1;let i=(t=n.clipboardData)===null||t===void 0?void 0:t.getData("text/plain");if(!i||!/^(https?:\/\/|mailto:|xmpp:|www\.)/.test(i)||(/^www\./.test(i)&&(i="https://"+i),!f0.isActiveAt(e.state,r.from,1)))return!1;let s=dr(e.state),o=!1;return s.iterate({from:r.from,to:r.to,enter:a=>{(a.from>r.from||Jde.test(a.name))&&(o=!0)},leave:a=>{a.to<r.to&&(o=!0)}}),o?!1:(e.dispatch({changes:[{from:r.from,insert:"["},{from:r.to,insert:`](${i})`}],userEvent:"input.paste",scrollIntoView:!0}),!0)}}),R1={fontSize:"14px",fontFamily:"JetBrains Mono, Consolas, monospace",lineHeight:"1.6"},the={borderLeftWidth:"2px"},Xs={insertedTextDecoration:"none",deletedTextDecoration:"line-through",insertedLinePadding:"1px 3px",borderRadious:"3px"},Nf={border:"none",paddingRight:"8px",fontSize:"0.9em",fontWeight:"500"},D1={border:"none",borderRadius:"4px",padding:"2px 10px"},nhe={borderRadius:"2px"},N1={borderRadius:"2px"},L1={borderRadius:"4px",padding:"0 5px",margin:"0 2px"},Q1={width:"12px",height:"12px",borderRadius:"6px"},wv={borderRadius:"4px",padding:"2px 6px"},yd={borderRadius:"4px",borderRadiusSelected:"3px",lineHeight:"1.3",padding:"4px 8px",paddingRight:"8px"},bd="#ffffff",Ki="#24292e",Zz="#BBDFFF",wd="#6e7781",qI="#f6f8fa",rhe="#116329",ha="#6a737d",$1="#6f42c1",Bl="#005cc5",Lf="#d73a49",F1="#032f62",HI="#22863a",Lc="#e36209",ihe="#f1f8ff",Qc="#e1e4e8",she="#f8f9fa",lu="#cb2431",ohe="#BBDFFF20",_v=she,z1=Ki,ahe=Zz,lhe="#e8f0fe",che="#0366d6",ZI="#b08800",WI="#79b8ff40",Ux="#0969da",uhe="#8250df",XI="#e6ffec80",YI="#ffebe980",B1="#0f6d31",U1="#cf222e",dhe=gt.theme({"&":{color:Ki,backgroundColor:bd,fontSize:R1.fontSize,fontFamily:R1.fontFamily},".cm-content":{caretColor:z1,lineHeight:R1.lineHeight},".cm-cursor, .cm-dropCursor":{borderLeftColor:z1,borderLeftWidth:the.borderLeftWidth},".cm-fat-cursor":{backgroundColor:`${z1}99`,color:bd},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:ahe,color:Ki},".cm-selectionLayer":{zIndex:100},".cm-searchMatch":{backgroundColor:"#daebff",outline:`1px solid ${Bl}`,color:Ki,borderRadius:wv.borderRadius,"& span":{color:Ki}},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#79b8ff",color:bd,padding:wv.padding,"& span":{color:bd}},".cm-search.cm-panel.cm-textfield":{color:Ki,borderRadius:wv.borderRadius,padding:wv.padding},".cm-panels":{backgroundColor:qI,color:wd,borderRadius:"0 0 4px 4px"},".cm-panels.cm-panels-top":{borderBottom:`1px solid ${Qc}`},".cm-panels.cm-panels-bottom":{borderTop:`1px solid ${Qc}`},".cm-panel button":{backgroundColor:bd,color:Ki,border:D1.border,borderRadius:D1.borderRadius,padding:D1.padding},".cm-panel button:hover":{backgroundColor:"#f5f5f5"},".cm-activeLine":{backgroundColor:ohe,borderRadius:nhe.borderRadius,zIndex:1},".cm-gutters":{backgroundColor:qI,color:wd,border:Nf.border,borderRight:`1px solid ${Qc}`,paddingRight:Nf.paddingRight},".cm-activeLineGutter":{backgroundColor:ihe,color:Ki,fontWeight:Nf.fontWeight},".cm-lineNumbers":{fontSize:Nf.fontSize},".cm-foldGutter":{fontSize:Nf.fontSize},".cm-foldGutter .cm-gutterElement":{color:wd,cursor:"pointer"},".cm-foldGutter .cm-gutterElement:hover":{color:Ki},".cm-insertedLine":{textDecoration:Xs.insertedTextDecoration,backgroundColor:XI,color:B1,padding:Xs.insertedLinePadding,borderRadius:Xs.borderRadious},"ins.cm-insertedLine, ins.cm-insertedLine:not(:has(.cm-changedText))":{textDecoration:Xs.insertedTextDecoration,backgroundColor:`${XI} !important`,color:B1,padding:Xs.insertedLinePadding,borderRadius:Xs.borderRadious,border:`1px solid ${B1}30`},"ins.cm-insertedLine .cm-changedText":{background:"transparent !important"},".cm-deletedLine":{textDecoration:Xs.deletedTextDecoration,backgroundColor:YI,color:U1,padding:Xs.insertedLinePadding,borderRadius:Xs.borderRadious},"del.cm-deletedLine, del, del:not(:has(.cm-deletedText))":{textDecoration:Xs.deletedTextDecoration,backgroundColor:`${YI} !important`,color:U1,padding:Xs.insertedLinePadding,borderRadius:Xs.borderRadious,border:`1px solid ${U1}30`},"del .cm-deletedText, del .cm-changedText":{background:"transparent !important"},".cm-tooltip":{backgroundColor:_v,border:`1px solid ${Qc}`,borderRadius:yd.borderRadius,padding:yd.padding,boxShadow:"0 1px 5px rgba(0, 0, 0, 0.1)"},".cm-tooltip-autocomplete":{"& > ul":{backgroundColor:_v,border:"none"},"& > ul > li":{padding:yd.padding,lineHeight:yd.lineHeight},"& > ul > li[aria-selected]":{backgroundColor:"#0366d630",color:Ki,borderRadius:yd.borderRadiusSelected},"& > ul > li:hover":{backgroundColor:"#0366d615"},"& > ul > li > span.cm-completionIcon":{color:wd,paddingRight:yd.paddingRight},"& > ul > li > span.cm-completionDetail":{color:wd,fontStyle:"italic"}},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:_v,borderBottomColor:_v},".cm-diagnostic":{"&-error":{borderLeft:`3px solid ${lu}`},"&-warning":{borderLeft:`3px solid ${ZI}`},"&-info":{borderLeft:`3px solid ${Ux}`}},".cm-lintPoint-error":{borderBottom:`2px wavy ${lu}`},".cm-lintPoint-warning":{borderBottom:`2px wavy ${ZI}`},".cm-matchingBracket":{backgroundColor:lhe,outline:`1px solid ${che}80`,borderRadius:N1.borderRadius},".cm-nonmatchingBracket":{backgroundColor:"#ffeef080",outline:`1px solid ${lu}`,borderRadius:N1.borderRadius},".cm-selectionMatch":{backgroundColor:WI,outline:`1px solid ${Zz}50`,borderRadius:N1.borderRadius},".cm-foldPlaceholder":{backgroundColor:WI,color:wd,border:`1px dotted ${Qc}70`,borderRadius:L1.borderRadius,padding:L1.padding,margin:L1.margin},"&.cm-focused":{outline:"none",boxShadow:`0 0 0 2px ${bd}, 0 0 0 3px ${Ux}40`},"& .cm-scroller::-webkit-scrollbar":{width:Q1.width,height:Q1.height},"& .cm-scroller::-webkit-scrollbar-track":{background:Qc},"& .cm-scroller::-webkit-scrollbar-thumb":{backgroundColor:Ki,borderRadius:Q1.borderRadius,border:`3px solid ${Qc}`},"& .cm-scroller::-webkit-scrollbar-thumb:hover":{backgroundColor:ha},".cm-ghostText":{opacity:"0.5",color:"#959da5"}},{dark:!1}),hhe=sf.define([{tag:K.keyword,color:Lf,fontWeight:"bold"},{tag:K.controlKeyword,color:Lf,fontWeight:"bold"},{tag:K.moduleKeyword,color:Lf,fontWeight:"bold"},{tag:[K.name,K.deleted,K.character,K.macroName],color:Bl},{tag:[K.variableName],color:Bl},{tag:[K.propertyName],color:$1,fontStyle:"normal"},{tag:[K.typeName],color:Lf},{tag:[K.className],color:$1,fontStyle:"italic"},{tag:[K.namespace],color:Bl,fontStyle:"italic"},{tag:[K.operator,K.operatorKeyword],color:Ki},{tag:[K.bracket],color:ha},{tag:[K.brace],color:ha},{tag:[K.punctuation],color:ha},{tag:[K.function(K.variableName),K.labelName],color:HI},{tag:[K.definition(K.variableName)],color:Bl},{tag:K.number,color:Lc},{tag:K.changed,color:Lc},{tag:K.annotation,color:lu,fontStyle:"italic"},{tag:K.modifier,color:Lc,fontStyle:"italic"},{tag:K.self,color:Lc},{tag:[K.color,K.constant(K.name),K.standard(K.name)],color:Lc},{tag:[K.atom,K.bool,K.special(K.variableName)],color:Lc},{tag:[K.processingInstruction,K.inserted],color:HI},{tag:[K.special(K.string),K.regexp],color:F1},{tag:K.string,color:F1},{tag:K.definition(K.typeName),color:Lf,fontWeight:"bold"},{tag:K.meta,color:ha},{tag:K.comment,fontStyle:"italic",color:ha},{tag:K.docComment,fontStyle:"italic",color:ha},{tag:[K.tagName],color:rhe},{tag:[K.attributeName],color:$1},{tag:[K.heading],fontWeight:"bold",color:Bl},{tag:[K.strong],fontWeight:"bold",color:Bl},{tag:[K.emphasis],fontStyle:"italic",color:F1},{tag:[K.link],color:uhe,fontWeight:"500",textDecoration:"underline",textUnderlinePosition:"under"},{tag:[K.url],color:Ux,textDecoration:"underline",textUnderlineOffset:"2px"},{tag:[K.invalid],color:Ki,textDecoration:"underline wavy",borderBottom:`1px wavy ${lu}`},{tag:[K.strikethrough],color:lu,textDecoration:"line-through"},{tag:K.constant(K.name),color:Lc},{tag:K.deleted,color:lu},{tag:K.squareBracket,color:ha},{tag:K.angleBracket,color:ha},{tag:K.monospace,color:Ki},{tag:[K.contentSeparator],color:Bl},{tag:K.quote,color:ha}]),G2=[dhe,_2(hhe)],j1={fontSize:"14px",fontFamily:"JetBrains Mono, Consolas, monospace",lineHeight:"1.6"},fhe={borderLeftWidth:"2px"},Ys={insertedTextDecoration:"none",deletedTextDecoration:"line-through",insertedLinePadding:"1px 3px",borderRadious:"3px"},Qf={border:"none",paddingRight:"8px",fontSize:"0.9em",fontWeight:"500"},V1={border:"none",borderRadius:"4px",padding:"2px 10px"},phe={borderRadius:"2px"},q1={borderRadius:"2px"},H1={borderRadius:"4px",padding:"0 5px",margin:"0 2px"},Z1={width:"12px",height:"12px",borderRadius:"6px"},Ov={borderRadius:"4px",padding:"2px 6px"},_d={borderRadius:"4px",borderRadiusSelected:"3px",lineHeight:"1.3",padding:"4px 8px",paddingRight:"8px"},W1="#0d1117",No="#c9d1d9",Wz="#264F78",Ni="#8b949e",ny="#ffffff",X1="#7ee787",Y1="#d2a8ff",Ul="#79c0ff",$f="#ff7b72",G1="#a5d6ff",ghe="#2c333a",mhe="#3c444d",$c="#ffab70",K1="#161b22",Ff="#30363d",vhe="#21262d",cu="#f97583",yhe="#2d333b1a",Fc="#21262d",J1=ny,GI=Wz,bhe="#3a587a75",KI="#4d90fe",JI="#d29922",whe="#3a587a55",jx="#58a6ff",_he="#bc8cff",eM="#2ea04350",tM="#f8514940",e_="#7ee787",t_="#ff7b72",Ohe=gt.theme({"&":{color:No,backgroundColor:W1,fontSize:j1.fontSize,fontFamily:j1.fontFamily},".cm-content":{caretColor:J1,lineHeight:j1.lineHeight},".cm-cursor, .cm-dropCursor":{borderLeftColor:J1,borderLeftWidth:fhe.borderLeftWidth},".cm-fat-cursor":{backgroundColor:`${J1}99`,color:W1},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:GI},".cm-selectionLayer":{zIndex:100},".cm-searchMatch":{backgroundColor:"#3a587a",outline:`1px solid ${Ul}`,color:No,borderRadius:Ov.borderRadius,"& span":{color:No}},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:KI,color:ny,padding:Ov.padding,"& span":{color:ny}},".cm-search.cm-panel.cm-textfield":{color:No,borderRadius:Ov.borderRadius,padding:Ov.padding},".cm-panels":{backgroundColor:Fc,color:No,borderRadius:"4px"},".cm-panels.cm-panels-top":{borderBottom:`1px solid ${Ff}`},".cm-panels.cm-panels-bottom":{borderTop:`1px solid ${Ff}`},".cm-panel button":{backgroundColor:Fc,color:No,border:V1.border,borderRadius:V1.borderRadius,padding:V1.padding},".cm-panel button:hover":{backgroundColor:ghe},".cm-activeLine":{backgroundColor:yhe,borderRadius:phe.borderRadius,zIndex:1},".cm-gutters":{backgroundColor:K1,color:Ni,border:Qf.border,borderRight:"1px solid #30363d",paddingRight:Qf.paddingRight},".cm-activeLineGutter":{backgroundColor:vhe,color:No,fontWeight:Qf.fontWeight},".cm-lineNumbers":{fontSize:Qf.fontSize},".cm-foldGutter":{fontSize:Qf.fontSize},".cm-foldGutter .cm-gutterElement":{color:Ni,cursor:"pointer"},".cm-foldGutter .cm-gutterElement:hover":{color:No},".cm-insertedLine":{textDecoration:Ys.insertedTextDecoration,backgroundColor:eM,color:e_,padding:Ys.insertedLinePadding,borderRadius:Ys.borderRadious},"ins.cm-insertedLine, ins.cm-insertedLine:not(:has(.cm-changedText))":{textDecoration:Ys.insertedTextDecoration,backgroundColor:`${eM} !important`,color:e_,padding:Ys.insertedLinePadding,borderRadius:Ys.borderRadious,border:`1px solid ${e_}40`},"ins.cm-insertedLine .cm-changedText":{background:"transparent !important"},".cm-deletedLine":{textDecoration:Ys.deletedTextDecoration,backgroundColor:tM,color:t_,padding:Ys.insertedLinePadding,borderRadius:Ys.borderRadious},"del.cm-deletedLine, del, del:not(:has(.cm-deletedText))":{textDecoration:Ys.deletedTextDecoration,backgroundColor:`${tM} !important`,color:t_,padding:Ys.insertedLinePadding,borderRadius:Ys.borderRadious,border:`1px solid ${t_}40`},"del .cm-deletedText, del .cm-changedText":{background:"transparent !important"},".cm-tooltip":{backgroundColor:Fc,border:`1px solid ${Ff}`,borderRadius:_d.borderRadius,padding:_d.padding,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},".cm-tooltip-autocomplete":{"& > ul":{backgroundColor:Fc,border:"none"},"& > ul > li":{padding:_d.padding,lineHeight:_d.lineHeight},"& > ul > li[aria-selected]":{backgroundColor:GI,color:ny,borderRadius:_d.borderRadiusSelected},"& > ul > li > span.cm-completionIcon":{color:Ni,paddingRight:_d.paddingRight},"& > ul > li > span.cm-completionDetail":{color:Ni,fontStyle:"italic"}},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Fc,borderBottomColor:Fc},".cm-diagnostic":{"&-error":{borderLeft:`3px solid ${cu}`},"&-warning":{borderLeft:`3px solid ${JI}`},"&-info":{borderLeft:`3px solid ${jx}`}},".cm-lintPoint-error":{borderBottom:`2px wavy ${cu}`},".cm-lintPoint-warning":{borderBottom:`2px wavy ${JI}`},".cm-matchingBracket":{backgroundColor:bhe,outline:`1px solid ${KI}`,borderRadius:q1.borderRadius},".cm-nonmatchingBracket":{backgroundColor:"#f9758340",outline:`1px solid ${cu}`,borderRadius:q1.borderRadius},".cm-selectionMatch":{backgroundColor:whe,outline:`1px solid ${Wz}50`,borderRadius:q1.borderRadius},".cm-foldPlaceholder":{backgroundColor:Fc,color:Ni,border:`1px dotted ${Ff}70`,borderRadius:H1.borderRadius,padding:H1.padding,margin:H1.margin},"&.cm-focused":{outline:"none",boxShadow:`0 0 0 2px ${W1}, 0 0 0 3px ${jx}40`},"& .cm-scroller::-webkit-scrollbar":{width:Z1.width,height:Z1.height},"& .cm-scroller::-webkit-scrollbar-track":{background:K1},"& .cm-scroller::-webkit-scrollbar-thumb":{backgroundColor:Ff,borderRadius:Z1.borderRadius,border:`3px solid ${K1}`},"& .cm-scroller::-webkit-scrollbar-thumb:hover":{backgroundColor:mhe},".cm-ghostText":{opacity:"0.5",color:Ni}},{dark:!0}),xhe=sf.define([{tag:K.keyword,color:$f,fontWeight:"bold"},{tag:K.controlKeyword,color:$f,fontWeight:"bold"},{tag:K.moduleKeyword,color:$f,fontWeight:"bold"},{tag:[K.name,K.deleted,K.character,K.macroName],color:Ul},{tag:[K.variableName],color:Ul},{tag:[K.propertyName],color:Y1,fontStyle:"normal"},{tag:[K.typeName],color:$f},{tag:[K.className],color:Y1,fontStyle:"italic"},{tag:[K.namespace],color:Ul,fontStyle:"italic"},{tag:[K.operator,K.operatorKeyword],color:No},{tag:[K.bracket],color:Ni},{tag:[K.brace],color:Ni},{tag:[K.punctuation],color:Ni},{tag:[K.function(K.variableName),K.labelName],color:X1},{tag:[K.definition(K.variableName)],color:Ul},{tag:K.number,color:$c},{tag:K.changed,color:$c},{tag:K.annotation,color:cu,fontStyle:"italic"},{tag:K.modifier,color:$c,fontStyle:"italic"},{tag:K.self,color:$c},{tag:[K.color,K.constant(K.name),K.standard(K.name)],color:$c},{tag:[K.atom,K.bool,K.special(K.variableName)],color:$c},{tag:[K.processingInstruction,K.inserted],color:X1},{tag:[K.special(K.string),K.regexp],color:G1},{tag:K.string,color:G1},{tag:K.definition(K.typeName),color:$f,fontWeight:"bold"},{tag:K.meta,color:Ni},{tag:K.comment,fontStyle:"italic",color:Ni},{tag:K.docComment,fontStyle:"italic",color:Ni},{tag:[K.tagName],color:X1},{tag:[K.attributeName],color:Y1},{tag:[K.heading],fontWeight:"bold",color:Ul},{tag:[K.strong],fontWeight:"bold",color:Ul},{tag:[K.emphasis],fontStyle:"italic",color:G1},{tag:[K.link],color:_he,fontWeight:"500",textDecoration:"underline",textUnderlinePosition:"under"},{tag:[K.url],color:jx,textDecoration:"underline",textUnderlineOffset:"2px"},{tag:[K.invalid],color:No,textDecoration:"underline wavy",borderBottom:`1px wavy ${cu}`},{tag:[K.strikethrough],color:cu,textDecoration:"line-through"},{tag:K.constant(K.name),color:$c},{tag:K.deleted,color:cu},{tag:K.squareBracket,color:Ni},{tag:K.angleBracket,color:Ni},{tag:K.monospace,color:No},{tag:[K.contentSeparator],color:Ul},{tag:K.quote,color:Ni}]),K2=[Ohe,_2(xhe)],khe=/^(\s*)([-*+]|\d{1,3}\.) /,She=2;function The(n){const e=khe.exec(n);if(e){const t=e[1].length,r=e[2];return{isListLine:!0,isMarkerLine:!0,isContinuationLine:!1,level:Math.floor(t/She),markerType:Ahe(r),leadingSpaces:t,markerText:r}}return{isListLine:!1,isMarkerLine:!1,isContinuationLine:!1,level:0,markerType:null,leadingSpaces:0,markerText:""}}function Ahe(n){if(n==="-")return"dash";if(n==="*")return"star";if(n==="+")return"plus";if(n.endsWith(".")){const e=n.slice(0,-1);if(e.length===1)return"num1";if(e.length===2)return"num2";if(e.length===3)return"num3"}return null}class Che{decorations;constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.viewportChanged)&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){const t=[],r=e.state.doc,i=[];for(let s=1;s<=r.lines;s++){const o=r.line(s);i.push(o.text)}for(let s=1;s<=r.lines;s++){const o=r.line(s),a=o.text,l=The(a);if(l.isMarkerLine){const c=l.level,d=l.markerType;if(d){const h=`--list-marker-${d}-width`,f="--list-base-indent",p="--cm-line-padding",g=c===0?`calc(var(${p}, 6px) + var(${h}, 1.5ch))`:`calc(var(${p}, 6px) + (var(${f}, 2ch) * ${c}) + var(${h}, 1.5ch))`,m=c===0?`calc(-1 * var(${h}, 1.5ch))`:`calc((var(${f}, 2ch) * -${c}) - var(${h}, 1.5ch))`;t.push(hn.line({class:"cm-list-marker-line",attributes:{style:`text-indent: ${m}; padding-left: ${g};`}}).range(o.from))}}}return hn.set(t)}}const Ehe=Kr.fromClass(Che,{decorations:n=>n.decorations}),Phe=gt.theme({".cm-list-marker-line":{},".cm-list-marker-line .wikilink":{position:"relative",textIndent:"0 !important"}}),Ihe=gt.theme({".wikilink":{cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"0 0.175rem",margin:"0 0.125rem",borderRadius:"0.25rem",fontSize:"inherit",fontFamily:"inherit",fontWeight:"600",transition:"all 0.2s ease"},".wikilink-icon":{fontSize:"0.9em",lineHeight:"1",display:"inline-block",verticalAlign:"baseline",marginRight:"0.25em"},".wikilink-text":{textDecoration:"underline"},".wikilink-exists":{background:"rgba(0, 0, 0, 0.03)",color:"#1a1a1a"},".wikilink-exists:hover":{background:"rgba(0, 0, 0, 0.06)",color:"#0066cc"},".wikilink-selected":{background:"rgba(0, 0, 0, 0.06)",color:"#0066cc"},".wikilink-selected-broken":{background:"rgba(215, 58, 73, 0.12)",color:"#d73a49"},".wikilink-broken":{background:"rgba(215, 58, 73, 0.08)",color:"#d73a49"},".wikilink-broken:hover":{background:"rgba(215, 58, 73, 0.12)",color:"#cb2431"},".wikilink-archived":{opacity:"0.6",fontStyle:"italic"},".wikilink-archived:hover":{opacity:"0.8"},"@media (prefers-color-scheme: dark)":{".wikilink-exists":{background:"rgba(255, 255, 255, 0.06)",color:"#ffffff"},".wikilink-exists:hover":{background:"rgba(255, 255, 255, 0.12)",color:"#ffffff"},".wikilink-broken":{background:"rgba(248, 81, 73, 0.12)",color:"#f85149"},".wikilink-broken:hover":{background:"rgba(248, 81, 73, 0.18)",color:"#ff7b72"},".wikilink-selected":{background:"rgba(255, 255, 255, 0.12)",color:"#60a5fa"},".wikilink-selected-broken":{background:"rgba(248, 81, 73, 0.18)",color:"#f85149"}}}),nM="wikilink-completion-icons",Mhe=/^conv-[a-f0-9]{8}$/i,Rhe=/^type-[a-z0-9]+$/i,rM=/\[\[([^[\]]+)\]\]/g,Dhe=en.define(),Nhe=en.define(),Xz=en.define(),J2=Cr.define({create:()=>null,update:(n,e)=>{if(!e.docChanged&&!e.selection)return n;const t=e.state.selection.main.head,r=e.state.doc.toString(),i=cs(),s=Gz(r,i);for(const o of s)if(t===o.from||t===o.to)return{from:o.from,to:o.to,identifier:o.identifier,title:o.title,exists:o.exists,noteId:o.noteId,targetType:o.targetType,conversationId:o.conversationId,typeId:o.typeId};return null}}),Ap=Cr.define({create:()=>null,update:(n,e)=>{for(const t of e.effects)if(t.is(Dhe))return t.value;return n}}),ry=Cr.define({create:()=>null,update:(n,e)=>{for(const t of e.effects)if(t.is(Nhe))return t.value;return n}}),iM=Cr.define({create:()=>null,update:n=>n});function Yz(n){return Mhe.test(n.trim())}function Lhe(n){return Rhe.test(n.trim())}function Qhe(n){const e=n.toLowerCase().trim();return Yz(e)?xu(e)??null:null}function Gz(n,e){const t=[];let r;for(rM.lastIndex=0;(r=rM.exec(n))!==null;){const i=r[1].trim(),s=i.indexOf("|");let o,a;s!==-1?(o=i.substring(0,s).trim(),a=i.substring(s+1).trim()):(o=i,a=i);let l="note",c=!1,d,h,f;if(Yz(o)){l="conversation";const p=Qhe(o);c=!!p&&!p.archived,h=p?.id}else if(Lhe(o)){l="type";const p=jr(o);c=!!p&&!p.archived,f=p?.id}else{l="note";const p=$he(o,e);c=!!p,d=p?.id}t.push({from:r.index,to:r.index+r[0].length,text:r[0],identifier:o,title:a,exists:c,noteId:d,targetType:l,conversationId:h,typeId:f})}return t}function $he(n,e){const t=n.toLowerCase().trim(),r=e.find(s=>s.id.toLowerCase()===t);if(r)return r;const i=e.find(s=>s.title.toLowerCase().trim()===t);return i||null}function Fhe(n){const e=n.matchBefore(/\[\[([^\]]*)/);if(!e)return null;const t=e.text.match(/\[\[([^\]]*)/);if(!t)return null;const r=t[1],i=r.toLowerCase().trim(),s=cs().filter(f=>!f.archived),o=yo(),a=A5().filter(f=>!f.archived),l=r.trim()?s.filter(f=>f.title.toLowerCase().includes(i)||f.id.toLowerCase().includes(i)).sort((f,p)=>{const g=f.title.toLowerCase(),m=p.title.toLowerCase();return g===i?-1:m===i?1:g.startsWith(i)&&!m.startsWith(i)?-1:m.startsWith(i)&&!g.startsWith(i)?1:g.localeCompare(m)}).slice(0,6):s.slice(0,6),c=r.trim()?a.filter(f=>f.title.toLowerCase().includes(i)||f.id.toLowerCase().includes(i)).sort((f,p)=>{const g=f.title.toLowerCase(),m=p.title.toLowerCase();return g===i?-1:m===i?1:g.startsWith(i)&&!m.startsWith(i)?-1:m.startsWith(i)&&!g.startsWith(i)?1:g.localeCompare(m)}).slice(0,4):a.slice(0,4),d=r.trim()?o.filter(f=>f.name.toLowerCase().includes(i)||f.id.toLowerCase().includes(i)).sort((f,p)=>{const g=f.name.toLowerCase(),m=p.name.toLowerCase();return g===i?-1:m===i?1:g.startsWith(i)&&!m.startsWith(i)?-1:m.startsWith(i)&&!g.startsWith(i)?1:g.localeCompare(m)}).slice(0,4):o.slice(0,4),h=[];for(const f of l){const p=o.find(m=>m.id===f.type),g=p?.id||"default";h.push({label:f.title||"Untitled",apply:`${f.id}]]`,type:`wikilink-note wikilink-note-${g}`,detail:`${p?.name||"Note"}`})}for(const f of c)h.push({label:f.title||"New Conversation",apply:`${f.id}]]`,type:"wikilink-conversation",detail:"Conversation"});for(const f of d)h.push({label:f.name,apply:`${f.id}]]`,type:"wikilink-type",detail:"Type"});return r.trim()&&!l.some(f=>f.title.toLowerCase()===i)&&h.push({label:`Create "${r.trim()}"`,apply:`${r.trim()}]]`,type:"wikilink-note-new",detail:"New Note"}),{from:e.from+2,options:h}}class Kz extends Yo{constructor(e,t,r,i,s,o,a,l,c,d,h,f,p){super(),this.identifier=e,this.displayTitle=t,this.exists=r,this.noteId=i,this.clickHandler=s,this.hoverHandler=o,this.from=a,this.to=l,this.isSelected=c,this.icon=d,this.targetType=h,this.conversationId=f,this.typeId=p}toDOM(e){const t=document.createElement("span");let r=!1;const i=cs();this.targetType==="note"&&this.noteId?r=i.find(d=>d.id===this.noteId)?.archived??!1:this.targetType==="conversation"&&this.conversationId?r=xu(this.conversationId)?.archived??!1:this.targetType==="type"&&this.typeId&&(r=jr(this.typeId)?.archived??!1);const s=["wikilink"];s.push(this.exists?"wikilink-exists":"wikilink-broken"),this.isSelected&&s.push(this.exists?"wikilink-selected":"wikilink-selected-broken"),r&&s.push("wikilink-archived"),s.push(`wikilink-${this.targetType}`),t.className=s.join(" ");const o=document.createElement("span");o.className="wikilink-icon",o.textContent=this.icon,t.appendChild(o);const a=document.createElement("span");a.className="wikilink-text";let l=this.displayTitle;if(this.exists&&this.identifier===this.displayTitle){if(this.targetType==="note"&&this.noteId){const c=i.find(d=>d.id===this.noteId);c&&(l=c.title||"Untitled")}else if(this.targetType==="conversation"&&this.conversationId){const c=xu(this.conversationId);c&&(l=c.title||"New Conversation")}else if(this.targetType==="type"&&this.typeId){const c=jr(this.typeId);c&&(l=c.name)}}return a.textContent=l,t.appendChild(a),t.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),this.clickHandler&&(this.targetType==="conversation"?this.exists&&this.conversationId&&this.clickHandler(this.conversationId,this.displayTitle,{targetType:"conversation"}):this.targetType==="type"?this.exists&&this.typeId&&this.clickHandler(this.typeId,this.displayTitle,{targetType:"type"}):this.exists&&this.noteId?this.clickHandler(this.noteId,this.displayTitle,{targetType:"note"}):this.clickHandler(this.identifier,this.displayTitle,{shouldCreate:!0,targetType:"note"}))}),t.addEventListener("mousedown",c=>{c.stopPropagation()}),this.hoverHandler&&(t.addEventListener("mouseenter",()=>{const c=t.getBoundingClientRect();this.hoverHandler({identifier:this.identifier,displayText:this.displayTitle,from:this.from,to:this.to,x:c.left,y:c.bottom,yTop:c.top,exists:this.exists,noteId:this.noteId,targetType:this.targetType,conversationId:this.conversationId,typeId:this.typeId})}),t.addEventListener("mouseleave",()=>{this.hoverHandler(null)})),t}eq(e){return this.identifier===e.identifier&&this.displayTitle===e.displayTitle&&this.exists===e.exists&&this.noteId===e.noteId&&this.isSelected===e.isSelected&&this.icon===e.icon&&this.targetType===e.targetType&&this.conversationId===e.conversationId&&this.typeId===e.typeId}ignoreEvent(){return!0}}function zhe(n,e){const t=dr(n);let r=!1;return t.iterate({from:e,to:e,enter:i=>{const s=i.name;if(s==="InlineCode"||s==="CodeBlock"||s==="FencedCode"||s==="CodeText"||s==="CodeInfo"||s==="CodeMark")return r=!0,!1}}),r}function n_(n,e,t){const r=[],i=n.doc.toString(),s=cs(),o=yo(),a=Gz(i,s),l=n.field(J2);for(const c of a){if(zhe(n,c.from))continue;let d="ð";if(c.targetType==="conversation")d="ð¬";else if(c.targetType==="type")d="ð·ï¸";else if(c.exists&&c.noteId){const p=s.find(g=>g.id===c.noteId);p&&(d=o.find(m=>m.id===p.type)?.icon||"ð")}const h=l!==null&&l.from===c.from&&l.to===c.to,f=new Kz(c.identifier,c.title,c.exists,c.noteId,e,t,c.from,c.to,h,d,c.targetType,c.conversationId,c.typeId);r.push(hn.replace({widget:f,inclusive:!1,block:!1}).range(c.from,c.to))}return $n.of(r.sort((c,d)=>c.from-d.from))}const sM=Cr.define({create:n=>{const e=n.field(Ap),t=n.field(ry);return n_(n,e,t)},update:(n,e)=>{for(const t of e.effects)if(t.is(Xz)){const r=e.state.field(Ap),i=e.state.field(ry);return n_(e.state,r,i)}if(e.docChanged||e.selection){const t=e.state.field(Ap),r=e.state.field(ry);return n_(e.state,t,r)}return n},provide:n=>gt.decorations.from(n)});function jh(n){n.dispatch({effects:Xz.of(!0)})}function p0(n){return n.state.field(J2)}function Bhe(){const t=`
/* Wikilink completion icon styles */
.cm-completionIcon-wikilink-note::after,
.cm-completionIcon-wikilink-note-default::after,
.cm-completionIcon-wikilink-note-new::after {
  content: 'ð';
}

.cm-completionIcon-wikilink-conversation::after {
  content: 'ð¬';
}

.cm-completionIcon-wikilink-type::after {
  content: 'ð·ï¸';
}

/* Note type specific icons */
${yo().map(i=>{const s=i.icon||"ð";return`.cm-completionIcon-wikilink-note-${i.id}::after { content: '${s}'; }`}).join(`
`)}
`;let r=document.getElementById(nM);r||(r=document.createElement("style"),r.id=nM,document.head.appendChild(r)),r.textContent=t}function eT(n,e,t){Bhe();const r=Wo.highest(Nl.of([{key:"Ctrl-n",run:i=>Mx(i.state)==="active"?(Hd(!0)(i),!0):!1},{key:"Ctrl-p",run:i=>Mx(i.state)==="active"?(Hd(!1)(i),!0):!1},{key:"Mod-Enter",run:i=>{const s=p0(i);if(s){const o=i.state.field(Ap);if(o)return s.targetType==="conversation"?s.exists&&s.conversationId?(o(s.conversationId,s.title,{targetType:"conversation"}),!0):!1:(s.exists&&s.noteId?o(s.noteId,s.title,{targetType:"note"}):o(s.identifier,s.title,{shouldCreate:!0,targetType:"note"}),!0)}return!1}},{key:"Alt-Enter",run:i=>{const s=p0(i);if(s){const o=i.state.field(iM);if(o)return o(s),!0}return!1}}]));return[Ihe,Ap.init(()=>n),ry.init(()=>e||null),iM.init(()=>t||null),J2,sM,Ble({override:[Fhe],activateOnTyping:!0,closeOnBlur:!0}),r,gt.atomicRanges.of(i=>{const s=i.state.field(sM,!1);if(!s)return $n.empty;const o=[];try{return s.between(0,i.state.doc.length,(a,l,c)=>{c.spec.widget instanceof Kz&&o.push({from:a,to:l,value:!0})}),o.sort((a,l)=>a.from-l.from),o.length>0?$n.of(o):$n.empty}catch(a){return console.warn("Error creating atomic ranges:",a),$n.empty}})]}const oM={string:["=","!=","LIKE"],number:["=","!=",">","<",">=","<=","BETWEEN"],boolean:["=","!="],date:["=","!=",">","<",">=","<=","BETWEEN"],array:["IN","=","!=","NOT IN"],select:["=","!=","IN","NOT IN"],notelink:["=","!="],notelinks:["IN","NOT IN","=","!="],system:["=","!=","LIKE"]},g0=[{name:"type",label:"Type",type:"select",isSystem:!0},{name:"title",label:"Title",type:"string",isSystem:!0},{name:"created",label:"Created",type:"date",isSystem:!0},{name:"updated",label:"Updated",type:"date",isSystem:!0},{name:"archived",label:"Archived",type:"boolean",isSystem:!0},{name:"sourceFormat",label:"Source Format",type:"select",isSystem:!0,options:["markdown","pdf","epub","webpage","deck"]},{name:"lastOpened",label:"Last Opened",type:"date",isSystem:!0},{name:"review.enabled",label:"Review Enabled",type:"boolean",isSystem:!0},{name:"review.status",label:"Review Status",type:"select",isSystem:!0,options:["active","retired"]},{name:"review.lastReviewed",label:"Last Reviewed",type:"date",isSystem:!0},{name:"review.reviewCount",label:"Review Count",type:"number",isSystem:!0}];function Uhe(n){return oM[n]||oM.string}function jhe(n){return{"=":"equals","!=":"not equals",">":"greater than","<":"less than",">=":"at least","<=":"at most",LIKE:"contains",IN:"in list","NOT IN":"not in list",BETWEEN:"between"}[n]||n}function Vhe(n,e){const t=e[n.type];return{id:n.id,title:n.title,typeId:n.type,typeName:t?.name||"Unknown",typeIcon:t?.icon||"ð",created:n.created,updated:n.updated,props:n.props||{},archived:n.archived,sourceFormat:n.sourceFormat,lastOpened:n.lastOpened,review:n.review?{enabled:n.review.enabled,status:n.review.status,lastReviewed:n.review.lastReviewed,reviewCount:n.review.reviewCount}:void 0}}function aM(n){return typeof n=="string"?{field:n}:n}function qhe(n="Default"){return{name:n,filters:[],sort:{field:"updated",order:"desc"}}}function Jz(n,e,t,r={}){const{offset:i=0,includeArchived:s=!1}=r,o=Wp(n),a=o.filters||[],l=o.sort,c=n.pageSize||Th,d=a.some(v=>v.field==="archived");let h=s||d?e:e.filter(v=>!v.archived);h=h.filter(v=>Hhe(v,a,t)),l&&(h=Whe(h,l,t));const f=h.length,p=h.slice(i,i+c),g=i+c<f;return{notes:p.map(v=>Vhe(v,t)),total:f,hasMore:g}}function Hhe(n,e,t){return e.every(r=>Zhe(n,r,t))}function Zhe(n,e,t){const{field:r,operator:i="=",value:s}=e,o=oL(n,r,t);if(s===nb){const a=o==null||o==="";return i==="="?a:!a}return o==null?i==="!="||i==="="&&s==="false":aL(o,i,s)}function Whe(n,e,t){const{field:r,order:i}=e,s=i==="desc"?-1:1;return[...n].sort((o,a)=>{const l=lM(o,r,t),c=lM(a,r,t);return l==null&&c==null?0:l==null?1:c==null?-1:s*Uc(l,c)})}function lM(n,e,t){if(e.startsWith("props.")){const r=e.slice(6);return n.props?.[r]}switch(e){case"title":return n.title.toLowerCase();case"type":return t[n.type]?.name?.toLowerCase()||"";case"created":return n.created;case"updated":return n.updated;default:return}}function Xhe(n,e,t){const r=new Set;for(const a of n)a.archived||t&&t.length>0&&(!a.type||!t.includes(a.type))||a.props&&Object.keys(a.props).forEach(l=>r.add(l));const i=t&&t.length>0?t:Object.keys(e),s=new Map;for(const a of i){const l=e[a];if(l?.properties)for(const c of l.properties){const d=s.get(c.name),h=c.constraints?.options&&c.constraints.options.length>0;(!d||h&&!d.options)&&s.set(c.name,{type:c.type,options:c.constraints?.options})}}const o=[{name:"type",label:"Type",type:"select",isSystem:!0},{name:"title",label:"Title",type:"string",isSystem:!0},{name:"created",label:"Created",type:"date",isSystem:!0},{name:"updated",label:"Updated",type:"date",isSystem:!0},{name:"archived",label:"Archived",type:"boolean",isSystem:!0}];for(const a of Array.from(r).sort()){const l=s.get(a);o.push({name:`props.${a}`,label:a.replace(/_/g," "),type:l?.type??"string",options:l?.options,isSystem:!1})}return o}const Yhe=gt.theme({".deck-widget-container":{display:"block",width:"100%",margin:"1rem 0",overflow:"visible",fontFamily:"inherit"},".deck-widget-container.deck-embedded":{border:"1px solid var(--border-light, #e5e7eb)",borderRadius:"0.5rem",background:"var(--bg-secondary, #f9fafb)"},".deck-error-widget":{display:"block",width:"100%",margin:"1rem 0",padding:"1rem",borderRadius:"0.5rem",border:"1px solid var(--warning-border, #fcd34d)",background:"var(--warning-bg, #fffbeb)",fontFamily:"inherit"},".deck-error-content":{display:"flex",alignItems:"flex-start",gap:"0.75rem",color:"var(--warning-text, #92400e)"},".deck-error-content svg":{flexShrink:"0",marginTop:"0.125rem"},".deck-error-text":{flex:"1"},".deck-error-text strong":{display:"block",fontWeight:"600",marginBottom:"0.25rem"},".deck-error-text p":{margin:"0",fontSize:"0.875rem",opacity:"0.9"},".deck-error-text code":{padding:"0.125rem 0.375rem",borderRadius:"0.25rem",background:"rgba(0, 0, 0, 0.1)",fontFamily:"monospace",fontSize:"0.8125rem"},".deck-loading":{display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem",color:"var(--text-secondary, #6b7280)"},".deck-loading-text":{fontSize:"0.875rem"}});var Ghe=P("<option> </option>"),Khe=P('<div class="pagination-controls svelte-1tcev2k"><div class="pagination-nav svelte-1tcev2k"><button class="nav-button svelte-1tcev2k" type="button" title="Previous page"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button> <span class="page-info svelte-1tcev2k"> </span> <button class="nav-button svelte-1tcev2k" type="button" title="Next page"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></button></div> <div class="page-size-control svelte-1tcev2k"><label class="page-size-label svelte-1tcev2k" for="page-size-select">Show</label> <select id="page-size-select" class="page-size-select svelte-1tcev2k"></select></div></div>');function eB(n,e){lt(e,!0);const t=le(()=>e.total===0?0:e.currentPage*e.pageSize+1),r=le(()=>Math.min((e.currentPage+1)*e.pageSize,e.total)),i=le(()=>e.currentPage>0),s=le(()=>e.currentPage<e.totalPages-1);function o(){u(i)&&e.onPageChange(e.currentPage-1)}function a(){u(s)&&e.onPageChange(e.currentPage+1)}function l(f){const p=f.target,g=parseInt(p.value,10);e.onPageSizeChange(g)}var c=Ve(),d=Ie(c);{var h=f=>{var p=Khe(),g=w(p),m=w(g);m.__click=o;var v=A(m,2),y=w(v),O=A(v,2);O.__click=a;var _=A(g,2),x=A(w(_),2);x.__change=l,Tt(x,20,()=>zv,S=>S,(S,E)=>{var R=Ghe(),C=w(R),I={};Y(()=>{J(C,E),I!==(I=E)&&(R.value=(R.__value=E)??"")}),T(S,R)});var k;jo(x),Y(()=>{m.disabled=!u(i),J(y,`${u(t)??""}-${u(r)??""} of ${e.total??""}`),O.disabled=!u(s),k!==(k=e.pageSize)&&(x.value=(x.__value=e.pageSize)??"",go(x,e.pageSize))}),T(f,p)};z(d,f=>{e.total>0&&f(h)})}T(n,c),ct()}yt(["click","change"]);var Jhe=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],efe=["difference","intersection","symmetricDifference","union"],cM=!1;class kc extends Set{#e=new Map;#t=j(0);#r=j(0);#n=Uo||-1;constructor(e){if(super(),e){for(var t of e)super.add(t);this.#r.v=super.size}cM||this.#i()}#s(e){return Uo===this.#n?j(e):Tl(e)}#i(){cM=!0;var e=kc.prototype,t=Set.prototype;for(const r of Jhe)e[r]=function(...i){return u(this.#t),t[r].apply(this,i)};for(const r of efe)e[r]=function(...i){u(this.#t);var s=t[r].apply(this,i);return new kc(s)}}has(e){var t=super.has(e),r=this.#e,i=r.get(e);if(i===void 0){if(!t)return u(this.#t),!1;i=this.#s(!0),r.set(e,i)}return u(i),t}add(e){return super.has(e)||(super.add(e),b(this.#r,super.size),Es(this.#t)),this}delete(e){var t=super.delete(e),r=this.#e,i=r.get(e);return i!==void 0&&(r.delete(e),b(i,!1)),t&&(b(this.#r,super.size),Es(this.#t)),t}clear(){if(super.size!==0){super.clear();var e=this.#e;for(var t of e.values())b(t,!1);e.clear(),b(this.#r,0),Es(this.#t)}}keys(){return this.values()}values(){return u(this.#t),super.values()}entries(){return u(this.#t),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return u(this.#r)}}class m0 extends Map{#e=new Map;#t=j(0);#r=j(0);#n=Uo||-1;constructor(e){if(super(),e){for(var[t,r]of e)super.set(t,r);this.#r.v=super.size}}#s(e){return Uo===this.#n?j(e):Tl(e)}has(e){var t=this.#e,r=t.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#s(0),t.set(e,r);else return u(this.#t),!1}return u(r),!0}forEach(e,t){this.#i(),super.forEach(e,t)}get(e){var t=this.#e,r=t.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#s(0),t.set(e,r);else{u(this.#t);return}}return u(r),super.get(e)}set(e,t){var r=this.#e,i=r.get(e),s=super.get(e),o=super.set(e,t),a=this.#t;if(i===void 0)i=this.#s(0),r.set(e,i),b(this.#r,super.size),Es(a);else if(s!==t){Es(i);var l=a.reactions===null?null:new Set(a.reactions),c=l===null||!i.reactions?.every(d=>l.has(d));c&&Es(a)}return o}delete(e){var t=this.#e,r=t.get(e),i=super.delete(e);return r!==void 0&&(t.delete(e),b(this.#r,super.size),b(r,-1),Es(this.#t)),i}clear(){if(super.size!==0){super.clear();var e=this.#e;b(this.#r,0);for(var t of e.values())b(t,-1);Es(this.#t),e.clear()}}#i(){u(this.#t);var e=this.#e;if(this.#r.v!==e.size){for(var t of super.keys())if(!e.has(t)){var r=this.#s(0);e.set(t,r)}}for([,r]of this.#e)u(r)}keys(){return u(this.#t),super.keys()}values(){return this.#i(),super.values()}entries(){return this.#i(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return u(this.#r),super.size}}var tfe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1fxao9p"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'),nfe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1fxao9p"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>'),rfe=P('<div role="listitem"><button type="button" aria-label="Drag to reorder" title="Drag to reorder"><svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><circle cx="9" cy="5" r="1.5"></circle><circle cx="15" cy="5" r="1.5"></circle><circle cx="9" cy="12" r="1.5"></circle><circle cx="15" cy="12" r="1.5"></circle><circle cx="9" cy="19" r="1.5"></circle><circle cx="15" cy="19" r="1.5"></circle></svg></button> <button type="button"><span class="prop-label svelte-1fxao9p"> </span></button> <button type="button"><!></button> <button type="button"><!></button></div>');function ife(n,e){lt(e,!0);let t=et(e,"visible",3,!0),r=et(e,"isDragging",3,!1),i=et(e,"shiftOffset",3,null);const s=le(()=>e.sort?.field===e.field),o=le(()=>u(s)?e.sort?.order:null),a=le(()=>i()?`translate(${i().x}px, ${i().y}px)`:"none");function l(M){M.stopPropagation(),M.preventDefault(),e.onVisibilityToggle?.(e.field,!t())}function c(M){M.stopPropagation();const N=u(o)==="desc"?"asc":"desc";e.onSort?.(e.field,N)}var d=rfe();let h,f;var p=w(d);let g;p.__pointerdown=function(...M){e.onDragHandlePointerDown?.apply(this,M)};var m=A(p,2);let v;m.__click=function(...M){e.onClick?.apply(this,M)};var y=w(m),O=w(y),_=A(m,2);let x;_.__click=l,_.__mousedown=M=>M.stopPropagation();var k=w(_);{var S=M=>{var N=tfe();T(M,N)},E=M=>{var N=nfe();T(M,N)};z(k,M=>{t()?M(S):M(E,!1)})}var R=A(_,2);let C;R.__click=c;var I=w(R);{var D=M=>{var N=Tr("â");T(M,N)},Q=M=>{var N=Tr("â");T(M,N)};z(I,M=>{u(o)==="asc"?M(D):M(Q,!1)})}Y(()=>{h=Ue(d,1,"prop-chip-wrapper svelte-1fxao9p",null,h,{hidden:!t(),dragging:r(),shifting:i()!==null}),f=gn(d,"",f,{transform:u(a)}),g=Ue(p,1,"drag-handle svelte-1fxao9p",null,g,{sorted:u(s)}),v=Ue(m,1,"prop-chip svelte-1fxao9p",null,v,{sorted:u(s)}),Pt(m,"title",e.label),J(O,e.label),x=Ue(_,1,"visibility-btn svelte-1fxao9p",null,x,{hidden:!t(),sorted:u(s)}),Pt(_,"title",t()?"Hide from list":"Show in list"),C=Ue(R,1,"sort-btn svelte-1fxao9p",null,C,{active:u(s)}),Pt(R,"title",u(s)?`Sorted ${u(o)}ending - click to toggle`:"Sort by this field")}),T(n,d),ct()}yt(["pointerdown","click","mousedown"]);var sfe=P('<div class="deck-toolbar svelte-b9o5ej"><button class="toolbar-btn new-note-btn svelte-b9o5ej" type="button" title="Create new note">+ New</button> <!> <button class="toolbar-btn add-prop-btn svelte-b9o5ej" type="button" title="Add property">+ Add Prop</button></div>');function ofe(n,e){lt(e,!0);let t=j(null),r=j(null),i=j(null),s=j(0),o=j(0),a=new m0,l=j(null);function c(_){if(u(t)===null||u(r)===null||_===u(t)||u(t)===u(r))return null;const x=a.get(_);if(!x)return null;let k;if(u(r)>u(t))if(_>u(t)&&_<=u(r))k=_-1;else return null;else if(_>=u(r)&&_<u(t))k=_+1;else return null;const S=a.get(k);return S?{x:S.left-x.left,y:S.top-x.top}:null}function d(_,x){if(_.button!==0)return;const k=_.currentTarget,S=k.closest(".prop-chip-wrapper");if(!S)return;_.preventDefault(),_.stopPropagation();const E=S.closest(".deck-toolbar");if(E){const I=E.querySelectorAll(".prop-chip-wrapper");a.clear(),I.forEach((D,Q)=>{a.set(Q,D.getBoundingClientRect())})}b(t,x,!0),b(r,x,!0);const R=S.getBoundingClientRect();b(s,_.clientX-R.left),b(o,_.clientY-R.top);const C=S.cloneNode(!0);C.classList.add("drag-ghost"),C.style.cssText=`
      position: fixed;
      pointer-events: none;
      z-index: 10000;
      width: ${S.offsetWidth}px;
      top: ${R.top}px;
      left: ${R.left}px;
      opacity: 0.95;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transform: scale(1.02);
      border-radius: 1rem;
    `,document.body.appendChild(C),b(i,C,!0),b(l,_.pointerId,!0),k.setPointerCapture(_.pointerId),document.addEventListener("pointermove",h),document.addEventListener("pointerup",f),document.addEventListener("pointercancel",f)}function h(_){if(u(t)===null||!u(i)||_.pointerId!==u(l))return;u(i).style.left=`${_.clientX-u(s)}px`,u(i).style.top=`${_.clientY-u(o)}px`;const x=_.clientX,k=_.clientY;let E=u(t),R=1/0;a.forEach((C,I)=>{const D=C.left+C.width/2,Q=C.top+C.height/2,M=Math.sqrt(Math.pow(x-D,2)+Math.pow(k-Q,2));M<R&&(R=M,E=I)}),b(r,E,!0)}function f(_){if(_.pointerId===u(l)){if(p(),u(t)!==null&&u(r)!==null&&u(t)!==u(r)&&e.onReorder){const x=[...e.columns],[k]=x.splice(u(t),1);x.splice(u(r),0,k),e.onReorder(x)}b(t,null),b(r,null),a.clear(),b(l,null)}}function p(){document.removeEventListener("pointermove",h),document.removeEventListener("pointerup",f),document.removeEventListener("pointercancel",f),u(i)&&(u(i).remove(),b(i,null))}Oo(()=>{p()});function g(_){if(_.label)return _.label;const x=g0.find(S=>S.name===_.field||S.name===`flint_${_.field}`||_.field===S.name.replace("flint_",""));if(x)return x.label;const k=e.availableFields.find(S=>S.name===_.field);return k?k.label:_.field.replace(/^flint_/,"").replace(/_/g," ")}var m=sfe(),v=w(m);v.__click=_=>{_.preventDefault(),_.stopPropagation(),e.onNewNote()},v.__mousedown=_=>_.stopPropagation();var y=A(v,2);Tt(y,19,()=>e.columns,_=>_.field,(_,x,k)=>{{let S=le(()=>g(u(x))),E=le(()=>u(x).visible!==!1),R=le(()=>u(t)===u(k)),C=le(()=>c(u(k)));ife(_,{get field(){return u(x).field},get label(){return u(S)},get visible(){return u(E)},get sort(){return e.sort},onClick:I=>{const Q=I.currentTarget.getBoundingClientRect();e.onPropClick(u(x).field,{top:Q.bottom+4,left:Q.left})},get onVisibilityToggle(){return e.onVisibilityToggle},get onSort(){return e.onSort},get isDragging(){return u(R)},get shiftOffset(){return u(C)},onDragHandlePointerDown:I=>d(I,u(k))})}});var O=A(y,2);O.__click=function(..._){e.onAddProp?.apply(this,_)},T(n,m),ct()}yt(["click","mousedown"]);var afe=P('<input type="text"/>');function lfe(n,e){lt(e,!0);let t=et(e,"placeholder",3,""),r=et(e,"disabled",3,!1),i=et(e,"class",3,""),s=et(e,"maxWidth",3,"200px"),o=j(Qt(e.value??""));tt(()=>{b(o,e.value??"",!0)});function a(){const h=u(o).trim();e.onChange(h||null)}function l(h){h.key==="Enter"&&(h.preventDefault(),h.currentTarget.blur())}var c=afe();c.__keydown=l;let d;Y(()=>{Ue(c,1,`string-input ${i()??""}`,"svelte-yke7wu"),c.disabled=r(),Pt(c,"placeholder",t()),d=gn(c,"",d,{"max-width":s()})}),It("blur",c,a),Un(c,()=>u(o),h=>b(o,h)),T(n,c),ct()}yt(["keydown"]);var cfe=P('<input type="number"/>');function ufe(n,e){lt(e,!0);let t=et(e,"placeholder",3,""),r=et(e,"disabled",3,!1),i=et(e,"class",3,""),s=j(Qt(e.value?.toString()??""));tt(()=>{b(s,e.value?.toString()??"",!0)});function o(){const c=u(s).trim();if(c==="")e.onChange(null);else{const d=Number(c);isNaN(d)||e.onChange(d)}}function a(c){c.key==="Enter"&&(c.preventDefault(),c.currentTarget.blur())}var l=cfe();l.__keydown=a,Y(()=>{Ue(l,1,`number-input ${i()??""}`,"svelte-607a96"),l.disabled=r(),Pt(l,"placeholder",t()),Pt(l,"min",e.min),Pt(l,"max",e.max),Pt(l,"step",e.step)}),It("blur",l,o),Un(l,()=>u(s),c=>b(s,c)),T(n,l),ct()}yt(["keydown"]);var dfe=P('<input type="checkbox"/>');function hfe(n,e){lt(e,!0);let t=et(e,"disabled",3,!1),r=et(e,"class",3,"");function i(o){const a=o.currentTarget.checked;e.onChange(a)}var s=dfe();s.__change=i,Y(()=>{Ue(s,1,`boolean-input ${r()??""}`,"svelte-7gi11"),zo(s,e.value),s.disabled=t()}),T(n,s),ct()}yt(["change"]);var ffe=P('<input type="date"/>');function pfe(n,e){lt(e,!0);let t=et(e,"disabled",3,!1),r=et(e,"class",3,"");const i=le(()=>e.value?e.value.split("T")[0]:"");function s(a){const l=a.currentTarget.value;e.onChange(l||null)}var o=ffe();o.__change=s,Y(()=>{Ue(o,1,`date-input ${r()??""}`,"svelte-1wkc8m5"),Tn(o,u(i)),o.disabled=t()}),T(n,o),ct()}yt(["change"]);var gfe=P("<option> </option>"),mfe=P("<select><option> </option><!></select>");function vfe(n,e){lt(e,!0);let t=et(e,"placeholder",3,"â"),r=et(e,"disabled",3,!1),i=et(e,"class",3,"");function s(h){const f=h.currentTarget.value;e.onChange(f||null)}var o=mfe();o.__change=s;var a=w(o),l=w(a);a.value=a.__value="";var c=A(a);Tt(c,16,()=>e.options,h=>h,(h,f)=>{var p=gfe(),g=w(p),m={};Y(()=>{J(g,f),m!==(m=f)&&(p.value=(p.__value=f)??"")}),T(h,p)});var d;jo(o),Y(()=>{Ue(o,1,`select-input ${i()??""}`,"svelte-1omool5"),o.disabled=r(),J(l,t()),d!==(d=e.value??"")&&(o.value=(o.__value=e.value??"")??"",go(o,e.value??""))}),T(n,o),ct()}yt(["change"]);var yfe=P('<button type="button" class="list-item-link svelte-swmz1e"> </button>'),bfe=P('<span class="list-item-text svelte-swmz1e"> </span>'),wfe=P('<div class="list-dropdown-item svelte-swmz1e"><!> <button type="button" class="list-item-remove svelte-swmz1e">&times;</button></div>'),_fe=P('<div class="list-dropdown-empty svelte-swmz1e">No items</div>'),Ofe=P('<div class="list-dropdown-add svelte-swmz1e"><!></div>'),xfe=P('<div class="list-dropdown svelte-swmz1e"><div class="list-dropdown-items svelte-swmz1e"><!></div> <!></div>');function tB(n,e){lt(e,!0);let t=et(e,"clickable",3,!1),r=et(e,"renderItem",3,f=>f),i=j(null);tt(()=>{e.itemsContainerRef?.(u(i))});var s=xfe(),o=w(s),a=w(o);{var l=f=>{var p=Ve(),g=Ie(p);Tt(g,16,()=>e.items,m=>m,(m,v)=>{var y=wfe(),O=w(y);{var _=S=>{var E=yfe();E.__click=()=>e.onItemClick(v);var R=w(E);Y(C=>J(R,C),[()=>r()(v)]),T(S,E)},x=S=>{var E=bfe(),R=w(E);Y(C=>J(R,C),[()=>r()(v)]),T(S,E)};z(O,S=>{t()&&e.onItemClick?S(_):S(x,!1)})}var k=A(O,2);k.__click=()=>e.onRemove(v),T(m,y)}),T(f,p)},c=f=>{var p=_fe();T(f,p)};z(a,f=>{e.items.length>0?f(l):f(c,!1)})}qt(o,f=>b(i,f),()=>u(i));var d=A(o,2);{var h=f=>{var p=Ofe(),g=w(p);ic(g,()=>e.addSection),T(f,p)};z(d,f=>{e.addSection&&f(h)})}Y(()=>gn(s,`top: ${e.position.top??""}px; left: ${e.position.left??""}px;`)),It("mouseenter",s,function(...f){e.onMouseEnter?.apply(this,f)}),It("mouseleave",s,function(...f){e.onMouseLeave?.apply(this,f)}),T(n,s),ct()}yt(["click"]);function v0(n,e,t){const i=window.innerWidth,s=window.innerHeight;let o=0,a=0;return a=n.left,a+e.width>i-8&&(a=Math.max(8,n.right-e.width)),a<8&&(a=8),o=n.bottom+4,o+e.height>s-8&&(o=Math.max(8,n.top-e.height-4)),{top:o,left:a}}function kfe(n,e,t){const i=window.innerWidth,s=window.innerHeight;let o=n.top,a=0;return n.right+e.width+4<=i-8?a=n.right+4:n.left-e.width-4>=8?a=n.left-e.width-4:(a=Math.max(8,Math.min(n.left,i-e.width-8)),o=n.bottom+4),o+e.height>s-8&&(o=Math.max(8,s-e.height-8)),{top:o,left:a}}function iy(n){return Zn(n)?.title||n}function uM(n){if(!n)return"â";try{const e=new Date(n);if(isNaN(e.getTime()))return n;const r=new Date().getTime()-e.getTime(),i=Math.floor(r/(1e3*60*60*24));if(i===0){const s=Math.floor(r/36e5);if(s===0){const o=Math.floor(r/6e4);return o<=1?"just now":`${o}m ago`}return`${s}h ago`}else return i===1?"yesterday":i<7?`${i}d ago`:i<30?`${Math.floor(i/7)}w ago`:i<365?`${Math.floor(i/30)}mo ago`:e.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"2-digit"})}catch{return n}}var Sfe=P('<span class="list-empty svelte-18ubcig">+</span>'),Tfe=P('<span class="list-preview svelte-18ubcig"> </span>'),Afe=P('<span class="list-preview svelte-18ubcig"> </span> <span class="list-count svelte-18ubcig"> </span>',1),Cfe=P('<input type="text" class="list-add-input svelte-18ubcig"/> <button type="button" class="list-add-btn svelte-18ubcig">+</button>',1),Efe=P('<button type="button"><!></button> <!>',1);function nB(n,e){lt(e,!0);let t=et(e,"disabled",3,!1),r=et(e,"addPlaceholder",3,"Add item..."),i=et(e,"class",3,""),s=j(null),o=j(null),a=j(!1),l=j(null),c=null,d=j("");function h(){setTimeout(()=>{u(o)&&(u(o).scrollTop=u(o).scrollHeight)},0)}function f(){if(t()||!u(s))return;c&&(clearTimeout(c),c=null);const C=u(s).getBoundingClientRect();b(l,v0(C,{width:240,height:280}),!0),b(a,!0)}function p(){c&&clearTimeout(c),c=setTimeout(()=>{b(a,!1),b(l,null),c=null},150)}function g(){c&&(clearTimeout(c),c=null)}function m(){const C=u(d).trim();C&&(e.value.includes(C)||(e.onChange([...e.value,C]),h()),b(d,""))}function v(C){e.onChange(e.value.filter(I=>I!==C))}function y(C){C.key==="Enter"&&(C.preventDefault(),m())}var O=Efe(),_=Ie(O),x=w(_);{var k=C=>{var I=Sfe();T(C,I)},S=C=>{var I=Ve(),D=Ie(I);{var Q=N=>{var B=Tfe(),H=w(B);Y(()=>J(H,e.value[0])),T(N,B)},M=N=>{var B=Afe(),H=Ie(B),F=w(H),Z=A(H,2),$=w(Z);Y(()=>{J(F,e.value[0]),J($,`+${e.value.length-1}`)}),T(N,B)};z(D,N=>{e.value.length===1?N(Q):N(M,!1)},!0)}T(C,I)};z(x,C=>{e.value.length===0?C(k):C(S,!1)})}qt(_,C=>b(s,C),()=>u(s));var E=A(_,2);{var R=C=>{tB(C,{get items(){return e.value},get position(){return u(l)},onRemove:v,onMouseEnter:g,onMouseLeave:p,itemsContainerRef:D=>b(o,D,!0),addSection:D=>{var Q=Cfe(),M=Ie(Q);M.__keydown=y;var N=A(M,2);N.__click=m,Y(()=>Pt(M,"placeholder",r())),Un(M,()=>u(d),B=>b(d,B)),T(D,Q)},$$slots:{addSection:!0}})};z(E,C=>{u(a)&&u(l)&&C(R)})}Y(()=>{Ue(_,1,`array-trigger ${i()??""}`,"svelte-18ubcig"),_.disabled=t()}),It("mouseenter",_,f),It("mouseleave",_,p),It("focus",_,f),T(n,O),ct()}yt(["keydown","click"]);var Pfe=P('<input type="text" class="picker-search svelte-1n87a5z" placeholder="Search notes..."/>'),Ife=P('<button type="button"><span class="picker-item-title svelte-1n87a5z"> </span></button>'),Mfe=P('<div class="picker-empty svelte-1n87a5z">No notes found</div>'),Rfe=P('<div class="picker-dropdown svelte-1n87a5z"><!> <div class="picker-results svelte-1n87a5z"><!></div></div>');function rB(n,e){lt(e,!0);let t=et(e,"excludeNoteIds",19,()=>[]),r=et(e,"width",3,280),i=et(e,"multiSelect",3,!1),s=et(e,"searchQuery",3,""),o=et(e,"hideSearchInput",3,!1),a=j(null),l=j(0),c=j(Qt(s()));tt(()=>{b(c,s())}),tt(()=>{u(a)&&!o()&&u(a).focus()});const d=le(()=>cs().filter(I=>!I.archived&&!t().includes(I.id))),h=le(()=>u(c).trim()?u(d).filter(I=>I.title.toLowerCase().includes(u(c).toLowerCase())||I.id.toLowerCase().includes(u(c).toLowerCase())):u(d).slice(0,10));tt(()=>{u(c),b(l,0)});function f(I){const D=I.currentTarget.value;b(c,D,!0),e.onSearchChange?.(D)}function p(I){e.onSelect(I),i()?(b(c,""),e.onSearchChange?.("")):e.onClose()}function g(){u(h).length>0&&u(l)<u(h).length&&p(u(h)[u(l)].id)}function m(I){I.key==="ArrowDown"||I.ctrlKey&&I.key==="n"?(I.preventDefault(),b(l,Math.min(u(l)+1,u(h).length-1),!0)):I.key==="ArrowUp"||I.ctrlKey&&I.key==="p"?(I.preventDefault(),b(l,Math.max(u(l)-1,0),!0)):I.key==="Enter"?(I.preventDefault(),g()):I.key==="Escape"&&(I.preventDefault(),e.onClose())}function v(){setTimeout(()=>{e.onClose()},150)}function y(I){m(I)}var O={handleExternalKeydown:y},_=Rfe(),x=w(_);{var k=I=>{var D=Pfe();D.__input=f,D.__keydown=m,qt(D,Q=>b(a,Q),()=>u(a)),Y(()=>Tn(D,u(c))),It("blur",D,v),T(I,D)};z(x,I=>{o()||I(k)})}var S=A(x,2),E=w(S);{var R=I=>{var D=Ve(),Q=Ie(D);Tt(Q,19,()=>u(h),M=>M.id,(M,N,B)=>{var H=Ife();let F;H.__mousedown=()=>p(u(N).id);var Z=w(H),$=w(Z);Y(()=>{F=Ue(H,1,"picker-item svelte-1n87a5z",null,F,{selected:u(B)===u(l)}),J($,u(N).title||"Untitled")}),It("mouseenter",H,()=>b(l,u(B),!0)),T(M,H)}),T(I,D)},C=I=>{var D=Mfe();T(I,D)};z(E,I=>{u(h).length>0?I(R):I(C,!1)})}return Y(()=>gn(_,`top: ${e.position.top??""}px; left: ${e.position.left??""}px; width: ${r()??""}px;`)),T(n,_),ct(O)}yt(["input","keydown","mousedown"]);var Dfe=P('<button type="button" class="clear-btn svelte-c6vinh">&times;</button>'),Nfe=P('<button type="button" class="notelink-value svelte-c6vinh"> </button> <!>',1),Lfe=P('<input type="text" class="notelink-search svelte-c6vinh" placeholder="+"/>'),Qfe=P("<div><!></div> <!>",1);function iB(n,e){lt(e,!0);let t=et(e,"disabled",3,!1),r=et(e,"class",3,""),i=j(null),s=j(null),o=j(!1),a=j(null),l=j("");const c=le(()=>e.excludeNoteId?[e.excludeNoteId]:[]);function d(){if(t()||!u(i))return;const C=u(i).getBoundingClientRect();b(a,v0(C,{width:280,height:300}),!0),b(o,!0),b(l,"")}function h(){b(o,!1),b(a,null),b(l,"")}function f(C){e.onChange(C),h()}function p(){e.onChange(null)}function g(){e.value&&e.onNoteClick&&e.onNoteClick(e.value)}function m(){d()}function v(){setTimeout(h,150)}function y(C){C.key==="Escape"?(h(),C.currentTarget.blur()):u(o)&&u(s)&&u(s).handleExternalKeydown(C)}var O=Qfe(),_=Ie(O),x=w(_);{var k=C=>{var I=Nfe(),D=Ie(I);D.__click=g;var Q=w(D),M=A(D,2);{var N=B=>{var H=Dfe();H.__click=p,T(B,H)};z(M,B=>{t()||B(N)})}Y(B=>{D.disabled=t(),J(Q,B)},[()=>iy(e.value)]),T(C,I)},S=C=>{var I=Lfe();I.__input=D=>b(l,D.currentTarget.value,!0),I.__keydown=y,Y(()=>{Tn(I,u(l)),I.disabled=t()}),It("focus",I,m),It("blur",I,v),T(C,I)};z(x,C=>{e.value?C(k):C(S,!1)})}qt(_,C=>b(i,C),()=>u(i));var E=A(_,2);{var R=C=>{qt(rB(C,{get position(){return u(a)},get excludeNoteIds(){return u(c)},get searchQuery(){return u(l)},onSearchChange:I=>b(l,I,!0),onSelect:f,onClose:h,hideSearchInput:!0}),I=>b(s,I,!0),()=>u(s))};z(E,C=>{u(o)&&u(a)&&C(R)})}Y(()=>Ue(_,1,`notelink-input-container ${r()??""}`,"svelte-c6vinh")),T(n,O),ct()}yt(["click","input","keydown"]);var $fe=P('<span class="list-empty svelte-33slg0">+</span>'),Ffe=P('<button type="button" class="list-preview-link svelte-33slg0"> </button>'),zfe=P('<button type="button" class="list-preview-link svelte-33slg0"> </button> <span class="list-count svelte-33slg0"> </span>',1),Bfe=P('<input type="text" class="list-add-input svelte-33slg0" placeholder="Add note..."/>'),Ufe=P('<div role="button"><!></div> <!> <!>',1);function sB(n,e){lt(e,!0);let t=et(e,"disabled",3,!1),r=et(e,"class",3,""),i=j(null),s=j(null),o=j(null),a=j(!1),l=j(null),c=null,d=j(!1),h=j(null),f=j("");const p=le(()=>e.excludeNoteId?[e.excludeNoteId,...e.value]:[...e.value]);function g(){setTimeout(()=>{u(s)&&(u(s).scrollTop=u(s).scrollHeight)},0)}function m(){if(t()||!u(i))return;c&&(clearTimeout(c),c=null);const F=u(i).getBoundingClientRect();b(l,v0(F,{width:240,height:280}),!0),b(a,!0)}function v(){c&&clearTimeout(c),c=setTimeout(()=>{b(a,!1),b(l,null),_(),c=null},150)}function y(){c&&(clearTimeout(c),c=null)}function O(F){if(t())return;const Z=F.closest(".list-dropdown");if(Z){const $=Z.getBoundingClientRect();b(h,kfe($,{width:280,height:300}),!0)}else{const $=F.getBoundingClientRect();b(h,v0($,{width:280,height:300}),!0)}b(d,!0),b(f,"")}function _(){b(d,!1),b(h,null),b(f,"")}function x(F){e.value.includes(F)||(e.onChange([...e.value,F]),g()),b(f,"")}function k(F){e.onChange(e.value.filter(Z=>Z!==F))}function S(F){e.onNoteClick?.(F)}function E(F){(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),m())}var R=Ufe(),C=Ie(R);C.__keydown=E;var I=w(C);{var D=F=>{var Z=$fe();T(F,Z)},Q=F=>{var Z=Ve(),$=Ie(Z);{var W=L=>{var q=Ffe();q.__click=oe=>{oe.stopPropagation(),S(e.value[0])};var ue=w(q);Y(oe=>J(ue,oe),[()=>iy(e.value[0])]),T(L,q)},G=L=>{var q=zfe(),ue=Ie(q);ue.__click=De=>{De.stopPropagation(),S(e.value[0])};var oe=w(ue),fe=A(ue,2),be=w(fe);Y(De=>{J(oe,De),J(be,`+${e.value.length-1}`)},[()=>iy(e.value[0])]),T(L,q)};z($,L=>{e.value.length===1?L(W):L(G,!1)},!0)}T(F,Z)};z(I,F=>{e.value.length===0?F(D):F(Q,!1)})}qt(C,F=>b(i,F),()=>u(i));var M=A(C,2);{var N=F=>{tB(F,{get items(){return e.value},get position(){return u(l)},clickable:!0,get renderItem(){return iy},onRemove:k,onItemClick:S,onMouseEnter:y,onMouseLeave:v,itemsContainerRef:$=>b(s,$,!0),addSection:$=>{var W=Bfe();W.__input=G=>b(f,G.currentTarget.value,!0),W.__keydown=G=>{G.key==="Escape"?(_(),G.currentTarget.blur()):u(d)&&u(o)&&u(o).handleExternalKeydown(G)},Y(()=>Tn(W,u(f))),It("focus",W,G=>O(G.currentTarget)),It("blur",W,()=>setTimeout(_,150)),T($,W)},$$slots:{addSection:!0}})};z(M,F=>{u(a)&&u(l)&&F(N)})}var B=A(M,2);{var H=F=>{qt(rB(F,{get position(){return u(h)},get excludeNoteIds(){return u(p)},get searchQuery(){return u(f)},onSearchChange:Z=>b(f,Z,!0),onSelect:x,onClose:_,multiSelect:!0,hideSearchInput:!0}),Z=>b(o,Z,!0),()=>u(o))};z(B,F=>{u(d)&&u(h)&&F(H)})}Y(()=>{Ue(C,1,`notelinks-trigger ${r()??""}`,"svelte-33slg0"),Pt(C,"tabindex",t()?-1:0)}),It("mouseenter",C,m),It("mouseleave",C,v),It("focus",C,m),T(n,R),ct()}yt(["keydown","click","input"]);var jfe=P(`<style>.portal-tooltip {
      position: fixed;
      top: 0;
      left: 0;
      padding: 0.375rem 0.625rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-medium);
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-primary);
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition:
        opacity 0.15s ease,
        visibility 0.15s ease;
      z-index: 99999;
    }
    .portal-tooltip.visible {
      opacity: 1;
      visibility: visible;
    }</style>`),Vfe=P('<span class="tooltip-wrapper svelte-1gc7zqi" role="group"><!></span>');function ur(n,e){lt(e,!0);let t=et(e,"position",3,"top"),r=j(void 0),i=j(void 0);const s=8,o=8;qr(()=>{b(i,document.createElement("div"),!0),u(i).className="portal-tooltip",u(i).textContent=e.text,document.body.appendChild(u(i))}),Oo(()=>{u(i)?.remove()}),tt(()=>{u(i)&&(u(i).textContent=e.text)});function a(){!u(r)||!u(i)||(u(i).classList.add("visible"),requestAnimationFrame(()=>{if(!u(r)||!u(i))return;const h=u(r).getBoundingClientRect(),f=u(i).getBoundingClientRect();let p=0,g=0;t()==="top"?(p=h.top-f.height-s,g=h.left+h.width/2-f.width/2):t()==="bottom"?(p=h.bottom+s,g=h.left+h.width/2-f.width/2):t()==="left"?(p=h.top+h.height/2-f.height/2,g=h.left-f.width-s):t()==="right"&&(p=h.top+h.height/2-f.height/2,g=h.right+s),g=Math.max(o,Math.min(g,window.innerWidth-f.width-o)),p=Math.max(o,Math.min(p,window.innerHeight-f.height-o)),u(i).style.top=`${p}px`,u(i).style.left=`${g}px`}))}function l(){u(i)?.classList.remove("visible")}var c=Vfe();F9("1gc7zqi",h=>{var f=jfe();T(h,f)});var d=w(c);ic(d,()=>e.children),qt(c,h=>b(r,h),()=>u(r)),It("mouseenter",c,a),It("mouseleave",c,l),T(n,c),ct()}var qfe=P("<option> </option>"),Hfe=P('<span class="prop-name svelte-1mgwzid"> </span>'),Zfe=P('<span class="prop-name svelte-1mgwzid"> </span>'),Wfe=P('<option class="out-of-schema"> </option>'),Xfe=P("<option> </option>"),Yfe=P('<select class="prop-inline-select svelte-1mgwzid"><option>-</option><!><!></select>'),Gfe=P('<input type="checkbox" class="prop-inline-checkbox svelte-1mgwzid"/>'),Kfe=P('<input type="date" class="prop-inline-date svelte-1mgwzid"/>'),Jfe=P('<input type="number" class="prop-inline-input svelte-1mgwzid"/>'),epe=P('<input type="text" class="prop-inline-input svelte-1mgwzid"/>'),tpe=P('<span class="prop-value prop-notelink svelte-1mgwzid"> </span>'),npe=P(' <span class="prop-count svelte-1mgwzid"> </span>',1),rpe=P('<span class="prop-value prop-notelinks svelte-1mgwzid"><!></span>'),ipe=P(' <span class="prop-count svelte-1mgwzid"> </span>',1),spe=P('<span class="prop-value prop-array svelte-1mgwzid"><!></span>'),ope=P('<span class="prop-value svelte-1mgwzid"> </span>'),ape=P('<div><!> <span class="prop-divider svelte-1mgwzid"></span> <!></div>'),lpe=P('<div class="note-props svelte-1mgwzid"></div>'),cpe=P('<div role="listitem"><div class="note-display svelte-1mgwzid"><div class="note-title-row svelte-1mgwzid"><div class="type-dropdown-wrapper svelte-1mgwzid"><select class="type-select svelte-1mgwzid"></select> <span class="type-icon-display svelte-1mgwzid"> </span></div> <textarea placeholder="Untitled" rows="1"></textarea> <button class="open-btn svelte-1mgwzid" type="button" title="Open note">Open</button></div> <!></div></div>');function upe(n,e){lt(e,!0);let t=et(e,"autoFocus",3,!1),r=et(e,"isHighlighted",3,!1),i=j(null),s=null;const o=le(yo);function a(){s&&(clearTimeout(s),s=null)}function l(){s&&clearTimeout(s),s=setTimeout(()=>{s=null,u(i)&&!u(i).contains(document.activeElement)&&e.onRowBlur?.()},150)}function c(V){if(V==="title"||V==="type"||V==="created"||V==="updated"||V==="archived"||V==="sourceFormat"||V==="lastOpened"||V.startsWith("review.")||V.startsWith("flint_")||!e.fieldsByType)return!0;const ne=e.fieldsByType.get(e.note.typeId);if(!ne)return!0;const ee=V.startsWith("props.")?V.slice(6):V;return ne.has(ee)}const d=le(()=>e.columns.filter(V=>V.visible!==!1));let h=j(Qt(e.note.title||"")),f=j(null),p=Qt(new Map);function g(){return e.columns.filter(V=>D(V.field))}function m(V){const ne=g();if(ne.length===0)return!1;if(V===null){const ee=ne[0],U=p.get(ee.field);if(U)return U.focus(),!0}else{const ee=ne.findIndex(U=>U.field===V);if(ee>=0&&ee<ne.length-1){const U=ne[ee+1],X=p.get(U.field);if(X)return X.focus(),!0}}return!1}function v(V){const ne=g(),ee=ne.findIndex(U=>U.field===V);if(ee===0)return u(f)?.focus(),!0;if(ee>0){const U=ne[ee-1],X=p.get(U.field);if(X)return X.focus(),!0}return!1}function y(V,ne){V.key==="Tab"?V.shiftKey?v(ne)&&V.preventDefault():m(ne)&&V.preventDefault():V.key==="Enter"&&V.target?.blur()}tt(()=>{t()&&u(f)&&u(f).focus()});async function O(V){const ne=V.target;e.onTypeChange&&await e.onTypeChange(ne.value)}tt(()=>{b(h,e.note.title||"",!0)});function _(){const V=u(h).trim();V!==(e.note.title||"")&&e.onTitleSave?.(V)}function x(V){V.key==="Enter"&&!V.shiftKey?(V.preventDefault(),V.target?.blur()):V.key==="Escape"?(b(h,e.note.title||"",!0),V.target?.blur()):V.key==="Tab"&&!V.shiftKey&&m(null)&&V.preventDefault()}function k(V){return Zn(V)?.title||V}function S(V){if(V==="title")return e.note.title||"";if(V==="type")return e.note.typeName||e.note.typeId;if(V==="created")return E(e.note.created);if(V==="updated")return E(e.note.updated);if(V==="archived")return e.note.archived?"Yes":"No";if(V==="sourceFormat")return e.note.sourceFormat||"markdown";if(V==="lastOpened")return e.note.lastOpened?E(e.note.lastOpened):"";if(V==="review.enabled")return e.note.review?.enabled?"Yes":"No";if(V==="review.status")return e.note.review?.status||"";if(V==="review.lastReviewed")return e.note.review?.lastReviewed?E(e.note.review.lastReviewed):"";if(V==="review.reviewCount")return String(e.note.review?.reviewCount??0);const ne=V.startsWith("props.")?V.slice(6):V,ee=e.note.props[ne];if(ee==null)return"";const U=R(V);return U==="notelink"&&typeof ee=="string"?k(ee):U==="notelinks"&&Array.isArray(ee)?ee.map(X=>k(String(X))).join(", "):Array.isArray(ee)?ee.join(", "):String(ee)}function E(V){if(!V)return"";try{const ne=new Date(V);return isNaN(ne.getTime())?V:ne.toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return V}}function R(V){if(V==="title"||V==="type")return"system";if(V==="created"||V==="updated"||V==="lastOpened")return"date";if(V==="archived"||V==="review.enabled")return"boolean";if(V==="sourceFormat"||V==="review.status")return"select";if(V==="review.lastReviewed")return"date";if(V==="review.reviewCount")return"number";const ne=V.startsWith("props.")?V.slice(6):V;return e.schemaFields.get(ne)?.type??"unknown"}function C(V){if(V==="sourceFormat")return["markdown","pdf","epub","webpage","deck"];if(V==="review.status")return["active","retired"];const ne=V.startsWith("props.")?V.slice(6):V;return e.schemaFields.get(ne)?.options??[]}function I(V){return V.label?V.label:V.field.replace(/^props\./,"").replace(/_/g," ")}function D(V){return!(V==="type"||V==="created"||V==="updated"||V==="archived"||V==="sourceFormat"||V==="lastOpened"||V.startsWith("review."))}function Q(V){if(V==="title")return e.note.title||"";if(V==="type")return e.note.typeId;if(V==="created")return e.note.created;if(V==="updated")return e.note.updated;if(V==="archived")return e.note.archived;if(V==="sourceFormat")return e.note.sourceFormat||"markdown";if(V==="lastOpened")return e.note.lastOpened;if(V==="review.enabled")return e.note.review?.enabled??!1;if(V==="review.status")return e.note.review?.status;if(V==="review.lastReviewed")return e.note.review?.lastReviewed;if(V==="review.reviewCount")return e.note.review?.reviewCount??0;const ne=V.startsWith("props.")?V.slice(6):V;return e.note.props[ne]??""}function M(V,ne){e.onFieldSave?.(V,ne)}function N(V){const ne=V.startsWith("props.")?V.slice(6):V;return e.schemaFields.get(ne)}function B(V){if(!V.startsWith("props."))return!1;const ne=N(V);if(!ne)return!1;const ee=Q(V),U=ne.constraints;if(ne.required&&(ee==null||ee===""||Array.isArray(ee)&&ee.length===0))return!0;if(ee==null||ee==="")return!1;if(U){if(ne.type==="number"&&typeof ee=="number"&&(U.min!==void 0&&ee<U.min||U.max!==void 0&&ee>U.max)||ne.type==="array"&&Array.isArray(ee)&&(U.min!==void 0&&ee.length<U.min||U.max!==void 0&&ee.length>U.max)||ne.type==="notelinks"&&Array.isArray(ee)&&(U.min!==void 0&&ee.length<U.min||U.max!==void 0&&ee.length>U.max))return!0;if(ne.type==="string"&&typeof ee=="string"&&U.pattern)try{if(!new RegExp(U.pattern).test(ee))return!0}catch{}if(ne.type==="select"&&U.options&&!U.options.includes(String(ee)))return!0}return!1}function H(V){if(!V.startsWith("props."))return null;const ne=N(V);if(!ne)return null;const ee=Q(V),U=ne.constraints;if(ne.required&&(ee==null||ee===""||Array.isArray(ee)&&ee.length===0))return"This field is required";if(ee==null||ee==="")return null;if(U){if(ne.type==="number"&&typeof ee=="number"){if(U.min!==void 0&&ee<U.min)return`Value must be at least ${U.min}`;if(U.max!==void 0&&ee>U.max)return`Value must be at most ${U.max}`}if(ne.type==="array"&&Array.isArray(ee)){if(U.min!==void 0&&ee.length<U.min)return`Must have at least ${U.min} item${U.min===1?"":"s"}`;if(U.max!==void 0&&ee.length>U.max)return`Must have at most ${U.max} item${U.max===1?"":"s"}`}if(ne.type==="notelinks"&&Array.isArray(ee)){if(U.min!==void 0&&ee.length<U.min)return`Must have at least ${U.min} link${U.min===1?"":"s"}`;if(U.max!==void 0&&ee.length>U.max)return`Must have at most ${U.max} link${U.max===1?"":"s"}`}if(ne.type==="string"&&typeof ee=="string"&&U.pattern)try{if(!new RegExp(U.pattern).test(ee))return`Value must match pattern: ${U.pattern}`}catch{}if(ne.type==="select"&&U.options&&!U.options.includes(String(ee)))return`Value must be one of: ${U.options.join(", ")}`}return null}function F(V,ne){return p.set(ne,V),{destroy(){p.delete(ne)}}}var Z=cpe();let $;Z.__focusin=a,Z.__focusout=l;var W=w(Z),G=w(W),L=w(G);L.__mousedown=V=>V.stopPropagation();var q=w(L);q.__change=O,Tt(q,21,()=>u(o),V=>V.id,(V,ne)=>{var ee=qfe(),U=w(ee),X={};Y(()=>{J(U,`${(u(ne).icon||"ð")??""} ${u(ne).name??""}`),X!==(X=u(ne).id)&&(ee.value=(ee.__value=u(ne).id)??"")}),T(V,ee)});var ue;jo(q);var oe=A(q,2),fe=w(oe),be=A(L,2);let De;be.__keydown=x,be.__mousedown=V=>V.stopPropagation(),qt(be,V=>b(f,V),()=>u(f));var Le=A(be,2);Le.__click=()=>e.onOpen?.(),Le.__mousedown=V=>V.stopPropagation();var he=A(G,2);{var se=V=>{var ne=lpe();Tt(ne,21,()=>u(d),ee=>ee.field,(ee,U)=>{const X=le(()=>R(u(U).field)),ie=le(()=>Q(u(U).field)),ye=le(()=>C(u(U).field)),pe=le(()=>D(u(U).field)),de=le(()=>c(u(U).field)),we=le(()=>B(u(U).field)),me=le(()=>u(we)?H(u(U).field):null);var Ee=ape();let _e;Ee.__mousedown=Me=>Me.stopPropagation(),Ee.__click=Me=>Me.stopPropagation(),Ee.__keydown=Me=>Me.stopPropagation();var Ae=w(Ee);{var ze=Me=>{ur(Me,{get text(){return u(me)},position:"bottom",children:(Pe,ae)=>{var te=Hfe(),re=w(te);Y(ve=>J(re,ve),[()=>I(u(U))]),T(Pe,te)},$$slots:{default:!0}})},Be=Me=>{var Pe=Zfe(),ae=w(Pe);Y(te=>J(ae,te),[()=>I(u(U))]),T(Me,Pe)};z(Ae,Me=>{u(me)?Me(ze):Me(Be,!1)})}var Se=A(Ae,4);{var Re=Me=>{const Pe=le(()=>String(u(ie)||"")),ae=le(()=>u(Pe)&&!u(ye).includes(u(Pe)));var te=Yfe();te.__change=Oe=>M(u(U).field,Oe.currentTarget.value),te.__keydown=Oe=>y(Oe,u(U).field);var re=w(te);re.value=re.__value="";var ve=A(re);{var Te=Oe=>{var Qe=Wfe(),We=w(Qe),st={};Y(()=>{J(We,u(Pe)),st!==(st=u(Pe))&&(Qe.value=(Qe.__value=u(Pe))??"")}),T(Oe,Qe)};z(ve,Oe=>{u(ae)&&Oe(Te)})}var Ne=A(ve);Tt(Ne,16,()=>u(ye),Oe=>Oe,(Oe,Qe)=>{var We=Xfe(),st=w(We),it={};Y(()=>{J(st,Qe),it!==(it=Qe)&&(We.value=(We.__value=Qe)??"")}),T(Oe,We)}),Hc(te,(Oe,Qe)=>F?.(Oe,Qe),()=>u(U).field);var ce;jo(te),Y(()=>{ce!==(ce=u(Pe))&&(te.value=(te.__value=u(Pe))??"",go(te,u(Pe)))}),T(Me,te)},He=Me=>{var Pe=Ve(),ae=Ie(Pe);{var te=ve=>{var Te=Gfe();Te.__change=Ne=>M(u(U).field,Ne.currentTarget.checked),Te.__keydown=Ne=>y(Ne,u(U).field),Hc(Te,(Ne,ce)=>F?.(Ne,ce),()=>u(U).field),Y(Ne=>zo(Te,Ne),[()=>!!u(ie)]),T(ve,Te)},re=ve=>{var Te=Ve(),Ne=Ie(Te);{var ce=Qe=>{var We=Kfe();We.__change=st=>M(u(U).field,st.currentTarget.value),We.__keydown=st=>y(st,u(U).field),Hc(We,(st,it)=>F?.(st,it),()=>u(U).field),Y(st=>Tn(We,st),[()=>u(ie)?String(u(ie)).split("T")[0]:""]),T(Qe,We)},Oe=Qe=>{var We=Ve(),st=Ie(We);{var it=bt=>{var xt=Jfe();xt.__keydown=mt=>y(mt,u(U).field),Hc(xt,(mt,Ge)=>F?.(mt,Ge),()=>u(U).field),Y(()=>Tn(xt,u(ie)??"")),It("blur",xt,mt=>{const Ge=mt.currentTarget.value;M(u(U).field,Ge?Number(Ge):null)}),T(bt,xt)},Ct=bt=>{var xt=Ve(),mt=Ie(xt);{var Ge=ft=>{iB(ft,{get value(){return u(ie)},onChange:at=>M(u(U).field,at),get excludeNoteId(){return e.note.id},class:"prop-inline-notelink"})},Xe=ft=>{var at=Ve(),pt=Ie(at);{var dt=wt=>{{let Rt=le(()=>Array.isArray(u(ie))?u(ie):[]);sB(wt,{get value(){return u(Rt)},onChange:Et=>M(u(U).field,Et),get excludeNoteId(){return e.note.id},class:"prop-inline-notelinks"})}},_t=wt=>{var Rt=Ve(),Et=Ie(Rt);{var $t=Kt=>{{let Zt=le(()=>Array.isArray(u(ie))?u(ie):[]);nB(Kt,{get value(){return u(Zt)},onChange:Nt=>M(u(U).field,Nt),class:"prop-inline-array"})}},jt=Kt=>{var Zt=Ve(),Nt=Ie(Zt);{var Yt=Je=>{var ge=epe();ge.__keydown=Ze=>y(Ze,u(U).field),Hc(ge,(Ze,ht)=>F?.(Ze,ht),()=>u(U).field),Y(Ze=>Tn(ge,Ze),[()=>String(u(ie)||"")]),It("blur",ge,Ze=>M(u(U).field,Ze.currentTarget.value)),T(Je,ge)},ln=Je=>{var ge=Ve(),Ze=Ie(ge);{var ht=mn=>{var yn=tpe(),Yn=w(yn);Y(vr=>J(Yn,vr),[()=>k(String(u(ie)))]),T(mn,yn)},Jt=mn=>{var yn=Ve(),Yn=Ie(yn);{var vr=pi=>{var Vn=rpe(),To=w(Vn);{var Ao=Hr=>{var gi=Tr();Y(Us=>J(gi,Us),[()=>k(String(u(ie)[0]))]),T(Hr,gi)},Ll=Hr=>{var gi=npe(),Us=Ie(gi),Xa=A(Us),Mc=w(Xa);Y(js=>{J(Us,`${js??""} `),J(Mc,`+${u(ie).length-1}`)},[()=>k(String(u(ie)[0]))]),T(Hr,gi)};z(To,Hr=>{u(ie).length===1?Hr(Ao):Hr(Ll,!1)})}T(pi,Vn)},Wi=pi=>{var Vn=Ve(),To=Ie(Vn);{var Ao=Hr=>{var gi=spe(),Us=w(gi);{var Xa=js=>{var Jo=Tr();Y(()=>J(Jo,u(ie)[0])),T(js,Jo)},Mc=js=>{var Jo=ipe(),hf=Ie(Jo),bm=A(hf),wm=w(bm);Y(()=>{J(hf,`${u(ie)[0]??""} `),J(wm,`+${u(ie).length-1}`)}),T(js,Jo)};z(Us,js=>{u(ie).length===1?js(Xa):js(Mc,!1)})}T(Hr,gi)},Ll=Hr=>{var gi=ope(),Us=w(gi);Y(Xa=>J(Us,Xa),[()=>S(u(U).field)||"-"]),T(Hr,gi)};z(To,Hr=>{u(X)==="array"&&Array.isArray(u(ie))&&u(ie).length>0?Hr(Ao):Hr(Ll,!1)},!0)}T(pi,Vn)};z(Yn,pi=>{u(X)==="notelinks"&&Array.isArray(u(ie))&&u(ie).length>0?pi(vr):pi(Wi,!1)},!0)}T(mn,yn)};z(Ze,mn=>{u(X)==="notelink"&&u(ie)?mn(ht):mn(Jt,!1)},!0)}T(Je,ge)};z(Nt,Je=>{u(pe)?Je(Yt):Je(ln,!1)},!0)}T(Kt,Zt)};z(Et,Kt=>{u(pe)&&u(X)==="array"?Kt($t):Kt(jt,!1)},!0)}T(wt,Rt)};z(pt,wt=>{u(pe)&&u(X)==="notelinks"?wt(dt):wt(_t,!1)},!0)}T(ft,at)};z(mt,ft=>{u(pe)&&u(X)==="notelink"?ft(Ge):ft(Xe,!1)},!0)}T(bt,xt)};z(st,bt=>{u(pe)&&u(X)==="number"?bt(it):bt(Ct,!1)},!0)}T(Qe,We)};z(Ne,Qe=>{u(pe)&&u(X)==="date"?Qe(ce):Qe(Oe,!1)},!0)}T(ve,Te)};z(ae,ve=>{u(pe)&&u(X)==="boolean"?ve(te):ve(re,!1)},!0)}T(Me,Pe)};z(Se,Me=>{u(pe)&&u(X)==="select"&&u(ye).length>0?Me(Re):Me(He,!1)})}Y(()=>_e=Ue(Ee,1,"prop-chip-inline svelte-1mgwzid",null,_e,{muted:!u(de),invalid:u(we)})),T(ee,Ee)}),T(V,ne)};z(he,V=>{u(d).length>0&&V(se)})}qt(Z,V=>b(i,V),()=>u(i)),Y(()=>{$=Ue(Z,1,"note-list-item svelte-1mgwzid",null,$,{highlighted:r()}),Pt(q,"title",e.note.typeName),ue!==(ue=e.note.typeId)&&(q.value=(q.__value=e.note.typeId)??"",go(q,e.note.typeId)),J(fe,e.note.typeIcon||"ð"),De=Ue(be,1,"title-input svelte-1mgwzid",null,De,{untitled:!u(h)})}),It("blur",be,_),Un(be,()=>u(h),V=>b(h,V)),T(n,Z),ct()}yt(["focusin","focusout","mousedown","change","keydown","click"]);var dpe=P('<div class="no-results svelte-1hqpt9h"> </div>'),hpe=P('<span class="field-badge system svelte-1hqpt9h">system</span>'),fpe=P('<span class="field-badge svelte-1hqpt9h"> </span>'),ppe=P('<button type="button"><span class="type-icon svelte-1hqpt9h"> </span> <span class="field-label svelte-1hqpt9h"> </span> <!></button>'),gpe=P('<div class="prop-picker-dialog svelte-1hqpt9h" role="dialog" aria-label="Add property"><div class="search-container svelte-1hqpt9h"><input type="text" class="search-input svelte-1hqpt9h" placeholder="Search fields..."/></div> <div class="fields-list svelte-1hqpt9h"><!></div></div>');function mpe(n,e){lt(e,!0);let t=j(null),r=j(""),i=j(null),s=j(0);const o=le(()=>{const m=e.fields.filter(O=>!O.isSystem),v=[...g0,...m],y=new Set(e.excludeFields);return v.filter(O=>!y.has(O.name))}),a=le(()=>{if(!u(r).trim())return u(o);const m=u(r).toLowerCase().trim();return u(o).filter(v=>v.name.toLowerCase().includes(m)||v.label.toLowerCase().includes(m)||v.description?.toLowerCase().includes(m))});function l(m){u(t)&&!u(t).contains(m.target)&&e.onClose()}tt(()=>{if(e.isOpen)return document.addEventListener("click",l,!0),()=>{document.removeEventListener("click",l,!0)}}),tt(()=>{e.isOpen&&(b(r,""),b(s,0),setTimeout(()=>{u(i)?.focus()},50))}),tt(()=>{u(r),b(s,0)});function c(m){b(r,""),e.onSelect(m),e.onClose()}function d(m){if(m.key==="Escape"){e.onClose(),m.preventDefault(),m.stopPropagation();return}if(m.key==="Enter"){m.preventDefault();const v=u(a)[u(s)];v&&c(v.name);return}if(m.ctrlKey&&m.key==="n"||m.key==="ArrowDown"){m.preventDefault(),u(a).length>0&&b(s,(u(s)+1)%u(a).length);return}if(m.ctrlKey&&m.key==="p"||m.key==="ArrowUp"){m.preventDefault(),u(a).length>0&&b(s,(u(s)-1+u(a).length)%u(a).length);return}}function h(m){return{string:"T",number:"#",boolean:"?",date:"D",array:"[]",select:"S",system:"*"}[m]||"T"}var f=Ve(),p=Ie(f);{var g=m=>{var v=gpe();v.__mousedown=E=>{E.target.tagName!=="INPUT"&&E.preventDefault(),E.stopPropagation()},v.__click=E=>E.stopPropagation();var y=w(v),O=w(y);O.__keydown=d,qt(O,E=>b(i,E),()=>u(i));var _=A(y,2),x=w(_);{var k=E=>{var R=dpe(),C=w(R);Y(()=>J(C,u(r)?"No matching fields":"No fields available")),T(E,R)},S=E=>{var R=Ve(),C=Ie(R);Tt(C,19,()=>u(a),I=>I.name,(I,D,Q)=>{var M=ppe();let N;M.__click=()=>c(u(D).name);var B=w(M),H=w(B),F=A(B,2),Z=w(F),$=A(F,2);{var W=L=>{var q=hpe();T(L,q)},G=L=>{var q=Ve(),ue=Ie(q);{var oe=fe=>{var be=fpe(),De=w(be);Y(()=>J(De,u(D).type)),T(fe,be)};z(ue,fe=>{u(D).type!=="system"&&fe(oe)},!0)}T(L,q)};z($,L=>{u(D).isSystem?L(W):L(G,!1)})}Y(L=>{N=Ue(M,1,"field-option svelte-1hqpt9h",null,N,{highlighted:u(Q)===u(s)}),Pt(B,"title",u(D).type),J(H,L),J(Z,u(D).label)},[()=>h(u(D).type)]),T(I,M)}),T(E,R)};z(x,E=>{u(a).length===0?E(k):E(S,!1)})}qt(v,E=>b(t,E),()=>u(t)),Y(()=>gn(v,`top: ${e.position.top??""}px; left: ${e.position.left??""}px;`)),Un(O,()=>u(r),E=>b(r,E)),T(m,v)};z(p,m=>{e.isOpen&&m(g)})}T(n,f),ct()}yt(["mousedown","click","keydown"]);var vpe=P("<option> </option>"),ype=P('<input type="text" class="value-input svelte-1igexw2" placeholder="Enter note ID..."/>'),bpe=P('<span class="option-icon svelte-1igexw2"> </span>'),wpe=P('<label class="checkbox-item svelte-1igexw2"><input type="checkbox" class="svelte-1igexw2"/> <!> <span class="checkbox-label svelte-1igexw2"> </span></label>'),_pe=P('<div class="checkbox-list svelte-1igexw2"><label class="checkbox-item svelte-1igexw2"><input type="checkbox" class="svelte-1igexw2"/> <span class="checkbox-label empty-label svelte-1igexw2"></span></label> <!></div>'),Ope=P('<select class="value-input svelte-1igexw2"><option>true</option><option>false</option></select>'),xpe=P("<option> </option>"),kpe=P('<select class="value-input svelte-1igexw2"><option>Select...</option><option></option><!></select>'),Spe=P('<input type="date" class="value-input svelte-1igexw2"/>'),Tpe=P('<input type="number" class="value-input svelte-1igexw2" placeholder="Enter number..."/>'),Ape=P('<input type="text" class="value-input svelte-1igexw2"/>'),Cpe=P('<div class="prop-filter-popup svelte-1igexw2"><div class="header-row svelte-1igexw2"><span class="field-name svelte-1igexw2"> </span> <select class="operator-select svelte-1igexw2"></select> <button class="delete-btn svelte-1igexw2" type="button" title="Remove"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button></div> <div class="value-row svelte-1igexw2"><!></div></div>');function Epe(n,e){lt(e,!0);const t=nb;let r=et(e,"options",19,()=>[]);const i=le(()=>r().length>0?r():e.fieldInfo?.options||[]);let s=j(null);const o=le(()=>e.filter?.value?Array.isArray(e.filter.value)?e.filter.value:e.filter.value?[e.filter.value]:[]:[]),a=le(()=>e.fieldInfo?Uhe(e.fieldInfo.type):["=","!=","LIKE"]),l=le(()=>e.filter?.operator||"="),c=le(()=>Array.isArray(e.filter?.value)?e.filter?.value.join(", "):e.filter?.value||""),d=le(()=>(u(l)==="IN"||u(l)==="NOT IN")&&u(i).length>0);function h(x){u(s)&&!u(s).contains(x.target)&&e.onClose()}tt(()=>{if(e.isOpen){const x=setTimeout(()=>{document.addEventListener("mousedown",h,!0)},10);return()=>{clearTimeout(x),document.removeEventListener("mousedown",h,!0)}}});function f(x){const S=x.target.value;if(e.filter){const E=S==="IN"||S==="NOT IN",R=e.filter.operator==="IN"||e.filter.operator==="NOT IN";let C=e.filter.value;E&&!Array.isArray(e.filter.value)?C=e.filter.value?[e.filter.value]:[]:!E&&R&&Array.isArray(e.filter.value)&&(C=e.filter.value[0]||""),e.onUpdate({...e.filter,operator:S,value:C})}}function p(x){const S=x.target.value;if(e.filter){const R=u(l)==="IN"||u(l)==="NOT IN"?S.split(",").map(C=>C.trim()):S;e.onUpdate({...e.filter,value:R})}}function g(x,k){if(!e.filter)return;let S;k?S=[...u(o),x]:S=u(o).filter(E=>E!==x),e.onUpdate({...e.filter,value:S})}function m(){e.onRemove(),e.onClose()}function v(x){x.key==="Escape"&&(e.onClose(),x.preventDefault(),x.stopPropagation())}var y=Ve(),O=Ie(y);{var _=x=>{var k=Cpe();k.__mousedown=H=>{const F=H.target.tagName;["INPUT","SELECT","OPTION","BUTTON","LABEL"].includes(F)||H.preventDefault(),H.stopPropagation()},k.__click=H=>H.stopPropagation(),k.__keydown=v;var S=w(k),E=w(S),R=w(E),C=A(E,2);C.__change=f,Tt(C,20,()=>u(a),H=>H,(H,F)=>{var Z=vpe(),$=w(Z),W={};Y(G=>{J($,G),W!==(W=F)&&(Z.value=(Z.__value=F)??"")},[()=>jhe(F)]),T(H,Z)});var I;jo(C);var D=A(C,2);D.__click=m;var Q=A(S,2),M=w(Q);{var N=H=>{var F=ype();F.__change=p,Y(()=>Tn(F,u(c))),T(H,F)},B=H=>{var F=Ve(),Z=Ie(F);{var $=G=>{var L=_pe(),q=w(L),ue=w(q);ue.__change=be=>g(t,be.target.checked);var oe=A(ue,2);oe.textContent="<empty>";var fe=A(q,2);Tt(fe,16,()=>u(i),be=>be,(be,De)=>{var Le=wpe(),he=w(Le);he.__change=U=>g(De,U.target.checked);var se=A(he,2);{var V=U=>{var X=bpe(),ie=w(X);Y(()=>J(ie,e.fieldInfo.optionIcons[De]||"")),T(U,X)};z(se,U=>{e.fieldInfo?.optionIcons&&U(V)})}var ne=A(se,2),ee=w(ne);Y(U=>{zo(he,U),J(ee,De)},[()=>u(o).includes(De)]),T(be,Le)}),Y(be=>zo(ue,be),[()=>u(o).includes(t)]),T(G,L)},W=G=>{var L=Ve(),q=Ie(L);{var ue=fe=>{var be=Ope();be.__change=p;var De=w(be);De.value=De.__value="true";var Le=A(De);Le.value=Le.__value="false";var he;jo(be),Y(()=>{he!==(he=u(c))&&(be.value=(be.__value=u(c))??"",go(be,u(c)))}),T(fe,be)},oe=fe=>{var be=Ve(),De=Ie(be);{var Le=se=>{var V=kpe();V.__change=p;var ne=w(V);ne.value=ne.__value="";var ee=A(ne);ee.textContent="<empty>";var U={},X=A(ee);Tt(X,16,()=>u(i),ye=>ye,(ye,pe)=>{var de=xpe(),we=w(de),me={};Y(()=>{J(we,e.fieldInfo?.optionIcons?`${e.fieldInfo.optionIcons[pe]||""} ${pe}`:pe),me!==(me=pe)&&(de.value=(de.__value=pe)??"")}),T(ye,de)});var ie;jo(V),Y(()=>{U!==(U=t)&&(ee.value=(ee.__value=t)??""),ie!==(ie=u(c))&&(V.value=(V.__value=u(c))??"",go(V,u(c)))}),T(se,V)},he=se=>{var V=Ve(),ne=Ie(V);{var ee=X=>{var ie=Spe();ie.__change=p,Y(()=>Tn(ie,u(c))),T(X,ie)},U=X=>{var ie=Ve(),ye=Ie(ie);{var pe=we=>{var me=Tpe();me.__change=p,Y(()=>Tn(me,u(c))),T(we,me)},de=we=>{var me=Ape();me.__change=p,Y(()=>{Tn(me,u(c)),Pt(me,"placeholder",u(l)==="IN"||u(l)==="NOT IN"?"value1, value2, ...":"Enter value...")}),T(we,me)};z(ye,we=>{e.fieldInfo?.type==="number"?we(pe):we(de,!1)},!0)}T(X,ie)};z(ne,X=>{e.fieldInfo?.type==="date"?X(ee):X(U,!1)},!0)}T(se,V)};z(De,se=>{u(i).length>0?se(Le):se(he,!1)},!0)}T(fe,be)};z(q,fe=>{e.fieldInfo?.type==="boolean"?fe(ue):fe(oe,!1)},!0)}T(G,L)};z(Z,G=>{u(d)?G($):G(W,!1)},!0)}T(H,F)};z(M,H=>{e.fieldInfo?.type==="notelink"||e.fieldInfo?.type==="notelinks"?H(N):H(B,!1)})}qt(k,H=>b(s,H),()=>u(s)),Y(()=>{gn(k,`top: ${e.position.top??""}px; left: ${e.position.left??""}px;`),J(R,e.fieldInfo?.label||e.filter.field),I!==(I=u(l))&&(C.value=(C.__value=u(l))??"",go(C,u(l)))}),T(x,k)};z(O,x=>{e.isOpen&&e.filter&&x(_)})}T(n,y),ct()}yt(["mousedown","click","keydown","change"]);var Ppe=kn('<svg class="check-icon svelte-1mgetdc" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>'),Ipe=P('<div><span class="view-item-name svelte-1mgetdc"> </span> <!> <button class="menu-button svelte-1mgetdc" type="button" title="View options"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="12" cy="19" r="2"></circle></svg></button></div>'),Mpe=P('<div class="context-divider svelte-1mgetdc"></div> <button class="context-item danger svelte-1mgetdc" type="button">Delete</button>',1),Rpe=P('<div class="context-menu svelte-1mgetdc"><button class="context-item svelte-1mgetdc" type="button">Duplicate</button> <!></div>'),Dpe=P('<div class="new-view-form svelte-1mgetdc"><input type="text" class="new-view-input svelte-1mgetdc" placeholder="View name..."/></div>'),Npe=P('<button class="new-view-button svelte-1mgetdc" type="button"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> <span>New View</span></button>'),Lpe=P('<div class="dropdown svelte-1mgetdc"><div class="view-list svelte-1mgetdc"></div> <!> <div class="dropdown-divider svelte-1mgetdc"></div> <!></div>'),Qpe=P('<div class="view-switcher svelte-1mgetdc"><div class="view-control svelte-1mgetdc"><input class="view-name-input svelte-1mgetdc" type="text" placeholder="View name..."/> <button class="dropdown-button svelte-1mgetdc" type="button" title="Switch view"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></button></div> <!></div>');function $pe(n,e){lt(e,!0);let t=j(!1),r=j(null),i=j(null),s=j(null),o=j(null),a=j(!1),l=j(""),c=j(null),d=j(null),h=j("");const f=le(()=>e.views[e.activeViewIndex]||e.views[0]);tt(()=>{const $=u(f)?.name||"Default";document.activeElement!==u(d)&&b(h,$,!0)});function p($){const W=$.target;u(i)&&!u(i).contains(W)&&u(r)&&!u(r).contains(W)&&u(d)&&!u(d).contains(W)&&m()}tt(()=>{if(u(t)){const $=setTimeout(()=>{document.addEventListener("mousedown",p,!0)},10);return()=>{clearTimeout($),document.removeEventListener("mousedown",p,!0)}}}),tt(()=>{u(a)&&u(c)&&u(c).focus()});function g(){u(t)?m():b(t,!0)}function m(){b(t,!1),b(s,null),b(o,null),b(a,!1),b(l,"")}function v($){e.onViewChange($),m()}function y(){const $=u(h).trim();$&&$!==u(f)?.name?e.onViewRename(e.activeViewIndex,$):$||b(h,u(f)?.name||"Default",!0)}function O($){$.key==="Enter"?($.preventDefault(),y(),u(d)?.blur()):$.key==="Escape"&&(b(h,u(f)?.name||"Default",!0),u(d)?.blur())}function _($,W){if(W.stopPropagation(),u(s)===$)b(s,null),b(o,null);else{const L=W.currentTarget.getBoundingClientRect();b(o,{top:L.top,left:L.right+4},!0),b(s,$,!0)}}function x($,W){W.stopPropagation(),e.onViewDuplicate($),b(s,null),b(o,null)}function k($,W){W.stopPropagation(),e.views.length>1&&e.onViewDelete($),b(s,null),b(o,null)}function S(){b(a,!0),b(l,""),b(s,null),b(o,null)}function E(){if(!u(a))return;const $=u(l).trim()||"New View";b(a,!1),b(l,""),e.onViewCreate($),m()}function R(){b(a,!1),b(l,"")}function C($){$.key==="Enter"?E():$.key==="Escape"&&R()}function I($){$.key==="Escape"&&(m(),$.preventDefault(),$.stopPropagation())}var D=Qpe(),Q=w(D),M=w(Q);M.__keydown=O,qt(M,$=>b(d,$),()=>u(d));var N=A(M,2);N.__click=g;var B=w(N);let H;qt(N,$=>b(r,$),()=>u(r));var F=A(Q,2);{var Z=$=>{var W=Lpe();W.__keydown=I;var G=w(W);Tt(G,21,()=>e.views,Sl,(be,De,Le)=>{var he=Ipe();let se;he.__click=()=>v(Le),he.__keydown=ie=>{(ie.key==="Enter"||ie.key===" ")&&(ie.preventDefault(),v(Le))};var V=w(he),ne=w(V),ee=A(V,2);{var U=ie=>{var ye=Ppe();T(ie,ye)};z(ee,ie=>{Le===e.activeViewIndex&&ie(U)})}var X=A(ee,2);X.__click=ie=>_(Le,ie),Y(()=>{se=Ue(he,1,"view-item svelte-1mgetdc",null,se,{active:Le===e.activeViewIndex}),J(ne,u(De).name)}),T(be,he)});var L=A(G,2);{var q=be=>{var De=Rpe();De.__click=V=>V.stopPropagation(),De.__keydown=V=>V.stopPropagation();var Le=w(De);Le.__click=V=>x(u(s),V);var he=A(Le,2);{var se=V=>{var ne=Mpe(),ee=A(Ie(ne),2);ee.__click=U=>k(u(s),U),T(V,ne)};z(he,V=>{e.views.length>1&&V(se)})}Y(()=>gn(De,`top: ${u(o).top??""}px; left: ${u(o).left??""}px;`)),T(be,De)};z(L,be=>{u(s)!==null&&u(o)&&be(q)})}var ue=A(L,4);{var oe=be=>{var De=Dpe(),Le=w(De);Le.__keydown=C,qt(Le,he=>b(c,he),()=>u(c)),It("blur",Le,E),Un(Le,()=>u(l),he=>b(l,he)),T(be,De)},fe=be=>{var De=Npe();De.__click=S,T(be,De)};z(ue,be=>{u(a)?be(oe):be(fe,!1)})}qt(W,be=>b(i,be),()=>u(i)),T($,W)};z(F,$=>{u(t)&&$(Z)})}Y(()=>H=Ue(B,0,"chevron svelte-1mgetdc",null,H,{open:u(t)})),It("blur",M,y),Un(M,()=>u(h),$=>b(h,$)),T(n,D),ct()}yt(["keydown","click"]);var Fpe=P('<span class="deck-count svelte-1vqoq0m"> </span>'),zpe=P('<span class="deck-count svelte-1vqoq0m">0 notes</span>'),Bpe=P('<span class="warning-more svelte-1vqoq0m"> </span>'),Upe=P('<div class="validation-warning svelte-1vqoq0m"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1vqoq0m"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> <span class="warning-text svelte-1vqoq0m"> </span> <!></div>'),jpe=P('<div class="deck-empty svelte-1vqoq0m">No notes match this query</div>'),Vpe=P('<div class="note-list svelte-1vqoq0m" role="list"></div> <!>',1),qpe=P('<div class="deck-widget svelte-1vqoq0m"><div class="deck-header svelte-1vqoq0m"><!> <!></div> <!> <!> <!> <!> <div class="deck-content svelte-1vqoq0m"><!></div></div>');function oB(n,e){lt(e,!0);let t=et(e,"validationWarnings",19,()=>[]),r=le(()=>e.config);function i(te){e.onConfigChange(te)}let s=j(null),o=j(0),a=j(!1),l=j(Qt({top:0,left:0})),c=j(!1),d=j(Qt({top:0,left:0})),h=j(null),f=j(null);const p=le(()=>Wp(u(r))),g=le(()=>{const te=new Set,re=[];if(u(p).columns&&u(p).columns.length>0)for(const ve of u(p).columns){const Te=aM(ve);te.has(Te.field)||(te.add(Te.field),re.push(Te))}for(const ve of u(p).filters)te.has(ve.field)||(te.add(ve.field),re.push(aM({field:ve.field})));return re}),m=le(()=>{const te=u(p).filters.find(Te=>Te.field==="type");if(!te)return[];let re;if(Array.isArray(te.value))re=te.value;else if(typeof te.value=="string")re=[te.value];else return[];const ve=yo();return re.map(Te=>{const Ne=ve.find(Oe=>Oe.id===Te);return Ne?Ne.id:ve.find(Oe=>Oe.name===Te)?.id||null}).filter(Te=>Te!==null)}),v=le(()=>u(m).length>0?u(m)[0]:null),y=le(()=>u(r).pageSize||Th),O=le(()=>u(o)*u(y)),_=le(yo),x=le(()=>u(_).map(te=>te.name)),k=le(()=>{const te={};for(const re of u(_))re.icon&&(te[re.name]=re.icon);return te}),S=le(()=>{const te=new Map,re=iu(),ve=u(m).length>0?u(m):Object.keys(re);for(const Te of ve){const Ne=re[Te];if(Ne?.properties)for(const ce of Ne.properties)te.has(ce.name)||te.set(ce.name,{name:ce.name,type:ce.type,options:ce.constraints?.options,required:ce.required,constraints:ce.constraints})}return te}),E=le(()=>{const te=new Map,re=iu(),ve=u(m).length>0?u(m):Object.keys(re);for(const Te of ve){const Ne=re[Te];if(Ne?.properties){const ce=new Set;for(const Oe of Ne.properties)ce.add(Oe.name);te.set(Te,ce)}}return te}),R=le(()=>{const te=Object.values(RC());return Xhe(te,iu(),u(m))}),C=le(()=>{const te=u(f),re=u(p).filters;let ve;if(te){const Te=re.findIndex(Ne=>Ne.field===te.field);Te>=0?(ve=[...re],ve[Te]=te):ve=[...re,te]}else ve=re;return{filters:ve,sort:u(p).sort,columns:u(p).columns,pageSize:u(r).pageSize||Th}}),I=le(()=>{const te=Object.values(RC());return Jz(u(C),te,iu(),{offset:u(O)})}),D=le(()=>u(I).notes),Q=le(()=>u(I).total),M=le(()=>Math.max(1,Math.ceil(u(Q)/u(y))));let N=j("");tt(()=>{const te=JSON.stringify(u(C));te!==u(N)&&(b(N,te,!0),b(o,0))});async function B(){const te=u(v)||"type-note",re={};for(const Te of u(p).filters){const Ne=!Te.operator||Te.operator==="=",ce=typeof Te.value=="string",Oe=Te.field.startsWith("props."),Qe=Te.value===nb;if(Ne&&ce&&Oe&&!Qe){const We=Te.field.slice(6);re[We]=Te.value}}const ve=await zs({title:"",content:"",type:te});Object.keys(re).length>0&&zC(ve,re),b(s,ve,!0)}function H(te,re,ve){const Te=Zn(te);if(!Te)return;const Ne=re.startsWith("props.")?re.slice(6):re,ce={...Te.props,[Ne]:ve};zC(te,ce)}function F(te,re){const ve=Zn(te);!ve||re===ve.title||dl(te,{title:re})}function Z(te,re){const ve=Zn(te);!ve||re===ve.type||dl(te,{type:re})}const $=le(()=>{if(!u(h))return null;if(u(f)&&u(f).field===u(h))return u(f);const te=u(p).filters.find(re=>re.field===u(h));return te||{field:u(h),operator:"=",value:""}}),W=le(()=>{if(!u(h))return null;if(u(h)==="type"){const ve=g0.find(Te=>Te.name==="type");return ve&&u(x).length>0?{...ve,options:u(x),optionIcons:u(k)}:ve||null}const te=u(R).find(ve=>ve.name===u(h));if(te)return te;const re=g0.find(ve=>ve.name===u(h));return re||{name:u(h),label:u(h).replace(/^props\./,"").replace(/_/g," "),type:"string",isSystem:!1}});function G(te,re){b(h,te,!0),b(d,re,!0),b(c,!0)}function L(te){b(f,te,!0)}function q(){const te=u(f);if(!te)return;const re=u(p).filters,ve=re.findIndex(Ne=>Ne.field===te.field);let Te;ve>=0?(Te=[...re],Te[ve]=te):Te=[...re,te],b(f,null),setTimeout(()=>{De({filters:Te})},0)}function ue(){if(!u(h))return;b(f,null);const te=u(g).filter(ve=>ve.field!==u(h)),re=u(p).filters.filter(ve=>ve.field!==u(h));b(c,!1),b(h,null),setTimeout(()=>{De({columns:te,filters:re})},0)}function oe(te){const ve=te.currentTarget.getBoundingClientRect();b(l,{top:ve.bottom+4,left:ve.left},!0),b(a,!0)}function fe(te){const re={field:te},ve=[...u(g),re];setTimeout(()=>{De({columns:ve})},0)}const be=le(()=>u(g).map(te=>te.field));function De(te){const re=[...u(r).views||[]],ve=u(r).activeView||0;if(re[ve])re[ve]={...re[ve],...te},i({...u(r),views:re});else{const Ne={...Wp(u(r)),...te};i({...u(r),views:[Ne],activeView:0})}}function Le(te){b(f,null),i({...u(r),activeView:te})}function he(te){const re=qhe(te),ve=[...u(r).views||[],re];i({...u(r),views:ve,activeView:ve.length-1})}function se(te,re){const ve=[...u(r).views||[]];ve[te]&&(ve[te]={...ve[te],name:re},i({...u(r),views:ve}))}function V(te){const re=u(r).views||[];if(re.length<=1)return;const ve=re.filter((ce,Oe)=>Oe!==te),Te=u(r).activeView||0,Ne=Math.min(Te,ve.length-1);te===Te&&b(f,null),i({...u(r),views:ve,activeView:Ne})}function ne(te){const re=u(r).views||[],ve=re[te];if(!ve)return;const Te={...ve,name:`${ve.name} (Copy)`,filters:[...ve.filters],columns:ve.columns?[...ve.columns]:void 0,sort:ve.sort?{...ve.sort}:void 0},Ne=[...re,Te];i({...u(r),views:Ne,activeView:Ne.length-1})}function ee(te,re){De({sort:{field:te,order:re}})}function U(te,re){const ve=u(g).map(Te=>Te.field===te?{...Te,visible:re}:Te);De({columns:ve})}function X(te){De({columns:te})}function ie(te){b(o,te,!0)}function ye(te){i({...u(r),pageSize:te}),b(o,0)}var pe=qpe();pe.__mousedown=te=>te.stopPropagation(),pe.__click=te=>te.stopPropagation(),pe.__keydown=te=>te.stopPropagation();var de=w(pe),we=w(de);{let te=le(()=>u(r).views||[]),re=le(()=>u(r).activeView||0);$pe(we,{get views(){return u(te)},get activeViewIndex(){return u(re)},onViewChange:Le,onViewRename:se,onViewCreate:he,onViewDelete:V,onViewDuplicate:ne})}var me=A(we,2);{var Ee=te=>{const re=le(()=>u(o)*u(y)+1),ve=le(()=>Math.min((u(o)+1)*u(y),u(Q)));var Te=Fpe(),Ne=w(Te);Y(()=>J(Ne,`${u(re)??""}-${u(ve)??""} of ${u(Q)??""}`)),T(te,Te)},_e=te=>{var re=zpe();T(te,re)};z(me,te=>{u(Q)>0?te(Ee):te(_e,!1)})}var Ae=A(de,2);{var ze=te=>{var re=Upe(),ve=A(w(re),2),Te=w(ve),Ne=A(ve,2);{var ce=Oe=>{var Qe=Bpe(),We=w(Qe);Y(()=>J(We,`+${t().length-1} more`)),T(Oe,Qe)};z(Ne,Oe=>{t().length>1&&Oe(ce)})}Y(()=>J(Te,t()[0].message)),T(te,re)};z(Ae,te=>{t().length>0&&te(ze)})}var Be=A(Ae,2);ofe(Be,{get columns(){return u(g)},get availableFields(){return u(R)},get sort(){return u(p).sort},onNewNote:B,onPropClick:G,onAddProp:oe,onVisibilityToggle:U,onSort:ee,onReorder:X});var Se=A(Be,2);mpe(Se,{get isOpen(){return u(a)},get fields(){return u(R)},get excludeFields(){return u(be)},get position(){return u(l)},onSelect:fe,onClose:()=>b(a,!1)});var Re=A(Se,2);Epe(Re,{get isOpen(){return u(c)},get filter(){return u($)},get fieldInfo(){return u(W)},get position(){return u(d)},onUpdate:L,onRemove:ue,onClose:()=>{q(),b(c,!1),b(h,null)}});var He=A(Re,2),Me=w(He);{var Pe=te=>{var re=jpe();T(te,re)},ae=te=>{var re=Vpe(),ve=Ie(re);Tt(ve,21,()=>u(D),Ne=>Ne.id,(Ne,ce)=>{{let Oe=le(()=>u(ce).id===u(s)),Qe=le(()=>u(ce).id===u(s));upe(Ne,{get note(){return u(ce)},get columns(){return u(g)},get schemaFields(){return u(S)},get fieldsByType(){return u(E)},get autoFocus(){return u(Oe)},get isHighlighted(){return u(Qe)},onTitleSave:We=>F(u(ce).id,We),onTypeChange:We=>Promise.resolve(Z(u(ce).id,We)),onFieldSave:(We,st)=>H(u(ce).id,We,st),onOpen:()=>e.onNoteOpen?.(u(ce).id),onRowBlur:()=>{u(ce).id===u(s)&&b(s,null)}})}});var Te=A(ve,2);eB(Te,{get currentPage(){return u(o)},get totalPages(){return u(M)},get pageSize(){return u(y)},get total(){return u(Q)},onPageChange:ie,onPageSizeChange:ye}),T(te,re)};z(Me,te=>{u(D).length===0&&u(Q)===0?te(Pe):te(ae,!1)})}T(n,pe),ct()}yt(["mousedown","click","keydown"]);const dM=/```flint-deck\s*\n([\s\S]*?)```/g,aB=/^n-([a-zA-Z0-9_-]+)$/,Hpe=en.define(),Zpe=Xo.define(),xg=new Set,lB=Cr.define({create(){return null},update(n){return n}});function Wpe(n){const e=[],t=n.doc.toString();dM.lastIndex=0;let r;for(;(r=dM.exec(t))!==null;){const i=r[0],s=r[1].trim(),o=r.index,a=o+i.length,l=t.indexOf(`
`,o)+1,c=a-3,d=s.match(aB);d?e.push({from:o,to:a,contentFrom:l,contentTo:c,yamlContent:s,type:"embed",noteId:d[1]}):e.push({from:o,to:a,contentFrom:l,contentTo:c,yamlContent:s,type:"inline-yaml"})}return e}function Xpe(n,e,t){for(const r of n.selection.ranges)if(r.from<t&&r.to>e)return!0;return!1}class hM extends Yo{yamlContent;constructor(e){super(),this.yamlContent=e}toDOM(){const e=document.createElement("div");return e.className="deck-error-widget",e.innerHTML=`
      <div class="deck-error-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <div class="deck-error-text">
          <strong>Inline deck configuration is deprecated</strong>
          <p>Create a standalone deck note and embed it using <code>n-&lt;note-id&gt;</code></p>
        </div>
      </div>
    `,e.addEventListener("mousedown",t=>{t.stopPropagation()}),e}destroy(){xg.delete(this)}eq(e){return this.yamlContent===e.yamlContent}get estimatedHeight(){return 60}ignoreEvent(){return!0}}class fM extends Yo{constructor(e,t,r){super(),this.noteId=t,this.handlers=r,this.yamlContent=e}component=null;yamlContent;config=null;validationWarnings=[];loadError=null;loadDeckConfig(){try{const e=Zn(this.noteId);if(!e){this.loadError=`Deck not found: ${this.noteId}`;return}if(Hg(e)!=="deck"){this.loadError=`Note "${this.noteId}" is not a deck`;return}const t=$d(this.noteId);if(!t){this.loadError="No deck configuration found";return}this.config=t,this.validationWarnings=[]}catch(e){this.loadError=`Failed to load deck: ${e}`}}saveConfigToSourceNote(e){try{ES(this.noteId,e),this.config=e}catch(t){console.error("Failed to save deck config:",t)}}toDOM(){xg.add(this);const e=document.createElement("div");return e.className="deck-widget-container deck-embedded",e.addEventListener("mousedown",t=>{const i=t.target.tagName;["INPUT","TEXTAREA","SELECT","OPTION","BUTTON"].includes(i)||t.preventDefault(),t.stopPropagation()}),this.loadDeckConfig(),this.loadError?(e.innerHTML=`
        <div class="deck-error-widget">
          <div class="deck-error-content">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <div class="deck-error-text">
              <strong>${this.loadError}</strong>
            </div>
          </div>
        </div>
      `,e):this.config?(this.component=v3(oB,{target:e,props:{config:this.config,validationWarnings:this.validationWarnings,onConfigChange:t=>{this.saveConfigToSourceNote(t)},onNoteOpen:t=>{this.handlers.onNoteOpen(t)}}}),e):(e.innerHTML=`
        <div class="deck-loading">
          <span class="deck-loading-text">No deck configuration found</span>
        </div>
      `,e)}destroy(){xg.delete(this),this.component&&(Q9(this.component),this.component=null)}eq(e){return this.noteId===e.noteId}get estimatedHeight(){return 200}ignoreEvent(){return!0}}function r_(n){const e=[],t=n.field(lB,!1);if(!t){for(const s of xg)s.destroy();return hn.set([])}const r=Wpe(n),i=new Set;for(const s of r){if(Xpe(n,s.from,s.to))continue;let o;s.type==="embed"&&s.noteId?(i.add(`embed:${s.noteId}`),o=new fM(s.yamlContent,s.noteId,t)):(i.add(`error:${s.yamlContent}`),o=new hM(s.yamlContent)),e.push(hn.replace({widget:o,block:!0,inclusive:!1}).range(s.from,s.to))}for(const s of xg){let o;s instanceof fM?o=`embed:${s.yamlContent.match(aB)?.[1]}`:s instanceof hM?o=`error:${s.yamlContent}`:o=`inline:${s.yamlContent}`,i.has(o)||s.destroy()}return hn.set(e,!0)}const Ype=Cr.define({create(n){return r_(n)},update(n,e){for(const t of e.effects)if(t.is(Hpe))return r_(e.state);return e.annotation(Zpe)?n.map(e.changes):e.docChanged||e.selection?r_(e.state):n.map(e.changes)},provide:n=>gt.decorations.from(n)});function Gpe(n){return[Yhe,lB.init(()=>n),Ype]}const Kpe=(n,e,t)=>{const r=t.filter(i=>!sge(i)&&!i.changes.empty);if(r.length!==0)return n.change(i=>{r.forEach(s=>{s.changes.iterChanges((o,a,l,c,d)=>{FH(i,e.slice(),l,a-o,d.toString())})})}),Is(n.doc())},Jpe=(n,e,t)=>{let r=n.state.selection;for(const i of t){const s=ege(i,e,n.state);if(s!=null){const o=Mr.of(s,n.state.doc.length,`
`);r=r.map(o,1),n.dispatch({changes:o,annotations:Vx.of({})})}}n.dispatch({selection:r,annotations:Vx.of({})})};function ege(n,e,t){return n.action==="insert"?tge(e,n):n.action==="splice"?nge(e,n):n.action==="del"?rge(e,n):n.action==="put"?ige(e,n,t):null}function tge(n,e){const t=Lb(n,e.path);if(t==null)return[];const r=e.values.map(i=>i?i.toString():"").join("");return[{from:t,to:t,insert:r}]}function nge(n,e){const t=Lb(n,e.path);return t==null?[]:[{from:t,insert:e.value}]}function rge(n,e){const t=Lb(n,e.path);if(t==null)return[];const r=e.length||1;return[{from:t,to:t+r}]}function ige(n,e,t){if(Lb(n,[...e.path,0])==null)return[];const i=t.doc.length;return typeof e.value!="string"?[]:[{from:0,to:i,insert:e.value}]}function Lb(n,e){if(e.length!==n.length+1)return null;for(let r=0;r<n.length;r++)if(n[r]!==e[r])return null;const t=e[e.length-1];return typeof t=="number"?t:null}const Vx=Xo.define(),sge=n=>!!n.annotation(Vx),oge=({handle:n,path:e})=>{if(!n.isReady())throw new Error("ensure the handle is ready before initializing the automergeSyncPlugin");return Kr.fromClass(class{view;reconciledHeads=Is(n.doc());isProcessingCmTransaction=!1;constructor(t){this.view=t,this.onChange=this.onChange.bind(this),n.on("change",this.onChange)}update(t){this.isProcessingCmTransaction=!0;const r=Kpe(n,e,t.transactions);r&&(this.reconciledHeads=r),this.isProcessingCmTransaction=!1}onChange=()=>{if(this.isProcessingCmTransaction)return;const t=Is(n.doc());if(vy(t,this.reconciledHeads))return;const r=Nv(n.doc(),this.reconciledHeads,t);Jpe(this.view,e,r),this.reconciledHeads=t};destroy(){n.off("change",this.onChange)}})};class tT{constructor(e={}){this.options=e}#e=j(!1);get isDarkMode(){return u(this.#e)}set isDarkMode(e){b(this.#e,e,!0)}mediaQuery=null;getBaseTheme(){const e=this.options.variant==="daily-note";return gt.theme({"&":{height:"auto",minHeight:e?"0":"300px",fontFamily:"var(--font-editor) !important",fontSize:"var(--font-editor-size) !important",lineHeight:"1.6",width:"100%"},"&.cm-editor":{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontFamily:"var(--font-editor) !important"},"&.cm-focused":{outline:"none",boxShadow:"none !important"},".cm-content":{fontFamily:"var(--font-editor) !important",color:"var(--text-primary)",caretColor:"var(--text-primary)",...e?{padding:"0"}:{}},".cm-cursor":{borderLeftColor:"var(--text-primary)"},".cm-tooltip":{fontFamily:"var(--font-editor) !important"},".cm-tooltip-autocomplete":{fontFamily:"var(--font-editor) !important"},".cm-completionLabel":{fontFamily:"var(--font-editor) !important"},".cm-line":{fontFamily:"var(--font-editor) !important"}})}getDefaultTheme(){const e=this.options.variant==="daily-note";return gt.theme({".cm-scroller":{width:"100%",overflow:"visible !important",fontFamily:"var(--font-editor) !important",paddingBottom:e?"0":"25vh"}})}placeholderTheme=gt.theme({".cm-placeholder":{color:"var(--text-placeholder)",fontStyle:"italic",opacity:"0.7"}});handleThemeChange=e=>{this.isDarkMode=e.matches};initializeTheme(){typeof window<"u"&&(this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.isDarkMode=this.mediaQuery.matches,this.mediaQuery.addEventListener("change",this.handleThemeChange))}getExtensions(){const e=[F2,dse(),loe(),k2(),Nl.of([...A2,...S2,...ele,Qae]),Hz(),gt.lineWrapping,this.isDarkMode?K2:G2,this.getBaseTheme(),this.getDefaultTheme(),Ehe,Phe,...this.options.onWikilinkClick?[eT(this.options.onWikilinkClick,this.options.onWikilinkHover,this.options.onWikilinkEditDisplayText)]:[],...this.options.onDeckNoteOpen?[Gpe({onNoteOpen:this.options.onDeckNoteOpen,onConfigChange:(t,r,i)=>{}})]:[],Aoe(),gt.contentAttributes.of({spellcheck:"true"}),gt.editable.of(!0)];if(this.options.automergeSync&&e.push(oge({handle:this.options.automergeSync.handle,path:this.options.automergeSync.path})),this.options.onContentChange||this.options.onCursorChange){const t=gt.updateListener.of(r=>{r.selectionSet&&!r.docChanged&&this.options.onCursorChange?.(),r.docChanged&&this.options.onContentChange?.(r.state.doc.toString())});e.push(t)}return this.options.onDocChange&&e.push(gt.updateListener.of(this.options.onDocChange)),this.options.placeholder&&(e.push(w6(this.options.placeholder)),e.push(this.placeholderTheme)),e}destroy(){this.mediaQuery&&this.mediaQuery.removeEventListener("change",this.handleThemeChange)}}const age={maxResults:50,maxMatchesPerNote:3,contextChars:60,noteTypes:{}};function cB(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function uB(n){return n.toLowerCase().split(/\s+/).filter(e=>e.length>0)}function dB(n,e,t,r){const i=[],s=n.toLowerCase(),o=n.split(`
`);let a=0;const l=[];for(let d=0;d<o.length;d++){for(let h=0;h<=o[d].length;h++)l[a+h]=d+1;a+=o[d].length+1}const c=new Set;for(const d of e){if(i.length>=r)break;const h=cB(d),f=new RegExp(h,"gi");let p;for(;(p=f.exec(s))!==null&&i.length<r;){const g=p.index,m=g+p[0].length;let v=!1;for(const S of c)if(Math.abs(S-g)<t){v=!0;break}if(v)continue;c.add(g);const y=Math.max(0,g-t),O=Math.min(n.length,m+t);let _=n.slice(y,O);if(y>0){const S=_.indexOf(" ");S>0&&S<t/2&&(_=_.slice(S+1))}if(O<n.length){const S=_.lastIndexOf(" ");S>_.length-t/2&&(_=_.slice(0,S))}const x=Math.max(0,g-y),k=Math.min(_.length,x+p[0].length);i.push({context:_.replace(/\n/g," "),highlightStart:x,highlightEnd:k,lineNumber:l[g]||1})}}return i}function lge(n,e){const t=[];for(let r=0;r<=e.length;r++)t[r]=[r];for(let r=0;r<=n.length;r++)t[0][r]=r;for(let r=1;r<=e.length;r++)for(let i=1;i<=n.length;i++)e.charAt(r-1)===n.charAt(i-1)?t[r][i]=t[r-1][i-1]:t[r][i]=Math.min(t[r-1][i-1]+1,t[r][i-1]+1,t[r-1][i]+1);return t[e.length][n.length]}function cge(n,e,t=2){const r=n.toLowerCase().split(/\s+/),i=e.toLowerCase();return n.toLowerCase().includes(i)?!0:i.length<4?!1:r.some(s=>{if(s.length<3)return!1;const o=Math.min(s.length,i.length),a=s.slice(0,o),l=i.slice(0,o);return lge(a,l)<=t})}function uge(n,e,t,r,i=0){let s=0;const o=n.title.toLowerCase(),a=e.join(" ");o===a?s+=100:e.length>1&&(o.includes(a)?s+=50:o.startsWith(a)&&(s+=45));let l=0;for(const d of e)o.includes(d)&&(l++,s+=10,new RegExp(`\\b${cB(d)}`,"i").test(n.title)&&(s+=3),e.indexOf(d)===0&&o.startsWith(d)&&(s+=5));return l===e.length&&e.length>1&&(s+=25),i>0&&(s+=Math.min(i*3,15)),r&&(s+=3),t.length>0&&(s+=5),(Date.now()-new Date(n.updated).getTime())/(1e3*60*60*24)<7&&(s+=2),s}const hB={...age,fuzzyMatch:!0};function fB(n,e,t={}){const r={...hB,...t};if(!e.trim())return[];const i=uB(e);if(i.length===0)return[];const s=[];for(const o of n){if(o.archived)continue;let a=!1;for(const f of i)if(r.fuzzyMatch){if(cge(o.title,f)){a=!0;break}}else if(o.title.toLowerCase().includes(f)){a=!0;break}let l;if(r.noteTypes&&o.type){const f=r.noteTypes[o.type];if(f){const p=f.name.toLowerCase();for(const g of i)if(p.includes(g)){a=!0,l=f;break}}}if(!a)continue;const c=dB(o.title,i,r.contextChars,r.maxMatchesPerNote),d=[],h=uge(o,i,c,l,0);s.push({note:o,score:h,titleMatches:c,contentMatches:d,matchedType:l})}return s.sort((o,a)=>a.score-o.score),s.slice(0,r.maxResults)}function dge(n){const e=[],{context:t,highlightStart:r,highlightEnd:i}=n;return r>0&&e.push({text:t.slice(0,r),highlight:!1}),e.push({text:t.slice(r,i),highlight:!0}),i<t.length&&e.push({text:t.slice(i),highlight:!1}),e}async function hge(n,e,t={},r){const i={...hB,...t};if(!e.trim())return[];const s=uB(e),o=fB(n,e,t),a=new Map;for(const l of o)a.set(l.note.id,{...l,isContentMatch:!1});if(r&&t.contentLoader){const d=r.search(e).slice(0,i.maxResults??50).map(async f=>{const p=f.id,g=n.find(v=>v.id===p);if(!g||g.archived)return null;let m=[];try{const v=await t.contentLoader(p);v&&(m=dB(v,s,i.contextChars??60,i.maxMatchesPerNote??3))}catch{}return{noteId:p,note:g,contentResult:f,contentMatches:m}}),h=await Promise.all(d);for(const f of h){if(!f)continue;const{noteId:p,note:g,contentResult:m,contentMatches:v}=f,y=a.get(p);y?(y.score+=Math.min(m.score*.3,10),v.length>0&&y.contentMatches.length===0&&(y.contentMatches=v)):a.set(p,{note:g,score:m.score*.5,titleMatches:[],contentMatches:v,isContentMatch:!0})}}return Array.from(a.values()).sort((l,c)=>c.score-l.score).slice(0,i.maxResults)}class fge{get items(){return kJ()}isOnShelf(e,t){return CS(e,t)}addItem(e,t){P5(e,t)}removeItem(e,t){I5(e,t)}toggleExpanded(e,t){SJ(e,t)}setExpanded(e,t,r){TJ(e,t,r)}clear(){AJ()}}const uu=new fge;var pB="vercel.ai.error",pge=Symbol.for(pB),gB,gge=class mB extends Error{constructor({name:e,message:t,cause:r}){super(t),this[gB]=!0,this.name=e,this.cause=r}static isInstance(e){return mB.hasMarker(e,pB)}static hasMarker(e,t){const r=Symbol.for(t);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};gB=pge;var xn=gge,vB="AI_APICallError",yB=`vercel.ai.error.${vB}`,mge=Symbol.for(yB),bB,Bi=class extends xn{constructor({message:e,url:t,requestBodyValues:r,statusCode:i,responseHeaders:s,responseBody:o,cause:a,isRetryable:l=i!=null&&(i===408||i===409||i===429||i>=500),data:c}){super({name:vB,message:e,cause:a}),this[bB]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=i,this.responseHeaders=s,this.responseBody=o,this.isRetryable=l,this.data=c}static isInstance(e){return xn.hasMarker(e,yB)}};bB=mge;var wB="AI_EmptyResponseBodyError",_B=`vercel.ai.error.${wB}`,vge=Symbol.for(_B),OB,yge=class extends xn{constructor({message:e="Empty response body"}={}){super({name:wB,message:e}),this[OB]=!0}static isInstance(e){return xn.hasMarker(e,_B)}};OB=vge;function cf(n){return n==null?"unknown error":typeof n=="string"?n:n instanceof Error?n.message:JSON.stringify(n)}var xB="AI_InvalidArgumentError",kB=`vercel.ai.error.${xB}`,bge=Symbol.for(kB),SB,wge=class extends xn{constructor({message:e,cause:t,argument:r}){super({name:xB,message:e,cause:t}),this[SB]=!0,this.argument=r}static isInstance(e){return xn.hasMarker(e,kB)}};SB=bge;var TB="AI_InvalidPromptError",AB=`vercel.ai.error.${TB}`,_ge=Symbol.for(AB),CB,Od=class extends xn{constructor({prompt:e,message:t,cause:r}){super({name:TB,message:`Invalid prompt: ${t}`,cause:r}),this[CB]=!0,this.prompt=e}static isInstance(e){return xn.hasMarker(e,AB)}};CB=_ge;var EB="AI_JSONParseError",PB=`vercel.ai.error.${EB}`,Oge=Symbol.for(PB),IB,y0=class extends xn{constructor({text:e,cause:t}){super({name:EB,message:`JSON parsing failed: Text: ${e}.
Error message: ${cf(t)}`,cause:t}),this[IB]=!0,this.text=e}static isInstance(e){return xn.hasMarker(e,PB)}};IB=Oge;var MB="AI_TypeValidationError",RB=`vercel.ai.error.${MB}`,xge=Symbol.for(RB),DB,kge=class qx extends xn{constructor({value:e,cause:t}){super({name:MB,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${cf(t)}`,cause:t}),this[DB]=!0,this.value=e}static isInstance(e){return xn.hasMarker(e,RB)}static wrap({value:e,cause:t}){return qx.isInstance(t)&&t.value===e?t:new qx({value:e,cause:t})}};DB=xge;var kg=kge;let pM=class extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function i_(n){}function Sge(n){if(typeof n=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:e=i_,onError:t=i_,onRetry:r=i_,onComment:i}=n;let s="",o=!0,a,l="",c="";function d(m){const v=o?m.replace(/^\xEF\xBB\xBF/,""):m,[y,O]=Tge(`${s}${v}`);for(const _ of y)h(_);s=O,o=!1}function h(m){if(m===""){p();return}if(m.startsWith(":")){i&&i(m.slice(m.startsWith(": ")?2:1));return}const v=m.indexOf(":");if(v!==-1){const y=m.slice(0,v),O=m[v+1]===" "?2:1,_=m.slice(v+O);f(y,_,m);return}f(m,"",m)}function f(m,v,y){switch(m){case"event":c=v;break;case"data":l=`${l}${v}
`;break;case"id":a=v.includes("\0")?void 0:v;break;case"retry":/^\d+$/.test(v)?r(parseInt(v,10)):t(new pM(`Invalid \`retry\` value: "${v}"`,{type:"invalid-retry",value:v,line:y}));break;default:t(new pM(`Unknown field "${m.length>20?`${m.slice(0,20)}â¦`:m}"`,{type:"unknown-field",field:m,value:v,line:y}));break}}function p(){l.length>0&&e({id:a,event:c||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),a=void 0,l="",c=""}function g(m={}){s&&m.consume&&h(s),o=!0,a=void 0,l="",c="",s=""}return{feed:d,reset:g}}function Tge(n){const e=[];let t="",r=0;for(;r<n.length;){const i=n.indexOf("\r",r),s=n.indexOf(`
`,r);let o=-1;if(i!==-1&&s!==-1?o=Math.min(i,s):i!==-1?i===n.length-1?o=-1:o=i:s!==-1&&(o=s),o===-1){t=n.slice(r);break}else{const a=n.slice(r,o);e.push(a),r=o+1,n[r-1]==="\r"&&n[r]===`
`&&r++}}return[e,t]}let Age=class extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let i;super({start(s){i=Sge({onEvent:o=>{s.enqueue(o)},onError(o){e==="terminate"?s.error(o):typeof e=="function"&&e(o)},onRetry:t,onComment:r})},transform(s){i.feed(s)}})}};function Ye(n,e,t){function r(a,l){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:l,constr:o,traits:new Set},enumerable:!1}),a._zod.traits.has(n))return;a._zod.traits.add(n),e(a,l);const c=o.prototype,d=Object.keys(c);for(let h=0;h<d.length;h++){const f=d[h];f in a||(a[f]=c[f].bind(a))}}const i=t?.Parent??Object;class s extends i{}Object.defineProperty(s,"name",{value:n});function o(a){var l;const c=t?.Parent?new s:this;r(c,a),(l=c._zod).deferred??(l.deferred=[]);for(const d of c._zod.deferred)d();return c}return Object.defineProperty(o,"init",{value:r}),Object.defineProperty(o,Symbol.hasInstance,{value:a=>t?.Parent&&a instanceof t.Parent?!0:a?._zod?.traits?.has(n)}),Object.defineProperty(o,"name",{value:n}),o}class dh extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class NB extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const LB={};function Sc(n){return LB}function QB(n){const e=Object.values(n).filter(r=>typeof r=="number");return Object.entries(n).filter(([r,i])=>e.indexOf(+r)===-1).map(([r,i])=>i)}function Hx(n,e){return typeof e=="bigint"?e.toString():e}function Qb(n){return{get value(){{const e=n();return Object.defineProperty(this,"value",{value:e}),e}}}}function nT(n){return n==null}function rT(n){const e=n.startsWith("^")?1:0,t=n.endsWith("$")?n.length-1:n.length;return n.slice(e,t)}function Cge(n,e){const t=(n.toString().split(".")[1]||"").length,r=e.toString();let i=(r.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(r)){const l=r.match(/\d?e-(\d?)/);l?.[1]&&(i=Number.parseInt(l[1]))}const s=t>i?t:i,o=Number.parseInt(n.toFixed(s).replace(".","")),a=Number.parseInt(e.toFixed(s).replace(".",""));return o%a/10**s}const gM=Symbol("evaluating");function Mn(n,e,t){let r;Object.defineProperty(n,e,{get(){if(r!==gM)return r===void 0&&(r=gM,r=t()),r},set(i){Object.defineProperty(n,e,{value:i})},configurable:!0})}function Yu(n,e,t){Object.defineProperty(n,e,{value:t,writable:!0,enumerable:!0,configurable:!0})}function Gu(...n){const e={};for(const t of n){const r=Object.getOwnPropertyDescriptors(t);Object.assign(e,r)}return Object.defineProperties({},e)}function mM(n){return JSON.stringify(n)}function Ege(n){return n.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const $B="captureStackTrace"in Error?Error.captureStackTrace:(...n)=>{};function Sg(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}const Pge=Qb(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const n=Function;return new n(""),!0}catch{return!1}});function Vh(n){if(Sg(n)===!1)return!1;const e=n.constructor;if(e===void 0||typeof e!="function")return!0;const t=e.prototype;return!(Sg(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}function FB(n){return Vh(n)?{...n}:Array.isArray(n)?[...n]:n}const Ige=new Set(["string","number","symbol"]);function qh(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ic(n,e,t){const r=new n._zod.constr(e??n._zod.def);return(!e||t?.parent)&&(r._zod.parent=n),r}function zt(n){const e=n;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function Mge(n){return Object.keys(n).filter(e=>n[e]._zod.optin==="optional"&&n[e]._zod.optout==="optional")}const Rge={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Dge(n,e){const t=n._zod.def,r=Gu(n._zod.def,{get shape(){const i={};for(const s in e){if(!(s in t.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(i[s]=t.shape[s])}return Yu(this,"shape",i),i},checks:[]});return Ic(n,r)}function Nge(n,e){const t=n._zod.def,r=Gu(n._zod.def,{get shape(){const i={...n._zod.def.shape};for(const s in e){if(!(s in t.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&delete i[s]}return Yu(this,"shape",i),i},checks:[]});return Ic(n,r)}function Lge(n,e){if(!Vh(e))throw new Error("Invalid input to extend: expected a plain object");const t=n._zod.def.checks;if(t&&t.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const i=Gu(n._zod.def,{get shape(){const s={...n._zod.def.shape,...e};return Yu(this,"shape",s),s},checks:[]});return Ic(n,i)}function Qge(n,e){if(!Vh(e))throw new Error("Invalid input to safeExtend: expected a plain object");const t={...n._zod.def,get shape(){const r={...n._zod.def.shape,...e};return Yu(this,"shape",r),r},checks:n._zod.def.checks};return Ic(n,t)}function $ge(n,e){const t=Gu(n._zod.def,{get shape(){const r={...n._zod.def.shape,...e._zod.def.shape};return Yu(this,"shape",r),r},get catchall(){return e._zod.def.catchall},checks:[]});return Ic(n,t)}function Fge(n,e,t){const r=Gu(e._zod.def,{get shape(){const i=e._zod.def.shape,s={...i};if(t)for(const o in t){if(!(o in i))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(s[o]=n?new n({type:"optional",innerType:i[o]}):i[o])}else for(const o in i)s[o]=n?new n({type:"optional",innerType:i[o]}):i[o];return Yu(this,"shape",s),s},checks:[]});return Ic(e,r)}function zge(n,e,t){const r=Gu(e._zod.def,{get shape(){const i=e._zod.def.shape,s={...i};if(t)for(const o in t){if(!(o in s))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(s[o]=new n({type:"nonoptional",innerType:i[o]}))}else for(const o in i)s[o]=new n({type:"nonoptional",innerType:i[o]});return Yu(this,"shape",s),s},checks:[]});return Ic(e,r)}function Zd(n,e=0){if(n.aborted===!0)return!0;for(let t=e;t<n.issues.length;t++)if(n.issues[t]?.continue!==!0)return!0;return!1}function Wd(n,e){return e.map(t=>{var r;return(r=t).path??(r.path=[]),t.path.unshift(n),t})}function xv(n){return typeof n=="string"?n:n?.message}function Tc(n,e,t){const r={...n,path:n.path??[]};if(!n.message){const i=xv(n.inst?._zod.def?.error?.(n))??xv(e?.error?.(n))??xv(t.customError?.(n))??xv(t.localeError?.(n))??"Invalid input";r.message=i}return delete r.inst,delete r.continue,e?.reportInput||delete r.input,r}function iT(n){return Array.isArray(n)?"array":typeof n=="string"?"string":"unknown"}function Tg(...n){const[e,t,r]=n;return typeof e=="string"?{message:e,code:"custom",input:t,inst:r}:{...e}}const zB=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),n.message=JSON.stringify(e,Hx,2),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},BB=Ye("$ZodError",zB),UB=Ye("$ZodError",zB,{Parent:Error});function Bge(n,e=t=>t.message){const t={},r=[];for(const i of n.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}function Uge(n,e=t=>t.message){const t={_errors:[]},r=i=>{for(const s of i.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(o=>r({issues:o}));else if(s.code==="invalid_key")r({issues:s.issues});else if(s.code==="invalid_element")r({issues:s.issues});else if(s.path.length===0)t._errors.push(e(s));else{let o=t,a=0;for(;a<s.path.length;){const l=s.path[a];a===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(e(s))):o[l]=o[l]||{_errors:[]},o=o[l],a++}}};return r(n),t}const sT=n=>(e,t,r,i)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},o=e._zod.run({value:t,issues:[]},s);if(o instanceof Promise)throw new dh;if(o.issues.length){const a=new(i?.Err??n)(o.issues.map(l=>Tc(l,s,Sc())));throw $B(a,i?.callee),a}return o.value},oT=n=>async(e,t,r,i)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let o=e._zod.run({value:t,issues:[]},s);if(o instanceof Promise&&(o=await o),o.issues.length){const a=new(i?.Err??n)(o.issues.map(l=>Tc(l,s,Sc())));throw $B(a,i?.callee),a}return o.value},$b=n=>(e,t,r)=>{const i=r?{...r,async:!1}:{async:!1},s=e._zod.run({value:t,issues:[]},i);if(s instanceof Promise)throw new dh;return s.issues.length?{success:!1,error:new(n??BB)(s.issues.map(o=>Tc(o,i,Sc())))}:{success:!0,data:s.value}},jge=$b(UB),Fb=n=>async(e,t,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:t,issues:[]},i);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new n(s.issues.map(o=>Tc(o,i,Sc())))}:{success:!0,data:s.value}},Vge=Fb(UB),qge=n=>(e,t,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return sT(n)(e,t,i)},Hge=n=>(e,t,r)=>sT(n)(e,t,r),Zge=n=>async(e,t,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return oT(n)(e,t,i)},Wge=n=>async(e,t,r)=>oT(n)(e,t,r),Xge=n=>(e,t,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return $b(n)(e,t,i)},Yge=n=>(e,t,r)=>$b(n)(e,t,r),Gge=n=>async(e,t,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Fb(n)(e,t,i)},Kge=n=>async(e,t,r)=>Fb(n)(e,t,r),Jge=/^[cC][^\s-]{8,}$/,eme=/^[0-9a-z]+$/,tme=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,nme=/^[0-9a-vA-V]{20}$/,rme=/^[A-Za-z0-9]{27}$/,ime=/^[a-zA-Z0-9_-]{21}$/,sme=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,ome=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,vM=n=>n?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${n}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,ame=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,lme="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function cme(){return new RegExp(lme,"u")}const ume=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,dme=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,hme=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,fme=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,pme=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,jB=/^[A-Za-z0-9_-]*$/,gme=/^\+(?:[0-9]){6,14}[0-9]$/,VB="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",mme=new RegExp(`^${VB}$`);function qB(n){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof n.precision=="number"?n.precision===-1?`${e}`:n.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${n.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function vme(n){return new RegExp(`^${qB(n)}$`)}function yme(n){const e=qB({precision:n.precision}),t=["Z"];n.local&&t.push(""),n.offset&&t.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${e}(?:${t.join("|")})`;return new RegExp(`^${VB}T(?:${r})$`)}const bme=n=>{const e=n?`[\\s\\S]{${n?.minimum??0},${n?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},wme=/^-?\d+$/,_me=/^-?\d+(?:\.\d+)?/,Ome=/^(?:true|false)$/i,xme=/^null$/i,kme=/^[^A-Z]*$/,Sme=/^[^a-z]*$/,fs=Ye("$ZodCheck",(n,e)=>{var t;n._zod??(n._zod={}),n._zod.def=e,(t=n._zod).onattach??(t.onattach=[])}),HB={number:"number",bigint:"bigint",object:"date"},ZB=Ye("$ZodCheckLessThan",(n,e)=>{fs.init(n,e);const t=HB[typeof e.value];n._zod.onattach.push(r=>{const i=r._zod.bag,s=(e.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<s&&(e.inclusive?i.maximum=e.value:i.exclusiveMaximum=e.value)}),n._zod.check=r=>{(e.inclusive?r.value<=e.value:r.value<e.value)||r.issues.push({origin:t,code:"too_big",maximum:e.value,input:r.value,inclusive:e.inclusive,inst:n,continue:!e.abort})}}),WB=Ye("$ZodCheckGreaterThan",(n,e)=>{fs.init(n,e);const t=HB[typeof e.value];n._zod.onattach.push(r=>{const i=r._zod.bag,s=(e.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>s&&(e.inclusive?i.minimum=e.value:i.exclusiveMinimum=e.value)}),n._zod.check=r=>{(e.inclusive?r.value>=e.value:r.value>e.value)||r.issues.push({origin:t,code:"too_small",minimum:e.value,input:r.value,inclusive:e.inclusive,inst:n,continue:!e.abort})}}),Tme=Ye("$ZodCheckMultipleOf",(n,e)=>{fs.init(n,e),n._zod.onattach.push(t=>{var r;(r=t._zod.bag).multipleOf??(r.multipleOf=e.value)}),n._zod.check=t=>{if(typeof t.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof t.value=="bigint"?t.value%e.value===BigInt(0):Cge(t.value,e.value)===0)||t.issues.push({origin:typeof t.value,code:"not_multiple_of",divisor:e.value,input:t.value,inst:n,continue:!e.abort})}}),Ame=Ye("$ZodCheckNumberFormat",(n,e)=>{fs.init(n,e),e.format=e.format||"float64";const t=e.format?.includes("int"),r=t?"int":"number",[i,s]=Rge[e.format];n._zod.onattach.push(o=>{const a=o._zod.bag;a.format=e.format,a.minimum=i,a.maximum=s,t&&(a.pattern=wme)}),n._zod.check=o=>{const a=o.value;if(t){if(!Number.isInteger(a)){o.issues.push({expected:r,format:e.format,code:"invalid_type",continue:!1,input:a,inst:n});return}if(!Number.isSafeInteger(a)){a>0?o.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:r,continue:!e.abort}):o.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:r,continue:!e.abort});return}}a<i&&o.issues.push({origin:"number",input:a,code:"too_small",minimum:i,inclusive:!0,inst:n,continue:!e.abort}),a>s&&o.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:n})}}),Cme=Ye("$ZodCheckMaxLength",(n,e)=>{var t;fs.init(n,e),(t=n._zod.def).when??(t.when=r=>{const i=r.value;return!nT(i)&&i.length!==void 0}),n._zod.onattach.push(r=>{const i=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<i&&(r._zod.bag.maximum=e.maximum)}),n._zod.check=r=>{const i=r.value;if(i.length<=e.maximum)return;const o=iT(i);r.issues.push({origin:o,code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:n,continue:!e.abort})}}),Eme=Ye("$ZodCheckMinLength",(n,e)=>{var t;fs.init(n,e),(t=n._zod.def).when??(t.when=r=>{const i=r.value;return!nT(i)&&i.length!==void 0}),n._zod.onattach.push(r=>{const i=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>i&&(r._zod.bag.minimum=e.minimum)}),n._zod.check=r=>{const i=r.value;if(i.length>=e.minimum)return;const o=iT(i);r.issues.push({origin:o,code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:n,continue:!e.abort})}}),Pme=Ye("$ZodCheckLengthEquals",(n,e)=>{var t;fs.init(n,e),(t=n._zod.def).when??(t.when=r=>{const i=r.value;return!nT(i)&&i.length!==void 0}),n._zod.onattach.push(r=>{const i=r._zod.bag;i.minimum=e.length,i.maximum=e.length,i.length=e.length}),n._zod.check=r=>{const i=r.value,s=i.length;if(s===e.length)return;const o=iT(i),a=s>e.length;r.issues.push({origin:o,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:r.value,inst:n,continue:!e.abort})}}),zb=Ye("$ZodCheckStringFormat",(n,e)=>{var t,r;fs.init(n,e),n._zod.onattach.push(i=>{const s=i._zod.bag;s.format=e.format,e.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(e.pattern))}),e.pattern?(t=n._zod).check??(t.check=i=>{e.pattern.lastIndex=0,!e.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:e.format,input:i.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:n,continue:!e.abort})}):(r=n._zod).check??(r.check=()=>{})}),Ime=Ye("$ZodCheckRegex",(n,e)=>{zb.init(n,e),n._zod.check=t=>{e.pattern.lastIndex=0,!e.pattern.test(t.value)&&t.issues.push({origin:"string",code:"invalid_format",format:"regex",input:t.value,pattern:e.pattern.toString(),inst:n,continue:!e.abort})}}),Mme=Ye("$ZodCheckLowerCase",(n,e)=>{e.pattern??(e.pattern=kme),zb.init(n,e)}),Rme=Ye("$ZodCheckUpperCase",(n,e)=>{e.pattern??(e.pattern=Sme),zb.init(n,e)}),Dme=Ye("$ZodCheckIncludes",(n,e)=>{fs.init(n,e);const t=qh(e.includes),r=new RegExp(typeof e.position=="number"?`^.{${e.position}}${t}`:t);e.pattern=r,n._zod.onattach.push(i=>{const s=i._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),n._zod.check=i=>{i.value.includes(e.includes,e.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:i.value,inst:n,continue:!e.abort})}}),Nme=Ye("$ZodCheckStartsWith",(n,e)=>{fs.init(n,e);const t=new RegExp(`^${qh(e.prefix)}.*`);e.pattern??(e.pattern=t),n._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(t)}),n._zod.check=r=>{r.value.startsWith(e.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:r.value,inst:n,continue:!e.abort})}}),Lme=Ye("$ZodCheckEndsWith",(n,e)=>{fs.init(n,e);const t=new RegExp(`.*${qh(e.suffix)}$`);e.pattern??(e.pattern=t),n._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(t)}),n._zod.check=r=>{r.value.endsWith(e.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:r.value,inst:n,continue:!e.abort})}}),Qme=Ye("$ZodCheckOverwrite",(n,e)=>{fs.init(n,e),n._zod.check=t=>{t.value=e.tx(t.value)}});class $me{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const r=e.split(`
`).filter(o=>o),i=Math.min(...r.map(o=>o.length-o.trimStart().length)),s=r.map(o=>o.slice(i)).map(o=>" ".repeat(this.indent*2)+o);for(const o of s)this.content.push(o)}compile(){const e=Function,t=this?.args,i=[...(this?.content??[""]).map(s=>`  ${s}`)];return new e(...t,i.join(`
`))}}const Fme={major:4,minor:1,patch:13},nr=Ye("$ZodType",(n,e)=>{var t;n??(n={}),n._zod.def=e,n._zod.bag=n._zod.bag||{},n._zod.version=Fme;const r=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&r.unshift(n);for(const i of r)for(const s of i._zod.onattach)s(n);if(r.length===0)(t=n._zod).deferred??(t.deferred=[]),n._zod.deferred?.push(()=>{n._zod.run=n._zod.parse});else{const i=(o,a,l)=>{let c=Zd(o),d;for(const h of a){if(h._zod.def.when){if(!h._zod.def.when(o))continue}else if(c)continue;const f=o.issues.length,p=h._zod.check(o);if(p instanceof Promise&&l?.async===!1)throw new dh;if(d||p instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await p,o.issues.length!==f&&(c||(c=Zd(o,f)))});else{if(o.issues.length===f)continue;c||(c=Zd(o,f))}}return d?d.then(()=>o):o},s=(o,a,l)=>{if(Zd(o))return o.aborted=!0,o;const c=i(a,r,l);if(c instanceof Promise){if(l.async===!1)throw new dh;return c.then(d=>n._zod.parse(d,l))}return n._zod.parse(c,l)};n._zod.run=(o,a)=>{if(a.skipChecks)return n._zod.parse(o,a);if(a.direction==="backward"){const c=n._zod.parse({value:o.value,issues:[]},{...a,skipChecks:!0});return c instanceof Promise?c.then(d=>s(d,o,a)):s(c,o,a)}const l=n._zod.parse(o,a);if(l instanceof Promise){if(a.async===!1)throw new dh;return l.then(c=>i(c,r,a))}return i(l,r,a)}}n["~standard"]={validate:i=>{try{const s=jge(n,i);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Vge(n,i).then(o=>o.success?{value:o.data}:{issues:o.error?.issues})}},vendor:"zod",version:1}}),aT=Ye("$ZodString",(n,e)=>{nr.init(n,e),n._zod.pattern=[...n?._zod.bag?.patterns??[]].pop()??bme(n._zod.bag),n._zod.parse=(t,r)=>{if(e.coerce)try{t.value=String(t.value)}catch{}return typeof t.value=="string"||t.issues.push({expected:"string",code:"invalid_type",input:t.value,inst:n}),t}}),hr=Ye("$ZodStringFormat",(n,e)=>{zb.init(n,e),aT.init(n,e)}),zme=Ye("$ZodGUID",(n,e)=>{e.pattern??(e.pattern=ome),hr.init(n,e)}),Bme=Ye("$ZodUUID",(n,e)=>{if(e.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(r===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=vM(r))}else e.pattern??(e.pattern=vM());hr.init(n,e)}),Ume=Ye("$ZodEmail",(n,e)=>{e.pattern??(e.pattern=ame),hr.init(n,e)}),jme=Ye("$ZodURL",(n,e)=>{hr.init(n,e),n._zod.check=t=>{try{const r=t.value.trim(),i=new URL(r);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(i.hostname)||t.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:t.value,inst:n,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||t.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:t.value,inst:n,continue:!e.abort})),e.normalize?t.value=i.href:t.value=r;return}catch{t.issues.push({code:"invalid_format",format:"url",input:t.value,inst:n,continue:!e.abort})}}}),Vme=Ye("$ZodEmoji",(n,e)=>{e.pattern??(e.pattern=cme()),hr.init(n,e)}),qme=Ye("$ZodNanoID",(n,e)=>{e.pattern??(e.pattern=ime),hr.init(n,e)}),Hme=Ye("$ZodCUID",(n,e)=>{e.pattern??(e.pattern=Jge),hr.init(n,e)}),Zme=Ye("$ZodCUID2",(n,e)=>{e.pattern??(e.pattern=eme),hr.init(n,e)}),Wme=Ye("$ZodULID",(n,e)=>{e.pattern??(e.pattern=tme),hr.init(n,e)}),Xme=Ye("$ZodXID",(n,e)=>{e.pattern??(e.pattern=nme),hr.init(n,e)}),Yme=Ye("$ZodKSUID",(n,e)=>{e.pattern??(e.pattern=rme),hr.init(n,e)}),Gme=Ye("$ZodISODateTime",(n,e)=>{e.pattern??(e.pattern=yme(e)),hr.init(n,e)}),Kme=Ye("$ZodISODate",(n,e)=>{e.pattern??(e.pattern=mme),hr.init(n,e)}),Jme=Ye("$ZodISOTime",(n,e)=>{e.pattern??(e.pattern=vme(e)),hr.init(n,e)}),eve=Ye("$ZodISODuration",(n,e)=>{e.pattern??(e.pattern=sme),hr.init(n,e)}),tve=Ye("$ZodIPv4",(n,e)=>{e.pattern??(e.pattern=ume),hr.init(n,e),n._zod.bag.format="ipv4"}),nve=Ye("$ZodIPv6",(n,e)=>{e.pattern??(e.pattern=dme),hr.init(n,e),n._zod.bag.format="ipv6",n._zod.check=t=>{try{new URL(`http://[${t.value}]`)}catch{t.issues.push({code:"invalid_format",format:"ipv6",input:t.value,inst:n,continue:!e.abort})}}}),rve=Ye("$ZodCIDRv4",(n,e)=>{e.pattern??(e.pattern=hme),hr.init(n,e)}),ive=Ye("$ZodCIDRv6",(n,e)=>{e.pattern??(e.pattern=fme),hr.init(n,e),n._zod.check=t=>{const r=t.value.split("/");try{if(r.length!==2)throw new Error;const[i,s]=r;if(!s)throw new Error;const o=Number(s);if(`${o}`!==s)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${i}]`)}catch{t.issues.push({code:"invalid_format",format:"cidrv6",input:t.value,inst:n,continue:!e.abort})}}});function XB(n){if(n==="")return!0;if(n.length%4!==0)return!1;try{return atob(n),!0}catch{return!1}}const sve=Ye("$ZodBase64",(n,e)=>{e.pattern??(e.pattern=pme),hr.init(n,e),n._zod.bag.contentEncoding="base64",n._zod.check=t=>{XB(t.value)||t.issues.push({code:"invalid_format",format:"base64",input:t.value,inst:n,continue:!e.abort})}});function ove(n){if(!jB.test(n))return!1;const e=n.replace(/[-_]/g,r=>r==="-"?"+":"/"),t=e.padEnd(Math.ceil(e.length/4)*4,"=");return XB(t)}const ave=Ye("$ZodBase64URL",(n,e)=>{e.pattern??(e.pattern=jB),hr.init(n,e),n._zod.bag.contentEncoding="base64url",n._zod.check=t=>{ove(t.value)||t.issues.push({code:"invalid_format",format:"base64url",input:t.value,inst:n,continue:!e.abort})}}),lve=Ye("$ZodE164",(n,e)=>{e.pattern??(e.pattern=gme),hr.init(n,e)});function cve(n,e=null){try{const t=n.split(".");if(t.length!==3)return!1;const[r]=t;if(!r)return!1;const i=JSON.parse(atob(r));return!("typ"in i&&i?.typ!=="JWT"||!i.alg||e&&(!("alg"in i)||i.alg!==e))}catch{return!1}}const uve=Ye("$ZodJWT",(n,e)=>{hr.init(n,e),n._zod.check=t=>{cve(t.value,e.alg)||t.issues.push({code:"invalid_format",format:"jwt",input:t.value,inst:n,continue:!e.abort})}}),YB=Ye("$ZodNumber",(n,e)=>{nr.init(n,e),n._zod.pattern=n._zod.bag.pattern??_me,n._zod.parse=(t,r)=>{if(e.coerce)try{t.value=Number(t.value)}catch{}const i=t.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return t;const s=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return t.issues.push({expected:"number",code:"invalid_type",input:i,inst:n,...s?{received:s}:{}}),t}}),dve=Ye("$ZodNumberFormat",(n,e)=>{Ame.init(n,e),YB.init(n,e)}),hve=Ye("$ZodBoolean",(n,e)=>{nr.init(n,e),n._zod.pattern=Ome,n._zod.parse=(t,r)=>{if(e.coerce)try{t.value=!!t.value}catch{}const i=t.value;return typeof i=="boolean"||t.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:n}),t}}),fve=Ye("$ZodNull",(n,e)=>{nr.init(n,e),n._zod.pattern=xme,n._zod.values=new Set([null]),n._zod.parse=(t,r)=>{const i=t.value;return i===null||t.issues.push({expected:"null",code:"invalid_type",input:i,inst:n}),t}}),pve=Ye("$ZodAny",(n,e)=>{nr.init(n,e),n._zod.parse=t=>t}),gve=Ye("$ZodUnknown",(n,e)=>{nr.init(n,e),n._zod.parse=t=>t}),mve=Ye("$ZodNever",(n,e)=>{nr.init(n,e),n._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:n}),t)});function yM(n,e,t){n.issues.length&&e.issues.push(...Wd(t,n.issues)),e.value[t]=n.value}const vve=Ye("$ZodArray",(n,e)=>{nr.init(n,e),n._zod.parse=(t,r)=>{const i=t.value;if(!Array.isArray(i))return t.issues.push({expected:"array",code:"invalid_type",input:i,inst:n}),t;t.value=Array(i.length);const s=[];for(let o=0;o<i.length;o++){const a=i[o],l=e.element._zod.run({value:a,issues:[]},r);l instanceof Promise?s.push(l.then(c=>yM(c,t,o))):yM(l,t,o)}return s.length?Promise.all(s).then(()=>t):t}});function b0(n,e,t,r){n.issues.length&&e.issues.push(...Wd(t,n.issues)),n.value===void 0?t in r&&(e.value[t]=void 0):e.value[t]=n.value}function GB(n){const e=Object.keys(n.shape);for(const r of e)if(!n.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const t=Mge(n.shape);return{...n,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(t)}}function KB(n,e,t,r,i,s){const o=[],a=i.keySet,l=i.catchall._zod,c=l.def.type;for(const d in e){if(a.has(d))continue;if(c==="never"){o.push(d);continue}const h=l.run({value:e[d],issues:[]},r);h instanceof Promise?n.push(h.then(f=>b0(f,t,d,e))):b0(h,t,d,e)}return o.length&&t.issues.push({code:"unrecognized_keys",keys:o,input:e,inst:s}),n.length?Promise.all(n).then(()=>t):t}const yve=Ye("$ZodObject",(n,e)=>{if(nr.init(n,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){const a=e.shape;Object.defineProperty(e,"shape",{get:()=>{const l={...a};return Object.defineProperty(e,"shape",{value:l}),l}})}const r=Qb(()=>GB(e));Mn(n._zod,"propValues",()=>{const a=e.shape,l={};for(const c in a){const d=a[c]._zod;if(d.values){l[c]??(l[c]=new Set);for(const h of d.values)l[c].add(h)}}return l});const i=Sg,s=e.catchall;let o;n._zod.parse=(a,l)=>{o??(o=r.value);const c=a.value;if(!i(c))return a.issues.push({expected:"object",code:"invalid_type",input:c,inst:n}),a;a.value={};const d=[],h=o.shape;for(const f of o.keys){const g=h[f]._zod.run({value:c[f],issues:[]},l);g instanceof Promise?d.push(g.then(m=>b0(m,a,f,c))):b0(g,a,f,c)}return s?KB(d,c,a,l,r.value,n):d.length?Promise.all(d).then(()=>a):a}}),bve=Ye("$ZodObjectJIT",(n,e)=>{yve.init(n,e);const t=n._zod.parse,r=Qb(()=>GB(e)),i=f=>{const p=new $me(["shape","payload","ctx"]),g=r.value,m=_=>{const x=mM(_);return`shape[${x}]._zod.run({ value: input[${x}], issues: [] }, ctx)`};p.write("const input = payload.value;");const v=Object.create(null);let y=0;for(const _ of g.keys)v[_]=`key_${y++}`;p.write("const newResult = {};");for(const _ of g.keys){const x=v[_],k=mM(_);p.write(`const ${x} = ${m(_)};`),p.write(`
        if (${x}.issues.length) {
          payload.issues = payload.issues.concat(${x}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${k}, ...iss.path] : [${k}]
          })));
        }
        
        
        if (${x}.value === undefined) {
          if (${k} in input) {
            newResult[${k}] = undefined;
          }
        } else {
          newResult[${k}] = ${x}.value;
        }
        
      `)}p.write("payload.value = newResult;"),p.write("return payload;");const O=p.compile();return(_,x)=>O(f,_,x)};let s;const o=Sg,a=!LB.jitless,c=a&&Pge.value,d=e.catchall;let h;n._zod.parse=(f,p)=>{h??(h=r.value);const g=f.value;return o(g)?a&&c&&p?.async===!1&&p.jitless!==!0?(s||(s=i(e.shape)),f=s(f,p),d?KB([],g,f,p,h,n):f):t(f,p):(f.issues.push({expected:"object",code:"invalid_type",input:g,inst:n}),f)}});function bM(n,e,t,r){for(const s of n)if(s.issues.length===0)return e.value=s.value,e;const i=n.filter(s=>!Zd(s));return i.length===1?(e.value=i[0].value,i[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:t,errors:n.map(s=>s.issues.map(o=>Tc(o,r,Sc())))}),e)}const JB=Ye("$ZodUnion",(n,e)=>{nr.init(n,e),Mn(n._zod,"optin",()=>e.options.some(i=>i._zod.optin==="optional")?"optional":void 0),Mn(n._zod,"optout",()=>e.options.some(i=>i._zod.optout==="optional")?"optional":void 0),Mn(n._zod,"values",()=>{if(e.options.every(i=>i._zod.values))return new Set(e.options.flatMap(i=>Array.from(i._zod.values)))}),Mn(n._zod,"pattern",()=>{if(e.options.every(i=>i._zod.pattern)){const i=e.options.map(s=>s._zod.pattern);return new RegExp(`^(${i.map(s=>rT(s.source)).join("|")})$`)}});const t=e.options.length===1,r=e.options[0]._zod.run;n._zod.parse=(i,s)=>{if(t)return r(i,s);let o=!1;const a=[];for(const l of e.options){const c=l._zod.run({value:i.value,issues:[]},s);if(c instanceof Promise)a.push(c),o=!0;else{if(c.issues.length===0)return c;a.push(c)}}return o?Promise.all(a).then(l=>bM(l,i,n,s)):bM(a,i,n,s)}}),wve=Ye("$ZodDiscriminatedUnion",(n,e)=>{JB.init(n,e);const t=n._zod.parse;Mn(n._zod,"propValues",()=>{const i={};for(const s of e.options){const o=s._zod.propValues;if(!o||Object.keys(o).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(const[a,l]of Object.entries(o)){i[a]||(i[a]=new Set);for(const c of l)i[a].add(c)}}return i});const r=Qb(()=>{const i=e.options,s=new Map;for(const o of i){const a=o._zod.propValues?.[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(o)}"`);for(const l of a){if(s.has(l))throw new Error(`Duplicate discriminator value "${String(l)}"`);s.set(l,o)}}return s});n._zod.parse=(i,s)=>{const o=i.value;if(!Sg(o))return i.issues.push({code:"invalid_type",expected:"object",input:o,inst:n}),i;const a=r.value.get(o?.[e.discriminator]);return a?a._zod.run(i,s):e.unionFallback?t(i,s):(i.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:o,path:[e.discriminator],inst:n}),i)}}),_ve=Ye("$ZodIntersection",(n,e)=>{nr.init(n,e),n._zod.parse=(t,r)=>{const i=t.value,s=e.left._zod.run({value:i,issues:[]},r),o=e.right._zod.run({value:i,issues:[]},r);return s instanceof Promise||o instanceof Promise?Promise.all([s,o]).then(([l,c])=>wM(t,l,c)):wM(t,s,o)}});function Zx(n,e){if(n===e)return{valid:!0,data:n};if(n instanceof Date&&e instanceof Date&&+n==+e)return{valid:!0,data:n};if(Vh(n)&&Vh(e)){const t=Object.keys(e),r=Object.keys(n).filter(s=>t.indexOf(s)!==-1),i={...n,...e};for(const s of r){const o=Zx(n[s],e[s]);if(!o.valid)return{valid:!1,mergeErrorPath:[s,...o.mergeErrorPath]};i[s]=o.data}return{valid:!0,data:i}}if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return{valid:!1,mergeErrorPath:[]};const t=[];for(let r=0;r<n.length;r++){const i=n[r],s=e[r],o=Zx(i,s);if(!o.valid)return{valid:!1,mergeErrorPath:[r,...o.mergeErrorPath]};t.push(o.data)}return{valid:!0,data:t}}return{valid:!1,mergeErrorPath:[]}}function wM(n,e,t){if(e.issues.length&&n.issues.push(...e.issues),t.issues.length&&n.issues.push(...t.issues),Zd(n))return n;const r=Zx(e.value,t.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return n.value=r.data,n}const Ove=Ye("$ZodRecord",(n,e)=>{nr.init(n,e),n._zod.parse=(t,r)=>{const i=t.value;if(!Vh(i))return t.issues.push({expected:"record",code:"invalid_type",input:i,inst:n}),t;const s=[],o=e.keyType._zod.values;if(o){t.value={};const a=new Set;for(const c of o)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){a.add(typeof c=="number"?c.toString():c);const d=e.valueType._zod.run({value:i[c],issues:[]},r);d instanceof Promise?s.push(d.then(h=>{h.issues.length&&t.issues.push(...Wd(c,h.issues)),t.value[c]=h.value})):(d.issues.length&&t.issues.push(...Wd(c,d.issues)),t.value[c]=d.value)}let l;for(const c in i)a.has(c)||(l=l??[],l.push(c));l&&l.length>0&&t.issues.push({code:"unrecognized_keys",input:i,inst:n,keys:l})}else{t.value={};for(const a of Reflect.ownKeys(i)){if(a==="__proto__")continue;const l=e.keyType._zod.run({value:a,issues:[]},r);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(l.issues.length){t.issues.push({code:"invalid_key",origin:"record",issues:l.issues.map(d=>Tc(d,r,Sc())),input:a,path:[a],inst:n}),t.value[l.value]=l.value;continue}const c=e.valueType._zod.run({value:i[a],issues:[]},r);c instanceof Promise?s.push(c.then(d=>{d.issues.length&&t.issues.push(...Wd(a,d.issues)),t.value[l.value]=d.value})):(c.issues.length&&t.issues.push(...Wd(a,c.issues)),t.value[l.value]=c.value)}}return s.length?Promise.all(s).then(()=>t):t}}),xve=Ye("$ZodEnum",(n,e)=>{nr.init(n,e);const t=QB(e.entries),r=new Set(t);n._zod.values=r,n._zod.pattern=new RegExp(`^(${t.filter(i=>Ige.has(typeof i)).map(i=>typeof i=="string"?qh(i):i.toString()).join("|")})$`),n._zod.parse=(i,s)=>{const o=i.value;return r.has(o)||i.issues.push({code:"invalid_value",values:t,input:o,inst:n}),i}}),kve=Ye("$ZodLiteral",(n,e)=>{if(nr.init(n,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");const t=new Set(e.values);n._zod.values=t,n._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?qh(r):r?qh(r.toString()):String(r)).join("|")})$`),n._zod.parse=(r,i)=>{const s=r.value;return t.has(s)||r.issues.push({code:"invalid_value",values:e.values,input:s,inst:n}),r}}),Sve=Ye("$ZodTransform",(n,e)=>{nr.init(n,e),n._zod.parse=(t,r)=>{if(r.direction==="backward")throw new NB(n.constructor.name);const i=e.transform(t.value,t);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(o=>(t.value=o,t));if(i instanceof Promise)throw new dh;return t.value=i,t}});function _M(n,e){return n.issues.length&&e===void 0?{issues:[],value:void 0}:n}const Tve=Ye("$ZodOptional",(n,e)=>{nr.init(n,e),n._zod.optin="optional",n._zod.optout="optional",Mn(n._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Mn(n._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${rT(t.source)})?$`):void 0}),n._zod.parse=(t,r)=>{if(e.innerType._zod.optin==="optional"){const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(s=>_M(s,t.value)):_M(i,t.value)}return t.value===void 0?t:e.innerType._zod.run(t,r)}}),Ave=Ye("$ZodNullable",(n,e)=>{nr.init(n,e),Mn(n._zod,"optin",()=>e.innerType._zod.optin),Mn(n._zod,"optout",()=>e.innerType._zod.optout),Mn(n._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${rT(t.source)}|null)$`):void 0}),Mn(n._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),n._zod.parse=(t,r)=>t.value===null?t:e.innerType._zod.run(t,r)}),Cve=Ye("$ZodDefault",(n,e)=>{nr.init(n,e),n._zod.optin="optional",Mn(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(t,r)=>{if(r.direction==="backward")return e.innerType._zod.run(t,r);if(t.value===void 0)return t.value=e.defaultValue,t;const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(s=>OM(s,e)):OM(i,e)}});function OM(n,e){return n.value===void 0&&(n.value=e.defaultValue),n}const Eve=Ye("$ZodPrefault",(n,e)=>{nr.init(n,e),n._zod.optin="optional",Mn(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(t,r)=>(r.direction==="backward"||t.value===void 0&&(t.value=e.defaultValue),e.innerType._zod.run(t,r))}),Pve=Ye("$ZodNonOptional",(n,e)=>{nr.init(n,e),Mn(n._zod,"values",()=>{const t=e.innerType._zod.values;return t?new Set([...t].filter(r=>r!==void 0)):void 0}),n._zod.parse=(t,r)=>{const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(s=>xM(s,n)):xM(i,n)}});function xM(n,e){return!n.issues.length&&n.value===void 0&&n.issues.push({code:"invalid_type",expected:"nonoptional",input:n.value,inst:e}),n}const Ive=Ye("$ZodCatch",(n,e)=>{nr.init(n,e),Mn(n._zod,"optin",()=>e.innerType._zod.optin),Mn(n._zod,"optout",()=>e.innerType._zod.optout),Mn(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(t,r)=>{if(r.direction==="backward")return e.innerType._zod.run(t,r);const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(s=>(t.value=s.value,s.issues.length&&(t.value=e.catchValue({...t,error:{issues:s.issues.map(o=>Tc(o,r,Sc()))},input:t.value}),t.issues=[]),t)):(t.value=i.value,i.issues.length&&(t.value=e.catchValue({...t,error:{issues:i.issues.map(s=>Tc(s,r,Sc()))},input:t.value}),t.issues=[]),t)}}),Mve=Ye("$ZodPipe",(n,e)=>{nr.init(n,e),Mn(n._zod,"values",()=>e.in._zod.values),Mn(n._zod,"optin",()=>e.in._zod.optin),Mn(n._zod,"optout",()=>e.out._zod.optout),Mn(n._zod,"propValues",()=>e.in._zod.propValues),n._zod.parse=(t,r)=>{if(r.direction==="backward"){const s=e.out._zod.run(t,r);return s instanceof Promise?s.then(o=>kv(o,e.in,r)):kv(s,e.in,r)}const i=e.in._zod.run(t,r);return i instanceof Promise?i.then(s=>kv(s,e.out,r)):kv(i,e.out,r)}});function kv(n,e,t){return n.issues.length?(n.aborted=!0,n):e._zod.run({value:n.value,issues:n.issues},t)}const Rve=Ye("$ZodReadonly",(n,e)=>{nr.init(n,e),Mn(n._zod,"propValues",()=>e.innerType._zod.propValues),Mn(n._zod,"values",()=>e.innerType._zod.values),Mn(n._zod,"optin",()=>e.innerType?._zod?.optin),Mn(n._zod,"optout",()=>e.innerType?._zod?.optout),n._zod.parse=(t,r)=>{if(r.direction==="backward")return e.innerType._zod.run(t,r);const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(kM):kM(i)}});function kM(n){return n.value=Object.freeze(n.value),n}const Dve=Ye("$ZodLazy",(n,e)=>{nr.init(n,e),Mn(n._zod,"innerType",()=>e.getter()),Mn(n._zod,"pattern",()=>n._zod.innerType?._zod?.pattern),Mn(n._zod,"propValues",()=>n._zod.innerType?._zod?.propValues),Mn(n._zod,"optin",()=>n._zod.innerType?._zod?.optin??void 0),Mn(n._zod,"optout",()=>n._zod.innerType?._zod?.optout??void 0),n._zod.parse=(t,r)=>n._zod.innerType._zod.run(t,r)}),Nve=Ye("$ZodCustom",(n,e)=>{fs.init(n,e),nr.init(n,e),n._zod.parse=(t,r)=>t,n._zod.check=t=>{const r=t.value,i=e.fn(r);if(i instanceof Promise)return i.then(s=>SM(s,t,r,n));SM(i,t,r,n)}});function SM(n,e,t,r){if(!n){const i={code:"custom",input:t,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(i.params=r._zod.def.params),e.issues.push(Tg(i))}}var TM;class e8{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const r=t[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};delete r.id;const i={...r,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function Lve(){return new e8}(TM=globalThis).__zod_globalRegistry??(TM.__zod_globalRegistry=Lve());const lp=globalThis.__zod_globalRegistry;function Qve(n,e){return new n({type:"string",...zt(e)})}function $ve(n,e){return new n({type:"string",format:"email",check:"string_format",abort:!1,...zt(e)})}function AM(n,e){return new n({type:"string",format:"guid",check:"string_format",abort:!1,...zt(e)})}function Fve(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,...zt(e)})}function zve(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...zt(e)})}function Bve(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...zt(e)})}function Uve(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...zt(e)})}function jve(n,e){return new n({type:"string",format:"url",check:"string_format",abort:!1,...zt(e)})}function Vve(n,e){return new n({type:"string",format:"emoji",check:"string_format",abort:!1,...zt(e)})}function qve(n,e){return new n({type:"string",format:"nanoid",check:"string_format",abort:!1,...zt(e)})}function Hve(n,e){return new n({type:"string",format:"cuid",check:"string_format",abort:!1,...zt(e)})}function Zve(n,e){return new n({type:"string",format:"cuid2",check:"string_format",abort:!1,...zt(e)})}function Wve(n,e){return new n({type:"string",format:"ulid",check:"string_format",abort:!1,...zt(e)})}function Xve(n,e){return new n({type:"string",format:"xid",check:"string_format",abort:!1,...zt(e)})}function Yve(n,e){return new n({type:"string",format:"ksuid",check:"string_format",abort:!1,...zt(e)})}function Gve(n,e){return new n({type:"string",format:"ipv4",check:"string_format",abort:!1,...zt(e)})}function Kve(n,e){return new n({type:"string",format:"ipv6",check:"string_format",abort:!1,...zt(e)})}function Jve(n,e){return new n({type:"string",format:"cidrv4",check:"string_format",abort:!1,...zt(e)})}function eye(n,e){return new n({type:"string",format:"cidrv6",check:"string_format",abort:!1,...zt(e)})}function tye(n,e){return new n({type:"string",format:"base64",check:"string_format",abort:!1,...zt(e)})}function nye(n,e){return new n({type:"string",format:"base64url",check:"string_format",abort:!1,...zt(e)})}function rye(n,e){return new n({type:"string",format:"e164",check:"string_format",abort:!1,...zt(e)})}function iye(n,e){return new n({type:"string",format:"jwt",check:"string_format",abort:!1,...zt(e)})}function sye(n,e){return new n({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...zt(e)})}function oye(n,e){return new n({type:"string",format:"date",check:"string_format",...zt(e)})}function aye(n,e){return new n({type:"string",format:"time",check:"string_format",precision:null,...zt(e)})}function lye(n,e){return new n({type:"string",format:"duration",check:"string_format",...zt(e)})}function cye(n,e){return new n({type:"number",checks:[],...zt(e)})}function uye(n,e){return new n({type:"number",check:"number_format",abort:!1,format:"safeint",...zt(e)})}function dye(n,e){return new n({type:"boolean",...zt(e)})}function hye(n,e){return new n({type:"null",...zt(e)})}function fye(n){return new n({type:"any"})}function pye(n){return new n({type:"unknown"})}function gye(n,e){return new n({type:"never",...zt(e)})}function CM(n,e){return new ZB({check:"less_than",...zt(e),value:n,inclusive:!1})}function s_(n,e){return new ZB({check:"less_than",...zt(e),value:n,inclusive:!0})}function EM(n,e){return new WB({check:"greater_than",...zt(e),value:n,inclusive:!1})}function o_(n,e){return new WB({check:"greater_than",...zt(e),value:n,inclusive:!0})}function PM(n,e){return new Tme({check:"multiple_of",...zt(e),value:n})}function t8(n,e){return new Cme({check:"max_length",...zt(e),maximum:n})}function w0(n,e){return new Eme({check:"min_length",...zt(e),minimum:n})}function n8(n,e){return new Pme({check:"length_equals",...zt(e),length:n})}function mye(n,e){return new Ime({check:"string_format",format:"regex",...zt(e),pattern:n})}function vye(n){return new Mme({check:"string_format",format:"lowercase",...zt(n)})}function yye(n){return new Rme({check:"string_format",format:"uppercase",...zt(n)})}function bye(n,e){return new Dme({check:"string_format",format:"includes",...zt(e),includes:n})}function wye(n,e){return new Nme({check:"string_format",format:"starts_with",...zt(e),prefix:n})}function _ye(n,e){return new Lme({check:"string_format",format:"ends_with",...zt(e),suffix:n})}function uf(n){return new Qme({check:"overwrite",tx:n})}function Oye(n){return uf(e=>e.normalize(n))}function xye(){return uf(n=>n.trim())}function kye(){return uf(n=>n.toLowerCase())}function Sye(){return uf(n=>n.toUpperCase())}function Tye(){return uf(n=>Ege(n))}function Aye(n,e,t){return new n({type:"array",element:e,...zt(t)})}function Cye(n,e,t){const r=zt(t);return r.abort??(r.abort=!0),new n({type:"custom",check:"custom",fn:e,...r})}function Eye(n,e,t){return new n({type:"custom",check:"custom",fn:e,...zt(t)})}function Pye(n){const e=Iye(t=>(t.addIssue=r=>{if(typeof r=="string")t.issues.push(Tg(r,t.value,e._zod.def));else{const i=r;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=t.value),i.inst??(i.inst=e),i.continue??(i.continue=!e._zod.def.abort),t.issues.push(Tg(i))}},n(t.value,t)));return e}function Iye(n,e){const t=new fs({check:"custom",...zt(e)});return t._zod.check=n,t}class IM{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??lp,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var r;const i=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},o=this.seen.get(e);if(o)return o.count++,t.schemaPath.includes(e)&&(o.cycle=t.path),o.schema;const a={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,a);const l=e._zod.toJSONSchema?.();if(l)a.schema=l;else{const h={...t,schemaPath:[...t.schemaPath,e],path:t.path},f=e._zod.parent;if(f)a.ref=f,this.process(f,h),this.seen.get(f).isParent=!0;else{const p=a.schema;switch(i.type){case"string":{const g=p;g.type="string";const{minimum:m,maximum:v,format:y,patterns:O,contentEncoding:_}=e._zod.bag;if(typeof m=="number"&&(g.minLength=m),typeof v=="number"&&(g.maxLength=v),y&&(g.format=s[y]??y,g.format===""&&delete g.format),_&&(g.contentEncoding=_),O&&O.size>0){const x=[...O];x.length===1?g.pattern=x[0].source:x.length>1&&(a.schema.allOf=[...x.map(k=>({...this.target==="draft-7"||this.target==="draft-4"||this.target==="openapi-3.0"?{type:"string"}:{},pattern:k.source}))])}break}case"number":{const g=p,{minimum:m,maximum:v,format:y,multipleOf:O,exclusiveMaximum:_,exclusiveMinimum:x}=e._zod.bag;typeof y=="string"&&y.includes("int")?g.type="integer":g.type="number",typeof x=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(g.minimum=x,g.exclusiveMinimum=!0):g.exclusiveMinimum=x),typeof m=="number"&&(g.minimum=m,typeof x=="number"&&this.target!=="draft-4"&&(x>=m?delete g.minimum:delete g.exclusiveMinimum)),typeof _=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(g.maximum=_,g.exclusiveMaximum=!0):g.exclusiveMaximum=_),typeof v=="number"&&(g.maximum=v,typeof _=="number"&&this.target!=="draft-4"&&(_<=v?delete g.maximum:delete g.exclusiveMaximum)),typeof O=="number"&&(g.multipleOf=O);break}case"boolean":{const g=p;g.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{this.target==="openapi-3.0"?(p.type="string",p.nullable=!0,p.enum=[null]):p.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{p.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const g=p,{minimum:m,maximum:v}=e._zod.bag;typeof m=="number"&&(g.minItems=m),typeof v=="number"&&(g.maxItems=v),g.type="array",g.items=this.process(i.element,{...h,path:[...h.path,"items"]});break}case"object":{const g=p;g.type="object",g.properties={};const m=i.shape;for(const O in m)g.properties[O]=this.process(m[O],{...h,path:[...h.path,"properties",O]});const v=new Set(Object.keys(m)),y=new Set([...v].filter(O=>{const _=i.shape[O]._zod;return this.io==="input"?_.optin===void 0:_.optout===void 0}));y.size>0&&(g.required=Array.from(y)),i.catchall?._zod.def.type==="never"?g.additionalProperties=!1:i.catchall?i.catchall&&(g.additionalProperties=this.process(i.catchall,{...h,path:[...h.path,"additionalProperties"]})):this.io==="output"&&(g.additionalProperties=!1);break}case"union":{const g=p,m=i.discriminator!==void 0,v=i.options.map((y,O)=>this.process(y,{...h,path:[...h.path,m?"oneOf":"anyOf",O]}));m?g.oneOf=v:g.anyOf=v;break}case"intersection":{const g=p,m=this.process(i.left,{...h,path:[...h.path,"allOf",0]}),v=this.process(i.right,{...h,path:[...h.path,"allOf",1]}),y=_=>"allOf"in _&&Object.keys(_).length===1,O=[...y(m)?m.allOf:[m],...y(v)?v.allOf:[v]];g.allOf=O;break}case"tuple":{const g=p;g.type="array";const m=this.target==="draft-2020-12"?"prefixItems":"items",v=this.target==="draft-2020-12"||this.target==="openapi-3.0"?"items":"additionalItems",y=i.items.map((k,S)=>this.process(k,{...h,path:[...h.path,m,S]})),O=i.rest?this.process(i.rest,{...h,path:[...h.path,v,...this.target==="openapi-3.0"?[i.items.length]:[]]}):null;this.target==="draft-2020-12"?(g.prefixItems=y,O&&(g.items=O)):this.target==="openapi-3.0"?(g.items={anyOf:y},O&&g.items.anyOf.push(O),g.minItems=y.length,O||(g.maxItems=y.length)):(g.items=y,O&&(g.additionalItems=O));const{minimum:_,maximum:x}=e._zod.bag;typeof _=="number"&&(g.minItems=_),typeof x=="number"&&(g.maxItems=x);break}case"record":{const g=p;g.type="object",(this.target==="draft-7"||this.target==="draft-2020-12")&&(g.propertyNames=this.process(i.keyType,{...h,path:[...h.path,"propertyNames"]})),g.additionalProperties=this.process(i.valueType,{...h,path:[...h.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const g=p,m=QB(i.entries);m.every(v=>typeof v=="number")&&(g.type="number"),m.every(v=>typeof v=="string")&&(g.type="string"),g.enum=m;break}case"literal":{const g=p,m=[];for(const v of i.values)if(v===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof v=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(v))}else m.push(v);if(m.length!==0)if(m.length===1){const v=m[0];g.type=v===null?"null":typeof v,this.target==="draft-4"||this.target==="openapi-3.0"?g.enum=[v]:g.const=v}else m.every(v=>typeof v=="number")&&(g.type="number"),m.every(v=>typeof v=="string")&&(g.type="string"),m.every(v=>typeof v=="boolean")&&(g.type="string"),m.every(v=>v===null)&&(g.type="null"),g.enum=m;break}case"file":{const g=p,m={type:"string",format:"binary",contentEncoding:"binary"},{minimum:v,maximum:y,mime:O}=e._zod.bag;v!==void 0&&(m.minLength=v),y!==void 0&&(m.maxLength=y),O?O.length===1?(m.contentMediaType=O[0],Object.assign(g,m)):g.anyOf=O.map(_=>({...m,contentMediaType:_})):Object.assign(g,m);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const g=this.process(i.innerType,h);this.target==="openapi-3.0"?(a.ref=i.innerType,p.nullable=!0):p.anyOf=[g,{type:"null"}];break}case"nonoptional":{this.process(i.innerType,h),a.ref=i.innerType;break}case"success":{const g=p;g.type="boolean";break}case"default":{this.process(i.innerType,h),a.ref=i.innerType,p.default=JSON.parse(JSON.stringify(i.defaultValue));break}case"prefault":{this.process(i.innerType,h),a.ref=i.innerType,this.io==="input"&&(p._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break}case"catch":{this.process(i.innerType,h),a.ref=i.innerType;let g;try{g=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}p.default=g;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const g=p,m=e._zod.pattern;if(!m)throw new Error("Pattern not found in template literal");g.type="string",g.pattern=m.source;break}case"pipe":{const g=this.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;this.process(g,h),a.ref=g;break}case"readonly":{this.process(i.innerType,h),a.ref=i.innerType,p.readOnly=!0;break}case"promise":{this.process(i.innerType,h),a.ref=i.innerType;break}case"optional":{this.process(i.innerType,h),a.ref=i.innerType;break}case"lazy":{const g=e._zod.innerType;this.process(g,h),a.ref=g;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}case"function":{if(this.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(e);return c&&Object.assign(a.schema,c),this.io==="input"&&Ii(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((r=a.schema).default??(r.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,t){const r={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},i=this.seen.get(e);if(!i)throw new Error("Unprocessed schema. This is a bug in Zod.");const s=d=>{const h=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const m=r.external.registry.get(d[0])?.id,v=r.external.uri??(O=>O);if(m)return{ref:v(m)};const y=d[1].defId??d[1].schema.id??`schema${this.counter++}`;return d[1].defId=y,{defId:y,ref:`${v("__shared")}#/${h}/${y}`}}if(d[1]===i)return{ref:"#"};const p=`#/${h}/`,g=d[1].schema.id??`__schema${this.counter++}`;return{defId:g,ref:p+g}},o=d=>{if(d[1].schema.$ref)return;const h=d[1],{ref:f,defId:p}=s(d);h.def={...h.schema},p&&(h.defId=p);const g=h.schema;for(const m in g)delete g[m];g.$ref=f};if(r.cycles==="throw")for(const d of this.seen.entries()){const h=d[1];if(h.cycle)throw new Error(`Cycle detected: #/${h.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const d of this.seen.entries()){const h=d[1];if(e===d[0]){o(d);continue}if(r.external){const p=r.external.registry.get(d[0])?.id;if(e!==d[0]&&p){o(d);continue}}if(this.metadataRegistry.get(d[0])?.id){o(d);continue}if(h.cycle){o(d);continue}if(h.count>1&&r.reused==="ref"){o(d);continue}}const a=(d,h)=>{const f=this.seen.get(d),p=f.def??f.schema,g={...p};if(f.ref===null)return;const m=f.ref;if(f.ref=null,m){a(m,h);const v=this.seen.get(m).schema;v.$ref&&(h.target==="draft-7"||h.target==="draft-4"||h.target==="openapi-3.0")?(p.allOf=p.allOf??[],p.allOf.push(v)):(Object.assign(p,v),Object.assign(p,g))}f.isParent||this.override({zodSchema:d,jsonSchema:p,path:f.path??[]})};for(const d of[...this.seen.entries()].reverse())a(d[0],{target:this.target});const l={};if(this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?l.$schema="http://json-schema.org/draft-04/schema#":this.target==="openapi-3.0"||console.warn(`Invalid target: ${this.target}`),r.external?.uri){const d=r.external.registry.get(e)?.id;if(!d)throw new Error("Schema is missing an `id` property");l.$id=r.external.uri(d)}Object.assign(l,i.def);const c=r.external?.defs??{};for(const d of this.seen.entries()){const h=d[1];h.def&&h.defId&&(c[h.defId]=h.def)}r.external||Object.keys(c).length>0&&(this.target==="draft-2020-12"?l.$defs=c:l.definitions=c);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function Mye(n,e){if(n instanceof e8){const r=new IM(e),i={};for(const a of n._idmap.entries()){const[l,c]=a;r.process(c)}const s={},o={registry:n,uri:e?.uri,defs:i};for(const a of n._idmap.entries()){const[l,c]=a;s[l]=r.emit(c,{...e,external:o})}if(Object.keys(i).length>0){const a=r.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[a]:i}}return{schemas:s}}const t=new IM(e);return t.process(n),t.emit(n,e)}function Ii(n,e){const t=e??{seen:new Set};if(t.seen.has(n))return!1;t.seen.add(n);const r=n._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return Ii(r.element,t);if(r.type==="set")return Ii(r.valueType,t);if(r.type==="lazy")return Ii(r.getter(),t);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return Ii(r.innerType,t);if(r.type==="intersection")return Ii(r.left,t)||Ii(r.right,t);if(r.type==="record"||r.type==="map")return Ii(r.keyType,t)||Ii(r.valueType,t);if(r.type==="pipe")return Ii(r.in,t)||Ii(r.out,t);if(r.type==="object"){for(const i in r.shape)if(Ii(r.shape[i],t))return!0;return!1}if(r.type==="union"){for(const i of r.options)if(Ii(i,t))return!0;return!1}if(r.type==="tuple"){for(const i of r.items)if(Ii(i,t))return!0;return!!(r.rest&&Ii(r.rest,t))}return!1}const Rye=Ye("ZodISODateTime",(n,e)=>{Gme.init(n,e),mr.init(n,e)});function Dye(n){return sye(Rye,n)}const Nye=Ye("ZodISODate",(n,e)=>{Kme.init(n,e),mr.init(n,e)});function Lye(n){return oye(Nye,n)}const Qye=Ye("ZodISOTime",(n,e)=>{Jme.init(n,e),mr.init(n,e)});function $ye(n){return aye(Qye,n)}const Fye=Ye("ZodISODuration",(n,e)=>{eve.init(n,e),mr.init(n,e)});function zye(n){return lye(Fye,n)}const Bye=(n,e)=>{BB.init(n,e),n.name="ZodError",Object.defineProperties(n,{format:{value:t=>Uge(n,t)},flatten:{value:t=>Bge(n,t)},addIssue:{value:t=>{n.issues.push(t),n.message=JSON.stringify(n.issues,Hx,2)}},addIssues:{value:t=>{n.issues.push(...t),n.message=JSON.stringify(n.issues,Hx,2)}},isEmpty:{get(){return n.issues.length===0}}})},So=Ye("ZodError",Bye,{Parent:Error}),Uye=sT(So),jye=oT(So),Vye=$b(So),r8=Fb(So),qye=qge(So),Hye=Hge(So),Zye=Zge(So),Wye=Wge(So),Xye=Xge(So),Yye=Yge(So),Gye=Gge(So),Kye=Kge(So),or=Ye("ZodType",(n,e)=>(nr.init(n,e),n.def=e,n.type=e.type,Object.defineProperty(n,"_def",{value:e}),n.check=(...t)=>n.clone(Gu(e,{checks:[...e.checks??[],...t.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]})),n.clone=(t,r)=>Ic(n,t,r),n.brand=()=>n,n.register=((t,r)=>(t.add(n,r),n)),n.parse=(t,r)=>Uye(n,t,r,{callee:n.parse}),n.safeParse=(t,r)=>Vye(n,t,r),n.parseAsync=async(t,r)=>jye(n,t,r,{callee:n.parseAsync}),n.safeParseAsync=async(t,r)=>r8(n,t,r),n.spa=n.safeParseAsync,n.encode=(t,r)=>qye(n,t,r),n.decode=(t,r)=>Hye(n,t,r),n.encodeAsync=async(t,r)=>Zye(n,t,r),n.decodeAsync=async(t,r)=>Wye(n,t,r),n.safeEncode=(t,r)=>Xye(n,t,r),n.safeDecode=(t,r)=>Yye(n,t,r),n.safeEncodeAsync=async(t,r)=>Gye(n,t,r),n.safeDecodeAsync=async(t,r)=>Kye(n,t,r),n.refine=(t,r)=>n.check(X0e(t,r)),n.superRefine=t=>n.check(Y0e(t)),n.overwrite=t=>n.check(uf(t)),n.optional=()=>DM(n),n.nullable=()=>NM(n),n.nullish=()=>DM(NM(n)),n.nonoptional=t=>z0e(n,t),n.array=()=>Xt(n),n.or=t=>Xn([n,t]),n.and=t=>P0e(n,t),n.transform=t=>LM(n,D0e(t)),n.default=t=>Q0e(n,t),n.prefault=t=>F0e(n,t),n.catch=t=>U0e(n,t),n.pipe=t=>LM(n,t),n.readonly=()=>q0e(n),n.describe=t=>{const r=n.clone();return lp.add(r,{description:t}),r},Object.defineProperty(n,"description",{get(){return lp.get(n)?.description},configurable:!0}),n.meta=(...t)=>{if(t.length===0)return lp.get(n);const r=n.clone();return lp.add(r,t[0]),r},n.isOptional=()=>n.safeParse(void 0).success,n.isNullable=()=>n.safeParse(null).success,n)),i8=Ye("_ZodString",(n,e)=>{aT.init(n,e),or.init(n,e);const t=n._zod.bag;n.format=t.format??null,n.minLength=t.minimum??null,n.maxLength=t.maximum??null,n.regex=(...r)=>n.check(mye(...r)),n.includes=(...r)=>n.check(bye(...r)),n.startsWith=(...r)=>n.check(wye(...r)),n.endsWith=(...r)=>n.check(_ye(...r)),n.min=(...r)=>n.check(w0(...r)),n.max=(...r)=>n.check(t8(...r)),n.length=(...r)=>n.check(n8(...r)),n.nonempty=(...r)=>n.check(w0(1,...r)),n.lowercase=r=>n.check(vye(r)),n.uppercase=r=>n.check(yye(r)),n.trim=()=>n.check(xye()),n.normalize=(...r)=>n.check(Oye(...r)),n.toLowerCase=()=>n.check(kye()),n.toUpperCase=()=>n.check(Sye()),n.slugify=()=>n.check(Tye())}),Jye=Ye("ZodString",(n,e)=>{aT.init(n,e),i8.init(n,e),n.email=t=>n.check($ve(e0e,t)),n.url=t=>n.check(jve(t0e,t)),n.jwt=t=>n.check(iye(m0e,t)),n.emoji=t=>n.check(Vve(n0e,t)),n.guid=t=>n.check(AM(MM,t)),n.uuid=t=>n.check(Fve(Sv,t)),n.uuidv4=t=>n.check(zve(Sv,t)),n.uuidv6=t=>n.check(Bve(Sv,t)),n.uuidv7=t=>n.check(Uve(Sv,t)),n.nanoid=t=>n.check(qve(r0e,t)),n.guid=t=>n.check(AM(MM,t)),n.cuid=t=>n.check(Hve(i0e,t)),n.cuid2=t=>n.check(Zve(s0e,t)),n.ulid=t=>n.check(Wve(o0e,t)),n.base64=t=>n.check(tye(f0e,t)),n.base64url=t=>n.check(nye(p0e,t)),n.xid=t=>n.check(Xve(a0e,t)),n.ksuid=t=>n.check(Yve(l0e,t)),n.ipv4=t=>n.check(Gve(c0e,t)),n.ipv6=t=>n.check(Kve(u0e,t)),n.cidrv4=t=>n.check(Jve(d0e,t)),n.cidrv6=t=>n.check(eye(h0e,t)),n.e164=t=>n.check(rye(g0e,t)),n.datetime=t=>n.check(Dye(t)),n.date=t=>n.check(Lye(t)),n.time=t=>n.check($ye(t)),n.duration=t=>n.check(zye(t))});function Ce(n){return Qve(Jye,n)}const mr=Ye("ZodStringFormat",(n,e)=>{hr.init(n,e),i8.init(n,e)}),e0e=Ye("ZodEmail",(n,e)=>{Ume.init(n,e),mr.init(n,e)}),MM=Ye("ZodGUID",(n,e)=>{zme.init(n,e),mr.init(n,e)}),Sv=Ye("ZodUUID",(n,e)=>{Bme.init(n,e),mr.init(n,e)}),t0e=Ye("ZodURL",(n,e)=>{jme.init(n,e),mr.init(n,e)}),n0e=Ye("ZodEmoji",(n,e)=>{Vme.init(n,e),mr.init(n,e)}),r0e=Ye("ZodNanoID",(n,e)=>{qme.init(n,e),mr.init(n,e)}),i0e=Ye("ZodCUID",(n,e)=>{Hme.init(n,e),mr.init(n,e)}),s0e=Ye("ZodCUID2",(n,e)=>{Zme.init(n,e),mr.init(n,e)}),o0e=Ye("ZodULID",(n,e)=>{Wme.init(n,e),mr.init(n,e)}),a0e=Ye("ZodXID",(n,e)=>{Xme.init(n,e),mr.init(n,e)}),l0e=Ye("ZodKSUID",(n,e)=>{Yme.init(n,e),mr.init(n,e)}),c0e=Ye("ZodIPv4",(n,e)=>{tve.init(n,e),mr.init(n,e)}),u0e=Ye("ZodIPv6",(n,e)=>{nve.init(n,e),mr.init(n,e)}),d0e=Ye("ZodCIDRv4",(n,e)=>{rve.init(n,e),mr.init(n,e)}),h0e=Ye("ZodCIDRv6",(n,e)=>{ive.init(n,e),mr.init(n,e)}),f0e=Ye("ZodBase64",(n,e)=>{sve.init(n,e),mr.init(n,e)}),p0e=Ye("ZodBase64URL",(n,e)=>{ave.init(n,e),mr.init(n,e)}),g0e=Ye("ZodE164",(n,e)=>{lve.init(n,e),mr.init(n,e)}),m0e=Ye("ZodJWT",(n,e)=>{uve.init(n,e),mr.init(n,e)}),s8=Ye("ZodNumber",(n,e)=>{YB.init(n,e),or.init(n,e),n.gt=(r,i)=>n.check(EM(r,i)),n.gte=(r,i)=>n.check(o_(r,i)),n.min=(r,i)=>n.check(o_(r,i)),n.lt=(r,i)=>n.check(CM(r,i)),n.lte=(r,i)=>n.check(s_(r,i)),n.max=(r,i)=>n.check(s_(r,i)),n.int=r=>n.check(RM(r)),n.safe=r=>n.check(RM(r)),n.positive=r=>n.check(EM(0,r)),n.nonnegative=r=>n.check(o_(0,r)),n.negative=r=>n.check(CM(0,r)),n.nonpositive=r=>n.check(s_(0,r)),n.multipleOf=(r,i)=>n.check(PM(r,i)),n.step=(r,i)=>n.check(PM(r,i)),n.finite=()=>n;const t=n._zod.bag;n.minValue=Math.max(t.minimum??Number.NEGATIVE_INFINITY,t.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,n.maxValue=Math.min(t.maximum??Number.POSITIVE_INFINITY,t.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,n.isInt=(t.format??"").includes("int")||Number.isSafeInteger(t.multipleOf??.5),n.isFinite=!0,n.format=t.format??null});function St(n){return cye(s8,n)}const v0e=Ye("ZodNumberFormat",(n,e)=>{dve.init(n,e),s8.init(n,e)});function RM(n){return uye(v0e,n)}const y0e=Ye("ZodBoolean",(n,e)=>{hve.init(n,e),or.init(n,e)});function Cs(n){return dye(y0e,n)}const b0e=Ye("ZodNull",(n,e)=>{fve.init(n,e),or.init(n,e)});function w0e(n){return hye(b0e,n)}const _0e=Ye("ZodAny",(n,e)=>{pve.init(n,e),or.init(n,e)});function gl(){return fye(_0e)}const O0e=Ye("ZodUnknown",(n,e)=>{gve.init(n,e),or.init(n,e)});function Il(){return pye(O0e)}const x0e=Ye("ZodNever",(n,e)=>{mve.init(n,e),or.init(n,e)});function k0e(n){return gye(x0e,n)}const S0e=Ye("ZodArray",(n,e)=>{vve.init(n,e),or.init(n,e),n.element=e.element,n.min=(t,r)=>n.check(w0(t,r)),n.nonempty=t=>n.check(w0(1,t)),n.max=(t,r)=>n.check(t8(t,r)),n.length=(t,r)=>n.check(n8(t,r)),n.unwrap=()=>n.element});function Xt(n,e){return Aye(S0e,n,e)}const T0e=Ye("ZodObject",(n,e)=>{bve.init(n,e),or.init(n,e),Mn(n,"shape",()=>e.shape),n.keyof=()=>cr(Object.keys(n._zod.def.shape)),n.catchall=t=>n.clone({...n._zod.def,catchall:t}),n.passthrough=()=>n.clone({...n._zod.def,catchall:Il()}),n.loose=()=>n.clone({...n._zod.def,catchall:Il()}),n.strict=()=>n.clone({...n._zod.def,catchall:k0e()}),n.strip=()=>n.clone({...n._zod.def,catchall:void 0}),n.extend=t=>Lge(n,t),n.safeExtend=t=>Qge(n,t),n.merge=t=>$ge(n,t),n.pick=t=>Dge(n,t),n.omit=t=>Nge(n,t),n.partial=(...t)=>Fge(a8,n,t[0]),n.required=(...t)=>zge(l8,n,t[0])});function je(n,e){const t={type:"object",shape:n??{},...zt(e)};return new T0e(t)}const o8=Ye("ZodUnion",(n,e)=>{JB.init(n,e),or.init(n,e),n.options=e.options});function Xn(n,e){return new o8({type:"union",options:n,...zt(e)})}const A0e=Ye("ZodDiscriminatedUnion",(n,e)=>{o8.init(n,e),wve.init(n,e)});function C0e(n,e,t){return new A0e({type:"union",options:e,discriminator:n,...zt(t)})}const E0e=Ye("ZodIntersection",(n,e)=>{_ve.init(n,e),or.init(n,e)});function P0e(n,e){return new E0e({type:"intersection",left:n,right:e})}const I0e=Ye("ZodRecord",(n,e)=>{Ove.init(n,e),or.init(n,e),n.keyType=e.keyType,n.valueType=e.valueType});function Mu(n,e,t){return new I0e({type:"record",keyType:n,valueType:e,...zt(t)})}const Wx=Ye("ZodEnum",(n,e)=>{xve.init(n,e),or.init(n,e),n.enum=e.entries,n.options=Object.values(e.entries);const t=new Set(Object.keys(e.entries));n.extract=(r,i)=>{const s={};for(const o of r)if(t.has(o))s[o]=e.entries[o];else throw new Error(`Key ${o} not found in enum`);return new Wx({...e,checks:[],...zt(i),entries:s})},n.exclude=(r,i)=>{const s={...e.entries};for(const o of r)if(t.has(o))delete s[o];else throw new Error(`Key ${o} not found in enum`);return new Wx({...e,checks:[],...zt(i),entries:s})}});function cr(n,e){const t=Array.isArray(n)?Object.fromEntries(n.map(r=>[r,r])):n;return new Wx({type:"enum",entries:t,...zt(e)})}const M0e=Ye("ZodLiteral",(n,e)=>{kve.init(n,e),or.init(n,e),n.values=new Set(e.values),Object.defineProperty(n,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function dn(n,e){return new M0e({type:"literal",values:Array.isArray(n)?n:[n],...zt(e)})}const R0e=Ye("ZodTransform",(n,e)=>{Sve.init(n,e),or.init(n,e),n._zod.parse=(t,r)=>{if(r.direction==="backward")throw new NB(n.constructor.name);t.addIssue=s=>{if(typeof s=="string")t.issues.push(Tg(s,t.value,e));else{const o=s;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=t.value),o.inst??(o.inst=n),t.issues.push(Tg(o))}};const i=e.transform(t.value,t);return i instanceof Promise?i.then(s=>(t.value=s,t)):(t.value=i,t)}});function D0e(n){return new R0e({type:"transform",transform:n})}const a8=Ye("ZodOptional",(n,e)=>{Tve.init(n,e),or.init(n,e),n.unwrap=()=>n._zod.def.innerType});function DM(n){return new a8({type:"optional",innerType:n})}const N0e=Ye("ZodNullable",(n,e)=>{Ave.init(n,e),or.init(n,e),n.unwrap=()=>n._zod.def.innerType});function NM(n){return new N0e({type:"nullable",innerType:n})}const L0e=Ye("ZodDefault",(n,e)=>{Cve.init(n,e),or.init(n,e),n.unwrap=()=>n._zod.def.innerType,n.removeDefault=n.unwrap});function Q0e(n,e){return new L0e({type:"default",innerType:n,get defaultValue(){return typeof e=="function"?e():FB(e)}})}const $0e=Ye("ZodPrefault",(n,e)=>{Eve.init(n,e),or.init(n,e),n.unwrap=()=>n._zod.def.innerType});function F0e(n,e){return new $0e({type:"prefault",innerType:n,get defaultValue(){return typeof e=="function"?e():FB(e)}})}const l8=Ye("ZodNonOptional",(n,e)=>{Pve.init(n,e),or.init(n,e),n.unwrap=()=>n._zod.def.innerType});function z0e(n,e){return new l8({type:"nonoptional",innerType:n,...zt(e)})}const B0e=Ye("ZodCatch",(n,e)=>{Ive.init(n,e),or.init(n,e),n.unwrap=()=>n._zod.def.innerType,n.removeCatch=n.unwrap});function U0e(n,e){return new B0e({type:"catch",innerType:n,catchValue:typeof e=="function"?e:()=>e})}const j0e=Ye("ZodPipe",(n,e)=>{Mve.init(n,e),or.init(n,e),n.in=e.in,n.out=e.out});function LM(n,e){return new j0e({type:"pipe",in:n,out:e})}const V0e=Ye("ZodReadonly",(n,e)=>{Rve.init(n,e),or.init(n,e),n.unwrap=()=>n._zod.def.innerType});function q0e(n){return new V0e({type:"readonly",innerType:n})}const H0e=Ye("ZodLazy",(n,e)=>{Dve.init(n,e),or.init(n,e),n.unwrap=()=>n._zod.def.getter()});function Z0e(n){return new H0e({type:"lazy",getter:n})}const lT=Ye("ZodCustom",(n,e)=>{Nve.init(n,e),or.init(n,e)});function W0e(n,e){return Cye(lT,n??(()=>!0),e)}function X0e(n,e={}){return Eye(lT,n,e)}function Y0e(n){return Pye(n)}function _0(n,e={error:`Input not instance of ${n.name}`}){const t=new lT({type:"custom",check:"custom",fn:r=>r instanceof n,abort:!0,...zt(e)});return t._zod.bag.Class=n,t}var Ag;(function(n){n.assertEqual=i=>{};function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const s={};for(const o of i)s[o]=o;return s},n.getValidEnumValues=i=>{const s=n.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(const a of s)o[a]=i[a];return n.objectValues(o)},n.objectValues=i=>n.objectKeys(i).map(function(s){return i[s]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&s.push(o);return s},n.find=(i,s)=>{for(const o of i)if(s(o))return o},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}n.joinValues=r,n.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(Ag||(Ag={}));var QM;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(QM||(QM={}));Ag.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);Ag.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class O0 extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(s){return s.message},r={_errors:[]},i=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)r._errors.push(t(o));else{let a=r,l=0;for(;l<o.path.length;){const c=o.path[l];l===o.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(t(o))):a[c]=a[c]||{_errors:[]},a=a[c],l++}}};return i(this),r}static assert(e){if(!(e instanceof O0))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ag.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t=Object.create(null),r=[];for(const i of this.issues)if(i.path.length>0){const s=i.path[0];t[s]=t[s]||[],t[s].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}O0.create=n=>new O0(n);var $M;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})($M||($M={}));var sn;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(sn||(sn={}));var G0e={};function x0(...n){return n.reduce((e,t)=>({...e,...t??{}}),{})}async function K0e(n,e){if(n==null)return Promise.resolve();const t=e?.abortSignal;return new Promise((r,i)=>{if(t?.aborted){i(FM());return}const s=setTimeout(()=>{o(),r()},n),o=()=>{clearTimeout(s),t?.removeEventListener("abort",a)},a=()=>{o(),i(FM())};t?.addEventListener("abort",a)})}function FM(){return new DOMException("Delay was aborted","AbortError")}var Tv=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise?this._promise:(this._promise=new Promise((n,e)=>{this.status.type==="resolved"?n(this.status.value):this.status.type==="rejected"&&e(this.status.error),this._resolve=n,this._reject=e}),this._promise)}resolve(n){var e;this.status={type:"resolved",value:n},this._promise&&((e=this._resolve)==null||e.call(this,n))}reject(n){var e;this.status={type:"rejected",error:n},this._promise&&((e=this._reject)==null||e.call(this,n))}isResolved(){return this.status.type==="resolved"}isRejected(){return this.status.type==="rejected"}isPending(){return this.status.type==="pending"}};function mm(n){return Object.fromEntries([...n.headers])}var vm=({prefix:n,size:e=16,alphabet:t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const i=()=>{const s=t.length,o=new Array(e);for(let a=0;a<e;a++)o[a]=t[Math.random()*s|0];return o.join("")};if(n==null)return i;if(t.includes(r))throw new wge({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${t}".`});return()=>`${n}${r}${i()}`},J0e=vm();function c8(n){return n==null?"unknown error":typeof n=="string"?n:n instanceof Error?n.message:JSON.stringify(n)}function Ru(n){return(n instanceof Error||n instanceof DOMException)&&(n.name==="AbortError"||n.name==="ResponseAborted"||n.name==="TimeoutError")}var ebe=["fetch failed","failed to fetch"];function u8({error:n,url:e,requestBodyValues:t}){if(Ru(n))return n;if(n instanceof TypeError&&ebe.includes(n.message.toLowerCase())){const r=n.cause;if(r!=null)return new Bi({message:`Cannot connect to API: ${r.message}`,cause:r,url:e,requestBodyValues:t,isRetryable:!0})}return n}function cT(n=globalThis){var e,t,r;return n.window?"runtime/browser":(e=n.navigator)!=null&&e.userAgent?`runtime/${n.navigator.userAgent.toLowerCase()}`:(r=(t=n.process)==null?void 0:t.versions)!=null&&r.node?`runtime/node.js/${n.process.version.substring(0)}`:n.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function tbe(n){if(n==null)return{};const e={};if(n instanceof Headers)n.forEach((t,r)=>{e[r.toLowerCase()]=t});else{Array.isArray(n)||(n=Object.entries(n));for(const[t,r]of n)r!=null&&(e[t.toLowerCase()]=r)}return e}function Bb(n,...e){const t=new Headers(tbe(n)),r=t.get("user-agent")||"";return t.set("user-agent",[r,...e].filter(Boolean).join(" ")),Object.fromEntries(t.entries())}var d8="3.0.19",nbe=()=>globalThis.fetch,zM=async({url:n,headers:e={},successfulResponseHandler:t,failedResponseHandler:r,abortSignal:i,fetch:s=nbe()})=>{try{const o=await s(n,{method:"GET",headers:Bb(e,`ai-sdk/provider-utils/${d8}`,cT()),signal:i}),a=mm(o);if(!o.ok){let l;try{l=await r({response:o,url:n,requestBodyValues:{}})}catch(c){throw Ru(c)||Bi.isInstance(c)?c:new Bi({message:"Failed to process error response",cause:c,statusCode:o.status,url:n,responseHeaders:a,requestBodyValues:{}})}throw l.value}try{return await t({response:o,url:n,requestBodyValues:{}})}catch(l){throw l instanceof Error&&(Ru(l)||Bi.isInstance(l))?l:new Bi({message:"Failed to process successful response",cause:l,statusCode:o.status,url:n,responseHeaders:a,requestBodyValues:{}})}}catch(o){throw u8({error:o,url:n,requestBodyValues:{}})}};function rbe({mediaType:n,url:e,supportedUrls:t}){return e=e.toLowerCase(),n=n.toLowerCase(),Object.entries(t).map(([r,i])=>{const s=r.toLowerCase();return s==="*"||s==="*/*"?{mediaTypePrefix:"",regexes:i}:{mediaTypePrefix:s.replace(/\*/,""),regexes:i}}).filter(({mediaTypePrefix:r})=>n.startsWith(r)).flatMap(({regexes:r})=>r).some(r=>r.test(e))}function sy({settingValue:n,environmentVariableName:e}){if(typeof n=="string")return n;if(!(n!=null||typeof process>"u")&&(n=G0e[e],!(n==null||typeof n!="string")))return n}var ibe=/"__proto__"\s*:/,sbe=/"constructor"\s*:/;function BM(n){const e=JSON.parse(n);return e===null||typeof e!="object"||ibe.test(n)===!1&&sbe.test(n)===!1?e:obe(e)}function obe(n){let e=[n];for(;e.length;){const t=e;e=[];for(const r of t){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const i in r){const s=r[i];s&&typeof s=="object"&&e.push(s)}}}return n}function h8(n){const{stackTraceLimit:e}=Error;try{Error.stackTraceLimit=0}catch{return BM(n)}try{return BM(n)}finally{Error.stackTraceLimit=e}}var k0=Symbol.for("vercel.ai.validator");function abe(n){return{[k0]:!0,validate:n}}function lbe(n){return typeof n=="object"&&n!==null&&k0 in n&&n[k0]===!0&&"validate"in n}function df(n){let e;return()=>(e==null&&(e=n()),e)}function cbe(n){return lbe(n)?n:typeof n=="function"?n():ube(n)}function ube(n){return abe(async e=>{const t=await n["~standard"].validate(e);return t.issues==null?{success:!0,value:t.value}:{success:!1,error:new kg({value:e,cause:t.issues})}})}async function Xx({value:n,schema:e}){const t=await Ac({value:n,schema:e});if(!t.success)throw kg.wrap({value:n,cause:t.error});return t.value}async function Ac({value:n,schema:e}){const t=cbe(e);try{if(t.validate==null)return{success:!0,value:n,rawValue:n};const r=await t.validate(n);return r.success?{success:!0,value:r.value,rawValue:n}:{success:!1,error:kg.wrap({value:n,cause:r.error}),rawValue:n}}catch(r){return{success:!1,error:kg.wrap({value:n,cause:r}),rawValue:n}}}async function dbe({text:n,schema:e}){try{const t=h8(n);return e==null?t:Xx({value:t,schema:e})}catch(t){throw y0.isInstance(t)||kg.isInstance(t)?t:new y0({text:n,cause:t})}}async function Du({text:n,schema:e}){try{const t=h8(n);return e==null?{success:!0,value:t,rawValue:t}:await Ac({value:t,schema:e})}catch(t){return{success:!1,error:y0.isInstance(t)?t:new y0({text:n,cause:t}),rawValue:void 0}}}function hbe({stream:n,schema:e}){return n.pipeThrough(new TextDecoderStream).pipeThrough(new Age).pipeThrough(new TransformStream({async transform({data:t},r){t!=="[DONE]"&&r.enqueue(await Du({text:t,schema:e}))}}))}var fbe=()=>globalThis.fetch,S0=async({url:n,headers:e,body:t,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:s,fetch:o})=>pbe({url:n,headers:{"Content-Type":"application/json",...e},body:{content:JSON.stringify(t),values:t},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:s,fetch:o}),pbe=async({url:n,headers:e={},body:t,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:s,fetch:o=fbe()})=>{try{const a=await o(n,{method:"POST",headers:Bb(e,`ai-sdk/provider-utils/${d8}`,cT()),body:t.content,signal:s}),l=mm(a);if(!a.ok){let c;try{c=await i({response:a,url:n,requestBodyValues:t.values})}catch(d){throw Ru(d)||Bi.isInstance(d)?d:new Bi({message:"Failed to process error response",cause:d,statusCode:a.status,url:n,responseHeaders:l,requestBodyValues:t.values})}throw c.value}try{return await r({response:a,url:n,requestBodyValues:t.values})}catch(c){throw c instanceof Error&&(Ru(c)||Bi.isInstance(c))?c:new Bi({message:"Failed to process successful response",cause:c,statusCode:a.status,url:n,responseHeaders:l,requestBodyValues:t.values})}}catch(a){throw u8({error:a,url:n,requestBodyValues:t.values})}};async function Ia(n){return typeof n=="function"&&(n=n()),Promise.resolve(n)}var Hh=({errorSchema:n,errorToMessage:e,isRetryable:t})=>async({response:r,url:i,requestBodyValues:s})=>{const o=await r.text(),a=mm(r);if(o.trim()==="")return{responseHeaders:a,value:new Bi({message:r.statusText,url:i,requestBodyValues:s,statusCode:r.status,responseHeaders:a,responseBody:o,isRetryable:t?.(r)})};try{const l=await dbe({text:o,schema:n});return{responseHeaders:a,value:new Bi({message:e(l),url:i,requestBodyValues:s,statusCode:r.status,responseHeaders:a,responseBody:o,data:l,isRetryable:t?.(r,l)})}}catch{return{responseHeaders:a,value:new Bi({message:r.statusText,url:i,requestBodyValues:s,statusCode:r.status,responseHeaders:a,responseBody:o,isRetryable:t?.(r)})}}},gbe=n=>async({response:e})=>{const t=mm(e);if(e.body==null)throw new yge({});return{responseHeaders:t,value:hbe({stream:e.body,schema:n})}},Cg=n=>async({response:e,url:t,requestBodyValues:r})=>{const i=await e.text(),s=await Du({text:i,schema:n}),o=mm(e);if(!s.success)throw new Bi({message:"Invalid JSON response",cause:s.error,statusCode:e.status,responseHeaders:o,responseBody:i,url:t,requestBodyValues:r});return{responseHeaders:o,value:s.value,rawValue:s.rawValue}};function oy(n){if(n.type==="object"){n.additionalProperties=!1;const e=n.properties;if(e!=null)for(const t in e)e[t]=oy(e[t])}return n.type==="array"&&n.items!=null&&(Array.isArray(n.items)?n.items=n.items.map(e=>oy(e)):n.items=oy(n.items)),n}var mbe=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},vbe=Symbol("Let zodToJsonSchema decide on which parser to use"),UM={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},ybe=n=>typeof n=="string"?{...UM,name:n}:{...UM,...n};function $s(){return{}}function bbe(n,e){var t,r,i;const s={type:"array"};return(t=n.type)!=null&&t._def&&((i=(r=n.type)==null?void 0:r._def)==null?void 0:i.typeName)!==sn.ZodAny&&(s.items=jn(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&(s.minItems=n.minLength.value),n.maxLength&&(s.maxItems=n.maxLength.value),n.exactLength&&(s.minItems=n.exactLength.value,s.maxItems=n.exactLength.value),s}function wbe(n){const e={type:"integer",format:"int64"};if(!n.checks)return e;for(const t of n.checks)switch(t.kind){case"min":t.inclusive?e.minimum=t.value:e.exclusiveMinimum=t.value;break;case"max":t.inclusive?e.maximum=t.value:e.exclusiveMaximum=t.value;break;case"multipleOf":e.multipleOf=t.value;break}return e}function _be(){return{type:"boolean"}}function f8(n,e){return jn(n.type._def,e)}var Obe=(n,e)=>jn(n.innerType._def,e);function p8(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,s)=>p8(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return xbe(n)}}var xbe=n=>{const e={type:"integer",format:"unix-time"};for(const t of n.checks)switch(t.kind){case"min":e.minimum=t.value;break;case"max":e.maximum=t.value;break}return e};function kbe(n,e){return{...jn(n.innerType._def,e),default:n.defaultValue()}}function Sbe(n,e){return e.effectStrategy==="input"?jn(n.schema._def,e):$s()}function Tbe(n){return{type:"string",enum:Array.from(n.values)}}var Abe=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Cbe(n,e){const t=[jn(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),jn(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),r=[];return t.forEach(i=>{if(Abe(i))r.push(...i.allOf);else{let s=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...a}=i;s=a}r.push(s)}}),r.length?{allOf:r}:void 0}function Ebe(n){const e=typeof n.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(n.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:n.value}}var a_=void 0,Po={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(a_===void 0&&(a_=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a_),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function g8(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":t.minLength=typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value;break;case"max":t.maxLength=typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Io(t,"email",r.message,e);break;case"format:idn-email":Io(t,"idn-email",r.message,e);break;case"pattern:zod":Ei(t,Po.email,r.message,e);break}break;case"url":Io(t,"uri",r.message,e);break;case"uuid":Io(t,"uuid",r.message,e);break;case"regex":Ei(t,r.regex,r.message,e);break;case"cuid":Ei(t,Po.cuid,r.message,e);break;case"cuid2":Ei(t,Po.cuid2,r.message,e);break;case"startsWith":Ei(t,RegExp(`^${l_(r.value,e)}`),r.message,e);break;case"endsWith":Ei(t,RegExp(`${l_(r.value,e)}$`),r.message,e);break;case"datetime":Io(t,"date-time",r.message,e);break;case"date":Io(t,"date",r.message,e);break;case"time":Io(t,"time",r.message,e);break;case"duration":Io(t,"duration",r.message,e);break;case"length":t.minLength=typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,t.maxLength=typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value;break;case"includes":{Ei(t,RegExp(l_(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Io(t,"ipv4",r.message,e),r.version!=="v4"&&Io(t,"ipv6",r.message,e);break}case"base64url":Ei(t,Po.base64url,r.message,e);break;case"jwt":Ei(t,Po.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&Ei(t,Po.ipv4Cidr,r.message,e),r.version!=="v4"&&Ei(t,Po.ipv6Cidr,r.message,e);break}case"emoji":Ei(t,Po.emoji(),r.message,e);break;case"ulid":{Ei(t,Po.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Io(t,"binary",r.message,e);break}case"contentEncoding:base64":{t.contentEncoding="base64";break}case"pattern:zod":{Ei(t,Po.base64,r.message,e);break}}break}case"nanoid":Ei(t,Po.nanoid,r.message,e)}return t}function l_(n,e){return e.patternStrategy==="escape"?Ibe(n):n}var Pbe=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Ibe(n){let e="";for(let t=0;t<n.length;t++)Pbe.has(n[t])||(e+="\\"),e+=n[t];return e}function Io(n,e,t,r){var i;n.format||(i=n.anyOf)!=null&&i.some(s=>s.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format}),delete n.format),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):n.format=e}function Ei(n,e,t,r){var i;n.pattern||(i=n.allOf)!=null&&i.some(s=>s.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern}),delete n.pattern),n.allOf.push({pattern:jM(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):n.pattern=jM(e,r)}function jM(n,e){var t;if(!e.applyRegexFlags||!n.flags)return n.source;const r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},i=r.i?n.source.toLowerCase():n.source;let s="",o=!1,a=!1,l=!1;for(let c=0;c<i.length;c++){if(o){s+=i[c],o=!1;continue}if(r.i){if(a){if(i[c].match(/[a-z]/)){l?(s+=i[c],s+=`${i[c-2]}-${i[c]}`.toUpperCase(),l=!1):i[c+1]==="-"&&((t=i[c+2])!=null&&t.match(/[a-z]/))?(s+=i[c],l=!0):s+=`${i[c]}${i[c].toUpperCase()}`;continue}}else if(i[c].match(/[a-z]/)){s+=`[${i[c]}${i[c].toUpperCase()}]`;continue}}if(r.m){if(i[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(i[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(r.s&&i[c]==="."){s+=a?`${i[c]}\r
`:`[${i[c]}\r
]`;continue}s+=i[c],i[c]==="\\"?o=!0:a&&i[c]==="]"?a=!1:!a&&i[c]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}function m8(n,e){var t,r,i,s,o,a;const l={type:"object",additionalProperties:(t=jn(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?t:e.allowedAdditionalProperties};if(((r=n.keyType)==null?void 0:r._def.typeName)===sn.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const{type:c,...d}=g8(n.keyType._def,e);return{...l,propertyNames:d}}else{if(((s=n.keyType)==null?void 0:s._def.typeName)===sn.ZodEnum)return{...l,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===sn.ZodBranded&&n.keyType._def.type._def.typeName===sn.ZodString&&((a=n.keyType._def.type._def.checks)!=null&&a.length)){const{type:c,...d}=f8(n.keyType._def,e);return{...l,propertyNames:d}}}return l}function Mbe(n,e){if(e.mapStrategy==="record")return m8(n,e);const t=jn(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||$s(),r=jn(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||$s();return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Rbe(n){const e=n.values,r=Object.keys(n.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),i=Array.from(new Set(r.map(s=>typeof s)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function Dbe(){return{not:$s()}}function Nbe(){return{type:"null"}}var Yx={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Lbe(n,e){const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Yx&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((i,s)=>{const o=Yx[s._def.typeName];return o&&!i.includes(o)?[...i,o]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((i,s)=>{const o=typeof s._def.value;switch(o){case"string":case"number":case"boolean":return[...i,o];case"bigint":return[...i,"integer"];case"object":if(s._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){const i=r.filter((s,o,a)=>a.indexOf(s)===o);return{type:i.length>1?i:i[0],enum:t.reduce((s,o)=>s.includes(o._def.value)?s:[...s,o._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(s=>!r.includes(s))],[])};return Qbe(n,e)}var Qbe=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>jn(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function $be(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return{type:[Yx[n.innerType._def.typeName],"null"]};const t=jn(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Fbe(n){const e={type:"number"};if(!n.checks)return e;for(const t of n.checks)switch(t.kind){case"int":e.type="integer";break;case"min":t.inclusive?e.minimum=t.value:e.exclusiveMinimum=t.value;break;case"max":t.inclusive?e.maximum=t.value:e.exclusiveMaximum=t.value;break;case"multipleOf":e.multipleOf=t.value;break}return e}function zbe(n,e){const t={type:"object",properties:{}},r=[],i=n.shape();for(const o in i){let a=i[o];if(a===void 0||a._def===void 0)continue;const l=Ube(a),c=jn(a._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(t.properties[o]=c,l||r.push(o))}r.length&&(t.required=r);const s=Bbe(n,e);return s!==void 0&&(t.additionalProperties=s),t}function Bbe(n,e){if(n.catchall._def.typeName!=="ZodNever")return jn(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Ube(n){try{return n.isOptional()}catch{return!0}}var jbe=(n,e)=>{var t;if(e.currentPath.toString()===((t=e.propertyPath)==null?void 0:t.toString()))return jn(n.innerType._def,e);const r=jn(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:$s()},r]}:$s()},Vbe=(n,e)=>{if(e.pipeStrategy==="input")return jn(n.in._def,e);if(e.pipeStrategy==="output")return jn(n.out._def,e);const t=jn(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=jn(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(i=>i!==void 0)}};function qbe(n,e){return jn(n.type._def,e)}function Hbe(n,e){const r={type:"array",uniqueItems:!0,items:jn(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&(r.minItems=n.minSize.value),n.maxSize&&(r.maxItems=n.maxSize.value),r}function Zbe(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>jn(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:jn(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>jn(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function Wbe(){return{not:$s()}}function Xbe(){return $s()}var Ybe=(n,e)=>jn(n.innerType._def,e),Gbe=(n,e,t)=>{switch(e){case sn.ZodString:return g8(n,t);case sn.ZodNumber:return Fbe(n);case sn.ZodObject:return zbe(n,t);case sn.ZodBigInt:return wbe(n);case sn.ZodBoolean:return _be();case sn.ZodDate:return p8(n,t);case sn.ZodUndefined:return Wbe();case sn.ZodNull:return Nbe();case sn.ZodArray:return bbe(n,t);case sn.ZodUnion:case sn.ZodDiscriminatedUnion:return Lbe(n,t);case sn.ZodIntersection:return Cbe(n,t);case sn.ZodTuple:return Zbe(n,t);case sn.ZodRecord:return m8(n,t);case sn.ZodLiteral:return Ebe(n);case sn.ZodEnum:return Tbe(n);case sn.ZodNativeEnum:return Rbe(n);case sn.ZodNullable:return $be(n,t);case sn.ZodOptional:return jbe(n,t);case sn.ZodMap:return Mbe(n,t);case sn.ZodSet:return Hbe(n,t);case sn.ZodLazy:return()=>n.getter()._def;case sn.ZodPromise:return qbe(n,t);case sn.ZodNaN:case sn.ZodNever:return Dbe();case sn.ZodEffects:return Sbe(n,t);case sn.ZodAny:return $s();case sn.ZodUnknown:return Xbe();case sn.ZodDefault:return kbe(n,t);case sn.ZodBranded:return f8(n,t);case sn.ZodReadonly:return Ybe(n,t);case sn.ZodCatch:return Obe(n,t);case sn.ZodPipeline:return Vbe(n,t);case sn.ZodFunction:case sn.ZodVoid:case sn.ZodSymbol:return;default:return(r=>{})()}};function jn(n,e,t=!1){var r;const i=e.seen.get(n);if(e.override){const l=(r=e.override)==null?void 0:r.call(e,n,e,i,t);if(l!==vbe)return l}if(i&&!t){const l=Kbe(i,e);if(l!==void 0)return l}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const o=Gbe(n,n.typeName,e),a=typeof o=="function"?jn(o(),e):o;if(a&&Jbe(n,e,a),e.postProcess){const l=e.postProcess(a,n,e);return s.jsonSchema=a,l}return s.jsonSchema=a,a}var Kbe=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:mbe(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),$s()):e.$refStrategy==="seen"?$s():void 0}},Jbe=(n,e,t)=>(n.description&&(t.description=n.description),t),ewe=n=>{const e=ybe(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},twe=(n,e)=>{var t;const r=ewe(e);let i=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[d,h])=>{var f;return{...c,[d]:(f=jn(h._def,{...r,currentPath:[...r.basePath,r.definitionPath,d]},!0))!=null?f:$s()}},{}):void 0;const s=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,o=(t=jn(n._def,s===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,s]},!1))!=null?t:$s(),a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(o.title=a);const l=s===void 0?i?{...o,[r.definitionPath]:i}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,s].join("/"),[r.definitionPath]:{...i,[s]:o}};return l.$schema="http://json-schema.org/draft-07/schema#",l},nwe=twe;function rwe(n,e){var t;const r=(t=void 0)!=null?t:!1;return uT(()=>nwe(n,{$refStrategy:r?"root":"none"}),{validate:async i=>{const s=await n.safeParseAsync(i);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function iwe(n,e){var t;const r=(t=void 0)!=null?t:!1;return uT(()=>oy(Mye(n,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:async i=>{const s=await r8(n,i);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function swe(n){return"_zod"in n}function Ku(n,e){return swe(n)?iwe(n):rwe(n)}var Gx=Symbol.for("vercel.ai.schema");function uT(n,{validate:e}={}){return{[Gx]:!0,_type:void 0,[k0]:!0,get jsonSchema(){return typeof n=="function"&&(n=n()),n},validate:e}}function owe(n){return typeof n=="object"&&n!==null&&Gx in n&&n[Gx]===!0&&"jsonSchema"in n&&"validate"in n}function Ub(n){return n==null?uT({properties:{},additionalProperties:!1}):owe(n)?n:typeof n=="function"?n():Ku(n)}var{btoa:awe,atob:lwe}=globalThis;function dT(n){const e=n.replace(/-/g,"+").replace(/_/g,"/"),t=lwe(e);return Uint8Array.from(t,r=>r.codePointAt(0))}function Kx(n){let e="";for(let t=0;t<n.length;t++)e+=String.fromCodePoint(n[t]);return awe(e)}function cwe(n){return n?.replace(/\/$/,"")}function uwe(n){return n!=null&&typeof n[Symbol.asyncIterator]=="function"}async function*dwe({execute:n,input:e,options:t}){const r=n(e,t);if(uwe(r)){let i;for await(const s of r)i=s,yield{type:"preliminary",output:s};yield{type:"final",output:i}}else yield{type:"final",output:await r}}var c_,VM;function hwe(){if(VM)return c_;VM=1;var n=Object.defineProperty,e=Object.getOwnPropertyDescriptor,t=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,i=(d,h)=>{for(var f in h)n(d,f,{get:h[f],enumerable:!0})},s=(d,h,f,p)=>{if(h&&typeof h=="object"||typeof h=="function")for(let g of t(h))!r.call(d,g)&&g!==f&&n(d,g,{get:()=>h[g],enumerable:!(p=e(h,g))||p.enumerable});return d},o=d=>s(n({},"__esModule",{value:!0}),d),a={};i(a,{SYMBOL_FOR_REQ_CONTEXT:()=>l,getContext:()=>c}),c_=o(a);const l=Symbol.for("@vercel/request-context");function c(){return globalThis[l]?.get?.()??{}}return c_}var u_,qM;function fwe(){if(qM)return u_;qM=1;var n=Object.defineProperty,e=Object.getOwnPropertyDescriptor,t=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,i=(h,f)=>{for(var p in f)n(h,p,{get:f[p],enumerable:!0})},s=(h,f,p,g)=>{if(f&&typeof f=="object"||typeof f=="function")for(let m of t(f))!r.call(h,m)&&m!==p&&n(h,m,{get:()=>f[m],enumerable:!(g=e(f,m))||g.enumerable});return h},o=h=>s(n({},"__esModule",{value:!0}),h),a={};i(a,{getContext:()=>l.getContext,getVercelOidcToken:()=>c,getVercelOidcTokenSync:()=>d}),u_=o(a);var l=hwe();async function c(){return""}function d(){return""}return u_}var v8=fwe(),pwe="vercel.ai.gateway.error",d_=Symbol.for(pwe),HM,ZM,Fs=class y8 extends(ZM=Error,HM=d_,ZM){constructor({message:e,statusCode:t=500,cause:r}){super(e),this[HM]=!0,this.statusCode=t,this.cause=r}static isInstance(e){return y8.hasMarker(e)}static hasMarker(e){return typeof e=="object"&&e!==null&&d_ in e&&e[d_]===!0}},b8="GatewayAuthenticationError",gwe=`vercel.ai.gateway.error.${b8}`,WM=Symbol.for(gwe),XM,YM,hT=class w8 extends(YM=Fs,XM=WM,YM){constructor({message:e="Authentication failed",statusCode:t=401,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[XM]=!0,this.name=b8,this.type="authentication_error"}static isInstance(e){return Fs.hasMarker(e)&&WM in e}static createContextualError({apiKeyProvided:e,oidcTokenProvided:t,message:r="Authentication failed",statusCode:i=401,cause:s}){let o;return e?o=`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:t?o=`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:o=`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new w8({message:o,statusCode:i,cause:s})}},_8="GatewayInvalidRequestError",mwe=`vercel.ai.gateway.error.${_8}`,GM=Symbol.for(mwe),KM,JM,vwe=class extends(JM=Fs,KM=GM,JM){constructor({message:n="Invalid request",statusCode:e=400,cause:t}={}){super({message:n,statusCode:e,cause:t}),this[KM]=!0,this.name=_8,this.type="invalid_request_error"}static isInstance(n){return Fs.hasMarker(n)&&GM in n}},O8="GatewayRateLimitError",ywe=`vercel.ai.gateway.error.${O8}`,eR=Symbol.for(ywe),tR,nR,bwe=class extends(nR=Fs,tR=eR,nR){constructor({message:n="Rate limit exceeded",statusCode:e=429,cause:t}={}){super({message:n,statusCode:e,cause:t}),this[tR]=!0,this.name=O8,this.type="rate_limit_exceeded"}static isInstance(n){return Fs.hasMarker(n)&&eR in n}},x8="GatewayModelNotFoundError",wwe=`vercel.ai.gateway.error.${x8}`,rR=Symbol.for(wwe),_we=df(()=>Ku(je({modelId:Ce()}))),iR,sR,Owe=class extends(sR=Fs,iR=rR,sR){constructor({message:n="Model not found",statusCode:e=404,modelId:t,cause:r}={}){super({message:n,statusCode:e,cause:r}),this[iR]=!0,this.name=x8,this.type="model_not_found",this.modelId=t}static isInstance(n){return Fs.hasMarker(n)&&rR in n}},k8="GatewayInternalServerError",xwe=`vercel.ai.gateway.error.${k8}`,oR=Symbol.for(xwe),aR,lR,cR=class extends(lR=Fs,aR=oR,lR){constructor({message:n="Internal server error",statusCode:e=500,cause:t}={}){super({message:n,statusCode:e,cause:t}),this[aR]=!0,this.name=k8,this.type="internal_server_error"}static isInstance(n){return Fs.hasMarker(n)&&oR in n}},S8="GatewayResponseError",kwe=`vercel.ai.gateway.error.${S8}`,uR=Symbol.for(kwe),dR,hR,Swe=class extends(hR=Fs,dR=uR,hR){constructor({message:n="Invalid response from Gateway",statusCode:e=502,response:t,validationError:r,cause:i}={}){super({message:n,statusCode:e,cause:i}),this[dR]=!0,this.name=S8,this.type="response_error",this.response=t,this.validationError=r}static isInstance(n){return Fs.hasMarker(n)&&uR in n}};async function fR({response:n,statusCode:e,defaultMessage:t="Gateway request failed",cause:r,authMethod:i}){const s=await Ac({value:n,schema:Twe});if(!s.success)return new Swe({message:`Invalid error response format: ${t}`,statusCode:e,response:n,validationError:s.error,cause:r});const o=s.value,a=o.error.type,l=o.error.message;switch(a){case"authentication_error":return hT.createContextualError({apiKeyProvided:i==="api-key",oidcTokenProvided:i==="oidc",statusCode:e,cause:r});case"invalid_request_error":return new vwe({message:l,statusCode:e,cause:r});case"rate_limit_exceeded":return new bwe({message:l,statusCode:e,cause:r});case"model_not_found":{const c=await Ac({value:o.error.param,schema:_we});return new Owe({message:l,statusCode:e,modelId:c.success?c.value.modelId:void 0,cause:r})}case"internal_server_error":return new cR({message:l,statusCode:e,cause:r});default:return new cR({message:l,statusCode:e,cause:r})}}var Twe=df(()=>Ku(je({error:je({message:Ce(),type:Ce().nullish(),param:Il().nullish(),code:Xn([Ce(),St()]).nullish()})})));function Cc(n,e){var t;return Fs.isInstance(n)?n:Bi.isInstance(n)?fR({response:Awe(n),statusCode:(t=n.statusCode)!=null?t:500,defaultMessage:"Gateway request failed",cause:n,authMethod:e}):fR({response:{},statusCode:500,defaultMessage:n instanceof Error?`Gateway request failed: ${n.message}`:"Unknown Gateway error",cause:n,authMethod:e})}function Awe(n){if(n.data!==void 0)return n.data;if(n.responseBody!=null)try{return JSON.parse(n.responseBody)}catch{return n.responseBody}return{}}var T8="ai-gateway-auth-method";async function Zh(n){const e=await Ac({value:n[T8],schema:Cwe});return e.success?e.value:void 0}var Cwe=df(()=>Ku(Xn([dn("api-key"),dn("oidc")]))),pR=class{constructor(n){this.config=n}async getAvailableModels(){try{const{value:n}=await zM({url:`${this.config.baseURL}/config`,headers:await Ia(this.config.headers()),successfulResponseHandler:Cg(Ewe),failedResponseHandler:Hh({errorSchema:gl(),errorToMessage:e=>e}),fetch:this.config.fetch});return n}catch(n){throw await Cc(n)}}async getCredits(){try{const n=new URL(this.config.baseURL),{value:e}=await zM({url:`${n.origin}/v1/credits`,headers:await Ia(this.config.headers()),successfulResponseHandler:Cg(Pwe),failedResponseHandler:Hh({errorSchema:gl(),errorToMessage:t=>t}),fetch:this.config.fetch});return e}catch(n){throw await Cc(n)}}},Ewe=df(()=>Ku(je({models:Xt(je({id:Ce(),name:Ce(),description:Ce().nullish(),pricing:je({input:Ce(),output:Ce(),input_cache_read:Ce().nullish(),input_cache_write:Ce().nullish()}).transform(({input:n,output:e,input_cache_read:t,input_cache_write:r})=>({input:n,output:e,...t?{cachedInputTokens:t}:{},...r?{cacheCreationInputTokens:r}:{}})).nullish(),specification:je({specificationVersion:dn("v2"),provider:Ce(),modelId:Ce()}),modelType:cr(["language","embedding","image"]).nullish()}))}))),Pwe=df(()=>Ku(je({balance:Ce(),total_used:Ce()}).transform(({balance:n,total_used:e})=>({balance:n,totalUsed:e})))),Iwe=class{constructor(n,e){this.modelId=n,this.config=e,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(n){const{abortSignal:e,...t}=n;return{args:this.maybeEncodeFileParts(t),warnings:[]}}async doGenerate(n){const{args:e,warnings:t}=await this.getArgs(n),{abortSignal:r}=n,i=await Ia(this.config.headers());try{const{responseHeaders:s,value:o,rawValue:a}=await S0({url:this.getUrl(),headers:x0(i,n.headers,this.getModelConfigHeaders(this.modelId,!1),await Ia(this.config.o11yHeaders)),body:e,successfulResponseHandler:Cg(gl()),failedResponseHandler:Hh({errorSchema:gl(),errorToMessage:l=>l}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...o,request:{body:e},response:{headers:s,body:a},warnings:t}}catch(s){throw await Cc(s,await Zh(i))}}async doStream(n){const{args:e,warnings:t}=await this.getArgs(n),{abortSignal:r}=n,i=await Ia(this.config.headers());try{const{value:s,responseHeaders:o}=await S0({url:this.getUrl(),headers:x0(i,n.headers,this.getModelConfigHeaders(this.modelId,!0),await Ia(this.config.o11yHeaders)),body:e,successfulResponseHandler:gbe(gl()),failedResponseHandler:Hh({errorSchema:gl(),errorToMessage:a=>a}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:s.pipeThrough(new TransformStream({start(a){t.length>0&&a.enqueue({type:"stream-start",warnings:t})},transform(a,l){if(a.success){const c=a.value;if(c.type==="raw"&&!n.includeRawChunks)return;c.type==="response-metadata"&&c.timestamp&&typeof c.timestamp=="string"&&(c.timestamp=new Date(c.timestamp)),l.enqueue(c)}else l.error(a.error)}})),request:{body:e},response:{headers:o}}}catch(s){throw await Cc(s,await Zh(i))}}isFilePart(n){return n&&typeof n=="object"&&"type"in n&&n.type==="file"}maybeEncodeFileParts(n){for(const e of n.prompt)for(const t of e.content)if(this.isFilePart(t)){const r=t;if(r.data instanceof Uint8Array){const i=Uint8Array.from(r.data),s=Buffer.from(i).toString("base64");r.data=new URL(`data:${r.mediaType||"application/octet-stream"};base64,${s}`)}}return n}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(n,e){return{"ai-language-model-specification-version":"2","ai-language-model-id":n,"ai-language-model-streaming":String(e)}}},Mwe=class{constructor(n,e){this.modelId=n,this.config=e,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:n,headers:e,abortSignal:t,providerOptions:r}){var i;const s=await Ia(this.config.headers());try{const{responseHeaders:o,value:a,rawValue:l}=await S0({url:this.getUrl(),headers:x0(s,e??{},this.getModelConfigHeaders(),await Ia(this.config.o11yHeaders)),body:{input:n.length===1?n[0]:n,...r?{providerOptions:r}:{}},successfulResponseHandler:Cg(Rwe),failedResponseHandler:Hh({errorSchema:gl(),errorToMessage:c=>c}),...t&&{abortSignal:t},fetch:this.config.fetch});return{embeddings:a.embeddings,usage:(i=a.usage)!=null?i:void 0,providerMetadata:a.providerMetadata,response:{headers:o,body:l}}}catch(o){throw await Cc(o,await Zh(s))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},Rwe=df(()=>Ku(je({embeddings:Xt(Xt(St())),usage:je({tokens:St()}).nullish(),providerMetadata:Mu(Ce(),Mu(Ce(),Il())).optional()}))),Dwe=class{constructor(n,e){this.modelId=n,this.config=e,this.specificationVersion="v2",this.maxImagesPerCall=Number.MAX_SAFE_INTEGER}get provider(){return this.config.provider}async doGenerate({prompt:n,n:e,size:t,aspectRatio:r,seed:i,providerOptions:s,headers:o,abortSignal:a}){var l;const c=await Ia(this.config.headers());try{const{responseHeaders:d,value:h,rawValue:f}=await S0({url:this.getUrl(),headers:x0(c,o??{},this.getModelConfigHeaders(),await Ia(this.config.o11yHeaders)),body:{prompt:n,n:e,...t&&{size:t},...r&&{aspectRatio:r},...i&&{seed:i},...s&&{providerOptions:s}},successfulResponseHandler:Cg(Lwe),failedResponseHandler:Hh({errorSchema:gl(),errorToMessage:p=>p}),...a&&{abortSignal:a},fetch:this.config.fetch});return{images:h.images,warnings:(l=h.warnings)!=null?l:[],providerMetadata:h.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:d}}}catch(d){throw Cc(d,await Zh(c))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":"2","ai-model-id":this.modelId}}},Nwe=je({images:Xt(Il()).optional()}).catchall(Il()),Lwe=je({images:Xt(Ce()),warnings:Xt(je({type:dn("other"),message:Ce()})).optional(),providerMetadata:Mu(Ce(),Nwe).optional()});async function Qwe(){var n;return(n=v8.getContext().headers)==null?void 0:n["x-vercel-id"]}var $we="2.0.21",Fwe="0.0.1";function zwe(n={}){var e,t;let r=null,i=null;const s=(e=n.metadataCacheRefreshMillis)!=null?e:1e3*60*5;let o=0;const a=(t=cwe(n.baseURL))!=null?t:"https://ai-gateway.vercel.sh/v1/ai",l=async()=>{const g=await Uwe(n);if(g)return Bb({Authorization:`Bearer ${g.token}`,"ai-gateway-protocol-version":Fwe,[T8]:g.authMethod,...n.headers},`ai-sdk/gateway/${$we}`);throw hT.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},c=()=>{const g=sy({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),m=sy({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),v=sy({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const y=await Qwe();return{...g&&{"ai-o11y-deployment-id":g},...m&&{"ai-o11y-environment":m},...v&&{"ai-o11y-region":v},...y&&{"ai-o11y-request-id":y}}}},d=g=>new Iwe(g,{provider:"gateway",baseURL:a,headers:l,fetch:n.fetch,o11yHeaders:c()}),h=async()=>{var g,m,v;const y=(v=(m=(g=n._internal)==null?void 0:g.currentDate)==null?void 0:m.call(g).getTime())!=null?v:Date.now();return(!r||y-o>s)&&(o=y,r=new pR({baseURL:a,headers:l,fetch:n.fetch}).getAvailableModels().then(O=>(i=O,O)).catch(async O=>{throw await Cc(O,await Zh(await l()))})),i?Promise.resolve(i):r},f=async()=>new pR({baseURL:a,headers:l,fetch:n.fetch}).getCredits().catch(async g=>{throw await Cc(g,await Zh(await l()))}),p=function(g){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return d(g)};return p.getAvailableModels=h,p.getCredits=f,p.imageModel=g=>new Dwe(g,{provider:"gateway",baseURL:a,headers:l,fetch:n.fetch,o11yHeaders:c()}),p.languageModel=d,p.textEmbeddingModel=g=>new Mwe(g,{provider:"gateway",baseURL:a,headers:l,fetch:n.fetch,o11yHeaders:c()}),p}var Bwe=zwe();async function Uwe(n){const e=sy({settingValue:n.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(e)return{token:e,authMethod:"api-key"};try{return{token:await v8.getVercelOidcToken(),authMethod:"oidc"}}catch{return null}}var jwe=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},du="1.9.0",gR=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Vwe(n){var e=new Set([n]),t=new Set,r=n.match(gR);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(l){return l===n};function s(a){return t.add(a),!1}function o(a){return e.add(a),!0}return function(l){if(e.has(l))return!0;if(t.has(l))return!1;var c=l.match(gR);if(!c)return s(l);var d={major:+c[1],minor:+c[2],patch:+c[3],prerelease:c[4]};return d.prerelease!=null||i.major!==d.major?s(l):i.major===0?i.minor===d.minor&&i.patch<=d.patch?o(l):s(l):i.minor<=d.minor?o(l):s(l)}}var qwe=Vwe(du),Hwe=du.split(".")[0],Eg=Symbol.for("opentelemetry.js.api."+Hwe),Pg=jwe;function fT(n,e,t,r){var i;r===void 0&&(r=!1);var s=Pg[Eg]=(i=Pg[Eg])!==null&&i!==void 0?i:{version:du};if(!r&&s[n]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+n);return t.error(o.stack||o.message),!1}if(s.version!==du){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+n+" does not match previously registered API v"+du);return t.error(o.stack||o.message),!1}return s[n]=e,t.debug("@opentelemetry/api: Registered a global for "+n+" v"+du+"."),!0}function Ig(n){var e,t,r=(e=Pg[Eg])===null||e===void 0?void 0:e.version;if(!(!r||!qwe(r)))return(t=Pg[Eg])===null||t===void 0?void 0:t[n]}function pT(n,e){e.debug("@opentelemetry/api: Unregistering a global for "+n+" v"+du+".");var t=Pg[Eg];t&&delete t[n]}var Zwe=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},Wwe=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},Xwe=(function(){function n(e){this._namespace=e.namespace||"DiagComponentLogger"}return n.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zf("debug",this._namespace,e)},n.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zf("error",this._namespace,e)},n.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zf("info",this._namespace,e)},n.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zf("warn",this._namespace,e)},n.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zf("verbose",this._namespace,e)},n})();function zf(n,e,t){var r=Ig("diag");if(r)return t.unshift(e),r[n].apply(r,Wwe([],Zwe(t),!1))}var xs;(function(n){n[n.NONE=0]="NONE",n[n.ERROR=30]="ERROR",n[n.WARN=50]="WARN",n[n.INFO=60]="INFO",n[n.DEBUG=70]="DEBUG",n[n.VERBOSE=80]="VERBOSE",n[n.ALL=9999]="ALL"})(xs||(xs={}));function Ywe(n,e){n<xs.NONE?n=xs.NONE:n>xs.ALL&&(n=xs.ALL),e=e||{};function t(r,i){var s=e[r];return typeof s=="function"&&n>=i?s.bind(e):function(){}}return{error:t("error",xs.ERROR),warn:t("warn",xs.WARN),info:t("info",xs.INFO),debug:t("debug",xs.DEBUG),verbose:t("verbose",xs.VERBOSE)}}var Gwe=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},Kwe=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},Jwe="diag",T0=(function(){function n(){function e(i){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=Ig("diag");if(a)return a[i].apply(a,Kwe([],Gwe(s),!1))}}var t=this,r=function(i,s){var o,a,l;if(s===void 0&&(s={logLevel:xs.INFO}),i===t){var c=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error((o=c.stack)!==null&&o!==void 0?o:c.message),!1}typeof s=="number"&&(s={logLevel:s});var d=Ig("diag"),h=Ywe((a=s.logLevel)!==null&&a!==void 0?a:xs.INFO,i);if(d&&!s.suppressOverrideMessage){var f=(l=new Error().stack)!==null&&l!==void 0?l:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+f),h.warn("Current logger will overwrite one already registered from "+f)}return fT("diag",h,t,!0)};t.setLogger=r,t.disable=function(){pT(Jwe,t)},t.createComponentLogger=function(i){return new Xwe(i)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return n.instance=function(){return this._instance||(this._instance=new n),this._instance},n})();function e1e(n){return Symbol.for(n)}var t1e=(function(){function n(e){var t=this;t._currentContext=e?new Map(e):new Map,t.getValue=function(r){return t._currentContext.get(r)},t.setValue=function(r,i){var s=new n(t._currentContext);return s._currentContext.set(r,i),s},t.deleteValue=function(r){var i=new n(t._currentContext);return i._currentContext.delete(r),i}}return n})(),n1e=new t1e,r1e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},i1e=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},s1e=(function(){function n(){}return n.prototype.active=function(){return n1e},n.prototype.with=function(e,t,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];return t.call.apply(t,i1e([r],r1e(i),!1))},n.prototype.bind=function(e,t){return t},n.prototype.enable=function(){return this},n.prototype.disable=function(){return this},n})(),o1e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},a1e=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},h_="context",l1e=new s1e,A8=(function(){function n(){}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalContextManager=function(e){return fT(h_,e,T0.instance())},n.prototype.active=function(){return this._getContextManager().active()},n.prototype.with=function(e,t,r){for(var i,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(i=this._getContextManager()).with.apply(i,a1e([e,t,r],o1e(s),!1))},n.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},n.prototype._getContextManager=function(){return Ig(h_)||l1e},n.prototype.disable=function(){this._getContextManager().disable(),pT(h_,T0.instance())},n})(),Jx;(function(n){n[n.NONE=0]="NONE",n[n.SAMPLED=1]="SAMPLED"})(Jx||(Jx={}));var C8="0000000000000000",E8="00000000000000000000000000000000",c1e={traceId:E8,spanId:C8,traceFlags:Jx.NONE},Cp=(function(){function n(e){e===void 0&&(e=c1e),this._spanContext=e}return n.prototype.spanContext=function(){return this._spanContext},n.prototype.setAttribute=function(e,t){return this},n.prototype.setAttributes=function(e){return this},n.prototype.addEvent=function(e,t){return this},n.prototype.addLink=function(e){return this},n.prototype.addLinks=function(e){return this},n.prototype.setStatus=function(e){return this},n.prototype.updateName=function(e){return this},n.prototype.end=function(e){},n.prototype.isRecording=function(){return!1},n.prototype.recordException=function(e,t){},n})(),gT=e1e("OpenTelemetry Context Key SPAN");function mT(n){return n.getValue(gT)||void 0}function u1e(){return mT(A8.getInstance().active())}function vT(n,e){return n.setValue(gT,e)}function d1e(n){return n.deleteValue(gT)}function h1e(n,e){return vT(n,new Cp(e))}function P8(n){var e;return(e=mT(n))===null||e===void 0?void 0:e.spanContext()}var f1e=/^([0-9a-f]{32})$/i,p1e=/^[0-9a-f]{16}$/i;function g1e(n){return f1e.test(n)&&n!==E8}function m1e(n){return p1e.test(n)&&n!==C8}function I8(n){return g1e(n.traceId)&&m1e(n.spanId)}function v1e(n){return new Cp(n)}var f_=A8.getInstance(),M8=(function(){function n(){}return n.prototype.startSpan=function(e,t,r){r===void 0&&(r=f_.active());var i=!!t?.root;if(i)return new Cp;var s=r&&P8(r);return y1e(s)&&I8(s)?new Cp(s):new Cp},n.prototype.startActiveSpan=function(e,t,r,i){var s,o,a;if(!(arguments.length<2)){arguments.length===2?a=t:arguments.length===3?(s=t,a=r):(s=t,o=r,a=i);var l=o??f_.active(),c=this.startSpan(e,s,l),d=vT(l,c);return f_.with(d,a,void 0,c)}},n})();function y1e(n){return typeof n=="object"&&typeof n.spanId=="string"&&typeof n.traceId=="string"&&typeof n.traceFlags=="number"}var b1e=new M8,w1e=(function(){function n(e,t,r,i){this._provider=e,this.name=t,this.version=r,this.options=i}return n.prototype.startSpan=function(e,t,r){return this._getTracer().startSpan(e,t,r)},n.prototype.startActiveSpan=function(e,t,r,i){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},n.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):b1e},n})(),_1e=(function(){function n(){}return n.prototype.getTracer=function(e,t,r){return new M8},n})(),O1e=new _1e,mR=(function(){function n(){}return n.prototype.getTracer=function(e,t,r){var i;return(i=this.getDelegateTracer(e,t,r))!==null&&i!==void 0?i:new w1e(this,e,t,r)},n.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:O1e},n.prototype.setDelegate=function(e){this._delegate=e},n.prototype.getDelegateTracer=function(e,t,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,t,r)},n})(),A0;(function(n){n[n.UNSET=0]="UNSET",n[n.OK=1]="OK",n[n.ERROR=2]="ERROR"})(A0||(A0={}));var p_="trace",x1e=(function(){function n(){this._proxyTracerProvider=new mR,this.wrapSpanContext=v1e,this.isSpanContextValid=I8,this.deleteSpan=d1e,this.getSpan=mT,this.getActiveSpan=u1e,this.getSpanContext=P8,this.setSpan=vT,this.setSpanContext=h1e}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalTracerProvider=function(e){var t=fT(p_,this._proxyTracerProvider,T0.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},n.prototype.getTracerProvider=function(){return Ig(p_)||this._proxyTracerProvider},n.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},n.prototype.disable=function(){pT(p_,T0.instance()),this._proxyTracerProvider=new mR},n})(),k1e=x1e.getInstance(),S1e=Object.defineProperty,T1e=(n,e)=>{for(var t in e)S1e(n,t,{get:e[t],enumerable:!0})},R8="AI_NoOutputSpecifiedError",D8=`vercel.ai.error.${R8}`,A1e=Symbol.for(D8),N8,C1e=class extends xn{constructor({message:n="No output specified."}={}){super({name:R8,message:n}),this[N8]=!0}static isInstance(n){return xn.hasMarker(n,D8)}};N8=A1e;function E1e(n){const e="AI SDK Warning:";switch(n.type){case"unsupported-setting":{let t=`${e} The "${n.setting}" setting is not supported by this model`;return n.details&&(t+=` - ${n.details}`),t}case"unsupported-tool":{const t="name"in n.tool?n.tool.name:"unknown tool";let r=`${e} The tool "${t}" is not supported by this model`;return n.details&&(r+=` - ${n.details}`),r}case"other":return`${e} ${n.message}`;default:return`${e} ${JSON.stringify(n,null,2)}`}}var P1e="AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.",vR=!1,I1e=n=>{if(n.length===0)return;const e=globalThis.AI_SDK_LOG_WARNINGS;if(e!==!1){if(typeof e=="function"){e(n);return}vR||(vR=!0,console.info(P1e));for(const t of n)console.warn(E1e(t))}},L8="AI_InvalidArgumentError",Q8=`vercel.ai.error.${L8}`,M1e=Symbol.for(Q8),$8,ga=class extends xn{constructor({parameter:e,value:t,message:r}){super({name:L8,message:`Invalid argument for parameter ${e}: ${r}`}),this[$8]=!0,this.parameter=e,this.value=t}static isInstance(e){return xn.hasMarker(e,Q8)}};$8=M1e;var F8="AI_InvalidToolInputError",z8=`vercel.ai.error.${F8}`,R1e=Symbol.for(z8),B8,U8=class extends xn{constructor({toolInput:n,toolName:e,cause:t,message:r=`Invalid input for tool ${e}: ${cf(t)}`}){super({name:F8,message:r,cause:t}),this[B8]=!0,this.toolInput=n,this.toolName=e}static isInstance(n){return xn.hasMarker(n,z8)}};B8=R1e;var j8="AI_NoObjectGeneratedError",V8=`vercel.ai.error.${j8}`,D1e=Symbol.for(V8),q8,yR=class extends xn{constructor({message:n="No object generated.",cause:e,text:t,response:r,usage:i,finishReason:s}){super({name:j8,message:n,cause:e}),this[q8]=!0,this.text=t,this.response=r,this.usage=i,this.finishReason=s}static isInstance(n){return xn.hasMarker(n,V8)}};q8=D1e;var H8="AI_NoOutputGeneratedError",Z8=`vercel.ai.error.${H8}`,N1e=Symbol.for(Z8),W8,L1e=class extends xn{constructor({message:n="No output generated.",cause:e}={}){super({name:H8,message:n,cause:e}),this[W8]=!0}static isInstance(n){return xn.hasMarker(n,Z8)}};W8=N1e;var X8="AI_NoSuchToolError",Y8=`vercel.ai.error.${X8}`,Q1e=Symbol.for(Y8),G8,ek=class extends xn{constructor({toolName:n,availableTools:e=void 0,message:t=`Model tried to call unavailable tool '${n}'. ${e===void 0?"No tools are available.":`Available tools: ${e.join(", ")}.`}`}){super({name:X8,message:t}),this[G8]=!0,this.toolName=n,this.availableTools=e}static isInstance(n){return xn.hasMarker(n,Y8)}};G8=Q1e;var K8="AI_ToolCallRepairError",J8=`vercel.ai.error.${K8}`,$1e=Symbol.for(J8),e7,F1e=class extends xn{constructor({cause:n,originalError:e,message:t=`Error repairing tool call: ${cf(n)}`}){super({name:K8,message:t,cause:n}),this[e7]=!0,this.originalError=e}static isInstance(n){return xn.hasMarker(n,J8)}};e7=$1e;var z1e=class extends xn{constructor(n){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${n.version} for provider "${n.provider}" and model "${n.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=n.version,this.provider=n.provider,this.modelId=n.modelId}},t7="AI_InvalidMessageRoleError",n7=`vercel.ai.error.${t7}`,B1e=Symbol.for(n7),r7,U1e=class extends xn{constructor({role:n,message:e=`Invalid message role: '${n}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:t7,message:e}),this[r7]=!0,this.role=n}static isInstance(n){return xn.hasMarker(n,n7)}};r7=B1e;var i7="AI_DownloadError",s7=`vercel.ai.error.${i7}`,j1e=Symbol.for(s7),o7,g_=class extends xn{constructor({url:n,statusCode:e,statusText:t,cause:r,message:i=r==null?`Failed to download ${n}: ${e} ${t}`:`Failed to download ${n}: ${r}`}){super({name:i7,message:i,cause:r}),this[o7]=!0,this.url=n,this.statusCode=e,this.statusText=t}static isInstance(n){return xn.hasMarker(n,s7)}};o7=j1e;var a7="AI_RetryError",l7=`vercel.ai.error.${a7}`,V1e=Symbol.for(l7),c7,bR=class extends xn{constructor({message:n,reason:e,errors:t}){super({name:a7,message:n}),this[c7]=!0,this.reason=e,this.errors=t,this.lastError=t[t.length-1]}static isInstance(n){return xn.hasMarker(n,l7)}};c7=V1e;function u7(n){if(typeof n!="string"){if(n.specificationVersion!=="v2")throw new z1e({version:n.specificationVersion,provider:n.provider,modelId:n.modelId});return n}return q1e().languageModel(n)}function q1e(){var n;return(n=globalThis.AI_SDK_DEFAULT_PROVIDER)!=null?n:Bwe}var H1e=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],Z1e=n=>{const e=typeof n=="string"?dT(n):n,t=(e[6]&127)<<21|(e[7]&127)<<14|(e[8]&127)<<7|e[9]&127;return e.slice(t+10)};function W1e(n){return typeof n=="string"&&n.startsWith("SUQz")||typeof n!="string"&&n.length>10&&n[0]===73&&n[1]===68&&n[2]===51?Z1e(n):n}function X1e({data:n,signatures:e}){const t=W1e(n),r=typeof t=="string"?dT(t.substring(0,Math.min(t.length,24))):t;for(const i of e)if(r.length>=i.bytesPrefix.length&&i.bytesPrefix.every((s,o)=>s===null||r[o]===s))return i.mediaType}var Y1e="5.0.113",G1e=async({url:n})=>{var e;const t=n.toString();try{const r=await fetch(t,{headers:Bb({},`ai-sdk/${Y1e}`,cT())});if(!r.ok)throw new g_({url:t,statusCode:r.status,statusText:r.statusText});return{data:new Uint8Array(await r.arrayBuffer()),mediaType:(e=r.headers.get("content-type"))!=null?e:void 0}}catch(r){throw g_.isInstance(r)?r:new g_({url:t,cause:r})}},K1e=(n=G1e)=>e=>Promise.all(e.map(async t=>t.isUrlSupportedByModel?null:n(t)));function J1e(n){try{const[e,t]=n.split(",");return{mediaType:e.split(";")[0].split(":")[1],base64Content:t}}catch{return{mediaType:void 0,base64Content:void 0}}}var d7=Xn([Ce(),_0(Uint8Array),_0(ArrayBuffer),W0e(n=>{var e,t;return(t=(e=globalThis.Buffer)==null?void 0:e.isBuffer(n))!=null?t:!1},{message:"Must be a Buffer"})]);function h7(n){if(n instanceof Uint8Array)return{data:n,mediaType:void 0};if(n instanceof ArrayBuffer)return{data:new Uint8Array(n),mediaType:void 0};if(typeof n=="string")try{n=new URL(n)}catch{}if(n instanceof URL&&n.protocol==="data:"){const{mediaType:e,base64Content:t}=J1e(n.toString());if(e==null||t==null)throw new xn({name:"InvalidDataContentError",message:`Invalid data URL format in content ${n.toString()}`});return{data:t,mediaType:e}}return{data:n,mediaType:void 0}}function e_e(n){return typeof n=="string"?n:n instanceof ArrayBuffer?Kx(new Uint8Array(n)):Kx(n)}async function t_e({prompt:n,supportedUrls:e,download:t=K1e()}){const r=await r_e(n.messages,t,e);return[...n.system!=null?[{role:"system",content:n.system}]:[],...n.messages.map(i=>n_e({message:i,downloadedAssets:r}))]}function n_e({message:n,downloadedAssets:e}){const t=n.role;switch(t){case"system":return{role:"system",content:n.content,providerOptions:n.providerOptions};case"user":return typeof n.content=="string"?{role:"user",content:[{type:"text",text:n.content}],providerOptions:n.providerOptions}:{role:"user",content:n.content.map(r=>i_e(r,e)).filter(r=>r.type!=="text"||r.text!==""),providerOptions:n.providerOptions};case"assistant":return typeof n.content=="string"?{role:"assistant",content:[{type:"text",text:n.content}],providerOptions:n.providerOptions}:{role:"assistant",content:n.content.filter(r=>r.type!=="text"||r.text!==""||r.providerOptions!=null).map(r=>{const i=r.providerOptions;switch(r.type){case"file":{const{data:s,mediaType:o}=h7(r.data);return{type:"file",data:s,filename:r.filename,mediaType:o??r.mediaType,providerOptions:i}}case"reasoning":return{type:"reasoning",text:r.text,providerOptions:i};case"text":return{type:"text",text:r.text,providerOptions:i};case"tool-call":return{type:"tool-call",toolCallId:r.toolCallId,toolName:r.toolName,input:r.input,providerExecuted:r.providerExecuted,providerOptions:i};case"tool-result":return{type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,output:r.output,providerOptions:i}}}),providerOptions:n.providerOptions};case"tool":return{role:"tool",content:n.content.map(r=>({type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,output:r.output,providerOptions:r.providerOptions})),providerOptions:n.providerOptions};default:{const r=t;throw new U1e({role:r})}}}async function r_e(n,e,t){const r=n.filter(s=>s.role==="user").map(s=>s.content).filter(s=>Array.isArray(s)).flat().filter(s=>s.type==="image"||s.type==="file").map(s=>{var o;const a=(o=s.mediaType)!=null?o:s.type==="image"?"image/*":void 0;let l=s.type==="image"?s.image:s.data;if(typeof l=="string")try{l=new URL(l)}catch{}return{mediaType:a,data:l}}).filter(s=>s.data instanceof URL).map(s=>({url:s.data,isUrlSupportedByModel:s.mediaType!=null&&rbe({url:s.data.toString(),mediaType:s.mediaType,supportedUrls:t})})),i=await e(r);return Object.fromEntries(i.map((s,o)=>s==null?null:[r[o].url.toString(),{data:s.data,mediaType:s.mediaType}]).filter(s=>s!=null))}function i_e(n,e){var t;if(n.type==="text")return{type:"text",text:n.text,providerOptions:n.providerOptions};let r;const i=n.type;switch(i){case"image":r=n.image;break;case"file":r=n.data;break;default:throw new Error(`Unsupported part type: ${i}`)}const{data:s,mediaType:o}=h7(r);let a=o??n.mediaType,l=s;if(l instanceof URL){const c=e[l.toString()];c&&(l=c.data,a??(a=c.mediaType))}switch(i){case"image":return(l instanceof Uint8Array||typeof l=="string")&&(a=(t=X1e({data:l,signatures:H1e}))!=null?t:a),{type:"file",mediaType:a??"image/*",filename:void 0,data:l,providerOptions:n.providerOptions};case"file":{if(a==null)throw new Error("Media type is missing for file part");return{type:"file",mediaType:a,filename:n.filename,data:l,providerOptions:n.providerOptions}}}}function s_e({maxOutputTokens:n,temperature:e,topP:t,topK:r,presencePenalty:i,frequencyPenalty:s,seed:o,stopSequences:a}){if(n!=null){if(!Number.isInteger(n))throw new ga({parameter:"maxOutputTokens",value:n,message:"maxOutputTokens must be an integer"});if(n<1)throw new ga({parameter:"maxOutputTokens",value:n,message:"maxOutputTokens must be >= 1"})}if(e!=null&&typeof e!="number")throw new ga({parameter:"temperature",value:e,message:"temperature must be a number"});if(t!=null&&typeof t!="number")throw new ga({parameter:"topP",value:t,message:"topP must be a number"});if(r!=null&&typeof r!="number")throw new ga({parameter:"topK",value:r,message:"topK must be a number"});if(i!=null&&typeof i!="number")throw new ga({parameter:"presencePenalty",value:i,message:"presencePenalty must be a number"});if(s!=null&&typeof s!="number")throw new ga({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(o!=null&&!Number.isInteger(o))throw new ga({parameter:"seed",value:o,message:"seed must be an integer"});return{maxOutputTokens:n,temperature:e,topP:t,topK:r,presencePenalty:i,frequencyPenalty:s,stopSequences:a,seed:o}}function o_e(n){return n!=null&&Object.keys(n).length>0}function a_e({tools:n,toolChoice:e,activeTools:t}){return o_e(n)?{tools:(t!=null?Object.entries(n).filter(([i])=>t.includes(i)):Object.entries(n)).map(([i,s])=>{const o=s.type;switch(o){case void 0:case"dynamic":case"function":return{type:"function",name:i,description:s.description,inputSchema:Ub(s.inputSchema).jsonSchema,providerOptions:s.providerOptions};case"provider-defined":return{type:"provider-defined",name:i,id:s.id,args:s.args};default:{const a=o;throw new Error(`Unsupported tool type: ${a}`)}}}),toolChoice:e==null?{type:"auto"}:typeof e=="string"?{type:e}:{type:"tool",toolName:e.toolName}}:{tools:void 0,toolChoice:void 0}}var Mg=Z0e(()=>Xn([w0e(),Ce(),St(),Cs(),Mu(Ce(),Mg),Xt(Mg)])),Wa=Mu(Ce(),Mu(Ce(),Mg)),f7=je({type:dn("text"),text:Ce(),providerOptions:Wa.optional()}),l_e=je({type:dn("image"),image:Xn([d7,_0(URL)]),mediaType:Ce().optional(),providerOptions:Wa.optional()}),p7=je({type:dn("file"),data:Xn([d7,_0(URL)]),filename:Ce().optional(),mediaType:Ce(),providerOptions:Wa.optional()}),c_e=je({type:dn("reasoning"),text:Ce(),providerOptions:Wa.optional()}),u_e=je({type:dn("tool-call"),toolCallId:Ce(),toolName:Ce(),input:Il(),providerOptions:Wa.optional(),providerExecuted:Cs().optional()}),d_e=C0e("type",[je({type:dn("text"),value:Ce()}),je({type:dn("json"),value:Mg}),je({type:dn("error-text"),value:Ce()}),je({type:dn("error-json"),value:Mg}),je({type:dn("content"),value:Xt(Xn([je({type:dn("text"),text:Ce()}),je({type:dn("media"),data:Ce(),mediaType:Ce()})]))})]),g7=je({type:dn("tool-result"),toolCallId:Ce(),toolName:Ce(),output:d_e,providerOptions:Wa.optional()}),h_e=je({role:dn("system"),content:Ce(),providerOptions:Wa.optional()}),f_e=je({role:dn("user"),content:Xn([Ce(),Xt(Xn([f7,l_e,p7]))]),providerOptions:Wa.optional()}),p_e=je({role:dn("assistant"),content:Xn([Ce(),Xt(Xn([f7,p7,c_e,u_e,g7]))]),providerOptions:Wa.optional()}),g_e=je({role:dn("tool"),content:Xt(g7),providerOptions:Wa.optional()}),m_e=Xn([h_e,f_e,p_e,g_e]);async function v_e(n){if(n.prompt==null&&n.messages==null)throw new Od({prompt:n,message:"prompt or messages must be defined"});if(n.prompt!=null&&n.messages!=null)throw new Od({prompt:n,message:"prompt and messages cannot be defined at the same time"});if(n.system!=null&&typeof n.system!="string")throw new Od({prompt:n,message:"system must be a string"});let e;if(n.prompt!=null&&typeof n.prompt=="string")e=[{role:"user",content:n.prompt}];else if(n.prompt!=null&&Array.isArray(n.prompt))e=n.prompt;else if(n.messages!=null)e=n.messages;else throw new Od({prompt:n,message:"prompt or messages must be defined"});if(e.length===0)throw new Od({prompt:n,message:"messages must not be empty"});const t=await Ac({value:e,schema:Xt(m_e)});if(!t.success)throw new Od({prompt:n,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:t.error});return{messages:e,system:n.system}}function y_e(n){if(!hT.isInstance(n))return n;const e=(process==null?void 0:"production")==="production",t="https://ai-sdk.dev/unauthenticated-ai-gateway";return e?new xn({name:"GatewayError",message:`Unauthenticated. Configure AI_GATEWAY_API_KEY or use a provider module. Learn more: ${t}`}):Object.assign(new Error(`\x1B[1m\x1B[31mUnauthenticated request to AI Gateway.\x1B[0m

To authenticate, set the \x1B[33mAI_GATEWAY_API_KEY\x1B[0m environment variable with your API key.

Alternatively, you can use a provider module instead of the AI Gateway.

Learn more: \x1B[34m${t}\x1B[0m

`),{name:"GatewayAuthenticationError"})}function tk({operationId:n,telemetry:e}){return{"operation.name":`${n}${e?.functionId!=null?` ${e.functionId}`:""}`,"resource.name":e?.functionId,"ai.operationId":n,"ai.telemetry.functionId":e?.functionId}}function b_e({model:n,settings:e,telemetry:t,headers:r}){var i;return{"ai.model.provider":n.provider,"ai.model.id":n.modelId,...Object.entries(e).reduce((s,[o,a])=>(s[`ai.settings.${o}`]=a,s),{}),...Object.entries((i=t?.metadata)!=null?i:{}).reduce((s,[o,a])=>(s[`ai.telemetry.metadata.${o}`]=a,s),{}),...Object.entries(r??{}).reduce((s,[o,a])=>(a!==void 0&&(s[`ai.request.headers.${o}`]=a),s),{})}}var w_e={startSpan(){return Av},startActiveSpan(n,e,t,r){if(typeof e=="function")return e(Av);if(typeof t=="function")return t(Av);if(typeof r=="function")return r(Av)}},Av={spanContext(){return __e},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},__e={traceId:"",spanId:"",traceFlags:0};function O_e({isEnabled:n=!1,tracer:e}={}){return n?e||k1e.getTracer("ai"):w_e}function nk({name:n,tracer:e,attributes:t,fn:r,endWhenDone:i=!0}){return e.startActiveSpan(n,{attributes:t},async s=>{try{const o=await r(s);return i&&s.end(),o}catch(o){try{m7(s,o)}finally{s.end()}throw o}})}function m7(n,e){e instanceof Error?(n.recordException({name:e.name,message:e.message,stack:e.stack}),n.setStatus({code:A0.ERROR,message:e.message})):n.setStatus({code:A0.ERROR})}function Xd({telemetry:n,attributes:e}){return n?.isEnabled!==!0?{}:Object.entries(e).reduce((t,[r,i])=>{if(i==null)return t;if(typeof i=="object"&&"input"in i&&typeof i.input=="function"){if(n?.recordInputs===!1)return t;const s=i.input();return s==null?t:{...t,[r]:s}}if(typeof i=="object"&&"output"in i&&typeof i.output=="function"){if(n?.recordOutputs===!1)return t;const s=i.output();return s==null?t:{...t,[r]:s}}return{...t,[r]:i}},{})}function x_e(n){return JSON.stringify(n.map(e=>({...e,content:typeof e.content=="string"?e.content:e.content.map(t=>t.type==="file"?{...t,data:t.data instanceof Uint8Array?e_e(t.data):t.data}:t)})))}function k_e(n,e){return{inputTokens:Bf(n.inputTokens,e.inputTokens),outputTokens:Bf(n.outputTokens,e.outputTokens),totalTokens:Bf(n.totalTokens,e.totalTokens),reasoningTokens:Bf(n.reasoningTokens,e.reasoningTokens),cachedInputTokens:Bf(n.cachedInputTokens,e.cachedInputTokens)}}function Bf(n,e){return n==null&&e==null?void 0:(n??0)+(e??0)}function wR(n){return n===void 0?[]:Array.isArray(n)?n:[n]}function S_e({error:n,exponentialBackoffDelay:e}){const t=n.responseHeaders;if(!t)return e;let r;const i=t["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(r=o)}const s=t["retry-after"];if(s&&r===void 0){const o=parseFloat(s);Number.isNaN(o)?r=Date.parse(s)-Date.now():r=o*1e3}return r!=null&&!Number.isNaN(r)&&0<=r&&(r<60*1e3||r<e)?r:e}var T_e=({maxRetries:n=2,initialDelayInMs:e=2e3,backoffFactor:t=2,abortSignal:r}={})=>async i=>v7(i,{maxRetries:n,delayInMs:e,backoffFactor:t,abortSignal:r});async function v7(n,{maxRetries:e,delayInMs:t,backoffFactor:r,abortSignal:i},s=[]){try{return await n()}catch(o){if(Ru(o)||e===0)throw o;const a=c8(o),l=[...s,o],c=l.length;if(c>e)throw new bR({message:`Failed after ${c} attempts. Last error: ${a}`,reason:"maxRetriesExceeded",errors:l});if(o instanceof Error&&Bi.isInstance(o)&&o.isRetryable===!0&&c<=e)return await K0e(S_e({error:o,exponentialBackoffDelay:t}),{abortSignal:i}),v7(n,{maxRetries:e,delayInMs:r*t,backoffFactor:r,abortSignal:i},l);throw c===1?o:new bR({message:`Failed after ${c} attempts with non-retryable error: '${a}'`,reason:"errorNotRetryable",errors:l})}}function A_e({maxRetries:n,abortSignal:e}){if(n!=null){if(!Number.isInteger(n))throw new ga({parameter:"maxRetries",value:n,message:"maxRetries must be an integer"});if(n<0)throw new ga({parameter:"maxRetries",value:n,message:"maxRetries must be >= 0"})}const t=n??2;return{maxRetries:t,retry:T_e({maxRetries:t,abortSignal:e})}}var C_e=class{constructor({data:n,mediaType:e}){const t=n instanceof Uint8Array;this.base64Data=t?void 0:n,this.uint8ArrayData=t?n:void 0,this.mediaType=e}get base64(){return this.base64Data==null&&(this.base64Data=Kx(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=dT(this.base64Data)),this.uint8ArrayData}},E_e=class extends C_e{constructor(n){super(n),this.type="file"}};async function P_e({toolCall:n,tools:e,repairToolCall:t,system:r,messages:i}){try{if(e==null)throw new ek({toolName:n.toolName});try{return await _R({toolCall:n,tools:e})}catch(s){if(t==null||!(ek.isInstance(s)||U8.isInstance(s)))throw s;let o=null;try{o=await t({toolCall:n,tools:e,inputSchema:({toolName:a})=>{const{inputSchema:l}=e[a];return Ub(l).jsonSchema},system:r,messages:i,error:s})}catch(a){throw new F1e({cause:a,originalError:s})}if(o==null)throw s;return await _R({toolCall:o,tools:e})}}catch(s){const o=await Du({text:n.input}),a=o.success?o.value:n.input;return{type:"tool-call",toolCallId:n.toolCallId,toolName:n.toolName,input:a,dynamic:!0,invalid:!0,error:s,providerMetadata:n.providerMetadata}}}async function _R({toolCall:n,tools:e}){const t=n.toolName,r=e[t];if(r==null)throw new ek({toolName:n.toolName,availableTools:Object.keys(e)});const i=Ub(r.inputSchema),s=n.input.trim()===""?await Ac({value:{},schema:i}):await Du({text:n.input,schema:i});if(s.success===!1)throw new U8({toolName:t,toolInput:n.input,cause:s.error});return r.type==="dynamic"?{type:"tool-call",toolCallId:n.toolCallId,toolName:n.toolName,input:s.value,providerExecuted:n.providerExecuted,providerMetadata:n.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:n.toolCallId,toolName:t,input:s.value,providerExecuted:n.providerExecuted,providerMetadata:n.providerMetadata}}var I_e=class{constructor({content:n,finishReason:e,usage:t,warnings:r,request:i,response:s,providerMetadata:o}){this.content=n,this.finishReason=e,this.usage=t,this.warnings=r,this.request=i,this.response=s,this.providerMetadata=o}get text(){return this.content.filter(n=>n.type==="text").map(n=>n.text).join("")}get reasoning(){return this.content.filter(n=>n.type==="reasoning")}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(n=>n.text).join("")}get files(){return this.content.filter(n=>n.type==="file").map(n=>n.file)}get sources(){return this.content.filter(n=>n.type==="source")}get toolCalls(){return this.content.filter(n=>n.type==="tool-call")}get staticToolCalls(){return this.toolCalls.filter(n=>n.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter(n=>n.dynamic===!0)}get toolResults(){return this.content.filter(n=>n.type==="tool-result")}get staticToolResults(){return this.toolResults.filter(n=>n.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter(n=>n.dynamic===!0)}};function rk(n){return({steps:e})=>e.length===n}async function M_e({stopConditions:n,steps:e}){return(await Promise.all(n.map(t=>t({steps:e})))).some(t=>t)}function m_({output:n,tool:e,errorMode:t}){return t==="text"?{type:"error-text",value:cf(n)}:t==="json"?{type:"error-json",value:OR(n)}:e?.toModelOutput?e.toModelOutput(n):typeof n=="string"?{type:"text",value:n}:{type:"json",value:OR(n)}}function OR(n){return n===void 0?null:n}function xR({content:n,tools:e}){const t=[],r=n.filter(s=>s.type!=="source").filter(s=>(s.type!=="tool-result"||s.providerExecuted)&&(s.type!=="tool-error"||s.providerExecuted)).filter(s=>s.type!=="text"||s.text.length>0).map(s=>{switch(s.type){case"text":return{type:"text",text:s.text,providerOptions:s.providerMetadata};case"reasoning":return{type:"reasoning",text:s.text,providerOptions:s.providerMetadata};case"file":return{type:"file",data:s.file.base64,mediaType:s.file.mediaType,providerOptions:s.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:s.toolCallId,toolName:s.toolName,input:s.input,providerExecuted:s.providerExecuted,providerOptions:s.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:m_({tool:e?.[s.toolName],output:s.output,errorMode:"none"}),providerExecuted:!0,providerOptions:s.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:m_({tool:e?.[s.toolName],output:s.error,errorMode:"json"}),providerOptions:s.providerMetadata}}});r.length>0&&t.push({role:"assistant",content:r});const i=n.filter(s=>s.type==="tool-result"||s.type==="tool-error").filter(s=>!s.providerExecuted).map(s=>({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:m_({tool:e?.[s.toolName],output:s.type==="tool-result"?s.output:s.error,errorMode:s.type==="tool-error"?"text":"none"}),...s.providerMetadata!=null?{providerOptions:s.providerMetadata}:{}}));return i.length>0&&t.push({role:"tool",content:i}),t}vm({prefix:"aitxt",size:24});function jb(n,e){const t=new Headers(n??{});for(const[r,i]of Object.entries(e))t.has(r)||t.set(r,i);return t}function R_e({status:n,statusText:e,headers:t,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:n??200,statusText:e,headers:jb(t,{"content-type":"text/plain; charset=utf-8"})})}function y7({response:n,status:e,statusText:t,headers:r,stream:i}){n.writeHead(e??200,t,r);const s=i.getReader();(async()=>{try{for(;;){const{done:a,value:l}=await s.read();if(a)break;n.write(l)||await new Promise(d=>{n.once("drain",d)})}}catch(a){throw a}finally{n.end()}})()}function D_e({response:n,status:e,statusText:t,headers:r,textStream:i}){y7({response:n,status:e,statusText:t,headers:Object.fromEntries(jb(r,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:i.pipeThrough(new TextEncoderStream)})}var b7=class extends TransformStream{constructor(){super({transform(n,e){e.enqueue(`data: ${JSON.stringify(n)}

`)},flush(n){n.enqueue(`data: [DONE]

`)}})}},w7={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function N_e({status:n,statusText:e,headers:t,stream:r,consumeSseStream:i}){let s=r.pipeThrough(new b7);if(i){const[o,a]=s.tee();s=o,i({stream:a})}return new Response(s.pipeThrough(new TextEncoderStream),{status:n,statusText:e,headers:jb(t,w7)})}function L_e({originalMessages:n,responseMessageId:e}){if(n==null)return;const t=n[n.length-1];return t?.role==="assistant"?t.id:typeof e=="function"?e():e}function Q_e(n){return n.type.startsWith("data-")}function _7(n,e){if(n===void 0&&e===void 0)return;if(n===void 0)return e;if(e===void 0)return n;const t={...n};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const i=e[r];if(i===void 0)continue;const s=r in n?n[r]:void 0,o=i!==null&&typeof i=="object"&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp),a=s!=null&&typeof s=="object"&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp);o&&a?t[r]=_7(s,i):t[r]=i}return t}function $_e(n){const e=["ROOT"];let t=-1,r=null;function i(l,c,d){switch(l){case'"':{t=c,e.pop(),e.push(d),e.push("INSIDE_STRING");break}case"f":case"t":case"n":{t=c,r=c,e.pop(),e.push(d),e.push("INSIDE_LITERAL");break}case"-":{e.pop(),e.push(d),e.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{t=c,e.pop(),e.push(d),e.push("INSIDE_NUMBER");break}case"{":{t=c,e.pop(),e.push(d),e.push("INSIDE_OBJECT_START");break}case"[":{t=c,e.pop(),e.push(d),e.push("INSIDE_ARRAY_START");break}}}function s(l,c){switch(l){case",":{e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{t=c,e.pop();break}}}function o(l,c){switch(l){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{t=c,e.pop();break}}}for(let l=0;l<n.length;l++){const c=n[l];switch(e[e.length-1]){case"ROOT":i(c,l,"FINISH");break;case"INSIDE_OBJECT_START":{switch(c){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}case"}":{t=l,e.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(c){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(c){case'"':{e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(c){case":":{e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{i(c,l,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{s(c,l);break}case"INSIDE_STRING":{switch(c){case'"':{e.pop(),t=l;break}case"\\":{e.push("INSIDE_STRING_ESCAPE");break}default:t=l}break}case"INSIDE_ARRAY_START":{switch(c){case"]":{t=l,e.pop();break}default:{t=l,i(c,l,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(c){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{t=l,e.pop();break}default:{t=l;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{i(c,l,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{e.pop(),t=l;break}case"INSIDE_NUMBER":{switch(c){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{t=l;break}case"e":case"E":case"-":case".":break;case",":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(c,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(c,l);break}case"}":{e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(c,l);break}case"]":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(c,l);break}default:{e.pop();break}}break}case"INSIDE_LITERAL":{const h=n.substring(r,l+1);!"false".startsWith(h)&&!"true".startsWith(h)&&!"null".startsWith(h)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?s(c,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(c,l)):t=l;break}}}let a=n.slice(0,t+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":{a+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{a+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{a+="]";break}case"INSIDE_LITERAL":{const d=n.substring(r,n.length);"true".startsWith(d)?a+="true".slice(d.length):"false".startsWith(d)?a+="false".slice(d.length):"null".startsWith(d)&&(a+="null".slice(d.length))}}return a}async function O7(n){if(n===void 0)return{value:void 0,state:"undefined-input"};let e=await Du({text:n});return e.success?{value:e.value,state:"successful-parse"}:(e=await Du({text:$_e(n)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function v_(n){return n.type.startsWith("tool-")}function kR(n){return n.type.split("-").slice(1).join("-")}function F_e({lastMessage:n,messageId:e}){return{message:n?.role==="assistant"?n:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function z_e({stream:n,messageMetadataSchema:e,dataPartSchemas:t,runUpdateMessageJob:r,onError:i,onToolCall:s,onData:o}){return n.pipeThrough(new TransformStream({async transform(a,l){await r(async({state:c,write:d})=>{var h,f,p,g;function m(x){const S=c.message.parts.filter(v_).find(E=>E.toolCallId===x);if(S==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return S}function v(x){const S=c.message.parts.filter(E=>E.type==="dynamic-tool").find(E=>E.toolCallId===x);if(S==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return S}function y(x){var k;const S=c.message.parts.find(C=>v_(C)&&C.toolCallId===x.toolCallId),E=x,R=S;S!=null?(S.state=x.state,R.input=E.input,R.output=E.output,R.errorText=E.errorText,R.rawInput=E.rawInput,R.preliminary=E.preliminary,R.providerExecuted=(k=E.providerExecuted)!=null?k:S.providerExecuted,E.providerMetadata!=null&&S.state==="input-available"&&(S.callProviderMetadata=E.providerMetadata)):c.message.parts.push({type:`tool-${x.toolName}`,toolCallId:x.toolCallId,state:x.state,input:E.input,output:E.output,rawInput:E.rawInput,errorText:E.errorText,providerExecuted:E.providerExecuted,preliminary:E.preliminary,...E.providerMetadata!=null?{callProviderMetadata:E.providerMetadata}:{}})}function O(x){var k,S;const E=c.message.parts.find(I=>I.type==="dynamic-tool"&&I.toolCallId===x.toolCallId),R=x,C=E;E!=null?(E.state=x.state,C.toolName=x.toolName,C.input=R.input,C.output=R.output,C.errorText=R.errorText,C.rawInput=(k=R.rawInput)!=null?k:C.rawInput,C.preliminary=R.preliminary,C.providerExecuted=(S=R.providerExecuted)!=null?S:E.providerExecuted,R.providerMetadata!=null&&E.state==="input-available"&&(E.callProviderMetadata=R.providerMetadata)):c.message.parts.push({type:"dynamic-tool",toolName:x.toolName,toolCallId:x.toolCallId,state:x.state,input:R.input,output:R.output,errorText:R.errorText,preliminary:R.preliminary,providerExecuted:R.providerExecuted,...R.providerMetadata!=null?{callProviderMetadata:R.providerMetadata}:{}})}async function _(x){if(x!=null){const k=c.message.metadata!=null?_7(c.message.metadata,x):x;e!=null&&await Xx({value:k,schema:e}),c.message.metadata=k}}switch(a.type){case"text-start":{const x={type:"text",text:"",providerMetadata:a.providerMetadata,state:"streaming"};c.activeTextParts[a.id]=x,c.message.parts.push(x),d();break}case"text-delta":{const x=c.activeTextParts[a.id];x.text+=a.delta,x.providerMetadata=(h=a.providerMetadata)!=null?h:x.providerMetadata,d();break}case"text-end":{const x=c.activeTextParts[a.id];x.state="done",x.providerMetadata=(f=a.providerMetadata)!=null?f:x.providerMetadata,delete c.activeTextParts[a.id],d();break}case"reasoning-start":{const x={type:"reasoning",text:"",providerMetadata:a.providerMetadata,state:"streaming"};c.activeReasoningParts[a.id]=x,c.message.parts.push(x),d();break}case"reasoning-delta":{const x=c.activeReasoningParts[a.id];x.text+=a.delta,x.providerMetadata=(p=a.providerMetadata)!=null?p:x.providerMetadata,d();break}case"reasoning-end":{const x=c.activeReasoningParts[a.id];x.providerMetadata=(g=a.providerMetadata)!=null?g:x.providerMetadata,x.state="done",delete c.activeReasoningParts[a.id],d();break}case"file":{c.message.parts.push({type:"file",mediaType:a.mediaType,url:a.url}),d();break}case"source-url":{c.message.parts.push({type:"source-url",sourceId:a.sourceId,url:a.url,title:a.title,providerMetadata:a.providerMetadata}),d();break}case"source-document":{c.message.parts.push({type:"source-document",sourceId:a.sourceId,mediaType:a.mediaType,title:a.title,filename:a.filename,providerMetadata:a.providerMetadata}),d();break}case"tool-input-start":{const x=c.message.parts.filter(v_);c.partialToolCalls[a.toolCallId]={text:"",toolName:a.toolName,index:x.length,dynamic:a.dynamic},a.dynamic?O({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-streaming",input:void 0,providerExecuted:a.providerExecuted}):y({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-streaming",input:void 0,providerExecuted:a.providerExecuted}),d();break}case"tool-input-delta":{const x=c.partialToolCalls[a.toolCallId];x.text+=a.inputTextDelta;const{value:k}=await O7(x.text);x.dynamic?O({toolCallId:a.toolCallId,toolName:x.toolName,state:"input-streaming",input:k}):y({toolCallId:a.toolCallId,toolName:x.toolName,state:"input-streaming",input:k}),d();break}case"tool-input-available":{a.dynamic?O({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-available",input:a.input,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}):y({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-available",input:a.input,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}),d(),s&&!a.providerExecuted&&await s({toolCall:a});break}case"tool-input-error":{a.dynamic?O({toolCallId:a.toolCallId,toolName:a.toolName,state:"output-error",input:a.input,errorText:a.errorText,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}):y({toolCallId:a.toolCallId,toolName:a.toolName,state:"output-error",input:void 0,rawInput:a.input,errorText:a.errorText,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}),d();break}case"tool-output-available":{if(a.dynamic){const x=v(a.toolCallId);O({toolCallId:a.toolCallId,toolName:x.toolName,state:"output-available",input:x.input,output:a.output,preliminary:a.preliminary})}else{const x=m(a.toolCallId);y({toolCallId:a.toolCallId,toolName:kR(x),state:"output-available",input:x.input,output:a.output,providerExecuted:a.providerExecuted,preliminary:a.preliminary})}d();break}case"tool-output-error":{if(a.dynamic){const x=v(a.toolCallId);O({toolCallId:a.toolCallId,toolName:x.toolName,state:"output-error",input:x.input,errorText:a.errorText,providerExecuted:a.providerExecuted})}else{const x=m(a.toolCallId);y({toolCallId:a.toolCallId,toolName:kR(x),state:"output-error",input:x.input,rawInput:x.rawInput,errorText:a.errorText,providerExecuted:a.providerExecuted})}d();break}case"start-step":{c.message.parts.push({type:"step-start"});break}case"finish-step":{c.activeTextParts={},c.activeReasoningParts={};break}case"start":{a.messageId!=null&&(c.message.id=a.messageId),await _(a.messageMetadata),(a.messageId!=null||a.messageMetadata!=null)&&d();break}case"finish":{a.finishReason!=null&&(c.finishReason=a.finishReason),await _(a.messageMetadata),a.messageMetadata!=null&&d();break}case"message-metadata":{await _(a.messageMetadata),a.messageMetadata!=null&&d();break}case"error":{i?.(new Error(a.errorText));break}default:if(Q_e(a)){t?.[a.type]!=null&&await Xx({value:a.data,schema:t[a.type]});const x=a;if(x.transient){o?.(x);break}const k=x.id!=null?c.message.parts.find(S=>x.type===S.type&&x.id===S.id):void 0;k!=null?k.data=x.data:c.message.parts.push(x),o?.(x),d()}}l.enqueue(a)})}}))}function B_e({messageId:n,originalMessages:e=[],onFinish:t,onError:r,stream:i}){let s=e?.[e.length-1];s?.role!=="assistant"?s=void 0:n=s.id;let o=!1;const a=i.pipeThrough(new TransformStream({transform(f,p){if(f.type==="start"){const g=f;g.messageId==null&&n!=null&&(g.messageId=n)}f.type==="abort"&&(o=!0),p.enqueue(f)}}));if(t==null)return a;const l=F_e({lastMessage:s?structuredClone(s):void 0,messageId:n??""}),c=async f=>{await f({state:l,write:()=>{}})};let d=!1;const h=async()=>{if(d||!t)return;d=!0;const f=l.message.id===s?.id;await t({isAborted:o,isContinuation:f,responseMessage:l.message,messages:[...f?e.slice(0,-1):e,l.message],finishReason:l.finishReason})};return z_e({stream:a,runUpdateMessageJob:c,onError:r}).pipeThrough(new TransformStream({transform(f,p){p.enqueue(f)},async cancel(){await h()},async flush(){await h()}}))}function U_e({response:n,status:e,statusText:t,headers:r,stream:i,consumeSseStream:s}){let o=i.pipeThrough(new b7);if(s){const[a,l]=o.tee();o=a,s({stream:l})}y7({response:n,status:e,statusText:t,headers:Object.fromEntries(jb(r,w7).entries()),stream:o.pipeThrough(new TextEncoderStream)})}function Cv(n){const e=n.pipeThrough(new TransformStream);return e[Symbol.asyncIterator]=function(){const t=this.getReader();let r=!1;async function i(s){var o;r=!0;try{s&&await((o=t.cancel)==null?void 0:o.call(t))}finally{try{t.releaseLock()}catch{}}}return{async next(){if(r)return{done:!0,value:void 0};const{done:s,value:o}=await t.read();return s?(await i(!0),{done:!0,value:void 0}):{done:!1,value:o}},async return(){return await i(!0),{done:!0,value:void 0}},async throw(s){throw await i(!0),s}}},e}async function j_e({stream:n,onError:e}){const t=n.getReader();try{for(;;){const{done:r}=await t.read();if(r)break}}catch(r){e?.(r)}finally{t.releaseLock()}}function SR(){let n,e;return{promise:new Promise((r,i)=>{n=r,e=i}),resolve:n,reject:e}}function V_e(){let n=[],e=null,t=!1,r=SR();const i=()=>{t=!0,r.resolve(),n.forEach(o=>o.cancel()),n=[],e?.close()},s=async()=>{if(t&&n.length===0){e?.close();return}if(n.length===0)return r=SR(),await r.promise,s();try{const{value:o,done:a}=await n[0].read();a?(n.shift(),n.length>0?await s():t&&e?.close()):e?.enqueue(o)}catch(o){e?.error(o),n.shift(),i()}};return{stream:new ReadableStream({start(o){e=o},pull:s,async cancel(){for(const o of n)await o.cancel();n=[],t=!0}}),addStream:o=>{if(t)throw new Error("Cannot add inner stream: outer stream is closed");n.push(o.getReader()),r.resolve()},close:()=>{t=!0,r.resolve(),n.length===0&&e?.close()},terminate:i}}function q_e(){var n,e;return(e=(n=globalThis?.performance)==null?void 0:n.now())!=null?e:Date.now()}function H_e({tools:n,generatorStream:e,tracer:t,telemetry:r,system:i,messages:s,abortSignal:o,repairToolCall:a,experimental_context:l}){let c=null;const d=new ReadableStream({start(y){c=y}}),h=new Set,f=new Map;let p=!1,g;function m(){p&&h.size===0&&(g!=null&&c.enqueue(g),c.close())}const v=new TransformStream({async transform(y,O){const _=y.type;switch(_){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":{O.enqueue(y);break}case"file":{O.enqueue({type:"file",file:new E_e({data:y.data,mediaType:y.mediaType})});break}case"finish":{g={type:"finish",finishReason:y.finishReason,usage:y.usage,providerMetadata:y.providerMetadata};break}case"tool-call":{try{const x=await P_e({toolCall:y,tools:n,repairToolCall:a,system:i,messages:s});if(O.enqueue(x),x.invalid){c.enqueue({type:"tool-error",toolCallId:x.toolCallId,toolName:x.toolName,input:x.input,error:c8(x.error),dynamic:!0});break}const k=n[x.toolName];if(f.set(x.toolCallId,x.input),k.onInputAvailable!=null&&await k.onInputAvailable({input:x.input,toolCallId:x.toolCallId,messages:s,abortSignal:o,experimental_context:l}),k.execute!=null&&x.providerExecuted!==!0){const S=J0e();h.add(S),nk({name:"ai.toolCall",attributes:Xd({telemetry:r,attributes:{...tk({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":x.toolName,"ai.toolCall.id":x.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(x.input)}}}),tracer:t,fn:async E=>{let R;try{const C=dwe({execute:k.execute.bind(k),input:x.input,options:{toolCallId:x.toolCallId,messages:s,abortSignal:o,experimental_context:l}});for await(const I of C)c.enqueue({...x,type:"tool-result",output:I.output,...I.type==="preliminary"&&{preliminary:!0}}),I.type==="final"&&(R=I.output)}catch(C){m7(E,C),c.enqueue({...x,type:"tool-error",error:C}),h.delete(S),m();return}h.delete(S),m();try{E.setAttributes(Xd({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(R)}}}))}catch{}}})}}catch(x){c.enqueue({type:"error",error:x})}break}case"tool-result":{const x=y.toolName;y.isError?c.enqueue({type:"tool-error",toolCallId:y.toolCallId,toolName:x,input:f.get(y.toolCallId),providerExecuted:y.providerExecuted,error:y.result}):O.enqueue({type:"tool-result",toolCallId:y.toolCallId,toolName:x,input:f.get(y.toolCallId),output:y.result,providerExecuted:y.providerExecuted});break}default:{const x=_;throw new Error(`Unhandled chunk type: ${x}`)}}},flush(){p=!0,m()}});return new ReadableStream({async start(y){return Promise.all([e.pipeThrough(v).pipeTo(new WritableStream({write(O){y.enqueue(O)},close(){}})),d.pipeTo(new WritableStream({write(O){y.enqueue(O)},close(){y.close()}}))])}})}var Z_e=vm({prefix:"aitxt",size:24});function C0({model:n,tools:e,toolChoice:t,system:r,prompt:i,messages:s,maxRetries:o,abortSignal:a,headers:l,stopWhen:c=rk(1),experimental_output:d,experimental_telemetry:h,prepareStep:f,providerOptions:p,experimental_activeTools:g,activeTools:m=g,experimental_repairToolCall:v,experimental_transform:y,experimental_download:O,includeRawChunks:_=!1,onChunk:x,onError:k=({error:N})=>{console.error(N)},onFinish:S,onAbort:E,onStepFinish:R,experimental_context:C,_internal:{now:I=q_e,generateId:D=Z_e,currentDate:Q=()=>new Date}={},...M}){return new X_e({model:u7(n),telemetry:h,headers:l,settings:M,maxRetries:o,abortSignal:a,system:r,prompt:i,messages:s,tools:e,toolChoice:t,transforms:wR(y),activeTools:m,repairToolCall:v,stopConditions:wR(c),output:d,providerOptions:p,prepareStep:f,includeRawChunks:_,onChunk:x,onError:k,onFinish:S,onAbort:E,onStepFinish:R,now:I,currentDate:Q,generateId:D,experimental_context:C,download:O})}function W_e(n){if(!n)return new TransformStream({transform(o,a){a.enqueue({part:o,partialOutput:void 0})}});let e,t="",r="",i="";function s({controller:o,partialOutput:a=void 0}){o.enqueue({part:{type:"text-delta",id:e,text:r},partialOutput:a}),r=""}return new TransformStream({async transform(o,a){if(o.type==="finish-step"&&r.length>0&&s({controller:a}),o.type!=="text-delta"&&o.type!=="text-start"&&o.type!=="text-end"){a.enqueue({part:o,partialOutput:void 0});return}if(e==null)e=o.id;else if(o.id!==e){a.enqueue({part:o,partialOutput:void 0});return}if(o.type==="text-start"){a.enqueue({part:o,partialOutput:void 0});return}if(o.type==="text-end"){r.length>0&&s({controller:a}),a.enqueue({part:o,partialOutput:void 0});return}t+=o.text,r+=o.text;const l=await n.parsePartial({text:t});if(l!=null){const c=JSON.stringify(l.partial);c!==i&&(s({controller:a,partialOutput:l.partial}),i=c)}}})}var X_e=class{constructor({model:n,telemetry:e,headers:t,settings:r,maxRetries:i,abortSignal:s,system:o,prompt:a,messages:l,tools:c,toolChoice:d,transforms:h,activeTools:f,repairToolCall:p,stopConditions:g,output:m,providerOptions:v,prepareStep:y,includeRawChunks:O,now:_,currentDate:x,generateId:k,onChunk:S,onError:E,onFinish:R,onAbort:C,onStepFinish:I,experimental_context:D,download:Q}){this._totalUsage=new Tv,this._finishReason=new Tv,this._steps=new Tv,this.output=m,this.includeRawChunks=O,this.tools=c;let M,N=[];const B=[];let H,F,Z={},$=[];const W=[];let G,L={},q={};const ue=new TransformStream({async transform(ee,U){var X,ie,ye,pe;U.enqueue(ee);const{part:de}=ee;if((de.type==="text-delta"||de.type==="reasoning-delta"||de.type==="source"||de.type==="tool-call"||de.type==="tool-result"||de.type==="tool-input-start"||de.type==="tool-input-delta"||de.type==="raw")&&await S?.({chunk:de}),de.type==="error"&&await E({error:y_e(de.error)}),de.type==="text-start"&&(L[de.id]={type:"text",text:"",providerMetadata:de.providerMetadata},N.push(L[de.id])),de.type==="text-delta"){const we=L[de.id];if(we==null){U.enqueue({part:{type:"error",error:`text part ${de.id} not found`},partialOutput:void 0});return}we.text+=de.text,we.providerMetadata=(X=de.providerMetadata)!=null?X:we.providerMetadata}if(de.type==="text-end"){const we=L[de.id];if(we==null){U.enqueue({part:{type:"error",error:`text part ${de.id} not found`},partialOutput:void 0});return}we.providerMetadata=(ie=de.providerMetadata)!=null?ie:we.providerMetadata,delete L[de.id]}if(de.type==="reasoning-start"&&(q[de.id]={type:"reasoning",text:"",providerMetadata:de.providerMetadata},N.push(q[de.id])),de.type==="reasoning-delta"){const we=q[de.id];if(we==null){U.enqueue({part:{type:"error",error:`reasoning part ${de.id} not found`},partialOutput:void 0});return}we.text+=de.text,we.providerMetadata=(ye=de.providerMetadata)!=null?ye:we.providerMetadata}if(de.type==="reasoning-end"){const we=q[de.id];if(we==null){U.enqueue({part:{type:"error",error:`reasoning part ${de.id} not found`},partialOutput:void 0});return}we.providerMetadata=(pe=de.providerMetadata)!=null?pe:we.providerMetadata,delete q[de.id]}if(de.type==="file"&&N.push({type:"file",file:de.file}),de.type==="source"&&N.push(de),de.type==="tool-call"&&N.push(de),de.type==="tool-result"&&!de.preliminary&&N.push(de),de.type==="tool-error"&&N.push(de),de.type==="start-step"&&(Z=de.request,$=de.warnings),de.type==="finish-step"){const we=xR({content:N,tools:c}),me=new I_e({content:N,finishReason:de.finishReason,usage:de.usage,warnings:$,request:Z,response:{...de.response,messages:[...B,...we]},providerMetadata:de.providerMetadata});await I?.(me),I1e($),W.push(me),N=[],q={},L={},B.push(...we),M.resolve()}de.type==="finish"&&(F=de.totalUsage,H=de.finishReason)},async flush(ee){try{if(W.length===0){const ye=new L1e({message:"No output generated. Check the stream for errors."});ne._finishReason.reject(ye),ne._totalUsage.reject(ye),ne._steps.reject(ye);return}const U=H??"unknown",X=F??{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};ne._finishReason.resolve(U),ne._totalUsage.resolve(X),ne._steps.resolve(W);const ie=W[W.length-1];await R?.({finishReason:U,totalUsage:X,usage:ie.usage,content:ie.content,text:ie.text,reasoningText:ie.reasoningText,reasoning:ie.reasoning,files:ie.files,sources:ie.sources,toolCalls:ie.toolCalls,staticToolCalls:ie.staticToolCalls,dynamicToolCalls:ie.dynamicToolCalls,toolResults:ie.toolResults,staticToolResults:ie.staticToolResults,dynamicToolResults:ie.dynamicToolResults,request:ie.request,response:ie.response,warnings:ie.warnings,providerMetadata:ie.providerMetadata,steps:W}),G.setAttributes(Xd({telemetry:e,attributes:{"ai.response.finishReason":U,"ai.response.text":{output:()=>ie.text},"ai.response.toolCalls":{output:()=>{var ye;return(ye=ie.toolCalls)!=null&&ye.length?JSON.stringify(ie.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(ie.providerMetadata),"ai.usage.inputTokens":X.inputTokens,"ai.usage.outputTokens":X.outputTokens,"ai.usage.totalTokens":X.totalTokens,"ai.usage.reasoningTokens":X.reasoningTokens,"ai.usage.cachedInputTokens":X.cachedInputTokens}}))}catch(U){ee.error(U)}finally{G.end()}}}),oe=V_e();this.addStream=oe.addStream,this.closeStream=oe.close;const fe=oe.stream.getReader();let be=new ReadableStream({async start(ee){ee.enqueue({type:"start"})},async pull(ee){function U(){C?.({steps:W}),ee.enqueue({type:"abort"}),ee.close()}try{const{done:X,value:ie}=await fe.read();if(X){ee.close();return}if(s?.aborted){U();return}ee.enqueue(ie)}catch(X){Ru(X)&&s?.aborted?U():ee.error(X)}},cancel(ee){return oe.stream.cancel(ee)}});for(const ee of h)be=be.pipeThrough(ee({tools:c,stopStream(){oe.terminate()}}));this.baseStream=be.pipeThrough(W_e(m)).pipeThrough(ue);const{maxRetries:De,retry:Le}=A_e({maxRetries:i,abortSignal:s}),he=O_e(e),se=s_e(r),V=b_e({model:n,telemetry:e,headers:t,settings:{...se,maxRetries:De}}),ne=this;nk({name:"ai.streamText",attributes:Xd({telemetry:e,attributes:{...tk({operationId:"ai.streamText",telemetry:e}),...V,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:a,messages:l})}}}),tracer:he,endWhenDone:!1,fn:async ee=>{G=ee;async function U({currentStep:X,responseMessages:ie,usage:ye}){var pe,de,we,me,Ee;const _e=ne.includeRawChunks;M=new Tv;const Ae=await v_e({system:o,prompt:a,messages:l}),ze=[...Ae.messages,...ie],Be=await y?.({model:n,steps:W,stepNumber:W.length,messages:ze}),Se=u7((pe=Be?.model)!=null?pe:n),Re=await t_e({prompt:{system:(de=Be?.system)!=null?de:Ae.system,messages:(we=Be?.messages)!=null?we:ze},supportedUrls:await Se.supportedUrls,download:Q}),{toolChoice:He,tools:Me}=a_e({tools:c,toolChoice:(me=Be?.toolChoice)!=null?me:d,activeTools:(Ee=Be?.activeTools)!=null?Ee:f}),{result:{stream:Pe,response:ae,request:te},doStreamSpan:re,startTimestampMs:ve}=await Le(()=>nk({name:"ai.streamText.doStream",attributes:Xd({telemetry:e,attributes:{...tk({operationId:"ai.streamText.doStream",telemetry:e}),...V,"ai.model.provider":Se.provider,"ai.model.id":Se.modelId,"ai.prompt.messages":{input:()=>x_e(Re)},"ai.prompt.tools":{input:()=>Me?.map(Ge=>JSON.stringify(Ge))},"ai.prompt.toolChoice":{input:()=>He!=null?JSON.stringify(He):void 0},"gen_ai.system":Se.provider,"gen_ai.request.model":Se.modelId,"gen_ai.request.frequency_penalty":se.frequencyPenalty,"gen_ai.request.max_tokens":se.maxOutputTokens,"gen_ai.request.presence_penalty":se.presencePenalty,"gen_ai.request.stop_sequences":se.stopSequences,"gen_ai.request.temperature":se.temperature,"gen_ai.request.top_k":se.topK,"gen_ai.request.top_p":se.topP}}),tracer:he,endWhenDone:!1,fn:async Ge=>({startTimestampMs:_(),doStreamSpan:Ge,result:await Se.doStream({...se,tools:Me,toolChoice:He,responseFormat:m?.responseFormat,prompt:Re,providerOptions:v,abortSignal:s,headers:t,includeRawChunks:_e})})})),Te=H_e({tools:c,generatorStream:Pe,tracer:he,telemetry:e,system:o,messages:ze,repairToolCall:p,abortSignal:s,experimental_context:D}),Ne=te??{},ce=[],Oe=[];let Qe;const We={};let st="unknown",it={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},Ct,bt=!0,xt={id:k(),timestamp:x(),modelId:n.modelId},mt="";ne.addStream(Te.pipeThrough(new TransformStream({async transform(Ge,Xe){var ft,at,pt,dt;if(Ge.type==="stream-start"){Qe=Ge.warnings;return}if(bt){const wt=_()-ve;bt=!1,re.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":wt}),re.setAttributes({"ai.response.msToFirstChunk":wt}),Xe.enqueue({type:"start-step",request:Ne,warnings:Qe??[]})}const _t=Ge.type;switch(_t){case"text-start":case"text-end":{Xe.enqueue(Ge);break}case"text-delta":{Ge.delta.length>0&&(Xe.enqueue({type:"text-delta",id:Ge.id,text:Ge.delta,providerMetadata:Ge.providerMetadata}),mt+=Ge.delta);break}case"reasoning-start":case"reasoning-end":{Xe.enqueue(Ge);break}case"reasoning-delta":{Xe.enqueue({type:"reasoning-delta",id:Ge.id,text:Ge.delta,providerMetadata:Ge.providerMetadata});break}case"tool-call":{Xe.enqueue(Ge),ce.push(Ge);break}case"tool-result":{Xe.enqueue(Ge),Ge.preliminary||Oe.push(Ge);break}case"tool-error":{Xe.enqueue(Ge),Oe.push(Ge);break}case"response-metadata":{xt={id:(ft=Ge.id)!=null?ft:xt.id,timestamp:(at=Ge.timestamp)!=null?at:xt.timestamp,modelId:(pt=Ge.modelId)!=null?pt:xt.modelId};break}case"finish":{it=Ge.usage,st=Ge.finishReason,Ct=Ge.providerMetadata;const wt=_()-ve;re.addEvent("ai.stream.finish"),re.setAttributes({"ai.response.msToFinish":wt,"ai.response.avgOutputTokensPerSecond":1e3*((dt=it.outputTokens)!=null?dt:0)/wt});break}case"file":{Xe.enqueue(Ge);break}case"source":{Xe.enqueue(Ge);break}case"tool-input-start":{We[Ge.id]=Ge.toolName;const wt=c?.[Ge.toolName];wt?.onInputStart!=null&&await wt.onInputStart({toolCallId:Ge.id,messages:ze,abortSignal:s,experimental_context:D}),Xe.enqueue({...Ge,dynamic:wt?.type==="dynamic"});break}case"tool-input-end":{delete We[Ge.id],Xe.enqueue(Ge);break}case"tool-input-delta":{const wt=We[Ge.id],Rt=c?.[wt];Rt?.onInputDelta!=null&&await Rt.onInputDelta({inputTextDelta:Ge.delta,toolCallId:Ge.id,messages:ze,abortSignal:s,experimental_context:D}),Xe.enqueue(Ge);break}case"error":{Xe.enqueue(Ge),st="error";break}case"raw":{_e&&Xe.enqueue(Ge);break}default:{const wt=_t;throw new Error(`Unknown chunk type: ${wt}`)}}},async flush(Ge){const Xe=ce.length>0?JSON.stringify(ce):void 0;try{re.setAttributes(Xd({telemetry:e,attributes:{"ai.response.finishReason":st,"ai.response.text":{output:()=>mt},"ai.response.toolCalls":{output:()=>Xe},"ai.response.id":xt.id,"ai.response.model":xt.modelId,"ai.response.timestamp":xt.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Ct),"ai.usage.inputTokens":it.inputTokens,"ai.usage.outputTokens":it.outputTokens,"ai.usage.totalTokens":it.totalTokens,"ai.usage.reasoningTokens":it.reasoningTokens,"ai.usage.cachedInputTokens":it.cachedInputTokens,"gen_ai.response.finish_reasons":[st],"gen_ai.response.id":xt.id,"gen_ai.response.model":xt.modelId,"gen_ai.usage.input_tokens":it.inputTokens,"gen_ai.usage.output_tokens":it.outputTokens}}))}catch{}finally{re.end()}Ge.enqueue({type:"finish-step",finishReason:st,usage:it,providerMetadata:Ct,response:{...xt,headers:ae?.headers}});const ft=k_e(ye,it);await M.promise;const at=ce.filter(dt=>dt.providerExecuted!==!0),pt=Oe.filter(dt=>dt.providerExecuted!==!0);if(at.length>0&&pt.length===at.length&&!await M_e({stopConditions:g,steps:W})){ie.push(...xR({content:W[W.length-1].content,tools:c}));try{await U({currentStep:X+1,responseMessages:ie,usage:ft})}catch(dt){Ge.enqueue({type:"error",error:dt}),ne.closeStream()}}else Ge.enqueue({type:"finish",finishReason:st,totalUsage:ft}),ne.closeStream()}})))}await U({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(ee=>{ne.addStream(new ReadableStream({start(U){U.enqueue({type:"error",error:ee}),U.close()}})),ne.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(n=>n[n.length-1])}get content(){return this.finalStep.then(n=>n.content)}get warnings(){return this.finalStep.then(n=>n.warnings)}get providerMetadata(){return this.finalStep.then(n=>n.providerMetadata)}get text(){return this.finalStep.then(n=>n.text)}get reasoningText(){return this.finalStep.then(n=>n.reasoningText)}get reasoning(){return this.finalStep.then(n=>n.reasoning)}get sources(){return this.finalStep.then(n=>n.sources)}get files(){return this.finalStep.then(n=>n.files)}get toolCalls(){return this.finalStep.then(n=>n.toolCalls)}get staticToolCalls(){return this.finalStep.then(n=>n.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(n=>n.dynamicToolCalls)}get toolResults(){return this.finalStep.then(n=>n.toolResults)}get staticToolResults(){return this.finalStep.then(n=>n.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(n=>n.dynamicToolResults)}get usage(){return this.finalStep.then(n=>n.usage)}get request(){return this.finalStep.then(n=>n.request)}get response(){return this.finalStep.then(n=>n.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){const[n,e]=this.baseStream.tee();return this.baseStream=e,n}get textStream(){return Cv(this.teeStream().pipeThrough(new TransformStream({transform({part:n},e){n.type==="text-delta"&&e.enqueue(n.text)}})))}get fullStream(){return Cv(this.teeStream().pipeThrough(new TransformStream({transform({part:n},e){e.enqueue(n)}})))}async consumeStream(n){var e;try{await j_e({stream:this.fullStream,onError:n?.onError})}catch(t){(e=n?.onError)==null||e.call(n,t)}}get experimental_partialOutputStream(){if(this.output==null)throw new C1e;return Cv(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:n},e){n!=null&&e.enqueue(n)}})))}toUIMessageStream({originalMessages:n,generateMessageId:e,onFinish:t,messageMetadata:r,sendReasoning:i=!0,sendSources:s=!1,sendStart:o=!0,sendFinish:a=!0,onError:l=cf}={}){const c=e!=null?L_e({originalMessages:n,responseMessageId:e}):void 0,d={},h=p=>{var g,m;const v=d[p];return((m=(g=this.tools)==null?void 0:g[v])==null?void 0:m.type)==="dynamic"?!0:void 0},f=this.fullStream.pipeThrough(new TransformStream({transform:async(p,g)=>{const m=r?.({part:p}),v=p.type;switch(v){case"text-start":{g.enqueue({type:"text-start",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"text-delta":{g.enqueue({type:"text-delta",id:p.id,delta:p.text,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"text-end":{g.enqueue({type:"text-end",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-start":{g.enqueue({type:"reasoning-start",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-delta":{i&&g.enqueue({type:"reasoning-delta",id:p.id,delta:p.text,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-end":{g.enqueue({type:"reasoning-end",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"file":{g.enqueue({type:"file",mediaType:p.file.mediaType,url:`data:${p.file.mediaType};base64,${p.file.base64}`});break}case"source":{s&&p.sourceType==="url"&&g.enqueue({type:"source-url",sourceId:p.id,url:p.url,title:p.title,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}}),s&&p.sourceType==="document"&&g.enqueue({type:"source-document",sourceId:p.id,mediaType:p.mediaType,title:p.title,filename:p.filename,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"tool-input-start":{d[p.id]=p.toolName;const y=h(p.id);g.enqueue({type:"tool-input-start",toolCallId:p.id,toolName:p.toolName,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...y!=null?{dynamic:y}:{}});break}case"tool-input-delta":{g.enqueue({type:"tool-input-delta",toolCallId:p.id,inputTextDelta:p.delta});break}case"tool-call":{d[p.toolCallId]=p.toolName;const y=h(p.toolCallId);p.invalid?g.enqueue({type:"tool-input-error",toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{},...y!=null?{dynamic:y}:{},errorText:l(p.error)}):g.enqueue({type:"tool-input-available",toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{},...y!=null?{dynamic:y}:{}});break}case"tool-result":{const y=h(p.toolCallId);g.enqueue({type:"tool-output-available",toolCallId:p.toolCallId,output:p.output,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.preliminary!=null?{preliminary:p.preliminary}:{},...y!=null?{dynamic:y}:{}});break}case"tool-error":{const y=h(p.toolCallId);g.enqueue({type:"tool-output-error",toolCallId:p.toolCallId,errorText:l(p.error),...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...y!=null?{dynamic:y}:{}});break}case"error":{g.enqueue({type:"error",errorText:l(p.error)});break}case"start-step":{g.enqueue({type:"start-step"});break}case"finish-step":{g.enqueue({type:"finish-step"});break}case"start":{o&&g.enqueue({type:"start",...m!=null?{messageMetadata:m}:{},...c!=null?{messageId:c}:{}});break}case"finish":{a&&g.enqueue({type:"finish",finishReason:p.finishReason,...m!=null?{messageMetadata:m}:{}});break}case"abort":{g.enqueue(p);break}case"tool-input-end":break;case"raw":break;default:{const y=v;throw new Error(`Unknown chunk type: ${y}`)}}m!=null&&v!=="start"&&v!=="finish"&&g.enqueue({type:"message-metadata",messageMetadata:m})}}));return Cv(B_e({stream:f,messageId:c??e?.(),originalMessages:n,onFinish:t,onError:l}))}pipeUIMessageStreamToResponse(n,{originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:i,sendReasoning:s,sendSources:o,sendFinish:a,sendStart:l,onError:c,...d}={}){U_e({response:n,stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:i,sendReasoning:s,sendSources:o,sendFinish:a,sendStart:l,onError:c}),...d})}pipeTextStreamToResponse(n,e){D_e({response:n,textStream:this.textStream,...e})}toUIMessageStreamResponse({originalMessages:n,generateMessageId:e,onFinish:t,messageMetadata:r,sendReasoning:i,sendSources:s,sendFinish:o,sendStart:a,onError:l,...c}={}){return N_e({stream:this.toUIMessageStream({originalMessages:n,generateMessageId:e,onFinish:t,messageMetadata:r,sendReasoning:i,sendSources:s,sendFinish:o,sendStart:a,onError:l}),...c})}toTextStreamResponse(n){return R_e({textStream:this.textStream,...n})}};vm({prefix:"aiobj",size:24});vm({prefix:"aiobj",size:24});var Y_e={};T1e(Y_e,{object:()=>K_e,text:()=>G_e});var G_e=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:n}){return{partial:n}},async parseOutput({text:n}){return n}}),K_e=({schema:n})=>{const e=Ub(n);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:t}){const r=await O7(t);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const i=r.state;throw new Error(`Unsupported parse state: ${i}`)}}},async parseOutput({text:t},r){const i=await Du({text:t});if(!i.success)throw new yR({message:"No object generated: could not parse the response.",cause:i.error,text:t,response:r.response,usage:r.usage,finishReason:r.finishReason});const s=await Ac({value:i.value,schema:e});if(!s.success)throw new yR({message:"No object generated: response did not match schema.",cause:s.error,text:t,response:r.response,usage:r.usage,finishReason:r.finishReason});return s.value}}};const Gs={NOTE_CONTENT_MAX:1e5,NOTE_CONTENT_DEFAULT:5e4,LIST_HARD_MAX:100,BACKLINKS_HARD_MAX:50};function J_e(n){return Math.ceil(n.length/3.5)}function eOe(n,e,t=3,r=100){if(!e||!e.trim())return{snippets:[n.slice(0,r*2)+(n.length>r*2?"...":"")],matchCount:0};const i=e.toLowerCase(),s=n.toLowerCase(),o=[];let a=0,l=0;for(;(l=s.indexOf(i,l))!==-1;){if(a++,o.length<t){const c=Math.max(0,l-r),d=Math.min(n.length,l+e.length+r);let h="";c>0&&(h+="..."),h+=n.slice(c,d),d<n.length&&(h+="..."),o.push(h)}l+=e.length}return o.length===0?{snippets:[n.slice(0,r*2)+(n.length>r*2?"...":"")],matchCount:0}:{snippets:o,matchCount:a}}function TR(n,e,t=500){const r=jr(n.type),i={id:n.id,title:n.title,content:e.length>t?e.slice(0,t)+"...":e,type:n.type,created:n.created,updated:n.updated};return r?.name!==void 0&&(i.typeName=r.name),i}function tOe(n,e,t){const r=jr(n.type),{snippets:i,matchCount:s}=eOe(e,t),o={id:n.id,title:n.title,type:n.type,created:n.created,updated:n.updated,snippets:i,matchCount:s};return r?.name!==void 0&&(o.typeName=r.name),o}function nOe(n,e){const t=[];for(const i of e)n.includes(i.old_text)||t.push({old_text:i.old_text.length>50?i.old_text.slice(0,50)+"...":i.old_text,reason:"Text not found in content"});if(t.length>0)return{success:!1,error:"Some search texts were not found in the note content",failedDiffs:t};let r=n;for(const i of e)i.replace_all?r=r.split(i.old_text).join(i.new_text):r=r.replace(i.old_text,i.new_text);return{success:!0,newContent:r}}function AR(){return{search_notes:{description:"Search and filter notes. Searches note titles by query string. Optionally filter by type, date ranges, and custom properties. Returns matching notes with context snippets around query matches.",inputSchema:je({query:Ce().optional().describe("Search query to find in note titles. Optional if using filters."),filters:Xt(je({field:Ce().describe('Field to filter on. System fields: type (note type name), title, created, updated, archived. Custom props: use the property name directly (e.g., "status", "priority").'),operator:cr(["=","!=",">","<",">=","<=","LIKE","IN","NOT IN","BETWEEN"]).optional().default("=").describe("Comparison operator (default: =). Use >, <, >=, <= for dates (ISO format) and numbers. Use LIKE with % for pattern matching. Use IN/NOT IN for multiple values."),value:Xn([Ce(),Xt(Ce())]).describe("Value to compare. For dates use ISO format (YYYY-MM-DD). For IN/NOT IN/BETWEEN, use an array of values.")})).optional().describe("Filter conditions to apply"),logic:cr(["AND","OR"]).optional().default("AND").describe("How to combine multiple filters: AND (all must match) or OR (any can match)"),limit:St().optional().default(10).describe(`Maximum number of results to return (default: 10, max: ${Gs.LIST_HARD_MAX})`)}),execute:async({query:n,filters:e,logic:t,limit:r})=>{try{const i=Math.min(r??10,Gs.LIST_HARD_MAX);let s;n&&n.trim()?s=tJ(n):s=MC(),e&&e.length>0&&(s=DC(s,{filters:e,logic:t}));const o=s.slice(0,i);return{success:!0,notes:await Promise.all(o.map(async l=>{const c=await ns(l.id);return tOe(l,c,n??"")})),count:o.length,totalMatches:s.length}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Search failed"}}}},get_note:{description:"Get a specific note by its ID. Returns the note content. For large notes, use offset parameter to paginate through content.",inputSchema:je({noteId:Ce().describe("The note ID (format: n-xxxxxxxx or daily-YYYY-MM-DD)"),maxTokens:St().optional().default(Gs.NOTE_CONTENT_DEFAULT).describe(`Max tokens to return (default: ${Gs.NOTE_CONTENT_DEFAULT}, max: ${Gs.NOTE_CONTENT_MAX})`),offset:St().optional().describe("Character offset for large notes (0-indexed). Use when content exceeds limit.")}),execute:async({noteId:n,maxTokens:e,offset:t})=>{try{const r=Zn(n);if(!r)return{success:!1,error:`Note not found: ${n}`};const i=Math.min(e??Gs.NOTE_CONTENT_DEFAULT,Gs.NOTE_CONTENT_MAX),s=await ns(n),o=s.length,a=J_e(s);if(a>i&&t===void 0)return{success:!1,error:`Note content (${a} tokens) exceeds limit (${i}). Use offset parameter to paginate.`,noteId:n,contentInfo:{totalChars:o,totalTokensEstimate:a,maxTokensAllowed:Gs.NOTE_CONTENT_MAX}};const l=t??0,c=Math.floor(i*3.5),d=s.slice(l,l+c),h=d.length,f=l+h<o,p=jr(r.type),g={id:r.id,title:r.title,content:d,type:r.type,created:r.created,updated:r.updated,archived:r.archived};return p?.name!==void 0&&(g.typeName=p.name),r.props!==void 0&&(g.props=r.props),{success:!0,note:g,contentInfo:{totalChars:o,totalTokensEstimate:a,returnedChars:h,offset:l,truncated:f,nextOffset:f?l+h:void 0}}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to get note"}}}},list_notes:{description:"List notes in the vault with optional filtering. Returns notes sorted by last updated time (newest first). Use this to browse notes by type, date, or custom properties without requiring a search query.",inputSchema:je({filters:Xt(je({field:Ce().describe('Field to filter on. System fields: type (note type name), title, created, updated, archived. Custom props: use the property name directly (e.g., "status", "priority").'),operator:cr(["=","!=",">","<",">=","<=","LIKE","IN","NOT IN","BETWEEN"]).optional().default("=").describe("Comparison operator (default: =). Use >, <, >=, <= for dates (ISO format) and numbers. Use LIKE with % for pattern matching. Use IN/NOT IN for multiple values."),value:Xn([Ce(),Xt(Ce())]).describe("Value to compare. For dates use ISO format (YYYY-MM-DD). For IN/NOT IN/BETWEEN, use an array of values.")})).optional().describe("Filter conditions to apply"),logic:cr(["AND","OR"]).optional().default("AND").describe("How to combine multiple filters: AND (all must match) or OR (any can match)"),limit:St().optional().default(20).describe(`Maximum number of notes to return (default: 20, max: ${Gs.LIST_HARD_MAX})`)}),execute:async({filters:n,logic:e,limit:t})=>{try{const r=Math.min(t??20,Gs.LIST_HARD_MAX);let i=MC();n&&n.length>0&&(i=DC(i,{filters:n,logic:e}));const s=i.slice(0,r);return{success:!0,notes:await Promise.all(s.map(async a=>{const l=await ns(a.id);return TR(a,l,200)})),count:s.length,totalNotes:i.length}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to list notes"}}}},create_note:{description:"Create a new note in the vault. Returns the ID of the created note. The note will be added to the current workspace.",inputSchema:je({title:Ce().optional().describe("Note title (can be empty)"),content:Ce().optional().describe("Note content in markdown format. IMPORTANT: Use actual newline characters for line breaks, not the literal two-character sequence \\n."),type:Ce().optional().describe("Note type ID (default: type-default). Use type-daily for daily notes.")}),execute:async({title:n,content:e,type:t})=>{try{const r=await zs({title:n,content:e,type:t});return{success:!0,noteId:r,message:`Created note "${n||"Untitled"}" with ID ${r}`}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to create note"}}}},update_note:{description:"Update an existing note. You can update the title, content, or both. For content, use either full replacement (content parameter) OR search-and-replace diffs (diffs parameter). Diffs are preferred for targeted edits.",inputSchema:je({noteId:Ce().describe("The note ID to update"),title:Ce().optional().describe("New title (if updating)"),content:Ce().optional().describe("New full content (replaces entire content). IMPORTANT: Use actual newline characters for line breaks, not the literal two-character sequence \\n."),diffs:Xt(je({old_text:Ce().min(1).describe("The exact text to find and replace. Must match content exactly."),new_text:Ce().describe("The replacement text. Use empty string to delete. IMPORTANT: Use actual newline characters, not literal \\n."),replace_all:Cs().optional().default(!1).describe("If true, replace ALL occurrences. If false (default), only first occurrence.")})).optional().describe("Array of search-and-replace operations. Applied in order. Cannot be used together with the content parameter.")}),execute:async({noteId:n,title:e,content:t,diffs:r})=>{try{if(!Zn(n))return{success:!1,error:`Note not found: ${n}`};if(t!==void 0&&r!==void 0&&r.length>0)return{success:!1,error:"Cannot use both 'content' and 'diffs' parameters. Use 'content' for full replacement or 'diffs' for targeted edits."};if(!(e!==void 0||t!==void 0||r!==void 0&&r.length>0))return{success:!1,error:"No updates provided"};const o=[];if(e!==void 0&&(dl(n,{title:e}),o.push("title")),t!==void 0&&(await gc(n,t),o.push("content")),r!==void 0&&r.length>0){const a=await ns(n),l=nOe(a,r);if(!l.success)return{success:!1,error:l.error,failedDiffs:l.failedDiffs};await gc(n,l.newContent),o.push("content")}return{success:!0,message:`Updated note ${n}`,updatedFields:o}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update note"}}}},archive_note:{description:"Archive a note (soft delete). The note can be recovered later. Use this when the user wants to delete or remove a note.",inputSchema:je({noteId:Ce().describe("The note ID to archive")}),execute:async({noteId:n})=>{try{const e=Zn(n);return e?(Ch(n),{success:!0,message:`Archived note "${e.title||n}"`}):{success:!1,error:`Note not found: ${n}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to archive note"}}}},get_backlinks:{description:"Get notes that link to a specific note (backlinks). This shows how notes are connected. Returns the linking notes with context around each link.",inputSchema:je({noteId:Ce().describe("The note ID to find backlinks for"),limit:St().optional().default(20).describe(`Max backlinks to return (default: 20, max: ${Gs.BACKLINKS_HARD_MAX})`),offset:St().optional().default(0).describe("Number of backlinks to skip (for pagination)")}),execute:async({noteId:n,limit:e,offset:t})=>{try{const r=Zn(n);if(!r)return{success:!1,error:`Note not found: ${n}`};const i=Math.min(e??20,Gs.BACKLINKS_HARD_MAX),s=t??0,o=await x5(n),a=o.length,l=o.slice(s,s+i),c=await Promise.all(l.map(async h=>{const f=await ns(h.note.id);return{note:TR(h.note,f,200),occurrences:h.occurrences.map(p=>p.source==="content"?{lineNumber:p.lineNumber,text:p.lineText}:{propertyName:p.propertyName,text:`via ${p.propertyName}`})}})),d=s+l.length<a;return{success:!0,noteTitle:r.title,backlinks:c,count:c.length,totalBacklinks:a,pagination:{offset:s,limit:i,hasMore:d,nextOffset:d?s+i:void 0}}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to get backlinks"}}}},change_note_type:{description:"Change a note's type. This allows converting a note from one type to another. Use list_note_types to see available types first.",inputSchema:je({noteId:Ce().describe("The note ID to change the type of"),typeId:Ce().describe("The new type ID (e.g., type-default, type-daily)")}),execute:async({noteId:n,typeId:e})=>{try{const t=Zn(n);if(!t)return{success:!1,error:`Note not found: ${n}`};const r=jr(e);if(!r)return{success:!1,error:`Note type not found: ${e}`};const i=t.type,s=jr(i)?.name??i;return w5(n,e),{success:!0,message:`Changed note "${t.title||n}" from type "${s}" to "${r.name}"`,noteId:n,previousType:i,newType:e,newTypeName:r.name}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to change note type"}}}}}}const Ol={STRUCTURE_MAX:5e3,CHUNK_DEFAULT:1e4,CHUNK_MAX:5e4};function hh(n){return Math.ceil(n.length/3.5)}function y_(n,e){const t=hh(n);if(t<=e)return{text:n,truncated:!1,originalTokens:t};const r=e*3.5;let i=Math.floor(r);for(;i>0&&n[i]!==" ";)i--;return i===0&&(i=Math.floor(r)),{text:n.slice(0,i)+`

[Content truncated]`,truncated:!0,originalTokens:t}}function rOe(n){const e=new Set(["p","div","h1","h2","h3","h4","h5","h6","li","blockquote","pre","article","section","header","footer","aside","main","nav"]),t=[];function r(i){if(i.nodeType===Node.TEXT_NODE){const s=i.textContent?.trim();s&&t.push(s)}else if(i.nodeType===Node.ELEMENT_NODE){const s=i,o=s.tagName.toLowerCase();if(o==="script"||o==="style")return;const a=e.has(o);a&&t.length>0&&t.push(`

`);for(const l of s.childNodes)r(l);a&&t.length>0&&!t[t.length-1].endsWith(`
`)&&t.push(`
`)}}return r(n),t.join("").replace(/\n{3,}/g,`

`).trim()}function iOe(n){const e=new Uint8Array(n);return rQ(e)}function cp(n,e){const t=n[e];return t?new TextDecoder().decode(t):null}function yT(n){const e=cp(n,"META-INF/container.xml");if(!e)throw new Error("Invalid EPUB: container.xml not found");const t=new DOMParser,s=t.parseFromString(e,"text/xml").querySelector("rootfile")?.getAttribute("full-path");if(!s)throw new Error("Invalid EPUB: could not find content.opf path");const o=cp(n,s);if(!o)throw new Error(`Invalid EPUB: ${s} not found`);const a=t.parseFromString(o,"text/xml"),l=s.includes("/")?s.substring(0,s.lastIndexOf("/")+1):"",c=[],d=new Map,h=a.querySelectorAll("manifest item");for(const m of h){const v=m.getAttribute("id"),y=m.getAttribute("href");v&&y&&d.set(v,l+y)}const f=a.querySelectorAll("spine itemref");for(const m of f){const v=m.getAttribute("idref");v&&d.has(v)&&c.push({id:v,href:d.get(v)})}let p=[];const g=a.querySelector('manifest item[properties*="nav"]');if(g){const m=g.getAttribute("href");if(m){const v=l+m,y=cp(n,v);y&&(p=sOe(y,l))}}if(p.length===0){const m=a.querySelector('manifest item[media-type="application/x-dtbncx+xml"]');if(m){const v=m.getAttribute("href");if(v){const y=l+v,O=cp(n,y);O&&(p=oOe(O,l))}}}return{toc:p,spine:c}}function sOe(n,e){const i=new DOMParser().parseFromString(n,"text/html").querySelector('nav[epub\\:type="toc"], nav[role="doc-toc"], nav#toc');if(!i)return[];const s=a=>{const l=[],c=a.querySelectorAll(":scope > li");for(const d of c){const h=d.querySelector(":scope > a");if(!h)continue;const f=h.textContent?.trim()||"",p=h.getAttribute("href")||"",g={label:f,href:e+p},m=d.querySelector(":scope > ol");m&&(g.children=s(m)),l.push(g)}return l},o=i.querySelector("ol");return o?s(o):[]}function oOe(n,e){const r=new DOMParser().parseFromString(n,"text/xml"),i=o=>{const a=[],l=o.querySelectorAll(":scope > navPoint");for(const c of l){const d=c.querySelector(":scope > navLabel > text"),h=c.querySelector(":scope > content"),f=d?.textContent?.trim()||"",p=h?.getAttribute("src")||"",g={label:f,href:e+p};c.querySelectorAll(":scope > navPoint").length>0&&(g.children=i(c)),a.push(g)}return a},s=r.querySelector("navMap");return s?i(s):[]}function Vb(n,e){const t=cp(n,e);if(!t)return"";const i=new DOMParser().parseFromString(t,"text/html");return rOe(i.body)}function ik(n,e){const t=[];for(const r of e){const i=Vb(n,r.href);i&&t.push(i)}return t.join(`

`)}function aOe(n,e){const t=[];let r=0;const i=s=>{const o=s.href.split("#")[0],a=Vb(n,o),l=hh(a),c={index:r++,label:s.label,href:s.href,estimatedTokens:l};return s.children&&s.children.length>0&&(c.children=s.children.map(d=>i(d))),c};for(const s of e)t.push(i(s));return t}async function bT(n){const e=Zn(n);if(!e)return null;const t=e.props;if(!t?.epubHash)return null;const r=await V5(t.epubHash);return r?{zip:iOe(r),props:t,title:e.title}:null}async function lOe(n){try{const e=await bT(n);if(!e)return{success:!1,title:"",structure:{type:"toc",items:[]},totalEstimatedTokens:0,error:"EPUB not found or not accessible"};const{zip:t,title:r}=e,{toc:i,spine:s}=yT(t);if(!i||i.length===0){const l=ik(t,s),c=hh(l),d=Math.ceil(c/Ol.CHUNK_DEFAULT),h=[];for(let f=0;f<d;f++)h.push({index:f,label:`Chunk ${f+1}`,estimatedTokens:Math.min(Ol.CHUNK_DEFAULT,c-f*Ol.CHUNK_DEFAULT)});return{success:!0,title:r,structure:{type:"token_chunks",items:h,totalChunks:d},totalEstimatedTokens:c}}const o=aOe(t,i),a=o.reduce((l,c)=>l+c.estimatedTokens,0);return{success:!0,title:r,structure:{type:"toc",items:o},totalEstimatedTokens:a}}catch(e){return{success:!1,title:"",structure:{type:"toc",items:[]},totalEstimatedTokens:0,error:e instanceof Error?e.message:"Failed to get document structure"}}}async function cOe(n,e,t=Ol.CHUNK_DEFAULT){t=Math.min(t,Ol.CHUNK_MAX);try{const r=await bT(n);if(!r)return{success:!1,chunkRef:e,text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:"EPUB not found or not accessible"};const{zip:i}=r,{toc:s,spine:o}=yT(i);if(e.type==="token_chunk"){const a=ik(i,o),l=Ol.CHUNK_DEFAULT*3.5,c=e.index*l,d=c+l,h=a.slice(c,d),f=Math.ceil(a.length/l),{text:p,truncated:g}=y_(h,t);return{success:!0,chunkRef:e,text:p,tokenCount:g?t:hh(p),truncated:g,nextChunkRef:e.index<f-1?{type:"token_chunk",index:e.index+1}:void 0,position:{current:`Chunk ${e.index+1}`,total:`${f} chunks`}}}if(e.type==="chapter"){let a=null,l=0;const c=v=>{for(const y of v){if(l===e.index)return y;if(l++,y.children){const O=c(y.children);if(O)return O}}return null};if(a=c(s),!a)return{success:!1,chunkRef:e,text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:`Chapter index ${e.index} not found`};const d=a.href.split("#")[0],h=Vb(i,d);if(!h)return{success:!1,chunkRef:e,text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:`Chapter file not found: ${d}`};const{text:f,truncated:p}=y_(h,t);let g=0;const m=v=>{for(const y of v)g++,y.children&&m(y.children)};return m(s),{success:!0,chunkRef:e,text:f,tokenCount:p?t:hh(f),truncated:p,nextChunkRef:e.index<g-1?{type:"chapter",index:e.index+1}:void 0,position:{current:`Chapter: ${a.label}`,total:`${g} chapters`}}}if(e.type==="full"){const a=ik(i,o),{text:l,truncated:c,originalTokens:d}=y_(a,t);return{success:!0,chunkRef:e,text:l,tokenCount:c?t:hh(l),truncated:c,position:{current:"Full document",total:`~${d} tokens`}}}return{success:!1,chunkRef:e,text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:"Unsupported chunk reference type"}}catch(r){return{success:!1,chunkRef:e,text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:r instanceof Error?r.message:"Failed to get document chunk"}}}async function uOe(n,e,t=10){t=Math.min(t,50);try{const r=await bT(n);if(!r)return{success:!1,results:[],totalMatches:0,error:"EPUB not found or not accessible"};const{zip:i}=r,{toc:s,spine:o}=yT(i),a=[];let l=0;const c=e.toLowerCase();for(let d=0;d<o.length&&a.length<t;d++){const h=o[d],f=Vb(i,h.href);if(!f)continue;const p=f.toLowerCase();let g=0,m=0;for(;(m=p.indexOf(c,m))!==-1;)g++,m+=c.length;if(g>0){l+=g;const v=p.indexOf(c),y=Math.max(0,v-100),O=Math.min(f.length,v+e.length+100),_=(y>0?"...":"")+f.slice(y,O)+(O<f.length?"...":"");let x=d;if(s.length>0){let k=0;const S=R=>{for(const C of R){if(C.href.split("#")[0]===h.href)return k;if(k++,C.children){const D=S(C.children);if(D!==null)return D}}return null},E=S(s);E!==null&&(x=E)}a.push({chunkRef:s.length>0?{type:"chapter",index:x}:{type:"token_chunk",index:d},snippet:_,matchCount:g})}}return{success:!0,results:a,totalMatches:l}}catch(r){return{success:!1,results:[],totalMatches:0,error:r instanceof Error?r.message:"Failed to search document"}}}function CR(){return{get_document_structure:{description:"Get the structure (table of contents) of an EPUB book. Returns chapters with estimated token counts. Use this first to understand the book structure before reading specific chapters.",inputSchema:je({noteId:Ce().describe("The note ID of the EPUB book (format: n-xxxxxxxx)")}),execute:async({noteId:n})=>await lOe(n)},get_document_chunk:{description:"Get text content from a specific chapter or chunk of an EPUB book. Use get_document_structure first to see available chapters, then use this to read specific content.",inputSchema:je({noteId:Ce().describe("The note ID of the EPUB book"),chunkType:cr(["chapter","token_chunk","full"]).describe('Type of chunk: "chapter" for TOC-based chapters, "token_chunk" for flat EPUBs, "full" for entire document'),chunkIndex:St().optional().describe("Index of the chapter or chunk (required for chapter and token_chunk types)"),maxTokens:St().optional().default(Ol.CHUNK_DEFAULT).describe(`Maximum tokens to return (default: ${Ol.CHUNK_DEFAULT}, max: ${Ol.CHUNK_MAX})`)}),execute:async({noteId:n,chunkType:e,chunkIndex:t,maxTokens:r})=>{let i;if(e==="chapter"){if(t===void 0)return{success:!1,error:"chunkIndex is required for chapter type"};i={type:"chapter",index:t}}else if(e==="token_chunk"){if(t===void 0)return{success:!1,error:"chunkIndex is required for token_chunk type"};i={type:"token_chunk",index:t}}else i={type:"full"};return await cOe(n,i,r)}},search_document_text:{description:"Search for specific text within an EPUB book. Returns snippets showing where the text was found. Useful for finding specific topics, quotes, or references.",inputSchema:je({noteId:Ce().describe("The note ID of the EPUB book"),query:Ce().describe("The text to search for"),maxResults:St().optional().default(10).describe("Maximum number of results to return (default: 10, max: 50)")}),execute:async({noteId:n,query:e,maxResults:t})=>await uOe(n,e,t)}}}ac.workerSrc=JS;const Ep={CHUNK_DEFAULT:1e4,CHUNK_MAX:5e4};function qb(n){return Math.ceil(n.length/3.5)}function dOe(n,e){const t=qb(n);if(t<=e)return{text:n,truncated:!1,originalTokens:t};const r=e*3.5;let i=Math.floor(r);for(;i>0&&n[i]!==" ";)i--;return i===0&&(i=Math.floor(r)),{text:n.slice(0,i)+`

[Content truncated]`,truncated:!0,originalTokens:t}}async function wT(n){const e=Zn(n);if(!e)return null;const t=e.props;if(!t?.pdfHash)return null;const r=await Z5(t.pdfHash);return r?{pdfDoc:await kb({data:r}).promise,props:t,title:e.title}:null}async function fh(n,e){try{return(await(await n.getPage(e)).getTextContent()).items.filter(s=>"str"in s).map(s=>s.str).join(" ").replace(/\s+/g," ").trim()}catch(t){return console.warn(`[PDF Tools] Failed to extract text from page ${e}:`,t),""}}async function hOe(n){try{const e=await n.getOutline();if(!e)return[];const t=async r=>{if(!r)return[];const i=[];for(const s of r){let o=1;if(s.dest)try{let l=s.dest;if(typeof l=="string"&&(l=await n.getDestination(l)??[]),Array.isArray(l)&&l[0]){const c=l[0];o=await n.getPageIndex(c)+1}}catch{}const a={label:s.title||"Untitled",pageNumber:o};s.items&&s.items.length>0&&(a.children=await t(s.items)),i.push(a)}return i};return await t(e)}catch(e){return console.warn("[PDF Tools] Failed to parse outline:",e),[]}}async function x7(n,e){const t=[];for(const r of e){const i=await fh(n,r.pageNumber),s=qb(i),o={label:r.label,pageNumber:r.pageNumber,estimatedTokens:s};r.children&&r.children.length>0&&(o.children=await x7(n,r.children)),t.push(o)}return t}async function fOe(n){try{const e=await wT(n);if(!e)return{success:!1,title:"",totalPages:0,structure:{type:"outline",items:[]},totalEstimatedTokens:0,error:"PDF not found or not accessible"};const{pdfDoc:t,title:r}=e,i=t.numPages,s=await hOe(t);if(s.length===0){const l=[];let c=0;for(let d=1;d<=i;d++){const h=await fh(t,d),f=qb(h);c+=f,l.push({label:`Page ${d}`,pageNumber:d,estimatedTokens:f})}return{success:!0,title:r,totalPages:i,structure:{type:"page_chunks",items:l},totalEstimatedTokens:c}}const o=await x7(t,s),a=o.reduce((l,c)=>l+c.estimatedTokens,0);return{success:!0,title:r,totalPages:i,structure:{type:"outline",items:o},totalEstimatedTokens:a}}catch(e){return{success:!1,title:"",totalPages:0,structure:{type:"outline",items:[]},totalEstimatedTokens:0,error:e instanceof Error?e.message:"Failed to get document structure"}}}async function pOe(n,e,t=Ep.CHUNK_DEFAULT){t=Math.min(t,Ep.CHUNK_MAX);try{const r=await wT(n);if(!r)return{success:!1,chunkRef:e,text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:"PDF not found or not accessible"};const{pdfDoc:i}=r,s=i.numPages;let o="",a="",l;if(e.type==="page")o=await fh(i,e.pageNumber),a=`Page ${e.pageNumber}`,e.pageNumber<s&&(l={type:"page",pageNumber:e.pageNumber+1});else if(e.type==="page_range"){const h=[];for(let f=e.startPage;f<=Math.min(e.endPage,s);f++){const p=await fh(i,f);p&&h.push(`[Page ${f}]
${p}`)}o=h.join(`

`),a=`Pages ${e.startPage}-${Math.min(e.endPage,s)}`,e.endPage<s&&(l={type:"page_range",startPage:e.endPage+1,endPage:Math.min(e.endPage+(e.endPage-e.startPage+1),s)})}else if(e.type==="full"){const h=[];for(let f=1;f<=s;f++){const p=await fh(i,f);p&&h.push(`[Page ${f}]
${p}`)}o=h.join(`

`),a="Full document"}const{text:c,truncated:d}=dOe(o,t);return{success:!0,chunkRef:e,text:c,tokenCount:d?t:qb(c),truncated:d,nextChunkRef:l,position:{current:a,total:`${s} pages`}}}catch(r){return{success:!1,chunkRef:e,text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:r instanceof Error?r.message:"Failed to get document chunk"}}}async function gOe(n,e,t=10){t=Math.min(t,50);try{const r=await wT(n);if(!r)return{success:!1,results:[],totalMatches:0,error:"PDF not found or not accessible"};const{pdfDoc:i}=r,s=[];let o=0;const a=e.toLowerCase();for(let l=1;l<=i.numPages&&s.length<t;l++){const c=await fh(i,l);if(!c)continue;const d=c.toLowerCase();let h=0,f=0;for(;(f=d.indexOf(a,f))!==-1;)h++,f+=a.length;if(h>0){o+=h;const p=d.indexOf(a),g=Math.max(0,p-100),m=Math.min(c.length,p+e.length+100),v=(g>0?"...":"")+c.slice(g,m)+(m<c.length?"...":"");s.push({pageNumber:l,snippet:v,matchCount:h})}}return{success:!0,results:s,totalMatches:o}}catch(r){return{success:!1,results:[],totalMatches:0,error:r instanceof Error?r.message:"Failed to search document"}}}function ER(){return{get_pdf_structure:{description:"Get the structure (outline/table of contents) of a PDF document. Returns sections with page numbers and estimated token counts. Use this first to understand the document structure before reading specific pages.",inputSchema:je({noteId:Ce().describe("The note ID of the PDF document (format: n-xxxxxxxx)")}),execute:async({noteId:n})=>await fOe(n)},get_pdf_chunk:{description:"Get text content from specific pages of a PDF document. Use get_pdf_structure first to see available pages, then use this to read specific content.",inputSchema:je({noteId:Ce().describe("The note ID of the PDF document"),chunkType:cr(["page","page_range","full"]).describe('Type of chunk: "page" for a single page, "page_range" for multiple pages, "full" for entire document'),pageNumber:St().optional().describe('Page number for single page (required for "page" type, 1-indexed)'),startPage:St().optional().describe('Start page for page range (required for "page_range" type, 1-indexed)'),endPage:St().optional().describe('End page for page range (required for "page_range" type, 1-indexed)'),maxTokens:St().optional().default(Ep.CHUNK_DEFAULT).describe(`Maximum tokens to return (default: ${Ep.CHUNK_DEFAULT}, max: ${Ep.CHUNK_MAX})`)}),execute:async({noteId:n,chunkType:e,pageNumber:t,startPage:r,endPage:i,maxTokens:s})=>{let o;if(e==="page"){if(t===void 0)return{success:!1,error:"pageNumber is required for page type"};o={type:"page",pageNumber:t}}else if(e==="page_range"){if(r===void 0||i===void 0)return{success:!1,error:"startPage and endPage are required for page_range type"};o={type:"page_range",startPage:r,endPage:i}}else o={type:"full"};return await pOe(n,o,s)}},search_pdf_text:{description:"Search for specific text within a PDF document. Returns page numbers and snippets showing where the text was found. Useful for finding specific topics, quotes, or references.",inputSchema:je({noteId:Ce().describe("The note ID of the PDF document"),query:Ce().describe("The text to search for"),maxResults:St().optional().default(10).describe("Maximum number of results to return (default: 10, max: 50)")}),execute:async({noteId:n,query:e,maxResults:t})=>await gOe(n,e,t)}}}const Ja={LIST_HARD_MAX:100,LIST_DEFAULT:50,COMPLETION_HISTORY_MAX:50,SUPPLEMENTARY_MATERIALS_MAX:50};function mOe(n){const e={id:n.id,name:n.name,purpose:n.purpose,description:n.description,status:n.status,type:n.type,isRecurring:!!n.recurringSpec,created:n.created,updated:n.updated};if(n.recurringSpec){const{frequency:t,dayOfWeek:r,dayOfMonth:i,time:s}=n.recurringSpec,o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let a="";t==="daily"?a="Every day":t==="weekly"&&r!==void 0?a=`Every ${o[r]}`:t==="monthly"&&i!==void 0?a=`Every month on the ${i}${i===1?"st":i===2?"nd":i===3?"rd":"th"}`:a=`Every ${t}`,s&&(a+=` at ${s}`),e.recurringSchedule=a}return n.dueDate&&(e.dueDate=n.dueDate),n.lastCompleted&&(e.lastCompleted=n.lastCompleted),e}function vOe(n){const e={id:n.id,name:n.name,purpose:n.purpose,status:n.status,type:n.type,isRecurring:n.isRecurring};return n.dueInfo&&(e.dueStatus=n.dueInfo.type,n.dueInfo.dueDate&&(e.dueDate=n.dueInfo.dueDate),n.dueInfo.recurringSchedule&&(e.recurringSchedule=n.dueInfo.recurringSchedule)),n.lastCompleted&&(e.lastCompleted=n.lastCompleted),e}function yOe(n){const e={id:n.id,type:n.materialType,position:n.position,createdAt:n.createdAt};if(n.content&&(e.content=n.content),n.noteId){e.noteId=n.noteId;const t=Zn(n.noteId);t&&(e.noteTitle=t.title)}return n.metadata&&(e.metadata=n.metadata),e}const PR=je({frequency:cr(["daily","weekly","monthly"]).describe("How often the routine repeats"),dayOfWeek:St().min(0).max(6).optional().describe("Day of week (0=Sunday, 6=Saturday) for weekly routines"),dayOfMonth:St().min(1).max(31).optional().describe("Day of month (1-31) for monthly routines"),time:Ce().optional().describe("Time of day in HH:MM format (24-hour)")});function IR(){return{create_routine:{description:"Create a new routine (persistent scheduled task). Routines can be one-time with a due date, or recurring (daily/weekly/monthly). Use the backlog type for issues discovered during work that should be addressed later without interrupting the current task.",inputSchema:je({name:Ce().min(1).max(20).describe("Short name for the routine (1-20 characters)"),purpose:Ce().min(1).max(100).describe("One-sentence description of what this routine accomplishes (1-100 characters)"),description:Ce().min(1).describe("Detailed markdown instructions for executing this routine"),status:cr(["active","paused"]).optional().describe("Initial status (default: active)"),type:cr(["routine","backlog"]).optional().describe("Type: routine (default) or backlog (for issues to address later)"),recurringSpec:PR.optional().describe("Recurring schedule (omit for one-time routines)"),dueDate:Ce().optional().describe("Due date for one-time routines (ISO datetime)")}),execute:async n=>{try{const e=z5({name:n.name,purpose:n.purpose,description:n.description,status:n.status,type:n.type,recurringSpec:n.recurringSpec,dueDate:n.dueDate});return{success:!0,routineId:e,message:`Created routine "${n.name}" with ID ${e}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create routine"}}}},update_routine:{description:"Update an existing routine. Only provide the fields you want to change. Set recurringSpec or dueDate to null to remove them.",inputSchema:je({routineId:Ce().describe("The routine ID to update"),name:Ce().min(1).max(20).optional().describe("New name (if updating)"),purpose:Ce().min(1).max(100).optional().describe("New purpose (if updating)"),description:Ce().optional().describe("New description (if updating)"),status:cr(["active","paused","completed","archived"]).optional().describe("New status (if updating)"),type:cr(["routine","backlog"]).optional().describe("New type (if updating)"),recurringSpec:PR.nullable().optional().describe("New recurring spec (null to remove)"),dueDate:Ce().nullable().optional().describe("New due date (null to remove)")}),execute:async n=>{try{return B5({routineId:n.routineId,name:n.name,purpose:n.purpose,description:n.description,status:n.status,type:n.type,recurringSpec:n.recurringSpec,dueDate:n.dueDate}),{success:!0,message:`Updated routine ${n.routineId}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update routine"}}}},delete_routine:{description:"Delete a routine by archiving it. The routine can be recovered later if needed.",inputSchema:je({routineId:Ce().describe("The routine ID to delete")}),execute:async({routineId:n})=>{try{const e=mo(n);return e?(U5(n),{success:!0,message:`Deleted routine "${e.name}"`}):{success:!1,error:`Routine not found: ${n}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete routine"}}}},list_routines:{description:"List routines with optional filtering and sorting. Returns routines with due status information.",inputSchema:je({status:cr(["active","paused","completed","archived","all"]).optional().describe("Filter by status (default: active)"),type:cr(["routine","backlog","all"]).optional().describe("Filter by type"),dueSoon:Cs().optional().describe("Only show routines due now, overdue, or upcoming"),recurringOnly:Cs().optional().describe("Only show recurring routines"),overdueOnly:Cs().optional().describe("Only show overdue routines"),includeArchived:Cs().optional().describe("Include archived routines"),sortBy:cr(["dueDate","created","name","lastCompleted"]).optional().describe("Sort field"),sortOrder:cr(["asc","desc"]).optional().describe("Sort order"),limit:St().optional().default(Ja.LIST_DEFAULT).describe(`Max routines to return (default: ${Ja.LIST_DEFAULT}, max: ${Ja.LIST_HARD_MAX})`),offset:St().optional().default(0).describe("Number of routines to skip (for pagination)")}),execute:async n=>{try{const e=Math.min(n.limit??Ja.LIST_DEFAULT,Ja.LIST_HARD_MAX),t=n.offset??0,r=th({status:n.status,type:n.type,dueSoon:n.dueSoon,recurringOnly:n.recurringOnly,overdueOnly:n.overdueOnly,includeArchived:n.includeArchived,sortBy:n.sortBy,sortOrder:n.sortOrder}),i=r.length,s=r.slice(t,t+e),o=t+s.length<i;return{success:!0,routines:s.map(vOe),count:s.length,totalRoutines:i,pagination:{offset:t,limit:e,hasMore:o,nextOffset:o?t+e:void 0}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list routines"}}}},get_routine:{description:"Get full details of a specific routine by ID or name. Optionally include supplementary materials and completion history.",inputSchema:je({routineId:Ce().optional().describe("Routine ID (if known)"),routineName:Ce().optional().describe("Routine name (case-insensitive lookup)"),includeSupplementaryMaterials:Cs().optional().describe("Include attached materials"),includeCompletionHistory:Cs().optional().describe("Include completion history"),completionHistoryLimit:St().optional().describe(`Limit completion history entries (default: 10, max: ${Ja.COMPLETION_HISTORY_MAX})`),supplementaryMaterialsLimit:St().optional().describe(`Limit supplementary materials (default: 20, max: ${Ja.SUPPLEMENTARY_MATERIALS_MAX})`)}),execute:async n=>{try{if(!n.routineId&&!n.routineName)return{success:!1,error:"Must provide routineId or routineName"};let e;if(n.routineId?e=mo(n.routineId):n.routineName&&(e=RS(n.routineName)),!e)return{success:!1,error:`Routine not found: ${n.routineId||n.routineName}`};const t={...mOe(e)};if(n.includeSupplementaryMaterials&&e.supplementaryMaterials){const r=Math.min(n.supplementaryMaterialsLimit??20,Ja.SUPPLEMENTARY_MATERIALS_MAX),i=e.supplementaryMaterials.slice(0,r);t.supplementaryMaterials=i.map(yOe),t.totalSupplementaryMaterials=e.supplementaryMaterials.length}if(n.includeCompletionHistory&&e.completionHistory){const r=e.completionHistory,i=Math.min(n.completionHistoryLimit??10,Ja.COMPLETION_HISTORY_MAX),s=r.slice(-i).reverse();t.completionHistory=s,t.totalCompletions=r.length}return{success:!0,routine:t}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get routine"}}}},complete_routine:{description:"Mark a routine as completed. For recurring routines, this records the completion and resets it for the next occurrence. For one-time routines, this marks it as completed. You should call this when you finish executing a routine.",inputSchema:je({routineId:Ce().describe("The routine ID to complete"),notes:Ce().optional().describe("Notes about this completion"),outputNoteId:Ce().optional().describe("ID of a note created as output of this routine"),metadata:je({durationMs:St().optional().describe("Execution duration in milliseconds"),toolCallsCount:St().optional().describe("Number of tool calls made")}).optional().describe("Execution metadata")}),execute:async n=>{try{const e=mo(n.routineId);if(!e)return{success:!1,error:`Routine not found: ${n.routineId}`};const t=YJ({routineId:n.routineId,notes:n.notes,outputNoteId:n.outputNoteId,metadata:n.metadata}),r=!!e.recurringSpec;return{success:!0,completionId:t,message:r?`Completed recurring routine "${e.name}". It will be due again on its next scheduled occurrence.`:`Completed one-time routine "${e.name}".`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to complete routine"}}}},add_routine_material:{description:"Add supplementary material to a routine. Materials can be text instructions, code templates, or references to existing notes.",inputSchema:je({routineId:Ce().describe("The routine ID to add material to"),type:cr(["text","code","note_reference"]).describe("Type of material"),content:Ce().optional().describe("Text or code content (for text/code types)"),noteId:Ce().optional().describe("Note ID to reference (for note_reference type)"),metadata:je({language:Ce().optional().describe("Programming language (for code type)"),description:Ce().optional().describe("Description of the material"),templateType:Ce().optional().describe("Template type identifier")}).optional().describe("Material metadata"),position:St().optional().describe("Position in the list (default: end)")}),execute:async n=>{try{return n.type==="note_reference"&&!n.noteId?{success:!1,error:"noteId is required for note_reference type"}:(n.type==="text"||n.type==="code")&&!n.content?{success:!1,error:"content is required for text/code types"}:{success:!0,materialId:GJ(n.routineId,{type:n.type,content:n.content,noteId:n.noteId,metadata:n.metadata,position:n.position}),message:`Added ${n.type} material to routine`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to add material"}}}},remove_routine_material:{description:"Remove supplementary material from a routine.",inputSchema:je({routineId:Ce().describe("The routine ID"),materialId:Ce().describe("The material ID to remove")}),execute:async({routineId:n,materialId:e})=>{try{return KJ(n,e),{success:!0,message:`Removed material ${e} from routine`}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to remove material"}}}}}}var bOe={},wOe=Object.defineProperty,_Oe=Object.defineProperties,OOe=Object.getOwnPropertyDescriptors,MR=Object.getOwnPropertySymbols,xOe=Object.prototype.hasOwnProperty,kOe=Object.prototype.propertyIsEnumerable,RR=(n,e,t)=>e in n?wOe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,lr=(n,e)=>{for(var t in e||(e={}))xOe.call(e,t)&&RR(n,t,e[t]);if(MR)for(var t of MR(e))kOe.call(e,t)&&RR(n,t,e[t]);return n},Pp=(n,e)=>_Oe(n,OOe(e)),k7="vercel.ai.error",SOe=Symbol.for(k7),S7,TOe=class T7 extends Error{constructor({name:e,message:t,cause:r}){super(t),this[S7]=!0,this.name=e,this.cause=r}static isInstance(e){return T7.hasMarker(e,k7)}static hasMarker(e,t){const r=Symbol.for(t);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};S7=SOe;var $r=TOe,A7="AI_APICallError",C7=`vercel.ai.error.${A7}`,AOe=Symbol.for(C7),E7,Bo=class extends $r{constructor({message:n,url:e,requestBodyValues:t,statusCode:r,responseHeaders:i,responseBody:s,cause:o,isRetryable:a=r!=null&&(r===408||r===409||r===429||r>=500),data:l}){super({name:A7,message:n,cause:o}),this[E7]=!0,this.url=e,this.requestBodyValues=t,this.statusCode=r,this.responseHeaders=i,this.responseBody=s,this.isRetryable=a,this.data=l}static isInstance(n){return $r.hasMarker(n,C7)}};E7=AOe;var P7="AI_EmptyResponseBodyError",I7=`vercel.ai.error.${P7}`,COe=Symbol.for(I7),M7,EOe=class extends $r{constructor({message:n="Empty response body"}={}){super({name:P7,message:n}),this[M7]=!0}static isInstance(n){return $r.hasMarker(n,I7)}};M7=COe;function R7(n){return n==null?"unknown error":typeof n=="string"?n:n instanceof Error?n.message:JSON.stringify(n)}var D7="AI_InvalidArgumentError",N7=`vercel.ai.error.${D7}`,POe=Symbol.for(N7),L7,Q7=class extends $r{constructor({message:n,cause:e,argument:t}){super({name:D7,message:n,cause:e}),this[L7]=!0,this.argument=t}static isInstance(n){return $r.hasMarker(n,N7)}};L7=POe;var $7="AI_InvalidPromptError",F7=`vercel.ai.error.${$7}`,IOe=Symbol.for(F7),z7,MOe=class extends $r{constructor({prompt:n,message:e,cause:t}){super({name:$7,message:`Invalid prompt: ${e}`,cause:t}),this[z7]=!0,this.prompt=n}static isInstance(n){return $r.hasMarker(n,F7)}};z7=IOe;var B7="AI_InvalidResponseDataError",U7=`vercel.ai.error.${B7}`,ROe=Symbol.for(U7),j7,Uf=class extends $r{constructor({data:n,message:e=`Invalid response data: ${JSON.stringify(n)}.`}){super({name:B7,message:e}),this[j7]=!0,this.data=n}static isInstance(n){return $r.hasMarker(n,U7)}};j7=ROe;var V7="AI_JSONParseError",q7=`vercel.ai.error.${V7}`,DOe=Symbol.for(q7),H7,E0=class extends $r{constructor({text:n,cause:e}){super({name:V7,message:`JSON parsing failed: Text: ${n}.
Error message: ${R7(e)}`,cause:e}),this[H7]=!0,this.text=n}static isInstance(n){return $r.hasMarker(n,q7)}};H7=DOe;var Z7="AI_LoadAPIKeyError",W7=`vercel.ai.error.${Z7}`,NOe=Symbol.for(W7),X7,Ev=class extends $r{constructor({message:n}){super({name:Z7,message:n}),this[X7]=!0}static isInstance(n){return $r.hasMarker(n,W7)}};X7=NOe;var Y7="AI_NoContentGeneratedError",G7=`vercel.ai.error.${Y7}`,LOe=Symbol.for(G7),K7,J7=class extends $r{constructor({message:n="No content generated."}={}){super({name:Y7,message:n}),this[K7]=!0}static isInstance(n){return $r.hasMarker(n,G7)}};K7=LOe;var eU="AI_TypeValidationError",tU=`vercel.ai.error.${eU}`,QOe=Symbol.for(tU),nU,$Oe=class sk extends $r{constructor({value:e,cause:t}){super({name:eU,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${R7(t)}`,cause:t}),this[nU]=!0,this.value=e}static isInstance(e){return $r.hasMarker(e,tU)}static wrap({value:e,cause:t}){return sk.isInstance(t)&&t.value===e?t:new sk({value:e,cause:t})}};nU=QOe;var Rg=$Oe,rU="AI_UnsupportedFunctionalityError",iU=`vercel.ai.error.${rU}`,FOe=Symbol.for(iU),sU,ql=class extends $r{constructor({functionality:n,message:e=`'${n}' functionality not supported.`}){super({name:rU,message:e}),this[sU]=!0,this.functionality=n}static isInstance(n){return $r.hasMarker(n,iU)}};sU=FOe;var DR=class extends Error{constructor(n,e){super(n),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function b_(n){}function zOe(n){if(typeof n=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:e=b_,onError:t=b_,onRetry:r=b_,onComment:i}=n;let s="",o=!0,a,l="",c="";function d(m){const v=o?m.replace(/^\xEF\xBB\xBF/,""):m,[y,O]=BOe(`${s}${v}`);for(const _ of y)h(_);s=O,o=!1}function h(m){if(m===""){p();return}if(m.startsWith(":")){i&&i(m.slice(m.startsWith(": ")?2:1));return}const v=m.indexOf(":");if(v!==-1){const y=m.slice(0,v),O=m[v+1]===" "?2:1,_=m.slice(v+O);f(y,_,m);return}f(m,"",m)}function f(m,v,y){switch(m){case"event":c=v;break;case"data":l=`${l}${v}
`;break;case"id":a=v.includes("\0")?void 0:v;break;case"retry":/^\d+$/.test(v)?r(parseInt(v,10)):t(new DR(`Invalid \`retry\` value: "${v}"`,{type:"invalid-retry",value:v,line:y}));break;default:t(new DR(`Unknown field "${m.length>20?`${m.slice(0,20)}â¦`:m}"`,{type:"unknown-field",field:m,value:v,line:y}));break}}function p(){l.length>0&&e({id:a,event:c||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),a=void 0,l="",c=""}function g(m={}){s&&m.consume&&h(s),o=!0,a=void 0,l="",c="",s=""}return{feed:d,reset:g}}function BOe(n){const e=[];let t="",r=0;for(;r<n.length;){const i=n.indexOf("\r",r),s=n.indexOf(`
`,r);let o=-1;if(i!==-1&&s!==-1?o=Math.min(i,s):i!==-1?o=i:s!==-1&&(o=s),o===-1){t=n.slice(r);break}else{const a=n.slice(r,o);e.push(a),r=o+1,n[r-1]==="\r"&&n[r]===`
`&&r++}}return[e,t]}var UOe=class extends TransformStream{constructor({onError:n,onRetry:e,onComment:t}={}){let r;super({start(i){r=zOe({onEvent:s=>{i.enqueue(s)},onError(s){n==="terminate"?i.error(s):typeof n=="function"&&n(s)},onRetry:e,onComment:t})},transform(i){r.feed(i)}})}};new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function P0(...n){return n.reduce((e,t)=>lr(lr({},e),t??{}),{})}function Hb(n){return Object.fromEntries([...n.headers])}var jOe=({prefix:n,size:e=16,alphabet:t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const i=()=>{const s=t.length,o=new Array(e);for(let a=0;a<e;a++)o[a]=t[Math.random()*s|0];return o.join("")};if(n==null)return i;if(t.includes(r))throw new Q7({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${t}".`});return()=>`${n}${r}${i()}`},Mo=jOe();function ok(n){return(n instanceof Error||n instanceof DOMException)&&(n.name==="AbortError"||n.name==="ResponseAborted"||n.name==="TimeoutError")}var VOe=["fetch failed","failed to fetch"];function qOe({error:n,url:e,requestBodyValues:t}){if(ok(n))return n;if(n instanceof TypeError&&VOe.includes(n.message.toLowerCase())){const r=n.cause;if(r!=null)return new Bo({message:`Cannot connect to API: ${r.message}`,cause:r,url:e,requestBodyValues:t,isRetryable:!0})}return n}function HOe(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>t!=null))}function ZOe({apiKey:n,environmentVariableName:e,apiKeyParameterName:t="apiKey",description:r}){if(typeof n=="string")return n;if(n!=null)throw new Ev({message:`${r} API key must be a string.`});if(typeof process>"u")throw new Ev({message:`${r} API key is missing. Pass it using the '${t}' parameter. Environment variables is not supported in this environment.`});if(n=bOe[e],n==null)throw new Ev({message:`${r} API key is missing. Pass it using the '${t}' parameter or the ${e} environment variable.`});if(typeof n!="string")throw new Ev({message:`${r} API key must be a string. The value of the ${e} environment variable is not a string.`});return n}var WOe=/"__proto__"\s*:/,XOe=/"constructor"\s*:/;function YOe(n){const e=JSON.parse(n);return e===null||typeof e!="object"||WOe.test(n)===!1&&XOe.test(n)===!1?e:GOe(e)}function GOe(n){let e=[n];for(;e.length;){const t=e;e=[];for(const r of t){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const i in r){const s=r[i];s&&typeof s=="object"&&e.push(s)}}}return n}function _T(n){const{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return YOe(n)}finally{Error.stackTraceLimit=e}}var ak=Symbol.for("vercel.ai.validator");function KOe(n){return{[ak]:!0,validate:n}}function JOe(n){return typeof n=="object"&&n!==null&&ak in n&&n[ak]===!0&&"validate"in n}function exe(n){return JOe(n)?n:txe(n)}function txe(n){return KOe(async e=>{const t=await n["~standard"].validate(e);return t.issues==null?{success:!0,value:t.value}:{success:!1,error:new Rg({value:e,cause:t.issues})}})}async function nxe({value:n,schema:e}){const t=await oU({value:n,schema:e});if(!t.success)throw Rg.wrap({value:n,cause:t.error});return t.value}async function oU({value:n,schema:e}){const t=exe(e);try{if(t.validate==null)return{success:!0,value:n,rawValue:n};const r=await t.validate(n);return r.success?{success:!0,value:r.value,rawValue:n}:{success:!1,error:Rg.wrap({value:n,cause:r.error}),rawValue:n}}catch(r){return{success:!1,error:Rg.wrap({value:n,cause:r}),rawValue:n}}}async function rxe({text:n,schema:e}){try{const t=_T(n);return e==null?t:nxe({value:t,schema:e})}catch(t){throw E0.isInstance(t)||Rg.isInstance(t)?t:new E0({text:n,cause:t})}}async function aU({text:n,schema:e}){try{const t=_T(n);return e==null?{success:!0,value:t,rawValue:t}:await oU({value:t,schema:e})}catch(t){return{success:!1,error:E0.isInstance(t)?t:new E0({text:n,cause:t}),rawValue:void 0}}}function w_(n){try{return _T(n),!0}catch{return!1}}function ixe({stream:n,schema:e}){return n.pipeThrough(new TextDecoderStream).pipeThrough(new UOe).pipeThrough(new TransformStream({async transform({data:t},r){t!=="[DONE]"&&r.enqueue(await aU({text:t,schema:e}))}}))}var sxe=()=>globalThis.fetch,I0=async({url:n,headers:e,body:t,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:s,fetch:o})=>oxe({url:n,headers:lr({"Content-Type":"application/json"},e),body:{content:JSON.stringify(t),values:t},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:s,fetch:o}),oxe=async({url:n,headers:e={},body:t,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:s,fetch:o=sxe()})=>{try{const a=await o(n,{method:"POST",headers:HOe(e),body:t.content,signal:s}),l=Hb(a);if(!a.ok){let c;try{c=await i({response:a,url:n,requestBodyValues:t.values})}catch(d){throw ok(d)||Bo.isInstance(d)?d:new Bo({message:"Failed to process error response",cause:d,statusCode:a.status,url:n,responseHeaders:l,requestBodyValues:t.values})}throw c.value}try{return await r({response:a,url:n,requestBodyValues:t.values})}catch(c){throw c instanceof Error&&(ok(c)||Bo.isInstance(c))?c:new Bo({message:"Failed to process successful response",cause:c,statusCode:a.status,url:n,responseHeaders:l,requestBodyValues:t.values})}}catch(a){throw qOe({error:a,url:n,requestBodyValues:t.values})}},axe=({errorSchema:n,errorToMessage:e,isRetryable:t})=>async({response:r,url:i,requestBodyValues:s})=>{const o=await r.text(),a=Hb(r);if(o.trim()==="")return{responseHeaders:a,value:new Bo({message:r.statusText,url:i,requestBodyValues:s,statusCode:r.status,responseHeaders:a,responseBody:o,isRetryable:t?.(r)})};try{const l=await rxe({text:o,schema:n});return{responseHeaders:a,value:new Bo({message:e(l),url:i,requestBodyValues:s,statusCode:r.status,responseHeaders:a,responseBody:o,data:l,isRetryable:t?.(r,l)})}}catch{return{responseHeaders:a,value:new Bo({message:r.statusText,url:i,requestBodyValues:s,statusCode:r.status,responseHeaders:a,responseBody:o,isRetryable:t?.(r)})}}},lU=n=>async({response:e})=>{const t=Hb(e);if(e.body==null)throw new EOe({});return{responseHeaders:t,value:ixe({stream:e.body,schema:n})}},cU=n=>async({response:e,url:t,requestBodyValues:r})=>{const i=await e.text(),s=await aU({text:i,schema:n}),o=Hb(e);if(!s.success)throw new Bo({message:"Invalid JSON response",cause:s.error,statusCode:e.status,responseHeaders:o,responseBody:i,url:t,requestBodyValues:r});return{responseHeaders:o,value:s.value,rawValue:s.rawValue}},{btoa:lxe}=globalThis;function cxe(n){let e="";for(let t=0;t<n.length;t++)e+=String.fromCodePoint(n[t]);return lxe(e)}function uxe(n){return n?.replace(/\/$/,"")}function __(n){return n!=null}var uU=(n=>(n.Unknown="unknown",n.OpenAIResponsesV1="openai-responses-v1",n.XAIResponsesV1="xai-responses-v1",n.AnthropicClaudeV1="anthropic-claude-v1",n.GoogleGeminiV1="google-gemini-v1",n))(uU||{}),OT=je({id:Ce().nullish(),format:cr(uU).nullish(),index:St().optional()}).loose(),dxe=je({type:dn("reasoning.summary"),summary:Ce()}).extend(OT.shape),hxe=je({type:dn("reasoning.encrypted"),data:Ce()}).extend(OT.shape),fxe=je({type:dn("reasoning.text"),text:Ce().nullish(),signature:Ce().nullish()}).extend(OT.shape),xT=Xn([dxe,hxe,fxe]),ay=Xn([xT,Il().transform(()=>null)]),kT=Xt(ay).transform(n=>n.filter(e=>!!e));Xn([je({delta:je({reasoning_details:Xt(ay)})}).transform(n=>n.delta.reasoning_details.filter(__)),je({message:je({reasoning_details:Xt(ay)})}).transform(n=>n.message.reasoning_details.filter(__)),je({text:Ce(),reasoning_details:Xt(ay)}).transform(n=>n.reasoning_details.filter(__))]);var Zb=je({error:je({code:Xn([Ce(),St()]).nullable().optional().default(null),message:Ce(),type:Ce().nullable().optional().default(null),param:gl().nullable().optional().default(null)}).passthrough()}).passthrough(),M0=axe({errorSchema:Zb,errorToMessage:n=>n.error.message}),pxe=je({provider:Ce(),reasoning_details:Xt(xT).optional(),usage:je({promptTokens:St(),promptTokensDetails:je({cachedTokens:St()}).passthrough().optional(),completionTokens:St(),completionTokensDetails:je({reasoningTokens:St()}).passthrough().optional(),totalTokens:St(),cost:St().optional(),costDetails:je({upstreamInferenceCost:St()}).passthrough()}).passthrough()}).passthrough(),gxe=je({openrouter:je({reasoning_details:Xt(xT).optional()}).optional()}).optional();function R0(n){switch(n){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}function ST({url:n,protocols:e}){try{const t=new URL(n);return e.has(t.protocol)}catch{return!1}}function lk({part:n,defaultMediaType:e}){var t,r;if(n.data instanceof Uint8Array){const s=cxe(n.data);return`data:${(t=n.mediaType)!=null?t:e};base64,${s}`}const i=n.data.toString();return ST({url:i,protocols:new Set(["http:","https:"])})||i.startsWith("data:")?i:`data:${(r=n.mediaType)!=null?r:e};base64,${i}`}function NR(n,e){var t;const r=n.match(/^data:([^;]+)/);return r&&(t=r[1])!=null?t:e}function ck(n){const e=n.match(/^data:[^;]*;base64,(.+)$/);return e?e[1]:n}function mxe(n){const e=lk({part:n,defaultMediaType:"audio/mpeg"});if(ST({url:e,protocols:new Set(["http:","https:"])}))throw new Error(`Audio files cannot be provided as URLs.

OpenRouter requires audio to be base64-encoded. Please:
1. Download the audio file locally
2. Read it as a Buffer or Uint8Array
3. Pass it as the data parameter

The AI SDK will automatically handle base64 encoding.

Learn more: https://openrouter.ai/docs/features/multimodal/audio`);const t=ck(e),r=n.mediaType||"audio/mpeg";let i=r.replace("audio/","");if(i==="mpeg"||i==="mp3"?i="mp3":(i==="x-wav"||i==="wave"||i==="wav")&&(i="wav"),i!=="mp3"&&i!=="wav")throw new Error(`Unsupported audio format: "${r}"

OpenRouter only supports MP3 and WAV audio formats.
â¢ For MP3: use "audio/mpeg" or "audio/mp3"
â¢ For WAV: use "audio/wav" or "audio/x-wav"

Learn more: https://openrouter.ai/docs/features/multimodal/audio`);return{data:t,format:i}}function zl(n){var e,t,r;const i=n?.anthropic,s=n?.openrouter;return(r=(t=(e=s?.cacheControl)!=null?e:s?.cache_control)!=null?t:i?.cacheControl)!=null?r:i?.cache_control}function vxe(n){var e,t,r,i,s,o;const a=[],l=[];for(const{role:c,content:d,providerOptions:h}of n)switch(c){case"system":{a.push({role:"system",content:d,cache_control:zl(h)});break}case"user":{if(d.length===1&&((e=d[0])==null?void 0:e.type)==="text"){const g=(t=zl(h))!=null?t:zl(d[0].providerOptions),m=g?[{type:"text",text:d[0].text,cache_control:g}]:d[0].text;a.push({role:"user",content:m});break}const f=zl(h),p=d.map(g=>{var m,v,y,O,_,x,k;const S=(m=zl(g.providerOptions))!=null?m:f;switch(g.type){case"text":return{type:"text",text:g.text,cache_control:S};case"file":{if((v=g.mediaType)!=null&&v.startsWith("image/"))return{type:"image_url",image_url:{url:lk({part:g,defaultMediaType:"image/jpeg"})},cache_control:S};if((y=g.mediaType)!=null&&y.startsWith("audio/"))return{type:"input_audio",input_audio:mxe(g),cache_control:S};const E=String((k=(x=(_=(O=g.providerOptions)==null?void 0:O.openrouter)==null?void 0:_.filename)!=null?x:g.filename)!=null?k:""),R=lk({part:g,defaultMediaType:"application/pdf"});return ST({url:R,protocols:new Set(["http:","https:"])})?{type:"file",file:{filename:E,file_data:R}}:{type:"file",file:{filename:E,file_data:R},cache_control:S}}default:return{type:"text",text:"",cache_control:S}}});a.push({role:"user",content:p});break}case"assistant":{let f="",p="";const g=[];for(const O of d)switch(O.type){case"text":{f+=O.text;break}case"tool-call":{const _=(r=O.providerOptions)==null?void 0:r.openrouter;_?.reasoning_details&&Array.isArray(_.reasoning_details)&&l.push(..._.reasoning_details),g.push({id:O.toolCallId,type:"function",function:{name:O.toolName,arguments:JSON.stringify(O.input)}});break}case"reasoning":{p+=O.text;break}}const m=gxe.safeParse(h),v=m.success?(s=(i=m.data)==null?void 0:i.openrouter)==null?void 0:s.reasoning_details:void 0,y=v&&Array.isArray(v)&&v.length>0?v:l.length>0?l:void 0;a.push({role:"assistant",content:f,tool_calls:g.length>0?g:void 0,reasoning:p||void 0,reasoning_details:y,cache_control:zl(h)});break}case"tool":{for(const f of d){const p=yxe(f);a.push({role:"tool",tool_call_id:f.toolCallId,content:p,cache_control:(o=zl(h))!=null?o:zl(f.providerOptions)})}break}}return a}function yxe(n){return n.output.type==="text"?n.output.value:JSON.stringify(n.output.value)}Xn([dn("auto"),dn("none"),dn("required"),je({type:dn("function"),function:je({name:Ce()})})]);function bxe(n){switch(n.type){case"auto":case"none":case"required":return n.type;case"tool":return{type:"function",function:{name:n.toolName}};default:throw new Q7({argument:"toolChoice",message:`Invalid tool choice type: ${JSON.stringify(n)}`})}}var wxe=je({type:dn("image_url"),image_url:je({url:Ce()}).passthrough()}).passthrough(),_xe=Xn([wxe,Il().transform(()=>null)]),dU=Xt(_xe).transform(n=>n.filter(e=>!!e)),hU=je({id:Ce().optional(),model:Ce().optional(),provider:Ce().optional(),usage:je({prompt_tokens:St(),prompt_tokens_details:je({cached_tokens:St()}).passthrough().nullish(),completion_tokens:St(),completion_tokens_details:je({reasoning_tokens:St()}).passthrough().nullish(),total_tokens:St(),cost:St().optional(),cost_details:je({upstream_inference_cost:St().nullish()}).passthrough().nullish()}).passthrough().nullish()}).passthrough(),Oxe=Xn([hU.extend({choices:Xt(je({message:je({role:dn("assistant"),content:Ce().nullable().optional(),reasoning:Ce().nullable().optional(),reasoning_details:kT.nullish(),images:dU.nullish(),tool_calls:Xt(je({id:Ce().optional().nullable(),type:dn("function"),function:je({name:Ce(),arguments:Ce()}).passthrough()}).passthrough()).optional(),annotations:Xt(Xn([je({type:dn("url_citation"),url_citation:je({end_index:St(),start_index:St(),title:Ce(),url:Ce(),content:Ce().optional()}).passthrough()}).passthrough(),je({type:dn("file_annotation"),file_annotation:je({file_id:Ce(),quote:Ce().optional()}).passthrough()}).passthrough(),je({type:dn("file"),file:je({hash:Ce(),name:Ce(),content:Xt(je({type:Ce(),text:Ce().optional()}).passthrough()).optional()}).passthrough()}).passthrough()])).nullish()}).passthrough(),index:St().nullish(),logprobs:je({content:Xt(je({token:Ce(),logprob:St(),top_logprobs:Xt(je({token:Ce(),logprob:St()}).passthrough())}).passthrough()).nullable()}).passthrough().nullable().optional(),finish_reason:Ce().optional().nullable()}).passthrough())}),Zb.extend({user_id:Ce().optional()})]),xxe=Xn([hU.extend({choices:Xt(je({delta:je({role:cr(["assistant"]).optional(),content:Ce().nullish(),reasoning:Ce().nullish().optional(),reasoning_details:kT.nullish(),images:dU.nullish(),tool_calls:Xt(je({index:St().nullish(),id:Ce().nullish(),type:dn("function").optional(),function:je({name:Ce().nullish(),arguments:Ce().nullish()}).passthrough()}).passthrough()).nullish(),annotations:Xt(Xn([je({type:dn("url_citation"),url_citation:je({end_index:St(),start_index:St(),title:Ce(),url:Ce(),content:Ce().optional()}).passthrough()}).passthrough(),je({type:dn("file_annotation"),file_annotation:je({file_id:Ce(),quote:Ce().optional()}).passthrough()}).passthrough(),je({type:dn("file"),file:je({hash:Ce(),name:Ce(),content:Xt(je({type:Ce(),text:Ce().optional()}).passthrough()).optional()}).passthrough()}).passthrough()])).nullish()}).passthrough().nullish(),logprobs:je({content:Xt(je({token:Ce(),logprob:St(),top_logprobs:Xt(je({token:Ce(),logprob:St()}).passthrough())}).passthrough()).nullable()}).passthrough().nullish(),finish_reason:Ce().nullable().optional(),index:St().nullish()}).passthrough())}),Zb]),kxe=class{constructor(n,e,t){this.specificationVersion="v2",this.provider="openrouter",this.defaultObjectGenerationMode="tool",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.modelId=n,this.settings=e,this.config=t}getArgs({prompt:n,maxOutputTokens:e,temperature:t,topP:r,frequencyPenalty:i,presencePenalty:s,seed:o,stopSequences:a,responseFormat:l,topK:c,tools:d,toolChoice:h}){var f;const p=lr(lr({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:e,temperature:t,top_p:r,frequency_penalty:i,presence_penalty:s,seed:o,stop:a,response_format:l,top_k:c,messages:vxe(n),include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning,usage:this.settings.usage,plugins:this.settings.plugins,web_search_options:this.settings.web_search_options,provider:this.settings.provider},this.config.extraBody),this.settings.extraBody);if(l?.type==="json"&&l.schema!=null)return Pp(lr({},p),{response_format:{type:"json_schema",json_schema:lr({schema:l.schema,strict:!0,name:(f=l.name)!=null?f:"response"},l.description&&{description:l.description})}});if(d&&d.length>0){const g=d.filter(m=>m.type==="function").map(m=>({type:"function",function:{name:m.name,description:m.description,parameters:m.inputSchema}}));return Pp(lr({},p),{tools:g,tool_choice:h?bxe(h):void 0})}return p}async doGenerate(n){var e,t,r,i,s,o,a,l,c,d,h,f,p,g,m,v,y,O,_,x,k,S,E,R,C;const D=(n.providerOptions||{}).openrouter||{},Q=lr(lr({},this.getArgs(n)),D),{value:M,responseHeaders:N}=await I0({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:P0(this.config.headers(),n.headers),body:Q,failedResponseHandler:M0,successfulResponseHandler:cU(Oxe),abortSignal:n.abortSignal,fetch:this.config.fetch});if("error"in M){const G=M.error;throw new Bo({message:G.message,url:this.config.url({path:"/chat/completions",modelId:this.modelId}),requestBodyValues:Q,statusCode:200,responseHeaders:N,data:G})}const B=M,H=B.choices[0];if(!H)throw new J7({message:"No choice in response"});const F=B.usage?{inputTokens:(e=B.usage.prompt_tokens)!=null?e:0,outputTokens:(t=B.usage.completion_tokens)!=null?t:0,totalTokens:((r=B.usage.prompt_tokens)!=null?r:0)+((i=B.usage.completion_tokens)!=null?i:0),reasoningTokens:(o=(s=B.usage.completion_tokens_details)==null?void 0:s.reasoning_tokens)!=null?o:0,cachedInputTokens:(l=(a=B.usage.prompt_tokens_details)==null?void 0:a.cached_tokens)!=null?l:0}:{inputTokens:0,outputTokens:0,totalTokens:0,reasoningTokens:0,cachedInputTokens:0},Z=(c=H.message.reasoning_details)!=null?c:[],$=Z.length>0?Z.map(G=>{switch(G.type){case"reasoning.text":{if(G.text)return{type:"reasoning",text:G.text,providerMetadata:{openrouter:{reasoning_details:[G]}}};break}case"reasoning.summary":{if(G.summary)return{type:"reasoning",text:G.summary,providerMetadata:{openrouter:{reasoning_details:[G]}}};break}case"reasoning.encrypted":{if(G.data)return{type:"reasoning",text:"[REDACTED]",providerMetadata:{openrouter:{reasoning_details:[G]}}};break}}return null}).filter(G=>G!==null):H.message.reasoning?[{type:"reasoning",text:H.message.reasoning}]:[],W=[];if(W.push(...$),H.message.content&&W.push({type:"text",text:H.message.content}),H.message.tool_calls)for(const G of H.message.tool_calls)W.push({type:"tool-call",toolCallId:(d=G.id)!=null?d:Mo(),toolName:G.function.name,input:G.function.arguments,providerMetadata:{openrouter:{reasoning_details:Z}}});if(H.message.images)for(const G of H.message.images)W.push({type:"file",mediaType:NR(G.image_url.url,"image/jpeg"),data:ck(G.image_url.url)});if(H.message.annotations)for(const G of H.message.annotations)G.type==="url_citation"&&W.push({type:"source",sourceType:"url",id:G.url_citation.url,url:G.url_citation.url,title:G.url_citation.title,providerMetadata:{openrouter:{content:G.url_citation.content||""}}});return{content:W,finishReason:R0(H.finish_reason),usage:F,warnings:[],providerMetadata:{openrouter:pxe.parse({provider:(h=B.provider)!=null?h:"",reasoning_details:(f=H.message.reasoning_details)!=null?f:[],usage:{promptTokens:(p=F.inputTokens)!=null?p:0,completionTokens:(g=F.outputTokens)!=null?g:0,totalTokens:(m=F.totalTokens)!=null?m:0,cost:(v=B.usage)==null?void 0:v.cost,promptTokensDetails:{cachedTokens:(_=(O=(y=B.usage)==null?void 0:y.prompt_tokens_details)==null?void 0:O.cached_tokens)!=null?_:0},completionTokensDetails:{reasoningTokens:(S=(k=(x=B.usage)==null?void 0:x.completion_tokens_details)==null?void 0:k.reasoning_tokens)!=null?S:0},costDetails:{upstreamInferenceCost:(C=(R=(E=B.usage)==null?void 0:E.cost_details)==null?void 0:R.upstream_inference_cost)!=null?C:0}}})},request:{body:Q},response:{id:B.id,modelId:B.model,headers:N}}}async doStream(n){var e;const r=(n.providerOptions||{}).openrouter||{},i=lr(lr({},this.getArgs(n)),r),{value:s,responseHeaders:o}=await I0({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:P0(this.config.headers(),n.headers),body:Pp(lr({},i),{stream:!0,stream_options:this.config.compatibility==="strict"?lr({include_usage:!0},(e=this.settings.usage)!=null&&e.include?{include_usage:!0}:{}):void 0}),failedResponseHandler:M0,successfulResponseHandler:lU(xxe),abortSignal:n.abortSignal,fetch:this.config.fetch}),a=[];let l="other";const c={inputTokens:Number.NaN,outputTokens:Number.NaN,totalTokens:Number.NaN,reasoningTokens:Number.NaN,cachedInputTokens:Number.NaN},d={},h=[];let f=!1,p=!1,g,m,v,y;return{stream:s.pipeThrough(new TransformStream({transform(O,_){var x,k,S,E,R,C,I,D,Q,M,N,B,H,F;if(!O.success){l="error",_.enqueue({type:"error",error:O.error});return}const Z=O.value;if("error"in Z){l="error",_.enqueue({type:"error",error:Z.error});return}if(Z.provider&&(y=Z.provider),Z.id&&(v=Z.id,_.enqueue({type:"response-metadata",id:Z.id})),Z.model&&_.enqueue({type:"response-metadata",modelId:Z.model}),Z.usage!=null){if(c.inputTokens=Z.usage.prompt_tokens,c.outputTokens=Z.usage.completion_tokens,c.totalTokens=Z.usage.prompt_tokens+Z.usage.completion_tokens,d.promptTokens=Z.usage.prompt_tokens,Z.usage.prompt_tokens_details){const L=(x=Z.usage.prompt_tokens_details.cached_tokens)!=null?x:0;c.cachedInputTokens=L,d.promptTokensDetails={cachedTokens:L}}if(d.completionTokens=Z.usage.completion_tokens,Z.usage.completion_tokens_details){const L=(k=Z.usage.completion_tokens_details.reasoning_tokens)!=null?k:0;c.reasoningTokens=L,d.completionTokensDetails={reasoningTokens:L}}d.cost=Z.usage.cost,d.totalTokens=Z.usage.total_tokens}const $=Z.choices[0];if($?.finish_reason!=null&&(l=R0($.finish_reason)),$?.delta==null)return;const W=$.delta,G=L=>{p||(m=v||Mo(),_.enqueue({type:"reasoning-start",id:m}),p=!0),_.enqueue({type:"reasoning-delta",delta:L,id:m||Mo()})};if(W.reasoning_details&&W.reasoning_details.length>0){for(const L of W.reasoning_details)if(L.type==="reasoning.text"){const q=h[h.length-1];q?.type==="reasoning.text"?(q.text=(q.text||"")+(L.text||""),q.signature=q.signature||L.signature,q.format=q.format||L.format):h.push(lr({},L))}else h.push(L);for(const L of W.reasoning_details)switch(L.type){case"reasoning.text":{L.text&&G(L.text);break}case"reasoning.encrypted":{L.data&&G("[REDACTED]");break}case"reasoning.summary":{L.summary&&G(L.summary);break}}}else W.reasoning&&G(W.reasoning);if(W.content&&(p&&!f&&(_.enqueue({type:"reasoning-end",id:m||Mo()}),p=!1),f||(g=v||Mo(),_.enqueue({type:"text-start",id:g}),f=!0),_.enqueue({type:"text-delta",delta:W.content,id:g||Mo()})),W.annotations)for(const L of W.annotations)L.type==="url_citation"&&_.enqueue({type:"source",sourceType:"url",id:L.url_citation.url,url:L.url_citation.url,title:L.url_citation.title,providerMetadata:{openrouter:{content:L.url_citation.content||""}}});if(W.tool_calls!=null)for(const L of W.tool_calls){const q=(S=L.index)!=null?S:a.length-1;if(a[q]==null){if(L.type!=="function")throw new Uf({data:L,message:"Expected 'function' type."});if(L.id==null)throw new Uf({data:L,message:"Expected 'id' to be a string."});if(((E=L.function)==null?void 0:E.name)==null)throw new Uf({data:L,message:"Expected 'function.name' to be a string."});a[q]={id:L.id,type:"function",function:{name:L.function.name,arguments:(R=L.function.arguments)!=null?R:""},inputStarted:!1,sent:!1};const oe=a[q];if(oe==null)throw new Uf({data:{index:q,toolCallsLength:a.length},message:`Tool call at index ${q} is missing after creation.`});((C=oe.function)==null?void 0:C.name)!=null&&((I=oe.function)==null?void 0:I.arguments)!=null&&w_(oe.function.arguments)&&(oe.inputStarted=!0,_.enqueue({type:"tool-input-start",id:oe.id,toolName:oe.function.name}),_.enqueue({type:"tool-input-delta",id:oe.id,delta:oe.function.arguments}),_.enqueue({type:"tool-input-end",id:oe.id}),_.enqueue({type:"tool-call",toolCallId:oe.id,toolName:oe.function.name,input:oe.function.arguments,providerMetadata:{openrouter:{reasoning_details:h}}}),oe.sent=!0);continue}const ue=a[q];if(ue==null)throw new Uf({data:{index:q,toolCallsLength:a.length,toolCallDelta:L},message:`Tool call at index ${q} is missing during merge.`});ue.inputStarted||(ue.inputStarted=!0,_.enqueue({type:"tool-input-start",id:ue.id,toolName:ue.function.name})),((D=L.function)==null?void 0:D.arguments)!=null&&(ue.function.arguments+=(M=(Q=L.function)==null?void 0:Q.arguments)!=null?M:""),_.enqueue({type:"tool-input-delta",id:ue.id,delta:(N=L.function.arguments)!=null?N:""}),((B=ue.function)==null?void 0:B.name)!=null&&((H=ue.function)==null?void 0:H.arguments)!=null&&w_(ue.function.arguments)&&(_.enqueue({type:"tool-call",toolCallId:(F=ue.id)!=null?F:Mo(),toolName:ue.function.name,input:ue.function.arguments,providerMetadata:{openrouter:{reasoning_details:h}}}),ue.sent=!0)}if(W.images!=null)for(const L of W.images)_.enqueue({type:"file",mediaType:NR(L.image_url.url,"image/jpeg"),data:ck(L.image_url.url)})},flush(O){var _;if(l==="tool-calls")for(const k of a)k&&!k.sent&&(O.enqueue({type:"tool-call",toolCallId:(_=k.id)!=null?_:Mo(),toolName:k.function.name,input:w_(k.function.arguments)?k.function.arguments:"{}",providerMetadata:{openrouter:{reasoning_details:h}}}),k.sent=!0);p&&O.enqueue({type:"reasoning-end",id:m||Mo()}),f&&O.enqueue({type:"text-end",id:g||Mo()});const x={usage:d};y!==void 0&&(x.provider=y),h.length>0&&(x.reasoning_details=h),O.enqueue({type:"finish",finishReason:l,usage:c,providerMetadata:{openrouter:x}})}})),warnings:[],request:{body:i},response:{headers:o}}}};function Sxe({prompt:n,inputFormat:e,user:t="user",assistant:r="assistant"}){if(n.length===1&&n[0]&&n[0].role==="user"&&n[0].content.length===1&&n[0].content[0]&&n[0].content[0].type==="text")return{prompt:n[0].content[0].text};let i="";n[0]&&n[0].role==="system"&&(i+=`${n[0].content}

`,n=n.slice(1));for(const{role:s,content:o}of n)switch(s){case"system":throw new MOe({message:`Unexpected system message in prompt: ${o}`,prompt:n});case"user":{const a=o.map(l=>{switch(l.type){case"text":return l.text;case"file":throw new ql({functionality:"file attachments"});default:return""}}).join("");i+=`${t}:
${a}

`;break}case"assistant":{const a=o.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new ql({functionality:"tool-call messages"});case"tool-result":throw new ql({functionality:"tool-result messages"});case"reasoning":throw new ql({functionality:"reasoning messages"});case"file":throw new ql({functionality:"file attachments"});default:return""}}).join("");i+=`${r}:
${a}

`;break}case"tool":throw new ql({functionality:"tool messages"})}return i+=`${r}:
`,{prompt:i}}var LR=Xn([je({id:Ce().optional(),model:Ce().optional(),choices:Xt(je({text:Ce(),reasoning:Ce().nullish().optional(),reasoning_details:kT.nullish(),finish_reason:Ce().nullish(),index:St().nullish(),logprobs:je({tokens:Xt(Ce()),token_logprobs:Xt(St()),top_logprobs:Xt(Mu(Ce(),St())).nullable()}).passthrough().nullable().optional()}).passthrough()),usage:je({prompt_tokens:St(),prompt_tokens_details:je({cached_tokens:St()}).passthrough().nullish(),completion_tokens:St(),completion_tokens_details:je({reasoning_tokens:St()}).passthrough().nullish(),total_tokens:St(),cost:St().optional()}).passthrough().nullish()}).passthrough(),Zb]),Txe=class{constructor(n,e,t){this.specificationVersion="v2",this.provider="openrouter",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"text/*":[/^data:text\//,/^https?:\/\/.+$/],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.defaultObjectGenerationMode=void 0,this.modelId=n,this.settings=e,this.config=t}getArgs({prompt:n,maxOutputTokens:e,temperature:t,topP:r,frequencyPenalty:i,presencePenalty:s,seed:o,responseFormat:a,topK:l,stopSequences:c,tools:d,toolChoice:h}){const{prompt:f}=Sxe({prompt:n,inputFormat:"prompt"});if(d?.length)throw new ql({functionality:"tools"});if(h)throw new ql({functionality:"toolChoice"});return lr(lr({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:e,temperature:t,top_p:r,frequency_penalty:i,presence_penalty:s,seed:o,stop:c,response_format:a,top_k:l,prompt:f,include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody)}async doGenerate(n){var e,t,r,i,s,o,a,l,c,d,h,f,p,g,m;const y=(n.providerOptions||{}).openrouter||{},O=lr(lr({},this.getArgs(n)),y),{value:_,responseHeaders:x}=await I0({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:P0(this.config.headers(),n.headers),body:O,failedResponseHandler:M0,successfulResponseHandler:cU(LR),abortSignal:n.abortSignal,fetch:this.config.fetch});if("error"in _){const S=_.error;throw new Bo({message:S.message,url:this.config.url({path:"/completions",modelId:this.modelId}),requestBodyValues:O,statusCode:200,responseHeaders:x,data:S})}const k=_.choices[0];if(!k)throw new J7({message:"No choice in OpenRouter completion response"});return{content:[{type:"text",text:(e=k.text)!=null?e:""}],finishReason:R0(k.finish_reason),usage:{inputTokens:(r=(t=_.usage)==null?void 0:t.prompt_tokens)!=null?r:0,outputTokens:(s=(i=_.usage)==null?void 0:i.completion_tokens)!=null?s:0,totalTokens:((a=(o=_.usage)==null?void 0:o.prompt_tokens)!=null?a:0)+((c=(l=_.usage)==null?void 0:l.completion_tokens)!=null?c:0),reasoningTokens:(f=(h=(d=_.usage)==null?void 0:d.completion_tokens_details)==null?void 0:h.reasoning_tokens)!=null?f:0,cachedInputTokens:(m=(g=(p=_.usage)==null?void 0:p.prompt_tokens_details)==null?void 0:g.cached_tokens)!=null?m:0},warnings:[],response:{headers:x}}}async doStream(n){const t=(n.providerOptions||{}).openrouter||{},r=lr(lr({},this.getArgs(n)),t),{value:i,responseHeaders:s}=await I0({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:P0(this.config.headers(),n.headers),body:Pp(lr({},r),{stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0}),failedResponseHandler:M0,successfulResponseHandler:lU(LR),abortSignal:n.abortSignal,fetch:this.config.fetch});let o="other";const a={inputTokens:Number.NaN,outputTokens:Number.NaN,totalTokens:Number.NaN,reasoningTokens:Number.NaN,cachedInputTokens:Number.NaN},l={};return{stream:i.pipeThrough(new TransformStream({transform(c,d){var h,f;if(!c.success){o="error",d.enqueue({type:"error",error:c.error});return}const p=c.value;if("error"in p){o="error",d.enqueue({type:"error",error:p.error});return}if(p.usage!=null){if(a.inputTokens=p.usage.prompt_tokens,a.outputTokens=p.usage.completion_tokens,a.totalTokens=p.usage.prompt_tokens+p.usage.completion_tokens,l.promptTokens=p.usage.prompt_tokens,p.usage.prompt_tokens_details){const m=(h=p.usage.prompt_tokens_details.cached_tokens)!=null?h:0;a.cachedInputTokens=m,l.promptTokensDetails={cachedTokens:m}}if(l.completionTokens=p.usage.completion_tokens,p.usage.completion_tokens_details){const m=(f=p.usage.completion_tokens_details.reasoning_tokens)!=null?f:0;a.reasoningTokens=m,l.completionTokensDetails={reasoningTokens:m}}l.cost=p.usage.cost,l.totalTokens=p.usage.total_tokens}const g=p.choices[0];g?.finish_reason!=null&&(o=R0(g.finish_reason)),g?.text!=null&&d.enqueue({type:"text-delta",delta:g.text,id:Mo()})},flush(c){c.enqueue({type:"finish",finishReason:o,usage:a,providerMetadata:{openrouter:{usage:l}}})}})),response:{headers:s}}}};function Axe(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e!==null))}function Cxe(n,...e){const t=Axe(n??{}),i=[t["user-agent"]||"",...e].filter(Boolean).join(" ");return Pp(lr({},t),{"user-agent":i})}var Exe="1.2.8";function Dg(n={}){var e,t,r;const i=(t=uxe((e=n.baseURL)!=null?e:n.baseUrl))!=null?t:"https://openrouter.ai/api/v1",s=(r=n.compatibility)!=null?r:"compatible",o=()=>Cxe(lr({Authorization:`Bearer ${ZOe({apiKey:n.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},n.headers),`ai-sdk/openrouter/${Exe}`),a=(h,f={})=>new kxe(h,f,{provider:"openrouter.chat",url:({path:p})=>`${i}${p}`,headers:o,compatibility:s,fetch:n.fetch,extraBody:n.extraBody}),l=(h,f={})=>new Txe(h,f,{provider:"openrouter.completion",url:({path:p})=>`${i}${p}`,headers:o,compatibility:s,fetch:n.fetch,extraBody:n.extraBody}),c=(h,f)=>{if(new.target)throw new Error("The OpenRouter model function cannot be called with the new keyword.");return h==="openai/gpt-3.5-turbo-instruct"?l(h,f):a(h,f)},d=(h,f)=>c(h,f);return d.languageModel=c,d.chat=a,d.completion=l,d}Dg({compatibility:"strict"});const QR="anthropic/claude-haiku-4.5";function $R(){return document.documentElement.hasAttribute("data-screenshot-mode")}const fU=[{titlePattern:/art of doing science|hamming/i,prompts:[`Explain the relationship between Hamming's concept of the "prepared mind" and the tolerance for ambiguity he describes. How do these two ideas work together in the creative process?`],feedbackPatterns:[{responsePattern:/prepared|mind|intuition|luck|favor/i,feedback:`Good connection to the expertise-intuition link. You're right that the "prepared mind" isn't passive waiting - it's the result of years of focused engagement. This ties to Kahneman's System 1: expertise trains our fast thinking to recognize patterns others miss. The tolerance for ambiguity Hamming describes is what allows this preparation to happen - staying with uncertainty long enough for insights to emerge.`}],defaultFeedback:`You're engaging with Hamming's core ideas about doing important work. Consider pushing deeper on the connection between his "important problems" framework and the practical methods he suggests - the Friday afternoons, the tolerance for ambiguity, the prepared mind. These aren't separate concepts; they're parts of a coherent approach to meaningful creative work.`},{titlePattern:/flow state|flow/i,prompts:["What conditions does Csikszentmihalyi identify as necessary for entering a flow state? How do these relate to the challenge-skill balance, and what happens when that balance is disrupted?",'Explain how the concept of "autotelic experience" connects to intrinsic motivation in flow states. Why might external rewards actually interfere with achieving flow?'],feedbackPatterns:[{responsePattern:/challenge|skill|balance|match/i,feedback:"You've identified the critical balance point correctly. When challenge exceeds skill, we get anxiety; when skill exceeds challenge, boredom. The flow channel is narrow but learnable - we can deliberately tune task difficulty or develop skills to stay in it. This connects to Hamming's idea of working on important problems: the best problems keep us at the edge of our capabilities."}],defaultFeedback:"Good start on understanding flow mechanics. Consider how the conditions you've described relate to practical applications - how might you engineer your environment or tasks to make flow more likely?"},{titlePattern:/creativity|creative|science of creativity/i,prompts:["Your notes suggest creativity emerges from constraints rather than complete freedom. What evidence supports this counterintuitive claim, and what types of constraints seem most generative?","How do the concepts of divergent and convergent thinking work together in the creative process? When should each mode dominate?"],feedbackPatterns:[{responsePattern:/constraint|limit|focus|bound/i,feedback:"You've captured the paradox well - constraints liberate by eliminating options and focusing energy. The key insight is that not all constraints are equal: generative constraints channel creativity without prescribing outcomes. This explains why rigid formulas fail while open-ended limitations (like a sonnet's structure or a budget limit) can inspire breakthrough work."}],defaultFeedback:"You're exploring the relationship between structure and creativity thoughtfully. Consider how this applies to your own creative practice - what constraints have you found most productive?"}];function Pxe(n){for(const e of fU)if(e.titlePattern.test(n)){const t=Math.floor(Math.random()*e.prompts.length);return e.prompts[t]}return"What are the key insights from this note that you want to remember? How do they connect to other ideas you've been thinking about?"}function Ixe(n,e){for(const t of fU)if(t.titlePattern.test(n)){for(const r of t.feedbackPatterns)if(r.responsePattern.test(e))return r.feedback;return t.defaultFeedback}return"Good reflection on this material. Consider how these ideas might apply to a current project or challenge you're working on. Making concrete connections helps solidify understanding."}async function FR(n,e){if(!e)return n;const t=15,r=8;for(let i=0;i<n.length;i+=t){const s=n.slice(0,i+t);e(s),await new Promise(o=>setTimeout(o,r))}return e(n),n}const Mxe=`You are a learning coach helping users deeply engage with their notes through active review. Your role is to create review challenges that encourage explanation, connection-making, and application of concepts.

When generating a review challenge:
1. Read the note content carefully
2. Create 1-2 focused questions that require the user to think actively about the material
3. Prefer questions that ask them to:
   - Explain concepts in their own words
   - Make connections to other ideas or experiences
   - Apply the concept to a new situation
   - Identify the key insight or takeaway
4. Avoid simple recall questions - focus on understanding and synthesis
5. Keep the challenge concise but thought-provoking

Format your response as a direct challenge to the user. Don't include preamble like "Here's a challenge for you:". Just ask the question(s) directly.`,Rxe=`You are a learning coach providing feedback on a user's review response. Your role is to encourage deeper engagement and help them solidify their understanding.

When analyzing their response:
1. Acknowledge what they got right and what shows good understanding
2. Gently point out any gaps or areas for deeper exploration
3. Suggest connections they might make to other concepts
4. Keep feedback encouraging and constructive
5. Be concise - aim for 2-3 sentences of feedback

Don't be overly effusive or use excessive praise. Be genuine and helpful. Focus on the substance of their response.

If their response is very brief or off-topic, gently encourage more engagement without being critical.`;class Dxe{proxyUrl;#e=j("ready");get _status(){return u(this.#e)}set _status(e){b(this.#e,e,!0)}#t=j(null);get _error(){return u(this.#t)}set _error(e){b(this.#t,e,!0)}abortController=null;constructor(e){this.proxyUrl=`http://127.0.0.1:${e}/api/chat/proxy`}get status(){return this._status}get error(){return this._error}get isLoading(){return this._status==="generating"}cancel(){this.abortController&&(this.abortController.abort(),this.abortController=null),this._status="ready"}async generatePrompt(e,t,r){if($R()){this._status="generating";const i=Pxe(e),s=await FR(i,r);return this._status="ready",s}this._status="generating",this._error=null,this.abortController=new AbortController;try{const i=Dg({baseURL:this.proxyUrl,apiKey:"proxy-handled"}),s=C0({model:i(QR),system:Mxe,prompt:`Note Title: ${e}

Note Content:
${t}

Generate a review challenge for this note:`,abortSignal:this.abortController.signal});let o="";for await(const a of s.textStream)o+=a,r&&r(o);return this._status="ready",o.trim()}catch(i){throw i instanceof Error&&i.name==="AbortError"?(this._status="ready",i):(this._error=i instanceof Error?i:new Error("Unknown error"),this._status="error",this._error)}finally{this.abortController=null}}async analyzeResponse(e,t,r,i,s){if($R()){this._status="generating";const o=Ixe(e,i),a=await FR(o,s);return this._status="ready",a}this._status="generating",this._error=null,this.abortController=new AbortController;try{const o=Dg({baseURL:this.proxyUrl,apiKey:"proxy-handled"}),a=C0({model:o(QR),system:Rxe,prompt:`Note Title: ${e}

Note Content:
${t}

Challenge Given:
${r}

User's Response:
${i}

Provide brief, constructive feedback:`,abortSignal:this.abortController.signal});let l="";for await(const c of a.textStream)l+=c,s&&s(l);return this._status="ready",l.trim()}catch(o){throw o instanceof Error&&o.name==="AbortError"?(this._status="ready",o):(this._error=o instanceof Error?o:new Error("Unknown error"),this._status="error",this._error)}finally{this.abortController=null}}}let O_=null;function Nxe(n){return O_||(O_=new Dxe(n)),O_}const zR="type-default",Lxe={books:"ð",reading:"ð",research:"ð¬",notes:"ð",references:"ð",sources:"ð",writing:"âï¸",drafts:"ð",projects:"ð",ideas:"ð¡",concepts:"ð§ ",daily:"ð",journal:"ð",logs:"ð",archive:"ð¦",inbox:"ð¥",meetings:"ð¥",tasks:"â",decisions:"âï¸"};function Qxe(n){const e=n.toLowerCase().trim();return Lxe[e]||"ð"}let Hl=j(null),uk=j(!1);function $xe(){return u(Hl)}function Fxe(){b(Hl,null),b(uk,!1)}function zxe(){return window.api?.markdownImport}async function pU(n,e){const t=zxe();if(!t)return console.error("[markdown-import-renderer] API not available"),{success:!1,errors:[{file:"",message:"Markdown import API not available"}]};b(uk,!0),b(Hl,{phase:"scanning",message:"Scanning directory for markdown files...",current:0,total:3},!0);const r=[];try{const i=await t.getMarkdownImportData({dirPath:n});if(!i)return{success:!1,errors:[{file:"",message:"No markdown files found in directory"}]};b(Hl,{phase:"creating-types",message:"Creating vault and note types...",current:1,total:3},!0);const s=p5(e);await ru(s.id);const o={};for(const l of i.directory.categories)try{const c=hb({name:l,purpose:`Notes imported from ${l} folder`,icon:Qxe(l)});o[l]=c}catch(c){r.push({file:l,message:`Failed to create note type: ${c instanceof Error?c.message:String(c)}`})}b(Hl,{phase:"importing-notes",message:`Importing ${i.files.length} notes...`,current:2,total:3},!0);let a=0;for(let l=0;l<i.files.length;l++){const c=i.files[l];b(Hl,{phase:"importing-notes",message:`Importing note ${l+1} of ${i.files.length}...`,current:2,total:3},!0);try{const d=c.categoryName&&o[c.categoryName]||zR;await zs({title:c.title,content:c.content,type:d}),a++}catch(d){r.push({file:c.relativePath,message:`Failed to create note: ${d instanceof Error?d.message:String(d)}`})}}return b(Hl,{phase:"complete",message:"Import complete!",current:3,total:3},!0),{success:!0,vault:s,stats:{noteTypes:Object.keys(o).length,notes:a},errors:r}}catch(i){return b(Hl,{phase:"error",message:i instanceof Error?i.message:"Import failed",current:0,total:0},!0),{success:!1,errors:[{file:"",message:i instanceof Error?i.message:"Import failed"}]}}finally{b(uk,!1)}}let ol=j(null),dk=j(!1);function Bxe(){return u(ol)}function Uxe(){b(ol,null),b(dk,!1)}function jxe(){return window.api?.automergeImport}async function Vxe(n,e){const t=jxe();if(!t)return console.error("[automerge-import-renderer] API not available"),{success:!1,error:"Automerge import API not available"};b(dk,!0),b(ol,{phase:"validating",message:"Validating vault..."},!0);try{const r=await t.detectAutomergeVault({dirPath:n});if(!r)return{success:!1,error:"Directory does not contain a Flint vault"};if(!r.isValid)return{success:!1,error:r.error||"Invalid vault manifest"};b(ol,{phase:"creating-vault",message:"Checking for duplicates..."},!0);const s=sc().find(d=>d.docUrl===r.docUrl);if(s)return{success:!1,error:`This vault is already imported as "${s.name}"`};b(ol,{phase:"creating-vault",message:"Creating vault entry..."},!0);const o={id:Zk(),name:e||r.name,docUrl:r.docUrl,baseDirectory:n,archived:!1,created:Wt()},a=sc();a.push(o),Ou(a),f5(o),b(ol,{phase:"connecting-sync",message:"Connecting to vault storage..."},!0);const l=Zo();if(await cb(l,o),b(ol,{phase:"loading-document",message:"Loading vault document..."},!0),!await ru(o.id)){const d=sc().filter(h=>h.id!==o.id);return Ou(d),{success:!1,error:"Failed to load vault document"}}return b(ol,{phase:"complete",message:"Import complete!"},!0),console.log(`[automerge-import-renderer] Successfully imported vault: ${o.name}`),{success:!0,vault:o}}catch(r){return b(ol,{phase:"error",message:r instanceof Error?r.message:"Import failed"},!0),{success:!1,error:r instanceof Error?r.message:"Import failed"}}finally{b(dk,!1)}}const qxe=`Really interesting piece on how our brains handle context switching. Explains why it takes ~23 minutes to fully refocus after an interruption.

## Key Takeaways
- The "attention residue" concept - part of your brain stays on the previous task
- Batching similar tasks is way more effective than I thought
- Even quick glances at email count as interruptions

## Summary
Basically argues that multitasking is a myth. When we think we're multitasking, we're actually just switching rapidly between tasks, and each switch has a cognitive cost. The author cites a UC Irvine study that found it takes an average of 23 minutes to return to the original task after an interruption.

## My Thoughts
This explains so much about my afternoon productivity crashes. I've been checking Slack way too often. Going to try:
- Turning off notifications for 2-hour blocks
- Checking email only 3x per day

Wonder if this connects to [[Deep Work]] ideas?
`,Hxe=`The idea that small, consistent actions compound over time into massive results. Like compound interest but for habits and skills.

## Why It Matters
Gets me out of the "I need to make big changes" mindset. 1% better each day = 37x better over a year (math checks out, surprisingly).

## Examples
- Writing 200 words daily â a book in a year
- 10 minutes of stretching â actually touching my toes now
- Learning one new keyboard shortcut per week

## Connections
- Related to [[Atomic Habits]] book notes
- Opposite of the "motivation" trap - don't wait to feel like it
- Works because habits reduce decision fatigue

## Open Questions
- How do you pick which 1% improvements to focus on?
- What about things that need a big initial push to get started?
`,Zxe=`Free tool for creating diagrams as code. Way faster than dragging boxes around in Figma when I just need a quick flowchart.

## Links
- Main site: https://excalidraw.com
- VS Code extension (handy for README diagrams)

## When I Use It
- Quick architecture sketches during planning
- Explaining async flows to the team
- Hand-drawn style looks less "formal" which helps in early discussions

## Tips
- Cmd+D to duplicate elements
- The library feature saves common shapes - I have arrows and database symbols saved
- Export as SVG for crisp images in docs
- There's a collaboration mode but haven't tried it yet
`,Wxe=`Weekly sync - ran a bit long because we got into the weeds on the API redesign.

## What We Covered
- Sprint is on track, should hit the demo deadline
- API breaking changes - agreed to version the endpoints instead of migrating everything at once
- Sarah's out next week, Marcus covering her PRs

## Action Items
- [ ] I need to write up the versioning proposal by Thursday
- [ ] Marcus: Review the auth PR (blocked on this)
- [ ] Whole team: Update your ticket estimates, planning is Monday

## Decisions
- Going with REST over GraphQL for now - team more familiar, can revisit later
- Pushing the dashboard redesign to next quarter

## Notes
Jamie mentioned some performance issues on the search page - not urgent but should look into it. Might be related to that N+1 query I noticed last week.
`,Xxe=`Add email validation to the signup form. Users are entering invalid emails and then can't recover their accounts.

## What Done Looks Like
- [x] Basic format validation (has @, valid domain)
- [ ] Check for common typos (gmial.com, etc)
- [ ] Show inline error message, not just on submit
- [ ] Add unit tests

## Notes
The validation library we use elsewhere is \`validator.js\` - should probably use that for consistency.

Check with design if we want to show suggestions for typos ("Did you mean gmail.com?") or just reject.

## Context
This came from 3 support tickets last week. See [[Q4 Support Analysis]] for the pattern.
`,Yxe=`We need to pick a state management approach for the new dashboard. Current Redux setup is getting unwieldy.

## Options We Considered

**Zustand**
- Pros: Simple, small bundle, easy to learn
- Cons: Less ecosystem, team would need to learn it

**Stick with Redux + RTK**
- Pros: Team knows it, good devtools
- Cons: Still verbose, the boilerplate is what's slowing us down

**React Query + Context**
- Pros: Handles server state well, less code for our use case
- Cons: Different mental model, mixing two approaches

## Decision
Going with **Zustand** for the new dashboard.

## Why
- Dashboard is mostly client-side state (filters, UI state)
- We can try it in isolation without touching existing Redux code
- If it doesn't work out, migration back isn't too painful

Marcus had concerns about splitting approaches but agreed to try it scoped to this feature first.
`,Gxe=`This vault is set up with three note types to help you build a personal knowledge base. Use whatever works for you - these are just starting points.

## {{type:Article}}
For capturing ideas from things you read - articles, blog posts, papers, books. The goal is to summarize in your own words so you actually remember it later.

See [[The Cost of Context Switching]] for an example.

## {{type:Concept}}
For ideas you want to develop over time. Could be something you're learning, a mental model, or just a thought you want to explore. I like to revisit these and add to them as I learn more.

See [[Compound Growth]] for an example.

## {{type:Resource}}
For tools, websites, references - anything you want to find again. I use these as quick-reference cards for stuff I don't want to keep googling.

See [[Excalidraw]] for an example.

---

Feel free to create your own note types or modify these. The properties on each type (like "source" for {{type:Article}}s) show up in the editor so you can track metadata without cluttering the note itself.
`,Kxe=`This vault is set up for tracking project work. Three note types to start:

## {{type:Meeting}}
For meeting notes. Has date and attendees fields so you can find "that meeting where we discussed X" later. I try to always capture action items with checkboxes.

See [[Team Sync - Dec 12]] for an example.

## {{type:Task}}
For work items. The status field (todo/in-progress/done) makes it easy to see what's active. I like breaking down acceptance criteria as checkboxes.

See [[Signup form email validation]] for an example.

## {{type:Decision}}
For documenting choices and why we made them. Super useful when someone asks "why did we do it this way?" six months later. The status field tracks whether it's still pending or approved.

See [[Dashboard state management]] for an example.

---

The workspaces (Active, Planning, Archive) are a suggestion for organizing notes by project phase. Move notes between them as projects progress.
`,D0=[{id:"empty",name:"Empty",description:"Start fresh with just a default workspace",icon:"ð",workspaces:[],noteTypes:[],notes:[]},{id:"personal-kb",name:"Personal Knowledge Base",description:"Organized for learning, projects, and references",icon:"ð§ ",workspaces:[{name:"Learning",icon:"ð"},{name:"Projects",icon:"ð"},{name:"References",icon:"ð"}],noteTypes:[{name:"Article",purpose:"Summaries and analysis of articles, papers, or books",icon:"ð°",properties:[{name:"source",type:"string",description:"Source URL or publication"},{name:"author",type:"string",description:"Author of the article"},{name:"readDate",type:"date",description:"Date when you read it"}]},{name:"Concept",purpose:"Ideas and concepts to remember and develop",icon:"ð¡",properties:[{name:"maturity",type:"string",description:"How developed is this concept",constraints:{options:["seedling","growing","evergreen"]},default:"seedling"}]},{name:"Resource",purpose:"Links, tools, and references to external content",icon:"ð",properties:[{name:"url",type:"string",description:"Main URL for this resource"},{name:"category",type:"string",description:"Resource category",constraints:{options:["tool","documentation","tutorial","reference","other"]},default:"other"}]}],notes:[{title:"How to Use This Vault",content:Gxe,pinned:!0},{title:"The Cost of Context Switching",content:qxe,typeName:"Article",props:{source:"https://hbr.org/2022/08/the-cost-of-context-switching",author:"Sophie Leroy",readDate:"2024-11-20"}},{title:"Compound Growth",content:Hxe,typeName:"Concept",props:{maturity:"growing"}},{title:"Excalidraw",content:Zxe,typeName:"Resource",props:{url:"https://excalidraw.com",category:"tool"}}]},{id:"project-notes",name:"Project Notes",description:"Organized for project management and tracking",icon:"ð",workspaces:[{name:"Active",icon:"â¡"},{name:"Planning",icon:"ð"},{name:"Archive",icon:"ð¦"}],noteTypes:[{name:"Meeting",purpose:"Meeting notes and action items",icon:"ð¥",properties:[{name:"date",type:"date",description:"Meeting date"},{name:"attendees",type:"string",description:"Meeting attendees"}]},{name:"Task",purpose:"Tasks and to-dos",icon:"â",properties:[{name:"status",type:"string",description:"Task status",constraints:{options:["todo","in-progress","done"]},default:"todo"},{name:"due",type:"date",description:"Due date"}]},{name:"Decision",purpose:"Decisions and their rationale",icon:"âï¸",properties:[{name:"date",type:"date",description:"Date of the decision"},{name:"status",type:"string",description:"Decision status",constraints:{options:["pending","approved","rejected"]},default:"pending"}]}],notes:[{title:"How to Use This Vault",content:Kxe,pinned:!0},{title:"Team Sync - Dec 12",content:Wxe,typeName:"Meeting",props:{date:"2024-12-12",attendees:"Me, Sarah, Marcus, Jamie"}},{title:"Signup form email validation",content:Xxe,typeName:"Task",props:{status:"in-progress",due:"2024-12-20"}},{title:"Dashboard state management",content:Yxe,typeName:"Decision",props:{date:"2024-12-10",status:"approved"}}]}],BR=`Most note apps optimize for capture. Flint optimizes for *knowledge* - turning information into understanding that lasts.

## The Problem

Notes pile up. You capture ideas, save articles, jot down meeting notes. But then what? Most of it sits there, never revisited. The information doesn't become knowledge.

## The Deep Knowledge Cycle

Flint is built around three interconnected phases:

### 1. Externalize - Get Ideas Out

Capture thoughts without worrying about organization. Daily notes, quick ideas, meeting notes - just write. The goal is frictionless capture so nothing gets lost.

Note types handle structure for you. A meeting note knows it needs attendees and action items. A concept note knows it's something to develop over time.

### 2. Internalize - Make Ideas Yours

This is where notes become knowledge:

- **Wikilinks** make connections explicit - type \`[[\` to link related ideas
- **The AI agent** helps you synthesize, summarize, and discover connections
- **Processing** transforms raw capture into lasting understanding

### 3. Resurface - Bring Knowledge Back

Notes you don't revisit might as well not exist. Flint brings ideas back at optimal intervals:

- **Review system** uses spaced repetition with AI-generated prompts
- **Active recall** builds lasting memory (answer from memory, then check)
- **Daily notes** anchor your thinking in time

## Philosophy

**AI amplifies thinking, doesn't replace it.** The agent handles mechanical tasks - organizing, searching, suggesting connections. You do the thinking.

**Plain text permanence.** Your notes are markdown files. No lock-in, works with any tool, yours forever.

**Local-first.** Your data stays on your machine. Cloud sync is standard file sync (Dropbox, iCloud) - you control it.

---

Now go write something. The system adapts to you.

â See [[Getting Started with Flint]] for practical essentials
`,Jxe=`Everything you need to start building knowledge.

## Take Notes

Press \`Cmd/Ctrl + Shift + N\` to create a new note. Write whatever's on your mind - ideas, meeting notes, things you're learning. Don't worry about organization yet.

## Make Links

Type \`[[\` to connect notes together. Links are how knowledge compounds:
- \`[[Project Ideas]]\` links to that note (creates it if it doesn't exist)
- Backlinks show you what links *to* a note
- Over time, your notes become a web of connected ideas

## Use Note Types

Notes have types that give them structure. The default is "Note", but you can create types like Meeting, Task, or Article - each with their own properties (dates, status, tags).

- **Change a note's type**: \`Cmd/Ctrl + Shift + M\`
- **Manage types**: \`Cmd/Ctrl + 5\`

Types help you think differently about different kinds of notes, and let the AI agent understand your notes better.

## Essential Shortcuts

- **New note**: \`Cmd/Ctrl + Shift + N\`
- **Search**: \`Cmd/Ctrl + K\`
- **Pin note**: \`Cmd/Ctrl + Shift + P\`
- **Change type**: \`Cmd/Ctrl + Shift + M\`

## Three Features to Explore

Once you're comfortable with notes and links, these help you get more out of your knowledge:

### Daily Notes (\`Cmd/Ctrl + 2\`)

A week view for journaling and quick capture. Great for:
- Morning intentions, end-of-day reflections
- Ideas that pop up throughout the day
- Linking out to permanent notes as things develop

### Review System (\`Cmd/Ctrl + 3\`)

Turn notes into lasting knowledge through spaced repetition:
1. Enable review on important notes
2. AI generates challenges testing your understanding
3. Answer from memory, rate your confidence
4. Notes resurface at optimal intervals

### AI Agent (\`Cmd/Ctrl + Shift + A\`)

Your knowledge partner. Ask it to:
- "Create a meeting note for tomorrow"
- "Find notes about [topic]"
- "Suggest wikilinks for this note"
- "Summarize my notes from last week"

---

Start simple: take notes, make links. The rest will follow.

â See [[The Deep Knowledge Cycle]] for the philosophy behind Flint
`,eke=`Flint helps you build knowledge that lasts - not just store information.

## What Makes Flint Different

Most tools optimize for capture. Flint optimizes for the complete cycle:

**Externalize** (capture freely) â **Internalize** (make it yours) â **Resurface** (remember it)

See [[The Deep Knowledge Cycle]] for the full philosophy.

## Quick Start

- **New note**: \`Cmd/Ctrl + Shift + N\`
- **Search**: \`Cmd/Ctrl + K\`
- **Toggle AI agent**: \`Cmd/Ctrl + Shift + A\`

## Your Learning Path

### Start Here
1. [[Tutorial: Notes and Connections]] - Create notes, link ideas
2. Open the AI agent (\`Cmd/Ctrl + Shift + A\`) and ask it something

### Go Deeper
3. [[Tutorial: The AI Agent]] - Your knowledge partner
4. [[Tutorial: Daily Notes]] - Capture and reflect
5. [[Tutorial: Review System]] - Active learning that sticks

### Reference
- [[Quick Reference Card]] - All shortcuts and syntax

Welcome to building knowledge that lasts.
`,tke=`This tutorial covers the foundations: creating notes, connecting them, and organizing your vault.

## Creating Notes

**Keyboard**: \`Cmd/Ctrl + Shift + N\`
**Search**: \`Cmd/Ctrl + K\` â type a title â select "Create new note"
**From wikilink**: Type \`[[New Note Title]]\` â click the link to create it

## Wikilinks - Connecting Ideas

Type \`[[\` anywhere to link to another note. Start typing to search, or enter a new title.

**Why link?**
- Makes relationships explicit (not just in your head)
- Creates backlinks automatically - see what links *to* a note
- Builds your knowledge graph over time

**Tip**: Don't overthink it. Link liberally. You can always clean up later.

## Note Types

Notes have types that give them structure:
- **Note** - General purpose (default)
- **Daily** - Journal entries, time-anchored
- Custom types you create (Meeting, Task, Article, etc.)

Each type can have:
- **Properties** - structured fields (dates, status, tags)
- **Agent instructions** - guide how the AI works with that type

**Change type**: \`Cmd/Ctrl + Shift + M\` or right-click

**Manage types**: \`Cmd/Ctrl + 5\` or Settings â Note Types

## Properties

Properties are fields attached to notes via their type:
- **Text**: Free-form text
- **Date**: Calendar picker
- **Select**: Dropdown with predefined options
- **Notelinks**: Links to other notes

Properties appear as chips in the editor header. Click to edit.

## Workspaces

Workspaces are separate contexts with their own pinned notes. Use them for:
- Work vs Personal
- Different projects
- Different areas of focus

**Switch/create**: Click workspace name in sidebar

## Pinning Notes

Pin frequently-used notes to keep them at the top of your sidebar:
- Right-click â Pin
- Or \`Cmd/Ctrl + Shift + P\`

## Next Steps

â [[Tutorial: The AI Agent]] - Learn what the agent can do
â [[Tutorial: Daily Notes]] - Structured capture
`,nke=`The AI agent is your knowledge partner - it handles mechanical tasks so you can focus on thinking.

## Opening the Agent

**Shortcut**: \`Cmd/Ctrl + Shift + A\`
**Or**: Click the floating agent icon in the editor

## What the Agent Can Do

### Create and Organize Notes
- "Create a meeting note for tomorrow's standup with Sarah and Marcus"
- "Move my inbox notes to appropriate types"
- "Add a due date to this task"
- "Create a concept note about spaced repetition"

### Search and Synthesize
- "Find all notes about authentication"
- "Summarize my meeting notes from last week"
- "What have I written about project X?"
- "Show me notes I haven't reviewed in a month"

### Suggest Connections
- "What notes should I link from here?"
- "Find notes related to this one"
- "Suggest wikilinks for this note"

### Understand Context
The agent reads your notes, follows wikilinks, and understands note types. It knows the difference between a daily note and a project note. Ask it to work with "this note" or "my recent notes" - it understands context.

## Philosophy: Amplification, Not Replacement

The agent handles:
- Organizing, searching, structuring
- Finding connections you might miss
- Mechanical transformations (summarize, format, extract)

You handle:
- Insights, judgment, understanding
- Deciding what matters
- Making meaning from information

## Tips for Effective Use

1. **Be specific**: "Create a meeting note for tomorrow's standup" beats "create a note"
2. **Let it read context**: "Based on this note, suggest related notes"
3. **Start fresh conversations** when switching topics
4. **Ask for explanations**: "Why do you suggest linking to X?"

## Model Selection

- **Normal** (Haiku): Fast, economical, great for most tasks
- **Plus Ultra** (Sonnet): Extra reasoning power for complex synthesis

Toggle in the agent panel.

## Privacy

Notes are only sent to the AI when you ask about them. Your vault content stays local until you explicitly involve the agent. API keys are stored in your OS keychain.

## Next Steps

â [[Tutorial: Daily Notes]] - Structured capture workflow
â [[Tutorial: Review System]] - Active learning
`,rke=`Daily notes are your capture hub - a place for thoughts, tasks, and reflections anchored in time.

## Opening Daily View

**Shortcut**: \`Cmd/Ctrl + 2\`
**Or**: Click "Daily" in the sidebar

## The Week View

You see a full week at a glance:
- Each day shows a preview or quick entry area
- Click a day to expand and edit
- Past days for context, future for planning

## Navigation

- **Previous week**: \`[\`
- **Next week**: \`]\`
- **Jump to today**: \`T\`

## What to Capture

Daily notes are flexible. Common patterns:

**Morning**
- Intentions for the day
- What you're thinking about

**Throughout the day**
- Quick captures - ideas, observations
- Meeting notes (or link to separate meeting notes)
- Tasks as they come up

**End of day**
- What happened
- What you learned
- What's on your mind

## The Capture â Process Pattern

Daily notes are *ephemeral* captures. They're where ideas land first. But lasting knowledge lives in *permanent* notes.

**The workflow:**
1. Capture in daily notes freely
2. Later, process: extract insights into permanent notes
3. Link daily entries to permanent notes for context

**Example:**
- Daily: "Had interesting conversation with Sarah about API versioning. She suggested we look at how Stripe does it."
- Later: Create \`[[API Versioning Patterns]]\` permanent note
- Daily links to permanent, permanent links back

## Ask the Agent

The agent can help with daily notes:
- "Summarize my daily notes from this week"
- "What tasks did I mention this week that aren't done?"
- "Create a weekly review from my daily notes"

## Next Steps

â [[Tutorial: Review System]] - Turn notes into lasting knowledge
`,ike=`The review system transforms notes from passive archives into active knowledge you can actually use.

## Why Review?

Most notes are written once, forgotten forever. Even re-reading creates an illusion of knowledge - it feels familiar, but you can't recall or apply it when you need it.

**The science**: Active recall + spaced repetition = lasting memory. You learn by struggling to retrieve, not by re-reading.

## How It Works

1. **Enable review** on a note (click the Review button or ask the agent)
2. **AI generates a challenge** testing your understanding
3. **You respond from memory** - this is the key. Don't peek at the note.
4. **Rate your confidence** - this schedules the next review
5. **Note resurfaces** at optimal intervals (soon if hard, later if easy)

## Opening Review

**Shortcut**: \`Cmd/Ctrl + 3\`
**Or**: Click "Review" in the sidebar when notes are due

## What to Review

**Good candidates:**
- Core concepts you need to internalize
- Technical knowledge (APIs, patterns, architecture decisions)
- Important decisions and their rationale
- Key learnings from courses, books, or conversations

**Skip these:**
- Pure reference material (just search when needed)
- Notes you naturally revisit anyway
- Temporary or time-sensitive content
- Meeting notes (unless there's a concept to retain)

## During a Review Session

1. Read the AI's challenge
2. **Answer from memory** - the discomfort of recalling is what builds understanding
3. Compare your answer to the note
4. Be honest about your confidence

## Tips for Effective Reviews

- **Use your own words**, not memorized phrases
- **Explain connections** - how does this relate to other things you know?
- **Show understanding**, not just recognition
- **Quality over quantity** - 20 well-chosen notes beats 100 neglected ones

## The Deeper Point

Review isn't about perfect recall. It's about engaging with your ideas repeatedly, from different angles, over time. Each review strengthens understanding, reveals gaps, and builds connections.

That's how notes become knowledge.

## Next Steps

Start reviewing: enable review on your most important notes.

â [[Quick Reference Card]] - All shortcuts in one place
`,ske='## Keyboard Shortcuts\n\n### Notes\n- **New note**: `Cmd/Ctrl + Shift + N`\n- **Search**: `Cmd/Ctrl + K`\n- **Pin/Unpin note**: `Cmd/Ctrl + Shift + P`\n- **Change note type**: `Cmd/Ctrl + Shift + M`\n- **Focus title**: `Cmd/Ctrl + E`\n- **Toggle preview**: `Cmd/Ctrl + Shift + E`\n\n### Views\n- **Inbox**: `Cmd/Ctrl + 1`\n- **Daily**: `Cmd/Ctrl + 2`\n- **Review**: `Cmd/Ctrl + 3`\n- **Routines**: `Cmd/Ctrl + 4`\n- **Note Types**: `Cmd/Ctrl + 5`\n- **Settings**: `Cmd/Ctrl + 6`\n\n### Panels\n- **Toggle sidebar**: `Cmd/Ctrl + B`\n- **Toggle AI agent**: `Cmd/Ctrl + Shift + A`\n- **Toggle shelf**: `Cmd/Ctrl + Shift + L`\n\n### Files\n- **New deck**: `Cmd/Ctrl + Shift + D`\n- **Switch vault**: `Cmd/Ctrl + Shift + O`\n- **Show in Finder/Explorer**: `Cmd/Ctrl + Shift + R`\n\n### Editing\n- **Undo**: `Cmd/Ctrl + Z`\n- **Redo**: `Cmd/Ctrl + Shift + Z`\n\n## Markdown\n\n- **Bold**: `**text**`\n- **Italic**: `*text*`\n- **Heading 1**: `# Title`\n- **Heading 2**: `## Title`\n- **Heading 3**: `### Title`\n- **Bullet list**: `- item`\n- **Numbered list**: `1. item`\n- **Checkbox**: `- [ ] task`\n- **Code inline**: `\\`code\\``\n- **Code block**: `\\`\\`\\`language`\n- **Link**: `[text](url)`\n- **Wikilink**: `[[Note Title]]`\n\n## Wikilinks\n\n- Type `[[` to open autocomplete\n- `[[Note Title]]` links to existing or creates new\n- `[[Note Title|Display Text]]` for custom display\n- Backlinks appear in the right sidebar\n- Rename a note â all links update automatically\n\n## AI Agent\n\n**Open**: `Cmd/Ctrl + Shift + A`\n\nCommon commands:\n- "Create a [type] note about X"\n- "Find notes about X"\n- "Summarize notes from [time period]"\n- "Suggest wikilinks for this note"\n- "Enable review for this note"\n- "What have I written about X?"\n\n## Review System\n\n- **Enable**: Click Review button or ask the agent\n- **Open queue**: `Cmd/Ctrl + 3`\n- **Flow**: AI challenge â answer from memory â rate confidence\n- **Why**: Active recall builds lasting knowledge\n\n## Daily Notes\n\n- **Open**: `Cmd/Ctrl + 2`\n- **Navigate**: `[` prev week, `]` next week, `T` today\n- **Use for**: Capture, journal, time-anchored notes\n',N0=[{id:"philosophy-quickstart",name:"Philosophy + Quick Start",description:"Understand Flint fast: philosophy and essentials",icon:"ð§­",notes:[{title:"The Deep Knowledge Cycle",content:BR},{title:"Getting Started with Flint",content:Jxe,pinned:!0}]},{id:"complete-guide",name:"Complete Guide",description:"Comprehensive tutorials for all key features",icon:"ð",notes:[{title:"Welcome to Flint",content:eke,pinned:!0},{title:"The Deep Knowledge Cycle",content:BR},{title:"Tutorial: Notes and Connections",content:tke},{title:"Tutorial: The AI Agent",content:nke},{title:"Tutorial: Daily Notes",content:rke},{title:"Tutorial: Review System",content:ike}]},{id:"quick-reference",name:"Quick Reference",description:"All shortcuts and syntax in one card",icon:"â¡",notes:[{title:"Quick Reference Card",content:ske}]}];function oke(n){return D0.find(e=>e.id===n)}function ake(n){return N0.find(e=>e.id===n)}function lke(n,e){return n.replace(/\{\{type:([^}]+)\}\}/g,(t,r)=>{const i=e[r];return i?`[[${i}|${r}]]`:r})}async function cke(n){const e=oke(n);if(!e||e.id==="empty")return;for(const r of e.workspaces)TS({name:r.name,icon:r.icon});const t={};for(const r of e.noteTypes){const i=hb({name:r.name,purpose:r.purpose,icon:r.icon,properties:r.properties});t[r.name]=i}for(const r of e.notes){const i=r.typeName?t[r.typeName]:void 0,s=lke(r.content,t),o=await zs({title:r.title,content:s,type:i,props:r.props});r.pinned&&Kp({type:"note",id:o})}}async function uke(n){const e={};for(const t of n){const r=ake(t);if(r)for(const i of r.notes){if(e[i.title])continue;const s=await zs({title:i.title,content:i.content});e[i.title]=!0,i.pinned&&Kp({type:"note",id:s})}}}async function gU(n,e,t){const r=p5(n,e);if(await Ah(r.id),e){const i=Zo();await cb(i,r)}return await cke(t.templateId),await uke(t.onboardingIds),r}function dke(){return window.api?.automergeSync}async function Wb(n,e,t,r,i){const s=dke();if(s?.writeFileToFilesystem)try{await s.writeFileToFilesystem({fileType:e,hash:t,data:r,extension:i?.extension,metadata:i?.metadata,baseDirectory:n})}catch(o){console.warn(`[Migration] Failed to sync ${e} to filesystem:`,o)}}let ni=j(null),hk=j(!1);function TT(){return u(ni)}function mU(){return window.api?.legacyMigration}function hke(){return sc().map(n=>({baseDirectory:n.baseDirectory}))}async function fke(){const n=mU();if(!n)return console.warn("[Migration] Legacy migration API not available"),[];try{return await n.detectLegacyVaults({existingVaults:hke()})}catch(e){return console.error("[Migration] Failed to detect legacy vaults:",e),[]}}function pke(n){return n.length<4?!1:n[0]===80&&n[1]===75&&n[2]===3&&n[3]===4}function gke(n){return n.length<4?!1:n[0]===37&&n[1]===80&&n[2]===68&&n[3]===70}async function mke(n,e){let t;if(n instanceof Uint8Array)t=new Uint8Array(n.length),t.set(n);else if(typeof n=="object"&&n!==null&&typeof n.length=="number"){const i=n.length;t=new Uint8Array(i);for(let s=0;s<i;s++)t[s]=n[s]}else throw new Error("Invalid EPUB file data format");if(!pke(t)){const i=Array.from(t.slice(0,20)).map(s=>s.toString(16).padStart(2,"0")).join(" ");throw console.error(`[Migration] EPUB data does not appear to be a valid ZIP file. First 20 bytes: ${i}`),new Error("EPUB data is not a valid ZIP file")}const r=await Vu.store(t.buffer);return await Wb(e,"epub",r,t),r}async function vke(n,e){let t;if(n instanceof Uint8Array)t=new Uint8Array(n.length),t.set(n);else if(typeof n=="object"&&n!==null&&typeof n.length=="number"){const i=n.length;t=new Uint8Array(i);for(let s=0;s<i;s++)t[s]=n[s]}else throw new Error("Invalid PDF file data format");if(!gke(t)){const i=Array.from(t.slice(0,20)).map(s=>s.toString(16).padStart(2,"0")).join(" ");throw console.error(`[Migration] PDF data does not appear to be a valid PDF file. First 20 bytes: ${i}`),new Error("PDF data is not a valid PDF file")}const r=await Hu.store(t.buffer);return await Wb(e,"pdf",r,t),r}function yke(n,e,t,r,i){const s=n.notes[e];s&&(s.props={...s.props,epubHash:t},r.title!==void 0&&(s.props.epubTitle=r.title),r.author!==void 0&&(s.props.epubAuthor=r.author),i?.currentCfi&&(s.props.currentCfi=i.currentCfi),i?.progress!==void 0&&(s.props.progress=i.progress))}function bke(n,e,t,r,i){const s=n.notes[e];s&&(s.props={...s.props,pdfHash:t},r.title!==void 0&&(s.props.pdfTitle=r.title),r.author!==void 0&&(s.props.pdfAuthor=r.author),i?.currentPage!==void 0&&(s.props.currentPage=i.currentPage),i?.progress!==void 0&&(s.props.progress=i.progress))}async function wke(n,e,t){if(!n||n.length===0)throw new Error("Webpage HTML content is empty");const r=await Fa.store(n),i=new TextEncoder;return await Wb(e,"webpage",r,i.encode(n),{metadata:t}),r}function _ke(n,e,t,r){const i=n.notes[e];i&&(i.props={...i.props,webpageHash:t},r.title!==void 0&&(i.props.webpageTitle=r.title),r.url!==void 0&&(i.props.webpageUrl=r.url),r.siteName!==void 0&&(i.props.webpageSiteName=r.siteName),r.author!==void 0&&(i.props.webpageAuthor=r.author))}async function Oke(n,e,t){let r;if(n instanceof Uint8Array)r=new Uint8Array(n.length),r.set(n);else if(typeof n=="object"&&n!==null&&typeof n.length=="number"){const s=n.length;r=new Uint8Array(s);for(let o=0;o<s;o++)r[o]=n[o]}else throw new Error("Invalid image file data format");const i=await vc.store(r.buffer,e);return await Wb(t,"image",i.shortHash,r,{extension:i.extension}),{shortHash:i.shortHash,extension:i.extension}}function xke(n,e){const t=/!\[([^\]]*)\]\((attachments\/images\/([^)]+))\)/g;return n.replace(t,(r,i,s,o)=>{const a=e[o];return a?`![${i}](${a})`:r})}function kke(n,e){for(const t of Object.keys(n.notes)){const r=n.notes[t];r.content&&(r.content=xke(r.content,e))}}function Ske(n,e,t){const r=n.create(),i={},s={};for(const[o,a]of Object.entries(e.notes)){const l=n.create({noteId:o,content:a.content||""});i[o]=l.url,o4(t,o,l.url);const{content:c,...d}=a;s[o]=d}return r.change(o=>{o.notes=s,o.contentUrls=i,o.workspaces=e.workspaces,o.activeWorkspaceId=e.activeWorkspaceId,o.noteTypes=e.noteTypes,e.workspaceOrder&&(o.workspaceOrder=e.workspaceOrder),e.agentRoutines&&Object.keys(e.agentRoutines).length>0&&(o.agentRoutines=e.agentRoutines)}),{docUrl:r.url}}function Tke(n,e,t,r){return{id:n,name:e,docUrl:t,baseDirectory:r,archived:!1,created:Wt()}}function Ake(n){return["detecting","extracting","transforming","writing","complete","error"].includes(n)?n:"transforming"}function Cke(n){return{entity:["note","noteType","workspace","reviewItem","epub","agentRoutine"].includes(n.entity)?n.entity:"note",entityId:n.entityId,message:n.message}}async function L0(n,e,t){const r=mU();if(!r)return{success:!1,errors:[{entity:"note",entityId:"migration",message:"Migration API not available"}]};b(hk,!0),b(ni,{phase:"detecting",message:"Starting migration...",current:0,total:5},!0);const i=[];try{r.onMigrationProgress(_=>{b(ni,{phase:Ake(_.phase),message:_.message,current:_.current,total:_.total,details:_.details},!0)}),b(ni,{phase:"extracting",message:"Extracting data from legacy vault...",current:1,total:5},!0);const s=await r.getMigrationDocumentData({vaultPath:n});if(!s)return{success:!1,errors:[{entity:"note",entityId:"migration",message:"Failed to extract vault data"}]};const o=s.document,a=s.epubFiles,l=s.pdfFiles||[],c=s.webpageFiles||[],d=s.errors.map(Cke);if(i.push(...d),a.length>0){b(ni,{phase:"transforming",message:`Storing ${a.length} EPUB files...`,current:2,total:5,details:{epubs:a.length}},!0);for(let _=0;_<a.length;_++){const x=a[_];b(ni,{phase:"transforming",message:`Storing EPUB ${_+1} of ${a.length}...`,current:2,total:5,details:{epubs:a.length}},!0);try{if(!x.fileData||x.fileData.length===0){i.push({entity:"epub",entityId:x.noteId,message:`EPUB file data is empty: ${x.filePath}`});continue}const k=await mke(x.fileData,n);yke(o,x.noteId,k,x.metadata,x.readingState)}catch(k){i.push({entity:"epub",entityId:x.noteId,message:`Failed to store EPUB: ${k instanceof Error?k.message:String(k)}`})}}}if(l.length>0){b(ni,{phase:"transforming",message:`Storing ${l.length} PDF files...`,current:2,total:5,details:{epubs:a.length}},!0);for(let _=0;_<l.length;_++){const x=l[_];b(ni,{phase:"transforming",message:`Storing PDF ${_+1} of ${l.length}...`,current:2,total:5,details:{epubs:a.length}},!0);try{if(!x.fileData||x.fileData.length===0){i.push({entity:"epub",entityId:x.noteId,message:`PDF file data is empty: ${x.filePath}`});continue}const k=await vke(x.fileData,n);bke(o,x.noteId,k,x.metadata,x.readingState)}catch(k){i.push({entity:"epub",entityId:x.noteId,message:`Failed to store PDF: ${k instanceof Error?k.message:String(k)}`})}}}if(c.length>0){b(ni,{phase:"transforming",message:`Storing ${c.length} webpage files...`,current:2,total:5,details:{epubs:a.length}},!0);for(let _=0;_<c.length;_++){const x=c[_];b(ni,{phase:"transforming",message:`Storing webpage ${_+1} of ${c.length}...`,current:2,total:5,details:{epubs:a.length}},!0);try{if(!x.htmlContent||x.htmlContent.length===0){i.push({entity:"epub",entityId:x.noteId,message:`Webpage file content is empty: ${x.filePath}`});continue}const k=await wke(x.htmlContent,n,x.metadata);_ke(o,x.noteId,k,x.metadata)}catch(k){i.push({entity:"epub",entityId:x.noteId,message:`Failed to store webpage: ${k instanceof Error?k.message:String(k)}`})}}}const h=s.imageFiles||[],f={};if(h.length>0){b(ni,{phase:"transforming",message:`Storing ${h.length} image files...`,current:2,total:5,details:{epubs:a.length}},!0);for(let _=0;_<h.length;_++){const x=h[_];b(ni,{phase:"transforming",message:`Storing image ${_+1} of ${h.length}...`,current:2,total:5,details:{epubs:a.length}},!0);try{if(!x.fileData||x.fileData.length===0)continue;const k=await Oke(x.fileData,x.extension,n);f[x.filename]=`opfs://images/${k.shortHash}.${k.extension}`}catch(k){i.push({entity:"epub",entityId:x.filename,message:`Failed to store image: ${k instanceof Error?k.message:String(k)}`})}}kke(o,f)}b(ni,{phase:"writing",message:"Creating Automerge document...",current:3,total:5},!0);const p=Zk(),g=Zo(),{docUrl:m}=Ske(g,o,p);b(ni,{phase:"writing",message:"Saving vault...",current:4,total:5},!0);const v=Tke(p,e,m,n),y=sc();y.push(v),Ou(y),pS(p);const O=o.agentRoutines?Object.keys(o.agentRoutines).length:0;return b(ni,{phase:"complete",message:"Migration complete!",current:5,total:5,details:{noteTypes:Object.keys(o.noteTypes).length,notes:Object.keys(o.notes).length,workspaces:Object.keys(o.workspaces).length,epubs:a.length,agentRoutines:O}},!0),{success:!0,vault:v,stats:{noteTypes:Object.keys(o.noteTypes).length,notes:Object.keys(o.notes).length,epubs:a.length,pdfs:l.length,webpages:c.length,decks:0,dailyNotes:0,workspaces:Object.keys(o.workspaces).length,reviewItems:0,agentRoutines:O,images:h.length,skipped:0},errors:i}}catch(s){return b(ni,{phase:"error",message:`Migration failed: ${s instanceof Error?s.message:String(s)}`,current:0,total:0},!0),{success:!1,errors:[{entity:"note",entityId:"migration",message:s instanceof Error?s.message:String(s)},...i]}}finally{b(hk,!1);try{r?.removeMigrationListeners()}catch{}}}function ph(){b(ni,null),b(hk,!1)}function On(){return typeof window<"u"&&!!window.api}function cc(){return!On()}var Eke=P('<div class="progress-bar-container svelte-16fqweu"><div class="progress-bar svelte-16fqweu"></div></div> <p class="progress-count svelte-16fqweu"> </p>',1),Pke=P('<div class="progress-section svelte-16fqweu"><p class="progress-phase svelte-16fqweu"> </p> <!></div>'),Ike=P('<p class="progress-phase svelte-16fqweu">Preparing...</p>'),Mke=P('<div class="migration-overlay svelte-16fqweu"><div class="migration-modal svelte-16fqweu"><div class="migration-spinner svelte-16fqweu">ð¥</div> <h3 class="svelte-16fqweu"> </h3> <!></div></div>'),Rke=P('<div class="error-overlay svelte-16fqweu"><div class="error-modal svelte-16fqweu"><h3 class="svelte-16fqweu">Import Failed</h3> <p> </p> <button class="dismiss-button svelte-16fqweu">Dismiss</button></div></div>'),Dke=P('<button class="legacy-vault-item svelte-16fqweu"><span class="vault-icon svelte-16fqweu">ð</span> <div class="vault-info svelte-16fqweu"><span class="vault-name svelte-16fqweu"> </span> <span class="vault-path svelte-16fqweu"> </span></div> <span class="import-icon svelte-16fqweu">â</span></button>'),Nke=P('<button class="secondary-action svelte-16fqweu"><span class="button-icon svelte-16fqweu">ð</span> Open Vault from Directory</button>'),Lke=P('<button class="secondary-action svelte-16fqweu"><span class="button-icon svelte-16fqweu">â¨</span> Create New Vault</button>'),Qke=P('<div class="sync-directory-selected svelte-16fqweu"><span class="sync-path svelte-16fqweu"> </span> <button class="sync-clear-btn svelte-16fqweu" title="Remove sync folder">â</button></div>'),$ke=P('<button class="secondary-action-small svelte-16fqweu">Choose Folder...</button>'),Fke=P('<button type="button"><span class="template-icon svelte-16fqweu"> </span> <span class="template-name svelte-16fqweu"> </span> <span class="template-desc svelte-16fqweu"> </span></button>'),zke=P('<label><input type="checkbox" class="svelte-16fqweu"/> <span class="option-icon svelte-16fqweu"> </span> <div class="option-text svelte-16fqweu"><span class="option-name svelte-16fqweu"> </span> <span class="option-desc svelte-16fqweu"> </span></div></label>'),Bke=P('<div class="error-message svelte-16fqweu"> </div>'),Uke=P('<span class="button-icon svelte-16fqweu">â³</span> Creating...',1),jke=P('<span class="button-icon svelte-16fqweu">ð</span> Create Vault',1),Vke=P('<div class="divider svelte-16fqweu"><span>or start fresh</span></div> <div class="vault-form svelte-16fqweu"><label for="vault-name-legacy" class="form-label svelte-16fqweu">New Vault Name</label> <input id="vault-name-legacy" type="text" class="vault-name-input svelte-16fqweu" placeholder="Enter vault name..." maxlength="50"/> <div class="sync-directory-section svelte-16fqweu"><span class="form-label-secondary svelte-16fqweu">Sync to folder (optional)</span> <!></div> <div class="template-section svelte-16fqweu"><span class="form-label svelte-16fqweu">Choose a template</span> <div class="template-options svelte-16fqweu"></div></div> <div class="onboarding-section svelte-16fqweu"><span class="form-label svelte-16fqweu">Include starter content (optional)</span> <div class="onboarding-options svelte-16fqweu"></div></div> <!> <button class="primary-action svelte-16fqweu"><!></button></div>',1),qke=P('<div class="vault-section svelte-16fqweu"><h2 class="svelte-16fqweu">Import Your Vaults</h2> <p class="section-description svelte-16fqweu">We found existing vaults from a previous version of Flint. Click to import:</p> <div class="legacy-vault-list svelte-16fqweu"></div></div> <div class="divider svelte-16fqweu"><span>or</span></div> <div class="action-buttons svelte-16fqweu"><!> <!></div> <!>',1),Hke=P('<div class="sync-directory-selected svelte-16fqweu"><span class="sync-path svelte-16fqweu"> </span> <button class="sync-clear-btn svelte-16fqweu" title="Remove sync folder">â</button></div>'),Zke=P('<button class="secondary-action-small svelte-16fqweu">Choose Folder...</button>'),Wke=P('<button type="button"><span class="template-icon svelte-16fqweu"> </span> <span class="template-name svelte-16fqweu"> </span> <span class="template-desc svelte-16fqweu"> </span></button>'),Xke=P('<label><input type="checkbox" class="svelte-16fqweu"/> <span class="option-icon svelte-16fqweu"> </span> <div class="option-text svelte-16fqweu"><span class="option-name svelte-16fqweu"> </span> <span class="option-desc svelte-16fqweu"> </span></div></label>'),Yke=P('<div class="error-message svelte-16fqweu"> </div>'),Gke=P('<span class="button-icon svelte-16fqweu">â³</span> Creating...',1),Kke=P('<span class="button-icon svelte-16fqweu">ð</span> Create Vault',1),Jke=P('<div class="divider svelte-16fqweu"><span>or</span></div> <div class="action-buttons svelte-16fqweu"><button class="secondary-action svelte-16fqweu"><span class="button-icon svelte-16fqweu">ð</span> Open Vault from Directory</button></div>',1),eSe=P(`<div class="vault-explanation svelte-16fqweu"><h2 class="svelte-16fqweu">Get Started with Your First Vault</h2> <p class="svelte-16fqweu">A <strong>vault</strong> is a collection of notes stored locally in your browser.
            Think of it as your personal knowledge workspace where all your notes, ideas, and
            thoughts are organized and interconnected.</p> <div class="features-list svelte-16fqweu"><div class="feature svelte-16fqweu"><span class="feature-icon svelte-16fqweu">ð</span> <div class="feature-text svelte-16fqweu"><strong class="svelte-16fqweu">Smart Linking:</strong> Connect your thoughts with automatic wikilinks</div></div> <div class="feature svelte-16fqweu"><span class="feature-icon svelte-16fqweu">ð</span> <div class="feature-text svelte-16fqweu"><strong class="svelte-16fqweu">Powerful Search:</strong> Find anything across all your notes instantly</div></div> <div class="feature svelte-16fqweu"><span class="feature-icon svelte-16fqweu">ð¾</span> <div class="feature-text svelte-16fqweu"><strong class="svelte-16fqweu">Local First:</strong> Your notes are stored locally and work offline</div></div> <div class="feature svelte-16fqweu"><span class="feature-icon svelte-16fqweu">ð</span> <div class="feature-text svelte-16fqweu"><strong class="svelte-16fqweu">Flexible Types:</strong> Organize notes with custom types and structures</div></div></div></div> <div class="vault-form svelte-16fqweu"><label for="vault-name" class="form-label svelte-16fqweu">Vault Name</label> <input id="vault-name" type="text" class="vault-name-input svelte-16fqweu" placeholder="Enter vault name..." maxlength="50"/> <div class="sync-directory-section svelte-16fqweu"><span class="form-label-secondary svelte-16fqweu">Sync to folder (optional)</span> <!></div> <div class="template-section svelte-16fqweu"><span class="form-label svelte-16fqweu">Choose a template</span> <div class="template-options svelte-16fqweu"></div></div> <div class="onboarding-section svelte-16fqweu"><span class="form-label svelte-16fqweu">Include starter content (optional)</span> <div class="onboarding-options svelte-16fqweu"></div></div> <!> <button class="primary-action svelte-16fqweu"><!></button></div> <!>`,1),tSe=P('<div class="first-time-container svelte-16fqweu"><div class="welcome-content svelte-16fqweu"><div class="header svelte-16fqweu"><div class="logo-section svelte-16fqweu"><h1 class="svelte-16fqweu">Welcome to Flint</h1></div> <p class="subtitle svelte-16fqweu">Your intelligent note-taking companion</p></div> <!> <!> <div class="main-content svelte-16fqweu"><!></div></div></div>');function nSe(n,e){lt(e,!0);let t=et(e,"legacyVaults",19,()=>[]);const r=le(()=>On()&&t().length>0),i=On();let s=j(!1),o=j(null),a=j(null);const l=le(TT),c=le($xe),d=le(Bxe),h=le(()=>u(d)?{...u(d),current:0,total:0}:u(c)||u(l));let f=j("My Notes"),p=j(null),g=j(!1),m=j(null),v=j(!1),y=j("empty"),O=j(Qt(["welcome"]));async function _(L){b(s,!0),b(o,L.name,!0),b(a,null);try{const q=await L0(L.path,L.name);if(q.success&&q.vault)await Ah(),e.onVaultCreated();else{const ue=q.errors?.[0]?.message??"Migration failed for unknown reason";b(a,ue,!0),console.error("Migration failed:",q.errors)}}catch(q){b(a,q instanceof Error?q.message:String(q),!0),console.error("Migration error:",q)}finally{b(s,!1),b(o,null),ph()}}async function x(){if(On())try{const L=await window.api?.legacyMigration.browseForVault();if(!L)return;const q=await window.api?.automergeImport.detectAutomergeVault({dirPath:L});if(q?.isValid){await k(q);return}const ue=await window.api?.legacyMigration.detectLegacyVaultAtPath({vaultPath:L,existingVaults:[]});if(ue){await _({id:"",name:ue.name,path:ue.path});return}const oe=await window.api?.markdownImport.detectMarkdownDirectory({dirPath:L});if(oe){await S(oe);return}q&&!q.isValid?b(a,q.error||"Invalid Flint vault",!0):b(a,"The selected directory doesn't contain a Flint vault or markdown files")}catch(L){b(a,L instanceof Error?L.message:String(L),!0),console.error("Browse error:",L)}}async function k(L){b(s,!0),b(o,L.name,!0),b(a,null);try{const q=await Vxe(L.path,L.name);q.success&&q.vault?e.onVaultCreated():(b(a,q.error??"Import failed for unknown reason",!0),console.error("Automerge import failed:",q.error))}catch(q){b(a,q instanceof Error?q.message:String(q),!0),console.error("Automerge import error:",q)}finally{b(s,!1),b(o,null),Uxe()}}async function S(L){b(s,!0),b(o,L.name,!0),b(a,null);try{const q=await pU(L.path,L.name);if(q.success&&q.vault)await Ah(),e.onVaultCreated();else{const ue=q.errors?.[0]?.message??"Import failed for unknown reason";b(a,ue,!0),console.error("Markdown import failed:",q.errors)}}catch(q){b(a,q instanceof Error?q.message:String(q),!0),console.error("Markdown import error:",q)}finally{b(s,!1),b(o,null),Fxe()}}function E(){b(a,null)}async function R(){const L=await gS();L&&b(p,L,!0)}function C(L){u(O).includes(L)?b(O,u(O).filter(q=>q!==L),!0):b(O,[...u(O),L],!0)}async function I(){if(!u(f).trim()){b(m,"Please enter a vault name");return}b(g,!0),b(m,null);try{await gU(u(f).trim(),u(p)??void 0,{templateId:u(y),onboardingIds:u(O)}),e.onVaultCreated()}catch(L){console.error("Failed to create vault:",L),b(m,L instanceof Error?L.message:"Failed to create vault",!0)}finally{b(g,!1)}}function D(L){L.key==="Enter"&&(L.preventDefault(),I())}var Q=tSe(),M=w(Q),N=A(w(M),2);{var B=L=>{var q=Mke(),ue=w(q),oe=A(w(ue),2),fe=w(oe),be=A(oe,2);{var De=he=>{var se=Pke(),V=w(se),ne=w(V),ee=A(V,2);{var U=X=>{var ie=Eke(),ye=Ie(ie),pe=w(ye),de=A(ye,2),we=w(de);Y(()=>{gn(pe,`width: ${u(h).current/u(h).total*100}%`),J(we,`${u(h).current??""} / ${u(h).total??""}`)}),T(X,ie)};z(ee,X=>{u(h).total>0&&X(U)})}Y(()=>J(ne,u(h).message)),T(he,se)},Le=he=>{var se=Ike();T(he,se)};z(be,he=>{u(h)?he(De):he(Le,!1)})}Y(()=>J(fe,`Importing ${u(o)??""}...`)),T(L,q)};z(N,L=>{u(s)&&L(B)})}var H=A(N,2);{var F=L=>{var q=Rke(),ue=w(q),oe=A(w(ue),2),fe=w(oe),be=A(oe,2);be.__click=E,Y(()=>J(fe,u(a))),T(L,q)};z(H,L=>{u(a)&&L(F)})}var Z=A(H,2),$=w(Z);{var W=L=>{var q=qke(),ue=Ie(q),oe=A(w(ue),4);Tt(oe,21,t,ne=>ne.path,(ne,ee)=>{var U=Dke();U.__click=()=>_(u(ee));var X=A(w(U),2),ie=w(X),ye=w(ie),pe=A(ie,2),de=w(pe);Y(()=>{U.disabled=u(s),J(ye,u(ee).name),J(de,u(ee).path)}),T(ne,U)});var fe=A(ue,4),be=w(fe);{var De=ne=>{var ee=Nke();ee.__click=x,Y(()=>ee.disabled=u(s)),T(ne,ee)};z(be,ne=>{i&&ne(De)})}var Le=A(be,2);{var he=ne=>{var ee=Lke();ee.__click=()=>b(v,!0),Y(()=>ee.disabled=u(s)),T(ne,ee)};z(Le,ne=>{u(v)||ne(he)})}var se=A(fe,2);{var V=ne=>{var ee=Vke(),U=A(Ie(ee),2),X=A(w(U),2);X.__keydown=D;var ie=A(X,2),ye=A(w(ie),2);{var pe=Me=>{var Pe=Qke(),ae=w(Pe),te=w(ae),re=A(ae,2);re.__click=()=>b(p,null),Y(()=>{Pt(ae,"title",u(p)),J(te,u(p)),re.disabled=u(g)}),T(Me,Pe)},de=Me=>{var Pe=$ke();Pe.__click=R,Y(()=>Pe.disabled=u(g)),T(Me,Pe)};z(ye,Me=>{u(p)?Me(pe):Me(de,!1)})}var we=A(ie,2),me=A(w(we),2);Tt(me,21,()=>D0,Me=>Me.id,(Me,Pe)=>{var ae=Fke();let te;ae.__click=()=>b(y,u(Pe).id,!0);var re=w(ae),ve=w(re),Te=A(re,2),Ne=w(Te),ce=A(Te,2),Oe=w(ce);Y(()=>{te=Ue(ae,1,"template-card svelte-16fqweu",null,te,{selected:u(y)===u(Pe).id}),ae.disabled=u(g),J(ve,u(Pe).icon),J(Ne,u(Pe).name),J(Oe,u(Pe).description)}),T(Me,ae)});var Ee=A(we,2),_e=A(w(Ee),2);Tt(_e,21,()=>N0,Me=>Me.id,(Me,Pe)=>{var ae=zke();let te;var re=w(ae);re.__change=()=>C(u(Pe).id);var ve=A(re,2),Te=w(ve),Ne=A(ve,2),ce=w(Ne),Oe=w(ce),Qe=A(ce,2),We=w(Qe);Y(st=>{te=Ue(ae,1,"onboarding-option svelte-16fqweu",null,te,{disabled:u(g)}),zo(re,st),re.disabled=u(g),J(Te,u(Pe).icon),J(Oe,u(Pe).name),J(We,u(Pe).description)},[()=>u(O).includes(u(Pe).id)]),T(Me,ae)});var Ae=A(Ee,2);{var ze=Me=>{var Pe=Bke(),ae=w(Pe);Y(()=>J(ae,u(m))),T(Me,Pe)};z(Ae,Me=>{u(m)&&Me(ze)})}var Be=A(Ae,2);Be.__click=I;var Se=w(Be);{var Re=Me=>{var Pe=Uke();T(Me,Pe)},He=Me=>{var Pe=jke();T(Me,Pe)};z(Se,Me=>{u(g)?Me(Re):Me(He,!1)})}Y(Me=>{X.disabled=u(g),Be.disabled=Me},[()=>u(g)||!u(f).trim()]),Un(X,()=>u(f),Me=>b(f,Me)),T(ne,ee)};z(se,ne=>{u(v)&&ne(V)})}T(L,q)},G=L=>{var q=eSe(),ue=A(Ie(q),2),oe=A(w(ue),2);oe.__keydown=D;var fe=A(oe,2),be=A(w(fe),2);{var De=me=>{var Ee=Hke(),_e=w(Ee),Ae=w(_e),ze=A(_e,2);ze.__click=()=>b(p,null),Y(()=>{Pt(_e,"title",u(p)),J(Ae,u(p)),ze.disabled=u(g)}),T(me,Ee)},Le=me=>{var Ee=Zke();Ee.__click=R,Y(()=>Ee.disabled=u(g)),T(me,Ee)};z(be,me=>{u(p)?me(De):me(Le,!1)})}var he=A(fe,2),se=A(w(he),2);Tt(se,21,()=>D0,me=>me.id,(me,Ee)=>{var _e=Wke();let Ae;_e.__click=()=>b(y,u(Ee).id,!0);var ze=w(_e),Be=w(ze),Se=A(ze,2),Re=w(Se),He=A(Se,2),Me=w(He);Y(()=>{Ae=Ue(_e,1,"template-card svelte-16fqweu",null,Ae,{selected:u(y)===u(Ee).id}),_e.disabled=u(g),J(Be,u(Ee).icon),J(Re,u(Ee).name),J(Me,u(Ee).description)}),T(me,_e)});var V=A(he,2),ne=A(w(V),2);Tt(ne,21,()=>N0,me=>me.id,(me,Ee)=>{var _e=Xke();let Ae;var ze=w(_e);ze.__change=()=>C(u(Ee).id);var Be=A(ze,2),Se=w(Be),Re=A(Be,2),He=w(Re),Me=w(He),Pe=A(He,2),ae=w(Pe);Y(te=>{Ae=Ue(_e,1,"onboarding-option svelte-16fqweu",null,Ae,{disabled:u(g)}),zo(ze,te),ze.disabled=u(g),J(Se,u(Ee).icon),J(Me,u(Ee).name),J(ae,u(Ee).description)},[()=>u(O).includes(u(Ee).id)]),T(me,_e)});var ee=A(V,2);{var U=me=>{var Ee=Yke(),_e=w(Ee);Y(()=>J(_e,u(m))),T(me,Ee)};z(ee,me=>{u(m)&&me(U)})}var X=A(ee,2);X.__click=I;var ie=w(X);{var ye=me=>{var Ee=Gke();T(me,Ee)},pe=me=>{var Ee=Kke();T(me,Ee)};z(ie,me=>{u(g)?me(ye):me(pe,!1)})}var de=A(ue,2);{var we=me=>{var Ee=Jke(),_e=A(Ie(Ee),2),Ae=w(_e);Ae.__click=x,Y(()=>Ae.disabled=u(g)),T(me,Ee)};z(de,me=>{i&&me(we)})}Y(me=>{oe.disabled=u(g),X.disabled=me},[()=>u(g)||!u(f).trim()]),Un(oe,()=>u(f),me=>b(f,me)),T(L,q)};z($,L=>{u(r)?L(W):L(G,!1)})}T(n,Q),ct()}yt(["click","keydown","change"]);const rSe=n=>n;function iSe(n){const e=n-1;return e*e*e+1}function UR(n){const e=typeof n=="string"&&n.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[n,"px"]}function jR(n,{delay:e=0,duration:t=400,easing:r=rSe}={}){const i=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:r,css:s=>`opacity: ${s*i}`}}function fk(n,{delay:e=0,duration:t=400,easing:r=iSe,x:i=0,y:s=0,opacity:o=0}={}){const a=getComputedStyle(n),l=+a.opacity,c=a.transform==="none"?"":a.transform,d=l*(1-o),[h,f]=UR(i),[p,g]=UR(s);return{delay:e,duration:t,easing:r,css:(m,v)=>`
			transform: ${c} translate(${(1-m)*h}${f}, ${(1-m)*p}${g});
			opacity: ${l-d*v}`}}var sSe=P('<span class="badge svelte-nwu7xc"> </span>'),oSe=P('<span class="badge svelte-nwu7xc"> </span>'),aSe=P('<span class="badge svelte-nwu7xc"> </span>'),lSe=P('<div class="system-views"><div class="system-nav svelte-nwu7xc"><button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-nwu7xc"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path></svg> Inbox <!></button> <button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-nwu7xc"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg> Daily</button> <button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-nwu7xc"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg> Review <!></button> <button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-nwu7xc"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"></path></svg> Routines <!></button> <button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-nwu7xc"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"></path></svg> Note Types</button> <button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-nwu7xc"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg> Settings</button></div></div>');function cSe(n,e){lt(e,!0);const t=le(Q5),r=le(L5),i=le(()=>u(r)?u(t).dueThisSession:0),s=le(zJ),o=le(()=>F5().length);function a(Q){e.onSystemViewSelect(Q)}var l=lSe(),c=w(l),d=w(c);let h;d.__click=()=>a("inbox");var f=A(w(d),2);{var p=Q=>{var M=sSe(),N=w(M);Y(()=>J(N,u(s))),T(Q,M)};z(f,Q=>{u(s)>0&&Q(p)})}var g=A(d,2);let m;g.__click=()=>a("daily");var v=A(g,2);let y;v.__click=()=>a("review");var O=A(w(v),2);{var _=Q=>{var M=oSe(),N=w(M);Y(()=>J(N,u(i))),T(Q,M)};z(O,Q=>{u(i)>0&&Q(_)})}var x=A(v,2);let k;x.__click=()=>a("routines");var S=A(w(x),2);{var E=Q=>{var M=aSe(),N=w(M);Y(()=>J(N,u(o))),T(Q,M)};z(S,Q=>{u(o)>0&&Q(E)})}var R=A(x,2);let C;R.__click=()=>a("types");var I=A(R,2);let D;I.__click=()=>a("settings"),Y(()=>{h=Ue(d,1,"nav-item svelte-nwu7xc",null,h,{active:e.activeSystemView==="inbox"}),m=Ue(g,1,"nav-item svelte-nwu7xc",null,m,{active:e.activeSystemView==="daily"}),y=Ue(v,1,"nav-item svelte-nwu7xc",null,y,{active:e.activeSystemView==="review"}),k=Ue(x,1,"nav-item svelte-nwu7xc",null,k,{active:e.activeSystemView==="routines"}),C=Ue(R,1,"nav-item svelte-nwu7xc",null,C,{active:e.activeSystemView==="types"}),D=Ue(I,1,"nav-item svelte-nwu7xc",null,D,{active:e.activeSystemView==="settings"})}),T(n,l),ct()}yt(["click"]);function uSe(n){return!n.includes("[[")||!n.includes("]]")?n:n.replace(/\[\[([^\]]+)\]\]/g,(e,t)=>{const r=t.indexOf("|");if(r!==-1)return t.substring(r+1).trim();{const i=t.trim();return Zn(i)?.title||i}})}var dSe=P('<button class="inline-wikilink svelte-1dw8x6g" type="button"> </button>'),hSe=P('<span class="wikilink-text svelte-1dw8x6g"></span>');function vU(n,e){lt(e,!0);function t(d){const h=[],f=/\[\[([^\]]+)\]\]/g;let p=0,g;for(;(g=f.exec(d))!==null;){g.index>p&&h.push({type:"text",content:d.slice(p,g.index)});const m=g[1],v=m.indexOf("|");let y,O;v!==-1?(y=m.substring(0,v).trim(),O=m.substring(v+1).trim()):(y=m.trim(),O=Zn(y)?.title||y),h.push({type:"link",content:O,noteId:y,displayText:O}),p=f.lastIndex}return p<d.length&&h.push({type:"text",content:d.slice(p)}),h.length>0?h:[{type:"text",content:d}]}const r=le(()=>e.text.includes("[[")&&e.text.includes("]]")),i=le(()=>u(r)?t(e.text):null);function s(d,h){h.preventDefault(),h.stopPropagation(),e.onNoteClick?.(d)}var o=Ve(),a=Ie(o);{var l=d=>{var h=hSe();Tt(h,21,()=>u(i),Sl,(f,p)=>{var g=Ve(),m=Ie(g);{var v=O=>{var _=dSe();_.__click=k=>s(u(p).noteId,k);var x=w(_);Y(()=>{Pt(_,"title",u(p).displayText),J(x,u(p).content)}),T(O,_)},y=O=>{var _=Tr();Y(()=>J(_,u(p).content)),T(O,_)};z(m,O=>{u(p).type==="link"?O(v):O(y,!1)})}T(f,g)}),T(d,h)},c=d=>{var h=Tr();Y(()=>J(h,e.text)),T(d,h)};z(a,d=>{u(i)?d(l):d(c,!1)})}T(n,o),ct()}yt(["click"]);var fSe=P('<div><span class="empty-pinned-text svelte-oik3rb">Drag items here to pin</span></div>'),pSe=P('<button class="clear-all svelte-oik3rb"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="down-arrow svelte-oik3rb"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="7,14 12,19 17,14"></polyline></svg> close all</button>'),gSe=P('<div class="separator-container"><div class="separator-row svelte-oik3rb"><div class="separator-line svelte-oik3rb"></div> <!></div> <button class="new-note-btn svelte-oik3rb"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-oik3rb"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> New Note</button></div>'),mSe=kn('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>'),vSe=P('<span class="emoji-icon svelte-oik3rb"> </span>'),ySe=P('<button class="close-item svelte-oik3rb" aria-label="Remove from recent"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>'),bSe=P('<div role="button" tabindex="0" draggable="true" data-sidebar-item=""><div class="item-content svelte-oik3rb"><div class="item-icon svelte-oik3rb"><!></div> <span> </span></div> <button class="more-button svelte-oik3rb" aria-label="More options"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="5" cy="12" r="1"></circle><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle></svg></button> <!></div>'),wSe=kn('<line x1="2" y1="2" x2="22" y2="22"></line>'),_Se=P('<button class="context-menu-item svelte-oik3rb" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-oik3rb"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> <span class="menu-item-label svelte-oik3rb">Close</span></button>'),OSe=P('<button class="context-menu-item svelte-oik3rb" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-oik3rb"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg> <span class="menu-item-label svelte-oik3rb"> </span></button>'),xSe=P('<button class="context-menu-item svelte-oik3rb" role="menuitem"><span class="workspace-emoji svelte-oik3rb"> </span> <span class="menu-item-label svelte-oik3rb"> </span></button>'),kSe=P('<div class="context-submenu svelte-oik3rb" role="menu"></div>'),SSe=P('<div class="context-menu-divider svelte-oik3rb"></div> <div class="context-menu-item has-submenu svelte-oik3rb" role="menuitem" tabindex="0"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-oik3rb"><path d="M3 3h7v7H3z"></path><path d="M14 3h7v7h-7z"></path><path d="M14 14h7v7h-7z"></path><path d="M3 14h7v7H3z"></path></svg> <span class="menu-item-label svelte-oik3rb">Move to Workspace</span> <svg class="submenu-arrow svelte-oik3rb" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg> <!></div>',1),TSe=P('<div class="context-menu svelte-oik3rb" role="menu"><button class="context-menu-item svelte-oik3rb" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-oik3rb"><path d="M12 17v5"></path><path d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z"></path><!></svg> <span class="menu-item-label svelte-oik3rb"> </span></button> <button class="context-menu-item svelte-oik3rb" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-oik3rb"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg> <span class="menu-item-label svelte-oik3rb"> </span></button> <!> <button class="context-menu-item svelte-oik3rb" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-oik3rb"><polyline points="21 8 21 21 3 21 3 8"></polyline><rect x="1" y="3" width="22" height="5"></rect><line x1="10" y1="12" x2="14" y2="12"></line></svg> <span class="menu-item-label svelte-oik3rb"> </span></button> <!> <!></div>'),ASe=P('<div class="sidebar-items svelte-oik3rb"><div class="section-label svelte-oik3rb">Pinned</div> <div role="list"><!> <!></div></div> <!>',1);function CSe(n,e){lt(e,!0);const t=le($C),r=le(LC),i=le(O5);let s=j(null);tt(()=>{const ae=u(r).length;u(s)!==null&&ae>u(s)&&fl().then(()=>{const te=u(y)?.closest(".sidebar-content");te&&te.scrollTo({top:te.scrollHeight,behavior:"smooth"})}),b(s,ae,!0)});const o=le(()=>{const ae=[];return u(t).forEach((te,re)=>{ae.push({type:"item",item:te,section:"pinned",sectionIndex:re})}),ae.push({type:"separator"}),u(r).forEach((te,re)=>{ae.push({type:"item",item:te,section:"recent",sectionIndex:re})}),ae}),a=le(()=>u(t).length);let l=j(null),c=j(null),d=j(null),h=j(null),f=j(0),p=j(0),g=j(0),m=j(!1);const v=200;let y=j(void 0);const O=new Image;O.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";let _=j(!1),x=j(null),k=j(null),S=j(null),E=j(Qt({x:0,y:0})),R=j(void 0),C=j(void 0);tt(()=>{if(u(_)&&u(R)){const ae=u(R).getBoundingClientRect(),te=8;let{x:re,y:ve}=u(E),Te=!1;ae.right>window.innerWidth-te&&(re=window.innerWidth-ae.width-te,Te=!0),ae.bottom>window.innerHeight-te&&(ve=window.innerHeight-ae.height-te,Te=!0),re<te&&(re=te,Te=!0),ve<te&&(ve=te,Te=!0),Te&&b(E,{x:re,y:ve},!0)}}),tt(()=>{if(u(pe)&&u(C)&&u(R)){const ae=u(C).getBoundingClientRect(),te=8;if(ae.right>window.innerWidth-te?(u(C).style.left="auto",u(C).style.right="100%",u(C).style.marginLeft="0",u(C).style.marginRight="0.25rem"):(u(C).style.left="100%",u(C).style.right="auto",u(C).style.marginLeft="0.25rem",u(C).style.marginRight="0"),ae.bottom>window.innerHeight-te){const re=ae.bottom-(window.innerHeight-te);u(C).style.top=`${-re}px`}else u(C).style.top="0"}});function I(ae){e.onItemSelect(ae)}function D(ae,te){te.stopPropagation(),Nw({type:ae.type,id:ae.id})}function Q(){for(const ae of u(r))Nw({type:ae.type,id:ae.id})}async function M(){const ae=await zs({});e.onItemSelect({type:"note",id:ae,title:"",icon:"ð",updated:Wt()})}function N(ae){return u(i)?.type===ae.type&&u(i)?.id===ae.id}function B(ae,te,re){b(l,te,!0),b(c,re.id,!0),b(d,re.type,!0),b(h,te,!0),b(f,0);const ve=ae.target.closest("[data-sidebar-item]");ve&&b(g,ve.offsetHeight,!0),b(p,ae.clientY,!0),ae.dataTransfer&&(ae.dataTransfer.effectAllowed="move",ae.dataTransfer.setData("text/plain",`${re.type}:${re.id}`),ae.dataTransfer.setDragImage(O,0,0)),document.addEventListener("drag",H)}function H(ae){u(l)!==null&&ae.clientY!==0&&(b(f,ae.clientY-u(p)),F())}function F(){if(u(l)===null||!u(y))return;const ae=u(g)*.2,te=(u(l)+.5)*u(g)+u(f);let re;if(u(f)>0){const ve=te+u(g)/2;re=Math.floor((ve-ae)/u(g))}else if(u(f)<0){const ve=te-u(g)/2;re=Math.floor((ve+ae)/u(g))}else re=u(l);if(re=Math.max(0,Math.min(u(o).length-1,re)),u(a)===0&&u(l)>u(a)&&(u(l)+.5)*u(g)+u(f)-u(g)/2<u(a)*u(g)+u(g)*.8){b(h,0);return}if(u(a),u(l)>u(a)&&re<=u(a)){const ve=(u(l)+.5)*u(g)+u(f)-u(g)/2,Te=Math.floor((te+ae)/u(g));Te<0?re=0:Te>=u(a)?re=u(a):re=Te,ve>=(u(a)+.8)*u(g)&&(re=u(a)+1)}if(u(l)<u(a)&&re>=u(a)){const ve=(u(l)+.5)*u(g)+u(f)+u(g)/2,Te=Math.floor((te-ae)/u(g));Te<=u(a)?re=u(a):Te>=u(o).length?re=u(o).length-1:re=Te,ve<=(u(a)+.2)*u(g)&&(re=u(a)-1)}re<0&&(re=0),re>u(o).length-1&&(re=u(o).length-1),b(h,re,!0)}function Z(ae){ae.preventDefault(),!(u(l)===null||!u(y))&&(b(f,ae.clientY-u(p)),F())}function $(ae){if(ae.dataTransfer?.dropEffect==="none"){b(m,!1),L();return}G()}function W(ae){ae.preventDefault(),G()}async function G(){if(u(l)===null||u(h)===null||u(c)===null||u(d)===null){L();return}const ae=u(l),te=u(h),re=u(c),ve=u(d),Te={type:ve,id:re};if(ae===te){L();return}const Ne=ae<u(a),ce=te<u(a)||te===u(a)&&ae>u(a),Oe=u(f),Qe=new Map;for(let it=0;it<u(o).length;it++){const Ct=u(o)[it];if(Ct.type==="separator")continue;let bt=it;it===ae?bt=te:ae<te&&it>ae&&it<=te?bt=it-1:ae>te&&it>=te&&it<ae&&(bt=it+1),Qe.set(`${Ct.item.type}:${Ct.item.id}`,bt)}b(m,!0);const We=setTimeout(()=>{b(m,!1),L()},v+500);if(L(),Ne&&ce)FC(ae,te);else if(!Ne&&!ce){const it=ae-u(a)-1,Ct=te-u(a)-1;QC(it,Ct)}else if(Ne&&!ce){const it=te-u(a);if(Bv(Te),it>0){await fl();const Ct=LC().length;it<Ct&&QC(0,it)}}else{const it=te;Kp(Te),await fl();const Ct=$C().length;it<Ct-1&&FC(Ct-1,it)}if(await fl(),!u(y)){b(m,!1);return}const st=u(y).querySelectorAll("[data-sidebar-item]");st.forEach(it=>{const Ct=it.dataset.itemId,bt=it.dataset.itemType;if(!Ct||!bt)return;const xt=`${bt}:${Ct}`,mt=Array.from(st).indexOf(it),Ge=mt>=u(a)?mt+1:mt;let Xe;if(Ct===re&&bt===ve)Xe=(ae-Ge)*u(g)+Oe;else{const ft=Qe.get(xt);if(ft===void 0)return;Xe=(ft-Ge)*u(g)}it.style.transition="none",it.style.transform=Xe!==0?`translateY(${Xe}px)`:""}),u(y).offsetHeight,u(y).style.pointerEvents="none",st.forEach(it=>{it.style.transition=`transform ${v}ms cubic-bezier(0.2, 0, 0, 1)`,it.style.transform=""}),setTimeout(()=>{clearTimeout(We),st.forEach(it=>{it.style.transition=""}),u(y)&&(u(y).style.pointerEvents=""),b(m,!1)},v)}function L(){if(b(l,null),b(c,null),b(d,null),b(h,null),b(f,0),document.removeEventListener("drag",H),u(y)){u(y).querySelectorAll("[data-sidebar-item]").forEach(re=>{re.style.transform="",re.style.transition=""});const te=u(y).querySelector(".separator-container");te&&(te.style.transform="",te.style.transition=""),u(y).style.pointerEvents=""}}function q(ae){if(!u(m)&&!(u(l)===null||u(h)===null)){if(ae===u(l))return`translateY(${u(f)}px)`;if(u(l)<u(h)){if(ae>u(l)&&ae<=u(h))return`translateY(-${u(g)}px)`}else if(ae>=u(h)&&ae<u(l))return`translateY(${u(g)}px)`}}function ue(ae){return u(l)===ae}const oe=le(()=>u(l)!==null&&u(h)!==null&&(u(l)<u(a)&&u(h)>u(a)||u(l)<u(a)&&u(h)===u(a)||u(l)>u(a)&&u(h)<u(a)||u(l)>u(a)&&u(h)===u(a)));function fe(ae,te,re){ae.preventDefault(),b(x,te.id,!0),b(k,te.type,!0),b(S,re,!0);const ve=160,Te=120,Ne=8;let ce=ae.clientX,Oe=ae.clientY;ce+ve+Ne>window.innerWidth&&(ce=window.innerWidth-ve-Ne),Oe+Te+Ne>window.innerHeight&&(Oe=window.innerHeight-Te-Ne),ce=Math.max(Ne,ce),Oe=Math.max(Ne,Oe),b(E,{x:ce,y:Oe},!0),b(_,!0)}function be(){b(_,!1),b(x,null),b(k,null),b(S,null),b(pe,!1)}function De(ae){u(_)&&(ae.target.closest(".context-menu")||be())}function Le(ae){ae.key==="Escape"&&u(_)&&be()}function he(){if(!u(x)||!u(k))return;const ae={type:u(k),id:u(x)};u(S)==="pinned"?Bv(ae):Kp(ae),be()}function se(){!u(x)||!u(k)||(u(k)==="note"?u(U)?yO(u(x)):Ch(u(x)):u(k)==="conversation"&&(u(U)?yJ(u(x)):E5(u(x))),be())}function V(){if(!u(x)||!u(k))return;const ae={type:u(k),id:u(x)};u(S)==="pinned"?Bv(ae):Nw(ae),be()}const ne=le(()=>{if(!u(x)||u(k)!=="note")return!1;const ae=Zn(u(x));return!(!ae||ae.archived||Hg(ae)!=="markdown"||ae.type===Gl)}),ee=le(()=>!u(x)||u(k)!=="note"?!1:Dy(u(x))?.enabled??!1),U=le(()=>!u(x)||!u(k)?!1:u(k)==="note"?Zn(u(x))?.archived??!1:xu(u(x))?.archived??!1),X=le(()=>!u(x)||!u(k)?!1:CS(u(k),u(x))),ie=le(Gp),ye=le(ki);let pe=j(!1);function de(){!u(x)||!u(k)||(u(X)?I5(u(k),u(x)):P5(u(k),u(x)),be())}function we(ae){!u(x)||!u(k)||(nJ({type:u(k),id:u(x)},ae),be())}function me(){!u(x)||u(k)!=="note"||(u(ee)?MS(u(x)):IS(u(x)),be())}function Ee(ae,te,re){ae.stopPropagation(),ae.preventDefault(),b(x,te.id,!0),b(k,te.type,!0),b(S,re,!0);const Te=ae.currentTarget.getBoundingClientRect(),Ne=160,ce=120,Oe=8;let Qe=Te.right+Oe,We=Te.top;Qe+Ne+Oe>window.innerWidth&&(Qe=Te.left-Ne-Oe),Qe<Oe&&(Qe=Oe),We+ce+Oe>window.innerHeight&&(We=window.innerHeight-ce-Oe),We=Math.max(Oe,We),b(E,{x:Qe,y:We},!0),b(_,!0)}var _e=ASe();It("click",Na,De),It("keydown",Na,Le);var Ae=Ie(_e),ze=A(w(Ae),2);let Be;var Se=w(ze);{var Re=ae=>{var te=fSe();let re;Y(()=>re=Ue(te,1,"empty-pinned-area always-visible svelte-oik3rb",null,re,{highlight:u(oe)})),T(ae,te)};z(Se,ae=>{u(t).length===0&&ae(Re)})}var He=A(Se,2);Tt(He,19,()=>u(o),ae=>ae.type==="separator"?"separator":`${ae.item.type}:${ae.item.id}`,(ae,te,re)=>{var ve=Ve(),Te=Ie(ve);{var Ne=Oe=>{var Qe=gSe();let We;var st=w(Qe),it=A(w(st),2);{var Ct=xt=>{var mt=pSe();mt.__click=Q,T(xt,mt)};z(it,xt=>{u(r).length>0&&xt(Ct)})}var bt=A(st,2);bt.__click=M,Y(xt=>We=gn(Qe,"",We,xt),[()=>({transform:q(u(re))})]),T(Oe,Qe)},ce=Oe=>{var Qe=bSe();let We;Qe.__click=()=>I(u(te).item),Qe.__contextmenu=_t=>fe(_t,u(te).item,u(te).section),Qe.__keydown=_t=>_t.key==="Enter"&&I(u(te).item);let st;var it=w(Qe),Ct=w(it),bt=w(Ct);{var xt=_t=>{var wt=mSe();T(_t,wt)},mt=_t=>{var wt=vSe(),Rt=w(wt);Y(()=>J(Rt,u(te).item.icon)),T(_t,wt)};z(bt,_t=>{u(te).item.type==="conversation"?_t(xt):_t(mt,!1)})}var Ge=A(Ct,2);let Xe;var ft=w(Ge),at=A(it,2);at.__click=_t=>Ee(_t,u(te).item,u(te).section);var pt=A(at,2);{var dt=_t=>{var wt=ySe();wt.__click=Rt=>D(u(te).item,Rt),T(_t,wt)};z(pt,_t=>{u(te).section==="recent"&&_t(dt)})}Y((_t,wt,Rt)=>{We=Ue(Qe,1,"sidebar-item svelte-oik3rb",null,We,_t),Pt(Qe,"data-item-id",u(te).item.id),Pt(Qe,"data-item-type",u(te).item.type),st=gn(Qe,"",st,wt),Xe=Ue(Ge,1,"item-title svelte-oik3rb",null,Xe,{"untitled-text":u(te).item.metadata?.isPreview}),J(ft,Rt)},[()=>({active:N(u(te).item),dragging:ue(u(re)),pinned:u(te).section==="pinned",archived:u(te).item.metadata?.archived}),()=>({transform:q(u(re))}),()=>uSe(u(te).item.title)]),It("dragstart",Qe,_t=>B(_t,u(re),u(te).item)),It("dragend",Qe,$),T(Oe,Qe)};z(Te,Oe=>{u(te).type==="separator"?Oe(Ne):Oe(ce,!1)})}T(ae,ve)}),qt(ze,ae=>b(y,ae),()=>u(y));var Me=A(Ae,2);{var Pe=ae=>{var te=TSe(),re=w(te);re.__click=he;var ve=w(re),Te=A(w(ve),2);{var Ne=pt=>{var dt=wSe();T(pt,dt)};z(Te,pt=>{u(S)==="pinned"&&pt(Ne)})}var ce=A(ve,2),Oe=w(ce),Qe=A(re,2);Qe.__click=de;var We=A(w(Qe),2),st=w(We),it=A(Qe,2);{var Ct=pt=>{var dt=_Se();dt.__click=V,T(pt,dt)};z(it,pt=>{u(S)==="recent"&&pt(Ct)})}var bt=A(it,2);bt.__click=se;var xt=A(w(bt),2),mt=w(xt),Ge=A(bt,2);{var Xe=pt=>{var dt=OSe();dt.__click=me;var _t=A(w(dt),2),wt=w(_t);Y(()=>J(wt,u(ee)?"Disable Review":"Enable Review")),T(pt,dt)};z(Ge,pt=>{u(ne)&&pt(Xe)})}var ft=A(Ge,2);{var at=pt=>{var dt=SSe(),_t=A(Ie(dt),2),wt=A(w(_t),6);{var Rt=Et=>{var $t=kSe();Tt($t,21,()=>u(ie),jt=>jt.id,(jt,Kt)=>{var Zt=Ve(),Nt=Ie(Zt);{var Yt=ln=>{var Je=xSe();Je.__click=()=>we(u(Kt).id);var ge=w(Je),Ze=w(ge),ht=A(ge,2),Jt=w(ht);Y(()=>{J(Ze,u(Kt).icon||"ð"),J(Jt,u(Kt).name)}),T(ln,Je)};z(Nt,ln=>{u(Kt).id!==u(ye)?.id&&ln(Yt)})}T(jt,Zt)}),qt($t,jt=>b(C,jt),()=>u(C)),T(Et,$t)};z(wt,Et=>{u(pe)&&Et(Rt)})}It("mouseenter",_t,()=>b(pe,!0)),It("mouseleave",_t,()=>b(pe,!1)),T(pt,dt)};z(ft,pt=>{u(ie).length>1&&pt(at)})}qt(te,pt=>b(R,pt),()=>u(R)),Y(()=>{gn(te,`left: ${u(E).x??""}px; top: ${u(E).y??""}px;`),J(Oe,u(S)==="pinned"?"Unpin":"Pin"),J(st,u(X)?"Remove from Shelf":"Add to Shelf"),J(mt,u(U)?"Unarchive":"Archive")}),T(ae,te)};z(Me,ae=>{u(_)&&ae(Pe)})}Y(()=>Be=Ue(ze,1,"items-list svelte-oik3rb",null,Be,{"is-dragging":u(l)!==null})),It("dragover",ze,Z),It("drop",ze,W),T(n,_e),ct()}yt(["click","contextmenu","keydown"]);var ESe=P('<button draggable="true" data-workspace-item=""> </button>'),PSe=P('<button class="add-workspace-button svelte-vgaj4p" aria-label="Add"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></button>'),ISe=P('<button class="add-menu-item svelte-vgaj4p"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-vgaj4p"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg> <span class="add-menu-label svelte-vgaj4p">New Note</span> <span class="add-menu-shortcut svelte-vgaj4p"> </span></button>'),MSe=P('<button class="add-menu-item svelte-vgaj4p"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-vgaj4p"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg> <span class="add-menu-label svelte-vgaj4p">New Deck</span> <span class="add-menu-shortcut svelte-vgaj4p"></span></button>'),RSe=P('<button class="add-menu-item svelte-vgaj4p"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-vgaj4p"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg> <span class="add-menu-label svelte-vgaj4p">Capture webpage</span> <span class="add-menu-shortcut svelte-vgaj4p"></span></button>'),DSe=P('<div class="add-menu svelte-vgaj4p"><!> <!> <button class="add-menu-item svelte-vgaj4p"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-vgaj4p"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg> <span class="add-menu-label svelte-vgaj4p">New Workspace</span> <span class="add-menu-shortcut svelte-vgaj4p"></span></button> <div class="add-menu-separator svelte-vgaj4p"></div> <button class="add-menu-item svelte-vgaj4p"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-vgaj4p"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg> <span class="add-menu-label svelte-vgaj4p"> </span> <span class="add-menu-shortcut svelte-vgaj4p"></span></button> <!></div>'),NSe=P('<div class="workspace-popover svelte-vgaj4p"><h4 class="svelte-vgaj4p"> </h4> <div class="popover-form svelte-vgaj4p"><div class="form-row svelte-vgaj4p"><input type="text" class="icon-input svelte-vgaj4p" placeholder="Icon" maxlength="2"/> <input type="text" class="name-input svelte-vgaj4p" placeholder="Workspace name"/></div> <div class="form-actions svelte-vgaj4p"><button class="cancel-btn svelte-vgaj4p">Cancel</button> <button class="create-btn svelte-vgaj4p"> </button></div></div></div>'),LSe=P('<div class="context-menu svelte-vgaj4p" role="menu"><button class="context-menu-item svelte-vgaj4p" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-vgaj4p"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> Edit</button> <button class="context-menu-item danger svelte-vgaj4p" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-vgaj4p"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg> Delete</button></div>'),QSe=P('<div><div class="workspace-icons-container svelte-vgaj4p"><div class="workspace-icons svelte-vgaj4p" role="list"></div> <!></div> <!> <!> <!></div>');function $Se(n,e){lt(e,!0);let t=et(e,"showShadow",3,!1),r=j(!1);const s=navigator.platform.startsWith("Mac")?"â":"Ctrl",o=le(Gp),a=le(ki);let l=j(!1),c=j(null),d=j(""),h=j(""),f=j(!1),p=j(!1),g=j(null),m=j(Qt({x:0,y:0})),v=j(null),y=j(null),O=j(null),_=j(0),x=j(0),k=j(0),S=j(!1);const E=200,R=8;let C=j(void 0);const I=new Image;I.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function D(Se,Re){return Re<9?`${Se} (Ctrl+${Re+1})`:Se}function Q(Se){u(a)?.id!==Se&&Ry(Se)}function M(){b(f,!u(f))}function N(){b(f,!1)}function B(){N(),b(c,null),b(d,""),b(h,"ð"),b(l,!0)}function H(){N(),e.onCreateNote?.()}function F(){N(),e.onCreateDeck?.()}async function Z(){if(u(r))return;N();const Se=document.createElement("input");Se.type="file",Se.accept=".pdf,.epub,application/pdf,application/epub+zip",Se.onchange=async()=>{const Re=Se.files?.[0];if(Re){b(r,!0);try{const He=Re.name.toLowerCase().split(".").pop();He==="pdf"?await zQ(Re):He==="epub"&&await HQ(Re)}finally{b(r,!1)}}},Se.click()}function $(){N(),e.onCaptureWebpage?.()}function W(){b(l,!1),b(c,null),b(d,""),b(h,"")}function G(){u(d).trim()&&(TS({name:u(d).trim(),icon:u(h)||"ð"}),W())}function L(){!u(c)||!u(d).trim()||(v5(u(c),{name:u(d).trim(),icon:u(h)||"ð"}),W())}function q(Se,Re){Se.preventDefault(),b(g,Re,!0);const He=120,Me=80,Pe=8;let ae=Se.clientX,te=Se.clientY;ae+He+Pe>window.innerWidth&&(ae=window.innerWidth-He-Pe),te+Me+Pe>window.innerHeight&&(te=window.innerHeight-Me-Pe),ae=Math.max(Pe,ae),te=Math.max(Pe,te),b(m,{x:ae,y:te},!0),b(p,!0)}function ue(){b(p,!1),b(g,null)}function oe(){if(!u(g))return;const Se=u(o).find(Re=>Re.id===u(g));Se&&(b(c,Se.id,!0),b(d,Se.name,!0),b(h,Se.icon,!0),b(l,!0)),ue()}function fe(){u(g)&&(u(o).length>1&&y5(u(g)),ue())}function be(Se){const Re=Se.target;u(p)&&(Re.closest(".context-menu")||ue()),u(l)&&!Re.closest(".workspace-popover")&&!Re.closest(".add-workspace-button")&&!Re.closest(".add-menu")&&!Re.closest(".context-menu")&&W(),u(f)&&!Re.closest(".add-menu")&&!Re.closest(".add-workspace-button")&&N()}function De(Se){Se.key==="Escape"&&(u(p)&&ue(),u(l)&&W(),u(f)&&N())}function Le(Se,Re,He){b(v,Re,!0),b(y,He,!0),b(O,Re,!0),b(_,0);const Me=Se.target.closest("[data-workspace-item]");Me&&b(k,Me.offsetWidth+R),b(x,Se.clientX,!0),Se.dataTransfer&&(Se.dataTransfer.effectAllowed="move",Se.dataTransfer.setData("text/plain",He),Se.dataTransfer.setDragImage(I,0,0))}function he(Se){if(Se.preventDefault(),u(v)===null||!u(C))return;b(_,Se.clientX-u(x));const Re=u(C).getBoundingClientRect(),He=Se.clientX-Re.left+u(C).scrollLeft;let Me=Math.floor(He/u(k));Me=Math.max(0,Math.min(u(o).length-1,Me)),b(O,Me,!0)}function se(){ne()}function V(Se){Se.preventDefault(),ne()}async function ne(){if(u(v)===null||u(O)===null||u(y)===null){ee();return}const Se=u(v),Re=u(O);if(Se===Re){ee();return}const He=u(_),Me=new Map;for(let ae=0;ae<u(o).length;ae++){const te=u(o)[ae];let re=ae;ae===Se?re=Re:Se<Re&&ae>Se&&ae<=Re?re=ae-1:Se>Re&&ae>=Re&&ae<Se&&(re=ae+1),Me.set(te.id,re)}if(b(S,!0),ee(),rJ(Se,Re),await fl(),!u(C)){b(S,!1);return}const Pe=u(C).querySelectorAll("[data-workspace-item]");Pe.forEach(ae=>{const te=ae.dataset.workspaceId;if(!te)return;const re=Array.from(Pe).indexOf(ae);let ve;if(te===u(y))ve=(Se-re)*u(k)+He;else{const Te=Me.get(te);if(Te===void 0)return;ve=(Te-re)*u(k)}ae.style.transition="none",ae.style.transform=ve!==0?`translateX(${ve}px)`:""}),u(C).offsetHeight,u(C).style.pointerEvents="none",Pe.forEach(ae=>{ae.style.transition=`transform ${E}ms cubic-bezier(0.2, 0, 0, 1)`,ae.style.transform=""}),setTimeout(()=>{Pe.forEach(ae=>{ae.style.transition=""}),u(C)&&(u(C).style.pointerEvents=""),b(S,!1)},E)}function ee(){b(v,null),b(y,null),b(O,null),b(_,0)}function U(Se){if(!u(S)&&!(u(v)===null||u(O)===null)){if(Se===u(v))return`translateX(${u(_)}px)`;if(u(v)<u(O)){if(Se>u(v)&&Se<=u(O))return`translateX(-${u(k)}px)`}else if(Se>=u(O)&&Se<u(v))return`translateX(${u(k)}px)`}}function X(Se){return u(v)===Se}var ie=QSe();It("click",Na,be),It("keydown",Na,De);let ye;var pe=w(ie),de=w(pe);Tt(de,23,()=>u(o),Se=>Se.id,(Se,Re,He)=>{{let Me=le(()=>D(u(Re).name,u(He)));ur(Se,{get text(){return u(Me)},children:(Pe,ae)=>{var te=ESe();let re;te.__click=()=>Q(u(Re).id),te.__contextmenu=Ne=>q(Ne,u(Re).id);let ve;var Te=w(te);Y((Ne,ce)=>{re=Ue(te,1,"workspace-icon svelte-vgaj4p",null,re,Ne),Pt(te,"data-workspace-id",u(Re).id),ve=gn(te,"",ve,ce),J(Te,u(Re).icon)},[()=>({active:u(a)?.id===u(Re).id,dragging:X(u(He))}),()=>({transform:U(u(He))})]),It("dragstart",te,Ne=>Le(Ne,u(He),u(Re).id)),It("dragend",te,se),T(Pe,te)},$$slots:{default:!0}})}}),qt(de,Se=>b(C,Se),()=>u(C));var we=A(de,2);ur(we,{text:"Add",children:(Se,Re)=>{var He=PSe();He.__click=M,T(Se,He)},$$slots:{default:!0}});var me=A(pe,2);{var Ee=Se=>{var Re=DSe(),He=w(Re);{var Me=Oe=>{var Qe=ISe();Qe.__click=H;var We=A(w(Qe),4),st=w(We);Y(()=>J(st,`${s}â§N`)),T(Oe,Qe)};z(He,Oe=>{e.onCreateNote&&Oe(Me)})}var Pe=A(He,2);{var ae=Oe=>{var Qe=MSe();Qe.__click=F,T(Oe,Qe)};z(Pe,Oe=>{e.onCreateDeck&&Oe(ae)})}var te=A(Pe,2);te.__click=B;var re=A(te,4);re.__click=Z;var ve=A(w(re),2),Te=w(ve),Ne=A(re,2);{var ce=Oe=>{var Qe=RSe();Qe.__click=$,T(Oe,Qe)};z(Ne,Oe=>{e.onCaptureWebpage&&Oe(ce)})}Y(()=>{re.disabled=u(r),J(Te,u(r)?"Importing...":"Import file")}),T(Se,Re)};z(me,Se=>{u(f)&&Se(Ee)})}var _e=A(me,2);{var Ae=Se=>{var Re=NSe(),He=w(Re),Me=w(He),Pe=A(He,2),ae=w(Pe),te=w(ae),re=A(te,2);re.__keydown=Oe=>{Oe.key==="Enter"&&(u(c)?L():G())};var ve=A(ae,2),Te=w(ve);Te.__click=W;var Ne=A(Te,2);Ne.__click=function(...Oe){(u(c)?L:G)?.apply(this,Oe)};var ce=w(Ne);Y(Oe=>{J(Me,u(c)?"Edit Workspace":"New Workspace"),Ne.disabled=Oe,J(ce,u(c)?"Save":"Create")},[()=>!u(d).trim()]),Un(te,()=>u(h),Oe=>b(h,Oe)),Un(re,()=>u(d),Oe=>b(d,Oe)),T(Se,Re)};z(_e,Se=>{u(l)&&Se(Ae)})}var ze=A(_e,2);{var Be=Se=>{var Re=LSe(),He=w(Re);He.__click=oe;var Me=A(He,2);Me.__click=fe,Y(()=>{gn(Re,`left: ${u(m).x??""}px; top: ${u(m).y??""}px;`),Me.disabled=u(o).length<=1}),T(Se,Re)};z(ze,Se=>{u(p)&&Se(Be)})}Y(()=>ye=Ue(ie,1,"workspace-bar svelte-vgaj4p",null,ye,{shadow:t()})),It("dragover",de,he),It("drop",de,V),T(n,ie),ct()}yt(["click","contextmenu","keydown"]);var FSe=P('<div class="search-loading svelte-dsl53h"><span class="loading-spinner svelte-dsl53h"></span> Searching content...</div>'),zSe=P('<span class="content-match-badge svelte-dsl53h">Content</span>'),BSe=P('<div class="result-preview svelte-dsl53h"><!></div>'),USe=P('<div class="result-match-count svelte-dsl53h"> </div>'),jSe=P('<button><div class="result-icon svelte-dsl53h"> </div> <div class="result-content svelte-dsl53h"><div class="result-header svelte-dsl53h"><span class="result-title svelte-dsl53h"> </span> <!> <span class="result-type svelte-dsl53h"> </span></div> <!> <!></div></button>'),VSe=P('<div class="results-overflow svelte-dsl53h"> </div>'),qSe=P('<div class="no-results svelte-dsl53h">No matching notes found</div>'),HSe=P('<div class="search-results-container svelte-dsl53h"><!> <!> <!> <!></div>');function AT(n,e){lt(e,!0);let t=et(e,"maxResults",3,10),r=et(e,"selectedIndex",19,()=>-1),i=et(e,"isLoading",3,!1),s=new m0;function o(S,E){return s.set(E,S),{destroy(){s.delete(E)}}}tt(()=>{if(r()>=0){const S=s.get(r());S&&S.scrollIntoView({block:"nearest",behavior:"smooth"})}});function a(S){return"isContentMatch"in S}const l=le(()=>e.results.slice(0,t()));function c(S){return S.map(E=>E.highlight?`<mark class="search-highlight">${d(E.text)}</mark>`:d(E.text)).join("")}function d(S){return S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function h(S){if(S.contentMatches.length>0){const E=S.contentMatches[0],R=dge(E);return c(R)}return""}function f(S){return S.contentMatches.length>0}function p(S){const E=jr(S.note.type);return E?{icon:E.icon,name:E.name}:S.matchedType?{icon:S.matchedType.icon,name:S.matchedType.name}:{icon:"ð",name:"Note"}}var g=HSe(),m=w(g);{var v=S=>{var E=FSe();T(S,E)};z(m,S=>{i()&&S(v)})}var y=A(m,2);Tt(y,19,()=>u(l),S=>S.note.id,(S,E,R)=>{var C=jSe();let I;C.__click=()=>e.onSelect(u(E).note);var D=w(C),Q=w(D),M=A(D,2),N=w(M),B=w(N),H=w(B),F=A(B,2);{var Z=oe=>{var fe=zSe();T(oe,fe)};z(F,oe=>{a(u(E))&&u(E).isContentMatch&&oe(Z)})}var $=A(F,2),W=w($),G=A(N,2);{var L=oe=>{var fe=BSe(),be=w(fe);Fk(be,()=>h(u(E))),T(oe,fe)};z(G,oe=>{f(u(E))&&oe(L)})}var q=A(G,2);{var ue=oe=>{var fe=USe(),be=w(fe);Y(()=>J(be,`+${u(E).contentMatches.length-1} more match${u(E).contentMatches.length>2?"es":""}`)),T(oe,fe)};z(q,oe=>{u(E).contentMatches.length>1&&oe(ue)})}Hc(C,(oe,fe)=>o?.(oe,fe),()=>u(R)),Y((oe,fe)=>{I=Ue(C,1,"search-result-item svelte-dsl53h",null,I,{selected:u(R)===r()}),J(Q,oe),J(H,u(E).note.title||"Untitled"),J(W,fe)},[()=>p(u(E)).icon,()=>p(u(E)).name]),T(S,C)});var O=A(y,2);{var _=S=>{var E=VSe(),R=w(E);Y(()=>J(R,`Showing ${t()??""} of ${e.results.length??""} results`)),T(S,E)};z(O,S=>{e.results.length>t()&&S(_)})}var x=A(O,2);{var k=S=>{var E=qSe();T(S,E)};z(x,S=>{e.results.length===0&&S(k)})}T(n,g),ct()}yt(["click"]);var ZSe=P('<div role="separator" aria-orientation="vertical" aria-label="Resize sidebar" tabindex="0"></div>');function yU(n,e){lt(e,!0);let t=et(e,"minWidth",3,200),r=et(e,"maxWidth",3,800),i=j(!1),s=j(!1),o=j(0),a=j(0);function l(m){b(i,!0),b(o,m.clientX,!0);const y=m.currentTarget.closest(".left-sidebar, .right-sidebar");y&&b(a,y.offsetWidth,!0),document.addEventListener("mousemove",c),document.addEventListener("mouseup",d),document.body.style.cursor="col-resize",m.preventDefault()}function c(m){if(!u(i))return;const v=e.side==="left"?m.clientX-u(o):u(o)-m.clientX,y=Math.max(t(),Math.min(r(),u(a)+v));e.onResize(y)}function d(){b(i,!1),document.body.style.cursor="",document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",d)}function h(){b(s,!0)}function f(){u(i)||b(s,!1)}var p=ZSe();let g;p.__mousedown=l,p.__keydown=m=>{(m.key==="Enter"||m.key===" ")&&m.preventDefault()},Y(()=>g=Ue(p,1,"resize-handle svelte-ii2z1p",null,g,{left:e.side==="left",right:e.side==="right",visible:u(s)||u(i),resizing:u(i)})),It("mouseenter",p,h),It("mouseleave",p,f),T(n,p),ct()}yt(["mousedown","keydown"]);const WSe=[{label:"New Note",accelerator:"CmdOrCtrl+Shift+N",acceleratorWeb:"Ctrl+Shift+N",action:"new-note"},{label:"New Deck",accelerator:"CmdOrCtrl+Shift+D",acceleratorWeb:"Ctrl+Shift+D",action:"new-deck"},{label:"Import File...",action:"import-file"},{label:"Capture Webpage...",action:"import-webpage"},{label:"New Vault...",action:"new-vault"},{type:"separator"},{label:"Switch Vault",accelerator:"CmdOrCtrl+Shift+O",acceleratorWeb:"Ctrl+Shift+O",action:"switch-vault"},{type:"separator"},{label:"Show in Finder",labelWin:"Show in Explorer",accelerator:"CmdOrCtrl+Shift+R",action:"show-in-finder"}],XSe=[{label:"Undo",accelerator:"CmdOrCtrl+Z",role:"undo"},{label:"Redo",accelerator:"CmdOrCtrl+Shift+Z",role:"redo"},{type:"separator"},{label:"Cut",accelerator:"CmdOrCtrl+X",role:"cut"},{label:"Copy",accelerator:"CmdOrCtrl+C",role:"copy"},{label:"Paste",accelerator:"CmdOrCtrl+V",role:"paste"},{label:"Delete",role:"delete"},{type:"separator"},{label:"Select All",accelerator:"CmdOrCtrl+A",role:"selectAll"},{type:"separator"},{label:"Find",accelerator:"CmdOrCtrl+K",acceleratorWeb:"Ctrl+Shift+K",action:"find"}],YSe=[{label:"Inbox",accelerator:"CmdOrCtrl+1",acceleratorWeb:"Ctrl+Shift+1",action:"navigate:inbox"},{label:"Daily",accelerator:"CmdOrCtrl+2",acceleratorWeb:"Ctrl+Shift+2",action:"navigate:daily"},{label:"Review",accelerator:"CmdOrCtrl+3",acceleratorWeb:"Ctrl+Shift+3",action:"navigate:review"},{label:"Routines",accelerator:"CmdOrCtrl+4",acceleratorWeb:"Ctrl+Shift+4",action:"navigate:routines"},{label:"Note Types",accelerator:"CmdOrCtrl+5",acceleratorWeb:"Ctrl+Shift+5",action:"navigate:note-types"},{label:"Settings",accelerator:"CmdOrCtrl+6",acceleratorWeb:"Ctrl+Shift+6",action:"navigate:settings"},{type:"separator"},{label:"Toggle Sidebar",accelerator:"CmdOrCtrl+B",acceleratorWeb:"Ctrl+Shift+B",action:"toggle-sidebar"},{label:"Focus Title",accelerator:"CmdOrCtrl+E",acceleratorWeb:"Ctrl+Shift+T",action:"focus-title"},{label:"Toggle Preview/Edit",accelerator:"CmdOrCtrl+Shift+E",acceleratorWeb:"Ctrl+Shift+E",action:"toggle-preview"},{type:"separator"},{label:"Toggle Agent Panel",accelerator:"CmdOrCtrl+Shift+A",acceleratorWeb:"Ctrl+Shift+A",action:"toggle-agent"},{label:"Toggle Notes Shelf",accelerator:"CmdOrCtrl+Shift+L",acceleratorWeb:"Ctrl+Shift+L",action:"toggle-shelf"},{type:"separator"},{label:"Actual Size",accelerator:"CmdOrCtrl+0",role:"resetZoom"},{label:"Zoom In",accelerator:"CmdOrCtrl+=",role:"zoomIn"},{label:"Zoom Out",accelerator:"CmdOrCtrl+-",role:"zoomOut"},{type:"separator"},{label:"Toggle Full Screen",accelerator:"F11",role:"togglefullscreen"}],GSe=[{label:"New Workspace...",action:"new-workspace"},{label:"Edit Current Workspace...",action:"edit-workspace"},{label:"Delete Current Workspace",action:"delete-workspace"}],KSe=[{label:"Pin/Unpin Note",accelerator:"CmdOrCtrl+Shift+P",acceleratorWeb:"Ctrl+Shift+P",action:"toggle-pin"},{label:"Add to Shelf",action:"add-to-shelf"},{label:"Change Type",accelerator:"CmdOrCtrl+Shift+M",acceleratorWeb:"Ctrl+Shift+M",action:"change-type"},{type:"separator"},{label:"Enable/Disable Review",action:"toggle-review"},{type:"separator"},{label:"Archive",action:"archive-note"}],JSe=[{label:"What's New",action:"show-changelog"},{label:"Show Debug Logs in Finder",labelWin:"Show Debug Logs in Explorer",action:"show-debug-logs"},{label:"Toggle Developer Tools",action:"toggle-dev-tools"},{type:"separator"},{label:"Check for Updates...",action:"check-updates"},{type:"separator"},{label:"About",action:"show-about"}];function e2e(n,e){return e==="mac"?n.replace(/CmdOrCtrl/g,"Cmd").replace(/Ctrl\+/g,"â").replace(/Shift\+/g,"â§").replace(/Alt\+/g,"â¥"):n.replace(/CmdOrCtrl/g,"Ctrl")}function t2e(n,e){if(n.type!=="separator")return e==="web"&&n.acceleratorWeb?n.acceleratorWeb:n.accelerator}function n2e(n,e){return n.type==="separator"?"":n.labelWin?n.labelWin:n.label}var r2e=P("<button> </button>"),i2e=P('<div class="menu-separator svelte-1mrd5v7"></div>'),s2e=P('<span class="menu-item-shortcut svelte-1mrd5v7"> </span>'),o2e=P('<button class="menu-item svelte-1mrd5v7"><span class="menu-item-label svelte-1mrd5v7"> </span> <!></button>'),a2e=P('<div class="submenu svelte-1mrd5v7"></div>'),l2e=P('<div class="menu-dropdown svelte-1mrd5v7"><div class="menu-bar svelte-1mrd5v7"></div> <!></div>'),c2e=P('<div class="hamburger-menu svelte-1mrd5v7"><button aria-label="Menu"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg></button> <!></div>');function u2e(n,e){lt(e,!0);const t=le(()=>cc()?"web":"win");let r=j(!1),i=j(null),s=j(null),o=j(Qt({top:0,left:0}));const a=new Set(["show-in-finder","show-debug-logs","toggle-dev-tools","check-updates"]);function l(x){return cc()?x.filter(k=>k.type==="separator"?!0:!(k.action&&a.has(k.action)||k.role==="togglefullscreen")):x}function c(x){return x.filter((k,S,E)=>k.type!=="separator"?!0:!(S===0||S===E.length-1||E[S-1]?.type==="separator"))}const d=le(()=>[{id:"file",label:"File",items:WSe},{id:"edit",label:"Edit",items:XSe},{id:"view",label:"View",items:YSe},{id:"workspace",label:"Workspace",items:GSe},{id:"note",label:"Note",items:KSe},{id:"help",label:"Help",items:JSe}].map(x=>({...x,items:c(l(x.items))})));function h(){if(!u(r)&&u(s)){const x=u(s).getBoundingClientRect();b(o,{top:x.bottom+4,left:x.left},!0)}b(r,!u(r)),u(r)||b(i,null)}function f(){b(r,!1),b(i,null)}function p(x){b(i,x,!0)}function g(x){if(x.type!=="separator"){if(x.action)if(x.action.startsWith("navigate:")){const k=x.action.replace("navigate:","");On()?window.api?.triggerMenuNavigate(k):window.dispatchEvent(new CustomEvent("menu-navigate",{detail:{view:k}}))}else On()?window.api?.triggerMenuAction(x.action):window.dispatchEvent(new CustomEvent("menu-action",{detail:{action:x.action}}));if(x.role&&cc())switch(x.role){case"undo":document.execCommand("undo");break;case"cut":document.execCommand("cut");break;case"copy":document.execCommand("copy");break;case"paste":navigator.clipboard.readText().then(k=>{document.execCommand("insertText",!1,k)});break;case"delete":document.execCommand("delete");break;case"selectAll":document.execCommand("selectAll");break;case"resetZoom":case"zoomIn":case"zoomOut":window.dispatchEvent(new CustomEvent("menu-action",{detail:{action:x.role==="resetZoom"?"zoom-reset":x.role==="zoomIn"?"zoom-in":"zoom-out"}}));break}f()}}tt(()=>{if(!u(r))return;function x(k){k.target.closest(".hamburger-menu")||f()}return setTimeout(()=>{document.addEventListener("click",x)},10),()=>{document.removeEventListener("click",x)}}),tt(()=>{if(!u(r))return;function x(k){k.key==="Escape"&&f()}return document.addEventListener("keydown",x),()=>{document.removeEventListener("keydown",x)}});var m=c2e(),v=w(m);let y;v.__click=h,qt(v,x=>b(s,x),()=>u(s));var O=A(v,2);{var _=x=>{var k=l2e(),S=w(k);Tt(S,21,()=>u(d),C=>C.id,(C,I)=>{var D=r2e();let Q;D.__click=()=>p(u(I).id);var M=w(D);Y(()=>{Q=Ue(D,1,"menu-bar-item svelte-1mrd5v7",null,Q,{active:u(i)===u(I).id}),J(M,u(I).label)}),It("mouseenter",D,()=>p(u(I).id)),T(C,D)});var E=A(S,2);{var R=C=>{const I=le(()=>u(d).find(N=>N.id===u(i)));var D=Ve(),Q=Ie(D);{var M=N=>{var B=a2e();Tt(B,21,()=>u(I).items,Sl,(H,F)=>{var Z=Ve(),$=Ie(Z);{var W=L=>{var q=i2e();T(L,q)},G=L=>{const q=le(()=>t2e(u(F),u(t)));var ue=o2e();ue.__click=()=>g(u(F));var oe=w(ue),fe=w(oe),be=A(oe,2);{var De=Le=>{var he=s2e(),se=w(he);Y(V=>J(se,V),[()=>e2e(u(q),u(t))]),T(Le,he)};z(be,Le=>{u(q)&&Le(De)})}Y(Le=>J(fe,Le),[()=>n2e(u(F))]),T(L,ue)};z($,L=>{u(F).type==="separator"?L(W):L(G,!1)})}T(H,Z)}),T(N,B)};z(Q,N=>{u(I)&&N(M)})}T(C,D)};z(E,C=>{u(i)&&C(R)})}Y(()=>gn(k,`top: ${u(o).top??""}px; left: ${u(o).left??""}px;`)),T(x,k)};z(O,x=>{u(r)&&x(_)})}Y(()=>{y=Ue(v,1,"hamburger-button svelte-1mrd5v7",null,y,{open:u(r)}),Pt(v,"aria-expanded",u(r))}),T(n,m),ct()}yt(["click"]);const VR="flint-sidebar-state",qR={leftSidebar:{visible:!0,width:300,activeSection:"system"},rightSidebar:{visible:!1,width:400,mode:"ai",panelOpen:!1,activePanel:"chat"}};class d2e{#e=j(Qt(qR));get state(){return u(this.#e)}set state(e){b(this.#e,e,!0)}#t=j(!0);get isLoading(){return u(this.#t)}set isLoading(e){b(this.#t,e,!0)}#r=j(!1);get isInitialized(){return u(this.#r)}set isInitialized(e){b(this.#r,e,!0)}initializationPromise=null;constructor(){this.initializationPromise=this.initialize()}get leftSidebar(){return this.state.leftSidebar}get rightSidebar(){return this.state.rightSidebar}get loading(){return this.isLoading}get initialized(){return this.isInitialized}async ensureInitialized(){this.initializationPromise&&await this.initializationPromise}async initialize(){this.isLoading=!0;try{let e;if(On())e=await window.api?.loadAppSettings();else{const t=localStorage.getItem(VR);t&&(e={sidebarState:JSON.parse(t)})}e?.sidebarState&&(this.state={...qR,...e.sidebarState},this.state.rightSidebar.mode==="metadata"&&(this.state.rightSidebar.mode="ai"))}catch(e){console.warn("Failed to load sidebar state from storage:",e)}finally{this.isLoading=!1,this.isInitialized=!0,this.initializationPromise=null}}async saveToStorage(){await this.ensureInitialized();const e=dy(this.state);try{if(On()){const r={...await window.api?.loadAppSettings()||{},sidebarState:e};await window.api?.saveAppSettings(r)}else localStorage.setItem(VR,JSON.stringify(e))}catch(t){console.error("Failed to save sidebar state to storage:",t)}}async toggleLeftSidebar(){await this.ensureInitialized(),this.state.leftSidebar.visible=!this.state.leftSidebar.visible,await this.saveToStorage()}async toggleRightSidebar(){await this.ensureInitialized(),this.state.rightSidebar.visible=!this.state.rightSidebar.visible,await this.saveToStorage()}async setRightSidebarMode(e){await this.ensureInitialized(),this.state.rightSidebar.mode=e,await this.saveToStorage()}async setActiveSection(e){await this.ensureInitialized(),this.state.leftSidebar.activeSection=e,await this.saveToStorage()}async setLeftSidebarWidth(e){await this.ensureInitialized(),this.state.leftSidebar.width=e,await this.saveToStorage()}async setRightSidebarWidth(e){await this.ensureInitialized(),this.state.rightSidebar.width=e,await this.saveToStorage()}async setPanelOpen(e){await this.ensureInitialized(),this.state.rightSidebar.panelOpen=e,await this.saveToStorage()}async setActivePanel(e){await this.ensureInitialized(),this.state.rightSidebar.activePanel=e,await this.saveToStorage()}async openPanel(e){await this.ensureInitialized(),this.state.rightSidebar.panelOpen=!0,this.state.rightSidebar.activePanel=e,await this.saveToStorage()}async closePanel(){await this.ensureInitialized(),this.state.rightSidebar.panelOpen=!1,await this.saveToStorage()}async togglePanel(e){await this.ensureInitialized(),this.state.rightSidebar.panelOpen&&this.state.rightSidebar.activePanel===e?this.state.rightSidebar.panelOpen=!1:(this.state.rightSidebar.panelOpen=!0,this.state.rightSidebar.activePanel=e),await this.saveToStorage()}}const An=new d2e;var h2e=P('<div class="traffic-light-space svelte-55p5l2"></div>'),f2e=P('<span class="legacy-badge svelte-55p5l2" title="Click to import this vault">Import</span>'),p2e=P('<button class="archive-btn svelte-55p5l2" title="Archive vault"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="5" x="2" y="3" rx="1"></rect><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"></path><path d="m9.5 11 5 0"></path></svg></button>'),g2e=P('<div><button><svg class="vault-item-icon svelte-55p5l2" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2l5 0 2 3h9a2 2 0 0 1 2 2z"></path></svg> <span class="vault-item-name svelte-55p5l2"> </span> <!></button> <!></div>'),m2e=P('<div class="vault-dropdown svelte-55p5l2"><!> <div class="vault-dropdown-separator svelte-55p5l2"></div> <button class="vault-item new-vault-item svelte-55p5l2"><svg class="vault-item-icon svelte-55p5l2" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14"></path><path d="m5 12 14 0"></path></svg> <span class="vault-item-name svelte-55p5l2">New Vault</span></button></div>'),v2e=P('<button class="sidebar-toggle svelte-55p5l2" aria-label="Toggle sidebar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg></button>'),y2e=P('<div class="search-dropdown-header svelte-55p5l2">Recent</div>'),b2e=P('<button class="view-all-btn svelte-55p5l2"> </button>'),w2e=P("<!> <!> <!>",1),_2e=P('<div class="no-results-dropdown svelte-55p5l2"> </div>'),O2e=P('<div class="no-results-dropdown svelte-55p5l2">No recent notes</div>'),x2e=P('<div class="search-dropdown svelte-55p5l2"><!></div>'),k2e=P('<div class="workspace-content svelte-55p5l2"><!></div>'),S2e=P('<div><!> <div class="sidebar-inner svelte-55p5l2"><div class="sidebar-header svelte-55p5l2"><div class="header-row svelte-55p5l2"><!> <div class="hamburger-menu-container svelte-55p5l2"><!></div> <div class="vault-switcher svelte-55p5l2"><button><span class="vault-display svelte-55p5l2"><svg class="vault-icon svelte-55p5l2" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2l5 0 2 3h9a2 2 0 0 1 2 2z"></path></svg> <span class="vault-name svelte-55p5l2"> </span></span> <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"></path></svg></button> <!></div> <div class="header-spacer svelte-55p5l2"></div> <!></div> <div class="search-container svelte-55p5l2"><div><svg class="search-icon svelte-55p5l2" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg> <input id="search-input" type="text" class="search-input svelte-55p5l2" placeholder="Search notes... (âK)"/></div> <!></div></div> <div class="sidebar-content svelte-55p5l2"><!> <!></div> <!></div></div>');function T2e(n,e){lt(e,!0);let t=j(null),r=le(()=>u(t)??An.leftSidebar.width),i=null,s=j(1);const o=le(ki);e3(()=>{const U=u(o)?.id??null;i&&U&&i!==U&&b(s,1),i=U});let a=j(!1),l=j(null);function c(){if(u(l)){const{scrollTop:U,scrollHeight:X,clientHeight:ie}=u(l);b(a,U+ie<X-1)}}tt(()=>{if(!u(l))return;c();const U=new ResizeObserver(()=>{c()});return U.observe(u(l)),()=>{U.disconnect()}});function d(U){b(t,U,!0),h&&clearTimeout(h),h=setTimeout(()=>{An.setLeftSidebarWidth(U),b(t,null)},300)}let h=null,f=j(!1),p=j(null),g=j(Qt({top:0,left:0}));function m(){if(!u(f)&&u(p)){const U=u(p).getBoundingClientRect();b(g,{top:U.bottom+4,left:U.left},!0)}b(f,!u(f))}function v(){b(f,!1)}function y(U){e.onVaultSelect(U),v()}function O(U,X){if(X.stopPropagation(),U.id===e.activeVault?.id){if(e.vaults.length<=1)return;const ie=e.vaults.find(ye=>ye.id!==U.id);ie&&e.onVaultSelect(ie.id)}JK(U.id,{archived:!0}),v()}function _(){e.onCreateVault(),v()}tt(()=>{if(!u(f))return;function U(X){X.target.closest(".vault-switcher")||v()}return setTimeout(()=>{document.addEventListener("click",U)},10),()=>{document.removeEventListener("click",U)}});var x=S2e();let k;var S=w(x);yU(S,{side:"left",onResize:d,minWidth:200,maxWidth:600});var E=A(S,2),R=w(E),C=w(R),I=w(C);{var D=U=>{var X=h2e();T(U,X)};z(I,U=>{cc()||U(D)})}var Q=A(I,2),M=w(Q);u2e(M,{});var N=A(Q,2),B=w(N);let H;B.__click=m;var F=w(B),Z=A(w(F),2),$=w(Z),W=A(F,2);let G;qt(B,U=>b(p,U),()=>u(p));var L=A(B,2);{var q=U=>{var X=m2e(),ie=w(X);Tt(ie,17,()=>e.vaults,pe=>pe.id,(pe,de)=>{var we=g2e();let me;var Ee=w(we);let _e;Ee.__click=()=>y(u(de).id);var Ae=A(w(Ee),2),ze=w(Ae),Be=A(Ae,2);{var Se=Me=>{var Pe=f2e();T(Me,Pe)};z(Be,Me=>{ep(u(de))&&Me(Se)})}var Re=A(Ee,2);{var He=Me=>{var Pe=p2e();Pe.__click=ae=>O(u(de),ae),T(Me,Pe)};z(Re,Me=>{ep(u(de))||Me(He)})}Y((Me,Pe)=>{me=Ue(we,1,"vault-item-container svelte-55p5l2",null,me,Me),_e=Ue(Ee,1,"vault-item svelte-55p5l2",null,_e,Pe),J(ze,u(de).name)},[()=>({legacy:ep(u(de))}),()=>({active:e.activeVault?.id===u(de).id,legacy:ep(u(de))})]),T(pe,we)});var ye=A(ie,4);ye.__click=_,Y(()=>gn(X,`top: ${u(g).top??""}px; left: ${u(g).left??""}px;`)),T(U,X)};z(L,U=>{u(f)&&U(q)})}var ue=A(N,4);ur(ue,{text:"Toggle sidebar (âB)",position:"bottom",children:(U,X)=>{var ie=v2e();ie.__click=function(...ye){e.onToggleSidebar?.apply(this,ye)},T(U,ie)},$$slots:{default:!0}});var oe=A(C,2),fe=w(oe);let be;var De=A(w(fe),2);De.__input=U=>e.onSearchChange(U.target.value),De.__keydown=function(...U){e.onSearchKeyDown?.apply(this,U)};var Le=A(fe,2);{var he=U=>{var X=x2e(),ie=w(X);{var ye=de=>{var we=w2e(),me=Ie(we);{var Ee=Be=>{var Se=y2e();T(Be,Se)};z(me,Be=>{e.isShowingRecent&&Be(Ee)})}var _e=A(me,2);AT(_e,{get results(){return e.searchResults},get onSelect(){return e.onSearchResultSelect},maxResults:8,get selectedIndex(){return e.selectedSearchIndex}});var Ae=A(_e,2);{var ze=Be=>{var Se=b2e();Se.__click=function(...He){e.onViewAllResults?.apply(this,He)};var Re=w(Se);Y(()=>J(Re,`View all ${e.searchResults.length??""} results (Enter)`)),T(Be,Se)};z(Ae,Be=>{e.searchResults.length>8&&!e.isShowingRecent&&Be(ze)})}T(de,we)},pe=de=>{var we=Ve(),me=Ie(we);{var Ee=Ae=>{var ze=_2e(),Be=w(ze);Y(()=>J(Be,`No matching notes found for "${e.searchQuery??""}"`)),T(Ae,ze)},_e=Ae=>{var ze=O2e();T(Ae,ze)};z(me,Ae=>{e.searchQuery.trim()?Ae(Ee):Ae(_e,!1)},!0)}T(de,we)};z(ie,de=>{e.searchResults.length>0?de(ye):de(pe,!1)})}T(U,X)};z(Le,U=>{e.searchInputFocused&&(e.searchQuery.trim()||e.searchResults.length>0)&&U(he)})}var se=A(R,2),V=w(se);cSe(V,{get onSystemViewSelect(){return e.onSystemViewSelect},get activeSystemView(){return e.activeSystemView}});var ne=A(V,2);$9(ne,()=>u(o)?.id,U=>{var X=k2e(),ie=w(X);CSe(ie,{get onItemSelect(){return e.onItemSelect}}),pp(1,X,()=>fk,()=>({x:u(s)*50,duration:150,delay:75})),pp(2,X,()=>fk,()=>({x:u(s)*-50,duration:75})),T(U,X)}),qt(se,U=>b(l,U),()=>u(l));var ee=A(se,2);$Se(ee,{get onCreateNote(){return e.onCreateNote},get onCreateDeck(){return e.onCreateDeck},get onCaptureWebpage(){return e.onCaptureWebpage},get showShadow(){return u(a)}}),Y(U=>{k=Ue(x,1,"left-sidebar svelte-55p5l2",null,k,{visible:An.leftSidebar.visible,resizing:u(t)!==null}),gn(x,`--sidebar-width: ${u(r)??""}px`),H=Ue(B,1,"vault-button svelte-55p5l2",null,H,{open:u(f)}),J($,e.activeVault?.name||"Select vault"),G=Ue(W,0,"dropdown-arrow svelte-55p5l2",null,G,{rotated:u(f)}),be=Ue(fe,1,"search-input-wrapper svelte-55p5l2",null,be,U),Tn(De,e.searchQuery)},[()=>({active:e.searchInputFocused&&(e.searchQuery.trim()||e.searchResults.length>0)})]),It("focus",De,function(...U){e.onSearchFocus?.apply(this,U)}),It("blur",De,function(...U){e.onSearchBlur?.apply(this,U)}),It("scroll",se,c),T(n,x),ct()}yt(["click","input","keydown"]);function CT(n){const e=document.createElement("div");e.style.cssText=`
    position: absolute;
    visibility: hidden;
    white-space: nowrap;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    line-height: inherit;
    pointer-events: none;
  `,n.appendChild(e);const t=A2e(n),r={dash:zc(e,"- "),star:zc(e,"* "),plus:zc(e,"+ "),num1:zc(e,"1. "),num2:zc(e,"10. "),num3:zc(e,"100. "),baseIndent:zc(e,"  "),cmLinePadding:t};return n.removeChild(e),r}function A2e(n){const e=n.querySelector(".cm-line");if(e){const a=window.getComputedStyle(e).getPropertyValue("padding-left");return parseFloat(a)||0}const t=document.createElement("div");t.className="cm-line",t.style.cssText=`
    position: absolute;
    visibility: hidden;
    pointer-events: none;
  `,n.appendChild(t);const i=window.getComputedStyle(t).getPropertyValue("padding-left"),s=parseFloat(i)||0;return n.removeChild(t),s}function zc(n,e){n.style.whiteSpace="pre",n.textContent=e;const t=n.getBoundingClientRect().width;return n.style.whiteSpace="",t}function ET(n){const e=document.documentElement;e.style.setProperty("--list-marker-dash-width",`${n.dash}px`),e.style.setProperty("--list-marker-star-width",`${n.star}px`),e.style.setProperty("--list-marker-plus-width",`${n.plus}px`),e.style.setProperty("--list-marker-num1-width",`${n.num1}px`),e.style.setProperty("--list-marker-num2-width",`${n.num2}px`),e.style.setProperty("--list-marker-num3-width",`${n.num3}px`),e.style.setProperty("--list-base-indent",`${n.baseIndent}px`),e.style.setProperty("--cm-line-padding",`${n.cmLinePadding}px`)}var C2e=P('<button class="type-button svelte-xyuon2" type="button" aria-haspopup="true"><span class="type-icon svelte-xyuon2"> </span></button>'),E2e=P('<button class="type-button svelte-xyuon2" type="button" title="Change note type" aria-haspopup="true"><span class="type-icon svelte-xyuon2"> </span> <span class="type-name svelte-xyuon2"> </span> <span>â¼</span></button>'),P2e=P('<button class="clear-search" aria-label="Clear search" type="button"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button>'),I2e=P('<div class="dropdown-item no-results">No matching types</div>'),M2e=P('<button type="button" role="menuitem"><div class="item-main"><span class="item-icon"> </span> <span class="item-name"> </span></div></button>'),R2e=P('<div class="dropdown-menu"><div class="search-container"><input type="text" class="search-input" placeholder="Search types..."/> <!></div> <!></div>'),D2e=P("<div><!> <!></div>");function bU(n,e){lt(e,!0);let t=et(e,"disabled",3,!1),r=et(e,"compact",3,!1);const i=le(yo),s=le(()=>u(i).find(N=>N.id===e.currentTypeId));let o=j(!1),a=j(null),l=j(null),c=j(null),d=j(""),h=j(null),f=j(0),p=j(Qt({top:0,left:0})),g=null;function m(){return g||(g=document.createElement("div"),g.className="note-type-dropdown-portal",document.body.appendChild(g)),g}Oo(()=>{g&&g.parentNode&&(g.parentNode.removeChild(g),g=null)}),qr(()=>{function N(B){B.detail.noteId===e.noteId&&!t()&&(O(),b(o,!0))}return window.addEventListener("open-type-dropdown",N),()=>{window.removeEventListener("open-type-dropdown",N)}}),tt(()=>{u(o)&&u(c)&&m().appendChild(u(c))});const v=le(()=>{if(!u(d).trim())return u(i);const N=u(d).toLowerCase().trim();return u(i).filter(B=>B.name.toLowerCase().includes(N))});function y(N){const B=N.target,H=u(a)&&u(a).contains(B),F=u(c)&&u(c).contains(B);!H&&!F&&x()}tt(()=>{if(u(o))return document.addEventListener("click",y,!0),()=>{document.removeEventListener("click",y,!0)}}),tt(()=>{u(o)&&u(h)&&(b(f,0),setTimeout(()=>{u(h)?.focus()},50))}),tt(()=>{u(d),b(f,0)});function O(){if(u(l)){const N=u(l).getBoundingClientRect();b(p,{top:N.bottom+4,left:N.left},!0)}}function _(){t()||(u(o)||O(),b(o,!u(o)))}function x(){b(o,!1),b(d,""),b(f,0)}function k(N){if(N.id===e.currentTypeId){x();return}w5(e.noteId,N.id),x()}function S(N){if(u(o)){if(N.key==="Escape"){x(),N.preventDefault(),N.stopPropagation();return}if(N.key==="Enter"){N.preventDefault();const B=u(v)[u(f)];B&&k(B);return}if(N.key==="ArrowDown"){N.preventDefault(),u(v).length>0&&b(f,(u(f)+1)%u(v).length);return}if(N.key==="ArrowUp"){N.preventDefault(),u(v).length>0&&b(f,(u(f)-1+u(v).length)%u(v).length);return}}}var E=D2e();let R;var C=w(E);{var I=N=>{{let B=le(()=>u(s)?.name||"Unknown");ur(N,{get text(){return u(B)},position:"bottom",children:(H,F)=>{var Z=C2e();Z.__click=_;var $=w(Z),W=w($);qt(Z,G=>b(l,G),()=>u(l)),Y(()=>{Z.disabled=t(),Pt(Z,"aria-expanded",u(o)),J(W,u(s)?.icon||"ð")}),T(H,Z)},$$slots:{default:!0}})}},D=N=>{var B=E2e();B.__click=_;var H=w(B),F=w(H),Z=A(H,2),$=w(Z),W=A(Z,2);let G;qt(B,L=>b(l,L),()=>u(l)),Y(()=>{B.disabled=t(),Pt(B,"aria-expanded",u(o)),J(F,u(s)?.icon||"ð"),J($,u(s)?.name||"Unknown"),G=Ue(W,1,"dropdown-icon svelte-xyuon2",null,G,{open:u(o)})}),T(N,B)};z(C,N=>{r()?N(I):N(D,!1)})}var Q=A(C,2);{var M=N=>{var B=R2e();B.__click=q=>q.stopPropagation(),B.__mousedown=q=>q.stopPropagation(),B.__keydown=q=>q.stopPropagation();var H=w(B),F=w(H);F.__click=q=>q.stopPropagation(),F.__keydown=S,qt(F,q=>b(h,q),()=>u(h));var Z=A(F,2);{var $=q=>{var ue=P2e();ue.__click=oe=>{oe.stopPropagation(),b(d,""),u(h)?.focus()},T(q,ue)};z(Z,q=>{u(d)&&q($)})}var W=A(H,2);{var G=q=>{var ue=I2e();T(q,ue)},L=q=>{var ue=Ve(),oe=Ie(ue);Tt(oe,19,()=>u(v),fe=>fe.id,(fe,be,De)=>{var Le=M2e();let he;Le.__click=X=>{X.stopPropagation(),k(u(be))};var se=w(Le),V=w(se),ne=w(V),ee=A(V,2),U=w(ee);Y(()=>{he=Ue(Le,1,"dropdown-item",null,he,{selected:u(be).id===e.currentTypeId,highlighted:u(De)===u(f)}),J(ne,u(be).icon||"ð"),J(U,u(be).name)}),T(fe,Le)}),T(q,ue)};z(W,q=>{u(v).length===0?q(G):q(L,!1)})}qt(B,q=>b(c,q),()=>u(c)),Y(()=>gn(B,`top: ${u(p).top??""}px; left: ${u(p).left??""}px;`)),Un(F,()=>u(d),q=>b(d,q)),T(N,B)};z(Q,N=>{u(o)&&N(M)})}qt(E,N=>b(a,N),()=>u(a)),Y(()=>R=Ue(E,1,"note-type-dropdown svelte-xyuon2",null,R,{disabled:t(),compact:r()})),T(n,E),ct()}yt(["click","mousedown","keydown"]);var N2e=P('<div class="title-display svelte-ixmnh2"> </div>'),L2e=P('<textarea class="title-input svelte-ixmnh2" placeholder="Untitled" rows="1"></textarea>'),Q2e=P('<div class="note-header svelte-ixmnh2"><div class="header-row svelte-ixmnh2"><div class="title-area svelte-ixmnh2"><!> <!></div></div> <!></div>');function Xb(n,e){lt(e,!0);let t=et(e,"readonly",3,!1),r=j(null);function i(O){const _=O.target;e.onTitleChange?.(_.value),o()}function s(O){O.key==="Enter"&&(O.preventDefault(),e.onEnterKey?.())}function o(){u(r)&&(u(r).style.height="auto",u(r).style.height=u(r).scrollHeight+"px")}tt(()=>{e.note.title,fl().then(()=>{o()})}),tt(()=>{if(!u(r))return;const O=new ResizeObserver(()=>{o()});return O.observe(u(r)),()=>{O.disconnect()}});function a(){u(r)?.focus()}var l={focus:a},c=Q2e(),d=w(c),h=w(d),f=w(h);bU(f,{get noteId(){return e.note.id},get currentTypeId(){return e.note.type},compact:!0,get disabled(){return t()}});var p=A(f,2);{var g=O=>{var _=N2e(),x=w(_);Y(()=>J(x,e.note.title||"Untitled")),T(O,_)},m=O=>{var _=L2e();_.__input=i,_.__keydown=s,qt(_,x=>b(r,x),()=>u(r)),Y(()=>Tn(_,e.note.title)),T(O,_)};z(p,O=>{t()?O(g):O(m,!1)})}var v=A(d,2);{var y=O=>{var _=Ve(),x=Ie(_);ic(x,()=>e.chips),T(O,_)};z(v,O=>{e.chips&&O(y)})}return T(n,c),ct(l)}yt(["input","keydown"]);var $2e=P('<div class="action-popover svelte-1w3u6la"><button type="button" class="action-item svelte-1w3u6la"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1w3u6la"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg> <span class="svelte-1w3u6la">Open</span> <kbd class="svelte-1w3u6la"> </kbd></button> <button type="button" class="action-item svelte-1w3u6la"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1w3u6la"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg> <span class="svelte-1w3u6la">Edit Display Text</span> <kbd class="svelte-1w3u6la"> </kbd></button></div>');function F2e(n,e){lt(e,!0);let t=et(e,"visible",11,!1),r=j(void 0);const i=typeof navigator<"u"&&/Mac|iPhone|iPod|iPad/.test(navigator.platform),s=i?"â":"Ctrl",o=i?"â¥":"Alt";function a(){e.onOpen()}function l(){e.onEdit()}function c(p){p.preventDefault()}tt(()=>{if(t()&&u(r)&&e.linkRect){const p=u(r).getBoundingClientRect(),g=p.height,m=p.top+g;if(p.top<e.linkRect.bottom&&m>e.linkRect.top){const y=e.linkRect.top-4-g;u(r).style.top=`${y}px`}}});var d=Ve(),h=Ie(d);{var f=p=>{var g=$2e(),m=w(g);m.__click=a,m.__mousedown=c;var v=A(w(m),4),y=w(v),O=A(m,2);O.__click=l,O.__mousedown=c;var _=A(w(O),4),x=w(_);qt(g,k=>b(r,k),()=>u(r)),Y(()=>{gn(g,`left: ${e.x??""}px; top: ${e.y??""}px;`),J(y,`${s}âµ`),J(x,`${o}âµ`)}),T(p,g)};z(h,p=>{t()&&p(f)})}T(n,d),ct()}yt(["click","mousedown"]);var z2e=P('<div class="wikilink-popover svelte-14jwrsc"><div class="popover-content svelte-14jwrsc"><input id="display-input" type="text" placeholder="Display text" class="svelte-14jwrsc"/></div></div>');function B2e(n,e){lt(e,!0);let t=et(e,"visible",11,!1),r=j(Qt(e.displayText)),i=j(void 0),s=j(void 0);tt(()=>{u(i)!==document.activeElement&&b(r,e.displayText,!0)}),tt(()=>{t()&&u(i)&&setTimeout(()=>{u(i)?.focus(),u(i)?.select()},0)});function o(){return u(i)===document.activeElement}tt(()=>{if(t()&&u(s)&&e.linkRect){const p=u(s).getBoundingClientRect(),g=p.height,m=p.top+g;if(p.top<e.linkRect.bottom&&m>e.linkRect.top){const y=e.linkRect.top-4-g;u(s).style.top=`${y}px`}}});function a(){u(r).trim()&&e.onSave(u(r).trim())}function l(p){t()&&(p.key==="Escape"?(p.preventDefault(),p.stopPropagation(),e.onCancel()):p.key==="Enter"&&(p.preventDefault(),p.stopPropagation(),u(r).trim()&&e.onSave(u(r).trim()),e.onCommit?.()))}var c={hasFocus:o},d=Ve(),h=Ie(d);{var f=p=>{var g=z2e(),m=w(g),v=w(m);v.__input=a,v.__keydown=l,qt(v,y=>b(i,y),()=>u(i)),qt(g,y=>b(s,y),()=>u(s)),Y(()=>gn(g,`left: ${e.x??""}px; top: ${e.y??""}px;`)),Un(v,()=>u(r),y=>b(r,y)),T(p,g)};z(h,p=>{t()&&p(f)})}return T(n,d),ct(c)}yt(["input","keydown"]);var U2e=P('<span class="chip-label svelte-1gnt6vb"> </span>'),j2e=P('<span class="chip-label svelte-1gnt6vb"> </span>'),V2e=P('<div class="chip-notelink svelte-1gnt6vb"><!></div>'),q2e=P('<div class="chip-list-trigger-wrapper svelte-1gnt6vb"><!></div>'),H2e=P('<div class="chip-list-trigger-wrapper svelte-1gnt6vb"><!></div>'),Z2e=P('<span class="chip-value svelte-1gnt6vb"> </span>'),W2e=P('<div><!> <span class="chip-divider svelte-1gnt6vb"></span> <!></div>'),X2e=P('<button type="button"> </button>'),Y2e=P('<div class="editor-chips svelte-1gnt6vb"><!> <!></div>');function G2e(n,e){lt(e,!0);let t=et(e,"disabled",3,!1),r=j(!1);const i=["created","updated"],s=le(()=>e.noteType?.editorChips?.length?e.noteType.editorChips:["updated"]),o=le(()=>e.noteType?.properties??[]),a=le(()=>{const D=[...i];for(const Q of u(o))D.push(Q.name);return D}),l=le(()=>u(r)?u(a):u(s)),c=le(()=>u(a).length>u(s).length);function d(D){return u(o).find(Q=>Q.name===D)}function h(D){return i.includes(D)}function f(D){return t()?!1:!h(D)}function p(D){return D==="created"?"created":D==="updated"?"updated":D.replace(/_/g," ")}function g(D){return D==="created"?e.note.created:D==="updated"?e.note.updated:e.note.props?.[D]}function m(D){return Zn(D)?.title||D}function v(D){const Q=g(D);if(Q==null)return"â";if(D==="created"||D==="updated")return uM(String(Q));const M=d(D);return M?.type==="date"&&Q?uM(String(Q)):M?.type==="notelink"&&typeof Q=="string"?m(Q):M?.type==="notelinks"&&Array.isArray(Q)?Q.length===0?"â":Q.map(N=>m(String(N))).join(", "):Array.isArray(Q)?Q.length>0?Q.join(", "):"â":typeof Q=="boolean"?Q?"yes":"no":String(Q)||"â"}function y(D){return d(D)?.constraints?.options??[]}function O(D,Q){e.onPropChange(D,Q)}function _(D){e.onNoteClick?e.onNoteClick(D):(Rs(D),El(D))}function x(){b(r,!u(r))}function k(D){return h(D)?"system":d(D)?.type??"string"}function S(D){if(h(D))return!1;const Q=d(D);if(!Q)return!1;const M=g(D),N=Q.constraints;if(Q.required&&(M==null||M===""||Array.isArray(M)&&M.length===0))return!0;if(M==null||M==="")return!1;if(N){if(Q.type==="number"&&typeof M=="number"&&(N.min!==void 0&&M<N.min||N.max!==void 0&&M>N.max)||Q.type==="array"&&Array.isArray(M)&&(N.min!==void 0&&M.length<N.min||N.max!==void 0&&M.length>N.max)||Q.type==="notelinks"&&Array.isArray(M)&&(N.min!==void 0&&M.length<N.min||N.max!==void 0&&M.length>N.max))return!0;if(Q.type==="string"&&typeof M=="string"&&N.pattern)try{if(!new RegExp(N.pattern).test(M))return!0}catch{}if(Q.type==="select"&&N.options&&!N.options.includes(String(M)))return!0}return!1}function E(D){if(h(D))return null;const Q=d(D);if(!Q)return null;const M=g(D),N=Q.constraints;if(Q.required&&(M==null||M===""||Array.isArray(M)&&M.length===0))return"This field is required";if(M==null||M==="")return null;if(N){if(Q.type==="number"&&typeof M=="number"){if(N.min!==void 0&&M<N.min)return`Value must be at least ${N.min}`;if(N.max!==void 0&&M>N.max)return`Value must be at most ${N.max}`}if(Q.type==="array"&&Array.isArray(M)){if(N.min!==void 0&&M.length<N.min)return`Must have at least ${N.min} item${N.min===1?"":"s"}`;if(N.max!==void 0&&M.length>N.max)return`Must have at most ${N.max} item${N.max===1?"":"s"}`}if(Q.type==="notelinks"&&Array.isArray(M)){if(N.min!==void 0&&M.length<N.min)return`Must have at least ${N.min} link${N.min===1?"":"s"}`;if(N.max!==void 0&&M.length>N.max)return`Must have at most ${N.max} link${N.max===1?"":"s"}`}if(Q.type==="string"&&typeof M=="string"&&N.pattern)try{if(!new RegExp(N.pattern).test(M))return`Value must match pattern: ${N.pattern}`}catch{}if(Q.type==="select"&&N.options&&!N.options.includes(String(M)))return`Value must be one of: ${N.options.join(", ")}`}return null}var R=Ve(),C=Ie(R);{var I=D=>{var Q=Y2e(),M=w(Q);Tt(M,16,()=>u(l),H=>H,(H,F)=>{const Z=le(()=>g(F)),$=le(()=>f(F)),W=le(()=>k(F)),G=le(()=>y(F)),L=le(()=>S(F)),q=le(()=>u(L)?E(F):null);var ue=W2e();let oe;var fe=w(ue);{var be=V=>{ur(V,{get text(){return u(q)},position:"bottom",children:(ne,ee)=>{var U=U2e(),X=w(U);Y(ie=>J(X,ie),[()=>p(F)]),T(ne,U)},$$slots:{default:!0}})},De=V=>{var ne=j2e(),ee=w(ne);Y(U=>J(ee,U),[()=>p(F)]),T(V,ne)};z(fe,V=>{u(q)?V(be):V(De,!1)})}var Le=A(fe,4);{var he=V=>{var ne=V2e(),ee=w(ne);iB(ee,{get value(){return u(Z)},onChange:U=>O(F,U),onNoteClick:_,get excludeNoteId(){return e.note.id}}),T(V,ne)},se=V=>{var ne=Ve(),ee=Ie(ne);{var U=ie=>{var ye=q2e(),pe=w(ye);{let de=le(()=>Array.isArray(u(Z))?u(Z):[]);sB(pe,{get value(){return u(de)},onChange:we=>O(F,we),onNoteClick:_,get excludeNoteId(){return e.note.id}})}T(ie,ye)},X=ie=>{var ye=Ve(),pe=Ie(ye);{var de=me=>{vfe(me,{get value(){return u(Z)},get options(){return u(G)},onChange:Ee=>O(F,Ee),class:"chip-select"})},we=me=>{var Ee=Ve(),_e=Ie(Ee);{var Ae=Be=>{{let Se=le(()=>!!u(Z));hfe(Be,{get value(){return u(Se)},onChange:Re=>O(F,Re),class:"chip-checkbox"})}},ze=Be=>{var Se=Ve(),Re=Ie(Se);{var He=Pe=>{pfe(Pe,{get value(){return u(Z)},onChange:ae=>O(F,ae),class:"chip-date"})},Me=Pe=>{var ae=Ve(),te=Ie(ae);{var re=Te=>{ufe(Te,{get value(){return u(Z)},onChange:Ne=>O(F,Ne),class:"chip-input"})},ve=Te=>{var Ne=Ve(),ce=Ie(Ne);{var Oe=We=>{var st=H2e(),it=w(st);{let Ct=le(()=>Array.isArray(u(Z))?u(Z):[]);nB(it,{get value(){return u(Ct)},onChange:bt=>O(F,bt)})}T(We,st)},Qe=We=>{var st=Ve(),it=Ie(st);{var Ct=xt=>{lfe(xt,{get value(){return u(Z)},onChange:mt=>O(F,mt),class:"chip-input"})},bt=xt=>{var mt=Z2e(),Ge=w(mt);Y(Xe=>J(Ge,Xe),[()=>v(F)]),T(xt,mt)};z(it,xt=>{u($)?xt(Ct):xt(bt,!1)},!0)}T(We,st)};z(ce,We=>{u($)&&u(W)==="array"?We(Oe):We(Qe,!1)},!0)}T(Te,Ne)};z(te,Te=>{u($)&&u(W)==="number"?Te(re):Te(ve,!1)},!0)}T(Pe,ae)};z(Re,Pe=>{u($)&&u(W)==="date"?Pe(He):Pe(Me,!1)},!0)}T(Be,Se)};z(_e,Be=>{u($)&&u(W)==="boolean"?Be(Ae):Be(ze,!1)},!0)}T(me,Ee)};z(pe,me=>{u($)&&u(W)==="select"&&u(G).length>0?me(de):me(we,!1)},!0)}T(ie,ye)};z(ee,ie=>{u($)&&u(W)==="notelinks"?ie(U):ie(X,!1)},!0)}T(V,ne)};z(Le,V=>{u($)&&u(W)==="notelink"?V(he):V(se,!1)})}Y(()=>oe=Ue(ue,1,"chip svelte-1gnt6vb",null,oe,{"chip-expandable":u($)&&(u(W)==="notelink"||u(W)==="notelinks"||u(W)==="array"),"chip-invalid":u(L)})),T(H,ue)});var N=A(M,2);{var B=H=>{var F=X2e();let Z;F.__click=x;var $=w(F);Y(()=>{Z=Ue(F,1,"expand-btn svelte-1gnt6vb",null,Z,{expanded:u(r)}),Pt(F,"title",u(r)?"Show fewer fields":"Show all fields"),J($,u(r)?"â":"â¦")}),T(H,F)};z(N,H=>{u(c)&&H(B)})}T(D,Q)};z(C,D=>{u(l).length>0&&D(I)})}T(n,R),ct()}yt(["click"]);var K2e=P('<div class="backlink-line-editor editor-font svelte-vsxrnr"></div>');function J2e(n,e){lt(e,!0);let t=j(null),r=null,i=j(!1),s=null,o=!1;function a(){return gt.theme({"&":{fontSize:"1rem",fontFamily:"var(--font-editor) !important",lineHeight:"1.5",backgroundColor:"transparent"},"&.cm-editor":{backgroundColor:"transparent"},"&.cm-focused":{outline:"none",boxShadow:"none !important"},".cm-content":{fontFamily:"var(--font-editor) !important",padding:"0.25rem 0",caretColor:"var(--text-primary)"},".cm-line":{fontFamily:"var(--font-editor) !important",padding:"0"},".cm-scroller":{overflow:"hidden !important"},".cm-cursor":{borderLeftColor:"var(--text-primary)"}})}function l(){const p=[F2,k2(),Nl.of([...A2,...S2]),Hz(),gt.lineWrapping,u(i)?K2:G2,a(),gt.contentAttributes.of({spellcheck:"true"})];return e.onWikilinkClick&&p.push(eT(e.onWikilinkClick)),p.push(gt.updateListener.of(g=>{g.docChanged&&!o&&c(g.state.doc.toString())})),p}async function c(p){o=!0;try{const g=await Yp(e.sourceNoteId);if(!g)return;const m=g.doc();if(!m)return;const y=(m.content||"").split(`
`);if(e.lineNumber<0||e.lineNumber>=y.length)return;y[e.lineNumber]=p;const O=y.join(`
`);g.change(_=>{_.content=O})}finally{o=!1}}function d(p){b(i,p.matches,!0),r&&r.dispatch({effects:en.reconfigure.of(l())})}function h(){if(!u(t)||r)return;const p=un.create({doc:e.initialText,extensions:l()});r=new gt({state:p,parent:u(t)})}qr(()=>(typeof window<"u"&&(s=window.matchMedia("(prefers-color-scheme: dark)"),b(i,s.matches,!0),s.addEventListener("change",d)),()=>{r&&(r.destroy(),r=null),s&&s.removeEventListener("change",d)})),tt(()=>{u(t)&&!r&&h()}),tt(()=>{if(r&&!o){const p=r.state.doc.toString();p!==e.initialText&&(o=!0,r.dispatch({changes:{from:0,to:p.length,insert:e.initialText}}),o=!1)}});var f=K2e();qt(f,p=>b(t,p),()=>u(t)),T(n,f),ct()}var eTe=P('<div class="header-controls svelte-13fiwuh"><button class="control-btn svelte-13fiwuh" title="Expand all" aria-label="Expand all backlinks"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="7 13 12 18 17 13"></polyline><polyline points="7 6 12 11 17 6"></polyline></svg></button> <button class="control-btn svelte-13fiwuh" title="Collapse all" aria-label="Collapse all backlinks"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 11 12 6 7 11"></polyline><polyline points="17 18 12 13 7 18"></polyline></svg></button></div>'),tTe=P('<span class="property-backlink svelte-13fiwuh"> </span>'),nTe=P('<div class="occurrence-line svelte-13fiwuh"><span class="line-gutter svelte-13fiwuh">|</span> <!></div>'),rTe=P('<div class="occurrences-list svelte-13fiwuh"></div>'),iTe=P('<div class="backlink-note svelte-13fiwuh"><button class="note-row svelte-13fiwuh"><span><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></span> <span class="note-icon svelte-13fiwuh"> </span> <span class="note-title svelte-13fiwuh" role="link" tabindex="0"> </span> <span class="row-spacer svelte-13fiwuh"></span> <span class="occurrence-count svelte-13fiwuh"> </span></button> <!></div>'),sTe=P('<div class="backlinks-list"></div>'),oTe=P('<div class="backlinks-panel svelte-13fiwuh"><div class="backlinks-header svelte-13fiwuh"><button class="header-toggle svelte-13fiwuh"><span><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></span> <span class="header-title svelte-13fiwuh">Backlinks</span> <span class="header-count svelte-13fiwuh"> </span></button> <!></div> <!></div>');function aTe(n,e){lt(e,!0);let t=new kc,r=j(!1);function i(f){t.has(f)?t.delete(f):t.add(f)}function s(){e.backlinks.forEach(f=>t.add(f.note.id))}function o(){t.clear()}function a(f){e.onNavigate(f)}function l(f){return f.type&&jr(f.type)?.icon||"ð"}var c=Ve(),d=Ie(c);{var h=f=>{var p=oTe(),g=w(p),m=w(g);m.__click=()=>b(r,!u(r));var v=w(m);let y;var O=A(v,4),_=w(O),x=A(m,2);{var k=R=>{var C=eTe(),I=w(C);I.__click=()=>s();var D=A(I,2);D.__click=()=>o(),T(R,C)};z(x,R=>{u(r)&&R(k)})}var S=A(g,2);{var E=R=>{var C=sTe();Tt(C,21,()=>e.backlinks,I=>I.note.id,(I,D)=>{var Q=iTe(),M=w(Q);M.__click=()=>i(u(D).note.id);var N=w(M);let B;var H=A(N,2),F=w(H),Z=A(H,2);Z.__click=ue=>{ue.stopPropagation(),a(u(D).note.id)},Z.__keydown=ue=>{ue.key==="Enter"&&(ue.stopPropagation(),a(u(D).note.id))};var $=w(Z),W=A(Z,4),G=w(W),L=A(M,2);{var q=ue=>{var oe=rTe();Tt(oe,21,()=>u(D).occurrences,Sl,(fe,be)=>{var De=nTe(),Le=A(w(De),2);{var he=V=>{J2e(V,{get sourceNoteId(){return u(D).note.id},get lineNumber(){return u(be).lineNumber},get initialText(){return u(be).lineText},get onWikilinkClick(){return e.onWikilinkClick}})},se=V=>{var ne=tTe(),ee=w(ne);Y(()=>J(ee,`via ${u(be).propertyName??""}`)),T(V,ne)};z(Le,V=>{u(be).source==="content"?V(he):V(se,!1)})}T(fe,De)}),T(ue,oe)};z(L,ue=>{t.has(u(D).note.id)&&ue(q)})}Y((ue,oe,fe)=>{Pt(M,"aria-expanded",ue),B=Ue(N,1,"disclosure-arrow svelte-13fiwuh",null,B,oe),J(F,fe),J($,u(D).note.title||"Untitled"),J(G,u(D).occurrences.length)},[()=>t.has(u(D).note.id),()=>({expanded:t.has(u(D).note.id)}),()=>l(u(D).note)]),T(I,Q)}),T(R,C)};z(S,R=>{u(r)&&R(E)})}Y(()=>{Pt(m,"aria-expanded",u(r)),y=Ue(v,1,"header-arrow svelte-13fiwuh",null,y,{expanded:u(r)}),J(_,e.backlinks.length)}),T(f,p)};z(d,f=>{e.backlinks.length>0&&f(h)})}T(n,c),ct()}yt(["click","keydown"]);function PT(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ju=PT();function wU(n){Ju=n}var Ip={exec:()=>null};function Dn(n,e=""){let t=typeof n=="string"?n:n.source,r={replace:(i,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(Ui.caret,"$1"),t=t.replace(i,o),r},getRegex:()=>new RegExp(t,e)};return r}var lTe=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),Ui={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},cTe=/^(?:[ \t]*(?:\n|$))+/,uTe=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,dTe=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,ym=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,hTe=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,IT=/(?:[*+-]|\d{1,9}[.)])/,_U=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,OU=Dn(_U).replace(/bull/g,IT).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),fTe=Dn(_U).replace(/bull/g,IT).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),MT=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,pTe=/^[^\n]+/,RT=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,gTe=Dn(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",RT).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),mTe=Dn(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,IT).getRegex(),Yb="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",DT=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,vTe=Dn("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",DT).replace("tag",Yb).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),xU=Dn(MT).replace("hr",ym).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yb).getRegex(),yTe=Dn(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",xU).getRegex(),NT={blockquote:yTe,code:uTe,def:gTe,fences:dTe,heading:hTe,hr:ym,html:vTe,lheading:OU,list:mTe,newline:cTe,paragraph:xU,table:Ip,text:pTe},HR=Dn("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",ym).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yb).getRegex(),bTe={...NT,lheading:fTe,table:HR,paragraph:Dn(MT).replace("hr",ym).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",HR).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yb).getRegex()},wTe={...NT,html:Dn(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",DT).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ip,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Dn(MT).replace("hr",ym).replace("heading",` *#{1,6} *[^
]`).replace("lheading",OU).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},_Te=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,OTe=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,kU=/^( {2,}|\\)\n(?!\s*$)/,xTe=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Gb=/[\p{P}\p{S}]/u,LT=/[\s\p{P}\p{S}]/u,SU=/[^\s\p{P}\p{S}]/u,kTe=Dn(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,LT).getRegex(),TU=/(?!~)[\p{P}\p{S}]/u,STe=/(?!~)[\s\p{P}\p{S}]/u,TTe=/(?:[^\s\p{P}\p{S}]|~)/u,ATe=Dn(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",lTe?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),AU=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,CTe=Dn(AU,"u").replace(/punct/g,Gb).getRegex(),ETe=Dn(AU,"u").replace(/punct/g,TU).getRegex(),CU="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",PTe=Dn(CU,"gu").replace(/notPunctSpace/g,SU).replace(/punctSpace/g,LT).replace(/punct/g,Gb).getRegex(),ITe=Dn(CU,"gu").replace(/notPunctSpace/g,TTe).replace(/punctSpace/g,STe).replace(/punct/g,TU).getRegex(),MTe=Dn("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,SU).replace(/punctSpace/g,LT).replace(/punct/g,Gb).getRegex(),RTe=Dn(/\\(punct)/,"gu").replace(/punct/g,Gb).getRegex(),DTe=Dn(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),NTe=Dn(DT).replace("(?:-->|$)","-->").getRegex(),LTe=Dn("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",NTe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Q0=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,QTe=Dn(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Q0).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),EU=Dn(/^!?\[(label)\]\[(ref)\]/).replace("label",Q0).replace("ref",RT).getRegex(),PU=Dn(/^!?\[(ref)\](?:\[\])?/).replace("ref",RT).getRegex(),$Te=Dn("reflink|nolink(?!\\()","g").replace("reflink",EU).replace("nolink",PU).getRegex(),ZR=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,QT={_backpedal:Ip,anyPunctuation:RTe,autolink:DTe,blockSkip:ATe,br:kU,code:OTe,del:Ip,emStrongLDelim:CTe,emStrongRDelimAst:PTe,emStrongRDelimUnd:MTe,escape:_Te,link:QTe,nolink:PU,punctuation:kTe,reflink:EU,reflinkSearch:$Te,tag:LTe,text:xTe,url:Ip},FTe={...QT,link:Dn(/^!?\[(label)\]\((.*?)\)/).replace("label",Q0).getRegex(),reflink:Dn(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Q0).getRegex()},pk={...QT,emStrongRDelimAst:ITe,emStrongLDelim:ETe,url:Dn(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",ZR).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Dn(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",ZR).getRegex()},zTe={...pk,br:Dn(kU).replace("{2,}","*").getRegex(),text:Dn(pk.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Pv={normal:NT,gfm:bTe,pedantic:wTe},jf={normal:QT,gfm:pk,breaks:zTe,pedantic:FTe},BTe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},WR=n=>BTe[n];function fa(n,e){if(e){if(Ui.escapeTest.test(n))return n.replace(Ui.escapeReplace,WR)}else if(Ui.escapeTestNoEncode.test(n))return n.replace(Ui.escapeReplaceNoEncode,WR);return n}function XR(n){try{n=encodeURI(n).replace(Ui.percentDecode,"%")}catch{return null}return n}function YR(n,e){let t=n.replace(Ui.findPipe,(s,o,a)=>{let l=!1,c=o;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),r=t.split(Ui.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(Ui.slashPipe,"|");return r}function Vf(n,e,t){let r=n.length;if(r===0)return"";let i=0;for(;i<r&&n.charAt(r-i-1)===e;)i++;return n.slice(0,r-i)}function UTe(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])t++;else if(n[r]===e[1]&&(t--,t<0))return r;return t>0?-2:-1}function GR(n,e,t,r,i){let s=e.href,o=e.title||null,a=n[1].replace(i.other.outputLinkReplace,"$1");r.state.inLink=!0;let l={type:n[0].charAt(0)==="!"?"image":"link",raw:t,href:s,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,l}function jTe(n,e,t){let r=n.match(t.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(s=>{let o=s.match(t.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=i.length?s.slice(i.length):s}).join(`
`)}var $0=class{options;rules;lexer;constructor(n){this.options=n||Ju}space(n){let e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(n){let e=this.rules.block.code.exec(n);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:Vf(t,`
`)}}}fences(n){let e=this.rules.block.fences.exec(n);if(e){let t=e[0],r=jTe(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(n){let e=this.rules.block.heading.exec(n);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let r=Vf(t,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(t=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(n){let e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:Vf(e[0],`
`)}}blockquote(n){let e=this.rules.block.blockquote.exec(n);if(e){let t=Vf(e[0],`
`).split(`
`),r="",i="",s=[];for(;t.length>0;){let o=!1,a=[],l;for(l=0;l<t.length;l++)if(this.rules.other.blockquoteStart.test(t[l]))a.push(t[l]),o=!0;else if(!o)a.push(t[l]);else break;t=t.slice(l);let c=a.join(`
`),d=c.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${c}`:c,i=i?`${i}
${d}`:d;let h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,s,!0),this.lexer.state.top=h,t.length===0)break;let f=s.at(-1);if(f?.type==="code")break;if(f?.type==="blockquote"){let p=f,g=p.raw+`
`+t.join(`
`),m=this.blockquote(g);s[s.length-1]=m,r=r.substring(0,r.length-p.raw.length)+m.raw,i=i.substring(0,i.length-p.text.length)+m.text;break}else if(f?.type==="list"){let p=f,g=p.raw+`
`+t.join(`
`),m=this.list(g);s[s.length-1]=m,r=r.substring(0,r.length-f.raw.length)+m.raw,i=i.substring(0,i.length-p.raw.length)+m.raw,t=g.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:i}}}list(n){let e=this.rules.block.list.exec(n);if(e){let t=e[1].trim(),r=t.length>1,i={type:"list",raw:"",ordered:r,start:r?+t.slice(0,-1):"",loose:!1,items:[]};t=r?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=r?t:"[*+-]");let s=this.rules.other.listItemRegex(t),o=!1;for(;n;){let l=!1,c="",d="";if(!(e=s.exec(n))||this.rules.block.hr.test(n))break;c=e[0],n=n.substring(c.length);let h=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,y=>" ".repeat(3*y.length)),f=n.split(`
`,1)[0],p=!h.trim(),g=0;if(this.options.pedantic?(g=2,d=h.trimStart()):p?g=e[1].length+1:(g=e[2].search(this.rules.other.nonSpaceChar),g=g>4?1:g,d=h.slice(g),g+=e[1].length),p&&this.rules.other.blankLine.test(f)&&(c+=f+`
`,n=n.substring(f.length+1),l=!0),!l){let y=this.rules.other.nextBulletRegex(g),O=this.rules.other.hrRegex(g),_=this.rules.other.fencesBeginRegex(g),x=this.rules.other.headingBeginRegex(g),k=this.rules.other.htmlBeginRegex(g);for(;n;){let S=n.split(`
`,1)[0],E;if(f=S,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),E=f):E=f.replace(this.rules.other.tabCharGlobal,"    "),_.test(f)||x.test(f)||k.test(f)||y.test(f)||O.test(f))break;if(E.search(this.rules.other.nonSpaceChar)>=g||!f.trim())d+=`
`+E.slice(g);else{if(p||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||_.test(h)||x.test(h)||O.test(h))break;d+=`
`+f}!p&&!f.trim()&&(p=!0),c+=S+`
`,n=n.substring(S.length+1),h=E.slice(g)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(c)&&(o=!0));let m=null,v;this.options.gfm&&(m=this.rules.other.listIsTask.exec(d),m&&(v=m[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:c,task:!!m,checked:v,loose:!1,text:d,tokens:[]}),i.raw+=c}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let l=0;l<i.items.length;l++)if(this.lexer.state.top=!1,i.items[l].tokens=this.lexer.blockTokens(i.items[l].text,[]),!i.loose){let c=i.items[l].tokens.filter(h=>h.type==="space"),d=c.length>0&&c.some(h=>this.rules.other.anyLine.test(h.raw));i.loose=d}if(i.loose)for(let l=0;l<i.items.length;l++)i.items[l].loose=!0;return i}}html(n){let e=this.rules.block.html.exec(n);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(n){let e=this.rules.block.def.exec(n);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:r,title:i}}}table(n){let e=this.rules.block.table.exec(n);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=YR(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===r.length){for(let o of r)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<t.length;o++)s.header.push({text:t[o],tokens:this.lexer.inline(t[o]),header:!0,align:s.align[o]});for(let o of i)s.rows.push(YR(o,s.header.length).map((a,l)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:s.align[l]})));return s}}lheading(n){let e=this.rules.block.lheading.exec(n);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(n){let e=this.rules.block.paragraph.exec(n);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(n){let e=this.rules.block.text.exec(n);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(n){let e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(n){let e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(n){let e=this.rules.inline.link.exec(n);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let s=Vf(t.slice(0,-1),"\\");if((t.length-s.length)%2===0)return}else{let s=UTe(e[2],"()");if(s===-2)return;if(s>-1){let o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let r=e[2],i="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],i=s[3])}else i=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?r=r.slice(1):r=r.slice(1,-1)),GR(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(n,e){let t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){let r=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[r.toLowerCase()];if(!i){let s=t[0].charAt(0);return{type:"text",raw:s,text:s}}return GR(t,i,t[0],this.lexer,this.rules)}}emStrong(n,e,t=""){let r=this.rules.inline.emStrongLDelim.exec(n);if(!(!r||r[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!t||this.rules.inline.punctuation.exec(t))){let i=[...r[0]].length-1,s,o,a=i,l=0,c=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,e=e.slice(-1*n.length+i);(r=c.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(o=[...s].length,r[3]||r[4]){a+=o;continue}else if((r[5]||r[6])&&i%3&&!((i+o)%3)){l+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+l);let d=[...r[0]][0].length,h=n.slice(0,i+r.index+d+o);if(Math.min(i,o)%2){let p=h.slice(1,-1);return{type:"em",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}let f=h.slice(2,-2);return{type:"strong",raw:h,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(n){let e=this.rules.inline.code.exec(n);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(t),i=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return r&&i&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(n){let e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}}del(n){let e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(n){let e=this.rules.inline.autolink.exec(n);if(e){let t,r;return e[2]==="@"?(t=e[1],r="mailto:"+t):(t=e[1],r=t),{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}url(n){let e;if(e=this.rules.inline.url.exec(n)){let t,r;if(e[2]==="@")t=e[0],r="mailto:"+t;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);t=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(n){let e=this.rules.inline.text.exec(n);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},Qo=class gk{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ju,this.options.tokenizer=this.options.tokenizer||new $0,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:Ui,block:Pv.normal,inline:jf.normal};this.options.pedantic?(t.block=Pv.pedantic,t.inline=jf.pedantic):this.options.gfm&&(t.block=Pv.gfm,this.options.breaks?t.inline=jf.breaks:t.inline=jf.gfm),this.tokenizer.rules=t}static get rules(){return{block:Pv,inline:jf}}static lex(e,t){return new gk(t).lex(e)}static lexInline(e,t){return new gk(t).inlineTokens(e)}lex(e){e=e.replace(Ui.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let r=this.inlineQueue[t];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(Ui.tabCharGlobal,"    ").replace(Ui.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let o=t.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},t.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let o=1/0,a=e.slice(1),l;this.options.extensions.startBlock.forEach(c=>{l=c.call({lexer:this},a),typeof l=="number"&&l>=0&&(o=Math.min(o,l))}),o<1/0&&o>=0&&(s=e.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let o=t.at(-1);r&&o?.type==="paragraph"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(i);continue}if(e){let o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,i=null;if(this.tokens.links){let l=Object.keys(this.tokens.links);if(l.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)l.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)s=i[2]?i[2].length:0,r=r.slice(0,i.index+s)+"["+"a".repeat(i[0].length-s-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=this.options.hooks?.emStrongMask?.call({lexer:this},r)??r;let o=!1,a="";for(;e;){o||(a=""),o=!1;let l;if(this.options.extensions?.inline?.some(d=>(l=d.call({lexer:this},e,t))?(e=e.substring(l.raw.length),t.push(l),!0):!1))continue;if(l=this.tokenizer.escape(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.tag(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.link(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(l.raw.length);let d=t.at(-1);l.type==="text"&&d?.type==="text"?(d.raw+=l.raw,d.text+=l.text):t.push(l);continue}if(l=this.tokenizer.emStrong(e,r,a)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.codespan(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.br(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.del(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.autolink(e)){e=e.substring(l.raw.length),t.push(l);continue}if(!this.state.inLink&&(l=this.tokenizer.url(e))){e=e.substring(l.raw.length),t.push(l);continue}let c=e;if(this.options.extensions?.startInline){let d=1/0,h=e.slice(1),f;this.options.extensions.startInline.forEach(p=>{f=p.call({lexer:this},h),typeof f=="number"&&f>=0&&(d=Math.min(d,f))}),d<1/0&&d>=0&&(c=e.substring(0,d+1))}if(l=this.tokenizer.inlineText(c)){e=e.substring(l.raw.length),l.raw.slice(-1)!=="_"&&(a=l.raw.slice(-1)),o=!0;let d=t.at(-1);d?.type==="text"?(d.raw+=l.raw,d.text+=l.text):t.push(l);continue}if(e){let d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return t}},F0=class{options;parser;constructor(n){this.options=n||Ju}space(n){return""}code({text:n,lang:e,escaped:t}){let r=(e||"").match(Ui.notSpaceStart)?.[0],i=n.replace(Ui.endingNewline,"")+`
`;return r?'<pre><code class="language-'+fa(r)+'">'+(t?i:fa(i,!0))+`</code></pre>
`:"<pre><code>"+(t?i:fa(i,!0))+`</code></pre>
`}blockquote({tokens:n}){return`<blockquote>
${this.parser.parse(n)}</blockquote>
`}html({text:n}){return n}def(n){return""}heading({tokens:n,depth:e}){return`<h${e}>${this.parser.parseInline(n)}</h${e}>
`}hr(n){return`<hr>
`}list(n){let e=n.ordered,t=n.start,r="";for(let o=0;o<n.items.length;o++){let a=n.items[o];r+=this.listitem(a)}let i=e?"ol":"ul",s=e&&t!==1?' start="'+t+'"':"";return"<"+i+s+`>
`+r+"</"+i+`>
`}listitem(n){let e="";if(n.task){let t=this.checkbox({checked:!!n.checked});n.loose?n.tokens[0]?.type==="paragraph"?(n.tokens[0].text=t+" "+n.tokens[0].text,n.tokens[0].tokens&&n.tokens[0].tokens.length>0&&n.tokens[0].tokens[0].type==="text"&&(n.tokens[0].tokens[0].text=t+" "+fa(n.tokens[0].tokens[0].text),n.tokens[0].tokens[0].escaped=!0)):n.tokens.unshift({type:"text",raw:t+" ",text:t+" ",escaped:!0}):e+=t+" "}return e+=this.parser.parse(n.tokens,!!n.loose),`<li>${e}</li>
`}checkbox({checked:n}){return"<input "+(n?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:n}){return`<p>${this.parser.parseInline(n)}</p>
`}table(n){let e="",t="";for(let i=0;i<n.header.length;i++)t+=this.tablecell(n.header[i]);e+=this.tablerow({text:t});let r="";for(let i=0;i<n.rows.length;i++){let s=n.rows[i];t="";for(let o=0;o<s.length;o++)t+=this.tablecell(s[o]);r+=this.tablerow({text:t})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:n}){return`<tr>
${n}</tr>
`}tablecell(n){let e=this.parser.parseInline(n.tokens),t=n.header?"th":"td";return(n.align?`<${t} align="${n.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:n}){return`<strong>${this.parser.parseInline(n)}</strong>`}em({tokens:n}){return`<em>${this.parser.parseInline(n)}</em>`}codespan({text:n}){return`<code>${fa(n,!0)}</code>`}br(n){return"<br>"}del({tokens:n}){return`<del>${this.parser.parseInline(n)}</del>`}link({href:n,title:e,tokens:t}){let r=this.parser.parseInline(t),i=XR(n);if(i===null)return r;n=i;let s='<a href="'+n+'"';return e&&(s+=' title="'+fa(e)+'"'),s+=">"+r+"</a>",s}image({href:n,title:e,text:t,tokens:r}){r&&(t=this.parser.parseInline(r,this.parser.textRenderer));let i=XR(n);if(i===null)return fa(t);n=i;let s=`<img src="${n}" alt="${t}"`;return e&&(s+=` title="${fa(e)}"`),s+=">",s}text(n){return"tokens"in n&&n.tokens?this.parser.parseInline(n.tokens):"escaped"in n&&n.escaped?n.text:fa(n.text)}},$T=class{strong({text:n}){return n}em({text:n}){return n}codespan({text:n}){return n}del({text:n}){return n}html({text:n}){return n}text({text:n}){return n}link({text:n}){return""+n}image({text:n}){return""+n}br(){return""}},$o=class mk{options;renderer;textRenderer;constructor(e){this.options=e||Ju,this.options.renderer=this.options.renderer||new F0,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $T}static parse(e,t){return new mk(t).parse(e)}static parseInline(e,t){return new mk(t).parseInline(e)}parse(e,t=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=s,l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){r+=l||"";continue}}let o=s;switch(o.type){case"space":{r+=this.renderer.space(o);continue}case"hr":{r+=this.renderer.hr(o);continue}case"heading":{r+=this.renderer.heading(o);continue}case"code":{r+=this.renderer.code(o);continue}case"table":{r+=this.renderer.table(o);continue}case"blockquote":{r+=this.renderer.blockquote(o);continue}case"list":{r+=this.renderer.list(o);continue}case"html":{r+=this.renderer.html(o);continue}case"def":{r+=this.renderer.def(o);continue}case"paragraph":{r+=this.renderer.paragraph(o);continue}case"text":{let a=o,l=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],l+=`
`+this.renderer.text(a);t?r+=this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l,escaped:!0}]}):r+=l;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(e,t=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=a||"";continue}}let o=s;switch(o.type){case"escape":{r+=t.text(o);break}case"html":{r+=t.html(o);break}case"link":{r+=t.link(o);break}case"image":{r+=t.image(o);break}case"strong":{r+=t.strong(o);break}case"em":{r+=t.em(o);break}case"codespan":{r+=t.codespan(o);break}case"br":{r+=t.br(o);break}case"del":{r+=t.del(o);break}case"text":{r+=t.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},up=class{options;block;constructor(n){this.options=n||Ju}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(n){return n}postprocess(n){return n}processAllTokens(n){return n}emStrongMask(n){return n}provideLexer(){return this.block?Qo.lex:Qo.lexInline}provideParser(){return this.block?$o.parse:$o.parseInline}},VTe=class{defaults=PT();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=$o;Renderer=F0;TextRenderer=$T;Lexer=Qo;Tokenizer=$0;Hooks=up;constructor(...n){this.use(...n)}walkTokens(n,e){let t=[];for(let r of n)switch(t=t.concat(e.call(this,r)),r.type){case"table":{let i=r;for(let s of i.header)t=t.concat(this.walkTokens(s.tokens,e));for(let s of i.rows)for(let o of s)t=t.concat(this.walkTokens(o.tokens,e));break}case"list":{let i=r;t=t.concat(this.walkTokens(i.items,e));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let o=i[s].flat(1/0);t=t.concat(this.walkTokens(o,e))}):i.tokens&&(t=t.concat(this.walkTokens(i.tokens,e)))}}return t}use(...n){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{let r={...t};if(r.async=this.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let s=e.renderers[i.name];s?e.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[i.level];s?s.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),t.renderer){let i=this.defaults.renderer||new F0(this.defaults);for(let s in t.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=t.renderer[o],l=i[o];i[o]=(...c)=>{let d=a.apply(i,c);return d===!1&&(d=l.apply(i,c)),d||""}}r.renderer=i}if(t.tokenizer){let i=this.defaults.tokenizer||new $0(this.defaults);for(let s in t.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=t.tokenizer[o],l=i[o];i[o]=(...c)=>{let d=a.apply(i,c);return d===!1&&(d=l.apply(i,c)),d}}r.tokenizer=i}if(t.hooks){let i=this.defaults.hooks||new up;for(let s in t.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=t.hooks[o],l=i[o];up.passThroughHooks.has(s)?i[o]=c=>{if(this.defaults.async&&up.passThroughHooksRespectAsync.has(s))return(async()=>{let h=await a.call(i,c);return l.call(i,h)})();let d=a.call(i,c);return l.call(i,d)}:i[o]=(...c)=>{if(this.defaults.async)return(async()=>{let h=await a.apply(i,c);return h===!1&&(h=await l.apply(i,c)),h})();let d=a.apply(i,c);return d===!1&&(d=l.apply(i,c)),d}}r.hooks=i}if(t.walkTokens){let i=this.defaults.walkTokens,s=t.walkTokens;r.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...r}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return Qo.lex(n,e??this.defaults)}parser(n,e){return $o.parse(n,e??this.defaults)}parseMarkdown(n){return(e,t)=>{let r={...t},i={...this.defaults,...r},s=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=n),i.async)return(async()=>{let o=i.hooks?await i.hooks.preprocess(e):e,a=await(i.hooks?await i.hooks.provideLexer():n?Qo.lex:Qo.lexInline)(o,i),l=i.hooks?await i.hooks.processAllTokens(a):a;i.walkTokens&&await Promise.all(this.walkTokens(l,i.walkTokens));let c=await(i.hooks?await i.hooks.provideParser():n?$o.parse:$o.parseInline)(l,i);return i.hooks?await i.hooks.postprocess(c):c})().catch(s);try{i.hooks&&(e=i.hooks.preprocess(e));let o=(i.hooks?i.hooks.provideLexer():n?Qo.lex:Qo.lexInline)(e,i);i.hooks&&(o=i.hooks.processAllTokens(o)),i.walkTokens&&this.walkTokens(o,i.walkTokens);let a=(i.hooks?i.hooks.provideParser():n?$o.parse:$o.parseInline)(o,i);return i.hooks&&(a=i.hooks.postprocess(a)),a}catch(o){return s(o)}}}onError(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){let r="<p>An error occurred:</p><pre>"+fa(t.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(t);throw t}}},Nu=new VTe;function zn(n,e){return Nu.parse(n,e)}zn.options=zn.setOptions=function(n){return Nu.setOptions(n),zn.defaults=Nu.defaults,wU(zn.defaults),zn};zn.getDefaults=PT;zn.defaults=Ju;zn.use=function(...n){return Nu.use(...n),zn.defaults=Nu.defaults,wU(zn.defaults),zn};zn.walkTokens=function(n,e){return Nu.walkTokens(n,e)};zn.parseInline=Nu.parseInline;zn.Parser=$o;zn.parser=$o.parse;zn.Renderer=F0;zn.TextRenderer=$T;zn.Lexer=Qo;zn.lexer=Qo.lex;zn.Tokenizer=$0;zn.Hooks=up;zn.parse=zn;zn.options;zn.setOptions;zn.use;zn.walkTokens;zn.parseInline;$o.parse;Qo.lex;/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:IU,setPrototypeOf:KR,isFrozen:qTe,getPrototypeOf:HTe,getOwnPropertyDescriptor:ZTe}=Object;let{freeze:Hi,seal:_o,create:vk}=Object,{apply:yk,construct:bk}=typeof Reflect<"u"&&Reflect;Hi||(Hi=function(e){return e});_o||(_o=function(e){return e});yk||(yk=function(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return e.apply(t,i)});bk||(bk=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return new e(...r)});const Iv=Zi(Array.prototype.forEach),WTe=Zi(Array.prototype.lastIndexOf),JR=Zi(Array.prototype.pop),qf=Zi(Array.prototype.push),XTe=Zi(Array.prototype.splice),ly=Zi(String.prototype.toLowerCase),x_=Zi(String.prototype.toString),k_=Zi(String.prototype.match),Hf=Zi(String.prototype.replace),YTe=Zi(String.prototype.indexOf),GTe=Zi(String.prototype.trim),Do=Zi(Object.prototype.hasOwnProperty),Pi=Zi(RegExp.prototype.test),Zf=KTe(TypeError);function Zi(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return yk(n,e,r)}}function KTe(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return bk(n,t)}}function fn(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ly;KR&&KR(n,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const s=t(i);s!==i&&(qTe(e)||(e[r]=s),i=s)}n[i]=!0}return n}function JTe(n){for(let e=0;e<n.length;e++)Do(n,e)||(n[e]=null);return n}function nl(n){const e=vk(null);for(const[t,r]of IU(n))Do(n,t)&&(Array.isArray(r)?e[t]=JTe(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=nl(r):e[t]=r);return e}function Wf(n,e){for(;n!==null;){const r=ZTe(n,e);if(r){if(r.get)return Zi(r.get);if(typeof r.value=="function")return Zi(r.value)}n=HTe(n)}function t(){return null}return t}const eD=Hi(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),S_=Hi(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),T_=Hi(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),eAe=Hi(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),A_=Hi(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),tAe=Hi(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),tD=Hi(["#text"]),nD=Hi(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),C_=Hi(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),rD=Hi(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Mv=Hi(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),nAe=_o(/\{\{[\w\W]*|[\w\W]*\}\}/gm),rAe=_o(/<%[\w\W]*|[\w\W]*%>/gm),iAe=_o(/\$\{[\w\W]*/gm),sAe=_o(/^data-[\-\w.\u00B7-\uFFFF]+$/),oAe=_o(/^aria-[\-\w]+$/),MU=_o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),aAe=_o(/^(?:\w+script|data):/i),lAe=_o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),RU=_o(/^html$/i),cAe=_o(/^[a-z][.\w]*(-[.\w]+)+$/i);var iD=Object.freeze({__proto__:null,ARIA_ATTR:oAe,ATTR_WHITESPACE:lAe,CUSTOM_ELEMENT:cAe,DATA_ATTR:sAe,DOCTYPE_NAME:RU,ERB_EXPR:rAe,IS_ALLOWED_URI:MU,IS_SCRIPT_OR_DATA:aAe,MUSTACHE_EXPR:nAe,TMPLIT_EXPR:iAe});const Xf={element:1,text:3,progressingInstruction:7,comment:8,document:9},uAe=function(){return typeof window>"u"?null:window},dAe=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(r=t.getAttribute(i));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},sD=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function DU(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:uAe();const e=Je=>DU(Je);if(e.version="3.3.0",e.removed=[],!n||!n.document||n.document.nodeType!==Xf.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:d=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:h,DOMParser:f,trustedTypes:p}=n,g=l.prototype,m=Wf(g,"cloneNode"),v=Wf(g,"remove"),y=Wf(g,"nextSibling"),O=Wf(g,"childNodes"),_=Wf(g,"parentNode");if(typeof o=="function"){const Je=t.createElement("template");Je.content&&Je.content.ownerDocument&&(t=Je.content.ownerDocument)}let x,k="";const{implementation:S,createNodeIterator:E,createDocumentFragment:R,getElementsByTagName:C}=t,{importNode:I}=r;let D=sD();e.isSupported=typeof IU=="function"&&typeof _=="function"&&S&&S.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Q,ERB_EXPR:M,TMPLIT_EXPR:N,DATA_ATTR:B,ARIA_ATTR:H,IS_SCRIPT_OR_DATA:F,ATTR_WHITESPACE:Z,CUSTOM_ELEMENT:$}=iD;let{IS_ALLOWED_URI:W}=iD,G=null;const L=fn({},[...eD,...S_,...T_,...A_,...tD]);let q=null;const ue=fn({},[...nD,...C_,...rD,...Mv]);let oe=Object.seal(vk(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),fe=null,be=null;const De=Object.seal(vk(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Le=!0,he=!0,se=!1,V=!0,ne=!1,ee=!0,U=!1,X=!1,ie=!1,ye=!1,pe=!1,de=!1,we=!0,me=!1;const Ee="user-content-";let _e=!0,Ae=!1,ze={},Be=null;const Se=fn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Re=null;const He=fn({},["audio","video","img","source","image","track"]);let Me=null;const Pe=fn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ae="http://www.w3.org/1998/Math/MathML",te="http://www.w3.org/2000/svg",re="http://www.w3.org/1999/xhtml";let ve=re,Te=!1,Ne=null;const ce=fn({},[ae,te,re],x_);let Oe=fn({},["mi","mo","mn","ms","mtext"]),Qe=fn({},["annotation-xml"]);const We=fn({},["title","style","font","a","script"]);let st=null;const it=["application/xhtml+xml","text/html"],Ct="text/html";let bt=null,xt=null;const mt=t.createElement("form"),Ge=function(ge){return ge instanceof RegExp||ge instanceof Function},Xe=function(){let ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(xt&&xt===ge)){if((!ge||typeof ge!="object")&&(ge={}),ge=nl(ge),st=it.indexOf(ge.PARSER_MEDIA_TYPE)===-1?Ct:ge.PARSER_MEDIA_TYPE,bt=st==="application/xhtml+xml"?x_:ly,G=Do(ge,"ALLOWED_TAGS")?fn({},ge.ALLOWED_TAGS,bt):L,q=Do(ge,"ALLOWED_ATTR")?fn({},ge.ALLOWED_ATTR,bt):ue,Ne=Do(ge,"ALLOWED_NAMESPACES")?fn({},ge.ALLOWED_NAMESPACES,x_):ce,Me=Do(ge,"ADD_URI_SAFE_ATTR")?fn(nl(Pe),ge.ADD_URI_SAFE_ATTR,bt):Pe,Re=Do(ge,"ADD_DATA_URI_TAGS")?fn(nl(He),ge.ADD_DATA_URI_TAGS,bt):He,Be=Do(ge,"FORBID_CONTENTS")?fn({},ge.FORBID_CONTENTS,bt):Se,fe=Do(ge,"FORBID_TAGS")?fn({},ge.FORBID_TAGS,bt):nl({}),be=Do(ge,"FORBID_ATTR")?fn({},ge.FORBID_ATTR,bt):nl({}),ze=Do(ge,"USE_PROFILES")?ge.USE_PROFILES:!1,Le=ge.ALLOW_ARIA_ATTR!==!1,he=ge.ALLOW_DATA_ATTR!==!1,se=ge.ALLOW_UNKNOWN_PROTOCOLS||!1,V=ge.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ne=ge.SAFE_FOR_TEMPLATES||!1,ee=ge.SAFE_FOR_XML!==!1,U=ge.WHOLE_DOCUMENT||!1,ye=ge.RETURN_DOM||!1,pe=ge.RETURN_DOM_FRAGMENT||!1,de=ge.RETURN_TRUSTED_TYPE||!1,ie=ge.FORCE_BODY||!1,we=ge.SANITIZE_DOM!==!1,me=ge.SANITIZE_NAMED_PROPS||!1,_e=ge.KEEP_CONTENT!==!1,Ae=ge.IN_PLACE||!1,W=ge.ALLOWED_URI_REGEXP||MU,ve=ge.NAMESPACE||re,Oe=ge.MATHML_TEXT_INTEGRATION_POINTS||Oe,Qe=ge.HTML_INTEGRATION_POINTS||Qe,oe=ge.CUSTOM_ELEMENT_HANDLING||{},ge.CUSTOM_ELEMENT_HANDLING&&Ge(ge.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(oe.tagNameCheck=ge.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ge.CUSTOM_ELEMENT_HANDLING&&Ge(ge.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(oe.attributeNameCheck=ge.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ge.CUSTOM_ELEMENT_HANDLING&&typeof ge.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(oe.allowCustomizedBuiltInElements=ge.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ne&&(he=!1),pe&&(ye=!0),ze&&(G=fn({},tD),q=[],ze.html===!0&&(fn(G,eD),fn(q,nD)),ze.svg===!0&&(fn(G,S_),fn(q,C_),fn(q,Mv)),ze.svgFilters===!0&&(fn(G,T_),fn(q,C_),fn(q,Mv)),ze.mathMl===!0&&(fn(G,A_),fn(q,rD),fn(q,Mv))),ge.ADD_TAGS&&(typeof ge.ADD_TAGS=="function"?De.tagCheck=ge.ADD_TAGS:(G===L&&(G=nl(G)),fn(G,ge.ADD_TAGS,bt))),ge.ADD_ATTR&&(typeof ge.ADD_ATTR=="function"?De.attributeCheck=ge.ADD_ATTR:(q===ue&&(q=nl(q)),fn(q,ge.ADD_ATTR,bt))),ge.ADD_URI_SAFE_ATTR&&fn(Me,ge.ADD_URI_SAFE_ATTR,bt),ge.FORBID_CONTENTS&&(Be===Se&&(Be=nl(Be)),fn(Be,ge.FORBID_CONTENTS,bt)),_e&&(G["#text"]=!0),U&&fn(G,["html","head","body"]),G.table&&(fn(G,["tbody"]),delete fe.tbody),ge.TRUSTED_TYPES_POLICY){if(typeof ge.TRUSTED_TYPES_POLICY.createHTML!="function")throw Zf('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof ge.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Zf('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');x=ge.TRUSTED_TYPES_POLICY,k=x.createHTML("")}else x===void 0&&(x=dAe(p,i)),x!==null&&typeof k=="string"&&(k=x.createHTML(""));Hi&&Hi(ge),xt=ge}},ft=fn({},[...S_,...T_,...eAe]),at=fn({},[...A_,...tAe]),pt=function(ge){let Ze=_(ge);(!Ze||!Ze.tagName)&&(Ze={namespaceURI:ve,tagName:"template"});const ht=ly(ge.tagName),Jt=ly(Ze.tagName);return Ne[ge.namespaceURI]?ge.namespaceURI===te?Ze.namespaceURI===re?ht==="svg":Ze.namespaceURI===ae?ht==="svg"&&(Jt==="annotation-xml"||Oe[Jt]):!!ft[ht]:ge.namespaceURI===ae?Ze.namespaceURI===re?ht==="math":Ze.namespaceURI===te?ht==="math"&&Qe[Jt]:!!at[ht]:ge.namespaceURI===re?Ze.namespaceURI===te&&!Qe[Jt]||Ze.namespaceURI===ae&&!Oe[Jt]?!1:!at[ht]&&(We[ht]||!ft[ht]):!!(st==="application/xhtml+xml"&&Ne[ge.namespaceURI]):!1},dt=function(ge){qf(e.removed,{element:ge});try{_(ge).removeChild(ge)}catch{v(ge)}},_t=function(ge,Ze){try{qf(e.removed,{attribute:Ze.getAttributeNode(ge),from:Ze})}catch{qf(e.removed,{attribute:null,from:Ze})}if(Ze.removeAttribute(ge),ge==="is")if(ye||pe)try{dt(Ze)}catch{}else try{Ze.setAttribute(ge,"")}catch{}},wt=function(ge){let Ze=null,ht=null;if(ie)ge="<remove></remove>"+ge;else{const yn=k_(ge,/^[\r\n\t ]+/);ht=yn&&yn[0]}st==="application/xhtml+xml"&&ve===re&&(ge='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ge+"</body></html>");const Jt=x?x.createHTML(ge):ge;if(ve===re)try{Ze=new f().parseFromString(Jt,st)}catch{}if(!Ze||!Ze.documentElement){Ze=S.createDocument(ve,"template",null);try{Ze.documentElement.innerHTML=Te?k:Jt}catch{}}const mn=Ze.body||Ze.documentElement;return ge&&ht&&mn.insertBefore(t.createTextNode(ht),mn.childNodes[0]||null),ve===re?C.call(Ze,U?"html":"body")[0]:U?Ze.documentElement:mn},Rt=function(ge){return E.call(ge.ownerDocument||ge,ge,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Et=function(ge){return ge instanceof h&&(typeof ge.nodeName!="string"||typeof ge.textContent!="string"||typeof ge.removeChild!="function"||!(ge.attributes instanceof d)||typeof ge.removeAttribute!="function"||typeof ge.setAttribute!="function"||typeof ge.namespaceURI!="string"||typeof ge.insertBefore!="function"||typeof ge.hasChildNodes!="function")},$t=function(ge){return typeof a=="function"&&ge instanceof a};function jt(Je,ge,Ze){Iv(Je,ht=>{ht.call(e,ge,Ze,xt)})}const Kt=function(ge){let Ze=null;if(jt(D.beforeSanitizeElements,ge,null),Et(ge))return dt(ge),!0;const ht=bt(ge.nodeName);if(jt(D.uponSanitizeElement,ge,{tagName:ht,allowedTags:G}),ee&&ge.hasChildNodes()&&!$t(ge.firstElementChild)&&Pi(/<[/\w!]/g,ge.innerHTML)&&Pi(/<[/\w!]/g,ge.textContent)||ge.nodeType===Xf.progressingInstruction||ee&&ge.nodeType===Xf.comment&&Pi(/<[/\w]/g,ge.data))return dt(ge),!0;if(!(De.tagCheck instanceof Function&&De.tagCheck(ht))&&(!G[ht]||fe[ht])){if(!fe[ht]&&Nt(ht)&&(oe.tagNameCheck instanceof RegExp&&Pi(oe.tagNameCheck,ht)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(ht)))return!1;if(_e&&!Be[ht]){const Jt=_(ge)||ge.parentNode,mn=O(ge)||ge.childNodes;if(mn&&Jt){const yn=mn.length;for(let Yn=yn-1;Yn>=0;--Yn){const vr=m(mn[Yn],!0);vr.__removalCount=(ge.__removalCount||0)+1,Jt.insertBefore(vr,y(ge))}}}return dt(ge),!0}return ge instanceof l&&!pt(ge)||(ht==="noscript"||ht==="noembed"||ht==="noframes")&&Pi(/<\/no(script|embed|frames)/i,ge.innerHTML)?(dt(ge),!0):(ne&&ge.nodeType===Xf.text&&(Ze=ge.textContent,Iv([Q,M,N],Jt=>{Ze=Hf(Ze,Jt," ")}),ge.textContent!==Ze&&(qf(e.removed,{element:ge.cloneNode()}),ge.textContent=Ze)),jt(D.afterSanitizeElements,ge,null),!1)},Zt=function(ge,Ze,ht){if(we&&(Ze==="id"||Ze==="name")&&(ht in t||ht in mt))return!1;if(!(he&&!be[Ze]&&Pi(B,Ze))){if(!(Le&&Pi(H,Ze))){if(!(De.attributeCheck instanceof Function&&De.attributeCheck(Ze,ge))){if(!q[Ze]||be[Ze]){if(!(Nt(ge)&&(oe.tagNameCheck instanceof RegExp&&Pi(oe.tagNameCheck,ge)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(ge))&&(oe.attributeNameCheck instanceof RegExp&&Pi(oe.attributeNameCheck,Ze)||oe.attributeNameCheck instanceof Function&&oe.attributeNameCheck(Ze,ge))||Ze==="is"&&oe.allowCustomizedBuiltInElements&&(oe.tagNameCheck instanceof RegExp&&Pi(oe.tagNameCheck,ht)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(ht))))return!1}else if(!Me[Ze]){if(!Pi(W,Hf(ht,Z,""))){if(!((Ze==="src"||Ze==="xlink:href"||Ze==="href")&&ge!=="script"&&YTe(ht,"data:")===0&&Re[ge])){if(!(se&&!Pi(F,Hf(ht,Z,"")))){if(ht)return!1}}}}}}}return!0},Nt=function(ge){return ge!=="annotation-xml"&&k_(ge,$)},Yt=function(ge){jt(D.beforeSanitizeAttributes,ge,null);const{attributes:Ze}=ge;if(!Ze||Et(ge))return;const ht={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:q,forceKeepAttr:void 0};let Jt=Ze.length;for(;Jt--;){const mn=Ze[Jt],{name:yn,namespaceURI:Yn,value:vr}=mn,Wi=bt(yn),pi=vr;let Vn=yn==="value"?pi:GTe(pi);if(ht.attrName=Wi,ht.attrValue=Vn,ht.keepAttr=!0,ht.forceKeepAttr=void 0,jt(D.uponSanitizeAttribute,ge,ht),Vn=ht.attrValue,me&&(Wi==="id"||Wi==="name")&&(_t(yn,ge),Vn=Ee+Vn),ee&&Pi(/((--!?|])>)|<\/(style|title|textarea)/i,Vn)){_t(yn,ge);continue}if(Wi==="attributename"&&k_(Vn,"href")){_t(yn,ge);continue}if(ht.forceKeepAttr)continue;if(!ht.keepAttr){_t(yn,ge);continue}if(!V&&Pi(/\/>/i,Vn)){_t(yn,ge);continue}ne&&Iv([Q,M,N],Ao=>{Vn=Hf(Vn,Ao," ")});const To=bt(ge.nodeName);if(!Zt(To,Wi,Vn)){_t(yn,ge);continue}if(x&&typeof p=="object"&&typeof p.getAttributeType=="function"&&!Yn)switch(p.getAttributeType(To,Wi)){case"TrustedHTML":{Vn=x.createHTML(Vn);break}case"TrustedScriptURL":{Vn=x.createScriptURL(Vn);break}}if(Vn!==pi)try{Yn?ge.setAttributeNS(Yn,yn,Vn):ge.setAttribute(yn,Vn),Et(ge)?dt(ge):JR(e.removed)}catch{_t(yn,ge)}}jt(D.afterSanitizeAttributes,ge,null)},ln=function Je(ge){let Ze=null;const ht=Rt(ge);for(jt(D.beforeSanitizeShadowDOM,ge,null);Ze=ht.nextNode();)jt(D.uponSanitizeShadowNode,Ze,null),Kt(Ze),Yt(Ze),Ze.content instanceof s&&Je(Ze.content);jt(D.afterSanitizeShadowDOM,ge,null)};return e.sanitize=function(Je){let ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ze=null,ht=null,Jt=null,mn=null;if(Te=!Je,Te&&(Je="<!-->"),typeof Je!="string"&&!$t(Je))if(typeof Je.toString=="function"){if(Je=Je.toString(),typeof Je!="string")throw Zf("dirty is not a string, aborting")}else throw Zf("toString is not a function");if(!e.isSupported)return Je;if(X||Xe(ge),e.removed=[],typeof Je=="string"&&(Ae=!1),Ae){if(Je.nodeName){const vr=bt(Je.nodeName);if(!G[vr]||fe[vr])throw Zf("root node is forbidden and cannot be sanitized in-place")}}else if(Je instanceof a)Ze=wt("<!---->"),ht=Ze.ownerDocument.importNode(Je,!0),ht.nodeType===Xf.element&&ht.nodeName==="BODY"||ht.nodeName==="HTML"?Ze=ht:Ze.appendChild(ht);else{if(!ye&&!ne&&!U&&Je.indexOf("<")===-1)return x&&de?x.createHTML(Je):Je;if(Ze=wt(Je),!Ze)return ye?null:de?k:""}Ze&&ie&&dt(Ze.firstChild);const yn=Rt(Ae?Je:Ze);for(;Jt=yn.nextNode();)Kt(Jt),Yt(Jt),Jt.content instanceof s&&ln(Jt.content);if(Ae)return Je;if(ye){if(pe)for(mn=R.call(Ze.ownerDocument);Ze.firstChild;)mn.appendChild(Ze.firstChild);else mn=Ze;return(q.shadowroot||q.shadowrootmode)&&(mn=I.call(r,mn,!0)),mn}let Yn=U?Ze.outerHTML:Ze.innerHTML;return U&&G["!doctype"]&&Ze.ownerDocument&&Ze.ownerDocument.doctype&&Ze.ownerDocument.doctype.name&&Pi(RU,Ze.ownerDocument.doctype.name)&&(Yn="<!DOCTYPE "+Ze.ownerDocument.doctype.name+`>
`+Yn),ne&&Iv([Q,M,N],vr=>{Yn=Hf(Yn,vr," ")}),x&&de?x.createHTML(Yn):Yn},e.setConfig=function(){let Je=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Xe(Je),X=!0},e.clearConfig=function(){xt=null,X=!1},e.isValidAttribute=function(Je,ge,Ze){xt||Xe({});const ht=bt(Je),Jt=bt(ge);return Zt(ht,Jt,Ze)},e.addHook=function(Je,ge){typeof ge=="function"&&qf(D[Je],ge)},e.removeHook=function(Je,ge){if(ge!==void 0){const Ze=WTe(D[Je],ge);return Ze===-1?void 0:XTe(D[Je],Ze,1)[0]}return JR(D[Je])},e.removeHooks=function(Je){D[Je]=[]},e.removeAllHooks=function(){D=sD()},e}var FT=DU(),hAe=P('<div class="markdown-content svelte-1uj2rd5" role="button" aria-label="Rendered markdown with clickable note links" tabindex="0"><!></div>');function Wh(n,e){lt(e,!0);function t(f){let p=f;return p=p.replace(/([^\n])\n(#{1,6}\s)/g,`$1

$2`),p=p.replace(/([^\n\s])(#{1,6}\s)/g,`$1

$2`),p=p.replace(/([^\n])\n([-*]{3,})\n/g,`$1

$2

`),p=p.replace(/\n([-*]{3,})\n([^\n])/g,`

$1

$2`),p=p.replace(/([^\n])\n(```)/g,`$1

$2`),p=p.replace(/(```)\n([^\n`])/g,`$1

$2`),p=p.replace(/([^\n>])\n(>\s)/g,`$1

$2`),p}function r(f){const p=[],g=/`([^`]+)`/g;let m,v=f;for(;(m=g.exec(f))!==null;){const y=`__CODE_SPAN_${p.length}__`;p.push(m[0]),v=v.replace(m[0],y)}return{text:v,codeSpans:p}}function i(f,p){let g=f;return p.forEach((m,v)=>{g=g.replace(`__CODE_SPAN_${v}__`,m)}),g}function s(f){const p=[],g=/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]|\[([^\]]+)\]|(\b[\w-]+\.md\b)|(NOTE_LINK_\d+)|(\b\d{4}-W\d{2}\b)/g;let m,v=f;for(;(m=g.exec(f))!==null;){let y,O;if(m[1])y=m[1],O=m[2]||Zn(y)?.title||y;else if(m[3])y=m[3],O=Zn(y)?.title||y;else if(m[4])y=m[4],O=m[4];else if(m[5])y=m[5],O=m[5];else if(m[6])y=m[6],O=m[6];else continue;const _={id:`NOTELINK${p.length}PLACEHOLDER`,noteId:y,displayText:O};p.push(_),v=v.replace(m[0],_.id)}return{text:v,noteLinks:p}}function o(f,p){let g=f;return p.forEach(m=>{const v=`<button class="note-link" data-note-id="${m.noteId}" title="Click to open note">${m.displayText}</button>`;g=g.replaceAll(m.id,v)}),g}const a=le(()=>{const f=t(e.text),{text:p,codeSpans:g}=r(f),{text:m,noteLinks:v}=s(p),y=i(m,g);let O;const _=zn.parse(y);if(typeof _=="string")O=_;else return"<div>Loading...</div>";return O=o(O,v),FT.sanitize(O,{ALLOWED_TAGS:["p","strong","b","em","i","code","pre","ul","ol","li","blockquote","h1","h2","h3","h4","h5","h6","br","button","span","div","img"],ALLOWED_ATTR:["class","data-note-id","title"],ALLOW_DATA_ATTR:!0,KEEP_CONTENT:!0})});function l(f){const p=f.target;if(p.classList.contains("note-link")){const g=p.getAttribute("data-note-id");if(g){const m=f;e.onNoteClick?.(g,m.shiftKey)}}}function c(f){(f.key==="Enter"||f.key===" ")&&l(f)}var d=hAe();d.__click=l,d.__keydown=c;var h=w(d);Fk(h,()=>u(a)),T(n,d),ct()}yt(["click","keydown"]);const fAe="flint:editor-position:",pAe=1e3;function NU(n){return`${fAe}${n}`}function oD(n,e){try{const t={...e,timestamp:Date.now()};localStorage.setItem(NU(n),JSON.stringify(t))}catch{}}function LU(n){try{const e=localStorage.getItem(NU(n));return e?JSON.parse(e):null}catch{return null}}function gAe(n){const e=LU(n);return e!==null&&e.scrollTop>0}function mAe(n){if(!n)return null;let e=n.parentElement;for(;e;){const r=getComputedStyle(e).overflowY;if(r==="auto"||r==="scroll")return e;e=e.parentElement}return null}function vAe(n,e){let t=null,r=null,i=null,s=null,o=null;function a(){if(o)return o;const f=e();return f?(o=mAe(f.dom),o):null}function l(){const f=e(),p=a();!f||!p||(t&&clearTimeout(t),t=setTimeout(()=>{const g=e(),m=a();if(!g||!m)return;const v=g.state.selection.main.anchor,y=Math.round(m.scrollTop);(v!==r||y!==i)&&(oD(n,{cursorPosition:v,scrollTop:y}),r=v,i=y)},pAe))}function c(f){const p=e(),g=a();if(!p||!g){f?.();return}const m=LU(n);if(!m){g.style.visibility="",f?.();return}if(m.cursorPosition!==void 0){const v=p.state.doc.length,y=Math.min(m.cursorPosition,v);p.dispatch({selection:{anchor:y},scrollIntoView:!1}),r=y}if(m.scrollTop!==void 0&&m.scrollTop>0){const v=m.scrollTop;let y=0;const O=5,_=()=>{const x=a();if(!x){f?.();return}x.scrollTop=v,i=v,y++,x.scrollTop<v&&y<O?requestAnimationFrame(_):(x.style.visibility="",f?.())};requestAnimationFrame(_)}else g.style.visibility="",f?.()}function d(){const f=a();f&&(s=()=>l(),f.addEventListener("scroll",s))}function h(){t&&(clearTimeout(t),t=null);const f=a();f&&s&&(f.removeEventListener("scroll",s),s=null);const p=e();if(p&&f){const g=p.state.selection.main.anchor,m=Math.round(f.scrollTop);(g!==r||m!==i)&&oD(n,{cursorPosition:g,scrollTop:m})}o=null}return{savePosition:l,restorePosition:c,attachScrollListener:d,cleanup:h}}var yAe=P('<div class="archived-banner svelte-1d8887u"><span class="archived-text svelte-1d8887u">This note is archived</span> <button class="unarchive-button svelte-1d8887u">Unarchive</button></div>'),bAe=P('<div class="editor-loading svelte-1d8887u"><span class="loading-text svelte-1d8887u">Loading...</span></div>'),wAe=P('<div class="preview-container editor-font svelte-1d8887u"><!></div>'),_Ae=P('<div class="editor-container editor-font svelte-1d8887u"></div>'),OAe=P('<div class="note-editor svelte-1d8887u"><!> <div class="editor-header svelte-1d8887u"><!></div>  <div class="editor-content svelte-1d8887u"><!></div> <!></div> <div role="tooltip"><!></div> <div role="tooltip"><!></div>',1);function xAe(n,e){lt(e,!0);let t=et(e,"previewMode",3,!1);const r=le(()=>e.note.archived),i=le(()=>t()||u(r));let s=j(null),o=j(null),a=j(Qt(e.note.id)),l=j(!1),c=j(0),d=j(0),h=j(""),f=j(""),p=j(0),g=j(0),m=j(void 0),v=null,y=j(!1),O=j(0),_=j(0),x=j(!1),k=j(null),S=j(null),E=null,R=null,C=j(null),I=j(!0),D=j("");const Q=le(()=>u(C)&&u(C).doc()?.content||u(D));let M=null,N=null;function B(ce){return new tT({onWikilinkClick:Z,onWikilinkHover:De,onWikilinkEditDisplayText:V,onCursorChange:()=>N?.savePosition(),placeholder:"Start writing...",onDeckNoteOpen:Oe=>{e.onNavigate?e.onNavigate(Oe):(Rs(Oe),El(Oe))},automergeSync:ce?{handle:ce,path:["content"]}:void 0})}let H=B(null);tt(()=>{const ce=e.note.id;ce!==M&&(N?.cleanup(),N=null,M=ce,b(I,!0),b(C,null),Yp(ce).then(Oe=>{if(Oe&&e.note.id===ce){b(C,Oe,!0);const Qe=Oe.doc();b(D,Qe?.content||"",!0),b(I,!1)}}))});function F(){u(o)?.focus()}async function Z(ce,Oe,Qe){const We=Qe?.targetType||"note",st=Qe?.shouldCreate||!1;if(b(y,!1),b(x,!1),E&&(clearTimeout(E),E=null),R&&(clearTimeout(R),R=null),We==="conversation")AS(ce),Dr({type:"conversation",id:ce});else if(We==="type")mu(ce),Fn("types");else if(st){const it=await zs({title:Oe});El(it),Rs(it),e.onNavigate?.(it)}else Rs(ce),e.onNavigate?.(ce)}let $=j(Qt([]));tt(()=>{const ce=e.note.id;x5(ce).then(Oe=>{e.note.id===ce&&b($,Oe,!0)})});const W=le(()=>jr(e.note.type));function G(ce,Oe){aJ(e.note.id,ce,Oe)}function L(ce){(ce.metaKey||ce.ctrlKey)&&ce.key==="s"&&ce.preventDefault()}function q(ce){if(!u(o)||!u(s))return;const Oe=u(o).contentDOM.getBoundingClientRect();if(ce.clientY>Oe.bottom){const Qe=u(o).state.doc.length;u(o).dispatch({selection:{anchor:Qe},scrollIntoView:!0}),u(o).focus()}}function ue(){if(!u(s)||u(o))return;const ce=un.create({doc:u(D),extensions:H.getExtensions()});b(o,new gt({state:ce,parent:u(s)}),!0),oe()}function oe(){u(o)&&setTimeout(()=>{if(u(o)){const ce=CT(u(o).dom);ET(ce)}},10)}qr(()=>(H.initializeTheme(),()=>{N?.cleanup(),N=null,u(o)&&(u(o).destroy(),b(o,null)),H.destroy()}));function fe(ce){if(!ce)return null;let Oe=ce.parentElement;for(;Oe;){const Qe=getComputedStyle(Oe);if(Qe.overflowY==="auto"||Qe.overflowY==="scroll")return Oe;Oe=Oe.parentElement}return null}tt(()=>{if(u(s)&&!u(I)&&u(C)){const ce=u(o)&&u(o).dom.parentElement!==u(s);if(!u(o)||e.note.id!==u(a)||ce){const Qe=fe(u(s)),We=gAe(e.note.id);Qe&&We&&(Qe.style.visibility="hidden"),u(o)&&(u(o).destroy(),b(o,null)),H.destroy(),H=B(u(C)),H.initializeTheme(),ue(),N=vAe(e.note.id,()=>u(o)),N.attachScrollListener(),setTimeout(()=>{N?.restorePosition(()=>{u(o)?.focus()})},100),b(a,e.note.id,!0)}}}),tt(()=>{H.isDarkMode,u(o)&&(u(o).dispatch({effects:en.reconfigure.of(H.getExtensions())}),oe())}),tt(()=>{cs(),u(o)&&setTimeout(()=>{u(o)&&jh(u(o))},50)});function be(ce){Rs(ce),e.onNavigate?.(ce)}function De(ce){if(R&&(clearTimeout(R),R=null),ce){if(u(l))return;if(u(y)&&u(x)){E&&(clearTimeout(E),E=null),b(k,{identifier:ce.identifier,title:ce.displayText,exists:ce.exists,noteId:ce.noteId,targetType:ce.targetType,conversationId:ce.conversationId},!0),b(p,ce.from,!0),b(g,ce.to,!0),b(h,ce.identifier,!0),b(f,ce.displayText,!0),b(S,{left:ce.x,top:ce.yTop,bottom:ce.y,height:ce.y-ce.yTop},!0);const Oe=Le(u(S).left,u(S).top,u(S).bottom,200,60);b(O,Oe.x,!0),b(_,Oe.y,!0);return}E&&clearTimeout(E),E=setTimeout(()=>{if(u(l))return;b(k,{identifier:ce.identifier,title:ce.displayText,exists:ce.exists,noteId:ce.noteId,targetType:ce.targetType,conversationId:ce.conversationId},!0),b(p,ce.from,!0),b(g,ce.to,!0),b(h,ce.identifier,!0),b(f,ce.displayText,!0),b(S,{left:ce.x,top:ce.yTop,bottom:ce.y,height:ce.y-ce.yTop},!0);const Oe=Le(u(S).left,u(S).top,u(S).bottom,200,60);b(O,Oe.x,!0),b(_,Oe.y,!0),b(y,!0),b(x,!0),E=null},300)}else E&&(clearTimeout(E),E=null),u(x)&&(R=setTimeout(()=>{b(y,!1),b(x,!1),R=null},200))}function Le(ce,Oe,Qe,We,st){const bt=window.innerWidth,xt=window.innerHeight;let mt=ce,Ge;return mt+We+8>bt&&(mt=bt-We-8),mt<8&&(mt=8),xt-Qe>=st+8+4?Ge=Qe+4:Ge=Oe-4-st,Ge+st>xt-8&&(Ge=xt-st-8),Ge<8&&(Ge=8),{x:mt,y:Ge}}function he(){if(!u(k))return;const ce=u(k);ce.targetType==="conversation"?ce.exists&&ce.conversationId&&Z(ce.conversationId,ce.title,{targetType:"conversation"}):ce.exists&&ce.noteId?Z(ce.noteId,ce.title,{targetType:"note"}):Z(ce.identifier,ce.title,{shouldCreate:!0,targetType:"note"}),b(y,!1),b(x,!1)}function se(){if(!u(o)||!u(k)||!u(S))return;const ce=u(o).state.selection.main;if(v={anchor:ce.anchor,head:ce.head},b(y,!1),b(h,u(k).identifier,!0),u(k).identifier===u(k).title)if(u(k).targetType==="conversation")if(u(k).conversationId&&u(k).exists){const We=xu(u(k).conversationId);b(f,We?.title||u(k).title,!0)}else b(f,u(k).title,!0);else if(u(k).noteId&&u(k).exists){const st=cs().find(it=>it.id===u(k).noteId);b(f,st?.title||u(k).title,!0)}else b(f,u(k).title,!0);else b(f,u(k).title,!0);const Oe=p0(u(o));Oe&&(b(p,Oe.from,!0),b(g,Oe.to,!0));const Qe=Le(u(S).left,u(S).top,u(S).bottom,400,100);b(c,Qe.x,!0),b(d,Qe.y,!0),b(l,!0)}function V(ce){if(!u(o))return;const Oe=u(o).state.selection.main;if(v={anchor:Oe.anchor,head:Oe.head},b(y,!1),b(h,ce.identifier,!0),ce.identifier===ce.title)if(ce.targetType==="conversation")if(ce.conversationId&&ce.exists){const We=xu(ce.conversationId);b(f,We?.title||ce.title,!0)}else b(f,ce.title,!0);else if(ce.noteId&&ce.exists){const st=cs().find(it=>it.id===ce.noteId);b(f,st?.title||ce.title,!0)}else b(f,ce.title,!0);else b(f,ce.title,!0);b(p,ce.from,!0),b(g,ce.to,!0);const Qe=u(o).coordsAtPos(ce.from);if(Qe){b(S,{left:Qe.left,top:Qe.top,bottom:Qe.bottom,height:Qe.bottom-Qe.top},!0);const We=Le(Qe.left,Qe.top,Qe.bottom,400,100);b(c,We.x,!0),b(d,We.y,!0)}b(l,!0)}function ne(ce){if(!u(o))return;const Oe=`[[${u(h)}|${ce}]]`,Qe=u(g)-u(p),st=Oe.length-Qe;u(o).dispatch({changes:{from:u(p),to:u(g),insert:Oe}}),b(g,u(g)+st),b(f,ce,!0)}function ee(){b(l,!1),X()}function U(){b(l,!1),X()}function X(){u(o)&&(u(o).focus(),v&&(u(o).dispatch({selection:v,scrollIntoView:!0}),v=null))}function ie(){R&&(clearTimeout(R),R=null)}function ye(){R=setTimeout(()=>{u(m)&&u(m).hasFocus()||(b(l,!1),R=null)},200)}function pe(){R&&(clearTimeout(R),R=null)}function de(){u(x)&&(R=setTimeout(()=>{b(y,!1),b(x,!1),R=null},200))}tt(()=>{if(!u(o))return;const ce=setInterval(()=>{if(!u(o))return;const Oe=p0(u(o));if(!u(o).hasFocus){u(x)||b(y,!1);return}if(Oe&&!u(l)){if(!u(x)){const Qe=u(o).coordsAtPos(Oe.from);if(Qe){b(k,{identifier:Oe.identifier,title:Oe.title,exists:Oe.exists,noteId:Oe.noteId,targetType:Oe.targetType,conversationId:Oe.conversationId},!0),b(S,{left:Qe.left,top:Qe.top,bottom:Qe.bottom,height:Qe.bottom-Qe.top},!0);const We=Le(u(S).left,u(S).top,u(S).bottom,200,60);b(O,We.x,!0),b(_,We.y,!0),b(y,!0)}}}else(!Oe||u(l))&&(u(x)||b(y,!1))},100);return()=>clearInterval(ce)}),tt(()=>{if(!u(o))return;const ce=()=>{as(()=>{if(!u(o)?.hasFocus){if(u(l)||u(m)&&u(m).hasFocus()){setTimeout(()=>{u(m)&&u(m).hasFocus()||u(o)?.hasFocus||(b(y,!1),b(x,!1),b(l,!1))},50);return}b(y,!1),b(x,!1),b(l,!1),E&&(clearTimeout(E),E=null),R&&(clearTimeout(R),R=null)}})},Oe=()=>{as(()=>{u(l)&&u(m)&&!u(m).hasFocus()&&b(l,!1),u(y)&&(b(y,!1),b(x,!1))})};return u(o).dom.addEventListener("blur",ce,!0),u(o).dom.addEventListener("focus",Oe,!0),()=>{u(o)?.dom.removeEventListener("blur",ce,!0),u(o)?.dom.removeEventListener("focus",Oe,!0)}});function we(){u(o)&&u(o).focus()}function me(){u(o)&&jh(u(o))}var Ee={focus:we,refreshWikilinks:me},_e=OAe(),Ae=Ie(_e);Ae.__keydown=L;var ze=w(Ae);{var Be=ce=>{var Oe=yAe(),Qe=A(w(Oe),2);Qe.__click=()=>e.onUnarchive?.(),T(ce,Oe)};z(ze,ce=>{e.note.archived&&ce(Be)})}var Se=A(ze,2),Re=w(Se);Xb(Re,{get note(){return e.note},get readonly(){return u(r)},get onTitleChange(){return e.onTitleChange},onEnterKey:F,chips:Oe=>{G2e(Oe,{get note(){return e.note},get noteType(){return u(W)},onPropChange:G,get onNoteClick(){return e.onNavigate}})},$$slots:{chips:!0}});var He=A(Se,2);He.__click=q;var Me=w(He);{var Pe=ce=>{var Oe=bAe();T(ce,Oe)},ae=ce=>{var Oe=Ve(),Qe=Ie(Oe);{var We=it=>{var Ct=wAe(),bt=w(Ct);Wh(bt,{get text(){return u(Q)},onNoteClick:xt=>e.onNavigate?.(xt)}),T(it,Ct)},st=it=>{var Ct=_Ae();qt(Ct,bt=>b(s,bt),()=>u(s)),T(it,Ct)};z(Qe,it=>{u(i)?it(We):it(st,!1)},!0)}T(ce,Oe)};z(Me,ce=>{u(I)?ce(Pe):ce(ae,!1)})}var te=A(He,2);aTe(te,{get backlinks(){return u($)},onNavigate:be,onWikilinkClick:Z});var re=A(Ae,2),ve=w(re);qt(B2e(ve,{get x(){return u(c)},get y(){return u(d)},get displayText(){return u(f)},get linkRect(){return u(S)},onSave:ne,onCancel:U,onCommit:ee,get visible(){return u(l)},set visible(ce){b(l,ce,!0)}}),ce=>b(m,ce,!0),()=>u(m));var Te=A(re,2),Ne=w(Te);return F2e(Ne,{get x(){return u(O)},get y(){return u(_)},get linkRect(){return u(S)},onOpen:he,onEdit:se,get visible(){return u(y)},set visible(ce){b(y,ce,!0)}}),It("mouseenter",re,ie),It("mouseleave",re,ye),It("mouseenter",Te,pe),It("mouseleave",Te,de),T(n,_e),ct(Ee)}yt(["keydown","click"]);var kAe=P('<div class="search-view svelte-k78nsa"><div class="search-view-header svelte-k78nsa"><h2 class="svelte-k78nsa"> </h2> <span class="search-query-label svelte-k78nsa"> </span> <button class="close-search-btn svelte-k78nsa" aria-label="Close search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div> <div class="search-view-content svelte-k78nsa"><!></div></div>');function SAe(n,e){lt(e,!0);var t=kAe(),r=w(t),i=w(r),s=w(i),o=A(i,2),a=w(o),l=A(o,2);l.__click=function(...h){e.onClose?.apply(this,h)};var c=A(r,2),d=w(c);AT(d,{get results(){return e.searchResults},get onSelect(){return e.onSelect},maxResults:50,get isLoading(){return e.isSearchingContent}}),Y(()=>{J(s,`Search Results (${e.searchResults.length??""})`),J(a,`for "${e.searchQuery??""}"`)}),T(n,t),ct()}yt(["click"]);const z0={0:{name:"Smileys & Emotion",icon:"ð"},1:{name:"People & Body",icon:"ð"},3:{name:"Animals & Nature",icon:"ðµ"},4:{name:"Food & Drink",icon:"ð"},5:{name:"Travel & Places",icon:"ð"},6:{name:"Activities",icon:"ð"},7:{name:"Objects",icon:"ð"},8:{name:"Symbols",icon:"ð£"},9:{name:"Flags",icon:"ð"}},QU=[0,1,3,4,5,6,7,8,9];class TAe{miniSearch;emojis=[];emojiByHexcode={};categorizedEmojis=[];#e=j(!1);get _isLoaded(){return u(this.#e)}set _isLoaded(e){b(this.#e,e,!0)}#t=j(!1);get _isLoading(){return u(this.#t)}set _isLoading(e){b(this.#t,e,!0)}loadPromise=null;constructor(){this.miniSearch=new pu({fields:["label","tags","shortcodes"],storeFields:["id","emoji","label"],searchOptions:{boost:{label:2,shortcodes:1.5,tags:1},fuzzy:.2,prefix:!0}})}get isLoaded(){return this._isLoaded}get isLoading(){return this._isLoading}async load(){if(!this._isLoaded){if(this.loadPromise)return this.loadPromise;this._isLoading=!0,this.loadPromise=this.loadData();try{await this.loadPromise}finally{this._isLoading=!1}}}async loadData(){const[e,t]=await Promise.all([_h(()=>import("./data-Bmx3Nm6F.js"),[]),_h(()=>import("./github-Cr2dUmht.js"),[])]),r=e.default,i=t.default,s=[];for(const o of r){if(o.group===void 0||o.group===2)continue;const a=i[o.hexcode],l=a?Array.isArray(a)?a:[a]:[],c={hexcode:o.hexcode,emoji:o.emoji,label:o.label,tags:o.tags||[],group:o.group,subgroup:o.subgroup??0,shortcodes:l};this.emojis.push(c),this.emojiByHexcode[o.hexcode]=c,s.push({id:o.hexcode,emoji:o.emoji,label:o.label,tags:(o.tags||[]).join(" "),shortcodes:l.join(" "),group:o.group})}this.miniSearch.addAll(s),this.buildCategories(),this._isLoaded=!0}buildCategories(){const e={};for(const t of this.emojis)e[t.group]||(e[t.group]=[]),e[t.group].push(t);this.categorizedEmojis=QU.filter(t=>e[t]!==void 0).map(t=>({id:t,name:z0[t]?.name||`Group ${t}`,icon:z0[t]?.icon||"â",emojis:e[t]||[]}))}search(e,t=50){if(!e.trim()||!this._isLoaded)return[];const r=this.miniSearch.search(e,{fuzzy:.2,prefix:!0}),i=[];for(const s of r){const o=this.emojiByHexcode[s.id];if(o&&i.push({emoji:o.emoji,label:o.label,score:s.score}),i.length>=t)break}return i}getCategories(){return this.categorizedEmojis}getCategoryEmojis(e){return this.emojis.filter(t=>t.group===e)}}const el=new TAe;var AAe=P('<button type="button" class="category-tab svelte-8q2p0v"> </button>'),CAe=P('<div class="category-tabs svelte-8q2p0v"></div>'),EAe=P('<div class="loading-state svelte-8q2p0v">Loading emojis...</div>'),PAe=P('<div class="empty-state svelte-8q2p0v"> </div>'),IAe=P('<button type="button" class="emoji-item svelte-8q2p0v"> </button>'),MAe=P('<div class="emoji-category svelte-8q2p0v"><div class="category-name svelte-8q2p0v">Search Results</div> <div class="emoji-grid svelte-8q2p0v"></div></div>'),RAe=P('<button type="button" class="emoji-item svelte-8q2p0v"> </button>'),DAe=P('<div class="emoji-category svelte-8q2p0v"><div class="category-name svelte-8q2p0v"> </div> <div class="emoji-grid svelte-8q2p0v"></div></div>'),NAe=P('<div class="emoji-picker-dropdown svelte-8q2p0v" role="dialog" aria-label="Emoji picker" tabindex="-1"><div class="search-box svelte-8q2p0v"><input type="text" placeholder="Search emoji..." class="search-input svelte-8q2p0v"/></div> <!> <div class="emoji-content svelte-8q2p0v"><!></div></div>'),LAe=P('<div class="emoji-picker-container svelte-8q2p0v"><button type="button" class="emoji-button svelte-8q2p0v"> <span class="arrow svelte-8q2p0v"> </span></button></div> <!>',1);function aD(n,e){lt(e,!0);let t=et(e,"value",15,""),r=j(""),i=j(""),s=j(!1),o=j(null),a=j(null),l=j(Qt({top:0,left:0,openUpward:!1})),c=null;tt(()=>{u(s)&&!el.isLoaded&&!el.isLoading&&el.load()}),tt(()=>{const I=u(r);return c&&clearTimeout(c),c=setTimeout(()=>{b(i,I,!0)},150),()=>{c&&clearTimeout(c)}});let d=le(()=>!u(i).trim()||!el.isLoaded?null:el.search(u(i))),h=le(()=>el.isLoaded?el.getCategories():[]);function f(I){t(I),e.onselect(I),b(s,!1),b(r,""),b(i,"")}function p(I){I.key==="Escape"&&(b(s,!1),b(r,""),b(i,""))}function g(I){u(a)?.querySelector(`[data-group="${I}"]`)?.scrollIntoView({behavior:"smooth",block:"start"})}function m(){if(!u(o))return;const I=u(o).getBoundingClientRect(),D=450,Q=360,M=8,N=window.innerHeight-I.bottom,B=I.top,H=N<D+M&&B>N;let F;H?F=I.top-D-4:F=I.bottom+4;let Z=I.left;Z+Q>window.innerWidth-M&&(Z=window.innerWidth-Q-M),Z<M&&(Z=M),b(l,{top:F,left:Z,openUpward:H},!0)}function v(){u(s)||m(),b(s,!u(s)),u(s)||(b(r,""),b(i,""))}function y(I){const D=I.target;!D.closest(".emoji-picker-container")&&!D.closest(".emoji-picker-dropdown")&&(b(s,!1),b(r,""),b(i,""))}tt(()=>{if(!u(s))return;const I=()=>m();return window.addEventListener("scroll",I,!0),window.addEventListener("resize",I),document.addEventListener("click",y),()=>{window.removeEventListener("scroll",I,!0),window.removeEventListener("resize",I),document.removeEventListener("click",y)}});var O=LAe(),_=Ie(O),x=w(_);x.__click=v;var k=w(x),S=A(k),E=w(S);qt(x,I=>b(o,I),()=>u(o));var R=A(_,2);{var C=I=>{var D=NAe();D.__keydown=p;var Q=w(D),M=w(Q),N=A(Q,2);{var B=W=>{var G=CAe();Tt(G,20,()=>QU,L=>L,(L,q)=>{var ue=AAe();ue.__click=()=>g(q);var oe=w(ue);Y(()=>{Pt(ue,"title",z0[q]?.name),J(oe,z0[q]?.icon)}),T(L,ue)}),T(W,G)};z(N,W=>{!u(i).trim()&&el.isLoaded&&W(B)})}var H=A(N,2),F=w(H);{var Z=W=>{var G=EAe();T(W,G)},$=W=>{var G=Ve(),L=Ie(G);{var q=oe=>{var fe=Ve(),be=Ie(fe);{var De=he=>{var se=PAe(),V=w(se);Y(()=>J(V,`No emojis found for "${u(i)??""}"`)),T(he,se)},Le=he=>{var se=MAe(),V=A(w(se),2);Tt(V,21,()=>u(d),ne=>ne.emoji,(ne,ee)=>{var U=IAe();U.__click=()=>f(u(ee).emoji);var X=w(U);Y(()=>{Pt(U,"title",u(ee).label),J(X,u(ee).emoji)}),T(ne,U)}),T(he,se)};z(be,he=>{u(d).length===0?he(De):he(Le,!1)})}T(oe,fe)},ue=oe=>{var fe=Ve(),be=Ie(fe);Tt(be,17,()=>u(h),De=>De.id,(De,Le)=>{var he=DAe(),se=w(he),V=w(se),ne=A(se,2);Tt(ne,21,()=>u(Le).emojis,ee=>ee.hexcode,(ee,U)=>{var X=RAe();X.__click=()=>f(u(U).emoji);var ie=w(X);Y(()=>{Pt(X,"title",u(U).label),J(ie,u(U).emoji)}),T(ee,X)}),Y(()=>{Pt(he,"data-group",u(Le).id),J(V,u(Le).name)}),T(De,he)}),T(oe,fe)};z(L,oe=>{u(d)?oe(q):oe(ue,!1)},!0)}T(W,G)};z(F,W=>{el.isLoading?W(Z):W($,!1)})}qt(H,W=>b(a,W),()=>u(a)),Y(()=>gn(D,`top: ${u(l).top??""}px; left: ${u(l).left??""}px;`)),Un(M,()=>u(r),W=>b(r,W)),T(I,D)};z(R,I=>{u(s)&&I(C)})}Y(()=>{J(k,`${(t()||"ð")??""} `),J(E,u(s)?"â²":"â¼")}),T(n,O),ct()}yt(["click","keydown"]);var QAe=P('<label class="system-field-item svelte-1qcnnuv"><input type="checkbox" class="svelte-1qcnnuv"/> <span class="system-field-info svelte-1qcnnuv"><span class="system-field-label svelte-1qcnnuv"> </span> <span class="system-field-description svelte-1qcnnuv"> </span></span></label>'),$Ae=P('<div class="system-fields-section svelte-1qcnnuv"><h3 class="svelte-1qcnnuv">Display Settings</h3> <p class="section-description svelte-1qcnnuv">Choose which fields are always visible in the note editor.</p> <div class="system-fields-list svelte-1qcnnuv"></div></div>'),FAe=P("<option> </option>"),zAe=P('<label class="checkbox-label always-display-label svelte-1qcnnuv"><input type="checkbox" class="svelte-1qcnnuv"/> Always display</label>'),BAe=P('<div class="constraints-row svelte-1qcnnuv"><input type="number" class="form-input constraint-input svelte-1qcnnuv"/> <input type="number" class="form-input constraint-input svelte-1qcnnuv"/></div>'),UAe=P('<input type="text" class="form-input svelte-1qcnnuv" placeholder="Regex pattern (optional)"/>'),jAe=P('<div class="option-item svelte-1qcnnuv"><input type="text" class="form-input svelte-1qcnnuv" placeholder="Option value"/> <button class="remove-option-btn svelte-1qcnnuv" title="Remove option" type="button">â</button></div>'),VAe=P('<div class="options-list svelte-1qcnnuv"></div>'),qAe=P('<p class="empty-options-text svelte-1qcnnuv">No options defined. Click "Add Option" to get started.</p>'),HAe=P('<div class="select-options-editor svelte-1qcnnuv"><div class="select-options-header svelte-1qcnnuv"><span class="options-label svelte-1qcnnuv">Options</span> <button class="add-option-btn svelte-1qcnnuv" type="button">+ Add Option</button></div> <!></div>'),ZAe=P('<input type="text" class="form-input svelte-1qcnnuv" placeholder="Date format (e.g., YYYY-MM-DD)"/>'),WAe=P('<label class="checkbox-label default-label svelte-1qcnnuv"><input type="checkbox" class="svelte-1qcnnuv"/> Default value</label>'),XAe=P('<input type="text" class="form-input svelte-1qcnnuv" placeholder="Default values (comma-separated)"/>'),YAe=P('<input type="text" class="form-input svelte-1qcnnuv" placeholder="Default value (optional)"/>'),GAe=P('<div class="schema-field svelte-1qcnnuv"><div class="field-row svelte-1qcnnuv"><input type="text" class="form-input field-name svelte-1qcnnuv" placeholder="Field name"/> <select class="form-select svelte-1qcnnuv"></select> <label class="checkbox-label svelte-1qcnnuv"><input type="checkbox" class="svelte-1qcnnuv"/> Required</label> <!> <button class="remove-btn svelte-1qcnnuv" title="Remove field">â</button></div> <input type="text" class="form-input field-description svelte-1qcnnuv" placeholder="Field description (optional)"/> <!> <!> <!> <!> <!></div>'),KAe=P('<div class="schema-list svelte-1qcnnuv"></div>'),JAe=P('<p class="empty-text svelte-1qcnnuv">No properties defined</p>'),eCe=P('<div class="property-editor svelte-1qcnnuv"><!> <div class="section-header svelte-1qcnnuv"><h3 class="svelte-1qcnnuv">Properties</h3> <button class="add-btn svelte-1qcnnuv">+ Add Field</button></div> <!></div>');function tCe(n,e){lt(e,!0);let t=et(e,"editorChips",19,()=>[]);const r=[{name:"created",label:"Created",description:"When the note was created"},{name:"updated",label:"Updated",description:"When the note was last modified"}],i=[{value:"string",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"array",label:"Array"},{value:"select",label:"Select"},{value:"notelink",label:"Note Link"},{value:"notelinks",label:"Note Links"}];let s=null;function o(C){return C.id?C:{...C,id:yy()}}function a(){s&&clearTimeout(s),s=setTimeout(()=>{const C=e.properties.filter(I=>I.name.trim()!=="");e.onUpdate(C)},500)}function l(){const C={id:yy(),name:"",type:"string",description:"",required:!1};e.onUpdate([...e.properties,C])}function c(C,I,D){const Q=[...e.properties];Q[C]=o({...Q[C],[I]:D}),e.onUpdate(Q),a()}function d(C,I,D){const Q=[...e.properties],M={...Q[C]};M.constraints||(M.constraints={}),I==="min"||I==="max"?M.constraints[I]=D?Number(D):void 0:I==="pattern"?M.constraints.pattern=D||void 0:I==="format"&&(M.constraints.format=D||void 0),Q[C]=o(M),e.onUpdate(Q),a()}function h(C,I){const D=[...e.properties],Q={...D[C]};I?Q.type==="number"?Q.default=Number(I):Q.type==="boolean"?Q.default=I==="true":Q.type==="array"?Q.default=I.split(",").map(M=>M.trim()).filter(Boolean):Q.default=I:Q.default=void 0,D[C]=o(Q),e.onUpdate(D),a()}function f(C){const I=[...e.properties],D={...I[C]};D.constraints||(D.constraints={}),D.constraints.options||(D.constraints.options=[]),D.constraints.options=[...D.constraints.options,""],I[C]=o(D),e.onUpdate(I)}function p(C,I){const D=[...e.properties],Q={...D[C]};Q.constraints?.options&&(Q.constraints.options=Q.constraints.options.filter((M,N)=>N!==I),D[C]=o(Q),e.onUpdate(D),a())}function g(C,I,D){const Q=[...e.properties],M={...Q[C]};M.constraints?.options&&(M.constraints.options=[...M.constraints.options],M.constraints.options[I]=D,Q[C]=o(M),e.onUpdate(Q),a())}function m(C){const I=e.properties[C].name,D=e.properties.filter((Q,M)=>M!==C);e.onUpdate(D),t().includes(I)&&e.onEditorChipsUpdate&&e.onEditorChipsUpdate(t().filter(Q=>Q!==I))}function v(C){e.onEditorChipsUpdate&&(t().includes(C)?e.onEditorChipsUpdate(t().filter(I=>I!==C)):e.onEditorChipsUpdate([...t(),C]))}var y=eCe(),O=w(y);{var _=C=>{var I=$Ae(),D=A(w(I),4);Tt(D,21,()=>r,Q=>Q.name,(Q,M)=>{var N=QAe(),B=w(N);B.__change=()=>v(u(M).name);var H=A(B,2),F=w(H),Z=w(F),$=A(F,2),W=w($);Y(G=>{zo(B,G),J(Z,u(M).label),J(W,u(M).description)},[()=>t().includes(u(M).name)]),T(Q,N)}),T(C,I)};z(O,C=>{e.onEditorChipsUpdate&&C(_)})}var x=A(O,2),k=A(w(x),2);k.__click=l;var S=A(x,2);{var E=C=>{var I=KAe();Tt(I,21,()=>e.properties,Sl,(D,Q,M)=>{var N=GAe(),B=w(N),H=w(B);H.__input=X=>c(M,"name",X.currentTarget.value);var F=A(H,2);F.__change=X=>c(M,"type",X.currentTarget.value),Tt(F,21,()=>i,X=>X.value,(X,ie)=>{var ye=FAe(),pe=w(ye),de={};Y(()=>{J(pe,u(ie).label),de!==(de=u(ie).value)&&(ye.value=(ye.__value=u(ie).value)??"")}),T(X,ye)});var Z;jo(F);var $=A(F,2),W=w($);W.__change=X=>c(M,"required",X.currentTarget.checked);var G=A($,2);{var L=X=>{var ie=zAe(),ye=w(ie);ye.__change=()=>v(u(Q).name),Y(pe=>zo(ye,pe),[()=>t().includes(u(Q).name)]),T(X,ie)};z(G,X=>{e.onEditorChipsUpdate&&u(Q).name.trim()&&X(L)})}var q=A(G,2);q.__click=()=>m(M);var ue=A(B,2);ue.__input=X=>c(M,"description",X.currentTarget.value);var oe=A(ue,2);{var fe=X=>{var ie=BAe(),ye=w(ie);ye.__input=de=>d(M,"min",de.currentTarget.value);var pe=A(ye,2);pe.__input=de=>d(M,"max",de.currentTarget.value),Y(()=>{Tn(ye,u(Q).constraints?.min??""),Pt(ye,"placeholder",u(Q).type==="array"?"Min items":"Min"),Tn(pe,u(Q).constraints?.max??""),Pt(pe,"placeholder",u(Q).type==="array"?"Max items":"Max")}),T(X,ie)};z(oe,X=>{(u(Q).type==="number"||u(Q).type==="array")&&X(fe)})}var be=A(oe,2);{var De=X=>{var ie=UAe();ie.__input=ye=>d(M,"pattern",ye.currentTarget.value),Y(()=>Tn(ie,u(Q).constraints?.pattern??"")),T(X,ie)};z(be,X=>{u(Q).type==="string"&&X(De)})}var Le=A(be,2);{var he=X=>{var ie=HAe(),ye=w(ie),pe=A(w(ye),2);pe.__click=()=>f(M);var de=A(ye,2);{var we=Ee=>{var _e=VAe();Tt(_e,21,()=>u(Q).constraints.options,Sl,(Ae,ze,Be)=>{var Se=jAe(),Re=w(Se);Re.__input=Me=>g(M,Be,Me.currentTarget.value);var He=A(Re,2);He.__click=()=>p(M,Be),Y(()=>Tn(Re,u(ze))),T(Ae,Se)}),T(Ee,_e)},me=Ee=>{var _e=qAe();T(Ee,_e)};z(de,Ee=>{u(Q).constraints?.options&&u(Q).constraints.options.length>0?Ee(we):Ee(me,!1)})}T(X,ie)};z(Le,X=>{u(Q).type==="select"&&X(he)})}var se=A(Le,2);{var V=X=>{var ie=ZAe();ie.__input=ye=>d(M,"format",ye.currentTarget.value),Y(()=>Tn(ie,u(Q).constraints?.format??"")),T(X,ie)};z(se,X=>{u(Q).type==="date"&&X(V)})}var ne=A(se,2);{var ee=X=>{var ie=WAe(),ye=w(ie);ye.__change=pe=>h(M,pe.currentTarget.checked?"true":"false"),Y(()=>zo(ye,u(Q).default===!0)),T(X,ie)},U=X=>{var ie=Ve(),ye=Ie(ie);{var pe=we=>{var me=XAe();me.__input=Ee=>h(M,Ee.currentTarget.value),Y(Ee=>Tn(me,Ee),[()=>Array.isArray(u(Q).default)?u(Q).default.join(", "):""]),T(we,me)},de=we=>{var me=YAe();me.__input=Ee=>h(M,Ee.currentTarget.value),Y(Ee=>Tn(me,Ee),[()=>u(Q).default?.toString()??""]),T(we,me)};z(ye,we=>{u(Q).type==="array"?we(pe):we(de,!1)},!0)}T(X,ie)};z(ne,X=>{u(Q).type==="boolean"?X(ee):X(U,!1)})}Y(()=>{Tn(H,u(Q).name),Z!==(Z=u(Q).type)&&(F.value=(F.__value=u(Q).type)??"",go(F,u(Q).type)),zo(W,u(Q).required||!1),Tn(ue,u(Q).description||"")}),T(D,N)}),T(C,I)},R=C=>{var I=JAe();T(C,I)};z(S,C=>{e.properties.length>0?C(E):C(R,!1)})}T(n,y),ct()}yt(["change","click","input"]);var nCe=P('<span class="system-badge svelte-np0o77">System</span>'),rCe=P('<button class="note-item svelte-np0o77" type="button"><span class="note-title svelte-np0o77"> </span> <span class="note-date svelte-np0o77"> </span></button>'),iCe=P('<div class="notes-list svelte-np0o77"></div> <!>',1),sCe=P('<div class="empty-notes svelte-np0o77"><p class="svelte-np0o77">No notes of this type yet.</p> <button class="btn btn-secondary svelte-np0o77">Create first note</button></div>'),oCe=P(`<p class="warning-text svelte-np0o77">Notes using this type will keep their assignment, but the type won't
                  appear in lists.</p>`),aCe=P('<div class="delete-confirm svelte-np0o77"><p class="svelte-np0o77">Are you sure you want to archive this note type?</p> <!> <div class="confirm-actions svelte-np0o77"><button class="btn btn-secondary svelte-np0o77">Cancel</button> <button class="btn btn-danger svelte-np0o77">Archive Type</button></div></div>'),lCe=P('<button class="btn btn-danger-outline svelte-np0o77">Archive Note Type</button>'),cCe=P('<div class="danger-zone svelte-np0o77"><h3 class="danger-title svelte-np0o77">Danger Zone</h3> <!></div>'),uCe=P('<div class="type-detail svelte-np0o77"><div class="detail-header svelte-np0o77"><button class="back-button svelte-np0o77"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> Note Types</button></div> <div class="type-title-section svelte-np0o77"><div class="type-header svelte-np0o77"><div class="type-info svelte-np0o77"><div class="emoji-picker-large svelte-np0o77"><!></div> <div class="type-name-group svelte-np0o77"><input type="text" placeholder="Type name"/> <div class="type-meta svelte-np0o77"><span class="note-count svelte-np0o77"> </span> <!></div></div></div> <div class="type-actions svelte-np0o77"><button class="btn btn-primary svelte-np0o77"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"></path></svg> New Note</button></div></div> <textarea class="type-purpose-input svelte-np0o77" placeholder="Brief description of what this type is for..."></textarea></div> <div class="type-properties svelte-np0o77"><!></div> <div class="type-agent-instructions svelte-np0o77"><h2 class="section-title svelte-np0o77">Agent Instructions</h2> <textarea class="agent-instructions-input svelte-np0o77" placeholder="Instructions for AI agents when working with notes of this type..."></textarea></div> <div class="type-notes svelte-np0o77"><h2 class="section-title svelte-np0o77">Notes</h2> <!></div> <!></div>'),dCe=P('<div class="error-message svelte-np0o77"> </div>'),hCe=P('<div class="create-form svelte-np0o77"><h3 class="svelte-np0o77">Create Note Type</h3> <div class="form-group svelte-np0o77"><label for="new-name" class="form-label svelte-np0o77">Name *</label> <input id="new-name" type="text" class="form-input svelte-np0o77" placeholder="e.g., Meeting Notes, Project Ideas"/></div> <div class="form-group svelte-np0o77"><span class="form-label svelte-np0o77">Icon</span> <!></div> <div class="form-group svelte-np0o77"><label for="new-purpose" class="form-label svelte-np0o77">Purpose</label> <textarea id="new-purpose" class="form-textarea svelte-np0o77" placeholder="Brief description of what this type is for..." rows="2"></textarea></div> <!> <div class="form-actions svelte-np0o77"><button class="btn btn-secondary svelte-np0o77">Cancel</button> <button class="btn btn-primary svelte-np0o77">Create</button></div></div>'),fCe=P('<span class="system-badge-small svelte-np0o77">System</span>'),pCe=P('<button class="type-card svelte-np0o77" type="button"><span class="card-icon svelte-np0o77"> </span> <div class="card-content svelte-np0o77"><div class="card-name-row svelte-np0o77"><span class="card-name svelte-np0o77"> </span> <!></div> <span class="card-count svelte-np0o77"> </span></div> <svg class="card-chevron svelte-np0o77" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"></path></svg></button>'),gCe=P('<div class="empty-types svelte-np0o77"><p class="svelte-np0o77">No note types yet.</p> <button class="btn btn-secondary svelte-np0o77">Create your first type</button></div>'),mCe=P('<div class="types-list-view svelte-np0o77"><div class="list-header svelte-np0o77"><h2 class="svelte-np0o77">Note Types</h2> <button class="btn btn-primary svelte-np0o77"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"></path></svg> New Type</button></div> <!> <div class="types-grid svelte-np0o77"><!> <!></div></div>'),vCe=P('<div class="note-types-view svelte-np0o77"><!></div>');function yCe(n,e){lt(e,!0);let t=et(e,"selectedTypeId",3,null);const r=le(yo),i=le(cs),s=le(()=>t()?jr(t()):null),o=le(()=>t()?Xp(t()):!1);let a=j(0),l=j(Qt(Th));const c=le(()=>t()?m(t()):[]),d=le(()=>u(c).length),h=le(()=>Math.max(1,Math.ceil(u(d)/u(l)))),f=le(()=>u(a)*u(l)),p=le(()=>u(c).slice(u(f),u(f)+u(l)));function g(L){return u(i).filter(q=>!q.archived&&q.type===L).length}function m(L){return u(i).filter(q=>!q.archived&&q.type===L).sort((q,ue)=>new Date(ue.updated).getTime()-new Date(q.updated).getTime())}let v=j(!1),y=j(""),O=j(""),_=j(""),x=j(null),k=j(!1),S=null;function E(){b(v,!1),b(y,""),b(O,""),b(_,""),b(x,null)}function R(){if(!u(y).trim()){b(x,"Name is required");return}if(u(r).find(q=>q.name.toLowerCase()===u(y).trim().toLowerCase())){b(x,"A type with this name already exists");return}try{const q=hb({name:u(y).trim(),purpose:u(_).trim(),icon:u(O)||void 0});E(),e.onTypeSelect(q)}catch(q){b(x,q instanceof Error?q.message:"Failed to create type",!0)}}function C(L,q){t()&&(S&&clearTimeout(S),S=setTimeout(()=>{Qd(t(),{[L]:q})},500))}function I(L,q){t()&&Qd(t(),{[L]:q})}function D(){t()&&(b5(t()),b(k,!1),e.onTypeSelect(null))}async function Q(){if(!t())return;const L=await zs({type:t()});Rs(L),El(L),e.onNoteSelect?.(L)}function M(L){Rs(L),El(L),e.onNoteSelect?.(L)}function N(L){b(a,L,!0)}function B(L){b(l,L,!0),b(a,0)}tt(()=>{t()&&(b(k,!1),b(a,0))});function H(L){t()&&Qd(t(),{properties:dy(L)})}function F(L){t()&&Qd(t(),{editorChips:dy(L)})}var Z=vCe(),$=w(Z);{var W=L=>{var q=uCe(),ue=w(q),oe=w(ue);oe.__click=()=>e.onTypeSelect(null);var fe=A(ue,2),be=w(fe),De=w(be),Le=w(De),he=w(Le);{let Pe=le(()=>u(s).icon||"ð");aD(he,{get value(){return u(Pe)},onselect:ae=>I("icon",ae)})}var se=A(Le,2),V=w(se);let ne;V.__input=Pe=>C("name",Pe.currentTarget.value);var ee=A(V,2),U=w(ee),X=w(U),ie=A(U,2);{var ye=Pe=>{var ae=nCe();T(Pe,ae)};z(ie,Pe=>{u(o)&&Pe(ye)})}var pe=A(De,2),de=w(pe);de.__click=Q;var we=A(be,2);we.__input=Pe=>C("purpose",Pe.currentTarget.value);var me=A(fe,2),Ee=w(me);{let Pe=le(()=>u(s).properties??[]),ae=le(()=>u(s).editorChips??[]);tCe(Ee,{get properties(){return u(Pe)},onUpdate:H,get editorChips(){return u(ae)},onEditorChipsUpdate:F})}var _e=A(me,2),Ae=A(w(_e),2);Ae.__input=Pe=>C("agentInstructions",Pe.currentTarget.value);var ze=A(_e,2),Be=A(w(ze),2);{var Se=Pe=>{var ae=iCe(),te=Ie(ae);Tt(te,21,()=>u(p),ve=>ve.id,(ve,Te)=>{var Ne=rCe();Ne.__click=()=>M(u(Te).id);var ce=w(Ne),Oe=w(ce),Qe=A(ce,2),We=w(Qe);Y(st=>{J(Oe,u(Te).title||"Untitled"),J(We,st)},[()=>new Date(u(Te).updated).toLocaleDateString()]),T(ve,Ne)});var re=A(te,2);eB(re,{get currentPage(){return u(a)},get totalPages(){return u(h)},get pageSize(){return u(l)},get total(){return u(d)},onPageChange:N,onPageSizeChange:B}),T(Pe,ae)},Re=Pe=>{var ae=sCe(),te=A(w(ae),2);te.__click=Q,T(Pe,ae)};z(Be,Pe=>{u(d)>0?Pe(Se):Pe(Re,!1)})}var He=A(ze,2);{var Me=Pe=>{var ae=cCe(),te=A(w(ae),2);{var re=Te=>{var Ne=aCe(),ce=A(w(Ne),2);{var Oe=it=>{var Ct=oCe();T(it,Ct)};z(ce,it=>{g(t()||"")>0&&it(Oe)})}var Qe=A(ce,2),We=w(Qe);We.__click=()=>b(k,!1);var st=A(We,2);st.__click=D,T(Te,Ne)},ve=Te=>{var Ne=lCe();Ne.__click=()=>b(k,!0),T(Te,Ne)};z(te,Te=>{u(k)?Te(re):Te(ve,!1)})}T(Pe,ae)};z(He,Pe=>{u(o)||Pe(Me)})}Y(Pe=>{ne=Ue(V,1,"type-name-input svelte-np0o77",null,ne,{readonly:u(o)}),Tn(V,u(s).name),V.readOnly=u(o),J(X,`${Pe??""} notes`),Tn(we,u(s).purpose||""),Tn(Ae,u(s).agentInstructions||"")},[()=>g(t()||"")]),T(L,q)},G=L=>{var q=mCe(),ue=w(q),oe=A(w(ue),2);oe.__click=()=>b(v,!0);var fe=A(ue,2);{var be=V=>{var ne=hCe(),ee=A(w(ne),2),U=A(w(ee),2),X=A(ee,2),ie=A(w(X),2);aD(ie,{onselect:Ae=>b(O,Ae,!0),get value(){return u(O)},set value(Ae){b(O,Ae,!0)}});var ye=A(X,2),pe=A(w(ye),2),de=A(ye,2);{var we=Ae=>{var ze=dCe(),Be=w(ze);Y(()=>J(Be,u(x))),T(Ae,ze)};z(de,Ae=>{u(x)&&Ae(we)})}var me=A(de,2),Ee=w(me);Ee.__click=E;var _e=A(Ee,2);_e.__click=R,Un(U,()=>u(y),Ae=>b(y,Ae)),Un(pe,()=>u(_),Ae=>b(_,Ae)),T(V,ne)};z(fe,V=>{u(v)&&V(be)})}var De=A(fe,2),Le=w(De);Tt(Le,17,()=>u(r),V=>V.id,(V,ne)=>{var ee=pCe();ee.__click=()=>e.onTypeSelect(u(ne).id);var U=w(ee),X=w(U),ie=A(U,2),ye=w(ie),pe=w(ye),de=w(pe),we=A(pe,2);{var me=Ae=>{var ze=fCe();T(Ae,ze)};z(we,Ae=>{Xp(u(ne).id)&&Ae(me)})}var Ee=A(ye,2),_e=w(Ee);Y(Ae=>{J(X,u(ne).icon||"ð"),J(de,u(ne).name),J(_e,`${Ae??""} notes`)},[()=>g(u(ne).id)]),T(V,ee)});var he=A(Le,2);{var se=V=>{var ne=gCe(),ee=A(w(ne),2);ee.__click=()=>b(v,!0),T(V,ne)};z(he,V=>{u(r).length===0&&V(se)})}T(L,q)};z($,L=>{u(s)?L(W):L(G,!1)})}T(n,Z),ct()}yt(["click","input"]);var bCe=P('<span class="saving-indicator svelte-1rhahr5">Saving...</span>'),wCe=P('<button class="clear-button svelte-1rhahr5">Clear API Key</button>'),_Ce=P(`<div class="api-key-settings svelte-1rhahr5"><h3 class="svelte-1rhahr5">AI Configuration</h3> <div class="keychain-notice svelte-1rhahr5"><span class="lock-icon svelte-1rhahr5"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span> <span>API keys are stored securely in your system's keychain. Your system may prompt you
      to allow access.</span></div> <div class="api-key-field svelte-1rhahr5"><label for="openrouter-key" class="svelte-1rhahr5"><span>OpenRouter API Key</span> <span><!></span></label> <div class="input-wrapper svelte-1rhahr5"><input id="openrouter-key" type="password" placeholder="sk-or-..."/> <!></div> <p class="help-text svelte-1rhahr5">Get your API key from <a href="https://openrouter.ai/settings/keys" target="_blank" rel="noopener" class="svelte-1rhahr5">openrouter.ai</a></p></div> <!></div>`);function OCe(n,e){lt(e,!0);let t=j(""),r=j(!1),i=j(!1),s=null;tt(()=>{(async()=>{try{const I=await window.api?.getApiKey({provider:"openrouter"});I?.key&&(b(t,I.key,!0),o(I.key))}catch(I){console.error("Failed to load API key:",I)}})()});function o(C){const I=C.startsWith("sk-")&&C.length>20;return b(r,I,!0),I}function a(C){const I=C.currentTarget.value;b(t,I,!0),o(I),s&&clearTimeout(s),s=setTimeout(()=>{l(I)},1e3)}async function l(C){try{b(i,!0),await window.api?.storeApiKey({provider:"openrouter",key:C})}catch(I){console.error("Failed to save API key:",I)}finally{b(i,!1)}}async function c(){try{b(i,!0),await window.api?.storeApiKey({provider:"openrouter",key:""}),b(t,""),b(r,!1)}catch(C){console.error("Failed to clear API key:",C)}finally{b(i,!1)}}var d=_Ce(),h=A(w(d),4),f=w(h),p=A(w(f),2);let g;var m=w(p);{var v=C=>{var I=Tr();Y(()=>J(I,u(r)?"Valid":"Invalid format")),T(C,I)},y=C=>{var I=Tr("Not set");T(C,I)};z(m,C=>{u(t)?C(v):C(y,!1)})}var O=A(f,2),_=w(O);_.__input=a;let x;var k=A(_,2);{var S=C=>{var I=bCe();T(C,I)};z(k,C=>{u(i)&&C(S)})}var E=A(h,2);{var R=C=>{var I=wCe();I.__click=c,Y(()=>I.disabled=u(i)),T(C,I)};z(E,C=>{u(t)&&C(R)})}Y(()=>{g=Ue(p,1,"validation-badge svelte-1rhahr5",null,g,{valid:u(r),invalid:u(t)&&!u(r)}),Tn(_,u(t)),x=Ue(_,1,"svelte-1rhahr5",null,x,{saving:u(i)})}),T(n,d),ct()}yt(["input","click"]);var xCe=P('<p class="unavailable-message svelte-py7lp">File sync is not available in this environment.</p>'),kCe=P(`<div class="sync-status svelte-py7lp"><div class="status-row svelte-py7lp"><span></span> <span class="status-text svelte-py7lp"><!></span></div> <div class="directory-path svelte-py7lp"><span class="label svelte-py7lp">Directory:</span> <span class="path svelte-py7lp"> </span></div> <p class="description svelte-py7lp">Notes are automatically synced to markdown files in this directory. You can edit
        them with any text editor.</p> <button class="action-button danger svelte-py7lp"><!></button></div>`),SCe=P(`<div class="sync-disabled svelte-py7lp"><p class="description svelte-py7lp">Enable file sync to automatically sync your notes to markdown files on your
        filesystem. This allows you to:</p> <ul class="benefits-list svelte-py7lp"><li class="svelte-py7lp">Edit notes with your favorite text editor</li> <li class="svelte-py7lp">Use version control (git) with your notes</li> <li class="svelte-py7lp">Access notes from other applications</li></ul> <button class="action-button primary svelte-py7lp"><!></button></div>`),TCe=P('<div class="sync-settings svelte-py7lp"><h3 class="section-title svelte-py7lp">File Sync</h3> <!></div>');function ACe(n,e){lt(e,!0);let t=j(!1),r=j(!1);const i=le(bJ),s=le(Za),o=le(wJ),a=le(_J);async function l(){if(!u(t)){b(t,!0);try{await OJ()}finally{b(t,!1)}}}async function c(){if(!u(r)){b(r,!0);try{await xJ()}finally{b(r,!1)}}}var d=TCe(),h=A(w(d),2);{var f=g=>{var m=xCe();T(g,m)},p=g=>{var m=Ve(),v=Ie(m);{var y=_=>{var x=kCe(),k=w(x),S=w(k);let E;var R=A(S,2),C=w(R);{var I=$=>{var W=Tr("Syncing to filesystem");T($,W)},D=$=>{var W=Tr("File sync enabled");T($,W)};z(C,$=>{u(a)?$(I):$(D,!1)})}var Q=A(k,2),M=A(w(Q),2),N=w(M),B=A(Q,4);B.__click=c;var H=w(B);{var F=$=>{var W=Tr("Disconnecting...");T($,W)},Z=$=>{var W=Tr("Disconnect Sync");T($,W)};z(H,$=>{u(r)?$(F):$(Z,!1)})}Y(()=>{E=Ue(S,1,"status-indicator svelte-py7lp",null,E,{syncing:u(a)}),Pt(M,"title",u(o)),J(N,u(o)),B.disabled=u(r)}),T(_,x)},O=_=>{var x=SCe(),k=A(w(x),4);k.__click=l;var S=w(k);{var E=C=>{var I=Tr("Selecting...");T(C,I)},R=C=>{var I=Tr("Choose Sync Directory");T(C,I)};z(S,C=>{u(t)?C(E):C(R,!1)})}Y(()=>k.disabled=u(t)),T(_,x)};z(v,_=>{u(s)?_(y):_(O,!1)},!0)}T(g,m)};z(h,g=>{u(i)?g(p,!1):g(f)})}T(n,d),ct()}yt(["click"]);const wk=[{id:"anthropic/claude-haiku-4.5",name:"Normal",provider:"openrouter",icon:"â¡",contextLength:2e5,recommendedMaxConversation:14e4,recommended:!0,mode:"normal",description:"What you should use most of the time - fast and capable"},{id:"anthropic/claude-sonnet-4.5",name:"Plus Ultra",provider:"openrouter",icon:"ð§ ",contextLength:2e5,recommendedMaxConversation:14e4,mode:"plus-ultra",description:"When you need Flint to think really hard - slow and expensive"},{id:"claude-haiku-4-5-latest",name:"Normal",provider:"anthropic",icon:"â¡",contextLength:2e5,recommendedMaxConversation:14e4,recommended:!0,mode:"normal",description:"What you should use most of the time - fast and capable"},{id:"claude-sonnet-4-5-latest",name:"Plus Ultra",provider:"anthropic",icon:"ð§ ",contextLength:2e5,recommendedMaxConversation:14e4,mode:"plus-ultra",description:"When you need Flint to think really hard - slow and expensive"}],Xh="anthropic/claude-haiku-4.5";function hu(n){return wk.find(e=>e.id===n)}function CCe(n){return n?wk.filter(e=>e.provider===n):wk}const E_="flint-api-keys";class Yd{static instance;static getInstance(){return Yd.instance||(Yd.instance=new Yd),Yd.instance}getStoredKeys(){try{const e=localStorage.getItem(E_);return e?JSON.parse(e):{}}catch{return{}}}saveStoredKeys(e){localStorage.setItem(E_,JSON.stringify(e))}async isAvailable(){if(On())try{return await window.api.secureStorageAvailable()}catch(e){return console.error("Failed to check secure storage availability:",e),!1}return!0}async storeApiKey(e,t,r){if(On())try{await window.api.storeApiKey({provider:e,key:t,orgId:r})}catch(i){throw console.error(`Failed to store ${e} API key:`,i),i}else{const i=this.getStoredKeys();i[e]={key:t,orgId:r},this.saveStoredKeys(i)}}async getApiKey(e){if(On())try{return await window.api.getApiKey({provider:e})}catch(t){return console.error(`Failed to get ${e} API key:`,t),{key:""}}else return this.getStoredKeys()[e]||{key:""}}async getAllApiKeys(){if(On())try{return await window.api.getAllApiKeys()}catch(e){return console.error("Failed to get all API keys:",e),{openrouter:"",anthropic:""}}else{const e=this.getStoredKeys();return{openrouter:e.openrouter?.key||"",anthropic:e.anthropic?.key||""}}}async testApiKey(e){if(On())try{return await window.api.testApiKey({provider:e})}catch(t){return console.error(`Failed to test ${e} API key:`,t),!1}return!1}async clearAllApiKeys(){if(On())try{await window.api.clearApiKeys()}catch(e){throw console.error("Failed to clear API keys:",e),e}else localStorage.removeItem(E_)}validateApiKey(e,t){if(!t||t.length===0)return!1;switch(e){case"openrouter":return(t.startsWith("sk-or-")||t.startsWith("sk-"))&&t.length>20;case"anthropic":return t.startsWith("sk-ant-")&&t.length>20;default:return!1}}}const ECe=Yd.getInstance(),_k="flint-settings",gh={aiProvider:{selected:"openrouter"},apiKeys:{openrouter:"",anthropic:""},modelPreferences:{defaultModel:Xh,showCosts:!0,costWarningThreshold:10},appearance:{theme:"system",font:{preset:"sans-serif"},fontSize:16},dataAndPrivacy:{autoSaveDelay:500,chatHistoryRetentionDays:30},advanced:{debugMode:!1,proxyUrl:"",customEndpoints:{}},updates:{lastSeenVersion:"",lastSeenCanaryVersion:""},reader:{defaultPdfZoom:1.5,defaultEpubTextSize:100,theme:"system"}};let pn=j(Qt(gh)),Ok=j(!0),$U=j(!1),B0=null;async function PCe(){try{if(On()){const n=await window.api?.loadAppSettings();if(n)return delete n.apiKeys,n}else{const n=localStorage.getItem(_k);if(n){const e=JSON.parse(n);return delete e.apiKeys,e}}}catch(n){console.warn("Failed to load settings:",n)}return{}}async function P_(n){const e={aiProvider:n.aiProvider,modelPreferences:n.modelPreferences,appearance:n.appearance,dataAndPrivacy:n.dataAndPrivacy,advanced:n.advanced,updates:n.updates,reader:n.reader};try{if(On()){const r={...await window.api?.loadAppSettings()||{},...e},i=dy(r);await window.api?.saveAppSettings(i)}else{const t=localStorage.getItem(_k),i={...t?JSON.parse(t):{},...e};localStorage.setItem(_k,JSON.stringify(i))}}catch(t){console.warn("Failed to save settings:",t)}}async function ICe(){b(Ok,!0);try{const n=await PCe();b(pn,{...gh,...n,apiKeys:gh.apiKeys},!0)}catch(n){console.warn("Settings initialization failed:",n),b(pn,gh,!0)}finally{b(Ok,!1),b($U,!0),B0=null}}B0=ICe();const MCe=le(()=>hu(u(pn).modelPreferences.defaultModel)||hu(Xh));async function RCe(){try{const n=await ECe.getAllApiKeys();b(pn,{...u(pn),apiKeys:{openrouter:n.openrouter||"",anthropic:n.anthropic||""}},!0)}catch(n){console.warn("Failed to load API keys from secure storage:",n)}}const Cn={get settings(){return u(pn)},get currentModelInfo(){return u(MCe)},get loading(){return u(Ok)},get initialized(){return u($U)},async ensureInitialized(){B0&&await B0},async loadApiKeys(){return RCe()},async updateSettings(n){await this.ensureInitialized();const e={...u(pn),...n};n.aiProvider&&(e.aiProvider={...u(pn).aiProvider,...n.aiProvider}),n.apiKeys&&(e.apiKeys={...u(pn).apiKeys,...n.apiKeys}),n.modelPreferences&&(e.modelPreferences={...u(pn).modelPreferences,...n.modelPreferences}),n.appearance&&(e.appearance={...u(pn).appearance,...n.appearance}),n.dataAndPrivacy&&(e.dataAndPrivacy={...u(pn).dataAndPrivacy,...n.dataAndPrivacy}),n.advanced&&(e.advanced={...u(pn).advanced,...n.advanced}),n.updates&&(e.updates={...u(pn).updates,...n.updates}),n.reader&&(e.reader={...u(pn).reader,...n.reader}),b(pn,e,!0),await P_(u(pn))},async updateApiKey(n,e,t){const r={...u(pn).apiKeys};n==="openrouter"?r.openrouter=e:n==="anthropic"&&(r.anthropic=e),await this.updateSettings({apiKeys:r})},async updateProvider(n){await this.updateSettings({aiProvider:{selected:n}})},async updateDefaultModel(n){hu(n)&&await this.updateSettings({modelPreferences:{...u(pn).modelPreferences,defaultModel:n}})},async updateTheme(n){await this.updateSettings({appearance:{...u(pn).appearance,theme:n}})},async updateFont(n){await this.updateSettings({appearance:{...u(pn).appearance,font:n}})},async updateReaderTheme(n){await this.updateSettings({reader:{...u(pn).reader,theme:n}})},async resetToDefaults(){await this.ensureInitialized(),b(pn,{...gh},!0),await P_(u(pn))},async resetSection(n){await this.ensureInitialized(),b(pn,{...u(pn),[n]:{...gh[n]}},!0),await P_(u(pn))},exportSettings(){const n={aiProvider:u(pn).aiProvider,modelPreferences:u(pn).modelPreferences,appearance:u(pn).appearance,dataAndPrivacy:u(pn).dataAndPrivacy,advanced:u(pn).advanced,updates:u(pn).updates,reader:u(pn).reader};return JSON.stringify(n,null,2)},async importSettings(n){try{const e=JSON.parse(n);return delete e.apiKeys,await this.updateSettings(e),!0}catch(e){return console.error("Failed to import settings:",e),!1}},validateApiKey(n,e){if(!e||e.length===0)return!1;switch(n){case"openrouter":return(e.startsWith("sk-or-")||e.startsWith("sk-"))&&e.length>20;case"anthropic":return e.startsWith("sk-ant-")&&e.length>20;default:return!1}},async updateLastSeenVersion(n,e){await this.updateSettings({updates:{...u(pn).updates,...e?{lastSeenCanaryVersion:n}:{lastSeenVersion:n}}})},getLastSeenVersion(n){return n?u(pn).updates.lastSeenCanaryVersion:u(pn).updates.lastSeenVersion}};yt(["click","change"]);var DCe=P('<span class="channel-badge svelte-1em5jkv"> </span>'),NCe=P(`<button class="changelog-link svelte-1em5jkv">What's New</button>`),LCe=P('<button class="action-btn primary svelte-1em5jkv">Install & Restart</button>'),QCe=P('<button class="action-btn secondary svelte-1em5jkv"> </button>'),$Ce=kn('<svg class="spinner svelte-1em5jkv" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" stroke-opacity="0.25"></circle><path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"></path></svg>'),FCe=P('<div class="progress-bar svelte-1em5jkv"><div class="progress-fill svelte-1em5jkv"></div></div>'),zCe=kn('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>'),BCe=kn('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>'),UCe=kn('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>'),jCe=P("<div><!> <span> </span></div>"),VCe=P('<div class="update-actions svelte-1em5jkv"><!></div> <!>',1),qCe=P(`<p class="web-notice svelte-1em5jkv">You're using the web version. <a href="/#download" target="_blank" class="svelte-1em5jkv">Download the desktop app</a> for auto-updates and additional features.</p>`),HCe=P('<div class="about-settings svelte-1em5jkv"><h3 class="svelte-1em5jkv">About</h3> <div class="version-section svelte-1em5jkv"><div class="version-info svelte-1em5jkv"><div class="app-name svelte-1em5jkv">Flint</div> <div class="version-row svelte-1em5jkv"><span class="version-label svelte-1em5jkv">Version</span> <span class="version-value svelte-1em5jkv"> </span> <!></div> <!></div> <div class="update-section svelte-1em5jkv"><!></div></div></div>');function ZCe(n,e){lt(e,!0);class t{#e=j("");get appVersion(){return u(this.#e)}set appVersion(D){b(this.#e,D,!0)}#t=j("");get appChannel(){return u(this.#t)}set appChannel(D){b(this.#t,D,!0)}#r=j("idle");get checkStatus(){return u(this.#r)}set checkStatus(D){b(this.#r,D,!0)}#n=j(null);get availableVersion(){return u(this.#n)}set availableVersion(D){b(this.#n,D,!0)}#s=j(0);get downloadProgress(){return u(this.#s)}set downloadProgress(D){b(this.#s,D,!0)}#i=j(null);get errorMsg(){return u(this.#i)}set errorMsg(D){b(this.#i,D,!0)}}const r=new t,i=On();async function s(){if(!On()){r.appVersion="Web";return}try{const I=await window.api?.getAppVersion();I&&(r.appVersion=I.version,r.appChannel=I.channel)}catch(I){console.error("Failed to get app version:",I)}}function o(){On()&&(window.api?.onUpdateChecking(()=>{r.checkStatus="checking",r.errorMsg=null}),window.api?.onUpdateAvailable(I=>{r.checkStatus="available",r.availableVersion=I.version}),window.api?.onUpdateNotAvailable(()=>{r.checkStatus="up-to-date"}),window.api?.onUpdateDownloadProgress(I=>{r.checkStatus="downloading",r.downloadProgress=Math.round(I.percent)}),window.api?.onUpdateDownloaded(I=>{r.checkStatus="ready",r.availableVersion=I.version}),window.api?.onUpdateError(I=>{r.checkStatus="error",r.errorMsg=I.message}))}function a(){On()&&(r.checkStatus="checking",window.api?.checkForUpdates())}function l(){On()&&window.api?.installUpdate()}qr(()=>{s(),o()}),Oo(()=>{On()&&window.api?.removeAllUpdateListeners()});const c=le(()=>{switch(r.checkStatus){case"checking":return"Checking for updates...";case"available":return`Update ${r.availableVersion} available`;case"up-to-date":return"You are up to date";case"downloading":return`Downloading update... ${r.downloadProgress}%`;case"ready":return`Update ${r.availableVersion} ready to install`;case"error":return r.errorMsg||"Update check failed";default:return""}}),d=le(()=>r.checkStatus==="ready"),h=le(()=>r.checkStatus==="checking"||r.checkStatus==="downloading");var f=HCe(),p=A(w(f),2),g=w(p),m=A(w(g),2),v=A(w(m),2),y=w(v),O=A(v,2);{var _=I=>{var D=DCe(),Q=w(D);Y(()=>J(Q,r.appChannel)),T(I,D)};z(O,I=>{r.appChannel&&r.appChannel!=="latest"&&I(_)})}var x=A(m,2);{var k=I=>{var D=NCe();D.__click=()=>e.onShowChangelog?.(),T(I,D)};z(x,I=>{e.onShowChangelog&&I(k)})}var S=A(g,2),E=w(S);{var R=I=>{var D=VCe(),Q=Ie(D),M=w(Q);{var N=Z=>{var $=LCe();$.__click=l,T(Z,$)},B=Z=>{var $=QCe();$.__click=a;var W=w($);Y(()=>{$.disabled=u(h),J(W,u(h)?"Checking...":"Check for Updates")}),T(Z,$)};z(M,Z=>{u(d)?Z(N):Z(B,!1)})}var H=A(Q,2);{var F=Z=>{var $=jCe();let W;var G=w($);{var L=fe=>{var be=$Ce();T(fe,be)},q=fe=>{var be=Ve(),De=Ie(be);{var Le=se=>{var V=FCe(),ne=w(V);Y(()=>gn(ne,`width: ${r.downloadProgress??""}%`)),T(se,V)},he=se=>{var V=Ve(),ne=Ie(V);{var ee=X=>{var ie=zCe();T(X,ie)},U=X=>{var ie=Ve(),ye=Ie(ie);{var pe=we=>{var me=BCe();T(we,me)},de=we=>{var me=Ve(),Ee=Ie(me);{var _e=Ae=>{var ze=UCe();T(Ae,ze)};z(Ee,Ae=>{(r.checkStatus==="available"||r.checkStatus==="ready")&&Ae(_e)},!0)}T(we,me)};z(ye,we=>{r.checkStatus==="error"?we(pe):we(de,!1)},!0)}T(X,ie)};z(ne,X=>{r.checkStatus==="up-to-date"?X(ee):X(U,!1)},!0)}T(se,V)};z(De,se=>{r.checkStatus==="downloading"?se(Le):se(he,!1)},!0)}T(fe,be)};z(G,fe=>{r.checkStatus==="checking"?fe(L):fe(q,!1)})}var ue=A(G,2),oe=w(ue);Y(()=>{W=Ue($,1,"status-message svelte-1em5jkv",null,W,{success:r.checkStatus==="up-to-date",info:r.checkStatus==="available"||r.checkStatus==="ready",error:r.checkStatus==="error"}),J(oe,u(c))}),T(Z,$)};z(H,Z=>{r.checkStatus!=="idle"&&Z(F)})}T(I,D)},C=I=>{var D=qCe();T(I,D)};z(E,I=>{i?I(R):I(C,!1)})}Y(()=>J(y,r.appVersion||"...")),T(n,f),ct()}yt(["click"]);var WCe=P("<option> </option>"),XCe=P('<div class="font-preview svelte-x7qhmf">The quick brown fox jumps over the lazy dog.</div>'),YCe=P('<div class="settings-group svelte-x7qhmf"><label class="svelte-x7qhmf"><span>Custom Font</span> <select class="svelte-x7qhmf"><option> </option><!></select></label> <!></div>'),GCe=P(`<div class="settings-panel svelte-x7qhmf"><h2 class="svelte-x7qhmf">Settings</h2> <div class="settings-group svelte-x7qhmf"><label class="svelte-x7qhmf"><span>Theme</span> <select class="svelte-x7qhmf"><option>System</option><option>Light</option><option>Dark</option></select></label></div> <div class="settings-group svelte-x7qhmf"><label class="svelte-x7qhmf"><span>Editor Font</span> <select class="svelte-x7qhmf"><option>Sans-serif</option><option>Serif</option><option>Monospace</option><option>Custom...</option></select></label></div> <!> <div class="settings-group svelte-x7qhmf"><label class="svelte-x7qhmf"><span>Font Size</span> <div class="font-size-control svelte-x7qhmf"><input type="range" min="12" max="24" step="1" class="svelte-x7qhmf"/> <span class="font-size-value svelte-x7qhmf"> </span></div></label></div> <div class="settings-divider svelte-x7qhmf"></div> <!> <div class="settings-divider svelte-x7qhmf"></div> <!> <div class="settings-divider svelte-x7qhmf"></div> <!> <div class="import-section svelte-x7qhmf"><h3 class="svelte-x7qhmf">Import Legacy Vault</h3> <p class="import-description svelte-x7qhmf">Import notes from an older Flint vault (before the Automerge update). Your original
      files will not be modified.</p> <button class="action-button primary svelte-x7qhmf">Import Legacy Vault...</button></div> <div class="settings-divider svelte-x7qhmf"></div> <!> <button class="close-settings svelte-x7qhmf">Close</button></div>`);function KCe(n,e){lt(e,!0);let t=j(Qt([])),r=j(!1);async function i(){if(!(u(t).length>0||u(r))){b(r,!0);try{const L=await window.api?.getSystemFonts();L&&b(t,L,!0)}catch(L){console.error("Failed to load system fonts:",L)}finally{b(r,!1)}}}tt(()=>{Cn.settings.appearance.font?.preset==="custom"&&i()});async function s(L){await Cn.updateFont({preset:L,customFont:L==="custom"?Cn.settings.appearance.font?.customFont:void 0})}async function o(L){await Cn.updateFont({preset:"custom",customFont:L})}async function a(L){await Cn.updateSettings({appearance:{...Cn.settings.appearance,fontSize:L}})}var l=GCe(),c=A(w(l),2),d=w(c),h=A(w(d),2),f=w(h);f.value=f.__value="system";var p=A(f);p.value=p.__value="light";var g=A(p);g.value=g.__value="dark";var m=A(c,2),v=w(m),y=A(w(v),2);y.__change=L=>s(L.currentTarget.value);var O=w(y);O.value=O.__value="sans-serif";var _=A(O);_.value=_.__value="serif";var x=A(_);x.value=x.__value="monospace";var k=A(x);k.value=k.__value="custom";var S;jo(y);var E=A(m,2);{var R=L=>{var q=YCe(),ue=w(q),oe=A(w(ue),2);oe.__change=V=>o(V.currentTarget.value);var fe=w(oe),be=w(fe);fe.value=fe.__value="";var De=A(fe);Tt(De,16,()=>u(t),V=>V,(V,ne)=>{var ee=WCe(),U=w(ee),X={};Y(()=>{J(U,ne),X!==(X=ne)&&(ee.value=(ee.__value=ne)??"")}),T(V,ee)});var Le;jo(oe);var he=A(ue,2);{var se=V=>{var ne=XCe();Y(()=>gn(ne,`font-family: '${Cn.settings.appearance.font.customFont??""}'`)),T(V,ne)};z(he,V=>{Cn.settings.appearance.font?.customFont&&V(se)})}Y(()=>{oe.disabled=u(r),J(be,u(r)?"Loading fonts...":"Select a font..."),Le!==(Le=Cn.settings.appearance.font?.customFont||"")&&(oe.value=(oe.__value=Cn.settings.appearance.font?.customFont||"")??"",go(oe,Cn.settings.appearance.font?.customFont||""))}),T(L,q)};z(E,L=>{Cn.settings.appearance.font?.preset==="custom"&&L(R)})}var C=A(E,2),I=w(C),D=A(w(I),2),Q=w(D);Q.__input=L=>a(parseInt(L.currentTarget.value));var M=A(Q,2),N=w(M),B=A(C,4);OCe(B,{});var H=A(B,4);ACe(H,{});var F=A(H,4);z(F,L=>{});var Z=A(F,2),$=A(w(Z),4);$.__click=function(...L){e.onShowLegacyMigrationModal?.apply(this,L)};var W=A(Z,4);ZCe(W,{get onShowChangelog(){return e.onShowChangelog}});var G=A(W,2);G.__click=function(...L){e.onClose?.apply(this,L)},Y(()=>{S!==(S=Cn.settings.appearance.font?.preset||"sans-serif")&&(y.value=(y.__value=Cn.settings.appearance.font?.preset||"sans-serif")??"",go(y,Cn.settings.appearance.font?.preset||"sans-serif")),Tn(Q,Cn.settings.appearance.fontSize??16),J(N,`${Cn.settings.appearance.fontSize??16??""}px`)}),Zc(h,()=>Cn.settings.appearance.theme,L=>Cn.settings.appearance.theme=L),T(n,l),ct()}yt(["change","input","click"]);const JCe=2500;let Mp=j(!0),xl=null,xk=j(!1),U0=!1;function j0(){xl&&clearTimeout(xl),xl=setTimeout(()=>{u(xk)||b(Mp,!1)},JCe)}function FU(){b(Mp,!0),j0()}function eEe(){U0||(U0=!0,window.addEventListener("mousemove",FU),j0())}function tEe(){U0&&(U0=!1,window.removeEventListener("mousemove",FU),xl&&(clearTimeout(xl),xl=null))}const po={get visible(){return u(Mp)},onMouseEnter(){b(xk,!0),xl&&(clearTimeout(xl),xl=null),b(Mp,!0)},onMouseLeave(){b(xk,!1),j0()},show(){b(Mp,!0),j0()},init:eEe,cleanup:tEe};var nEe=P('<div class="loading-state svelte-wlaory"><div class="loading-spinner svelte-wlaory"></div> <p>Loading book...</p></div>'),rEe=P('<div class="error-state svelte-wlaory"><div class="error-icon svelte-wlaory">!</div> <p> </p> <button class="svelte-wlaory">Retry</button></div>'),iEe=P('<div class="selection-popup svelte-wlaory"><button class="highlight-button svelte-wlaory"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-wlaory"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 0 2.8l-8.4 8.4a2 2 0 0 1-1.4.6H7a2 2 0 0 1-2-2v-3.6a2 2 0 0 1 .6-1.4l8.4-8.4a2 2 0 0 1 1.4-.6z"></path></svg> Highlight</button></div>'),sEe=P("<div><!></div> <!>",1);function oEe(n,e){lt(e,!0);let t=et(e,"initialCfi",3,""),r=et(e,"highlights",19,()=>[]),i=et(e,"fontSize",3,100),s=et(e,"themeOverride",3,"system"),o=et(e,"onRelocate",3,(re,ve,Te)=>{}),a=et(e,"onTocLoaded",3,re=>{}),l=et(e,"onMetadataLoaded",3,re=>{}),c=et(e,"onTextSelected",3,re=>{}),d=et(e,"onAddHighlight",3,(re,ve)=>""),h=et(e,"onError",3,re=>{}),f=et(e,"onMouseActivity",3,()=>{}),p=et(e,"onKeyDown",3,re=>{}),g,m=j(!1),v=j(!1),y=j(null),O=j(!1),_=null,x=null;const k=150;let S=j(null),E=j(!0),R=j(null),C=j(0),I=j(null),D=null,Q=j(!1),M=j(Qt({x:0,y:0})),N=null;async function B(){try{await _h(()=>import("./view-JuSt08YB.js").then(ve=>ve.v),__vite__mapDeps([0,1])),N=(await _h(()=>import("./overlayer-CvcsrVD0.js"),[])).Overlayer}catch(re){throw console.error("Failed to load foliate-js:",re),new Error("Failed to initialize EPUB reader")}}function H(re,ve){const Te=`font-size: ${ve}% !important;`;return re?`
        html {
          color-scheme: dark;
          background: #1a1a1a !important;
          color: #e0e0e0 !important;
          ${Te}
        }
        body {
          background: #1a1a1a !important;
          color: #e0e0e0 !important;
        }
        p, span, div, h1, h2, h3, h4, h5, h6, li, td, th, blockquote, pre, code, em, strong, b, i, u, s, small, big, sub, sup, dt, dd, figcaption, caption, label, legend, article, section, aside, header, footer, nav, main {
          color: #e0e0e0 !important;
        }
        a:link {
          color: #6db3f2 !important;
        }
        a:visited {
          color: #b4a7d6 !important;
        }
        img {
          filter: brightness(0.9);
        }
      `:`
        html {
          color-scheme: light;
          ${Te}
        }
      `}function F(){if(s()==="dark")return!0;if(s()==="light")return!1;const re=document.documentElement.getAttribute("data-theme");return re==="dark"?!0:re==="light"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches}function Z(){u(S)?.renderer?.setStyles&&u(S).renderer.setStyles(H(u(v),i()))}tt(()=>{if(u(S)&&i()&&u(m)&&!u(E))try{Z()}catch(re){console.debug("[EPUB] Could not apply font size styles:",re)}}),tt(()=>{if(s(),u(S)&&u(m)&&!u(E)){b(v,F(),!0);try{Z()}catch(re){console.debug("[EPUB] Could not apply theme styles:",re)}}});async function $(){if(!(!e.epubData||!g||!u(m))){b(E,!0),b(R,null),b(y,e.epubData,!0);try{if(await B(),!u(m)||!g)return;const re=document.createElement("foliate-view");re.style.width="100%",re.style.height="100%",re.setAttribute("flow","scrolled"),re.setAttribute("gap","5%"),re.setAttribute("max-inline-size","720px"),g.innerHTML="",g.appendChild(re),b(S,re,!0);const ve=new ArrayBuffer(e.epubData.byteLength);new Uint8Array(ve).set(new Uint8Array(e.epubData));const Te=new File([ve],"book.epub",{type:"application/epub+zip"});if(await u(S).open(Te),!u(m)||!g)return;if(u(S).book&&(u(S).book.toc&&a()(u(S).book.toc),u(S).book.metadata&&l()(u(S).book.metadata),u(S).book.sections&&b(C,u(S).book.sections.length,!0)),t())try{await u(S).goTo(t())}catch(Ne){console.warn("[EPUB] Failed to navigate to initial CFI:",Ne)}else try{await u(S).goToFraction(0)}catch(Ne){console.warn("[EPUB] Failed to navigate to beginning:",Ne)}u(S).addEventListener("relocate",W),u(S).addEventListener("load",G),u(S).addEventListener("draw-annotation",L),q(),r().length>0&&V(r()),b(v,F(),!0),Z(),b(E,!1)}catch(re){console.error("Failed to load EPUB:",re),b(R,re instanceof Error?re.message:"Failed to load EPUB",!0),b(E,!1),h()(re instanceof Error?re:new Error(String(re)))}}}function W(re){const{cfi:ve,fraction:Te,index:Ne}=re.detail,ce=(Te||0)*100;o()(ve||"",ce,{index:Ne??0,fraction:Te||0,totalLocations:u(C)})}function G(re){Le()}function L(re){const{draw:ve}=re.detail;N&&ve(N.highlight,{color:"#ffeb3b"})}function q(){D&&clearInterval(D),D=setInterval(()=>{se()},200),g?.addEventListener("mouseup",oe),g?.addEventListener("mousemove",fe),Le()}function ue(){D&&(clearInterval(D),D=null),g?.removeEventListener("mouseup",oe),g?.removeEventListener("mousemove",fe)}function oe(){setTimeout(()=>{se()},50)}function fe(){f()()}function be(re){p()(re)}const De=new WeakSet;function Le(){if(u(S))try{const ve=u(S).renderer;if(!ve?.getContents)return;const Te=ve.getContents();for(const Ne of Te){const ce=Ne.doc;ce&&!De.has(ce)&&(ce.addEventListener("mousemove",fe),ce.addEventListener("keydown",be),De.add(ce))}}catch{}}function he(re,ve){const Te=re.getBoundingClientRect(),Ne=g.getBoundingClientRect(),ce=ve.defaultView?.frameElement;let Oe=0,Qe=0;if(ce){const We=ce.getBoundingClientRect();Oe=We.left-Ne.left,Qe=We.top-Ne.top}return{x:Oe+Te.left+Te.width/2,y:Qe+Te.bottom}}function se(){if(u(S))try{const ve=u(S).renderer;if(!ve?.getContents)return;const Te=ve.getContents();for(const Ne of Te)try{const ce=Ne.doc;if(!ce)continue;const Oe=ce.getSelection();if(Oe&&Oe.rangeCount>0&&!Oe.isCollapsed){const Qe=Oe.getRangeAt(0),We=Qe.toString().trim();if(We&&We.length>0){const st=he(Qe,ce);try{const it=Ne.index??0,Ct=u(S).getCFI(it,Qe);(!u(I)||u(I).text!==We||u(I).cfi!==Ct)&&(b(I,{text:We,cfi:Ct,range:Qe,position:st},!0),b(Q,!0),b(M,st,!0),c()(u(I)));return}catch{(!u(I)||u(I).text!==We)&&(b(I,{text:We,cfi:"",range:Qe,position:st},!0),b(Q,!0),b(M,st,!0),c()(u(I)));return}}}}catch{}u(I)&&(b(I,null),b(Q,!1),c()(null))}catch{}}function V(re){if(u(S))for(const ve of re)try{u(S).addAnnotation({value:ve.cfi}),ne.set(ve.id,()=>{u(S)?.addAnnotation({value:ve.cfi},!0)})}catch(Te){console.warn("[EPUB] Failed to apply highlight:",ve.cfi,Te)}}const ne=new Map;async function ee(re){if(!(!u(m)||!u(S)||u(E)))try{await u(S).goTo(re)}catch(ve){console.debug("[EPUB] Navigation error (may be expected during cleanup):",ve)}}async function U(re){if(!(!u(m)||!u(S)||u(E)))try{await u(S).goTo({index:re})}catch(ve){console.debug("[EPUB] Navigation error (may be expected during cleanup):",ve)}}async function X(re){if(!(!u(m)||!u(S)||u(E)))try{await u(S).goTo(re)}catch(ve){console.debug("[EPUB] Navigation error (may be expected during cleanup):",ve)}}async function ie(){if(!(!u(m)||!u(S)||u(E)))try{await u(S).prev()}catch(re){console.debug("[EPUB] Navigation error (may be expected during cleanup):",re)}}async function ye(){if(!(!u(m)||!u(S)||u(E)))try{await u(S).next()}catch(re){console.debug("[EPUB] Navigation error (may be expected during cleanup):",re)}}function pe(){return u(S)}function de(){if(!u(I)||!u(I).cfi)return;const re=d()(u(I).text,u(I).cfi);if(re&&u(S))try{u(S).addAnnotation({value:u(I).cfi}),ne.set(re,()=>{u(S)?.addAnnotation({value:u(I).cfi},!0)})}catch(ve){console.error("[EPUB] Failed to add highlight:",ve)}b(I,null),b(Q,!1),c()(null)}function we(re){if(!u(m))return!1;const ve=ne.get(re);if(ve){try{ve()}catch(Te){console.debug("[EPUB] Failed to remove highlight (may be expected during cleanup):",Te)}return ne.delete(re),!0}return!1}function me(){b(I,null),b(Q,!1),c()(null)}let Ee=null,_e=null;function Ae(){const re=F();re!==u(v)&&(b(v,re,!0),Z())}qr(()=>{b(m,!0),Ee=new MutationObserver(re=>{for(const ve of re)ve.attributeName==="data-theme"&&Ae()}),Ee.observe(document.documentElement,{attributes:!0}),_e=window.matchMedia("(prefers-color-scheme: dark)"),_e.addEventListener("change",Ae),x=new ResizeObserver(()=>{b(O,!0),_&&clearTimeout(_),_=setTimeout(()=>{b(O,!1)},k)}),g&&x.observe(g),$()}),tt(()=>{u(m)&&e.epubData&&e.epubData!==u(y)&&$()}),Oo(()=>{b(m,!1),ue(),Ee?.disconnect(),_e?.removeEventListener("change",Ae),x?.disconnect(),_&&clearTimeout(_),u(S)&&(u(S).removeEventListener("relocate",W),u(S).removeEventListener("load",G),u(S).removeEventListener("draw-annotation",L),b(S,null)),ne.clear()});var ze={goToCfi:ee,goToSection:U,goToHref:X,prevPage:ie,nextPage:ye,getView:pe,removeHighlight:we,clearSelection:me},Be=sEe(),Se=Ie(Be);let Re;var He=w(Se);{var Me=re=>{var ve=nEe();T(re,ve)},Pe=re=>{var ve=Ve(),Te=Ie(ve);{var Ne=ce=>{var Oe=rEe(),Qe=A(w(Oe),2),We=w(Qe),st=A(Qe,2);st.__click=()=>$(),Y(()=>J(We,u(R))),T(ce,Oe)};z(Te,ce=>{u(R)&&ce(Ne)},!0)}T(re,ve)};z(He,re=>{u(E)?re(Me):re(Pe,!1)})}qt(Se,re=>g=re,()=>g);var ae=A(Se,2);{var te=re=>{var ve=iEe(),Te=w(ve);Te.__click=de,Y(()=>gn(ve,`left: ${u(M).x??""}px; top: ${u(M).y+10}px;`)),T(re,ve)};z(ae,re=>{u(Q)&&u(I)&&re(te)})}return Y(()=>Re=Ue(Se,1,"epub-reader svelte-wlaory",null,Re,{resizing:u(O)})),T(n,Be),ct(ze)}yt(["click"]);var aEe=P('<p class="toc-empty svelte-1swbmjf">No table of contents available</p>'),lEe=P('<button class="expand-button svelte-1swbmjf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></button>'),cEe=P('<span class="expand-placeholder svelte-1swbmjf"></span>'),uEe=P('<li class="toc-subitem svelte-1swbmjf"><button class="toc-link svelte-1swbmjf"> </button></li>'),dEe=P('<ul class="toc-sublist svelte-1swbmjf"></ul>'),hEe=P('<li class="toc-item svelte-1swbmjf"><div class="toc-item-row svelte-1swbmjf"><!> <button class="toc-link svelte-1swbmjf"> </button></div> <!></li>'),fEe=P('<nav class="toc-nav svelte-1swbmjf"><ul class="toc-list svelte-1swbmjf"></ul></nav>'),pEe=P('<div class="toc-container svelte-1swbmjf"><h3 class="toc-header svelte-1swbmjf">Contents</h3> <!></div>');function gEe(n,e){lt(e,!0);let t=et(e,"toc",19,()=>[]),r=et(e,"onNavigate",3,h=>{}),i=new kc;function s(h){i.has(h)?i.delete(h):i.add(h)}function o(h){r()(h.href)}var a=pEe(),l=A(w(a),2);{var c=h=>{var f=aEe();T(h,f)},d=h=>{var f=fEe(),p=w(f);Tt(p,21,t,g=>g.href,(g,m)=>{var v=hEe(),y=w(v),O=w(y);{var _=C=>{var I=lEe();I.__click=()=>s(u(m).label);var D=w(I);let Q;Y((M,N)=>{Pt(I,"aria-label",M),Q=Ue(D,0,"svelte-1swbmjf",null,Q,N)},[()=>i.has(u(m).label)?"Collapse":"Expand",()=>({rotated:i.has(u(m).label)})]),T(C,I)},x=C=>{var I=cEe();T(C,I)};z(O,C=>{u(m).subitems&&u(m).subitems.length>0?C(_):C(x,!1)})}var k=A(O,2);k.__click=()=>o(u(m));var S=w(k),E=A(y,2);{var R=C=>{var I=dEe();Tt(I,21,()=>u(m).subitems,D=>D.href,(D,Q)=>{var M=uEe(),N=w(M);N.__click=()=>o(u(Q));var B=w(N);Y(()=>J(B,u(Q).label)),T(D,M)}),T(C,I)};z(E,C=>{u(m).subitems&&u(m).subitems.length>0&&i.has(u(m).label)&&C(R)})}Y(()=>J(S,u(m).label)),T(g,v)}),T(h,f)};z(l,h=>{t().length===0?h(c):h(d,!1)})}T(n,a),ct()}yt(["click"]);var mEe=P('<p class="highlights-empty svelte-gxb7ac">No highlights yet. Select text while reading to create highlights.</p>'),vEe=P('<li class="highlight-item svelte-gxb7ac"><button class="highlight-content svelte-gxb7ac"><blockquote class="highlight-text svelte-gxb7ac"> </blockquote> <span class="highlight-date svelte-gxb7ac"> </span></button> <button class="delete-button svelte-gxb7ac" title="Delete highlight"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></li>'),yEe=P('<ul class="highlights-list svelte-gxb7ac"></ul>'),bEe=P('<div class="highlights-container svelte-gxb7ac"><h3 class="highlights-header svelte-gxb7ac">Highlights</h3> <!></div>');function wEe(n,e){lt(e,!0);let t=et(e,"highlights",19,()=>[]),r=et(e,"onNavigate",3,h=>{}),i=et(e,"onDelete",3,h=>{});function s(h){try{return new Date(h).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}catch{return""}}function o(h,f=100){return h.length<=f?h:h.slice(0,f).trim()+"..."}var a=bEe(),l=A(w(a),2);{var c=h=>{var f=mEe();T(h,f)},d=h=>{var f=yEe();Tt(f,21,t,p=>p.id,(p,g)=>{var m=vEe(),v=w(m);v.__click=()=>r()(u(g).cfi);var y=w(v),O=w(y),_=A(y,2),x=w(_),k=A(v,2);k.__click=S=>{S.stopPropagation(),i()(u(g).id)},Y((S,E)=>{J(O,`"${S??""}"`),J(x,E)},[()=>o(u(g).text),()=>s(u(g).createdAt)]),T(p,m)}),T(h,f)};z(l,h=>{t().length===0?h(c):h(d,!1)})}T(n,a),ct()}yt(["click"]);var _Ee=P('<div class="loading-state svelte-o3gk3"><div class="loading-spinner svelte-o3gk3"></div> <p>Loading book...</p></div>'),OEe=P('<div class="error-state svelte-o3gk3"><div class="error-icon svelte-o3gk3">!</div> <p> </p> <button class="svelte-o3gk3">Retry</button></div>'),xEe=P('<div class="chip svelte-o3gk3"><span class="chip-label svelte-o3gk3">author</span> <span class="chip-divider svelte-o3gk3"></span> <span class="chip-value svelte-o3gk3"> </span></div>'),kEe=P('<div class="chip svelte-o3gk3"><span class="chip-label svelte-o3gk3">last read</span> <span class="chip-divider svelte-o3gk3"></span> <span class="chip-value svelte-o3gk3"> </span></div>'),SEe=P('<div class="chip svelte-o3gk3"><span class="chip-label svelte-o3gk3">highlights</span> <span class="chip-divider svelte-o3gk3"></span> <span class="chip-value svelte-o3gk3"> </span></div>'),TEe=P('<div class="epub-chips svelte-o3gk3"><!> <div class="chip svelte-o3gk3"><span class="chip-label svelte-o3gk3">progress</span> <span class="chip-divider svelte-o3gk3"></span> <span class="chip-value svelte-o3gk3"> </span></div> <!> <!></div>'),AEe=P('<aside class="sidebar toc-panel svelte-o3gk3"><!></aside>'),CEe=P('<aside class="sidebar highlights-panel svelte-o3gk3"><!></aside>'),EEe=P('<button class="control-button svelte-o3gk3" aria-label="Previous page"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg></button>'),PEe=P('<button aria-label="Table of Contents"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>'),IEe=P('<span class="control-badge svelte-o3gk3"> </span>'),MEe=P('<button><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 0 2.8l-8.4 8.4a2 2 0 0 1-1.4.6H7a2 2 0 0 1-2-2v-3.6a2 2 0 0 1 .6-1.4l8.4-8.4a2 2 0 0 1 1.4-.6z"></path></svg> <!></button>'),REe=P('<button class="control-button svelte-o3gk3"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7V4h16v3"></path><path d="M9 20h6"></path><path d="M12 4v16"></path></svg> <span class="text-size-value svelte-o3gk3"> </span></button>'),DEe=P("<button> </button>"),NEe=P('<div class="text-size-popup svelte-o3gk3"></div>'),LEe=kn('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'),QEe=kn('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>'),$Ee=kn('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>'),FEe=P('<button class="control-button svelte-o3gk3"><!></button>'),zEe=P("<button> </button>"),BEe=P('<div class="theme-popup svelte-o3gk3"></div>'),UEe=P('<button class="control-button svelte-o3gk3" aria-label="Next page"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></button>'),jEe=P('<header class="epub-header svelte-o3gk3"><!></header> <div class="epub-content svelte-o3gk3"><!> <!> <main class="reader-container svelte-o3gk3"><!></main> <div class="controls-trigger svelte-o3gk3"><div><!> <!> <!> <div class="progress-indicator svelte-o3gk3"><div class="progress-bar svelte-o3gk3"><div class="progress-fill svelte-o3gk3"></div></div> <span class="progress-text svelte-o3gk3"> </span></div> <div class="text-size-container svelte-o3gk3"><!> <!></div> <div class="theme-container svelte-o3gk3"><!> <!></div> <!></div></div></div>',1),VEe=P('<div class="epub-viewer svelte-o3gk3"><!></div>');function qEe(n,e){lt(e,!0);let t=et(e,"onTitleChange",3,he=>{}),r=j(""),i=j(null),s=j(""),o=j(!0),a=j(null),l=j(Qt([])),c=j(Qt([])),d=j(0),h=j(!1),f=j(!1),p=j(null),g=j(!1);const m=[75,100,125,150,175,200],v=[{value:"system",label:"System"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}];let y=j(!1);const O=le(()=>Cn.settings.reader.theme);let _=null;const x=1e3,k=le(()=>()=>e.note.props??{epubHash:"",progress:0,textSize:100});function S(he){const se=he.match(/<!-- epub-highlights-start -->([\s\S]*?)<!-- epub-highlights-end -->/);if(!se)return[];const V=/> "([^"]+)" \[epubcfi\(([^)]+)\)\]\(([^|]+)\|([^)]+)\)/g,ne=[];let ee;for(;(ee=V.exec(se[1]))!==null;)ne.push({text:ee[1],cfi:`epubcfi(${ee[2]})`,id:ee[3],createdAt:ee[4]});return ne}function E(he,se){let V=he.replace(/<!-- epub-highlights-start -->[\s\S]*?<!-- epub-highlights-end -->\n?/,"");if(se.length===0)return V.trim();const ee=`<!-- epub-highlights-start -->
## Highlights

${se.map(U=>{const X=U.cfi.replace(/^epubcfi\(/,"").replace(/\)$/,"");return`> "${U.text}" [epubcfi(${X})](${U.id}|${U.createdAt})`}).join(`

`)}

<!-- epub-highlights-end -->`;return V.trim()+`

`+ee}async function R(he){if(!he){b(a,"No EPUB hash found"),b(o,!1);return}b(o,!0),b(a,null),b(s,he,!0);try{const se=await ns(e.note.id);b(r,se,!0);const V=await Vu.retrieve(he);if(!V){b(a,"EPUB file not found in storage"),b(o,!1);return}b(i,V,!0),b(c,S(u(r)),!0),b(o,!1)}catch(se){console.error("[EPUB Viewer] Failed to load EPUB:",se),b(a,se instanceof Error?se.message:"Failed to load EPUB",!0),b(o,!1)}}function C(he,se){b(d,se,!0),_&&clearTimeout(_),_=setTimeout(()=>{const V=u(k)().progress??0;(Math.abs(se-V)>1||he!==u(k)().currentCfi)&&jC(e.note.id,{currentCfi:he,progress:Math.round(se),lastRead:Wt()})},x)}function I(he){b(l,he,!0)}function D(he){}function Q(he,se){const V=`h-${Date.now().toString(36)}`,ne={id:V,cfi:se,text:he,createdAt:Wt()};b(c,[...u(c),ne],!0);const ee=E(u(r),u(c));return b(r,ee,!0),gc(e.note.id,ee),V}function M(he){b(c,u(c).filter(V=>V.id!==he),!0);const se=E(u(r),u(c));b(r,se,!0),gc(e.note.id,se)}function N(he){u(p)?.goToHref(he),b(h,!1)}function B(he){u(p)?.goToCfi(he),b(f,!1)}function H(he){VC(e.note.id,he),b(g,!1)}function F(he){const se=he.detail,V=u(k)().textSize??100,ne=m.indexOf(V);let ee;if(se.direction==="increase"){const U=ne<m.length-1?ne+1:ne;ee=m[U]}else if(se.direction==="decrease"){const U=ne>0?ne-1:0;ee=m[U]}else ee=100;VC(e.note.id,ee)}function Z(he){Cn.updateReaderTheme(he),b(y,!1)}function $(){po.show()}function W(){po.onMouseEnter()}function G(){po.onMouseLeave()}function L(he){if(!(he.target instanceof HTMLInputElement||he.target instanceof HTMLTextAreaElement))switch(he.key){case"ArrowLeft":he.preventDefault(),u(p)?.prevPage();break;case"ArrowRight":he.preventDefault(),u(p)?.nextPage();break}}function q(he){return`${Math.round(he)}%`}function ue(he){if(!he)return"â";try{const se=new Date(he);if(isNaN(se.getTime()))return he;const ne=new Date().getTime()-se.getTime(),ee=Math.floor(ne/(1e3*60*60*24));if(ee===0){const U=Math.floor(ne/36e5);if(U===0){const X=Math.floor(ne/6e4);return X<=1?"just now":`${X}m ago`}return`${U}h ago`}else return ee===1?"yesterday":ee<7?`${ee}d ago`:ee<30?`${Math.floor(ee/7)}w ago`:ee<365?`${Math.floor(ee/30)}mo ago`:se.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"2-digit"})}catch{return he}}function oe(){_&&clearTimeout(_);const he=u(k)();(he.currentCfi||u(d)>0)&&jC(e.note.id,{currentCfi:he.currentCfi,progress:Math.round(u(d)),lastRead:Wt()})}qr(()=>{const he=u(k)().epubHash;he&&R(he),window.addEventListener("keydown",L),window.addEventListener("reader-zoom",F)}),Oo(()=>{oe(),window.removeEventListener("keydown",L),window.removeEventListener("reader-zoom",F)}),tt(()=>{const he=u(k)().epubHash;he&&he!==u(s)&&R(he)});var fe=VEe(),be=w(fe);{var De=he=>{var se=_Ee();T(he,se)},Le=he=>{var se=Ve(),V=Ie(se);{var ne=U=>{var X=OEe(),ie=A(w(X),2),ye=w(ie),pe=A(ie,2);pe.__click=()=>R(u(k)().epubHash),Y(()=>J(ye,u(a))),T(U,X)},ee=U=>{var X=Ve(),ie=Ie(X);{var ye=pe=>{var de=jEe(),we=Ie(de),me=w(we);Xb(me,{get note(){return e.note},get onTitleChange(){return t()},chips:ft=>{var at=TEe(),pt=w(at);{var dt=Zt=>{var Nt=xEe(),Yt=A(w(Nt),4),ln=w(Yt);Y(Je=>J(ln,Je),[()=>u(k)().epubAuthor]),T(Zt,Nt)};z(pt,Zt=>{u(k)().epubAuthor&&Zt(dt)})}var _t=A(pt,2),wt=A(w(_t),4),Rt=w(wt),Et=A(_t,2);{var $t=Zt=>{var Nt=kEe(),Yt=A(w(Nt),4),ln=w(Yt);Y(Je=>J(ln,Je),[()=>ue(u(k)().lastRead)]),T(Zt,Nt)};z(Et,Zt=>{u(k)().lastRead&&Zt($t)})}var jt=A(Et,2);{var Kt=Zt=>{var Nt=SEe(),Yt=A(w(Nt),4),ln=w(Yt);Y(()=>J(ln,u(c).length)),T(Zt,Nt)};z(jt,Zt=>{u(c).length>0&&Zt(Kt)})}Y(Zt=>J(Rt,Zt),[()=>q(u(d))]),T(ft,at)},$$slots:{chips:!0}});var Ee=A(we,2);Ee.__mousemove=$;var _e=w(Ee);{var Ae=Xe=>{var ft=AEe(),at=w(ft);gEe(at,{get toc(){return u(l)},onNavigate:N}),T(Xe,ft)};z(_e,Xe=>{u(h)&&Xe(Ae)})}var ze=A(_e,2);{var Be=Xe=>{var ft=CEe(),at=w(ft);wEe(at,{get highlights(){return u(c)},onNavigate:B,onDelete:M}),T(Xe,ft)};z(ze,Xe=>{u(f)&&Xe(Be)})}var Se=A(ze,2),Re=w(Se);{let Xe=le(()=>u(k)().currentCfi),ft=le(()=>u(k)().textSize??100);qt(oEe(Re,{get epubData(){return u(i)},get initialCfi(){return u(Xe)},get highlights(){return u(c)},get fontSize(){return u(ft)},get themeOverride(){return u(O)},onRelocate:C,onTocLoaded:I,onTextSelected:D,onAddHighlight:Q,onMouseActivity:$,onKeyDown:L}),at=>b(p,at,!0),()=>u(p))}var He=A(Se,2),Me=w(He);let Pe;var ae=w(Me);ur(ae,{text:"Previous page",children:(Xe,ft)=>{var at=EEe();at.__click=()=>u(p)?.prevPage(),T(Xe,at)},$$slots:{default:!0}});var te=A(ae,2);ur(te,{text:"Table of Contents",children:(Xe,ft)=>{var at=PEe();let pt;at.__click=()=>{b(h,!u(h)),b(f,!1)},Y(()=>pt=Ue(at,1,"control-button svelte-o3gk3",null,pt,{active:u(h)})),T(Xe,at)},$$slots:{default:!0}});var re=A(te,2);ur(re,{text:"Highlights",children:(Xe,ft)=>{var at=MEe();let pt;at.__click=()=>{b(f,!u(f)),b(h,!1)};var dt=A(w(at),2);{var _t=wt=>{var Rt=IEe(),Et=w(Rt);Y(()=>J(Et,u(c).length)),T(wt,Rt)};z(dt,wt=>{u(c).length>0&&wt(_t)})}Y(()=>pt=Ue(at,1,"control-button svelte-o3gk3",null,pt,{active:u(f)})),T(Xe,at)},$$slots:{default:!0}});var ve=A(re,2),Te=w(ve),Ne=w(Te),ce=A(Te,2),Oe=w(ce),Qe=A(ve,2),We=w(Qe);ur(We,{text:"Text size",children:(Xe,ft)=>{var at=REe();at.__click=()=>b(g,!u(g));var pt=A(w(at),2),dt=w(pt);Y(_t=>J(dt,`${_t??""}%`),[()=>u(k)().textSize??100]),T(Xe,at)},$$slots:{default:!0}});var st=A(We,2);{var it=Xe=>{var ft=NEe();Tt(ft,20,()=>m,at=>at,(at,pt)=>{var dt=DEe();let _t;dt.__click=()=>H(pt);var wt=w(dt);Y(Rt=>{_t=Ue(dt,1,"text-size-option svelte-o3gk3",null,_t,Rt),J(wt,`${pt??""}%`)},[()=>({active:(u(k)().textSize??100)===pt})]),T(at,dt)}),T(Xe,ft)};z(st,Xe=>{u(g)&&Xe(it)})}var Ct=A(Qe,2),bt=w(Ct);ur(bt,{text:"Reader theme",children:(Xe,ft)=>{var at=FEe();at.__click=()=>b(y,!u(y));var pt=w(at);{var dt=wt=>{var Rt=LEe();T(wt,Rt)},_t=wt=>{var Rt=Ve(),Et=Ie(Rt);{var $t=Kt=>{var Zt=QEe();T(Kt,Zt)},jt=Kt=>{var Zt=$Ee();T(Kt,Zt)};z(Et,Kt=>{u(O)==="light"?Kt($t):Kt(jt,!1)},!0)}T(wt,Rt)};z(pt,wt=>{u(O)==="dark"?wt(dt):wt(_t,!1)})}T(Xe,at)},$$slots:{default:!0}});var xt=A(bt,2);{var mt=Xe=>{var ft=BEe();Tt(ft,21,()=>v,at=>at.value,(at,pt)=>{var dt=zEe();let _t;dt.__click=()=>Z(u(pt).value);var wt=w(dt);Y(()=>{_t=Ue(dt,1,"theme-option svelte-o3gk3",null,_t,{active:u(O)===u(pt).value}),J(wt,u(pt).label)}),T(at,dt)}),T(Xe,ft)};z(xt,Xe=>{u(y)&&Xe(mt)})}var Ge=A(Ct,2);ur(Ge,{text:"Next page",children:(Xe,ft)=>{var at=UEe();at.__click=()=>u(p)?.nextPage(),T(Xe,at)},$$slots:{default:!0}}),Y(Xe=>{Pe=Ue(Me,1,"bottom-controls svelte-o3gk3",null,Pe,{visible:po.visible}),gn(Ne,`width: ${u(d)??""}%`),J(Oe,Xe)},[()=>q(u(d))]),It("mouseenter",Me,W),It("mouseleave",Me,G),T(pe,de)};z(ie,pe=>{u(i)&&pe(ye)},!0)}T(U,X)};z(V,U=>{u(a)?U(ne):U(ee,!1)},!0)}T(he,se)};z(be,he=>{u(o)?he(De):he(Le,!1)})}T(n,fe),ct()}yt(["click","mousemove"]);var HEe=P('<div class="loading-state svelte-1ge0ih8"><div class="loading-spinner svelte-1ge0ih8"></div> <p>Loading PDF...</p></div>'),ZEe=P('<div class="page-placeholder svelte-1ge0ih8"><span class="page-number svelte-1ge0ih8"> </span></div>'),WEe=P('<div class="pdf-page svelte-1ge0ih8"><!></div>'),XEe=P('<div class="pdf-pages svelte-1ge0ih8"></div>'),YEe=P('<div class="selection-popup svelte-1ge0ih8"><button class="highlight-button svelte-1ge0ih8"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 0 2.8l-8.4 8.4a2 2 0 0 1-1.4.6H7a2 2 0 0 1-2-2v-3.6a2 2 0 0 1 .6-1.4l8.4-8.4a2 2 0 0 1 1.4-.6z"></path></svg> Highlight</button></div>'),GEe=P("<div><!> <!></div>");function KEe(n,e){lt(e,!0),ac.workerSrc=JS;let t=et(e,"initialPage",3,1),r=et(e,"highlights",19,()=>[]),i=et(e,"zoomLevel",3,100),s=et(e,"themeOverride",3,"system"),o=et(e,"onPageChange",3,(U,X)=>{}),a=et(e,"onOutlineLoaded",3,U=>{}),l=et(e,"onTextSelected",3,U=>{}),c=et(e,"onAddHighlight",3,(U,X,ie)=>""),d=et(e,"onError",3,U=>{}),h,f=j(void 0),p=j(null),g=j(!0),m=j(1),v=j(0),y=le(()=>i()/100),O=j(null),_=j(!1),x=j(Qt({x:0,y:0})),k=new m0,S=new kc,E=new m0,R=null,C=j(!1),I=null,D=null;function Q(){if(s()==="dark")return!0;if(s()==="light")return!1;const U=document.documentElement.getAttribute("data-theme");return U==="dark"?!0:U==="light"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches}function M(){b(C,Q(),!0)}async function N(){b(g,!0);try{const U=kb({data:e.pdfData});b(p,await U.promise,!0),b(v,u(p).numPages,!0);for(let X=1;X<=u(v);X++){const ye=(await u(p).getPage(X)).getViewport({scale:1});k.set(X,{width:ye.width,height:ye.height})}await B(),b(g,!1),await fl(),t()>1&&G(t()),F()}catch(U){console.error("[PDF Reader] Failed to load PDF:",U),d()(U instanceof Error?U:new Error("Failed to load PDF")),b(g,!1)}}async function B(){if(u(p))try{const U=await u(p).getOutline();if(U){const X=await H(U);a()(X)}}catch(U){console.warn("[PDF Reader] Failed to load outline:",U)}}async function H(U){if(!U||!u(p))return[];const X=[];for(const ie of U){let ye=1;if(ie.dest)try{let de=ie.dest;if(typeof de=="string"&&(de=await u(p).getDestination(de)??[]),Array.isArray(de)&&de[0]){const we=de[0];ye=await u(p).getPageIndex(we)+1}}catch{}const pe={label:ie.title||"Untitled",pageNumber:ye};ie.items&&ie.items.length>0&&(pe.children=await H(ie.items)),X.push(pe)}return X}function F(){R&&R.disconnect(),R=new IntersectionObserver(U=>{for(const X of U){const ie=parseInt(X.target.getAttribute("data-page")||"0");ie>0&&X.isIntersecting&&Z(ie)}},{root:h,rootMargin:"200px",threshold:0});for(const[,U]of E)R.observe(U)}async function Z(U){if(!u(p)||S.has(U))return;const X=E.get(U);if(X){S.add(U);try{const ie=await u(p).getPage(U),ye=ie.getViewport({scale:u(y)}),pe=window.devicePixelRatio||1,de=document.createElement("canvas");de.className="pdf-page-canvas",de.width=Math.floor(ye.width*pe),de.height=Math.floor(ye.height*pe),de.style.width=`${ye.width}px`,de.style.height=`${ye.height}px`;const we=de.getContext("2d");if(!we)return;we.scale(pe,pe),await ie.render({canvasContext:we,viewport:ye,canvas:de}).promise;const me=document.createElement("div");me.className="textLayer",me.style.setProperty("--total-scale-factor",String(u(y)));const Ee=await ie.getTextContent();await new bi({textContentSource:Ee,container:me,viewport:ye}).render(),me.style.width=`${ye.width}px`,me.style.height=`${ye.height}px`;const Ae=document.createElement("div");Ae.className="pdf-highlight-layer",Ae.style.width=`${ye.width}px`,Ae.style.height=`${ye.height}px`;const ze=r().filter(Be=>Be.pageNumber===U);for(const Be of ze)for(const Se of Be.rects){const Re=document.createElement("div");Re.className="pdf-highlight",Re.style.left=`${Se.x*ye.width}px`,Re.style.top=`${Se.y*ye.height}px`,Re.style.width=`${Se.width*ye.width}px`,Re.style.height=`${Se.height*ye.height}px`,Ae.appendChild(Re)}X.innerHTML="",X.appendChild(de),X.appendChild(Ae),X.appendChild(me)}catch(ie){console.error(`[PDF Reader] Failed to render page ${U}:`,ie),S.delete(U)}}}async function $(){if(u(p)){S.clear();for(const[U,X]of E){const ie=X.getBoundingClientRect(),ye=h.getBoundingClientRect();ie.bottom>ye.top&&ie.top<ye.bottom&&await Z(U)}}}function W(){if(!u(f))return;const U=h.getBoundingClientRect(),X=U.top+U.height/2;let ie=1,ye=1/0;for(const[pe,de]of E){const we=de.getBoundingClientRect(),me=we.top+we.height/2,Ee=Math.abs(me-X);Ee<ye&&(ye=Ee,ie=pe)}ie!==u(m)&&(b(m,ie,!0),o()(u(m),u(v)))}function G(U){if(U<1||U>u(v)||!h)return;const X=E.get(U);if(X){const ie=X.offsetTop-h.offsetTop;h.scrollTo({top:ie,behavior:"smooth"})}}function L(){u(m)>1&&G(u(m)-1)}function q(){u(m)<u(v)&&G(u(m)+1)}function ue(){const U=window.getSelection();if(!U||U.isCollapsed){b(O,null),b(_,!1),l()(null);return}const X=U.toString().trim();if(!X){b(O,null),b(_,!1),l()(null);return}const ie=U.anchorNode;if(!ie)return;const ye=ie.parentElement?.closest(".textLayer");if(!ye)return;const pe=ye.closest(".pdf-page");if(!pe)return;const de=parseInt(pe.getAttribute("data-page")||"0");if(de<=0)return;const we=U.getRangeAt(0),me=Array.from(we.getClientRects()),Ee=pe.getBoundingClientRect(),_e=k.get(de);if(!_e)return;const Ae=_e.width*u(y),ze=_e.height*u(y),Be=me.map(Se=>({x:(Se.left-Ee.left)/Ae,y:(Se.top-Ee.top)/ze,width:Se.width/Ae,height:Se.height/ze}));if(b(O,{text:X,pageNumber:de,rects:Be},!0),me.length>0){const Se=me[me.length-1];b(x,{x:Se.right,y:Se.bottom+5},!0),b(_,!0)}l()(u(O))}function oe(){if(!u(O))return;c()(u(O).text,u(O).pageNumber,u(O).rects)&&(S.delete(u(O).pageNumber),Z(u(O).pageNumber)),window.getSelection()?.removeAllRanges(),b(O,null),b(_,!1)}function fe(U,X){return E.set(X,U),R&&R.observe(U),{destroy(){E.delete(X),R&&R.unobserve(U)}}}tt(()=>{e.pdfData&&as(()=>{N()})}),tt(()=>{i();const U=u(p),X=u(g);U&&!X&&as(()=>{$()})}),tt(()=>{const U=r(),X=u(p),ie=u(g);X&&!ie&&as(()=>{const ye=new Set(U.map(pe=>pe.pageNumber));for(const pe of ye)S.has(pe)&&(S.delete(pe),Z(pe))})}),tt(()=>{s(),b(C,Q(),!0)}),qr(()=>{b(C,Q(),!0),I=new MutationObserver(U=>{for(const X of U)X.attributeName==="data-theme"&&M()}),I.observe(document.documentElement,{attributes:!0}),D=window.matchMedia("(prefers-color-scheme: dark)"),D.addEventListener("change",M),document.addEventListener("selectionchange",ue)}),Oo(()=>{R&&R.disconnect(),I&&I.disconnect(),D&&D.removeEventListener("change",M),document.removeEventListener("selectionchange",ue)});var be={goToPage:G,prevPage:L,nextPage:q},De=GEe();let Le;var he=w(De);{var se=U=>{var X=HEe();T(U,X)},V=U=>{var X=Ve(),ie=Ie(X);{var ye=pe=>{var de=XEe();Tt(de,20,()=>Array.from({length:u(v)},(we,me)=>me+1),we=>we,(we,me)=>{const Ee=le(()=>k.get(me));var _e=WEe(),Ae=w(_e);{var ze=Be=>{var Se=ZEe(),Re=w(Se),He=w(Re);Y(()=>J(He,`Page ${me??""}`)),T(Be,Se)};z(Ae,Be=>{S.has(me)||Be(ze)})}Hc(_e,(Be,Se)=>fe?.(Be,Se),()=>me),Y(()=>{Pt(_e,"data-page",me),gn(_e,`width: ${u(Ee)?u(Ee).width*u(y):612}px; height: ${u(Ee)?u(Ee).height*u(y):792}px;`)}),T(we,_e)}),qt(de,we=>b(f,we),()=>u(f)),T(pe,de)};z(ie,pe=>{u(p)&&pe(ye)},!0)}T(U,X)};z(he,U=>{u(g)?U(se):U(V,!1)})}var ne=A(he,2);{var ee=U=>{var X=YEe(),ie=w(X);ie.__click=oe,Y(()=>gn(X,`left: ${u(x).x??""}px; top: ${u(x).y??""}px;`)),T(U,X)};z(ne,U=>{u(_)&&u(O)&&U(ee)})}return qt(De,U=>h=U,()=>h),Y(()=>Le=Ue(De,1,"pdf-reader svelte-1ge0ih8",null,Le,{"dark-mode":u(C)})),It("scroll",De,W),T(n,De),ct(be)}yt(["click"]);var JEe=P('<div class="empty-outline svelte-1je2s1v"><p>No outline available</p></div>'),ePe=P('<span><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></span>'),tPe=P('<span class="expand-placeholder svelte-1je2s1v"></span>'),nPe=P('<div class="outline-children svelte-1je2s1v"></div>'),rPe=P('<div class="outline-item svelte-1je2s1v"><button><!> <span class="item-label svelte-1je2s1v"> </span> <span class="item-page svelte-1je2s1v"> </span></button> <!></div>'),iPe=P('<div class="outline-list svelte-1je2s1v"></div>'),sPe=P('<div class="pdf-outline svelte-1je2s1v"><div class="outline-header svelte-1je2s1v"><h3 class="svelte-1je2s1v">Contents</h3></div> <!></div>');function oPe(n,e){lt(e,!0);let t=et(e,"currentPage",3,1),r=et(e,"onNavigate",3,p=>{}),i=new kc;function s(p,g){return`${g}-${p.pageNumber}-${p.label.slice(0,20)}`}function o(p){i.has(p)?i.delete(p):i.add(p)}function a(p,g){p.children&&p.children.length>0&&o(g),r()(p.pageNumber)}function l(p){return p.pageNumber===t()}var c=sPe(),d=A(w(c),2);{var h=p=>{var g=JEe();T(p,g)},f=p=>{var g=iPe();{const m=(v,y=Zl,O=Zl,_=Zl)=>{const x=le(()=>s(y(),_())),k=le(()=>y().children&&y().children.length>0),S=le(()=>i.has(u(x))),E=le(()=>l(y()));var R=rPe(),C=w(R);let I;C.__click=()=>a(y(),u(x));var D=w(C);{var Q=W=>{var G=ePe();let L;Y(()=>L=Ue(G,1,"expand-icon svelte-1je2s1v",null,L,{expanded:u(S)})),T(W,G)},M=W=>{var G=tPe();T(W,G)};z(D,W=>{u(k)?W(Q):W(M,!1)})}var N=A(D,2),B=w(N),H=A(N,2),F=w(H),Z=A(C,2);{var $=W=>{var G=nPe();Tt(G,23,()=>y().children,(L,q)=>s(L,`${_()}-${q}`),(L,q,ue)=>{m(L,()=>u(q),()=>O()+1,()=>`${_()}-${u(ue)}`)}),T(W,G)};z(Z,W=>{u(k)&&u(S)&&W($)})}Y(()=>{gn(R,`--depth: ${O()??""}`),I=Ue(C,1,"outline-item-button svelte-1je2s1v",null,I,{current:u(E),"has-children":u(k)}),Pt(C,"title",`Page ${y().pageNumber??""}`),J(B,y().label),J(F,y().pageNumber)}),T(v,R)};Tt(g,23,()=>e.outline,(v,y)=>s(v,`${y}`),(v,y,O)=>{m(v,()=>u(y),()=>0,()=>`${u(O)}`)})}T(p,g)};z(d,p=>{e.outline.length===0?p(h):p(f,!1)})}T(n,c),ct()}yt(["click"]);var aPe=P('<span class="highlights-count svelte-nqr8fq"> </span>'),lPe=P('<div class="empty-highlights svelte-nqr8fq"><p class="svelte-nqr8fq">No highlights yet</p> <p class="hint svelte-nqr8fq">Select text to create highlights</p></div>'),cPe=P('<span class="highlight-time"> </span>'),uPe=P('<div class="highlight-item svelte-nqr8fq"><button class="highlight-content svelte-nqr8fq"><span class="highlight-text svelte-nqr8fq"> </span> <div class="highlight-meta svelte-nqr8fq"><span class="highlight-page svelte-nqr8fq"> </span> <!></div></button> <button class="delete-button svelte-nqr8fq" title="Delete highlight"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>'),dPe=P('<div class="highlights-list svelte-nqr8fq"></div>'),hPe=P('<div class="pdf-highlights svelte-nqr8fq"><div class="highlights-header svelte-nqr8fq"><h3 class="svelte-nqr8fq">Highlights</h3> <!></div> <!></div>');function fPe(n,e){lt(e,!0);let t=et(e,"onNavigate",3,g=>{}),r=et(e,"onDelete",3,g=>{});const i=le(()=>[...e.highlights].sort((g,m)=>g.pageNumber!==m.pageNumber?g.pageNumber-m.pageNumber:new Date(g.createdAt).getTime()-new Date(m.createdAt).getTime()));function s(g){try{const m=new Date(g);if(isNaN(m.getTime()))return"";const y=new Date().getTime()-m.getTime(),O=Math.floor(y/(1e3*60*60*24));if(O===0){const _=Math.floor(y/36e5);if(_===0){const x=Math.floor(y/6e4);return x<=1?"just now":`${x}m ago`}return`${_}h ago`}else return O===1?"yesterday":O<7?`${O}d ago`:O<30?`${Math.floor(O/7)}w ago`:m.toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return""}}function o(g,m=150){return g.length<=m?g:g.slice(0,m).trim()+"..."}var a=hPe(),l=w(a),c=A(w(l),2);{var d=g=>{var m=aPe(),v=w(m);Y(()=>J(v,e.highlights.length)),T(g,m)};z(c,g=>{e.highlights.length>0&&g(d)})}var h=A(l,2);{var f=g=>{var m=lPe();T(g,m)},p=g=>{var m=dPe();Tt(m,21,()=>u(i),v=>v.id,(v,y)=>{var O=uPe(),_=w(O);_.__click=()=>t()(u(y).pageNumber);var x=w(_),k=w(x),S=A(x,2),E=w(S),R=w(E),C=A(E,2);{var I=Q=>{var M=cPe(),N=w(M);Y(B=>J(N,B),[()=>s(u(y).createdAt)]),T(Q,M)};z(C,Q=>{s(u(y).createdAt)&&Q(I)})}var D=A(_,2);D.__click=()=>r()(u(y).id),Y(Q=>{Pt(_,"title",`Go to page ${u(y).pageNumber??""}`),J(k,`"${Q??""}"`),J(R,`Page ${u(y).pageNumber??""}`)},[()=>o(u(y).text)]),T(v,O)}),T(g,m)};z(h,g=>{e.highlights.length===0?g(f):g(p,!1)})}T(n,a),ct()}yt(["click"]);var pPe=P('<div class="loading-state svelte-hw3pcz"><div class="loading-spinner svelte-hw3pcz"></div> <p>Loading PDF...</p></div>'),gPe=P('<div class="error-state svelte-hw3pcz"><div class="error-icon svelte-hw3pcz">!</div> <p> </p> <button class="svelte-hw3pcz">Retry</button></div>'),mPe=P('<div class="chip svelte-hw3pcz"><span class="chip-label svelte-hw3pcz">author</span> <span class="chip-divider svelte-hw3pcz"></span> <span class="chip-value svelte-hw3pcz"> </span></div>'),vPe=P('<div class="chip svelte-hw3pcz"><span class="chip-label svelte-hw3pcz">last read</span> <span class="chip-divider svelte-hw3pcz"></span> <span class="chip-value svelte-hw3pcz"> </span></div>'),yPe=P('<div class="chip svelte-hw3pcz"><span class="chip-label svelte-hw3pcz">highlights</span> <span class="chip-divider svelte-hw3pcz"></span> <span class="chip-value svelte-hw3pcz"> </span></div>'),bPe=P('<div class="pdf-chips svelte-hw3pcz"><!> <div class="chip svelte-hw3pcz"><span class="chip-label svelte-hw3pcz">pages</span> <span class="chip-divider svelte-hw3pcz"></span> <span class="chip-value svelte-hw3pcz"> </span></div> <div class="chip svelte-hw3pcz"><span class="chip-label svelte-hw3pcz">progress</span> <span class="chip-divider svelte-hw3pcz"></span> <span class="chip-value svelte-hw3pcz"> </span></div> <!> <!></div>'),wPe=P('<aside class="sidebar outline-panel svelte-hw3pcz"><!></aside>'),_Pe=P('<aside class="sidebar highlights-panel svelte-hw3pcz"><!></aside>'),OPe=P('<button class="control-button svelte-hw3pcz" aria-label="Previous page"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg></button>'),xPe=P('<button aria-label="Table of Contents"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>'),kPe=P('<span class="control-badge svelte-hw3pcz"> </span>'),SPe=P('<button><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 0 2.8l-8.4 8.4a2 2 0 0 1-1.4.6H7a2 2 0 0 1-2-2v-3.6a2 2 0 0 1 .6-1.4l8.4-8.4a2 2 0 0 1 1.4-.6z"></path></svg> <!></button>'),TPe=P('<button class="control-button svelte-hw3pcz"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg> <span class="zoom-value svelte-hw3pcz"> </span></button>'),APe=P("<button> </button>"),CPe=P('<div class="zoom-popup svelte-hw3pcz"></div>'),EPe=kn('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'),PPe=kn('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>'),IPe=kn('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>'),MPe=P('<button class="control-button svelte-hw3pcz"><!></button>'),RPe=P("<button> </button>"),DPe=P('<div class="theme-popup svelte-hw3pcz"></div>'),NPe=P('<button class="control-button svelte-hw3pcz" aria-label="Next page"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></button>'),LPe=P('<header class="pdf-header svelte-hw3pcz"><!></header> <div class="pdf-content svelte-hw3pcz"><!> <!> <main class="reader-container svelte-hw3pcz"><!></main> <div class="controls-trigger svelte-hw3pcz"><div><!> <!> <!> <div class="page-indicator svelte-hw3pcz"><span class="page-text svelte-hw3pcz"> </span></div> <div class="zoom-container svelte-hw3pcz"><!> <!></div> <div class="theme-container svelte-hw3pcz"><!> <!></div> <!></div></div></div>',1),QPe=P('<div class="pdf-viewer svelte-hw3pcz"><!></div>');function $Pe(n,e){lt(e,!0);let t=et(e,"onTitleChange",3,he=>{}),r=j(""),i=j(null),s=j(""),o=j(!0),a=j(null),l=j(Qt([])),c=j(Qt([])),d=j(1),h=j(0),f=j(!1),p=j(!1),g=j(null),m=j(!1);const v=[50,75,100,125,150,200],y=[{value:"system",label:"System"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}];let O=j(!1);const _=le(()=>Cn.settings.reader.theme);let x=null;const k=1e3,S=le(()=>()=>e.note.props??{pdfHash:"",totalPages:0,currentPage:1,zoomLevel:100});function E(he){const se=he.match(/<!-- pdf-highlights-start -->([\s\S]*?)<!-- pdf-highlights-end -->/);if(!se)return[];const V=/> "([^"]+)" \[page:(\d+)\]\(([^|]+)\|([^|]+)\|([^)]+)\)/g,ne=[];let ee;for(;(ee=V.exec(se[1]))!==null;)try{const U=JSON.parse(ee[4]);ne.push({text:ee[1],pageNumber:parseInt(ee[2]),id:ee[3],rects:U,createdAt:ee[5]})}catch{}return ne}function R(he,se){let V=he.replace(/<!-- pdf-highlights-start -->[\s\S]*?<!-- pdf-highlights-end -->\n?/,"");if(se.length===0)return V.trim();const ee=`<!-- pdf-highlights-start -->
## Highlights

${se.map(U=>{const X=JSON.stringify(U.rects);return`> "${U.text}" [page:${U.pageNumber}](${U.id}|${X}|${U.createdAt})`}).join(`

`)}

<!-- pdf-highlights-end -->`;return V.trim()+`

`+ee}async function C(he){if(!he){b(a,"No PDF hash found"),b(o,!1);return}b(o,!0),b(a,null),b(s,he,!0);try{const se=await ns(e.note.id);b(r,se,!0);const V=await Hu.retrieve(he);if(!V){b(a,"PDF file not found in storage"),b(o,!1);return}b(i,V,!0),b(c,E(u(r)),!0),b(h,u(S)().totalPages||0,!0),b(d,u(S)().currentPage||1,!0),b(o,!1)}catch(se){console.error("[PDF Viewer] Failed to load PDF:",se),b(a,se instanceof Error?se.message:"Failed to load PDF",!0),b(o,!1)}}function I(he,se){b(d,he,!0),b(h,se,!0),x&&clearTimeout(x),x=setTimeout(()=>{qC(e.note.id,{currentPage:he,lastRead:Wt()})},k)}function D(he){b(l,he,!0)}function Q(he,se,V){const ne=`h-${Date.now().toString(36)}`,ee={id:ne,pageNumber:se,text:he,rects:V,createdAt:Wt()};b(c,[...u(c),ee],!0);const U=R(u(r),u(c));return b(r,U,!0),gc(e.note.id,U),ne}function M(he){b(c,u(c).filter(V=>V.id!==he),!0);const se=R(u(r),u(c));b(r,se,!0),gc(e.note.id,se)}function N(he){u(g)?.goToPage(he),b(f,!1)}function B(he){u(g)?.goToPage(he),b(p,!1)}function H(he){HC(e.note.id,he),b(m,!1)}function F(he){const se=he.detail,V=u(S)().zoomLevel??100,ne=v.indexOf(V);let ee;if(se.direction==="increase"){const U=ne<v.length-1?ne+1:ne;ee=v[U]}else if(se.direction==="decrease"){const U=ne>0?ne-1:0;ee=v[U]}else ee=100;HC(e.note.id,ee)}function Z(he){Cn.updateReaderTheme(he),b(O,!1)}function $(){po.show()}function W(){po.onMouseEnter()}function G(){po.onMouseLeave()}function L(he){if(!(he.target instanceof HTMLInputElement||he.target instanceof HTMLTextAreaElement))switch(he.key){case"ArrowLeft":case"PageUp":he.preventDefault(),u(g)?.prevPage();break;case"ArrowRight":case"PageDown":he.preventDefault(),u(g)?.nextPage();break}}function q(){return u(h)===0?"0%":`${Math.round(u(d)/u(h)*100)}%`}function ue(he){if(!he)return"â";try{const se=new Date(he);if(isNaN(se.getTime()))return he;const ne=new Date().getTime()-se.getTime(),ee=Math.floor(ne/(1e3*60*60*24));if(ee===0){const U=Math.floor(ne/36e5);if(U===0){const X=Math.floor(ne/6e4);return X<=1?"just now":`${X}m ago`}return`${U}h ago`}else return ee===1?"yesterday":ee<7?`${ee}d ago`:ee<30?`${Math.floor(ee/7)}w ago`:ee<365?`${Math.floor(ee/30)}mo ago`:se.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"2-digit"})}catch{return he}}function oe(){x&&clearTimeout(x),u(d)>0&&qC(e.note.id,{currentPage:u(d),lastRead:Wt()})}qr(()=>{const he=u(S)().pdfHash;he&&C(he),window.addEventListener("keydown",L),window.addEventListener("reader-zoom",F)}),Oo(()=>{oe(),window.removeEventListener("keydown",L),window.removeEventListener("reader-zoom",F)}),tt(()=>{const he=u(S)().pdfHash;he&&he!==u(s)&&C(he)});var fe=QPe(),be=w(fe);{var De=he=>{var se=pPe();T(he,se)},Le=he=>{var se=Ve(),V=Ie(se);{var ne=U=>{var X=gPe(),ie=A(w(X),2),ye=w(ie),pe=A(ie,2);pe.__click=()=>C(u(S)().pdfHash),Y(()=>J(ye,u(a))),T(U,X)},ee=U=>{var X=Ve(),ie=Ie(X);{var ye=pe=>{var de=LPe(),we=Ie(de),me=w(we);Xb(me,{get note(){return e.note},get onTitleChange(){return t()},chips:Ge=>{var Xe=bPe(),ft=w(Xe);{var at=Nt=>{var Yt=mPe(),ln=A(w(Yt),4),Je=w(ln);Y(ge=>J(Je,ge),[()=>u(S)().pdfAuthor]),T(Nt,Yt)};z(ft,Nt=>{u(S)().pdfAuthor&&Nt(at)})}var pt=A(ft,2),dt=A(w(pt),4),_t=w(dt),wt=A(pt,2),Rt=A(w(wt),4),Et=w(Rt),$t=A(wt,2);{var jt=Nt=>{var Yt=vPe(),ln=A(w(Yt),4),Je=w(ln);Y(ge=>J(Je,ge),[()=>ue(u(S)().lastRead)]),T(Nt,Yt)};z($t,Nt=>{u(S)().lastRead&&Nt(jt)})}var Kt=A($t,2);{var Zt=Nt=>{var Yt=yPe(),ln=A(w(Yt),4),Je=w(ln);Y(()=>J(Je,u(c).length)),T(Nt,Yt)};z(Kt,Nt=>{u(c).length>0&&Nt(Zt)})}Y(Nt=>{J(_t,`${u(d)??""} / ${u(h)??""}`),J(Et,Nt)},[q]),T(Ge,Xe)},$$slots:{chips:!0}});var Ee=A(we,2);Ee.__mousemove=$;var _e=w(Ee);{var Ae=mt=>{var Ge=wPe(),Xe=w(Ge);oPe(Xe,{get outline(){return u(l)},get currentPage(){return u(d)},onNavigate:N}),T(mt,Ge)};z(_e,mt=>{u(f)&&mt(Ae)})}var ze=A(_e,2);{var Be=mt=>{var Ge=_Pe(),Xe=w(Ge);fPe(Xe,{get highlights(){return u(c)},onNavigate:B,onDelete:M}),T(mt,Ge)};z(ze,mt=>{u(p)&&mt(Be)})}var Se=A(ze,2),Re=w(Se);{let mt=le(()=>u(S)().currentPage??1),Ge=le(()=>u(S)().zoomLevel??100);qt(KEe(Re,{get pdfData(){return u(i)},get initialPage(){return u(mt)},get highlights(){return u(c)},get zoomLevel(){return u(Ge)},get themeOverride(){return u(_)},onPageChange:I,onOutlineLoaded:D,onAddHighlight:Q}),Xe=>b(g,Xe,!0),()=>u(g))}var He=A(Se,2),Me=w(He);let Pe;var ae=w(Me);ur(ae,{text:"Previous page",children:(mt,Ge)=>{var Xe=OPe();Xe.__click=()=>u(g)?.prevPage(),T(mt,Xe)},$$slots:{default:!0}});var te=A(ae,2);ur(te,{text:"Table of Contents",children:(mt,Ge)=>{var Xe=xPe();let ft;Xe.__click=()=>{b(f,!u(f)),b(p,!1)},Y(()=>ft=Ue(Xe,1,"control-button svelte-hw3pcz",null,ft,{active:u(f)})),T(mt,Xe)},$$slots:{default:!0}});var re=A(te,2);ur(re,{text:"Highlights",children:(mt,Ge)=>{var Xe=SPe();let ft;Xe.__click=()=>{b(p,!u(p)),b(f,!1)};var at=A(w(Xe),2);{var pt=dt=>{var _t=kPe(),wt=w(_t);Y(()=>J(wt,u(c).length)),T(dt,_t)};z(at,dt=>{u(c).length>0&&dt(pt)})}Y(()=>ft=Ue(Xe,1,"control-button svelte-hw3pcz",null,ft,{active:u(p)})),T(mt,Xe)},$$slots:{default:!0}});var ve=A(re,2),Te=w(ve),Ne=w(Te),ce=A(ve,2),Oe=w(ce);ur(Oe,{text:"Zoom level",children:(mt,Ge)=>{var Xe=TPe();Xe.__click=()=>b(m,!u(m));var ft=A(w(Xe),2),at=w(ft);Y(pt=>J(at,`${pt??""}%`),[()=>u(S)().zoomLevel??100]),T(mt,Xe)},$$slots:{default:!0}});var Qe=A(Oe,2);{var We=mt=>{var Ge=CPe();Tt(Ge,20,()=>v,Xe=>Xe,(Xe,ft)=>{var at=APe();let pt;at.__click=()=>H(ft);var dt=w(at);Y(_t=>{pt=Ue(at,1,"zoom-option svelte-hw3pcz",null,pt,_t),J(dt,`${ft??""}%`)},[()=>({active:(u(S)().zoomLevel??100)===ft})]),T(Xe,at)}),T(mt,Ge)};z(Qe,mt=>{u(m)&&mt(We)})}var st=A(ce,2),it=w(st);ur(it,{text:"Reader theme",children:(mt,Ge)=>{var Xe=MPe();Xe.__click=()=>b(O,!u(O));var ft=w(Xe);{var at=dt=>{var _t=EPe();T(dt,_t)},pt=dt=>{var _t=Ve(),wt=Ie(_t);{var Rt=$t=>{var jt=PPe();T($t,jt)},Et=$t=>{var jt=IPe();T($t,jt)};z(wt,$t=>{u(_)==="light"?$t(Rt):$t(Et,!1)},!0)}T(dt,_t)};z(ft,dt=>{u(_)==="dark"?dt(at):dt(pt,!1)})}T(mt,Xe)},$$slots:{default:!0}});var Ct=A(it,2);{var bt=mt=>{var Ge=DPe();Tt(Ge,21,()=>y,Xe=>Xe.value,(Xe,ft)=>{var at=RPe();let pt;at.__click=()=>Z(u(ft).value);var dt=w(at);Y(()=>{pt=Ue(at,1,"theme-option svelte-hw3pcz",null,pt,{active:u(_)===u(ft).value}),J(dt,u(ft).label)}),T(Xe,at)}),T(mt,Ge)};z(Ct,mt=>{u(O)&&mt(bt)})}var xt=A(st,2);ur(xt,{text:"Next page",children:(mt,Ge)=>{var Xe=NPe();Xe.__click=()=>u(g)?.nextPage(),T(mt,Xe)},$$slots:{default:!0}}),Y(()=>{Pe=Ue(Me,1,"bottom-controls svelte-hw3pcz",null,Pe,{visible:po.visible}),J(Ne,`Page ${u(d)??""} of ${u(h)??""}`)}),It("mouseenter",Me,W),It("mouseleave",Me,G),T(pe,de)};z(ie,pe=>{u(i)&&pe(ye)},!0)}T(U,X)};z(V,U=>{u(a)?U(ne):U(ee,!1)},!0)}T(he,se)};z(be,he=>{u(o)?he(De):he(Le,!1)})}T(n,fe),ct()}yt(["click","mousemove"]);var FPe=P('<div class="webpage-reader svelte-1880gu9"></div>');function zPe(n,e){lt(e,!0);let t=et(e,"highlights",19,()=>[]),r=et(e,"onRelocate",3,()=>{}),i=et(e,"onMetadataLoaded",3,()=>{}),s=et(e,"onTextSelected",3,()=>{}),o=et(e,"onError",3,()=>{}),a=j(void 0),l=null,c=null,d=j(!1),h=j(!1),f="",p=null,g=j(null);function m(){const L=document.documentElement.getAttribute("data-theme");return L==="dark"?!0:L==="light"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches}function v(L){return`
      :host {
        display: block;
        width: 100%;
        background: ${L?"#1a1a1a":"#ffffff"};
        color: ${L?"#e0e0e0":"#1a1a1a"};
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        -webkit-user-select: text;
        user-select: text;
        cursor: text;
      }

      .content-wrapper {
        max-width: 720px;
        margin: 0 auto;
        padding: 2rem 1.5rem;
        line-height: 1.7;
        -webkit-user-select: text;
        user-select: text;
        cursor: text;
      }

      * {
        -webkit-user-select: text;
        user-select: text;
      }

      article {
        font-size: 1.1rem;
      }

      h1 {
        font-size: 2rem;
        line-height: 1.3;
        margin-bottom: 0.5rem;
        font-weight: 700;
      }

      h2 {
        font-size: 1.5rem;
        margin-top: 2rem;
        margin-bottom: 1rem;
      }

      h3 {
        font-size: 1.25rem;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
      }

      p {
        margin-bottom: 1.25rem;
      }

      .byline {
        color: ${L?"#999":"#666"};
        font-style: italic;
        margin-bottom: 2rem;
      }

      a {
        color: ${L?"#6db3f2":"#0066cc"};
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      img {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        margin: 1rem 0;
      }

      blockquote {
        border-left: 4px solid ${L?"#444":"#ddd"};
        margin: 1.5rem 0;
        padding-left: 1rem;
        color: ${L?"#aaa":"#555"};
        font-style: italic;
      }

      pre, code {
        background: ${L?"#2a2a2a":"#f5f5f5"};
        border-radius: 4px;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
        font-size: 0.9em;
      }

      code {
        padding: 0.2em 0.4em;
      }

      pre {
        padding: 1rem;
        overflow-x: auto;
      }

      pre code {
        padding: 0;
        background: none;
      }

      ul, ol {
        margin-bottom: 1.25rem;
        padding-left: 1.5rem;
      }

      li {
        margin-bottom: 0.5rem;
      }

      hr {
        border: none;
        border-top: 1px solid ${L?"#444":"#ddd"};
        margin: 2rem 0;
      }

      figure {
        margin: 1.5rem 0;
      }

      figcaption {
        font-size: 0.9rem;
        color: ${L?"#888":"#666"};
        text-align: center;
        margin-top: 0.5rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 1.5rem 0;
      }

      th, td {
        border: 1px solid ${L?"#444":"#ddd"};
        padding: 0.75rem;
        text-align: left;
      }

      th {
        background: ${L?"#2a2a2a":"#f5f5f5"};
      }

      .highlight {
        background: ${L?"rgba(255, 235, 59, 0.3)":"rgba(255, 235, 59, 0.5)"};
        border-radius: 2px;
        padding: 0 2px;
      }

      ::selection {
        background: ${L?"rgba(100, 150, 255, 0.4)":"rgba(0, 100, 255, 0.2)"};
      }
    `}function y(){if(!(!e.htmlContent||!u(a)||!u(d)))try{const ue=new DOMParser().parseFromString(e.htmlContent,"text/html").body.innerHTML,oe=FT.sanitize(ue,{ADD_TAGS:["article","section","header","footer","aside","figure","figcaption"],ADD_ATTR:["target"],FORBID_TAGS:["script","style","iframe","object","embed","form"],FORBID_ATTR:["onerror","onload","onclick","onmouseover"]});l||(l=u(a).attachShadow({mode:"open"})),b(h,m(),!0);const fe=document.createElement("style");fe.textContent=v(u(h)),c=document.createElement("div"),c.className="content-wrapper",c.innerHTML=oe,f=c.textContent||"",l.innerHTML="",l.appendChild(fe),l.appendChild(c),t().length>0&&C(t()),c.addEventListener("click",_),x(),u(a).addEventListener("scroll",O),i()(null)}catch(L){console.error("[WebpageReader] Failed to render content:",L),o()(L instanceof Error?L:new Error(String(L)))}}function O(){if(!u(a)||!c)return;const L=u(a).scrollTop,q=u(a).scrollHeight-u(a).clientHeight,ue=q>0?L/q*100:0;r()(Math.min(100,Math.max(0,ue)))}function _(L){const ue=L.target.closest("a");if(ue){L.preventDefault(),L.stopPropagation();const oe=ue.getAttribute("href");if(!oe)return;let fe;if(oe.startsWith("http://")||oe.startsWith("https://"))fe=oe;else{console.warn("[WebpageReader] Cannot resolve relative URL without base URL",{href:oe});return}window.api?.openExternal({url:fe})}}function x(){p&&clearInterval(p),p=setInterval(()=>{E()},200),c?.addEventListener("mouseup",S)}function k(){p&&(clearInterval(p),p=null),c?.removeEventListener("mouseup",S)}function S(){setTimeout(()=>{E()},50)}function E(){if(!(!l||!c))try{const L=l.getSelection?.()||document.getSelection();if(L&&L.rangeCount>0&&!L.isCollapsed){const q=L.getRangeAt(0);if(!l.contains(q.commonAncestorContainer)){u(g)&&(b(g,null),s()(null));return}const ue=q.toString().trim();if(ue&&ue.length>0){const oe=document.createRange();oe.setStart(c,0),oe.setEnd(q.startContainer,q.startOffset);const fe=oe.toString().length,be=fe+ue.length,{prefix:De,suffix:Le}=R(f,fe,be),he=q.getBoundingClientRect(),se={text:ue,prefix:De,suffix:Le,startOffset:fe,endOffset:be,position:{x:he.left+he.width/2,y:he.bottom}};(!u(g)||u(g).text!==ue)&&(b(g,se,!0),s()(u(g)));return}}u(g)&&(b(g,null),s()(null))}catch{}}function R(L,q,ue,oe=30){const fe=L.slice(Math.max(0,q-oe),q),be=L.slice(ue,Math.min(L.length,ue+oe));return{prefix:fe,suffix:be}}function C(L){if(!c||!f)return;c.querySelectorAll(".highlight").forEach(ue=>{const oe=ue.parentNode;oe&&(oe.replaceChild(document.createTextNode(ue.textContent||""),ue),oe.normalize())});for(const ue of L){const oe=I(f,ue);oe&&D(oe.start,oe.end,ue.id)}}function I(L,q){const ue=q.prefix+q.text+q.suffix;let oe=L.indexOf(ue);return oe!==-1?{start:oe+q.prefix.length,end:oe+q.prefix.length+q.text.length}:(oe=L.indexOf(q.text),oe!==-1?{start:oe,end:oe+q.text.length}:q.startOffset>=0&&q.endOffset<=L.length&&L.slice(q.startOffset,q.endOffset)===q.text?{start:q.startOffset,end:q.endOffset}:null)}function D(L,q,ue){if(!c)return;const oe=document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null);let fe=0,be=null,De=0,Le=null,he=0;for(;oe.nextNode();){const se=oe.currentNode,V=se.length;if(!be&&fe+V>L&&(be=se,De=L-fe),be&&fe+V>=q){Le=se,he=q-fe;break}fe+=V}if(be&&Le)try{const se=document.createRange();se.setStart(be,De),se.setEnd(Le,he);const V=document.createElement("span");V.className="highlight",se.surroundContents(V)}catch{}}function Q(){if(!l)return;const L=l.querySelector("style");L&&(b(h,m(),!0),L.textContent=v(u(h)))}function M(){u(a)?.scrollTo({top:0,behavior:"smooth"})}function N(L){if(!u(a))return;const q=u(a).scrollHeight-u(a).clientHeight,ue=L/100*q;u(a).scrollTo({top:ue,behavior:"smooth"})}function B(){b(g,null),s()(null)}function H(){C(t())}tt(()=>{e.htmlContent&&u(a)&&u(d)&&y()}),tt(()=>{t()&&c&&C(t())});let F=null,Z=null;function $(){m()!==u(h)&&Q()}qr(()=>{b(d,!0),F=new MutationObserver(L=>{for(const q of L)q.attributeName==="data-theme"&&$()}),F.observe(document.documentElement,{attributes:!0}),Z=window.matchMedia("(prefers-color-scheme: dark)"),Z.addEventListener("change",$)}),Oo(()=>{b(d,!1),k(),F?.disconnect(),Z?.removeEventListener("change",$),u(a)?.removeEventListener("scroll",O),c?.removeEventListener("click",_)});var W={scrollToTop:M,scrollToProgress:N,clearSelection:B,refreshHighlights:H},G=FPe();return qt(G,L=>b(a,L),()=>u(a)),T(n,G),ct(W)}var BPe=P('<div class="loading-state svelte-1cxkx5u"><div class="loading-spinner svelte-1cxkx5u"></div> <p>Loading article...</p></div>'),UPe=P('<div class="error-state svelte-1cxkx5u"><div class="error-icon svelte-1cxkx5u">!</div> <p> </p> <button class="svelte-1cxkx5u">Retry</button></div>'),jPe=P('<div class="chip svelte-1cxkx5u"><span class="chip-label svelte-1cxkx5u">site</span> <span class="chip-divider svelte-1cxkx5u"></span> <span class="chip-value svelte-1cxkx5u"> </span></div>'),VPe=P('<div class="chip svelte-1cxkx5u"><span class="chip-label svelte-1cxkx5u">author</span> <span class="chip-divider svelte-1cxkx5u"></span> <span class="chip-value svelte-1cxkx5u"> </span></div>'),qPe=P('<div class="chip svelte-1cxkx5u"><span class="chip-label svelte-1cxkx5u">last read</span> <span class="chip-divider svelte-1cxkx5u"></span> <span class="chip-value svelte-1cxkx5u"> </span></div>'),HPe=P('<div class="chip svelte-1cxkx5u"><span class="chip-label svelte-1cxkx5u">highlights</span> <span class="chip-divider svelte-1cxkx5u"></span> <span class="chip-value svelte-1cxkx5u"> </span></div>'),ZPe=P('<button class="chip chip-link svelte-1cxkx5u"><span class="chip-label svelte-1cxkx5u">source</span> <span class="chip-divider svelte-1cxkx5u"></span> <span class="chip-value link-icon svelte-1cxkx5u"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1cxkx5u"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></span></button>'),WPe=P('<div class="webpage-chips svelte-1cxkx5u"><!> <!> <div class="chip svelte-1cxkx5u"><span class="chip-label svelte-1cxkx5u">progress</span> <span class="chip-divider svelte-1cxkx5u"></span> <span class="chip-value svelte-1cxkx5u"> </span></div> <!> <!> <!></div>'),XPe=P('<div class="highlight-popup svelte-1cxkx5u"><button class="highlight-btn svelte-1cxkx5u"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 12L12 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M10 4L12 2L14 4L12 6L10 4Z" fill="currentColor"></path><path d="M2 14H6L10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg> Highlight</button></div>'),YPe=P('<div class="highlight-item svelte-1cxkx5u"><blockquote class="svelte-1cxkx5u"> </blockquote> <div class="highlight-actions svelte-1cxkx5u"><span class="highlight-date svelte-1cxkx5u"> </span> <button class="delete-btn svelte-1cxkx5u" aria-label="Delete highlight">Ã</button></div></div>'),GPe=P('<div class="highlights-section svelte-1cxkx5u"><h3 class="highlights-header svelte-1cxkx5u">Highlights</h3> <div class="highlights-list svelte-1cxkx5u"></div></div>'),KPe=P('<header class="webpage-header svelte-1cxkx5u"><!></header> <!> <!> <!>',1),JPe=P('<div class="webpage-viewer svelte-1cxkx5u"><!></div>');function eIe(n,e){lt(e,!0);let t=et(e,"onTitleChange",3,F=>{}),r=j(""),i=j(null),s=j(Qt([])),o=j(!0),a=j(null),l=j(null),c=j(!1),d=j(void 0),h=j(0),f=null;const p=le(()=>()=>e.note.props??{webpageHash:"",webpageUrl:"",progress:0});let g=j("");tt(()=>{const F=u(p)().webpageHash;F&&F!==u(g)&&m(F)}),tt(()=>{u(r),v()});async function m(F){b(o,!0),b(a,null),b(i,null),b(g,F,!0);try{if(!F)throw new Error("Webpage hash not found in note");const Z=await ns(e.note.id);b(r,Z,!0);const $=await Fa.retrieve(F);if(!$)throw new Error("Webpage content not found in storage");b(i,$,!0),b(h,u(p)().progress??0,!0),v(),b(o,!1)}catch(Z){console.error("[WebpageViewer] Failed to load content:",Z),b(a,Z instanceof Error?Z.message:"Failed to load webpage",!0),b(o,!1)}}function v(){if(!u(r)){b(s,[],!0);return}const F=I(u(r));b(s,F,!0)}function y(F){b(h,F,!0),f&&clearTimeout(f),f=setTimeout(()=>{CJ(e.note.id,{progress:Math.round(F),lastRead:new Date().toISOString()})},500)}function O(F){b(l,F,!0),b(c,F!==null)}function _(){if(!u(l)||!e.note)return;const F={id:`h-${Date.now().toString(36)}`,text:u(l).text,prefix:u(l).prefix,suffix:u(l).suffix,startOffset:u(l).startOffset,endOffset:u(l).endOffset,createdAt:new Date().toISOString()},Z=[...u(s),F];b(s,Z,!0);const $=Q(u(r),Z);b(r,$,!0),gc(e.note.id,$),b(l,null),b(c,!1),u(d)?.clearSelection()}function x(F){if(!e.note)return;const Z=u(s).filter(W=>W.id!==F);b(s,Z,!0);const $=Q(u(r),Z);b(r,$,!0),gc(e.note.id,$)}function k(){const F=u(p)().webpageUrl;F&&window.api?.openExternal({url:F})}function S(F){return`${Math.round(F)}%`}function E(F){if(!F)return"â";try{const Z=new Date(F);if(isNaN(Z.getTime()))return F;const W=new Date().getTime()-Z.getTime(),G=Math.floor(W/(1e3*60*60*24));if(G===0){const L=Math.floor(W/36e5);if(L===0){const q=Math.floor(W/6e4);return q<=1?"just now":`${q}m ago`}return`${L}h ago`}else return G===1?"yesterday":G<7?`${G}d ago`:G<30?`${Math.floor(G/7)}w ago`:G<365?`${Math.floor(G/30)}mo ago`:Z.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"2-digit"})}catch{return F}}const R="<!-- webpage-highlights-start -->",C="<!-- webpage-highlights-end -->";function I(F){const Z=F.indexOf(R),$=F.indexOf(C);if(Z===-1||$===-1||Z>=$)return[];const W=F.slice(Z+R.length,$),G=[],L=/^>\s*"(.+?)"\s*\[([^.]*)\.\.\.(.*?)\]\(([^|]+)\|([^|]+)\|(\d+)-(\d+)\)/gm;let q;for(;(q=L.exec(W))!==null;)try{G.push({text:decodeURIComponent(q[1]),prefix:decodeURIComponent(q[2]),suffix:decodeURIComponent(q[3]),id:q[4],createdAt:q[5],startOffset:parseInt(q[6],10),endOffset:parseInt(q[7],10)})}catch{}return G}function D(F){if(F.length===0)return"";const Z=F.map($=>{const W=encodeURIComponent($.text),G=encodeURIComponent($.prefix),L=encodeURIComponent($.suffix);return`> "${W}" [${G}...${L}](${$.id}|${$.createdAt}|${$.startOffset}-${$.endOffset})`});return`

${R}
## Highlights

${Z.join(`

`)}
${C}`}function Q(F,Z){const $=F.indexOf(R),W=F.indexOf(C);let G=F;$!==-1&&W!==-1&&(G=F.slice(0,$).trimEnd()+F.slice(W+C.length));const L=D(Z);return G.trimEnd()+L}qr(()=>()=>{f&&clearTimeout(f)});var M=JPe(),N=w(M);{var B=F=>{var Z=BPe();T(F,Z)},H=F=>{var Z=Ve(),$=Ie(Z);{var W=L=>{var q=UPe(),ue=A(w(q),2),oe=w(ue),fe=A(ue,2);fe.__click=()=>m(u(p)().webpageHash),Y(()=>J(oe,u(a))),T(L,q)},G=L=>{var q=Ve(),ue=Ie(q);{var oe=fe=>{var be=KPe(),De=Ie(be),Le=w(De);Xb(Le,{get note(){return e.note},get onTitleChange(){return t()},chips:X=>{var ie=WPe(),ye=w(ie);{var pe=Me=>{var Pe=jPe(),ae=A(w(Pe),4),te=w(ae);Y(re=>J(te,re),[()=>u(p)().webpageSiteName]),T(Me,Pe)};z(ye,Me=>{u(p)().webpageSiteName&&Me(pe)})}var de=A(ye,2);{var we=Me=>{var Pe=VPe(),ae=A(w(Pe),4),te=w(ae);Y(re=>J(te,re),[()=>u(p)().webpageAuthor]),T(Me,Pe)};z(de,Me=>{u(p)().webpageAuthor&&Me(we)})}var me=A(de,2),Ee=A(w(me),4),_e=w(Ee),Ae=A(me,2);{var ze=Me=>{var Pe=qPe(),ae=A(w(Pe),4),te=w(ae);Y(re=>J(te,re),[()=>E(u(p)().lastRead)]),T(Me,Pe)};z(Ae,Me=>{u(p)().lastRead&&Me(ze)})}var Be=A(Ae,2);{var Se=Me=>{var Pe=HPe(),ae=A(w(Pe),4),te=w(ae);Y(()=>J(te,u(s).length)),T(Me,Pe)};z(Be,Me=>{u(s).length>0&&Me(Se)})}var Re=A(Be,2);{var He=Me=>{var Pe=ZPe();Pe.__click=k,T(Me,Pe)};z(Re,Me=>{u(p)().webpageUrl&&Me(He)})}Y(Me=>J(_e,Me),[()=>S(u(h))]),T(X,ie)},$$slots:{chips:!0}});var he=A(De,2);qt(zPe(he,{get htmlContent(){return u(i)},get highlights(){return u(s)},onRelocate:y,onTextSelected:O}),U=>b(d,U,!0),()=>u(d));var se=A(he,2);{var V=U=>{var X=XPe(),ie=w(X);ie.__click=_,Y(()=>gn(X,`left: ${u(l).position.x??""}px; top: ${u(l).position.y+10}px;`)),T(U,X)};z(se,U=>{u(c)&&u(l)&&U(V)})}var ne=A(se,2);{var ee=U=>{var X=GPe(),ie=A(w(X),2);Tt(ie,21,()=>u(s),ye=>ye.id,(ye,pe)=>{var de=YPe(),we=w(de),me=w(we),Ee=A(we,2),_e=w(Ee),Ae=w(_e),ze=A(_e,2);ze.__click=()=>x(u(pe).id),Y(Be=>{J(me,`"${u(pe).text??""}"`),J(Ae,Be)},[()=>new Date(u(pe).createdAt).toLocaleDateString()]),T(ye,de)}),T(U,X)};z(ne,U=>{u(s).length>0&&U(ee)})}T(fe,be)};z(ue,fe=>{u(i)&&fe(oe)},!0)}T(L,q)};z($,L=>{u(a)?L(W):L(G,!1)},!0)}T(F,Z)};z(N,F=>{u(o)?F(B):F(H,!1)})}T(n,M),ct()}yt(["click"]);var tIe=P('<div class="archived-banner svelte-uj2fgs"><span class="archived-text svelte-uj2fgs">This note is archived</span> <button class="unarchive-button svelte-uj2fgs">Unarchive</button></div>'),nIe=P('<div class="title-display svelte-uj2fgs"> </div>'),rIe=P('<textarea class="title-input svelte-uj2fgs" placeholder="Untitled Deck" rows="1"></textarea>'),iIe=P('<div class="deck-viewer svelte-uj2fgs"><!> <header class="deck-header svelte-uj2fgs"><div class="header-row svelte-uj2fgs"><div class="title-area svelte-uj2fgs"><!> <!></div></div></header> <div class="deck-content svelte-uj2fgs"><!></div></div>');function sIe(n,e){lt(e,!0);const t=le(()=>e.note.archived);let r=j(null);const i=le(()=>$d(e.note.id)??kS());function s(k){ES(e.note.id,k)}function o(k){const S=k.target;e.onTitleChange?.(S.value),l()}function a(k){k.key==="Enter"&&k.preventDefault()}function l(){u(r)&&(u(r).style.height="auto",u(r).style.height=u(r).scrollHeight+"px")}tt(()=>{e.note.title,fl().then(()=>{l()})});var c=iIe(),d=w(c);{var h=k=>{var S=tIe(),E=A(w(S),2);E.__click=()=>e.onUnarchive?.(),T(k,S)};z(d,k=>{e.note.archived&&k(h)})}var f=A(d,2),p=w(f),g=w(p),m=w(g);bU(m,{get noteId(){return e.note.id},get currentTypeId(){return e.note.type},compact:!0,get disabled(){return u(t)}});var v=A(m,2);{var y=k=>{var S=nIe(),E=w(S);Y(()=>J(E,e.note.title||"Untitled Deck")),T(k,S)},O=k=>{var S=rIe();S.__input=o,S.__keydown=a,qt(S,E=>b(r,E),()=>u(r)),Y(()=>Tn(S,e.note.title)),T(k,S)};z(v,k=>{u(t)?k(y):k(O,!1)})}var _=A(f,2),x=w(_);oB(x,{get config(){return u(i)},onConfigChange:s,get onNoteOpen(){return e.onNoteOpen}}),T(n,c),ct()}yt(["click","input","keydown"]);function Ng(n){const e=typeof n=="string"?new Date(n):new Date(n);e.setHours(0,0,0,0);const t=e.getDay(),r=t===0?6:t-1,i=new Date(e);i.setDate(e.getDate()-r);const s=new Date(i);s.setDate(i.getDate()+6);const o=kk(i),a=kk(s),l=oIe(i),c=i.getFullYear();return{startDate:o,endDate:a,year:c,weekNumber:l}}function kk(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}function Yh(n){return new Date(n+"T00:00:00")}function oIe(n){const e=new Date(n);e.setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));const t=new Date(e.getFullYear(),0,1);return Math.ceil(((e.getTime()-t.getTime())/864e5+1)/7)}function aIe(n,e="short"){const t=Yh(n.startDate),r=Yh(n.endDate);if(e==="short"){const i=t.toLocaleDateString("en-US",{month:"short"}),s=t.getDate();return`Week of ${i} ${s}`}else{const i=t.toLocaleDateString("en-US",{month:"short"}),s=r.toLocaleDateString("en-US",{month:"short"}),o=t.getDate(),a=r.getDate();return i===s?`${i} ${o} - ${a}`:`${i} ${o} - ${s} ${a}`}}function zU(n){const e=Yh(n.startDate);return e.setDate(e.getDate()-7),Ng(e)}function BU(n){const e=Yh(n.startDate);return e.setDate(e.getDate()+7),Ng(e)}function UU(){return Ng(new Date)}function lD(n){const e=kk(new Date);return n===e}function lIe(n){const e=Yh(n),t=e.toLocaleDateString("en-US",{weekday:"short"}),r=e.toLocaleDateString("en-US",{month:"short"}),i=e.getDate();return`${t} ${r} ${i}`}function cIe(n,e){const t=Ng(n),r=Ng(e);return t.startDate===r.startDate}var uIe=P('<button class="today-button svelte-uk0b1h" title="Jump to current week">Today</button>'),dIe=P('<div class="week-navigation svelte-uk0b1h"><div class="nav-container svelte-uk0b1h"><button class="nav-button svelte-uk0b1h" title="Previous week"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"></polyline></svg> <span class="nav-text svelte-uk0b1h">Previous</span></button> <div class="week-display svelte-uk0b1h"><h1 class="week-title svelte-uk0b1h"> </h1> <!></div> <button class="nav-button svelte-uk0b1h" title="Next week"><span class="nav-text svelte-uk0b1h">Next</span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"></polyline></svg></button></div></div>');function hIe(n,e){lt(e,!0);const t=UU(),r=le(()=>cIe(e.weekData.startDate,t.startDate));function i(){const y={startDate:e.weekData.startDate,endDate:e.weekData.endDate,year:new Date(e.weekData.startDate).getFullYear()},O=zU(y);e.onNavigateToWeek(O.startDate)}function s(){const y={startDate:e.weekData.startDate,endDate:e.weekData.endDate,year:new Date(e.weekData.startDate).getFullYear()},O=BU(y);e.onNavigateToWeek(O.startDate)}function o(){u(r)||e.onNavigateToWeek(t.startDate)}const a=le(()=>{const y={startDate:e.weekData.startDate,endDate:e.weekData.endDate,year:new Date(e.weekData.startDate).getFullYear()};return aIe(y,"short")});var l=dIe(),c=w(l),d=w(c);d.__click=i;var h=A(d,2),f=w(h),p=w(f),g=A(f,2);{var m=y=>{var O=uIe();O.__click=o,T(y,O)};z(g,y=>{u(r)||y(m)})}var v=A(h,2);v.__click=s,Y(()=>J(p,u(a))),T(n,l),ct()}yt(["click"]);function cD(n){const e=n-1;return e*e*e+1}var fIe=P('<button class="expand-btn svelte-h9odob" type="button"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6,9 12,15 18,9"></polyline></svg> <span>Show more</span></button>'),pIe=P('<div class="fade-overlay svelte-h9odob" role="button" tabindex="-1"><div class="fade-gradient svelte-h9odob"></div> <!></div>'),gIe=P('<div><div class="editor-container editor-font svelte-h9odob"></div> <!></div>');function mIe(n,e){lt(e,!0);let t=j(null),r=null,i=j(!1),s=j(!1),o=j(!0),a=null,l=j(!1),c=j(null),d=j(!0),h=j(""),f=j(!1),p=j(!1);tt(()=>{const L=e.date;b(d,!0),b(c,null),b(f,!1);const q=S5(L);q?Yp(q.id).then(ue=>{if(ue&&e.date===L){b(c,ue,!0);const oe=ue.doc();b(h,oe?.content||"",!0),b(d,!1),ue.on("change",({doc:fe})=>{fe&&b(h,fe.content||"",!0)})}}):(b(f,!0),b(d,!1),b(h,""))});const g=le(()=>u(h).trim().length>0),m=le(()=>u(i)||u(s)?"none":u(g)?"168px":"72px"),v=le(()=>!u(i)&&!u(s)&&u(o)&&u(g)&&u(l)),y=le(()=>!u(i)&&!u(s)&&u(g)&&u(l));function O(L,q){return new tT({onWikilinkClick:k,placeholder:"Start typing to create entry...",variant:"daily-note",automergeSync:L?{handle:L,path:["content"]}:void 0,onDocChange:q})}async function _(L){if(!u(f)||u(p)||!L.docChanged)return;const q=L.state.doc.toString();if(q.trim()){b(p,!0);try{const ue=await T5(e.date),oe=await Yp(ue.id);if(oe){if(oe.change(fe=>{fe.content=q}),b(c,oe,!0),b(h,q,!0),b(f,!1),r){const fe=r.state.selection;r.destroy(),r=null,x.destroy(),x=O(oe),x.initializeTheme();const be=un.create({doc:q,extensions:x.getExtensions(),selection:fe});r=new gt({state:be,parent:u(t)}),r.dom.addEventListener("focusin",()=>S(!0)),r.dom.addEventListener("focusout",()=>{setTimeout(()=>{r&&!r.hasFocus&&S(!1)},10)}),r.focus()}oe.on("change",({doc:fe})=>{fe&&b(h,fe.content||"",!0)})}}finally{b(p,!1)}}}let x=O(null);async function k(L,q,ue){const oe=ue?.targetType||"note",fe=ue?.shouldCreate||!1;if(oe==="conversation")AS(L),Dr({type:"conversation",id:L}),Fn(null);else if(oe==="type")mu(L),Fn("types");else if(fe){const be=await zs({title:q});El(be),Rs(be),Fn(null)}else El(L),Rs(L),Fn(null)}function S(L){b(i,L,!0),L?(b(o,!1),a&&(clearTimeout(a),a=null)):(b(s,!1),a&&clearTimeout(a),a=setTimeout(()=>{b(o,!0),a=null},500))}function E(){b(s,!u(s)),u(s)&&r&&r.focus()}function R(){if(!u(t)||r)return;const L=un.create({doc:u(h),extensions:x.getExtensions()});r=new gt({state:L,parent:u(t)}),r.dom.addEventListener("focusin",()=>S(!0)),r.dom.addEventListener("focusout",()=>{setTimeout(()=>{r&&!r.hasFocus&&S(!1)},10)}),C(),I()}function C(){r&&setTimeout(()=>{if(r){const L=CT(r.dom);ET(L)}},10)}function I(){if(!u(t)){b(l,!1);return}setTimeout(()=>{u(t)&&b(l,u(t).scrollHeight>u(t).clientHeight)},50)}qr(()=>(x.initializeTheme(),()=>{r&&(r.destroy(),r=null),x.destroy(),a&&clearTimeout(a)})),tt(()=>{u(t)&&!r&&!u(d)&&(u(c)?(x.destroy(),x=O(u(c)),x.initializeTheme(),R()):u(f)&&(x.destroy(),x=O(null,_),x.initializeTheme(),R()))}),tt(()=>{x.isDarkMode,r&&(r.dispatch({effects:en.reconfigure.of(x.getExtensions())}),C())}),tt(()=>{u(h),u(i),u(s),!u(i)&&!u(s)&&I()}),tt(()=>{cs(),r&&setTimeout(()=>{r&&jh(r)},50)});function D(){r?.focus()}function Q(){return r?.state.doc.toString()||""}function M(L){if(r){const q=r.state.doc.toString();r.dispatch({changes:{from:0,to:q.length,insert:L}})}}function N(){r&&jh(r)}var B={focus:D,getContent:Q,setContent:M,refreshWikilinks:N},H=gIe();let F;var Z=w(H);let $;qt(Z,L=>b(t,L),()=>u(t));var W=A(Z,2);{var G=L=>{var q=pIe();q.__click=E,q.__keydown=fe=>{(fe.key==="Enter"||fe.key===" ")&&E()};var ue=A(w(q),2);{var oe=fe=>{var be=fIe();be.__click=E,pp(1,be,()=>fk,()=>({y:8,duration:250,delay:100,easing:cD})),pp(2,be,()=>jR,()=>({duration:150})),T(fe,be)};z(ue,fe=>{u(v)&&fe(oe)})}pp(3,q,()=>jR,()=>({duration:200,easing:cD})),T(L,q)};z(W,L=>{u(y)&&L(G)})}return Y(()=>{F=Ue(H,1,"daily-note-editor-wrapper svelte-h9odob",null,F,{focused:u(i)||u(s)}),$=gn(Z,"",$,{"max-height":u(m),overflow:u(i)||u(s)?"visible":"hidden"})}),T(n,H),ct(B)}yt(["click","keydown"]);var vIe=P('<div><div class="day-gutter svelte-18ehvtq"><button type="button"> </button></div> <div class="day-content svelte-18ehvtq"><!></div></div>');function yIe(n,e){lt(e,!0);let t=j(void 0),r=j(void 0);const i=le(()=>Yh(e.dayData.date).toLocaleDateString("en-US",{weekday:"short"}));function s(v){v.shiftKey?e.onDailyNoteTitleClickSidebar?.(e.dayData.date):e.onDailyNoteTitleClick?.(e.dayData.date)}function o(){u(r)?.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{u(t)?.focus()},100)}var a={focus:o},l=vIe();let c;var d=w(l),h=w(d);let f;h.__click=s;var p=w(h),g=A(d,2),m=w(g);return qt(mIe(m,{get date(){return e.dayData.date}}),v=>b(t,v,!0),()=>u(t)),qt(l,v=>b(r,v),()=>u(r)),Y(()=>{c=Ue(l,1,"day-section svelte-18ehvtq",null,c,{"is-today":e.isToday}),f=Ue(h,1,"day-label svelte-18ehvtq",null,f,{"is-today":e.isToday}),Pt(h,"title",`Open ${e.dayHeader??""}`),J(p,u(i))}),T(n,l),ct(a)}yt(["click"]);r9();var bIe=P('<div class="message agent loading-message svelte-32wqrs"><div class="message-content svelte-32wqrs"><div class="loading-dots svelte-32wqrs"><span class="dot svelte-32wqrs"></span> <span class="dot svelte-32wqrs"></span> <span class="dot svelte-32wqrs"></span></div></div></div>');function wIe(n){var e=bIe();T(n,e)}var _Ie=P('<!> <div class="timeline-container svelte-5gju17"><div class="timeline svelte-5gju17"></div></div>',1),OIe=P('<div class="loading-container svelte-5gju17"><!></div>'),xIe=P('<div class="daily-view svelte-5gju17"><!></div>');function kIe(n,e){lt(e,!0);let t=j(Qt(UU().startDate));const r=le(()=>gJ(u(t)));let i=Qt({});function s(m){b(t,m,!0)}async function o(m){const v=await T5(m);v&&(Rs(v.id),El(v.id),e.onNoteSelect?.(v))}function a(m){o(m)}function l(){const m=u(r)?.days.findIndex(v=>lD(v.date));m!==void 0&&m!==-1&&i[m]?.focus()}function c(){const m={startDate:u(t),endDate:u(r).endDate,year:new Date(u(t)).getFullYear()},v=zU(m);b(t,v.startDate,!0)}function d(){const m={startDate:u(t),endDate:u(r).endDate,year:new Date(u(t)).getFullYear()},v=BU(m);b(t,v.startDate,!0)}tt(()=>{function m(){const v=(y=0)=>{u(r)&&u(r).days.length>0?l():y<10&&setTimeout(()=>v(y+1),100)};v()}return document.addEventListener("daily-view-focus-today",m),()=>document.removeEventListener("daily-view-focus-today",m)}),tt(()=>{function m(v){const y=v.target,O=y.tagName==="INPUT"||y.tagName==="TEXTAREA"||y.isContentEditable||y.closest(".cm-editor");if(v.key==="Escape"){O&&(v.preventDefault(),document.activeElement?.blur());return}if(!O){if(v.key==="t"||v.key==="T"){v.preventDefault(),l();return}if(v.key==="["){v.preventDefault(),c();return}if(v.key==="]"){v.preventDefault(),d();return}}}return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)});var h=xIe(),f=w(h);{var p=m=>{var v=_Ie(),y=Ie(v);hIe(y,{get weekData(){return u(r)},onNavigateToWeek:s});var O=A(y,2),_=w(O);Tt(_,23,()=>u(r).days,x=>x.date,(x,k,S)=>{{let E=le(()=>lIe(u(k).date)),R=le(()=>lD(u(k).date));qt(yIe(x,{get dayData(){return u(k)},get dayHeader(){return u(E)},get isToday(){return u(R)},onDailyNoteTitleClick:o,onDailyNoteTitleClickSidebar:a}),(C,I)=>i[I]=C,C=>i?.[C],()=>[u(S)])}}),T(m,v)},g=m=>{var v=OIe(),y=w(v);wIe(y),T(m,v)};z(f,m=>{u(r)?m(p):m(g,!1)})}T(n,h),ct()}var SIe=P('<button aria-label="Open Shelf"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-6l-2 3h-4l-2-3H2"></path><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path></svg></button>'),TIe=P('<button><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg></button>'),AIe=P('<div role="group" aria-label="Action menu"><!> <!></div>');function CIe(n,e){lt(e,!0);let t=et(e,"autoHide",3,!0);const r=le(()=>!t()||po.visible);let i=j(!1),s=null;const o=le(()=>e.chatOpen||e.shelfOpen),a=le(()=>u(i)&&!u(o));let l=j(!1);tt(()=>{u(l)&&!u(o)&&(b(i,!1),s&&(clearTimeout(s),s=null)),b(l,u(o),!0)});function c(){s&&(clearTimeout(s),s=null),b(i,!0),po.onMouseEnter()}function d(){s=setTimeout(()=>{b(i,!1)},150),po.onMouseLeave()}function h(){e.onToggleChat()}function f(){e.onToggleShelf()}qr(()=>{po.init()}),Oo(()=>{s&&clearTimeout(s)});var p=Ve(),g=Ie(p);{var m=v=>{var y=AIe();let O;var _=w(y);ur(_,{text:"Shelf",position:"left",children:(k,S)=>{var E=SIe();let R;E.__click=f,Y(()=>{R=Ue(E,1,"fab-button shelf-button svelte-1kjv589",null,R,{visible:u(a)}),Pt(E,"tabindex",u(a)?0:-1)}),T(k,E)},$$slots:{default:!0}});var x=A(_,2);ur(x,{text:"Agent",position:"left",children:(k,S)=>{var E=TIe();let R;E.__click=function(...C){(u(a)?h:void 0)?.apply(this,C)},Y(()=>{R=Ue(E,1,"fab-main svelte-1kjv589",null,R,{expanded:u(a)}),Pt(E,"aria-label",u(a)?"Open AI Chat":"Open menu")}),T(k,E)},$$slots:{default:!0}}),Y(()=>O=Ue(y,1,"fab-container svelte-1kjv589",null,O,{visible:u(r)})),It("mouseenter",y,c),It("mouseleave",y,d),T(v,y)};z(g,v=>{u(o)||v(m)})}T(n,p),ct()}yt(["click"]);const EIe=new Set(["type-default","type-daily"]);function Yf(n){return EIe.has(n)}const PIe=je({min:St().optional().describe("Minimum value (for numbers) or minimum length (for arrays)"),max:St().optional().describe("Maximum value (for numbers) or maximum length (for arrays)"),pattern:Ce().optional().describe("Regex pattern for string validation"),options:Xt(Ce()).optional().describe("Valid options for select fields"),format:Ce().optional().describe("Date format specification")}),uD=je({name:Ce().describe("Property name (used as key in note.props)"),type:cr(["string","number","boolean","date","array","select","notelink","notelinks"]).describe("Data type of the property"),description:Ce().optional().describe("Human-readable description"),required:Cs().optional().describe("Whether the property is required"),constraints:PIe.optional().describe("Value constraints"),default:Xn([Ce(),St(),Cs(),Xt(Ce())]).optional().describe("Default value when creating a new note")});function dD(){return{list_note_types:{description:"List all available note types in the vault. Returns non-archived types sorted by name. Use this to see what note types exist and their purposes.",inputSchema:je({includeArchived:Cs().optional().default(!1).describe("Include archived note types in the list")}),execute:async({includeArchived:n})=>{try{const t=(n?sJ():yo()).map(r=>({id:r.id,name:r.name,purpose:r.purpose,icon:r.icon,propertyCount:r.properties?.length??0,archived:r.archived,isSystemType:Yf(r.id)}));return{success:!0,noteTypes:t,count:t.length}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list note types"}}}},get_note_type:{description:"Get detailed information about a specific note type, including its property schema. Use this when you need to understand the structure of notes of a specific type.",inputSchema:je({typeId:Ce().describe("The note type ID (format: type-xxxxxxxx)")}),execute:async({typeId:n})=>{try{const e=jr(n);return e?{success:!0,noteType:{id:e.id,name:e.name,purpose:e.purpose,icon:e.icon,archived:e.archived,created:e.created,properties:e.properties??[],editorChips:e.editorChips??[],agentInstructions:e.agentInstructions,isSystemType:Yf(e.id)}}:{success:!1,error:`Note type not found: ${n}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get note type"}}}},create_note_type:{description:"Create a new note type with an optional property schema. Use this to define new categories of notes with custom fields.",inputSchema:je({name:Ce().describe("Display name for the note type"),purpose:Ce().optional().describe("Description of this note type's purpose"),icon:Ce().optional().describe("Emoji icon for the note type (default: document emoji)"),properties:Xt(uD).optional().describe("Property schema defining custom fields for notes of this type"),editorChips:Xt(Ce()).optional().describe("Names of properties to display as chips in the editor"),agentInstructions:Ce().optional().describe("Instructions for AI agents when working with notes of this type")}),execute:async({name:n,purpose:e,icon:t,properties:r,editorChips:i,agentInstructions:s})=>{try{const o=hb({name:n,purpose:e,icon:t,properties:r,editorChips:i});return s&&Qd(o,{agentInstructions:s}),{success:!0,typeId:o,message:`Created note type "${n}" with ID ${o}`}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Failed to create note type"}}}},update_note_type:{description:"Update an existing note type. You can update the name, purpose, icon, properties, or editor chips. Only provide the fields you want to change. Cannot modify system note types.",inputSchema:je({typeId:Ce().describe("The note type ID to update"),name:Ce().optional().describe("New display name"),purpose:Ce().optional().describe("New purpose description"),icon:Ce().optional().describe("New emoji icon"),properties:Xt(uD).optional().describe("New property schema (replaces existing)"),editorChips:Xt(Ce()).optional().describe("New editor chips list (replaces existing)"),agentInstructions:Ce().optional().describe("New instructions for AI agents")}),execute:async({typeId:n,name:e,purpose:t,icon:r,properties:i,editorChips:s,agentInstructions:o})=>{try{const a=jr(n);if(!a)return{success:!1,error:`Note type not found: ${n}`};if(Yf(n)&&e!==void 0)return{success:!1,error:`Cannot change name of system note type: ${a.name}`};const l={},c=[];return e!==void 0&&!Yf(n)&&(l.name=e,c.push("name")),t!==void 0&&(l.purpose=t,c.push("purpose")),r!==void 0&&(l.icon=r,c.push("icon")),i!==void 0&&(l.properties=i,c.push("properties")),s!==void 0&&(l.editorChips=s,c.push("editorChips")),o!==void 0&&(l.agentInstructions=o,c.push("agentInstructions")),c.length===0?{success:!1,error:"No updates provided"}:(Qd(n,l),{success:!0,message:`Updated note type "${a.name}"`,updatedFields:c})}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to update note type"}}}},archive_note_type:{description:"Archive a note type (soft delete). The type will no longer appear in lists, but notes keep their type assignment. Cannot archive system note types.",inputSchema:je({typeId:Ce().describe("The note type ID to archive")}),execute:async({typeId:n})=>{try{const e=jr(n);return e?Yf(n)?{success:!1,error:`Cannot archive system note type: ${e.name}`}:e.archived?{success:!1,error:`Note type "${e.name}" is already archived`}:(b5(n),{success:!0,message:`Archived note type "${e.name}"`}):{success:!1,error:`Note type not found: ${n}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to archive note type"}}}},unarchive_note_type:{description:"Restore an archived note type. The type will appear in lists again.",inputSchema:je({typeId:Ce().describe("The note type ID to unarchive")}),execute:async({typeId:n})=>{try{const e=jr(n);return e?e.archived?(oJ(n),{success:!0,message:`Restored note type "${e.name}"`}):{success:!1,error:`Note type "${e.name}" is not archived`}:{success:!1,error:`Note type not found: ${n}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to unarchive note type"}}}}}}const ua={LIST_HARD_MAX:50,LIST_DEFAULT:20,QUERY_RESULT_MAX:100,QUERY_RESULT_DEFAULT:25},IIe=new Set(["type","type_id","title","created","updated","archived"]);function hD(n,e){const t=[],r=n.find(a=>a.field==="type"),i=[],s=new Set,o=Object.values(e).filter(a=>!a.archived);if(r){const a=Array.isArray(r.value)?r.value:[r.value],l=[],c=[];for(const d of a){const h=o.find(f=>f.name.toLowerCase()===d.toLowerCase());h?(l.push(h),i.push(h.name)):c.push(d)}if(c.length>0){const d=o.map(h=>h.name).join(", ");return t.push(`Type${c.length>1?"s":""} not found: ${c.join(", ")}. Available types: ${d}`),{valid:!1,errors:t}}for(const d of l)for(const h of d.properties??[])s.add(h.name)}else for(const a of o)for(const l of a.properties??[])s.add(l.name);for(const a of n){if(IIe.has(a.field))continue;if(!a.field.startsWith("props.")){const c=Array.from(s).sort().map(d=>`props.${d}`).join(", ")||"(none)";t.push(`Unknown field "${a.field}". Custom properties must use props.* format (e.g., props.${a.field}). Available: ${c}`);continue}const l=a.field.slice(6);if(!s.has(l)){const c=Array.from(s).sort().map(d=>`props.${d}`).join(", ")||"(none)";i.length>0?t.push(`Unknown property "${l}" for type${i.length>1?"s":""} ${i.join(", ")}. Available: ${c}`):t.push(`Unknown property "${l}". No note type defines this property. Use get_note_type to check available properties.`)}}return{valid:t.length===0,errors:t}}function jU(n,e){const t=Wp(e);return{id:n.id,title:n.title,viewCount:e.views?.length??1,activeViewName:t.name,pageSize:e.pageSize??25,created:n.created,updated:n.updated}}function MIe(n,e){const t=jU(n,e),r=e.views?.map(i=>({name:i.name,filterCount:i.filters.length,filters:i.filters.map(s=>({field:s.field,operator:s.operator??"=",value:s.value})),columns:i.columns?.map(s=>typeof s=="string"?s:s.field),sort:i.sort?{field:i.sort.field,order:i.sort.order}:void 0}))??[];return{...t,views:r}}const RIe=je({field:Ce().describe('Field to filter on. System fields: type (matches by type NAME like "Movies"), title, created, updated, archived. Custom properties: use props.* format (e.g., props.status, props.priority).'),operator:cr(["=","!=",">","<",">=","<=","LIKE","IN","NOT IN","BETWEEN"]).optional().default("=").describe("Comparison operator (default: =)"),value:Xn([Ce(),Xt(Ce())]).describe('Value to compare. For type field, use type NAME (e.g., "Movies"), not type ID. Use array for IN/NOT IN/BETWEEN operators.')}),DIe=je({field:Ce().describe("Field to sort by"),order:cr(["asc","desc"]).default("desc").describe("Sort order")}),fD=je({name:Ce().min(1).describe("View name"),filters:Xt(RIe).describe("Filters for this view"),columns:Xt(Ce()).optional().describe("Columns to display (field names)"),sort:DIe.optional().describe("Sort configuration")});function pD(){return{list_decks:{description:"List all deck notes in the vault. Decks are saved filtered views of notes. Returns deck metadata including title, view count, and active view name.",inputSchema:je({limit:St().optional().default(ua.LIST_DEFAULT).describe(`Max decks to return (default: ${ua.LIST_DEFAULT}, max: ${ua.LIST_HARD_MAX})`)}),execute:async({limit:n})=>{try{const e=Math.min(n??ua.LIST_DEFAULT,ua.LIST_HARD_MAX),t=EJ(),i=t.slice(0,e).map(s=>{const o=$d(s.id);return o?jU(s,o):{id:s.id,title:s.title,viewCount:0,activeViewName:"Invalid",pageSize:25,created:s.created,updated:s.updated,error:"No deck configuration found"}});return{success:!0,decks:i,count:i.length,totalDecks:t.length}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list decks"}}}},get_deck:{description:"Get full details of a specific deck by ID. Returns the deck configuration including all views, filters, columns, and sort settings.",inputSchema:je({deckId:Ce().describe("The deck note ID")}),execute:async({deckId:n})=>{try{const e=Zn(n);if(!e)return{success:!1,error:`Deck not found: ${n}`};const t=$d(n);return t?{success:!0,deck:MIe(e,t)}:{success:!1,error:"No deck configuration found"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get deck"}}}},create_deck:{description:"Create a new deck (filtered note view). Decks allow users to create saved queries with filters, columns, and sort settings. Supports multiple views per deck.",inputSchema:je({title:Ce().min(1).describe("Deck title"),views:Xt(fD).optional().describe("Optional views configuration. If not provided, creates a default empty view."),pageSize:St().optional().describe("Number of results per page (default: 25, options: 10, 25, 50, 100)")}),execute:async({title:n,views:e,pageSize:t})=>{try{const r=kS();if(e&&e.length>0&&(r.views=e.map(s=>({name:s.name,filters:s.filters.map(o=>({field:o.field,operator:o.operator,value:o.value})),columns:s.columns,sort:s.sort?{field:s.sort.field,order:s.sort.order}:void 0})),r.activeView=0),t&&(r.pageSize=t),e&&e.length>0){const s=iu();for(const o of e){const a=hD(o.filters,s);if(!a.valid)return{success:!1,error:`Invalid filters in view "${o.name}": ${a.errors.join("; ")}`}}}const i=N5(n,r);return{success:!0,deckId:i,message:`Created deck "${n}" with ID ${i}`}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to create deck"}}}},update_deck:{description:"Update an existing deck. You can update the title, views, or page size. When updating views, the entire views array is replaced.",inputSchema:je({deckId:Ce().describe("The deck note ID to update"),title:Ce().optional().describe("New title (if updating)"),views:Xt(fD).optional().describe("New views configuration (replaces all existing views)"),activeView:St().optional().describe("Index of the active view"),pageSize:St().optional().describe("New page size (options: 10, 25, 50, 100)")}),execute:async({deckId:n,title:e,views:t,activeView:r,pageSize:i})=>{try{if(!Zn(n))return{success:!1,error:`Deck not found: ${n}`};const o=[];if(e!==void 0&&(dl(n,{title:e}),o.push("title")),t!==void 0||r!==void 0||i!==void 0){const a=$d(n);if(!a)return{success:!1,error:"No deck configuration found"};if(t!==void 0){const l=iu();for(const c of t){const d=hD(c.filters,l);if(!d.valid)return{success:!1,error:`Invalid filters in view "${c.name}": ${d.errors.join("; ")}`}}a.views=t.map(c=>({name:c.name,filters:c.filters.map(d=>({field:d.field,operator:d.operator,value:d.value})),columns:c.columns,sort:c.sort?{field:c.sort.field,order:c.sort.order}:void 0})),o.push("views")}r!==void 0&&(a.activeView=Math.max(0,Math.min(r,(a.views?.length??1)-1)),o.push("activeView")),i!==void 0&&(a.pageSize=i,o.push("pageSize")),ES(n,a)}return o.length===0?{success:!1,error:"No updates provided"}:{success:!0,message:`Updated deck ${n}`,updatedFields:o}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to update deck"}}}},archive_deck:{description:"Archive a deck (soft delete). The deck can be recovered later. Use this when the user wants to delete or remove a deck.",inputSchema:je({deckId:Ce().describe("The deck note ID to archive")}),execute:async({deckId:n})=>{try{const e=Zn(n);return e?(Ch(n),{success:!0,message:`Archived deck "${e.title||n}"`}):{success:!1,error:`Deck not found: ${n}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to archive deck"}}}},run_deck_query:{description:"Execute a deck's query and return matching notes. This runs the deck's active view filters against all notes and returns the results. Useful for previewing what notes match a deck configuration.",inputSchema:je({deckId:Ce().describe("The deck note ID to run"),viewIndex:St().optional().describe("View index to run (default: active view)"),offset:St().optional().default(0).describe("Offset for pagination (default: 0)"),limit:St().optional().default(ua.QUERY_RESULT_DEFAULT).describe(`Max results to return (default: ${ua.QUERY_RESULT_DEFAULT}, max: ${ua.QUERY_RESULT_MAX})`),includeArchived:Cs().optional().default(!1).describe("Include archived notes in results")}),execute:async({deckId:n,viewIndex:e,offset:t,limit:r,includeArchived:i})=>{try{const s=Zn(n);if(!s)return{success:!1,error:`Deck not found: ${n}`};const o=$d(n);if(!o)return{success:!1,error:"No deck configuration found"};const a={...o};e!==void 0&&a.views&&(a.activeView=Math.max(0,Math.min(e,a.views.length-1)));const l=Math.min(r??ua.QUERY_RESULT_DEFAULT,ua.QUERY_RESULT_MAX);a.pageSize=l;const c=cs(),d=iu(),h=Jz(a,c,d,{offset:t??0,includeArchived:i??!1}),f=Wp(a);return{success:!0,deckTitle:s.title,viewName:f.name,notes:h.notes.map(p=>({id:p.id,title:p.title,type:p.typeName,created:p.created,updated:p.updated,props:p.props})),count:h.notes.length,total:h.total,hasMore:h.hasMore,pagination:{offset:t??0,limit:l,nextOffset:h.hasMore?(t??0)+l:void 0}}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to run deck query"}}}}}}const mh={CHUNK_DEFAULT:1e4,CHUNK_MAX:5e4};function uc(n){return Math.ceil(n.length/3.5)}function I_(n,e){const t=uc(n);if(t<=e)return{text:n,truncated:!1,originalTokens:t};const r=e*3.5;let i=Math.floor(r);for(;i>0&&n[i]!==" ";)i--;return i===0&&(i=Math.floor(r)),{text:n.slice(0,i)+`

[Content truncated]`,truncated:!0,originalTokens:t}}function cy(n){const e=new Set(["p","div","h1","h2","h3","h4","h5","h6","li","blockquote","pre","article","section","header","footer","aside","main","nav"]),t=[];function r(i){if(i.nodeType===Node.TEXT_NODE){const s=i.textContent?.trim();s&&t.push(s)}else if(i.nodeType===Node.ELEMENT_NODE){const s=i,o=s.tagName.toLowerCase();if(o==="script"||o==="style")return;const a=e.has(o);a&&t.length>0&&t.push(`

`);for(const l of s.childNodes)r(l);a&&t.length>0&&!t[t.length-1].endsWith(`
`)&&t.push(`
`)}}return r(n),t.join("").replace(/\n{3,}/g,`

`).trim()}function zT(n){const t=new DOMParser().parseFromString(n,"text/html");return cy(t.body)}function BT(n){const r=new DOMParser().parseFromString(n,"text/html").body,i=[],s=["h1","h2","h3","h4","h5","h6"],o=r.querySelectorAll(s.join(", "));if(o.length===0){const d=cy(r);return[{index:0,heading:"Content",level:0,text:d,estimatedTokens:uc(d)}]}let a=r.firstChild,l="";const c=o[0];for(;a&&a!==c;){if(a.nodeType===Node.ELEMENT_NODE){const d=a;s.includes(d.tagName.toLowerCase())||(l+=cy(d)+`

`)}else if(a.nodeType===Node.TEXT_NODE){const d=a.textContent?.trim();d&&(l+=d+`

`)}a=a.nextSibling}l.trim()&&i.push({index:0,heading:"Introduction",level:0,text:l.trim(),estimatedTokens:uc(l)});for(let d=0;d<o.length;d++){const h=o[d],f=h.textContent?.trim()||`Section ${d+1}`,p=parseInt(h.tagName.substring(1),10);let g="",m=h.nextSibling;for(;m;){if(m.nodeType===Node.ELEMENT_NODE){const v=m;if(s.includes(v.tagName.toLowerCase()))break;g+=cy(v)+`

`}else if(m.nodeType===Node.TEXT_NODE){const v=m.textContent?.trim();v&&(g+=v+`

`)}m=m.nextSibling}i.push({index:i.length,heading:f,level:p,text:g.trim(),estimatedTokens:uc(g)})}return i}async function UT(n){const e=Zn(n);if(!e)return null;const t=e.props;if(!t?.webpageHash)return null;const r=await X5(t.webpageHash);return r?{htmlContent:r,props:t,title:e.title}:null}async function NIe(n){try{const e=await UT(n);if(!e)return{success:!1,title:"",url:"",totalEstimatedTokens:0,hasSections:!1,error:"Webpage not found or not accessible"};const{htmlContent:t,props:r,title:i}=e,s=zT(t),o=uc(s),a=BT(t),l=a.length>1;return{success:!0,title:r.webpageTitle||i,url:r.webpageUrl,siteName:r.webpageSiteName,author:r.webpageAuthor,excerpt:r.webpageExcerpt,archivedAt:r.archivedAt,totalEstimatedTokens:o,hasSections:l,sectionCount:l?a.length:void 0,sections:l?a.map(c=>({index:c.index,heading:c.heading,estimatedTokens:c.estimatedTokens})):void 0}}catch(e){return{success:!1,title:"",url:"",totalEstimatedTokens:0,hasSections:!1,error:e instanceof Error?e.message:"Failed to get webpage info"}}}async function LIe(n,e,t,r,i=mh.CHUNK_DEFAULT){i=Math.min(i,mh.CHUNK_MAX);try{const s=await UT(n);if(!s)return{success:!1,chunkRef:{type:"full"},text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:"Webpage not found or not accessible"};const{htmlContent:o}=s,a=zT(o);if(e==="full"){const{text:l,truncated:c,originalTokens:d}=I_(a,i);return{success:!0,chunkRef:{type:"full"},text:l,tokenCount:c?i:uc(l),truncated:c,position:{current:"Full page",total:`~${d} tokens`}}}if(e==="section"){if(t===void 0)return{success:!1,chunkRef:{type:"section",index:0},text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:"sectionIndex is required for section type"};const l=BT(o);if(t>=l.length)return{success:!1,chunkRef:{type:"section",index:t},text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:`Section index ${t} not found (only ${l.length} sections available)`};const c=l[t],{text:d,truncated:h}=I_(c.text,i);return{success:!0,chunkRef:{type:"section",index:t},text:d,tokenCount:h?i:uc(d),truncated:h,nextChunkRef:t<l.length-1?{type:"section",index:t+1}:void 0,position:{current:c.heading||`Section ${t+1}`,total:`${l.length} sections`}}}if(e==="token_chunk"){if(r===void 0)return{success:!1,chunkRef:{type:"token_chunk",index:0},text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:"chunkIndex is required for token_chunk type"};const l=mh.CHUNK_DEFAULT*3.5,c=Math.ceil(a.length/l);if(r>=c)return{success:!1,chunkRef:{type:"token_chunk",index:r},text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:`Chunk index ${r} not found (only ${c} chunks available)`};const d=r*l,h=d+l,f=a.slice(d,h),{text:p,truncated:g}=I_(f,i);return{success:!0,chunkRef:{type:"token_chunk",index:r},text:p,tokenCount:g?i:uc(p),truncated:g,nextChunkRef:r<c-1?{type:"token_chunk",index:r+1}:void 0,position:{current:`Chunk ${r+1}`,total:`${c} chunks`}}}return{success:!1,chunkRef:{type:"full"},text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:"Unsupported chunk type"}}catch(s){return{success:!1,chunkRef:{type:"full"},text:"",tokenCount:0,truncated:!1,position:{current:"",total:""},error:s instanceof Error?s.message:"Failed to get webpage content"}}}async function QIe(n,e,t=10){t=Math.min(t,50);try{const r=await UT(n);if(!r)return{success:!1,results:[],totalMatches:0,error:"Webpage not found or not accessible"};const{htmlContent:i}=r,s=zT(i),o=s.toLowerCase(),a=e.toLowerCase();let l=0,c=0;for(;(c=o.indexOf(a,c))!==-1;)l++,c+=a.length;if(l===0)return{success:!0,results:[],totalMatches:0};const d=[],h=BT(i),f=h.length>1,p=[];if(f){let g=0;for(const m of h)p.push(g),g+=m.text.length+2}for(c=0;(c=o.indexOf(a,c))!==-1&&d.length<t;){const g=Math.max(0,c-100),m=Math.min(s.length,c+e.length+100),v=(g>0?"...":"")+s.slice(g,m)+(m<s.length?"...":"");let y,O;if(f){for(let _=p.length-1;_>=0;_--)if(c>=p[_]){y=_,O=h[_].heading;break}}d.push({snippet:v,matchCount:1,sectionIndex:y,sectionHeading:O}),c+=e.length}return{success:!0,results:d,totalMatches:l}}catch(r){return{success:!1,results:[],totalMatches:0,error:r instanceof Error?r.message:"Failed to search webpage"}}}function gD(){return{get_webpage_info:{description:"Get information about an archived webpage including metadata (title, author, site, URL) and content token estimate. Use this first to understand the webpage before reading its content.",inputSchema:je({noteId:Ce().describe("The note ID of the archived webpage (format: n-xxxxxxxx)")}),execute:async({noteId:n})=>await NIe(n)},get_webpage_content:{description:"Get text content from an archived webpage. Can retrieve full content or specific sections if the page has headings. Use get_webpage_info first to see content size and whether sections are available.",inputSchema:je({noteId:Ce().describe("The note ID of the archived webpage"),chunkType:cr(["full","section","token_chunk"]).describe('Type of content to retrieve: "full" for entire page, "section" for a specific section (by index), "token_chunk" for token-based chunking of large content'),sectionIndex:St().optional().describe('Section index to retrieve (required for "section" type, 0-indexed)'),chunkIndex:St().optional().describe('Chunk index for token-based chunking (required for "token_chunk" type, 0-indexed)'),maxTokens:St().optional().default(mh.CHUNK_DEFAULT).describe(`Maximum tokens to return (default: ${mh.CHUNK_DEFAULT}, max: ${mh.CHUNK_MAX})`)}),execute:async({noteId:n,chunkType:e,sectionIndex:t,chunkIndex:r,maxTokens:i})=>await LIe(n,e,t,r,i)},search_webpage_text:{description:"Search for specific text within an archived webpage. Returns snippets showing where the text was found. Useful for finding specific topics, quotes, or references.",inputSchema:je({noteId:Ce().describe("The note ID of the archived webpage"),query:Ce().describe("The text to search for"),maxResults:St().optional().default(10).describe("Maximum number of results to return (default: 10, max: 50)")}),execute:async({noteId:n,query:e,maxResults:t})=>await QIe(n,e,t)}}}let V0=j(Qt(typeof navigator<"u"?navigator.onLine:!0)),mD=j(Qt(new Date)),uy=j(!1),Bc=null;function VU(){if(typeof window>"u")return;const n=()=>{b(V0,!0),b(mD,new Date,!0),b(uy,!0),Bc&&clearTimeout(Bc),Bc=setTimeout(()=>{b(uy,!1),Bc=null},2e3)},e=()=>{b(V0,!1),b(mD,new Date,!0),b(uy,!1),Bc&&(clearTimeout(Bc),Bc=null)};window.addEventListener("online",n),window.addEventListener("offline",e)}function qU(){return u(V0)}function HU(){return u(uy)}function Sk(n){const e=n.message.toLowerCase(),t=n.name.toLowerCase();return u(V0)?t==="aborterror"||e.includes("timeout")||e.includes("timed out")||e.includes("aborted")?"timeout":e.includes("econnrefused")||e.includes("connection refused")||e.includes("failed to fetch")||e.includes("network request failed")?"connection_refused":e.includes("enotfound")||e.includes("getaddrinfo")||e.includes("dns")?"dns_error":e.includes("network")||e.includes("econnreset")||e.includes("socket")||e.includes("epipe")||t==="typeerror"?"network_error":"unknown":"offline"}function vD(n){return Sk(n)!=="unknown"}function yD(n){switch(n){case"offline":return"You appear to be offline. Please check your internet connection.";case"timeout":return"The request timed out. The server may be slow or unreachable.";case"connection_refused":return"Could not connect to the server. Please try again.";case"dns_error":return"Could not resolve the server address. Please check your connection.";case"network_error":return"A network error occurred. Please check your connection and try again.";default:return"An unexpected error occurred. Please try again."}}class bD extends Error{errorType;isRetryable;originalError;constructor(e,t,r){super(e),this.name="NetworkError",this.errorType=t,this.originalError=r,this.isRetryable=t!=="unknown"}}const Tk=30;function $Ie(){return document.documentElement.hasAttribute("data-screenshot-mode")}const FIe=[{pattern:/connection.*creativity.*flow|creativity.*flow/i,response:`Your notes connect creativity and flow in two ways:

**Direct link**: [[The Science of Creativity]] positions flow as central to creative workâboth need clear goals and challenge-skill balance. The key insight: creativity *precedes* flow (finding the problem), while flow emerges *during* execution.

**Via constraints**: [[Connection between constraints and creativity]] argues constraints enable flow by creating clear challenges and reducing decision fatigue. Your [[Flow States]] research supports this with the challenge-skill balance diagram.`,toolCalls:[{name:"search_notes",args:{query:"creativity flow"}},{name:"get_note",args:{id:"n-science-creativity"}},{name:"get_note",args:{id:"n-constraints-creativity"}},{name:"get_note",args:{id:"n-flow-states"}},{name:"search_notes",args:{query:"challenge skill balance"}},{name:"get_backlinks",args:{noteId:"n-flow-states"}},{name:"search_notes",args:{query:"constraints creativity"}}]},{pattern:/hello|hi|hey/i,response:"Hello! I'm your AI assistant for Flint. I can help you organize your notes, find information, create new content, and much more. What would you like to work on today?"},{pattern:/help|what can you do/i,response:`I can help you with many things in Flint:

- **Search & Find**: Search through your notes to find specific information
- **Create Notes**: Help you draft and organize new notes
- **Organize**: Suggest ways to connect and structure your knowledge
- **Summarize**: Create summaries of your notes or documents
- **Answer Questions**: Use your notes as context to answer questions

Just ask me anything about your notes or what you'd like to create!`},{pattern:/search|find|look for/i,response:"I'd be happy to search through your notes. I found several relevant notes that might help. Would you like me to show you more details about any of them?"},{pattern:/create|new note|write/i,response:"I can help you create a new note. What would you like the note to be about? I can help structure it, suggest a title, or just capture your thoughts as you share them."},{pattern:/summarize|summary/i,response:"I can create a summary for you. Based on the content, here are the key points I identified. Would you like me to expand on any of these or save this as a new note?"}];function zIe(n){for(const{pattern:e,response:t,toolCalls:r}of FIe)if(e.test(n))return{response:t,toolCalls:r};return{response:"I understand you're asking about that. Let me help you explore this topic further. Would you like me to search your notes for related information, or would you prefer to create a new note to capture your thoughts?"}}const BIe=`You are an AI assistant for Flint, an intelligent note-taking system designed for natural conversation-based knowledge management. Help users capture, organize, and discover knowledge through intuitive conversation. Be proactive, direct, and substantive.

## Note Operations

When users ask about their notes:
- Use search_notes to find relevant notes - returns context snippets around matches, not full content
- Use get_note to read the full content of a specific note by ID (use this after search_notes if you need complete context)
- Use list_notes to see recent notes with content previews, optionally filtered by type
- Use get_backlinks to find notes that link to a specific note

**Search workflow:** search_notes returns snippets showing where query matches occur. If you need the full note content to answer a question or make edits, follow up with get_note using the note ID from search results.

When users want to modify notes:
- Use create_note to make new notes
- Use update_note to change existing notes (title, content, or properties)
- Use change_note_type to convert a note to a different type
- Use archive_note to remove notes (soft delete, can be recovered)
- Before creating a note of a specific type, use get_note_type to understand the type's properties and purpose

## Note Type Operations

- Use list_note_types to see all available note types with their purposes
- Use get_note_type to get detailed info about a type including its property schema
- Use create_note_type, update_note_type, archive_note_type to manage custom types
- System types (default, daily, epub, pdf, webpage, deck) cannot be modified or archived

## Document Tools (EPUB/PDF)

**Important: Documents can be very large (books can exceed 200k tokens). Always follow this pattern:**

1. **Get structure first** - Call get_document_structure (EPUB) or get_pdf_structure (PDF) to see the table of contents/outline
2. **Request specific chunks** - Use get_document_chunk or get_pdf_chunk with specific chapter/page references
3. **Search when needed** - Use search_document_text or search_pdf_text to find specific passages without loading everything

EPUB chunk references:
- \`{ type: "chapter", index: N }\` - Get a specific chapter by index
- \`{ type: "token_chunk", index: N }\` - For flat books without chapters

PDF chunk references:
- \`{ type: "page", pageNumber: N }\` - Get a specific page
- \`{ type: "pages", start: N, end: M }\` - Get a range of pages

EPUB/PDF notes can be found using list_notes or search_notes with type "type-epub" or "type-pdf".

## Routine Operations

Routines are persistent tasks with instructions that survive across conversations.

- Use list_routines to see available routines, filter by status or type
- Use get_routine to read full details including instructions and materials
- Use create_routine to make new routines with optional recurring schedules
- Use update_routine to modify existing routines
- Use complete_routine to mark as completed (records completion history)
- Use add_routine_material / remove_routine_material to manage supplementary materials
- Use delete_routine to archive a routine

Routine types:
- "routine" - Recurring scheduled tasks (weekly reviews, daily standups)
- "backlog" - One-off tasks for later

**Backlog pattern:** When you discover issues during other work (broken links, inconsistencies, cleanup opportunities), silently create a backlog routine to track it. Do NOT interrupt the user - continue with your primary task and let them review backlog items later.

## Deck Operations

Decks are saved filtered views of notes - like database queries that users can revisit. Use decks to help users organize and browse their notes by specific criteria.

- Use list_decks to see all saved decks
- Use get_deck to view a deck's full configuration (views, filters, columns, sort)
- Use create_deck to make new decks with custom filters
- Use update_deck to modify deck configuration
- Use archive_deck to remove a deck
- Use run_deck_query to execute a deck's query and preview matching notes

**Deck concepts:**
- **Views**: Each deck can have multiple named views (like tabs), each with its own filters
- **Filters**: Conditions that notes must match. System fields for filtering:
  - \`type\` - matches by type NAME (e.g., "Movies", "Meeting Notes")
  - \`title\` - note title
  - \`created\` - creation date (ISO format)
  - \`updated\` - last updated date (ISO format)
  - \`archived\` - archived status (boolean)
  - Custom properties: use \`props.\` prefix (e.g., "props.status", "props.priority")
- **Operators**: =, !=, >, <, >=, <=, LIKE (pattern match), IN, NOT IN, BETWEEN
- **Columns**: Which fields to display (title, type, created, updated, or props.* for custom properties)
- **Sort**: Field and order (asc/desc) for result ordering (e.g., "updated", "title", "props.priority")

**When to create decks:**
- User wants to track notes matching certain criteria (e.g., "all meeting notes from this month")
- User needs a reusable query they'll check regularly
- User wants to organize notes by custom properties (e.g., "tasks by priority")

**Example deck creation:**
\`\`\`
create_deck({
  title: "Recent Project Notes",
  views: [{
    name: "This Week",
    filters: [
      { field: "type", value: "Project" },
      { field: "updated", operator: ">=", value: "2024-01-01" }
    ],
    sort: { field: "updated", order: "desc" }
  }]
})
\`\`\`

**Before creating decks with property filters:**
- Use \`get_note_type\` to check what properties are available for the target type
- Filter field names must exactly match property names defined on the note type
- System fields (type, title, created, updated, archived) are always available
- If filtering by multiple types, ensure the property exists on ALL filtered types

## Communication Style

**Wikilink format:** Always use ID-only format when referencing notes:
- Correct: \`[[n-xxxxxxxx]]\` - The UI automatically displays the current note title
- Do NOT use display text like \`[[n-xxxxxxxx|Title]]\` - it's redundant and can become stale

Example: "I found your note [[n-abc12345]] which discusses the meeting agenda."

**Be direct and substantive:**
- Focus on ideas and connections rather than praising the user
- Make genuine connections without overstating their significance
- Offer constructive engagement without artificial enthusiasm

**Confirm before changes:** Always confirm before creating, updating, or archiving notes.`;function wD(){const n=JJ();return`${BIe}

${n}`}function _D(){const n=new Date,e=Intl.DateTimeFormat().resolvedOptions().timeZone,t=n.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),r=n.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`Current date and time: ${t}, ${r} (${e})`}class UIe{proxyUrl;#e=j(Qt([]));get _messages(){return u(this.#e)}set _messages(e){b(this.#e,e,!0)}#t=j("ready");get _status(){return u(this.#t)}set _status(e){b(this.#t,e,!0)}#r=j(null);get _error(){return u(this.#r)}set _error(e){b(this.#r,e,!0)}#n=j(null);get _conversationId(){return u(this.#n)}set _conversationId(e){b(this.#n,e,!0)}abortController=null;currentAssistantMessageId=null;currentStepText="";pendingStepText="";currentStepHasToolCalls=!1;#s=j(!1);get _stoppedAtLimit(){return u(this.#s)}set _stoppedAtLimit(e){b(this.#s,e,!0)}#i=j(!1);get _isNetworkError(){return u(this.#i)}set _isNetworkError(e){b(this.#i,e,!0)}_lastRequestParams=null;constructor(e){this.proxyUrl=`http://127.0.0.1:${e}/api/chat/proxy`}get messages(){return this._messages}get status(){return this._status}get error(){return this._error}get isLoading(){return this._status==="submitting"||this._status==="streaming"}get conversationId(){return this._conversationId}get stoppedAtLimit(){return this._stoppedAtLimit}get hasNetworkError(){return this._isNetworkError}get canRetry(){return(this._status==="error"||this._status==="network_error")&&this._lastRequestParams!==null}async loadConversation(e){const t=await mJ(e);t&&(this._conversationId=e,this._messages=t.messages.map(r=>({id:r.id,role:r.role,content:String(r.content??""),toolCalls:r.toolCalls,createdAt:new Date(r.createdAt)})))}async startNewConversation(){this.clearMessages();const e=await Lw({addToRecent:!1});return this._conversationId=e,e}async sendMessage(e,t){if(!e.trim()||this.isLoading)return;if($Ie()){await this.sendMockMessage(e.trim());return}this._lastRequestParams={text:e.trim(),model:t,type:"send"},this._error=null,this._isNetworkError=!1,this._stoppedAtLimit=!1,this._conversationId||(this._conversationId=await Lw({addToRecent:!1}));const i={id:await yf(this._conversationId,{role:"user",content:e.trim()}),role:"user",content:e.trim(),createdAt:new Date};this._messages=[...this._messages,i];const s=await yf(this._conversationId,{role:"assistant",content:"",toolCalls:[]});this.currentAssistantMessageId=s,this.currentStepText="",this.pendingStepText="",this.currentStepHasToolCalls=!1;const o={id:s,role:"assistant",content:"",toolCalls:[],createdAt:new Date,toolActivity:{isActive:!0}};this._messages=[...this._messages,o],this._status="submitting";try{this.abortController=new AbortController;const a=[{role:"system",content:_D()}];for(const f of this._messages)if(!(f.role==="assistant"&&!f.content&&!f.toolCalls?.length))if(f.role==="user")a.push({role:"user",content:f.content});else if(f.role==="assistant"){const p=[];if(f.content&&p.push({type:"text",text:f.content}),f.toolCalls)for(const m of f.toolCalls)p.push({type:"tool-call",toolCallId:m.id,toolName:m.name,input:m.args});a.push({role:"assistant",content:p.length>0?p:f.content});const g=f.toolCalls?.filter(m=>m.result!==void 0)??[];g.length>0&&a.push({role:"tool",content:g.map(m=>({type:"tool-result",toolCallId:m.id,toolName:m.name,output:typeof m.result=="string"?{type:"text",value:m.result}:{type:"json",value:m.result}}))})}else a.push({role:"system",content:f.content});const l={...AR(),...dD(),...CR(),...ER(),...IR(),...pD(),...gD()},c=Dg({baseURL:this.proxyUrl,apiKey:"proxy-handled"}),d=C0({model:c(t||Xh),system:wD(),messages:a,tools:l,stopWhen:rk(Tk),abortSignal:this.abortController.signal});this._status="streaming";for await(const f of d.fullStream)switch(f.type){case"start-step":this.currentStepText="",this.pendingStepText="",this.currentStepHasToolCalls=!1,this.updateLastAssistantMessage(p=>{p.toolActivity={isActive:!0}});break;case"text-delta":this.currentStepText+=f.text,this.pendingStepText+=f.text;break;case"tool-call":{this.currentStepHasToolCalls=!0;const p=f,g=p.invalid===!0;let m;if(g&&p.error){const v=p.error.cause?.cause?.message;if(v)try{const y=JSON.parse(v);Array.isArray(y)&&y.length>0&&(m=y.map(O=>`${O.path?.join(".")||"input"}: ${O.message||"invalid"}`).join("; "))}catch{m=v}m||(m=p.error.name||"Tool input validation failed")}this.updateLastAssistantMessage(v=>{v.toolCalls||(v.toolCalls=[]),v.toolCalls.push({id:f.toolCallId,name:f.toolName,args:f.input,status:g?"error":"running",commentary:this.pendingStepText.trim()||void 0,error:m}),v.toolActivity={isActive:!0,currentStep:f.toolName}}),this.pendingStepText="",this.currentStepText="";break}case"tool-result":this.updateLastAssistantMessage(p=>{const g=p.toolCalls?.find(m=>m.id===f.toolCallId);if(g){const m=Qs(f.output);g.result=m;let v=!1,y;if(typeof m=="string"){const O=m.toLowerCase();(O.includes("error")||O.includes("invalid")||O.includes("failed"))&&(v=!0,y=m)}else if(m&&typeof m=="object"){const O=m;O.success===!1&&typeof O.error=="string"?(v=!0,y=O.error):O.isError===!0?(v=!0,y=typeof O.error=="string"?O.error:typeof O.message=="string"?O.message:"Tool execution failed"):typeof O.error=="string"&&O.success===void 0&&(v=!0,y=O.error)}v?(g.status="error",g.error=y):g.status="completed"}});break;case"finish-step":!this.currentStepHasToolCalls&&this.pendingStepText.trim()&&this.updateLastAssistantMessage(p=>{p.content+=this.pendingStepText}),this.pendingStepText="";break;case"error":throw f.error}this.updateLastAssistantMessage(f=>{if(f.toolActivity={isActive:!1},f.toolCalls)for(const p of f.toolCalls)p.status==="running"&&(p.status="error",p.error="Tool did not return a result")}),await d.finishReason==="tool-calls"?(this._stoppedAtLimit=!0,this._status="awaiting_continue"):this._status="ready"}catch(a){if(a instanceof Error&&a.name==="AbortError"){this._status="ready",this.updateLastAssistantMessage(d=>{d.toolActivity={isActive:!1}});return}const l=a instanceof Error&&vD(a);if(this._isNetworkError=l,l){const d=Sk(a),h=yD(d);this._error=new bD(h,d,a),this._status="network_error"}else this._error=a instanceof Error?a:new Error("Unknown error"),this._status="error";const c=this._error.message;this.updateLastAssistantMessage(d=>{if(d.toolActivity={isActive:!1},d.toolCalls)for(const h of d.toolCalls)h.status==="running"&&(h.status="error",h.error=c);d.content||(d.content=l?"Connection error. Please check your internet and try again.":"Sorry, an error occurred while processing your request.")})}finally{this.abortController=null}}cancel(){this.abortController&&(this.abortController.abort(),this.abortController=null)}async continueConversation(e){if(this._status!=="awaiting_continue"||!this._conversationId)return;this._lastRequestParams={text:"",model:e,type:"continue"},this._stoppedAtLimit=!1,this._error=null,this._isNetworkError=!1;const t=await yf(this._conversationId,{role:"assistant",content:"",toolCalls:[]});this.currentAssistantMessageId=t,this.currentStepText="",this.pendingStepText="",this.currentStepHasToolCalls=!1;const r={id:t,role:"assistant",content:"",toolCalls:[],createdAt:new Date,toolActivity:{isActive:!0}};this._messages=[...this._messages,r],this._status="submitting";try{this.abortController=new AbortController;const i=[{role:"system",content:_D()}];for(const c of this._messages)if(!(c.role==="assistant"&&!c.content&&!c.toolCalls?.length))if(c.role==="user")i.push({role:"user",content:c.content});else if(c.role==="assistant"){const d=[];if(c.content&&d.push({type:"text",text:c.content}),c.toolCalls)for(const f of c.toolCalls)d.push({type:"tool-call",toolCallId:f.id,toolName:f.name,input:f.args});i.push({role:"assistant",content:d.length>0?d:c.content});const h=c.toolCalls?.filter(f=>f.result!==void 0)??[];h.length>0&&i.push({role:"tool",content:h.map(f=>({type:"tool-result",toolCallId:f.id,toolName:f.name,output:typeof f.result=="string"?{type:"text",value:f.result}:{type:"json",value:f.result}}))})}else i.push({role:"system",content:c.content});const s={...AR(),...dD(),...CR(),...ER(),...IR(),...pD(),...gD()},o=Dg({baseURL:this.proxyUrl,apiKey:"proxy-handled"}),a=C0({model:o(e||Xh),system:wD(),messages:i,tools:s,stopWhen:rk(Tk),abortSignal:this.abortController.signal});this._status="streaming";for await(const c of a.fullStream)switch(c.type){case"start-step":this.currentStepText="",this.pendingStepText="",this.currentStepHasToolCalls=!1,this.updateLastAssistantMessage(d=>{d.toolActivity={isActive:!0}});break;case"text-delta":this.currentStepText+=c.text,this.pendingStepText+=c.text;break;case"tool-call":{this.currentStepHasToolCalls=!0;const d=c,h=d.invalid===!0;let f;if(h&&d.error){const p=d.error.cause?.cause?.message;if(p)try{const g=JSON.parse(p);Array.isArray(g)&&g.length>0&&(f=g.map(m=>`${m.path?.join(".")||"input"}: ${m.message||"invalid"}`).join("; "))}catch{f=p}f||(f=d.error.name||"Tool input validation failed")}this.updateLastAssistantMessage(p=>{p.toolCalls||(p.toolCalls=[]),p.toolCalls.push({id:c.toolCallId,name:c.toolName,args:c.input,status:h?"error":"running",commentary:this.pendingStepText.trim()||void 0,error:f}),p.toolActivity={isActive:!0,currentStep:c.toolName}}),this.pendingStepText="",this.currentStepText="";break}case"tool-result":this.updateLastAssistantMessage(d=>{const h=d.toolCalls?.find(f=>f.id===c.toolCallId);if(h){const f=Qs(c.output);h.result=f;let p=!1,g;if(typeof f=="string"){const m=f.toLowerCase();(m.includes("error")||m.includes("invalid")||m.includes("failed"))&&(p=!0,g=f)}else if(f&&typeof f=="object"){const m=f;m.success===!1&&typeof m.error=="string"?(p=!0,g=m.error):m.isError===!0?(p=!0,g=typeof m.error=="string"?m.error:typeof m.message=="string"?m.message:"Tool execution failed"):typeof m.error=="string"&&m.success===void 0&&(p=!0,g=m.error)}p?(h.status="error",h.error=g):h.status="completed"}});break;case"finish-step":!this.currentStepHasToolCalls&&this.pendingStepText.trim()&&this.updateLastAssistantMessage(d=>{d.content+=this.pendingStepText}),this.pendingStepText="";break;case"error":throw c.error}this.updateLastAssistantMessage(c=>{if(c.toolActivity={isActive:!1},c.toolCalls)for(const d of c.toolCalls)d.status==="running"&&(d.status="error",d.error="Tool did not return a result")}),await a.finishReason==="tool-calls"?(this._stoppedAtLimit=!0,this._status="awaiting_continue"):this._status="ready"}catch(i){if(i instanceof Error&&i.name==="AbortError"){this._status="ready",this.updateLastAssistantMessage(a=>{a.toolActivity={isActive:!1}});return}const s=i instanceof Error&&vD(i);if(this._isNetworkError=s,s){const a=Sk(i),l=yD(a);this._error=new bD(l,a,i),this._status="network_error"}else this._error=i instanceof Error?i:new Error("Unknown error"),this._status="error";const o=this._error.message;this.updateLastAssistantMessage(a=>{if(a.toolActivity={isActive:!1},a.toolCalls)for(const l of a.toolCalls)l.status==="running"&&(l.status="error",l.error=o);a.content||(a.content=s?"Connection error. Please check your internet and try again.":"Sorry, an error occurred while processing your request.")})}finally{this.abortController=null}}async retry(){if(!this.canRetry||!this._lastRequestParams)return;const{text:e,model:t,type:r}=this._lastRequestParams;this._messages.length>0&&(this._messages[this._messages.length-1].role==="assistant"&&(this._messages=this._messages.slice(0,-1)),r==="send"&&this._messages.length>0&&this._messages[this._messages.length-1].role==="user"&&(this._messages=this._messages.slice(0,-1))),this._error=null,this._isNetworkError=!1,this._status="ready",r==="send"?await this.sendMessage(e,t):(this._status="awaiting_continue",await this.continueConversation(t))}clearMessages(){this._messages=[],this._conversationId=null,this.currentAssistantMessageId=null,this._error=null,this._status="ready",this._stoppedAtLimit=!1,this._isNetworkError=!1,this._lastRequestParams=null}async sendMockMessage(e){this._conversationId||(this._conversationId=await Lw({addToRecent:!1}));const r={id:await yf(this._conversationId,{role:"user",content:e}),role:"user",content:e,createdAt:new Date};this._messages=[...this._messages,r];const{response:i,toolCalls:s}=zIe(e),o=s?s.map((h,f)=>({id:`mock-tool-${f}`,name:h.name,args:h.args,status:"completed",result:{success:!0}})):[],a=await yf(this._conversationId,{role:"assistant",content:"",toolCalls:[]});this.currentAssistantMessageId=a;const l={id:a,role:"assistant",content:"",toolCalls:o,createdAt:new Date,toolActivity:{isActive:!0}};this._messages=[...this._messages,l],this._status="streaming";const c=20,d=10;for(let h=0;h<i.length;h+=c){const f=i.slice(h,h+c);this.updateLastAssistantMessage(p=>{p.content+=f}),await new Promise(p=>setTimeout(p,d))}this.updateLastAssistantMessage(h=>{h.toolActivity={isActive:!1}}),this._status="ready"}updateLastAssistantMessage(e){const t=this._messages.length-1;if(t>=0&&this._messages[t].role==="assistant"){const r=[...this._messages],i={...r[t],toolCalls:[...r[t].toolCalls||[]]};e(i),r[t]=i,this._messages=r,this._conversationId&&this.currentAssistantMessageId&&vJ(this._conversationId,this.currentAssistantMessageId,{content:i.content,toolCalls:i.toolCalls})}}}function OD(n){return new UIe(n)}var jIe=P('<span class="pulse-dot svelte-1v62mdg"></span>'),VIe=P('<span class="spinner svelte-1v62mdg"></span>'),qIe=kn('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1v62mdg"><polyline points="20 6 9 17 4 12" class="svelte-1v62mdg"></polyline></svg>'),HIe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1v62mdg"><polyline points="18 15 12 9 6 15" class="svelte-1v62mdg"></polyline></svg>'),ZIe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1v62mdg"><polyline points="6 9 12 15 18 9" class="svelte-1v62mdg"></polyline></svg>'),WIe=P('<span class="widget-expand svelte-1v62mdg"><!></span>'),XIe=P('<span class="spinner small svelte-1v62mdg"></span>'),YIe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="svelte-1v62mdg"><polyline points="20 6 9 17 4 12" class="svelte-1v62mdg"></polyline></svg>'),GIe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="svelte-1v62mdg"><line x1="18" y1="6" x2="6" y2="18" class="svelte-1v62mdg"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-1v62mdg"></line></svg>'),KIe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1v62mdg"><circle cx="12" cy="12" r="10" class="svelte-1v62mdg"></circle></svg>'),JIe=P('<span class="tool-commentary svelte-1v62mdg"> </span>'),eMe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1v62mdg"><polyline points="18 15 12 9 6 15" class="svelte-1v62mdg"></polyline></svg>'),tMe=kn('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1v62mdg"><polyline points="6 9 12 15 18 9" class="svelte-1v62mdg"></polyline></svg>'),nMe=P('<div class="detail-section svelte-1v62mdg"><div class="detail-label svelte-1v62mdg">Arguments</div> <pre class="detail-code svelte-1v62mdg"> </pre></div>'),rMe=P('<div class="detail-section svelte-1v62mdg"><div class="detail-label svelte-1v62mdg">Result</div> <pre class="detail-code svelte-1v62mdg"> </pre></div>'),iMe=P('<div class="detail-section error svelte-1v62mdg"><div class="detail-label svelte-1v62mdg">Error</div> <pre class="detail-code svelte-1v62mdg"> </pre></div>'),sMe=P('<button type="button" class="copy-btn svelte-1v62mdg"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1v62mdg"><rect x="9" y="9" width="13" height="13" rx="2" ry="2" class="svelte-1v62mdg"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" class="svelte-1v62mdg"></path></svg> Copy JSON</button>'),oMe=P('<div class="tool-item-details svelte-1v62mdg"><!> <!> <!> <!></div>'),aMe=P('<div><button type="button" class="tool-item-header svelte-1v62mdg"><span><!></span> <div class="tool-info svelte-1v62mdg"><span class="tool-name svelte-1v62mdg"> </span> <!></div> <span class="expand-icon svelte-1v62mdg"><!></span></button> <!></div>'),lMe=P('<div class="widget-details svelte-1v62mdg"></div>'),cMe=P('<div><button type="button" class="widget-header svelte-1v62mdg"><span class="widget-icon svelte-1v62mdg"><!></span> <span class="widget-text svelte-1v62mdg"> </span> <!></button> <!></div>');function uMe(n,e){lt(e,!0);let t=j(!1),r=new kc;const i=le(()=>e.isActive&&e.toolCalls.length===0?"thinking":e.isActive?"working":"complete"),s=le(()=>e.toolCalls.find(C=>C.status==="running")),o=le(()=>{switch(u(i)){case"thinking":return"Thinking...";case"working":return a(u(s)?.name??e.currentStep??"Working...");case"complete":return`Used ${e.toolCalls.length} tool${e.toolCalls.length!==1?"s":""}`}});function a(C){return C.replace(/_/g," ")}function l(C){try{return JSON.stringify(C,null,2)}catch{return String(C)}}function c(){b(t,!u(t))}function d(C){r.has(C)?r.delete(C):r.add(C)}function h(C){switch(C){case"running":return"spinner";case"completed":return"check";case"error":return"error";default:return"pending"}}var f=cMe();let p;var g=w(f);g.__click=c;var m=w(g),v=w(m);{var y=C=>{var I=jIe();T(C,I)},O=C=>{var I=Ve(),D=Ie(I);{var Q=N=>{var B=VIe();T(N,B)},M=N=>{var B=qIe();T(N,B)};z(D,N=>{u(i)==="working"?N(Q):N(M,!1)},!0)}T(C,I)};z(v,C=>{u(i)==="thinking"?C(y):C(O,!1)})}var _=A(m,2),x=w(_),k=A(_,2);{var S=C=>{var I=WIe(),D=w(I);{var Q=N=>{var B=HIe();T(N,B)},M=N=>{var B=ZIe();T(N,B)};z(D,N=>{u(t)?N(Q):N(M,!1)})}T(C,I)};z(k,C=>{u(i)!=="thinking"&&C(S)})}var E=A(g,2);{var R=C=>{var I=lMe();Tt(I,21,()=>e.toolCalls,D=>D.id,(D,Q)=>{const M=le(()=>r.has(u(Q).id)),N=le(()=>h(u(Q).status));var B=aMe();let H;var F=w(B);F.__click=()=>d(u(Q).id);var Z=w(F);let $;var W=w(Z);{var G=ee=>{var U=XIe();T(ee,U)},L=ee=>{var U=Ve(),X=Ie(U);{var ie=pe=>{var de=YIe();T(pe,de)},ye=pe=>{var de=Ve(),we=Ie(de);{var me=_e=>{var Ae=GIe();T(_e,Ae)},Ee=_e=>{var Ae=KIe();T(_e,Ae)};z(we,_e=>{u(N)==="error"?_e(me):_e(Ee,!1)},!0)}T(pe,de)};z(X,pe=>{u(N)==="check"?pe(ie):pe(ye,!1)},!0)}T(ee,U)};z(W,ee=>{u(N)==="spinner"?ee(G):ee(L,!1)})}var q=A(Z,2),ue=w(q),oe=w(ue),fe=A(ue,2);{var be=ee=>{var U=JIe(),X=w(U);Y(()=>J(X,u(Q).commentary)),T(ee,U)};z(fe,ee=>{u(Q).commentary&&ee(be)})}var De=A(q,2),Le=w(De);{var he=ee=>{var U=eMe();T(ee,U)},se=ee=>{var U=tMe();T(ee,U)};z(Le,ee=>{u(M)?ee(he):ee(se,!1)})}var V=A(F,2);{var ne=ee=>{var U=oMe(),X=w(U);{var ie=_e=>{var Ae=nMe(),ze=A(w(Ae),2),Be=w(ze);Y(Se=>J(Be,Se),[()=>l(u(Q).args)]),T(_e,Ae)};z(X,_e=>{u(Q).args&&Object.keys(u(Q).args).length>0&&_e(ie)})}var ye=A(X,2);{var pe=_e=>{var Ae=rMe(),ze=A(w(Ae),2),Be=w(ze);Y(Se=>J(Be,Se),[()=>l(u(Q).result)]),T(_e,Ae)};z(ye,_e=>{u(Q).result!==void 0&&_e(pe)})}var de=A(ye,2);{var we=_e=>{var Ae=iMe(),ze=A(w(Ae),2),Be=w(ze);Y(()=>J(Be,u(Q).error)),T(_e,Ae)};z(de,_e=>{u(Q).error&&_e(we)})}var me=A(de,2);{var Ee=_e=>{var Ae=sMe();Ae.__click=()=>e.onCopy(u(Q)),T(_e,Ae)};z(me,_e=>{e.onCopy&&_e(Ee)})}T(ee,U)};z(V,ee=>{u(M)&&ee(ne)})}Y(ee=>{H=Ue(B,1,"tool-item svelte-1v62mdg",null,H,{expanded:u(M)}),$=Ue(Z,1,"tool-status svelte-1v62mdg",null,$,{running:u(N)==="spinner",completed:u(N)==="check",error:u(N)==="error"}),J(oe,ee)},[()=>a(u(Q).name)]),T(D,B)}),T(C,I)};z(E,C=>{u(t)&&e.toolCalls.length>0&&C(R)})}Y(()=>{p=Ue(f,1,"inline-tool-widget svelte-1v62mdg",null,p,{thinking:u(i)==="thinking",working:u(i)==="working",complete:u(i)==="complete"}),g.disabled=u(i)==="thinking",Pt(g,"aria-expanded",u(t)),Pt(g,"aria-label",u(o)),J(x,u(o))}),T(n,f),ct()}yt(["click"]);var dMe=P('<div class="conversation-header svelte-1u2n6a1"><!></div>'),hMe=P('<div class="conversation-controls svelte-1u2n6a1"><!></div>'),fMe=P('<div><!> <div class="conversation-content svelte-1u2n6a1"><!></div> <!></div>');function ZU(n,e){lt(e,!0);let t=et(e,"autoScroll",3,!1),r=et(e,"class",3,""),i=j(void 0),s=j(!0);const o=100;function a(){if(!u(i))return;const{scrollTop:v,scrollHeight:y,clientHeight:O}=u(i);b(s,y-v-O<o)}function l(){a()}tt(()=>{if(!t()||!u(i))return;e.scrollDependency;const v=()=>{u(i)&&u(s)&&(u(i).scrollTop=u(i).scrollHeight)};requestAnimationFrame(()=>{u(i)&&(u(i).scrollTop=u(i).scrollHeight,b(s,!0))});const y=new MutationObserver(()=>{requestAnimationFrame(v)});return y.observe(u(i),{childList:!0,subtree:!0,characterData:!0}),()=>{y.disconnect()}});var c=fMe(),d=w(c);{var h=v=>{var y=dMe(),O=w(y);ic(O,()=>e.header),T(v,y)};z(d,v=>{e.header&&v(h)})}var f=A(d,2),p=w(f);ic(p,()=>e.content),qt(f,v=>b(i,v),()=>u(i));var g=A(f,2);{var m=v=>{var y=hMe(),O=w(y);ic(O,()=>e.controls),T(v,y)};z(g,v=>{e.controls&&v(m)})}Y(()=>Ue(c,1,`conversation-container ${r()??""}`,"svelte-1u2n6a1")),It("scroll",f,l),T(n,c),ct()}var pMe=P('<div class="message-label svelte-17to1cl"> </div>'),gMe=P('<div class="message-content svelte-17to1cl"><!></div>'),mMe=P('<div class="tool-calls svelte-17to1cl"><div class="tool-call-info"> </div></div>'),vMe=P("<div><!> <!> <!></div>");function Ak(n,e){lt(e,!0);let t=et(e,"collapsed",3,!1),r=et(e,"variant",3,"bubble"),i=et(e,"noAnimation",3,!1),s=le(()=>r()==="section"?t()?"var(--text-muted)":e.role==="user"?"var(--accent-secondary)":e.role==="agent"&&e.label?.toLowerCase().includes("feedback")?"var(--success)":"var(--accent-primary)":"var(--message-agent-border)"),o=le(()=>r()==="section"?t()?"var(--bg-tertiary)":"var(--bg-secondary)":e.role==="user"?"var(--bg-secondary)":"var(--message-agent-bg)");var a=vMe();let l,c;var d=w(a);{var h=v=>{var y=pMe(),O=w(y);Y(()=>J(O,e.label)),T(v,y)};z(d,v=>{e.label&&v(h)})}var f=A(d,2);{var p=v=>{var y=gMe(),O=w(y);Wh(O,{get text(){return e.content},get onNoteClick(){return e.onNoteClick}}),T(v,y)};z(f,v=>{e.content.trim()&&v(p)})}var g=A(f,2);{var m=v=>{var y=mMe(),O=w(y),_=w(O);Y(()=>J(_,`${e.toolCalls.length??""} tool call${e.toolCalls.length!==1?"s":""}`)),T(v,y)};z(g,v=>{e.toolCalls&&e.toolCalls.length>0&&v(m)})}Y(()=>{l=Ue(a,1,"conversation-message svelte-17to1cl",null,l,{user:e.role==="user",agent:e.role==="agent",system:e.role==="system","bubble-variant":r()==="bubble","section-variant":r()==="section",collapsed:t(),"no-animation":i()}),c=gn(a,"",c,{"--border-color":u(s),"--bg-color":u(o)})}),T(n,a),ct()}var yMe=P('<div class="empty-state svelte-vwdj6k"><p class="svelte-vwdj6k">No conversations yet</p> <p class="empty-hint svelte-vwdj6k">Start a new chat to begin</p></div>'),bMe=P('<div role="listitem"><div class="conv-icon svelte-vwdj6k"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></div> <div class="conv-content svelte-vwdj6k"><span class="conv-title svelte-vwdj6k"><!></span> <span class="conv-date svelte-vwdj6k"> </span></div> <button class="archive-btn svelte-vwdj6k" title="Archive conversation"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button></div>'),wMe=P('<div class="conversations svelte-vwdj6k" role="list"></div>'),_Me=P('<div class="conversation-list svelte-vwdj6k"><div class="list-header svelte-vwdj6k"><span class="section-label svelte-vwdj6k">Conversations</span> <button class="new-btn svelte-vwdj6k" title="New conversation"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></button></div> <!></div>');function OMe(n,e){lt(e,!0);const t=le(A5);function r(h){const f=new Date(h),p=new Date;if(p.getTime()-f.getTime()<864e5&&f.getDate()===p.getDate())return f.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const m=new Date(p);return m.setDate(m.getDate()-1),f.getDate()===m.getDate()&&f.getMonth()===m.getMonth()?"Yesterday":f.getFullYear()===p.getFullYear()?f.toLocaleDateString([],{month:"short",day:"numeric"}):f.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})}async function i(h,f){h.stopPropagation(),await E5(f)}var s=_Me(),o=w(s),a=A(w(o),2);a.__click=function(...h){e.onNewConversation?.apply(this,h)};var l=A(o,2);{var c=h=>{var f=yMe();T(h,f)},d=h=>{var f=wMe();Tt(f,21,()=>u(t),p=>p.id,(p,g)=>{var m=bMe();let v;m.__click=()=>e.onConversationSelect(u(g));var y=A(w(m),2),O=w(y),_=w(O);vU(_,{get text(){return u(g).title},get onNoteClick(){return e.onNoteClick}});var x=A(O,2),k=w(x),S=A(y,2);S.__click=E=>i(E,u(g).id),Y(E=>{v=Ue(m,1,"conversation-item svelte-vwdj6k",null,v,{active:e.activeConversationId===u(g).id}),J(k,E)},[()=>r(u(g).updated)]),T(p,m)}),T(h,f)};z(l,h=>{u(t).length===0?h(c):h(d,!1)})}T(n,s),ct()}yt(["click"]);var xMe=P('<div><div class="editor-container svelte-1frfq25"></div></div>');function kMe(n,e){lt(e,!0);let t=et(e,"value",3,""),r=et(e,"placeholder",3,"Type a message..."),i=et(e,"disabled",3,!1),s,o=null,a=j(!1),l=null;const c=gt.theme({"&":{fontSize:"0.875rem",fontFamily:"inherit"},".cm-content":{padding:"10px 14px",minHeight:"40px",maxHeight:"300px",lineHeight:"1.4"},".cm-focused":{outline:"none"},".cm-editor":{borderRadius:"8px",border:"1px solid var(--border-light)",backgroundColor:"var(--bg-secondary)"},".cm-editor.cm-focused":{borderColor:"var(--accent-primary)",backgroundColor:"var(--bg-secondary)"},"&.cm-editor.cm-focused":{outline:"none"},".cm-scroller":{overflow:"auto"},".cm-line":{padding:"0"},".cm-placeholder":{color:"var(--text-muted)"}}),d=gt.theme({".cm-scroller":{scrollbarColor:"rgba(255, 255, 255, 0.2) transparent"},".cm-scroller::-webkit-scrollbar-thumb":{background:"rgba(255, 255, 255, 0.2)"},".cm-scroller::-webkit-scrollbar-thumb:hover":{background:"rgba(255, 255, 255, 0.3)"}});function h(E){b(a,E.matches,!0),f()}function f(){o&&o.dispatch({effects:en.reconfigure.of(g())})}const p=()=>{};function g(){const E=u(a)?K2:G2;return[F2,w6(r()),E,c,...u(a)?[d]:[],gt.updateListener.of(C=>{if(C.docChanged){const I=C.state.doc.toString();e.onValueChange&&I!==t()&&e.onValueChange(I)}}),un.readOnly.of(i()),gt.lineWrapping,eT(e.onWikilinkClick??p),Sse({parent:document.body,tooltipSpace:()=>({top:0,left:0,bottom:window.innerHeight,right:window.innerWidth})}),Wo.highest(Nl.of([{key:"Enter",run:C=>Mx(C.state)==="active"?!1:(e.onSubmit&&e.onSubmit(),!0)},{key:"Shift-Enter",run:()=>!1}]))]}qr(()=>{l=window.matchMedia("(prefers-color-scheme: dark)"),b(a,l.matches,!0),l.addEventListener("change",h);const E=un.create({doc:t(),extensions:g()});o=new gt({state:E,parent:s})}),Oo(()=>{o&&o.destroy(),l&&l.removeEventListener("change",h)}),tt(()=>{o&&t()!==o.state.doc.toString()&&o.dispatch({changes:{from:0,to:o.state.doc.length,insert:t()}})}),tt(()=>{o&&o.dispatch({effects:en.reconfigure.of(g())})});function m(){o&&o.focus()}function v(){o&&o.contentDOM.blur()}function y(){return o?.hasFocus??!1}function O(){o&&o.dispatch({changes:{from:0,to:o.state.doc.length,insert:""}})}var _={focus:m,blur:v,isFocused:y,clear:O},x=xMe();let k;var S=w(x);return qt(S,E=>s=E,()=>s),Y(()=>k=Ue(x,1,`chat-input-wrapper ${(e.class||"")??""}`,"svelte-1frfq25",k,{disabled:i()})),T(n,x),ct(_)}var SMe=kn('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path></path></svg>'),TMe=kn('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path></path><path></path></svg>'),AMe=P('<div class="mode-switcher-dropdown svelte-7lnhyd"><button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path></path></svg> <span> </span></button> <button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path></path><path></path></svg> <span> </span></button></div>'),CMe=P('<div class="mode-switcher-container svelte-7lnhyd"><button class="mode-switcher-btn svelte-7lnhyd" aria-label="Switch panel mode"><!> <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function WU(n,e){lt(e,!0);let t=j(!1);const r={chat:{label:"Agent",icon:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"},shelf:{label:"Shelf",icon:"M22 12h-6l-2 3h-4l-2-3H2",icon2:"M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"}};function i(g){b(t,!1),g!==e.activePanel&&e.onSwitch(g)}var s=CMe(),o=w(s);o.__click=()=>b(t,!u(t));var a=w(o);{var l=g=>{var m=SMe(),v=w(m);Y(()=>Pt(v,"d",r.chat.icon)),T(g,m)},c=g=>{var m=TMe(),v=w(m),y=A(v);Y(()=>{Pt(v,"d",r.shelf.icon),Pt(y,"d",r.shelf.icon2)}),T(g,m)};z(a,g=>{e.activePanel==="chat"?g(l):g(c,!1)})}var d=A(a,2);let h;var f=A(o,2);{var p=g=>{var m=AMe(),v=w(m);let y;v.__click=()=>i("chat");var O=w(v),_=w(O),x=A(O,2),k=w(x),S=A(v,2);let E;S.__click=()=>i("shelf");var R=w(S),C=w(R),I=A(C),D=A(R,2),Q=w(D);Y(()=>{y=Ue(v,1,"mode-option svelte-7lnhyd",null,y,{active:e.activePanel==="chat"}),Pt(_,"d",r.chat.icon),J(k,r.chat.label),E=Ue(S,1,"mode-option svelte-7lnhyd",null,E,{active:e.activePanel==="shelf"}),Pt(C,"d",r.shelf.icon),Pt(I,"d",r.shelf.icon2),J(Q,r.shelf.label)}),It("mouseleave",m,()=>b(t,!1)),T(g,m)};z(f,g=>{u(t)&&g(p)})}Y(()=>{Pt(o,"aria-expanded",u(t)),h=Ue(d,0,"chevron svelte-7lnhyd",null,h,{open:u(t)})}),T(n,s),ct()}yt(["click"]);class EMe{#e=j(Qt(Xh));get selectedModel(){return u(this.#e)}set selectedModel(e){b(this.#e,e,!0)}#t=j(!0);get isLoading(){return u(this.#t)}set isLoading(e){b(this.#t,e,!0)}#r=j(!1);get isInitialized(){return u(this.#r)}set isInitialized(e){b(this.#r,e,!0)}initializationPromise=null;constructor(){this.initializationPromise=this.initialize()}get loading(){return this.isLoading}get initialized(){return this.isInitialized}get currentSelectedModel(){return this.selectedModel}get currentModelInfo(){return hu(this.selectedModel)||hu(Xh)}async ensureInitialized(){this.initializationPromise&&await this.initializationPromise}async initialize(){this.isLoading=!0;try{const e=await window.api?.loadModelPreference();e&&hu(e)&&(this.selectedModel=e)}catch(e){console.warn("Failed to load model preference from storage:",e)}finally{this.isLoading=!1,this.isInitialized=!0,this.initializationPromise=null}}async setSelectedModel(e){if(await this.ensureInitialized(),!hu(e)){console.warn(`Model ${e} not found, keeping current selection`);return}try{this.selectedModel=e,await window.api?.saveModelPreference(e)}catch(r){throw console.error("Failed to save model preference to storage:",r),r}}}const qc=new EMe;async function PMe(n){return await qc.setSelectedModel(n)}const xd={get selectedModel(){return qc.currentSelectedModel},get currentModelInfo(){return qc.currentModelInfo},setSelectedModel:qc.setSelectedModel.bind(qc),ensureInitialized:qc.ensureInitialized.bind(qc)};var IMe=kn('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>'),MMe=kn('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>'),RMe=P('<button class="header-btn svelte-182pbkb"><!></button>'),DMe=P('<div class="history-panel svelte-182pbkb"><!></div>'),NMe=P('<div class="error-state svelte-182pbkb"><p>Failed to initialize chat:</p> <p class="error-message svelte-182pbkb"> </p></div>'),LMe=P('<div class="setup-prompt svelte-182pbkb"><div class="setup-icon svelte-182pbkb"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></div> <h4 class="svelte-182pbkb">API Key Required</h4> <p class="svelte-182pbkb">Configure your OpenRouter API key in Settings to start chatting.</p> <button class="setup-button svelte-182pbkb">Open Settings</button></div>'),QMe=P('<div class="loading-state svelte-182pbkb"><div class="spinner svelte-182pbkb"></div> <p>Initializing...</p></div>'),$Me=P('<div class="empty-chat svelte-182pbkb"><p class="svelte-182pbkb">Start a conversation with your AI assistant.</p> <p class="hint svelte-182pbkb">Ask questions, brainstorm ideas, or get help with your notes.</p></div>'),FMe=P("<!> <!>",1),zMe=P("<div><!></div>"),BMe=P('<div class="continue-prompt svelte-182pbkb"><span class="continue-prompt-text svelte-182pbkb"> </span> <button class="continue-button svelte-182pbkb">Continue</button></div>'),UMe=P("<!> <!>",1),jMe=P('<div class="messages-list svelte-182pbkb"><!></div>'),VMe=P(`<div class="offline-banner svelte-182pbkb"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"></path><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"></path><path d="M10.71 5.05A16 16 0 0 1 22.58 9"></path><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></svg> <span>You're offline</span></div>`),qMe=P('<div class="recovering-banner svelte-182pbkb"><div class="spinner-small svelte-182pbkb"></div> <span>Reconnecting...</span></div>'),HMe=P('<button type="button" class="retry-button svelte-182pbkb">Retry</button>'),ZMe=P('<div><span class="error-message-text svelte-182pbkb"> </span> <!></div>'),WMe=P('<button type="button" class="credits-badge svelte-182pbkb" title="Click to manage credits"> </button>'),XMe=P('<div class="context-popup svelte-182pbkb"><div class="context-popup-title svelte-182pbkb">Context Window</div> <div class="context-popup-row svelte-182pbkb"><span class="context-popup-label svelte-182pbkb">Used</span> <span class="context-popup-value svelte-182pbkb"> </span></div> <div class="context-popup-row svelte-182pbkb"><span class="context-popup-label svelte-182pbkb">Usage</span> <span class="context-popup-value svelte-182pbkb"> </span></div> <div class="context-popup-row svelte-182pbkb"><span class="context-popup-label svelte-182pbkb">Remaining</span> <span class="context-popup-value svelte-182pbkb"> </span></div></div>'),YMe=P(`<div class="context-circle-wrapper svelte-182pbkb" role="status" aria-label="Context window usage"><div><svg viewBox="0 0 36 36" class="circular-chart svelte-182pbkb"><path class="circle-bg svelte-182pbkb" d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"></path><path class="circle-progress svelte-182pbkb" d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"></path></svg></div> <!></div>`),GMe=P('<form class="chat-input-form svelte-182pbkb"><!> <!> <div class="input-container svelte-182pbkb"><!></div> <div class="input-controls svelte-182pbkb"><div class="model-switcher svelte-182pbkb"><button type="button" title="Normal - Fast and capable"><span class="mode-icon svelte-182pbkb">â¡</span> <span class="mode-label svelte-182pbkb">Normal</span></button> <button type="button" title="Plus Ultra - Deep thinking"><span class="mode-icon svelte-182pbkb">ð§ </span> <span class="mode-label svelte-182pbkb">Plus Ultra</span></button></div> <div class="controls-spacer svelte-182pbkb"></div> <!> <!> <button type="submit" class="send-button svelte-182pbkb" aria-label="Send message"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg></button></div></form>'),KMe=P('<div><div class="chat-panel-inner svelte-182pbkb"><div class="chat-header svelte-182pbkb"><!> <button class="header-btn svelte-182pbkb" title="Conversation history" aria-label="Toggle conversation history"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg></button> <h3 class="header-title svelte-182pbkb"><!></h3> <div class="header-actions svelte-182pbkb"><button class="header-btn svelte-182pbkb" title="New conversation" aria-label="Start new conversation"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></button> <!> <button class="header-btn svelte-182pbkb" title="Close" aria-label="Close chat"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div></div> <!> <!></div></div>');function JMe(n,e){lt(e,!0);let t=et(e,"isExpanded",3,!1),r=j(null),i=j(null),s=j(null),o=j(null),a=j(""),l=j(null),c=j(!1),d=j(null),h=j(null),f=j(null),p=j(!1);tt(()=>{if(!e.isOpen&&u(o))return;(async()=>{if(!(u(o)&&u(i)===!0))try{const ee=await window.api?.getChatServerPort();if(b(r,ee??null,!0),document.documentElement.hasAttribute("data-screenshot-mode")){b(i,!0),ee&&!u(o)&&b(o,OD(ee),!0);return}const X=await window.api?.testApiKey({provider:"openrouter"});b(i,X??!1,!0),ee&&X&&!u(o)&&b(o,OD(ee),!0)}catch(ee){console.error("Failed to initialize chat panel:",ee),b(s,ee instanceof Error?ee.message:"Failed to initialize chat",!0)}})()}),tt(()=>{VU()});const g=le(()=>u(o)?.messages??[]),m=le(()=>u(o)?.status??"ready"),v=le(()=>u(o)?.error),y=le(()=>u(m)==="submitting"||u(m)==="streaming"),O=le(()=>u(o)?.conversationId??null),_=le(hJ),x=le(()=>u(m)==="awaiting_continue"),k=le(()=>u(o)?.hasNetworkError??!1),S=le(()=>u(o)?.canRetry??!1),E=le(()=>!qU()),R=le(HU);tt(()=>{e.isOpen&&e.initialMessage&&u(o)&&u(i)&&!u(y)&&(u(o).startNewConversation(),u(o).sendMessage(e.initialMessage,xd.selectedModel),e.onInitialMessageConsumed?.())});async function C(){try{b(d,await window.api?.getOpenRouterCredits()??null,!0)}catch(ne){console.error("Failed to fetch credits:",ne)}}function I(ne){return Math.ceil(ne.length/4)}function D(){if(u(g).length===0){b(h,null);return}const ne=xd.currentModelInfo?.contextLength??2e5,ee=2e3;let U=0;for(const me of u(g))if(U+=I(me.content||""),me.toolCalls)for(const Ee of me.toolCalls)U+=I(JSON.stringify(Ee.args||{})),U+=I(JSON.stringify(Ee.result||""));const X=ee+U,ie=X/ne*100,ye=u(g).length>0?U/u(g).length:500,pe=ne-X,de=Math.max(0,Math.floor(pe/ye));let we="none";ie>=90?we="full":ie>=75?we="critical":ie>=50&&(we="warning"),b(h,{percentage:ie,warningLevel:we,totalTokens:X,maxTokens:ne,estimatedMessagesRemaining:de},!0)}function Q(ne){return ne>=1e3?`${Math.round(ne/1e3)}k`:ne.toString()}tt(()=>{u(i)&&C()}),tt(()=>{const ne=u(f)==="streaming"||u(f)==="submitting",ee=u(m)==="ready"||u(m)==="awaiting_continue";ne&&ee&&C(),b(f,u(m),!0)}),tt(()=>{e.isOpen&&u(i)&&u(o)&&u(l)&&requestAnimationFrame(()=>{u(l)?.focus()})}),tt(()=>{u(g).length,u(g).map(ne=>ne.content?.length??0).join(","),D()});async function M(ne){const ee=xd.currentModelInfo.provider,U=CCe(ee).filter(X=>X.mode===ne);U.length>0&&await PMe(U[0].id)}function N(){window.api?.openExternal({url:"https://openrouter.ai/credits"})}const B=le(()=>xd.currentModelInfo.mode??"normal"),H=le(()=>u(_)?.title??"AI Assistant");async function F(ne){if(ne?.preventDefault(),!u(o)||!u(a).trim()||u(y))return;const ee=u(a).trim(),U=xd.selectedModel;b(a,""),u(l)?.clear();try{await u(o).sendMessage(ee,U)}catch(X){console.error("Failed to send message:",X)}}function Z(ne){b(a,ne,!0)}function $(){u(a).trim()&&!u(y)&&F()}function W(ne){if(!ne.content)return"";if(G(ne)&&ne.toolCalls){let ee=ne.content;for(const U of ne.toolCalls)U.commentary&&(ee=ee.replace(U.commentary,""));return ee.trim()}return ne.content}function G(ne){return(ne.toolCalls?.length??0)>0}async function L(ne){u(o)&&(await u(o).loadConversation(ne.id),b(c,!1))}function q(){u(o)&&(u(o).startNewConversation(),b(c,!1))}function ue(){b(c,!u(c))}function oe(ne){Rs(ne)}async function fe(ne){const ee=JSON.stringify(ne,null,2);await navigator.clipboard.writeText(ee)}async function be(){u(o)&&await u(o).continueConversation(xd.selectedModel)}async function De(){!u(o)||!u(S)||await u(o).retry()}function Le(ne){e.isOpen&&ne.key==="Escape"&&(ne.preventDefault(),ne.stopPropagation(),u(l)?.isFocused()?u(l).blur():e.onClose())}var he=Ve();It("keydown",Na,Le);var se=Ie(he);{var V=ne=>{var ee=KMe();let U;var X=w(ee),ie=w(X),ye=w(ie);{var pe=ae=>{WU(ae,{activePanel:"chat",onSwitch:te=>te==="shelf"&&e.onSwitchToShelf?.()})};z(ye,ae=>{e.onSwitchToShelf&&ae(pe)})}var de=A(ye,2);de.__click=ue;var we=A(de,2),me=w(we);vU(me,{get text(){return u(H)},onNoteClick:oe});var Ee=A(we,2),_e=w(Ee);_e.__click=q;var Ae=A(_e,2);{var ze=ae=>{var te=RMe();te.__click=function(...Ne){e.onToggleExpand?.apply(this,Ne)};var re=w(te);{var ve=Ne=>{var ce=IMe();T(Ne,ce)},Te=Ne=>{var ce=MMe();T(Ne,ce)};z(re,Ne=>{t()?Ne(ve):Ne(Te,!1)})}Y(()=>{Pt(te,"title",t()?"Collapse to floating panel":"Expand to sidebar"),Pt(te,"aria-label",t()?"Collapse to floating panel":"Expand to sidebar")}),T(ae,te)};z(Ae,ae=>{e.onToggleExpand&&ae(ze)})}var Be=A(Ae,2);Be.__click=function(...ae){e.onClose?.apply(this,ae)};var Se=A(ie,2);{var Re=ae=>{var te=DMe(),re=w(te);OMe(re,{get activeConversationId(){return u(O)},onConversationSelect:L,onNewConversation:q,onNoteClick:oe}),T(ae,te)};z(Se,ae=>{u(c)&&ae(Re)})}var He=A(Se,2);{var Me=ae=>{var te=NMe(),re=A(w(te),2),ve=w(re);Y(()=>J(ve,u(s))),T(ae,te)},Pe=ae=>{var te=Ve(),re=Ie(te);{var ve=Ne=>{var ce=LMe(),Oe=A(w(ce),6);Oe.__click=function(...Qe){e.onGoToSettings?.apply(this,Qe)},T(Ne,ce)},Te=Ne=>{var ce=Ve(),Oe=Ie(ce);{var Qe=st=>{var it=QMe();T(st,it)},We=st=>{ZU(st,{autoScroll:!0,get scrollDependency(){return u(g)},class:"chat-conversation",content:bt=>{var xt=jMe(),mt=w(xt);{var Ge=ft=>{var at=$Me();T(ft,at)},Xe=ft=>{var at=UMe(),pt=Ie(at);Tt(pt,17,()=>u(g),wt=>wt.id,(wt,Rt)=>{var Et=zMe();let $t;var jt=w(Et);{var Kt=Nt=>{var Yt=Ve(),ln=Ie(Yt);{var Je=ge=>{{let Ze=le(()=>W(u(Rt)));Ak(ge,{get content(){return u(Ze)},role:"user",variant:"bubble",noAnimation:!0,onNoteClick:oe})}};z(ln,ge=>{W(u(Rt))&&ge(Je)})}T(Nt,Yt)},Zt=Nt=>{var Yt=FMe(),ln=Ie(Yt);{var Je=ht=>{{let Jt=le(()=>u(Rt).toolCalls??[]),mn=le(()=>u(Rt).toolActivity?.isActive??!1),yn=le(()=>u(Rt).toolActivity?.currentStep);uMe(ht,{get toolCalls(){return u(Jt)},get isActive(){return u(mn)},get currentStep(){return u(yn)},onCopy:fe})}};z(ln,ht=>{(G(u(Rt))||u(Rt).toolActivity?.isActive)&&ht(Je)})}var ge=A(ln,2);{var Ze=ht=>{{let Jt=le(()=>W(u(Rt)));Ak(ht,{get content(){return u(Jt)},role:"agent",variant:"bubble",noAnimation:!0,onNoteClick:oe})}};z(ge,ht=>{W(u(Rt))&&ht(Ze)})}T(Nt,Yt)};z(jt,Nt=>{u(Rt).role==="user"?Nt(Kt):Nt(Zt,!1)})}Y(()=>$t=Ue(Et,1,"message-wrapper svelte-182pbkb",null,$t,{user:u(Rt).role==="user",assistant:u(Rt).role==="assistant"})),T(wt,Et)});var dt=A(pt,2);{var _t=wt=>{var Rt=BMe(),Et=w(Rt),$t=w(Et),jt=A(Et,2);jt.__click=be,Y(()=>J($t,`Agent reached step limit (${Tk} steps)`)),T(wt,Rt)};z(dt,wt=>{u(x)&&wt(_t)})}T(ft,at)};z(mt,ft=>{u(g).length===0?ft(Ge):ft(Xe,!1)})}T(bt,xt)},controls:bt=>{var xt=GMe(),mt=w(xt);{var Ge=Je=>{var ge=VMe();T(Je,ge)},Xe=Je=>{var ge=Ve(),Ze=Ie(ge);{var ht=Jt=>{var mn=qMe();T(Jt,mn)};z(Ze,Jt=>{u(R)&&Jt(ht)},!0)}T(Je,ge)};z(mt,Je=>{u(E)?Je(Ge):Je(Xe,!1)})}var ft=A(mt,2);{var at=Je=>{var ge=ZMe();let Ze;var ht=w(ge),Jt=w(ht),mn=A(ht,2);{var yn=Yn=>{var vr=HMe();vr.__click=De,T(Yn,vr)};z(mn,Yn=>{u(S)&&Yn(yn)})}Y(()=>{Ze=Ue(ge,1,"error-banner svelte-182pbkb",null,Ze,{"network-error":u(k)}),J(Jt,u(v).message)}),T(Je,ge)};z(ft,Je=>{u(v)&&Je(at)})}var pt=A(ft,2),dt=w(pt);{let Je=le(()=>u(E)?"Offline - check your connection":"Ask Flint anything...use [[ to link notes"),ge=le(()=>u(y)||u(E));qt(kMe(dt,{get value(){return u(a)},get placeholder(){return u(Je)},get disabled(){return u(ge)},onValueChange:Z,onSubmit:$,get onWikilinkClick(){return fb}}),Ze=>b(l,Ze,!0),()=>u(l))}var _t=A(pt,2),wt=w(_t),Rt=w(wt);let Et;Rt.__click=()=>M("normal");var $t=A(Rt,2);let jt;$t.__click=()=>M("plus-ultra");var Kt=A(wt,4);{var Zt=Je=>{var ge=WMe();ge.__click=N;var Ze=w(ge);Y(ht=>J(Ze,`$${ht??""} left`),[()=>Math.round(u(d).remaining_credits)]),T(Je,ge)};z(Kt,Je=>{u(d)&&Je(Zt)})}var Nt=A(Kt,2);{var Yt=Je=>{var ge=YMe(),Ze=w(ge);let ht;var Jt=w(Ze),mn=A(w(Jt)),yn=A(Ze,2);{var Yn=vr=>{var Wi=XMe(),pi=A(w(Wi),2),Vn=A(w(pi),2),To=w(Vn),Ao=A(pi,2),Ll=A(w(Ao),2),Hr=w(Ll),gi=A(Ao,2),Us=A(w(gi),2),Xa=w(Us);Y((Mc,js,Jo)=>{J(To,`${Mc??""} / ${js??""} tokens`),J(Hr,`${Jo??""}%`),J(Xa,`~${u(h).estimatedMessagesRemaining??""} messages`)},[()=>Q(u(h).totalTokens),()=>Q(u(h).maxTokens),()=>u(h).percentage.toFixed(1)]),T(vr,Wi)};z(yn,vr=>{u(p)&&vr(Yn)})}Y(()=>{ht=Ue(Ze,1,"context-circle svelte-182pbkb",null,ht,{warning:u(h).warningLevel==="warning",critical:u(h).warningLevel==="critical"||u(h).warningLevel==="full"}),Pt(mn,"stroke-dasharray",`${u(h).percentage??""}, 100`)}),It("mouseenter",ge,()=>b(p,!0)),It("mouseleave",ge,()=>b(p,!1)),T(Je,ge)};z(Nt,Je=>{u(h)&&Je(Yt)})}var ln=A(Nt,2);Y(Je=>{Et=Ue(Rt,1,"mode-btn svelte-182pbkb",null,Et,{active:u(B)==="normal"}),jt=Ue($t,1,"mode-btn svelte-182pbkb",null,jt,{active:u(B)==="plus-ultra"}),ln.disabled=Je},[()=>u(y)||!u(a).trim()||u(E)]),It("submit",xt,F),T(bt,xt)},$$slots:{content:!0,controls:!0}})};z(Oe,st=>{!u(r)||u(i)===null?st(Qe):st(We,!1)},!0)}T(Ne,ce)};z(re,Ne=>{u(i)===!1?Ne(ve):Ne(Te,!1)},!0)}T(ae,te)};z(He,ae=>{u(s)?ae(Me):ae(Pe,!1)})}Y(()=>{U=Ue(ee,1,"chat-panel svelte-182pbkb",null,U,{visible:e.isOpen,expanded:t()}),Pt(we,"title",u(H))}),T(ne,ee)};z(se,ne=>{e.isOpen&&ne(V)})}T(n,he),ct()}yt(["click"]);var eRe=kn('<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>'),tRe=kn('<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>'),nRe=kn('<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>'),rRe=P('<p class="coming-soon-description svelte-pccaz3"> </p>'),iRe=P('<div class="coming-soon svelte-pccaz3"><div class="coming-soon-icon svelte-pccaz3"><!></div> <h3 class="coming-soon-title svelte-pccaz3"> </h3> <!> <span class="coming-soon-badge svelte-pccaz3">Coming Soon</span> <p class="coming-soon-cta svelte-pccaz3">Download the <a href="/#download" target="_blank" class="svelte-pccaz3">desktop app</a> to use this feature.</p></div>');function XU(n,e){let t=et(e,"icon",3,"chat");var r=iRe(),i=w(r),s=w(i);{var o=f=>{var p=eRe();T(f,p)},a=f=>{var p=Ve(),g=Ie(p);{var m=y=>{var O=tRe();T(y,O)},v=y=>{var O=Ve(),_=Ie(O);{var x=k=>{var S=nRe();T(k,S)};z(_,k=>{t()==="webpage"&&k(x)},!0)}T(y,O)};z(g,y=>{t()==="review"?y(m):y(v,!1)},!0)}T(f,p)};z(s,f=>{t()==="chat"?f(o):f(a,!1)})}var l=A(i,2),c=w(l),d=A(l,2);{var h=f=>{var p=rRe(),g=w(p);Y(()=>J(g,e.description)),T(f,p)};z(d,f=>{e.description&&f(h)})}Y(()=>J(c,e.title)),T(n,r)}var sRe=P('<div><div class="panel-header svelte-14h3e8x"><h3 class="svelte-14h3e8x">AI Agent</h3> <button class="close-btn svelte-14h3e8x" aria-label="Close"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"></path></svg></button></div> <!></div>');function xD(n,e){lt(e,!0);let t=et(e,"isExpanded",3,!1);var r=Ve(),i=Ie(r);{var s=a=>{var l=Ve(),c=Ie(l);{var d=h=>{var f=sRe();let p;var g=w(f),m=A(w(g),2);m.__click=function(...y){e.onClose?.apply(this,y)};var v=A(g,2);XU(v,{title:"AI Agent",description:"Chat with an AI that understands your notes and helps you find connections.",icon:"chat"}),Y(()=>p=Ue(f,1,"chat-panel-web svelte-14h3e8x",null,p,{expanded:t()})),T(h,f)};z(c,h=>{e.isOpen&&h(d)})}T(a,l)},o=a=>{JMe(a,{get isOpen(){return e.isOpen},get isExpanded(){return t()},get onClose(){return e.onClose},get onToggleExpand(){return e.onToggleExpand},get onGoToSettings(){return e.onGoToSettings},get initialMessage(){return e.initialMessage},get onInitialMessageConsumed(){return e.onInitialMessageConsumed},get onSwitchToShelf(){return e.onSwitchToShelf}})};z(i,a=>{cc()?a(s):a(o,!1)})}T(n,r),ct()}yt(["click"]);var oRe=P('<div class="shelf-editor-wrapper svelte-167d884"><div class="editor-container editor-font svelte-167d884"></div></div>');function aRe(n,e){lt(e,!0);let t=j(null),r=null,i=j(Qt(e.noteId)),s=j(null),o=j(!0),a=j("");tt(()=>{const k=e.noteId;b(o,!0),b(s,null),Yp(k).then(S=>{if(S&&e.noteId===k){b(s,S,!0);const E=S.doc();b(a,E?.content||"",!0),b(o,!1)}})});async function l(k,S,E){const R=E?.targetType||"note",C=E?.shouldCreate||!1;if(R==="conversation")AS(k),Dr({type:"conversation",id:k});else if(R==="type")mu(k),Fn("types");else if(C){const I=await zs({title:S});El(I),Rs(I)}else Rs(k)}function c(k){return new tT({onWikilinkClick:l,automergeSync:k?{handle:k,path:["content"]}:void 0,placeholder:"Start typing..."})}let d=c(null);function h(){if(!u(t)||r)return;const k=un.create({doc:u(a),extensions:d.getExtensions()});r=new gt({state:k,parent:u(t)}),f()}function f(){r&&setTimeout(()=>{if(r){const k=CT(r.dom);ET(k)}},10)}function p(){r&&(r.destroy(),r=null),d.destroy(),d=c(u(s)),d.initializeTheme(),u(t)&&h()}qr(()=>(d.initializeTheme(),()=>{r&&(r.destroy(),r=null),d.destroy()})),tt(()=>{u(t)&&!r&&!u(o)&&u(s)&&(d.destroy(),d=c(u(s)),d.initializeTheme(),h())}),tt(()=>{e.noteId!==u(i)&&u(s)&&!u(o)&&(b(i,e.noteId,!0),p())}),tt(()=>{d.isDarkMode,r&&(r.dispatch({effects:en.reconfigure.of(d.getExtensions())}),f())}),tt(()=>{cs(),r&&setTimeout(()=>{r&&jh(r)},50)});function g(){r?.focus()}function m(){return r?.state.doc.toString()||""}function v(k){if(r){const S=r.state.doc.toString();r.dispatch({changes:{from:0,to:S.length,insert:k}})}}function y(){r&&jh(r)}var O={focus:g,getContent:m,setContent:v,refreshWikilinks:y},_=oRe(),x=w(_);return qt(x,k=>b(t,k),()=>u(t)),T(n,_),ct(O)}var lRe=kn('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>'),cRe=P('<span class="emoji-icon svelte-1e7bj2e"> </span>'),uRe=P('<div><span class="message-role svelte-1e7bj2e"> </span> <span class="message-text svelte-1e7bj2e"> </span></div>'),dRe=P('<div class="messages-preview svelte-1e7bj2e"></div>'),hRe=P('<div class="empty-content svelte-1e7bj2e">No messages</div>'),fRe=P('<div class="item-content svelte-1e7bj2e"><!></div>'),pRe=P('<div><div class="item-header svelte-1e7bj2e"><button><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></button> <span class="item-icon svelte-1e7bj2e"><!></span> <button class="item-title svelte-1e7bj2e"> </button> <button class="remove-btn svelte-1e7bj2e" title="Remove from shelf" aria-label="Remove from shelf"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div> <!></div>'),gRe=P('<div class="shelf-item deleted svelte-1e7bj2e"><div class="item-header svelte-1e7bj2e"><span class="item-icon svelte-1e7bj2e"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></span> <span class="item-title deleted-text svelte-1e7bj2e">Item not found</span> <button class="remove-btn svelte-1e7bj2e" title="Remove from shelf" aria-label="Remove from shelf"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div></div>');function mRe(n,e){lt(e,!0);const t=le(()=>e.itemType==="note"?Zn(e.itemId):void 0),r=le(()=>e.itemType==="conversation"?xu(e.itemId):void 0),i=le(()=>u(t)?jr(u(t).type):void 0),s=le(()=>e.itemType==="note"&&u(t)?u(t).title||"Untitled":e.itemType==="conversation"&&u(r)?u(r).title||"Untitled Conversation":"Unknown"),o=le(()=>e.itemType==="note"&&u(i)?u(i).icon||"ð":null),a=le(()=>e.itemType==="note"&&u(t)?u(t).archived:e.itemType==="conversation"&&u(r)?u(r).archived:!1),l=le(()=>[]),c=le(()=>e.itemType==="note"&&u(t)!==void 0||e.itemType==="conversation"&&u(r)!==void 0);function d(v){v.stopPropagation(),e.onNavigate()}function h(v){v.stopPropagation(),e.onRemove()}var f=Ve(),p=Ie(f);{var g=v=>{var y=pRe();let O;var _=w(y),x=w(_);let k;x.__click=function(...B){e.onToggle?.apply(this,B)};var S=A(x,2),E=w(S);{var R=B=>{var H=lRe();T(B,H)},C=B=>{var H=cRe(),F=w(H);Y(()=>J(F,u(o))),T(B,H)};z(E,B=>{e.itemType==="conversation"?B(R):B(C,!1)})}var I=A(S,2);I.__click=d;var D=w(I),Q=A(I,2);Q.__click=h;var M=A(_,2);{var N=B=>{var H=fRe(),F=w(H);{var Z=W=>{aRe(W,{get noteId(){return e.itemId}})},$=W=>{var G=Ve(),L=Ie(G);{var q=ue=>{var oe=Ve(),fe=Ie(oe);{var be=Le=>{var he=dRe();Tt(he,21,()=>u(l),Sl,(se,V)=>{var ne=uRe();let ee;var U=w(ne),X=w(U),ie=A(U,2),ye=w(ie);Y(()=>{ee=Ue(ne,1,"message-preview svelte-1e7bj2e",null,ee,{user:u(V).role==="user"}),J(X,`${u(V).role==="user"?"You":"AI"}:`),J(ye,u(V).content)}),T(se,ne)}),T(Le,he)},De=Le=>{var he=hRe();T(Le,he)};z(fe,Le=>{u(l).length>0?Le(be):Le(De,!1)})}T(ue,oe)};z(L,ue=>{e.itemType==="conversation"&&ue(q)},!0)}T(W,G)};z(F,W=>{e.itemType==="note"?W(Z):W($,!1)})}T(B,H)};z(M,B=>{e.isExpanded&&B(N)})}Y(()=>{O=Ue(y,1,"shelf-item svelte-1e7bj2e",null,O,{archived:u(a)}),k=Ue(x,1,"disclosure-btn svelte-1e7bj2e",null,k,{expanded:e.isExpanded}),Pt(x,"aria-label",e.isExpanded?"Collapse":"Expand"),Pt(x,"aria-expanded",e.isExpanded),Pt(I,"title",`Open ${e.itemType??""}`),J(D,u(s))}),T(v,y)},m=v=>{var y=gRe(),O=w(y),_=A(w(O),4);_.__click=h,T(v,y)};z(p,v=>{u(c)?v(g):v(m,!1)})}T(n,f),ct()}yt(["click"]);var vRe=P('<button class="header-btn svelte-1ihrm2x" title="Clear all" aria-label="Clear all items from shelf"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>'),yRe=kn('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>'),bRe=kn('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>'),wRe=P('<button class="header-btn svelte-1ihrm2x"><!></button>'),_Re=P('<div class="empty-state svelte-1ihrm2x"><div class="empty-icon svelte-1ihrm2x"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 12h-6l-2 3h-4l-2-3H2"></path><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path></svg></div> <h4 class="svelte-1ihrm2x">Shelf is empty</h4> <p class="svelte-1ihrm2x">Add notes or conversations to your shelf for quick reference while working.</p> <p class="hint svelte-1ihrm2x">Use the "Add to Shelf" button in the note or conversation header.</p></div>'),ORe=P('<div class="shelf-items svelte-1ihrm2x"></div>'),xRe=P('<div><div class="shelf-panel-inner svelte-1ihrm2x"><div class="shelf-header svelte-1ihrm2x"><!> <h3 class="header-title svelte-1ihrm2x">Shelf</h3> <div class="header-actions svelte-1ihrm2x"><!> <!> <button class="header-btn svelte-1ihrm2x" title="Close" aria-label="Close shelf"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div></div> <div class="shelf-content svelte-1ihrm2x"><!></div></div></div>');function kD(n,e){lt(e,!0);let t=et(e,"isExpanded",3,!1);const r=le(()=>uu.items);function i(h){uu.toggleExpanded(h.type,h.id)}function s(h){uu.removeItem(h.type,h.id)}function o(h){e.onNavigate?.(h.type,h.id),e.onClose()}function a(){uu.clear()}var l=Ve(),c=Ie(l);{var d=h=>{var f=xRe();let p;var g=w(f),m=w(g),v=w(m);{var y=Q=>{WU(Q,{activePanel:"shelf",onSwitch:M=>M==="chat"&&e.onSwitchToChat?.()})};z(v,Q=>{e.onSwitchToChat&&Q(y)})}var O=A(v,4),_=w(O);{var x=Q=>{var M=vRe();M.__click=a,T(Q,M)};z(_,Q=>{u(r).length>0&&Q(x)})}var k=A(_,2);{var S=Q=>{var M=wRe();M.__click=function(...F){e.onToggleExpand?.apply(this,F)};var N=w(M);{var B=F=>{var Z=yRe();T(F,Z)},H=F=>{var Z=bRe();T(F,Z)};z(N,F=>{t()?F(B):F(H,!1)})}Y(()=>{Pt(M,"title",t()?"Collapse to floating panel":"Expand to sidebar"),Pt(M,"aria-label",t()?"Collapse to floating panel":"Expand to sidebar")}),T(Q,M)};z(k,Q=>{e.onToggleExpand&&Q(S)})}var E=A(k,2);E.__click=function(...Q){e.onClose?.apply(this,Q)};var R=A(m,2),C=w(R);{var I=Q=>{var M=_Re();T(Q,M)},D=Q=>{var M=ORe();Tt(M,21,()=>u(r),N=>N.type+"-"+N.id,(N,B)=>{mRe(N,{get itemType(){return u(B).type},get itemId(){return u(B).id},get isExpanded(){return u(B).isExpanded},onToggle:()=>i(u(B)),onRemove:()=>s(u(B)),onNavigate:()=>o(u(B))})}),T(Q,M)};z(C,Q=>{u(r).length===0?Q(I):Q(D,!1)})}Y(()=>p=Ue(f,1,"shelf-panel svelte-1ihrm2x",null,p,{visible:e.isOpen,expanded:t()})),T(h,f)};z(c,h=>{e.isOpen&&h(d)})}T(n,l),ct()}yt(["click"]);var kRe=P('<span class="version-badge svelte-1f2izl8"> </span>'),SRe=P('<div class="loading-state svelte-1f2izl8"><svg class="spinner svelte-1f2izl8" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" stroke-opacity="0.25"></circle><path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"></path></svg> <span>Loading changelog...</span></div>'),TRe=P('<div class="error-state svelte-1f2izl8"><span> </span></div>'),ARe=P('<div class="changelog-content svelte-1f2izl8"><!></div>'),CRe=P(`<div class="changelog-modal-overlay svelte-1f2izl8" role="dialog" aria-modal="true" aria-labelledby="changelog-modal-title" tabindex="-1"><div class="changelog-modal-content svelte-1f2izl8"><div class="changelog-modal-header svelte-1f2izl8"><div class="header-left svelte-1f2izl8"><h3 id="changelog-modal-title" class="svelte-1f2izl8">What's New</h3> <!></div> <button class="close-btn svelte-1f2izl8" aria-label="Close modal"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 4L12 12M4 12L12 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></button></div> <div class="changelog-modal-body svelte-1f2izl8"><!></div> <div class="changelog-modal-footer svelte-1f2izl8"><button class="toggle-history-btn svelte-1f2izl8"> </button></div></div></div>`);function ERe(n,e){lt(e,!0);let t=j(""),r=j(""),i=j(!0),s=j(null),o=j(""),a=j(!1),l=j(!1);async function c(){b(i,!0),b(s,null);try{const x=await window.api?.getAppVersion();x&&(b(o,x.version,!0),b(a,x.channel==="canary"));const k=await window.api?.getChangelog(u(o),u(a));k?.success&&k.changelog?b(t,k.changelog,!0):b(t,`No changelog available for version ${u(o)}.`);const S=await window.api?.getChangelog("",u(a));S?.success&&S.changelog?b(r,S.changelog,!0):b(r,u(t),!0)}catch(x){console.error("Failed to load changelog:",x),b(s,"Failed to load changelog.")}finally{b(i,!1)}}function d(x){const k=zn.parse(x);return typeof k!="string"?"":FT.sanitize(k,{ALLOWED_TAGS:["p","strong","b","em","i","code","pre","ul","ol","li","blockquote","h1","h2","h3","h4","h5","h6","br","a","hr"],ALLOWED_ATTR:["href","target","rel","class"],KEEP_CONTENT:!0})}const h=le(()=>u(l)?u(r):u(t)),f=le(()=>d(u(h)));function p(x){x.key==="Escape"&&e.onClose()}function g(x){x.target===x.currentTarget&&e.onClose()}function m(x){const k=x.target;if(k.tagName==="A"){x.preventDefault();const S=k.href;S&&window.api?.openExternal({url:S})}}function v(x){if(x.key==="Enter"||x.key===" "){const k=x.target;if(k.tagName==="A"){x.preventDefault();const S=k.href;S&&window.api?.openExternal({url:S})}}}tt(()=>{e.isOpen&&(c(),b(l,!1),setTimeout(()=>{document.querySelector(".changelog-modal-overlay")?.focus()},100))});var y=Ve(),O=Ie(y);{var _=x=>{var k=CRe();k.__click=g,k.__keydown=p;var S=w(k),E=w(S),R=w(E),C=A(w(R),2);{var I=$=>{var W=kRe(),G=w(W);Y(()=>J(G,`v${u(o)??""}`)),T($,W)};z(C,$=>{u(o)&&$(I)})}var D=A(R,2);D.__click=function(...$){e.onClose?.apply(this,$)};var Q=A(E,2);Q.__click=m,Q.__keydown=v;var M=w(Q);{var N=$=>{var W=SRe();T($,W)},B=$=>{var W=Ve(),G=Ie(W);{var L=ue=>{var oe=TRe(),fe=w(oe),be=w(fe);Y(()=>J(be,u(s))),T(ue,oe)},q=ue=>{var oe=ARe(),fe=w(oe);Fk(fe,()=>u(f)),T(ue,oe)};z(G,ue=>{u(s)?ue(L):ue(q,!1)},!0)}T($,W)};z(M,$=>{u(i)?$(N):$(B,!1)})}var H=A(Q,2),F=w(H);F.__click=()=>b(l,!u(l));var Z=w(F);Y(()=>{F.disabled=u(i),J(Z,u(l)?"Show current version only":"View full history")}),T(x,k)};z(O,x=>{e.isOpen&&x(_)})}T(n,y),ct()}yt(["click","keydown"]);var PRe=P('<div class="empty-state svelte-vqroyp"><p class="svelte-vqroyp">No review history yet</p></div>'),IRe=P('<div class="content-section svelte-vqroyp"><h4 class="svelte-vqroyp">Prompt</h4> <div class="content-text svelte-vqroyp"> </div></div>'),MRe=P('<div class="content-section svelte-vqroyp"><h4 class="svelte-vqroyp">Your Response</h4> <div class="content-text svelte-vqroyp"> </div></div>'),RRe=P('<div class="content-section svelte-vqroyp"><h4 class="svelte-vqroyp">Agent Feedback</h4> <div class="content-text feedback-text svelte-vqroyp"> </div></div>'),DRe=P('<div class="entry-content svelte-vqroyp"><!> <!> <!></div>'),NRe=P('<div><button class="entry-header svelte-vqroyp"><div class="header-left svelte-vqroyp"><span> </span> <span class="timestamp svelte-vqroyp"> </span></div> <svg class="expand-icon svelte-vqroyp" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>'),LRe=P('<div class="history-list svelte-vqroyp"></div>'),QRe=P("<div><!></div>");function YU(n,e){lt(e,!0);let t=et(e,"compact",3,!1),r=j(Qt(new Set));function i(h){const f=new Set(u(r));f.has(h)?f.delete(h):f.add(h),b(r,f,!0)}function s(h){const f=new Date(h),g=new Date().getTime()-f.getTime(),m=Math.floor(g/(1e3*60*60*24));return m===0?"Today at "+f.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):m===1?"Yesterday at "+f.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):m<7?`${m} days ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}var o=QRe();let a;var l=w(o);{var c=h=>{var f=PRe();T(h,f)},d=h=>{var f=LRe();Tt(f,23,()=>e.history,p=>p.date,(p,g,m)=>{var v=NRe();let y;var O=w(v);O.__click=()=>i(u(m));var _=w(O),x=w(_),k=w(x),S=A(x,2),E=w(S),R=A(O,2);{var C=I=>{var D=DRe(),Q=w(D);{var M=Z=>{var $=IRe(),W=A(w($),2),G=w(W);Y(()=>J(G,u(g).prompt)),T(Z,$)};z(Q,Z=>{u(g).prompt&&Z(M)})}var N=A(Q,2);{var B=Z=>{var $=MRe(),W=A(w($),2),G=w(W);Y(()=>J(G,u(g).response)),T(Z,$)};z(N,Z=>{u(g).response&&Z(B)})}var H=A(N,2);{var F=Z=>{var $=RRe(),W=A(w($),2),G=w(W);Y(()=>J(G,u(g).feedback)),T(Z,$)};z(H,Z=>{u(g).feedback&&Z(F)})}T(I,D)};z(R,I=>{u(r).has(u(m))&&I(C)})}Y((I,D,Q)=>{y=Ue(v,1,"history-entry svelte-vqroyp",null,y,I),Pt(O,"aria-expanded",D),Ue(x,1,`badge rating-${u(g).rating??""}`,"svelte-vqroyp"),J(k,nu[u(g).rating]),J(E,Q)},[()=>({expanded:u(r).has(u(m))}),()=>u(r).has(u(m)),()=>s(u(g).date)]),T(p,v)}),T(h,f)};z(l,h=>{e.history.length===0?h(c):h(d,!1)})}Y(()=>a=Ue(o,1,"review-history-panel svelte-vqroyp",null,a,{compact:t()})),T(n,o),ct()}yt(["click"]);var $Re=P('<div class="empty-state svelte-ah71ec"><p class="svelte-ah71ec"> </p></div>'),FRe=P('<button class="expand-btn svelte-ah71ec" aria-label="Toggle history"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></button>'),zRe=P('<span class="status-badge retired svelte-ah71ec">Retired</span>'),BRe=P("<span> </span>"),URe=P('<button class="review-btn svelte-ah71ec">Review Now</button>'),jRe=P('<div class="history-content svelte-ah71ec"><!></div>'),VRe=P('<div><div class="note-header svelte-ah71ec"><button class="note-title svelte-ah71ec"> </button> <!></div> <div class="note-meta svelte-ah71ec"><span> </span> <!> <span class="review-count svelte-ah71ec"> </span> <!></div> <!></div>'),qRe=P('<div class="notes-container svelte-ah71ec"></div>'),HRe=P('<div class="review-notes-list svelte-ah71ec"><!></div>');function ZRe(n,e){lt(e,!0);let t=et(e,"searchQuery",3,""),r=et(e,"isOffline",3,!1),i=j(null);const s=le(()=>{const v=$J(),y=L5(),O=new Date;return O.setHours(0,0,0,0),v.map(({note:_,review:x,estimatedDue:k,isOverdue:S})=>{const E=x.reviewHistory||[],R=E.length>0?E[E.length-1]:null,C=new Date(k);C.setHours(0,0,0,0);const I=C.getTime()===O.getTime()&&y;return{note:_,review:x,estimatedDue:k,isOverdue:S,isDueToday:I,lastResult:R?VK(R.rating)?"passed":"failed":null}})}),o=le(()=>{if(!t().trim())return u(s);const v=t().toLowerCase();return u(s).filter(y=>y.note.title.toLowerCase().includes(v))});function a(v){b(i,u(i)===v?null:v,!0)}function l(v,y){if(y.target.closest("button"))return;const _=u(s).find(x=>x.note.id===v);_&&_.review.reviewHistory.length>0&&a(v)}function c(v,y){(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),l(v,y))}function d(v,y,O){O.stopPropagation(),fb(v,y)}function h(v){const y=new Date;y.setHours(0,0,0,0);const O=new Date(v);O.setHours(0,0,0,0);const _=Math.round((O.getTime()-y.getTime())/(1e3*60*60*24));return _<=0?"Due":_===1?"Tomorrow":_<=6?`In ${_} days`:_<=13?"Next week":_<=20?"In 2 weeks":_<=27?"In 3 weeks":v.toLocaleDateString("en-US",{month:"short",day:"numeric"})}var f=HRe(),p=w(f);{var g=v=>{var y=$Re(),O=w(y),_=w(O);Y(x=>J(_,x),[()=>t().trim()?"No notes found matching your search.":"No notes marked for review yet."]),T(v,y)},m=v=>{var y=qRe();Tt(y,21,()=>u(o),O=>O.note.id,(O,_)=>{const x=le(()=>u(_).review.reviewHistory.length>0);var k=VRe();let S;k.__click=oe=>l(u(_).note.id,oe),k.__keydown=oe=>c(u(_).note.id,oe);var E=w(k),R=w(E);R.__click=oe=>d(u(_).note.id,u(_).note.title,oe);var C=w(R),I=A(R,2);{var D=oe=>{var fe=FRe();fe.__click=()=>a(u(_).note.id);var be=w(fe);let De;Y(()=>De=Ue(be,0,"expand-icon svelte-ah71ec",null,De,{expanded:u(i)===u(_).note.id})),T(oe,fe)};z(I,oe=>{u(x)&&oe(D)})}var Q=A(E,2),M=w(Q);let N;var B=w(M),H=A(M,2);{var F=oe=>{var fe=zRe();T(oe,fe)},Z=oe=>{var fe=Ve(),be=Ie(fe);{var De=Le=>{var he=BRe();let se;var V=w(he);Y(()=>{se=Ue(he,1,"result-badge svelte-ah71ec",null,se,{passed:u(_).lastResult==="passed"}),J(V,u(_).lastResult==="passed"?"Passed":"Failed")}),T(Le,he)};z(be,Le=>{u(_).lastResult&&Le(De)},!0)}T(oe,fe)};z(H,oe=>{u(_).review.status==="retired"?oe(F):oe(Z,!1)})}var $=A(H,2),W=w($),G=A($,2);{var L=oe=>{var fe=URe();fe.__click=()=>e.onReviewNote(u(_).note.id),Y(()=>{fe.disabled=r(),Pt(fe,"title",r()?"Offline - cannot start review":void 0)}),T(oe,fe)};z(G,oe=>{u(_).review.status!=="retired"&&oe(L)})}var q=A(Q,2);{var ue=oe=>{var fe=jRe(),be=w(fe);YU(be,{get history(){return u(_).review.reviewHistory},compact:!0}),T(oe,fe)};z(q,oe=>{u(i)===u(_).note.id&&u(x)&&oe(ue)})}Y(oe=>{S=Ue(k,1,"note-card svelte-ah71ec",null,S,{"has-history":u(x)}),Pt(k,"role",u(x)?"button":void 0),Pt(k,"tabindex",u(x)?0:void 0),J(C,u(_).note.title),N=Ue(M,1,"date-badge svelte-ah71ec",null,N,{overdue:u(_).isOverdue,today:u(_).isDueToday}),J(B,oe),J(W,`${u(_).review.reviewCount??""} review${u(_).review.reviewCount!==1?"s":""}`)},[()=>h(u(_).estimatedDue)]),T(O,k)}),T(v,y)};z(p,v=>{u(o).length===0?v(g):v(m,!1)})}T(n,f),ct()}yt(["click","keydown"]);var WRe=P(`<div class="offline-notice svelte-79oxa6"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"></path><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"></path><path d="M10.71 5.05A16 16 0 0 1 22.58 9"></path><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></svg> <span>You're offline - review requires an internet connection</span></div>`),XRe=P('<div class="saved-session-notice svelte-79oxa6"><p class="notice-text svelte-79oxa6">You have a paused review session</p> <button class="start-review-btn resume svelte-79oxa6">Resume Session</button></div>'),YRe=P('<button class="start-review-btn primary svelte-79oxa6"> </button>'),GRe=P('<div class="no-reviews svelte-79oxa6"><p class="svelte-79oxa6">Session complete!</p> <p class="upcoming svelte-79oxa6">Next session available tomorrow</p></div>'),KRe=P('<div class="no-reviews svelte-79oxa6"><p class="svelte-79oxa6">No notes due for review!</p> <p class="upcoming svelte-79oxa6">Enable review on notes to get started</p></div>'),JRe=P(`<div class="settings-content svelte-79oxa6"><div class="setting-item svelte-79oxa6"><label for="session-size" class="svelte-79oxa6"><span class="setting-label svelte-79oxa6">Notes per session</span> <span class="setting-description svelte-79oxa6">Lower for shorter, more frequent sessions. Higher if you prefer longer,
              deeper review periods.</span></label> <input id="session-size" type="number" min="1" max="50" class="svelte-79oxa6"/></div> <div class="setting-item svelte-79oxa6"><label for="sessions-per-week" class="svelte-79oxa6"><span class="setting-label svelte-79oxa6">Sessions per week</span> <span class="setting-description svelte-79oxa6">Used to estimate review dates. Increase if you review daily, decrease for
              weekly reviews.</span></label> <input id="sessions-per-week" type="number" min="1" max="14" class="svelte-79oxa6"/></div> <div class="setting-item svelte-79oxa6"><label for="max-interval" class="svelte-79oxa6"><span class="setting-label svelte-79oxa6">Max interval (sessions)</span> <span class="setting-description svelte-79oxa6">Caps how long between reviews. Lower keeps notes fresher, higher lets
              well-known ideas rest longer.</span></label> <input id="max-interval" type="number" min="1" max="100" class="svelte-79oxa6"/></div> <div class="setting-item svelte-79oxa6"><label for="min-interval-days" class="svelte-79oxa6"><span class="setting-label svelte-79oxa6">Min interval (days)</span> <span class="setting-description svelte-79oxa6">Prevents seeing the same note too soon. Useful if you do multiple sessions
              per day.</span></label> <input id="min-interval-days" type="number" min="0" max="30" class="svelte-79oxa6"/></div></div>`),eDe=P('<div class="table-content svelte-79oxa6"><div class="filter-bar svelte-79oxa6"><label for="note-filter" class="filter-label svelte-79oxa6">Filter:</label> <input id="note-filter" type="text" class="filter-input svelte-79oxa6" placeholder="Search notes..."/></div> <!></div>'),tDe=P(`<div class="review-stats svelte-79oxa6"><div class="stats-cards svelte-79oxa6"><div class="stat-card session svelte-79oxa6"><div class="stat-value svelte-79oxa6"> </div> <div class="stat-label svelte-79oxa6">Session</div></div> <div class="stat-card today svelte-79oxa6"><div class="stat-value svelte-79oxa6"> </div> <div class="stat-label svelte-79oxa6">Due Now</div></div> <div class="stat-card total svelte-79oxa6"><div class="stat-value svelte-79oxa6"> </div> <div class="stat-label svelte-79oxa6">Active</div></div> <div class="stat-card retired svelte-79oxa6"><div class="stat-value svelte-79oxa6"> </div> <div class="stat-label svelte-79oxa6">Retired</div></div></div> <div class="review-actions svelte-79oxa6"><!> <!> <!></div> <div class="how-it-works-section svelte-79oxa6"><div class="how-it-works-content svelte-79oxa6"><div class="explanation-block svelte-79oxa6"><h4 class="svelte-79oxa6">Deep Engagement Over Time</h4> <p class="svelte-79oxa6">Review mode helps you <strong>deeply engage</strong> with your notes on a recurring
          basis. The goal isn't memorization - it's to actively work with ideas until they become
          part of how you think. Each review challenges you to explain, connect, and apply what
          you've captured.</p></div> <div class="explanation-block svelte-79oxa6"><h4 class="svelte-79oxa6">Rate Your Engagement</h4> <p class="svelte-79oxa6">After each review, reflect on how the session went:</p> <ul class="rating-list svelte-79oxa6"><li class="svelte-79oxa6"><span class="rating-badge need-more svelte-79oxa6">1</span> <strong>Need more time</strong> - This idea needs more work. You'll see it again
            soon.</li> <li class="svelte-79oxa6"><span class="rating-badge productive svelte-79oxa6">2</span> <strong>Productive</strong> - Good engagement. The idea is developing well.</li> <li class="svelte-79oxa6"><span class="rating-badge familiar svelte-79oxa6">3</span> <strong>Already familiar</strong> - You know this well. Less frequent review needed.</li> <li class="svelte-79oxa6"><span class="rating-badge processed svelte-79oxa6">4</span> <strong>Fully processed</strong> - This idea is now part of your thinking. Stop
            reviewing it.</li></ul></div> <div class="explanation-block svelte-79oxa6"><h4 class="svelte-79oxa6">Work at Your Own Pace</h4> <p class="svelte-79oxa6">Sessions are flexible - complete them daily, weekly, or whenever you have time.
          Notes that need more attention appear more frequently. As ideas become
          integrated, they naturally fade from review, making room for new material.</p></div></div></div> <div class="settings-section svelte-79oxa6"><button class="section-toggle svelte-79oxa6"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg> <span class="section-title svelte-79oxa6">Settings</span></button> <!></div> <div class="notes-table-section svelte-79oxa6"><button class="section-toggle svelte-79oxa6"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg> <span class="section-title svelte-79oxa6"> </span></button> <!></div></div>`);function nDe(n,e){lt(e,!0);let t=et(e,"hasSavedSession",3,!1),r=et(e,"nextSessionAvailableAt",3,null),i=et(e,"isOffline",3,!1),s=j(!1),o=j(!1),a=j("");function l(se,V){e.onUpdateConfig({[se]:V})}function c(se){b(a,se,!0),se.trim()&&b(s,!0)}function d(){b(s,!u(s))}var h=tDe(),f=w(h),p=w(f),g=w(p),m=w(g),v=A(p,2),y=w(v),O=w(y),_=A(v,2),x=w(_),k=w(x),S=A(_,2),E=w(S),R=w(E),C=A(f,2),I=w(C);{var D=se=>{var V=WRe();T(se,V)};z(I,se=>{i()&&se(D)})}var Q=A(I,2);{var M=se=>{var V=XRe(),ne=A(w(V),2);ne.__click=function(...ee){e.onResumeSession?.apply(this,ee)},Y(()=>ne.disabled=i()),T(se,V)};z(Q,se=>{t()&&e.onResumeSession&&se(M)})}var N=A(Q,2);{var B=se=>{var V=YRe();V.__click=function(...ee){e.onStartReview?.apply(this,ee)};var ne=w(V);Y(()=>{V.disabled=i(),J(ne,`Start Review (${e.stats.dueThisSession??""})`)}),T(se,V)},H=se=>{var V=Ve(),ne=Ie(V);{var ee=X=>{var ie=GRe();T(X,ie)},U=X=>{var ie=KRe();T(X,ie)};z(ne,X=>{r()?X(ee):X(U,!1)},!0)}T(se,V)};z(N,se=>{e.stats.dueThisSession>0&&!r()?se(B):se(H,!1)})}var F=A(C,4),Z=w(F);Z.__click=()=>b(o,!u(o));var $=w(Z);let W;var G=A(Z,2);{var L=se=>{var V=JRe(),ne=w(V),ee=A(w(ne),2);ee.__change=we=>l("sessionSize",parseInt(we.currentTarget.value));var U=A(ne,2),X=A(w(U),2);X.__change=we=>l("sessionsPerWeek",parseInt(we.currentTarget.value));var ie=A(U,2),ye=A(w(ie),2);ye.__change=we=>l("maxIntervalSessions",parseInt(we.currentTarget.value));var pe=A(ie,2),de=A(w(pe),2);de.__change=we=>l("minIntervalDays",parseInt(we.currentTarget.value)),Y(()=>{Tn(ee,e.config.sessionSize),Tn(X,e.config.sessionsPerWeek),Tn(ye,e.config.maxIntervalSessions),Tn(de,e.config.minIntervalDays)}),T(se,V)};z(G,se=>{u(o)&&se(L)})}var q=A(F,2),ue=w(q);ue.__click=d;var oe=w(ue);let fe;var be=A(oe,2),De=w(be),Le=A(ue,2);{var he=se=>{var V=eDe(),ne=w(V),ee=A(w(ne),2);ee.__input=()=>c(u(a));var U=A(ne,2);ZRe(U,{get onReviewNote(){return e.onReviewNote},get searchQuery(){return u(a)},get isOffline(){return i()}}),Un(ee,()=>u(a),X=>b(a,X)),T(se,V)};z(Le,se=>{u(s)&&se(he)})}Y(se=>{J(m,se),J(O,r()?0:e.stats.dueThisSession),J(k,e.stats.totalEnabled),J(R,e.stats.retired),W=Ue($,0,"toggle-icon svelte-79oxa6",null,W,{expanded:u(o)}),fe=Ue(oe,0,"toggle-icon svelte-79oxa6",null,fe,{expanded:u(s)}),J(De,`All Review Notes (${e.stats.totalEnabled??""})`)},[()=>UK(e.stats.currentSessionNumber)]),T(n,h),ct()}yt(["click","change","input"]);var rDe=P('<button class="clear-filters svelte-1d3iiks">Clear Filters</button>'),iDe=P('<p class="svelte-1d3iiks">No review history yet</p> <p class="hint svelte-1d3iiks">Complete some reviews to see your history here</p>',1),sDe=P('<p class="svelte-1d3iiks">No reviews match your filters</p> <button class="clear-filters-btn svelte-1d3iiks">Clear Filters</button>',1),oDe=P('<div class="empty-state svelte-1d3iiks"><!></div>'),aDe=P('<div class="content-section svelte-1d3iiks"><h4 class="svelte-1d3iiks">Prompt</h4> <div class="content-text svelte-1d3iiks"> </div></div>'),lDe=P('<div class="content-section svelte-1d3iiks"><h4 class="svelte-1d3iiks">Response</h4> <div class="content-text svelte-1d3iiks"> </div></div>'),cDe=P('<div class="content-section svelte-1d3iiks"><h4 class="svelte-1d3iiks">Agent Feedback</h4> <div class="content-text feedback-text svelte-1d3iiks"> </div></div>'),uDe=P('<div class="item-content svelte-1d3iiks"><!> <!> <!></div>'),dDe=P('<div class="history-item svelte-1d3iiks"><div class="item-header svelte-1d3iiks"><button class="note-title svelte-1d3iiks"> </button> <div class="item-meta svelte-1d3iiks"><span> </span> <span class="timestamp svelte-1d3iiks"> </span></div></div> <!></div>'),hDe=P('<div class="history-list svelte-1d3iiks"><div class="list-header svelte-1d3iiks"><span class="count svelte-1d3iiks"> </span></div> <!></div>'),fDe=P('<div class="review-history-view svelte-1d3iiks"><div class="history-header svelte-1d3iiks"><h2 class="svelte-1d3iiks">Review History</h2> <p class="subtitle svelte-1d3iiks">All your past review attempts across all notes</p></div> <div class="filters svelte-1d3iiks"><input type="text" class="filter-input svelte-1d3iiks" placeholder="Filter by note title..."/> <div class="filter-buttons svelte-1d3iiks"><button>All</button> <button>Passed</button> <button>Failed</button></div> <!></div> <!></div>');function pDe(n,e){lt(e,!0);let t=j(""),r=j("all");const i=le(DJ),s=le(()=>{if(!u(i)||u(i).length===0)return[];let R=u(i);if(u(t).trim()){const C=u(t).toLowerCase();R=R.filter(I=>I.noteTitle.toLowerCase().includes(C))}return u(r)==="passed"?R=R.filter(C=>C.entry.rating>=2):u(r)==="failed"&&(R=R.filter(C=>C.entry.rating<2)),[...R].sort((C,I)=>new Date(I.entry.date).getTime()-new Date(C.entry.date).getTime())});function o(R){const C=new Date(R),I=new Date,D=I.getTime()-C.getTime(),Q=Math.floor(D/(1e3*60*60*24));return Q===0?"Today "+C.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):Q===1?"Yesterday "+C.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):Q<7?`${Q} days ago`:C.toLocaleDateString("en-US",{month:"short",day:"numeric",year:C.getFullYear()!==I.getFullYear()?"numeric":void 0})}function a(R,C){fb(R,C)}function l(){b(t,""),b(r,"all")}var c=fDe(),d=A(w(c),2),h=w(d),f=A(h,2),p=w(f);let g;p.__click=()=>b(r,"all");var m=A(p,2);let v;m.__click=()=>b(r,"passed");var y=A(m,2);let O;y.__click=()=>b(r,"failed");var _=A(f,2);{var x=R=>{var C=rDe();C.__click=l,T(R,C)};z(_,R=>{(u(t)||u(r)!=="all")&&R(x)})}var k=A(d,2);{var S=R=>{var C=oDe(),I=w(C);{var D=M=>{var N=iDe();T(M,N)},Q=M=>{var N=sDe(),B=A(Ie(N),2);B.__click=l,T(M,N)};z(I,M=>{u(i).length===0?M(D):M(Q,!1)})}T(R,C)},E=R=>{var C=hDe(),I=w(C),D=w(I),Q=w(D),M=A(I,2);Tt(M,17,()=>u(s),N=>`${N.noteId}-${N.entry.date}`,(N,B)=>{var H=dDe(),F=w(H),Z=w(F);Z.__click=()=>a(u(B).noteId,u(B).noteTitle);var $=w(Z),W=A(Z,2),G=w(W);let L;var q=w(G),ue=A(G,2),oe=w(ue),fe=A(F,2);{var be=De=>{var Le=uDe(),he=w(Le);{var se=X=>{var ie=aDe(),ye=A(w(ie),2),pe=w(ye);Y(()=>J(pe,u(B).entry.prompt)),T(X,ie)};z(he,X=>{u(B).entry.prompt&&X(se)})}var V=A(he,2);{var ne=X=>{var ie=lDe(),ye=A(w(ie),2),pe=w(ye);Y(()=>J(pe,u(B).entry.response)),T(X,ie)};z(V,X=>{u(B).entry.response&&X(ne)})}var ee=A(V,2);{var U=X=>{var ie=cDe(),ye=A(w(ie),2),pe=w(ye);Y(()=>J(pe,u(B).entry.feedback)),T(X,ie)};z(ee,X=>{u(B).entry.feedback&&X(U)})}T(De,Le)};z(fe,De=>{(u(B).entry.prompt||u(B).entry.response||u(B).entry.feedback)&&De(be)})}Y(De=>{J($,u(B).noteTitle),L=Ue(G,1,`badge rating-${u(B).entry.rating??""}`,"svelte-1d3iiks",L,{passed:u(B).entry.rating>=2,failed:u(B).entry.rating<2}),J(q,nu[u(B).entry.rating]),J(oe,De)},[()=>o(u(B).entry.date)]),T(N,H)}),Y(()=>J(Q,`${u(s).length??""} review${u(s).length!==1?"s":""}`)),T(R,C)};z(k,R=>{u(s).length===0?R(S):R(E,!1)})}Y(()=>{g=Ue(p,1,"filter-btn svelte-1d3iiks",null,g,{active:u(r)==="all"}),v=Ue(m,1,"filter-btn passed svelte-1d3iiks",null,v,{active:u(r)==="passed"}),O=Ue(y,1,"filter-btn failed svelte-1d3iiks",null,O,{active:u(r)==="failed"})}),Un(h,()=>u(t),R=>b(t,R)),T(n,c),ct()}yt(["click"]);var gDe=P('<div class="stat-item retired svelte-ylnk0v"><div class="stat-value svelte-ylnk0v"> </div> <div class="stat-label svelte-ylnk0v">Retired</div></div>'),mDe=P('<div class="stat-item secondary svelte-ylnk0v"><div class="stat-value svelte-ylnk0v"> </div> <div class="stat-label svelte-ylnk0v">Skipped</div></div>'),vDe=P('<div><div class="result-header svelte-ylnk0v"><span class="result-rating svelte-ylnk0v"> </span> <span class="result-title svelte-ylnk0v"> </span> <span class="result-label svelte-ylnk0v"> </span></div></div>'),yDe=P('<details class="session-details svelte-ylnk0v"><summary class="svelte-ylnk0v">View Session Details</summary> <div class="results-list svelte-ylnk0v"></div></details>'),bDe=P('<div class="session-summary svelte-ylnk0v"><div class="header svelte-ylnk0v"><h2 class="svelte-ylnk0v">Review Session Complete!</h2> <p class="subtitle svelte-ylnk0v"> </p></div> <div class="stats-grid svelte-ylnk0v"><div class="stat-item svelte-ylnk0v"><div class="stat-value svelte-ylnk0v"> </div> <div class="stat-label svelte-ylnk0v">Notes Reviewed</div></div> <div class="stat-item need-more svelte-ylnk0v"><div class="stat-value svelte-ylnk0v"> </div> <div class="stat-label svelte-ylnk0v">Need More Time</div></div> <div class="stat-item productive svelte-ylnk0v"><div class="stat-value svelte-ylnk0v"> </div> <div class="stat-label svelte-ylnk0v">Productive</div></div> <div class="stat-item familiar svelte-ylnk0v"><div class="stat-value svelte-ylnk0v"> </div> <div class="stat-label svelte-ylnk0v">Already Familiar</div></div> <!> <div class="stat-item svelte-ylnk0v"><div class="stat-value svelte-ylnk0v"> </div> <div class="stat-label svelte-ylnk0v">Minutes</div></div> <!></div> <div class="actions svelte-ylnk0v"><button class="back-btn svelte-ylnk0v">Back to Dashboard</button></div> <!></div>');function wDe(n,e){lt(e,!0);var t=bDe(),r=w(t),i=A(w(r),2),s=w(i),o=A(r,2),a=w(o),l=w(a),c=w(l),d=A(a,2),h=w(d),f=w(h),p=A(d,2),g=w(p),m=w(g),v=A(p,2),y=w(v),O=w(y),_=A(v,2);{var x=N=>{var B=gDe(),H=w(B),F=w(H);Y(()=>J(F,e.summary.ratingCounts[4])),T(N,B)};z(_,N=>{e.summary.ratingCounts[4]>0&&N(x)})}var k=A(_,2),S=w(k),E=w(S),R=A(k,2);{var C=N=>{var B=mDe(),H=w(B),F=w(H);Y(()=>J(F,e.summary.skippedCount)),T(N,B)};z(R,N=>{e.summary.skippedCount>0&&N(C)})}var I=A(o,2),D=w(I);D.__click=function(...N){e.onBackToDashboard?.apply(this,N)};var Q=A(I,2);{var M=N=>{var B=yDe(),H=A(w(B),2);Tt(H,21,()=>e.summary.results,F=>F.noteId,(F,Z)=>{var $=vDe(),W=w($),G=w(W),L=w(G),q=A(G,2),ue=w(q),oe=A(q,2),fe=w(oe);Y(()=>{Ue($,1,`result-item rating-${u(Z).rating??""}`,"svelte-ylnk0v"),J(L,u(Z).rating),J(ue,u(Z).noteTitle),J(fe,nu[u(Z).rating])}),T(F,$)}),T(N,B)};z(Q,N=>{e.summary.results.length>0&&N(M)})}Y(()=>{J(s,`Session #${e.summary.sessionNumber??""} finished`),J(c,e.summary.totalNotes),J(f,e.summary.ratingCounts[1]),J(m,e.summary.ratingCounts[2]),J(O,e.summary.ratingCounts[3]),J(E,e.summary.durationMinutes)}),T(n,t),ct()}yt(["click"]);var _De=P('<div class="drawer-overlay svelte-1q68dkv"><div class="drawer svelte-1q68dkv"><div class="drawer-header svelte-1q68dkv"><h3 class="svelte-1q68dkv"> </h3> <button class="close-btn svelte-1q68dkv" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div> <div class="drawer-content svelte-1q68dkv"><!></div></div></div>');function ODe(n,e){lt(e,!0);function t(o){o.key==="Escape"&&e.isOpen&&e.onClose()}tt(()=>(e.isOpen&&(window.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{window.removeEventListener("keydown",t),document.body.style.overflow=""}));var r=Ve(),i=Ie(r);{var s=o=>{var a=_De();a.__click=function(...m){e.onClose?.apply(this,m)};var l=w(a);l.__click=m=>m.stopPropagation();var c=w(l),d=w(c),h=w(d),f=A(d,2);f.__click=function(...m){e.onClose?.apply(this,m)};var p=A(c,2),g=w(p);Wh(g,{get text(){return e.noteContent}}),Y(()=>J(h,e.noteTitle)),T(o,a)};z(i,o=>{e.isOpen&&o(s)})}T(n,r),ct()}yt(["click"]);var xDe=P('<div class="tab-nav svelte-13lrafm"><button>Dashboard</button> <button>History</button></div> <!>',1),kDe=P('<div class="review-loading-container svelte-13lrafm"><div class="loading-header svelte-13lrafm"><h2 class="svelte-13lrafm"> </h2> <div class="progress svelte-13lrafm"> </div></div> <div class="loading-content-area svelte-13lrafm"><div class="challenge-loading-box svelte-13lrafm"><div class="challenge-label svelte-13lrafm">Review Challenge:</div> <div class="generating-message svelte-13lrafm"><span class="svelte-13lrafm">Generating review</span> <div class="loading-dots svelte-13lrafm"><span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span></div></div></div></div></div>'),SDe=P('<div class="loading-container svelte-13lrafm"><div class="loading-spinner svelte-13lrafm"></div> <p class="svelte-13lrafm">Loading your notes...</p></div>'),TDe=P('<div class="transition-container svelte-13lrafm"><div class="progress-bar svelte-13lrafm"><div class="progress-fill svelte-13lrafm"></div></div> <p class="svelte-13lrafm"> </p></div>'),ADe=P('<div class="review-header svelte-13lrafm"><h2 class="svelte-13lrafm"> </h2> <div class="progress svelte-13lrafm"> </div></div>'),CDe=P('<span class="svelte-13lrafm">Generating</span> <div class="loading-dots svelte-13lrafm"><span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span></div>',1),EDe=P('<button class="regenerate-btn svelte-13lrafm" aria-label="Regenerate challenge"><!></button>'),PDe=P('<span class="streaming-cursor svelte-13lrafm"></span>'),IDe=P("<!> <!>",1),MDe=P('<div class="loading-message svelte-13lrafm"><div class="loading-dots svelte-13lrafm"><span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span></div></div>'),RDe=P('<span class="streaming-cursor svelte-13lrafm"></span>'),DDe=P("<!> <!>",1),NDe=P('<div class="loading-message svelte-13lrafm"><div class="loading-dots svelte-13lrafm"><span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span></div></div>'),LDe=P('<div><div class="feedback-label svelte-13lrafm">Feedback:</div> <div class="feedback-content svelte-13lrafm"><!></div></div>'),QDe=P('<div class="response-editor svelte-13lrafm"><div class="editor-label svelte-13lrafm">Your Response:</div> <div class="editor-wrapper svelte-13lrafm"><textarea class="review-textarea svelte-13lrafm" placeholder="Type your explanation here..."></textarea></div></div>'),$De=P('<div class="history-content svelte-13lrafm"><!></div>'),FDe=P('<div class="review-history-section svelte-13lrafm"><button class="history-toggle svelte-13lrafm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9" class="svelte-13lrafm"></polyline></svg> <span class="svelte-13lrafm"> </span></button> <!></div>'),zDe=P('<div class="feedback-loading svelte-13lrafm"><div class="generating-message svelte-13lrafm"><span class="svelte-13lrafm">Generating feedback</span> <div class="loading-dots svelte-13lrafm"><span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span> <span class="dot svelte-13lrafm"></span></div></div></div>'),BDe=P('<div class="messages-container svelte-13lrafm"><div><div class="challenge-header svelte-13lrafm"><div class="challenge-label svelte-13lrafm">Review Challenge:</div> <!></div> <div><!></div></div> <!> <!> <!> <!> <!></div>'),UDe=P(`<div class="offline-banner svelte-13lrafm"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-13lrafm"><line x1="1" y1="1" x2="23" y2="23" class="svelte-13lrafm"></line><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55" class="svelte-13lrafm"></path><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39" class="svelte-13lrafm"></path><path d="M10.71 5.05A16 16 0 0 1 22.58 9" class="svelte-13lrafm"></path><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88" class="svelte-13lrafm"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0" class="svelte-13lrafm"></path><line x1="12" y1="20" x2="12.01" y2="20" class="svelte-13lrafm"></line></svg> <span class="svelte-13lrafm">You're offline - AI features unavailable</span></div>`),jDe=P('<div class="recovering-banner svelte-13lrafm"><div class="spinner-small svelte-13lrafm"></div> <span class="svelte-13lrafm">Reconnecting...</span></div>'),VDe=P(`<div class="review-controls svelte-13lrafm"><!> <div class="response-hint svelte-13lrafm">Tip: Press Cmd/Ctrl+Enter to submit Â· Escape to end session Â· Use
                  [[wikilinks]] to link notes</div> <div class="actions svelte-13lrafm"><div class="secondary-actions svelte-13lrafm"><button class="action-btn secondary svelte-13lrafm">Show Note Content</button> <button class="action-btn secondary svelte-13lrafm">Skip</button> <button class="action-btn secondary svelte-13lrafm">End Session</button></div> <button class="action-btn primary svelte-13lrafm"> </button></div></div>`),qDe=P('<div class="feedback-controls svelte-13lrafm"><div class="rating-section svelte-13lrafm"><div class="rating-prompt svelte-13lrafm">How was this review session?</div> <div class="rating-buttons svelte-13lrafm"><button class="rating-btn need-more-btn svelte-13lrafm" title="Press 1"><span class="key-hint svelte-13lrafm">1</span> <span class="label svelte-13lrafm"> </span> <span class="schedule svelte-13lrafm"> </span></button> <button class="rating-btn productive-btn svelte-13lrafm" title="Press 2"><span class="key-hint svelte-13lrafm">2</span> <span class="label svelte-13lrafm"> </span> <span class="schedule svelte-13lrafm"> </span></button> <button class="rating-btn familiar-btn svelte-13lrafm" title="Press 3"><span class="key-hint svelte-13lrafm">3</span> <span class="label svelte-13lrafm"> </span> <span class="schedule svelte-13lrafm"> </span></button> <button class="rating-btn processed-btn svelte-13lrafm" title="Press 4"><span class="key-hint svelte-13lrafm">4</span> <span class="label svelte-13lrafm"> </span> <span class="schedule svelte-13lrafm"> </span></button></div> <div class="keyboard-hint svelte-13lrafm">Press 1-4 to rate</div></div></div>'),HDe=P('<div class="review-conversation svelte-13lrafm"><!></div>'),ZDe=P('<div class="review-view svelte-13lrafm"><!> <!></div>');function WDe(n,e){lt(e,!0);let t=j("idle"),r=j("dashboard"),i=j(null),s=j(0),o=j(""),a=j(""),l=j(null),c=j(""),d=j(!1),h=j(!1),f=j(!1),p=j(!1),g=j(!1),m=j(null);const v=le(Q5),y=le(pb),O=le(il),_=le(wf),x=le(MJ),k=le(()=>u(O)?.noteIds.length??0),S=le(()=>u(O)?.currentIndex??0);tt(()=>{(async()=>{try{const V=await window.api?.getChatServerPort();V&&b(m,Nxe(V),!0)}catch(V){console.error("Failed to initialize review service:",V)}})()}),tt(()=>{VU()});const E=le(()=>!qU()),R=le(HU);tt(()=>{if(ZC()&&u(t)==="idle"){const se=il();se&&(b(i,new Date(se.startedAt),!0),b(o,se.currentPrompt??"",!0),b(a,se.userResponse??"",!0),b(l,se.agentFeedback??null,!0),b(t,se.state,!0))}});function C(se){u(t)==="prompting"?(se.metaKey||se.ctrlKey)&&se.key==="Enter"?(se.preventDefault(),!u(f)&&u(a).trim()&&H()):se.key==="Escape"&&(se.preventDefault(),$()):u(t)==="feedback"&&!u(p)&&se.key>="1"&&se.key<="4"&&(se.preventDefault(),F(parseInt(se.key)))}tt(()=>(window.addEventListener("keydown",C),()=>{window.removeEventListener("keydown",C)}));function I(se,V){fb(se,"")}async function D(){try{b(t,"loading"),b(i,new Date,!0),b(s,0);const se=RJ();if(se.length===0){b(t,"idle");return}const V=se.map(ne=>ne.id);WC(V),await N()}catch(se){console.error("Failed to start review session:",se),b(t,"idle")}}async function Q(se){try{b(t,"loading"),b(i,new Date,!0),b(s,0),WC([se]),await N()}catch(V){console.error("Failed to start single note review:",V),b(t,"idle")}}function M(){const se=il();se&&(b(i,new Date(se.startedAt),!0),b(o,se.currentPrompt??"",!0),b(a,se.userResponse??"",!0),b(l,se.agentFeedback??null,!0),b(t,se.state,!0))}async function N(){const se=wf();if(!se){await W();return}try{b(h,!0),b(g,!1),b(o,""),b(a,""),b(l,null),b(c,await ns(se.id),!0),b(t,"prompting"),u(m)?await u(m).generatePrompt(se.title,u(c),V=>{b(o,V,!0)}):b(o,"Explain the main concepts in this note in your own words."),bf({currentPrompt:u(o),userResponse:"",agentFeedback:void 0,state:"prompting"})}catch(V){console.error("Error generating prompt:",V),b(o,"Explain the main concepts in this note in your own words."),b(t,"prompting")}finally{b(h,!1)}}async function B(){const se=wf();if(!(!se||!u(m)))try{b(h,!0),b(o,""),await u(m).generatePrompt(se.title,u(c),V=>{b(o,V,!0)}),bf({currentPrompt:u(o)})}catch(V){console.error("Error regenerating prompt:",V)}finally{b(h,!1)}}async function H(){const se=wf();if(!(!u(a).trim()||!se))try{b(f,!0),bf({userResponse:u(a)}),b(l,""),b(t,"feedback"),u(m)?await u(m).analyzeResponse(se.title,u(c),u(o),u(a),V=>{b(l,V,!0)}):b(l,"Thank you for your response."),bf({agentFeedback:u(l),state:"feedback"})}catch(V){console.error("Error analyzing response:",V),b(l,"Thank you for your response."),b(t,"feedback")}finally{b(f,!1)}}async function F(se){const V=wf();if(V)try{b(p,!0),NJ(V.id,se,u(o),u(a),u(l)??""),b(t,"transition"),setTimeout(()=>{N()},300)}catch(ne){console.error("Error completing review:",ne)}finally{b(p,!1)}}function Z(){_9(s);const se=il();se&&bf({currentIndex:se.currentIndex+1}),N()}async function $(){const se=il();se&&se.results.length>0?await W():await G()}async function W(){const se=il();se&&se.currentIndex>=se.noteIds.length&&IJ(),LJ(),b(t,"complete")}async function G(){QJ(),b(t,"idle"),b(i,null),b(o,""),b(a,""),b(l,null),b(s,0)}function L(){b(d,!u(d))}function q(se){PJ(se)}const ue=le(()=>{const V=il()?.results??[],ne={1:0,2:0,3:0,4:0};for(const ee of V)ne[ee.rating]++;return{totalNotes:V.length,ratingCounts:ne,skippedCount:u(s),durationMinutes:u(i)?Math.round((Date.now()-u(i).getTime())/6e4):0,results:V,sessionNumber:u(v).currentSessionNumber}});var oe=ZDe(),fe=w(oe);{var be=se=>{var V=xDe(),ne=Ie(V),ee=w(ne);let U;ee.__click=()=>b(r,"dashboard");var X=A(ee,2);let ie;X.__click=()=>b(r,"history");var ye=A(ne,2);{var pe=we=>{{let me=le(ZC);nDe(we,{get stats(){return u(v)},get config(){return u(y)},onStartReview:D,onResumeSession:M,onReviewNote:Q,onUpdateConfig:q,get hasSavedSession(){return u(me)},get nextSessionAvailableAt(){return u(x)},get isOffline(){return u(E)}})}},de=we=>{var me=Ve(),Ee=Ie(me);{var _e=Ae=>{pDe(Ae,{})};z(Ee,Ae=>{u(r)==="history"&&Ae(_e)},!0)}T(we,me)};z(ye,we=>{u(r)==="dashboard"?we(pe):we(de,!1)})}Y(()=>{U=Ue(ee,1,"tab-btn svelte-13lrafm",null,U,{active:u(r)==="dashboard"}),ie=Ue(X,1,"tab-btn svelte-13lrafm",null,ie,{active:u(r)==="history"})}),T(se,V)},De=se=>{var V=Ve(),ne=Ie(V);{var ee=X=>{var ie=Ve(),ye=Ie(ie);{var pe=we=>{var me=kDe(),Ee=w(me),_e=w(Ee),Ae=w(_e),ze=A(_e,2),Be=w(ze);Y(()=>{J(Ae,`Reviewing: ${u(_).title??""}`),J(Be,`Note ${u(S)+1} of ${u(k)??""}`)}),T(we,me)},de=we=>{var me=SDe();T(we,me)};z(ye,we=>{u(h)&&u(_)?we(pe):we(de,!1)})}T(X,ie)},U=X=>{var ie=Ve(),ye=Ie(ie);{var pe=we=>{var me=TDe(),Ee=w(me),_e=w(Ee),Ae=A(Ee,2),ze=w(Ae);Y(()=>{gn(_e,`width: ${u(S)/u(k)*100}%`),J(ze,`Note ${u(S)??""} of ${u(k)??""}`)}),T(we,me)},de=we=>{var me=Ve(),Ee=Ie(me);{var _e=ze=>{var Be=Ve(),Se=Ie(Be);{var Re=He=>{var Me=HDe(),Pe=w(Me);ZU(Pe,{header:ve=>{var Te=ADe(),Ne=w(Te),ce=w(Ne),Oe=A(Ne,2),Qe=w(Oe);Y(()=>{J(ce,`Reviewing: ${u(_).title??""}`),J(Qe,`Note ${u(S)+1} of ${u(k)??""}`)}),T(ve,Te)},content:ve=>{var Te=BDe(),Ne=w(Te);let ce;var Oe=w(Ne),Qe=A(w(Oe),2);{var We=Et=>{var $t=EDe();$t.__click=B;var jt=w($t);{var Kt=Nt=>{var Yt=CDe();T(Nt,Yt)},Zt=Nt=>{var Yt=Tr("Regenerate");T(Nt,Yt)};z(jt,Nt=>{u(h)?Nt(Kt):Nt(Zt,!1)})}Y(()=>{$t.disabled=u(h)||u(f)||u(E),Pt($t,"title",u(E)?"Offline - cannot regenerate":"Generate a new challenge for this note")}),T(Et,$t)};z(Qe,Et=>{u(t)==="prompting"&&Et(We)})}var st=A(Oe,2);let it;var Ct=w(st);{var bt=Et=>{var $t=IDe(),jt=Ie($t);Wh(jt,{get text(){return u(o)}});var Kt=A(jt,2);{var Zt=Nt=>{var Yt=PDe();T(Nt,Yt)};z(Kt,Nt=>{u(h)&&Nt(Zt)})}T(Et,$t)},xt=Et=>{var $t=Ve(),jt=Ie($t);{var Kt=Zt=>{var Nt=MDe();T(Zt,Nt)};z(jt,Zt=>{u(h)&&Zt(Kt)},!0)}T(Et,$t)};z(Ct,Et=>{u(o)?Et(bt):Et(xt,!1)})}var mt=A(Ne,2);{var Ge=Et=>{Ak(Et,{get content(){return u(a)},role:"user",label:"Your Response:",variant:"section",noAnimation:!0,onNoteClick:I})};z(mt,Et=>{u(t)==="feedback"&&u(a).trim()&&Et(Ge)})}var Xe=A(mt,2);{var ft=Et=>{var $t=LDe();let jt;var Kt=A(w($t),2),Zt=w(Kt);{var Nt=ln=>{var Je=DDe(),ge=Ie(Je);Wh(ge,{get text(){return u(l)}});var Ze=A(ge,2);{var ht=Jt=>{var mn=RDe();T(Jt,mn)};z(Ze,Jt=>{u(f)&&Jt(ht)})}T(ln,Je)},Yt=ln=>{var Je=Ve(),ge=Ie(Je);{var Ze=ht=>{var Jt=NDe();T(ht,Jt)};z(ge,ht=>{u(f)&&ht(Ze)},!0)}T(ln,Je)};z(Zt,ln=>{u(l)?ln(Nt):ln(Yt,!1)})}Y(()=>jt=Ue($t,1,"feedback-section svelte-13lrafm",null,jt,{streaming:u(f)})),T(Et,$t)};z(Xe,Et=>{u(t)==="feedback"&&Et(ft)})}var at=A(Xe,2);{var pt=Et=>{var $t=QDe(),jt=A(w($t),2),Kt=w(jt);Un(Kt,()=>u(a),Zt=>b(a,Zt)),T(Et,$t)};z(at,Et=>{u(t)==="prompting"&&!u(f)&&Et(pt)})}var dt=A(at,2);{var _t=Et=>{var $t=FDe(),jt=w($t);jt.__click=()=>b(g,!u(g));var Kt=w(jt);let Zt;var Nt=A(Kt,2),Yt=w(Nt),ln=A(jt,2);{var Je=ge=>{var Ze=$De(),ht=w(Ze);YU(ht,{get history(){return u(_).review.reviewHistory},compact:!0}),T(ge,Ze)};z(ln,ge=>{u(g)&&ge(Je)})}Y(()=>{Pt(jt,"aria-expanded",u(g)),Zt=Ue(Kt,0,"expand-icon svelte-13lrafm",null,Zt,{expanded:u(g)}),J(Yt,`Previous Attempts (${u(_).review.reviewHistory.length??""})`)}),T(Et,$t)};z(dt,Et=>{u(_).review?.reviewHistory&&u(_).review.reviewHistory.length>0&&u(t)==="prompting"&&!u(f)&&Et(_t)})}var wt=A(dt,2);{var Rt=Et=>{var $t=zDe();T(Et,$t)};z(wt,Et=>{u(f)&&Et(Rt)})}Y(()=>{ce=Ue(Ne,1,"challenge-section svelte-13lrafm",null,ce,{collapsed:u(t)==="feedback"}),it=Ue(st,1,"challenge-content svelte-13lrafm",null,it,{streaming:u(h)})}),T(ve,Te)},controls:ve=>{var Te=Ve(),Ne=Ie(Te);{var ce=Qe=>{var We=VDe(),st=w(We);{var it=pt=>{var dt=UDe();T(pt,dt)},Ct=pt=>{var dt=Ve(),_t=Ie(dt);{var wt=Rt=>{var Et=jDe();T(Rt,Et)};z(_t,Rt=>{u(R)&&Rt(wt)},!0)}T(pt,dt)};z(st,pt=>{u(E)?pt(it):pt(Ct,!1)})}var bt=A(st,4),xt=w(bt),mt=w(xt);mt.__click=L;var Ge=A(mt,2);Ge.__click=Z;var Xe=A(Ge,2);Xe.__click=$;var ft=A(xt,2);ft.__click=H;var at=w(ft);Y(pt=>{mt.disabled=u(f),Ge.disabled=u(f),Xe.disabled=u(f),ft.disabled=pt,J(at,u(f)?"Submitting...":"Submit Response")},[()=>u(f)||!u(a).trim()||u(E)]),T(Qe,We)},Oe=Qe=>{var We=Ve(),st=Ie(We);{var it=Ct=>{var bt=qDe(),xt=w(bt),mt=A(w(xt),2),Ge=w(mt);Ge.__click=()=>F(1);var Xe=A(w(Ge),2),ft=w(Xe),at=A(Xe,2),pt=w(at),dt=A(Ge,2);dt.__click=()=>F(2);var _t=A(w(dt),2),wt=w(_t),Rt=A(_t,2),Et=w(Rt),$t=A(dt,2);$t.__click=()=>F(3);var jt=A(w($t),2),Kt=w(jt),Zt=A(jt,2),Nt=w(Zt),Yt=A($t,2);Yt.__click=()=>F(4);var ln=A(w(Yt),2),Je=w(ln),ge=A(ln,2),Ze=w(ge);Y(()=>{Ge.disabled=u(p),J(ft,nu[1]),J(pt,zm[1]),dt.disabled=u(p),J(wt,nu[2]),J(Et,zm[2]),$t.disabled=u(p),J(Kt,nu[3]),J(Nt,zm[3]),Yt.disabled=u(p),J(Je,nu[4]),J(Ze,zm[4])}),T(Ct,bt)};z(st,Ct=>{u(t)==="feedback"&&Ct(it)},!0)}T(Qe,We)};z(Ne,Qe=>{u(t)==="prompting"?Qe(ce):Qe(Oe,!1)})}T(ve,Te)},$$slots:{header:!0,content:!0,controls:!0}}),T(He,Me)};z(Se,He=>{u(_)&&He(Re)})}T(ze,Be)},Ae=ze=>{var Be=Ve(),Se=Ie(Be);{var Re=He=>{wDe(He,{get summary(){return u(ue)},onBackToDashboard:G})};z(Se,He=>{u(t)==="complete"&&He(Re)},!0)}T(ze,Be)};z(Ee,ze=>{u(t)==="prompting"||u(t)==="feedback"?ze(_e):ze(Ae,!1)},!0)}T(we,me)};z(ye,we=>{u(t)==="transition"?we(pe):we(de,!1)},!0)}T(X,ie)};z(ne,X=>{u(t)==="loading"?X(ee):X(U,!1)},!0)}T(se,V)};z(fe,se=>{u(t)==="idle"?se(be):se(De,!1)})}var Le=A(fe,2);{var he=se=>{ODe(se,{get isOpen(){return u(d)},get noteTitle(){return u(_).title},get noteContent(){return u(c)},onClose:L})};z(Le,se=>{u(_)&&se(he)})}T(n,oe),ct()}yt(["click"]);var XDe=P('<div class="review-view-web svelte-g2hmi8"><!></div>');function YDe(n,e){lt(e,!1),b3();var t=Ve(),r=Ie(t);{var i=o=>{var a=XDe(),l=w(a);XU(l,{title:"Review Mode",description:"Use spaced repetition to remember what you learn with AI-generated prompts.",icon:"review"}),T(o,a)},s=o=>{WDe(o,{})};z(r,o=>{cc()?o(i):o(s,!1)})}T(n,t),ct()}var GDe=P('<button class="action-button svelte-c4w0as" title="Mark all as unprocessed"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg> All</button>'),KDe=P('<button class="action-button svelte-c4w0as" title="Mark all as processed"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> All</button>'),JDe=P('<button class="check-button svelte-c4w0as" title="Move back to unprocessed" aria-label="Move note back to unprocessed"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg></button>'),e3e=P('<button class="check-button svelte-c4w0as" title="Mark as processed" aria-label="Mark note as processed"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg></button>'),t3e=P('<span class="type-icon svelte-c4w0as"> </span>'),n3e=P('<div class="note-card svelte-c4w0as"><div class="note-header svelte-c4w0as"><button class="note-title svelte-c4w0as" title="Open note"> </button> <div class="note-actions svelte-c4w0as"><button class="menu-button svelte-c4w0as" title="More options" aria-label="More options"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="12" cy="19" r="2"></circle></svg></button> <!></div></div> <div class="note-meta svelte-c4w0as"><span class="meta-date svelte-c4w0as"> </span> <!> <span class="type-name svelte-c4w0as"> </span></div></div>'),r3e=P('<div class="notes-list svelte-c4w0as"></div>'),i3e=P('<div class="empty-state svelte-c4w0as"><p class="svelte-c4w0as"> </p> <p class="empty-hint svelte-c4w0as"> </p></div>'),s3e=P('<button class="context-menu-item svelte-c4w0as" role="menuitem"><span class="workspace-icon svelte-c4w0as"> </span> <span class="menu-item-label svelte-c4w0as"> </span></button>'),o3e=P('<div role="menu"></div>'),a3e=P('<div class="context-menu-item submenu-trigger svelte-c4w0as" role="menuitem" tabindex="0"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-c4w0as"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg> <span class="menu-item-label svelte-c4w0as">Open in Workspace</span> <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="submenu-arrow svelte-c4w0as"><polyline points="9 18 15 12 9 6"></polyline></svg> <!></div>'),l3e=P('<div class="context-menu svelte-c4w0as" role="menu"><button class="context-menu-item svelte-c4w0as" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-c4w0as"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg> <span class="menu-item-label svelte-c4w0as">Open in Shelf</span> <span class="menu-item-shortcut svelte-c4w0as">Shift+Click</span></button> <!> <button class="context-menu-item svelte-c4w0as" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-c4w0as"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> </button> <button class="context-menu-item svelte-c4w0as" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-c4w0as"><polyline points="21 8 21 21 3 21 3 8"></polyline><rect x="1" y="3" width="22" height="5"></rect><line x1="10" y1="12" x2="14" y2="12"></line></svg> Archive</button></div>'),c3e=P('<div class="inbox-view svelte-c4w0as"><div class="inbox-header svelte-c4w0as"><h2 class="svelte-c4w0as">Inbox</h2> <div class="header-actions svelte-c4w0as"><!> <button class="toggle-button svelte-c4w0as" title="Toggle between unprocessed and processed notes"><span><span class="toggle-icon svelte-c4w0as"><svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="8"></circle></svg></span> Unprocessed</span> <span class="toggle-separator svelte-c4w0as">|</span> <span><span class="toggle-icon svelte-c4w0as"><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg></span> Processed</span></button></div></div> <div class="inbox-content svelte-c4w0as"><div class="quick-create svelte-c4w0as"><input type="text" class="create-input svelte-c4w0as" placeholder="enter title to create new note..."/></div> <div class="notes-container svelte-c4w0as"><!></div></div></div>  <!>',1);function u3e(n,e){lt(e,!0);let t=j(""),r=j(!1),i=j(!1),s=j(!1),o=j(null),a=j(Qt({x:0,y:0})),l=j(!1),c=j(!1),d=j(!1);const h=le(()=>u(i)?FJ():$5()),f=le(Gp),p=le(yo);function g(pe){const de=new Date(pe),me=new Date().getTime()-de.getTime(),Ee=Math.floor(me/(1e3*60*60*24));if(Ee===0){const _e=Math.floor(me/36e5);if(_e===0){const Ae=Math.floor(me/6e4);return Ae<1?"just now":`${Ae} min ago`}return _e===1?"1 hour ago":`${_e} hours ago`}else{if(Ee===1)return"yesterday";if(Ee<7)return`${Ee} days ago`;if(Ee<30){const _e=Math.floor(Ee/7);return`${_e} week${_e>1?"s":""} ago`}else return de.toLocaleDateString()}}function m(pe){return u(p).find(we=>we.id===pe)?.icon}function v(pe){return u(p).find(we=>we.id===pe)?.name??"Note"}function y(pe){const we=pe.currentTarget.getBoundingClientRect();b(d,we.right+150>window.innerWidth),b(c,!0)}async function O(){if(!(!u(t).trim()||u(r))){b(r,!0);try{zs({title:u(t).trim(),content:""}),b(t,"")}catch(pe){console.error("Failed to create note:",pe)}finally{b(r,!1)}}}function _(pe){pe.key==="Enter"&&(pe.preventDefault(),O())}function x(pe){BJ(pe)}function k(pe){UJ(pe)}function S(){b(i,!u(i))}function E(){const pe=u(h).map(de=>de.id);jJ(pe)}function R(){const pe=u(h).map(de=>de.id);VJ(pe)}function C(pe){cn({type:"note",id:pe}),Dr({type:"note",id:pe}),Fn(null)}function I(pe,de){pe.preventDefault(),b(o,de,!0);const we=Dy(de);b(l,we?.enabled??!1,!0);const me=180,Ee=200,_e=8;let Ae=pe.clientX,ze=pe.clientY;Ae+me+_e>window.innerWidth&&(Ae=window.innerWidth-me-_e),ze+Ee+_e>window.innerHeight&&(ze=window.innerHeight-Ee-_e),Ae=Math.max(_e,Ae),ze=Math.max(_e,ze),b(a,{x:Ae,y:ze},!0),b(s,!0)}function D(pe,de){pe.stopPropagation(),b(o,de,!0);const me=pe.currentTarget.getBoundingClientRect(),Ee=Dy(de);b(l,Ee?.enabled??!1,!0);const _e=180,Ae=200,ze=8;let Be=me.right,Se=me.top;Be+_e+ze>window.innerWidth&&(Be=me.left-_e),Se+Ae+ze>window.innerHeight&&(Se=window.innerHeight-Ae-ze),Be=Math.max(ze,Be),Se=Math.max(ze,Se),b(a,{x:Be,y:Se},!0),b(s,!0)}function Q(){b(s,!1),b(o,null),b(c,!1)}function M(pe){u(s)&&(pe.target.closest(".context-menu")||Q())}function N(pe){pe.key==="Escape"&&u(s)&&Q()}function B(){u(o)&&(uu.addItem("note",u(o)),Q())}function H(){u(o)&&(Ch(u(o)),Q())}function F(){u(o)&&(u(l)?MS(u(o)):IS(u(o)),Q())}function Z(pe){u(o)&&(Ry(pe),cn({type:"note",id:u(o)}),Dr({type:"note",id:u(o)}),Fn(null),Q())}var $=c3e();It("click",Na,M),It("keydown",Na,N);var W=Ie($),G=w(W),L=A(w(G),2),q=w(L);{var ue=pe=>{var de=Ve(),we=Ie(de);{var me=_e=>{var Ae=GDe();Ae.__click=R,T(_e,Ae)},Ee=_e=>{var Ae=KDe();Ae.__click=E,T(_e,Ae)};z(we,_e=>{u(i)?_e(me):_e(Ee,!1)})}T(pe,de)};z(q,pe=>{u(h).length>0&&pe(ue)})}var oe=A(q,2);oe.__click=S;var fe=w(oe);let be;var De=A(fe,4);let Le;var he=A(G,2),se=w(he),V=w(se);V.__keydown=_;var ne=A(se,2),ee=w(ne);{var U=pe=>{var de=r3e();Tt(de,21,()=>u(h),we=>we.id,(we,me)=>{var Ee=n3e();Ee.__contextmenu=ce=>I(ce,u(me).id);var _e=w(Ee),Ae=w(_e);Ae.__click=()=>C(u(me).id);var ze=w(Ae),Be=A(Ae,2),Se=w(Be);Se.__click=ce=>D(ce,u(me).id);var Re=A(Se,2);{var He=ce=>{var Oe=JDe();Oe.__click=()=>k(u(me).id),T(ce,Oe)},Me=ce=>{var Oe=e3e();Oe.__click=()=>x(u(me).id),T(ce,Oe)};z(Re,ce=>{u(i)?ce(He):ce(Me,!1)})}var Pe=A(_e,2),ae=w(Pe),te=w(ae),re=A(ae,2);{var ve=ce=>{var Oe=t3e(),Qe=w(Oe);Y(We=>J(Qe,We),[()=>m(u(me).type)]),T(ce,Oe)};z(re,ce=>{m(u(me).type)&&ce(ve)})}var Te=A(re,2),Ne=w(Te);Y((ce,Oe)=>{J(ze,u(me).title||"Untitled"),J(te,ce),J(Ne,Oe)},[()=>g(u(me).created),()=>v(u(me).type)]),T(we,Ee)}),T(pe,de)},X=pe=>{var de=i3e(),we=w(de),me=w(we),Ee=A(we,2),_e=w(Ee);Y(()=>{J(me,u(i)?"No processed notes":"No unprocessed notes"),J(_e,u(i)?"Notes you process will appear here":"Create a note above or notes you create will appear here")}),T(pe,de)};z(ee,pe=>{u(h).length>0?pe(U):pe(X,!1)})}var ie=A(W,2);{var ye=pe=>{var de=l3e(),we=w(de);we.__click=B;var me=A(we,2);{var Ee=Be=>{var Se=a3e(),Re=A(w(Se),6);{var He=Me=>{var Pe=o3e();let ae;Tt(Pe,21,()=>u(f),te=>te.id,(te,re)=>{var ve=s3e();ve.__click=()=>Z(u(re).id);var Te=w(ve),Ne=w(Te),ce=A(Te,2),Oe=w(ce);Y(()=>{J(Ne,u(re).icon),J(Oe,u(re).name)}),T(te,ve)}),Y(()=>ae=Ue(Pe,1,"submenu svelte-c4w0as",null,ae,{"submenu-left":u(d)})),T(Me,Pe)};z(Re,Me=>{u(c)&&Me(He)})}It("mouseenter",Se,y),It("mouseleave",Se,()=>b(c,!1)),T(Be,Se)};z(me,Be=>{u(f).length>0&&Be(Ee)})}var _e=A(me,2);_e.__click=F;var Ae=A(w(_e)),ze=A(_e,2);ze.__click=H,Y(()=>{gn(de,`left: ${u(a).x??""}px; top: ${u(a).y??""}px;`),J(Ae,` ${u(l)?"Disable Review":"Enable Review"}`)}),T(pe,de)};z(ie,pe=>{u(s)&&pe(ye)})}Y(()=>{be=Ue(fe,1,"toggle-option svelte-c4w0as",null,be,{active:!u(i)}),Le=Ue(De,1,"toggle-option svelte-c4w0as",null,Le,{active:u(i)}),V.disabled=u(r)}),Un(V,()=>u(t),pe=>b(t,pe)),T(n,$),ct()}yt(["click","keydown","contextmenu"]);var d3e=P('<div class="routine-modal-overlay svelte-s98jvi" role="dialog" aria-modal="true" aria-labelledby="routine-modal-title" tabindex="-1"><div class="routine-modal-content svelte-s98jvi"><div class="routine-modal-header svelte-s98jvi"><h3 id="routine-modal-title" class="svelte-s98jvi"> </h3> <button class="close-btn svelte-s98jvi" aria-label="Close modal"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 4L12 12M4 12L12 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></button></div> <div class="routine-modal-body svelte-s98jvi"><!></div></div></div>');function h3e(n,e){lt(e,!0);function t(a){a.key==="Escape"&&e.onClose()}function r(a){a.target===a.currentTarget&&e.onClose()}tt(()=>{e.isOpen&&setTimeout(()=>{document.querySelector(".routine-modal-overlay")?.focus()},100)});var i=Ve(),s=Ie(i);{var o=a=>{var l=d3e();l.__click=r,l.__keydown=t;var c=w(l),d=w(c),h=w(d),f=w(h),p=A(h,2);p.__click=function(...v){e.onClose?.apply(this,v)};var g=A(d,2),m=w(g);ic(m,()=>e.children),Y(()=>J(f,e.title)),T(a,l)};z(s,a=>{e.isOpen&&a(o)})}T(n,i),ct()}yt(["click","keydown"]);var f3e=P('<span class="schedule-text svelte-10g88nd"> </span>'),p3e=P('<div role="button" tabindex="0"><div class="card-main svelte-10g88nd"><div class="card-info svelte-10g88nd"><h4 class="routine-name svelte-10g88nd"> </h4> <div class="routine-meta svelte-10g88nd"><span class="due-text svelte-10g88nd"> </span> <!></div></div> <div class="card-actions svelte-10g88nd"><button class="btn-start svelte-10g88nd" title="Start routine"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg> Start</button> <button class="btn-edit svelte-10g88nd" title="Edit routine"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button></div></div></div>');function SD(n,e){lt(e,!0);function t(){e.onClick(e.routine.id)}function r(S){S.stopPropagation(),e.onStart(e.routine.id)}function i(S){S.stopPropagation(),e.onEdit(e.routine.id)}function s(S){(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),e.onClick(e.routine.id))}function o(){if(!e.routine.dueInfo?.dueDate)return e.routine.dueInfo?.recurringSchedule||"";const S=new Date(e.routine.dueInfo.dueDate),E=new Date,R=S.getTime()-E.getTime(),C=Math.ceil(R/(1e3*60*60)),I=Math.ceil(R/(1e3*60*60*24));if(C<0){const D=Math.abs(I),Q=Math.abs(C);return D>=1?`${D}d overdue`:`${Q}h overdue`}return C===0?"Due now":C<24?`In ${C}h`:I===1?"Tomorrow":`In ${I} days`}function a(){return e.routine.isRecurring&&e.routine.dueInfo?.recurringSchedule?e.routine.dueInfo.recurringSchedule:""}var l=p3e();let c;l.__click=t,l.__keydown=s;var d=w(l),h=w(d),f=w(h),p=w(f),g=A(f,2),m=w(g),v=w(m),y=A(m,2);{var O=S=>{var E=f3e(),R=w(E);Y(C=>J(R,C),[a]),T(S,E)};z(y,S=>{a()&&S(O)})}var _=A(h,2),x=w(_);x.__click=r;var k=A(x,2);k.__click=i,Y(S=>{c=Ue(l,1,"dashboard-card svelte-10g88nd",null,c,{"variant-due":e.variant==="due","variant-upcoming":e.variant==="upcoming"}),J(p,e.routine.name),J(v,S)},[o]),T(n,l),ct()}yt(["click","keydown"]);var g3e=P('<div class="empty-state svelte-116uiqi"><p>No routines found</p></div>'),m3e=P('<div class="compact-item svelte-116uiqi" role="button" tabindex="0"><div class="item-content svelte-116uiqi"><span class="item-name svelte-116uiqi"> </span> <span> </span></div> <button class="btn-execute svelte-116uiqi" title="Execute routine"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button></div>'),v3e=P('<div class="compact-list svelte-116uiqi"><!></div>');function y3e(n,e){lt(e,!0);function t(f){e.onSelect(f)}function r(f,p){p.stopPropagation(),e.onExecute(f)}function i(f,p){(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),e.onSelect(f))}function s(f){return f.isRecurring&&f.dueInfo?.recurringSchedule?f.dueInfo.recurringSchedule:f.dueInfo?.dueDate?o(f.dueInfo.dueDate):f.type==="backlog"?"Backlog":"On-demand"}function o(f){const p=new Date(f),g=new Date,m=p.getTime()-g.getTime(),v=Math.ceil(m/(1e3*60*60*24));return v<0?`${Math.abs(v)}d overdue`:v===0?"Today":v===1?"Tomorrow":v<7?`In ${v}d`:p.toLocaleDateString()}function a(f){if(!f.dueInfo)return"";switch(f.dueInfo.type){case"overdue":return"due-overdue";case"due_now":return"due-now";case"upcoming":return"due-upcoming";default:return""}}var l=v3e(),c=w(l);{var d=f=>{var p=g3e();T(f,p)},h=f=>{var p=Ve(),g=Ie(p);Tt(g,17,()=>e.routines,m=>m.id,(m,v)=>{var y=m3e();y.__click=()=>t(u(v).id),y.__keydown=R=>i(u(v).id,R);var O=w(y),_=w(O),x=w(_),k=A(_,2),S=w(k),E=A(O,2);E.__click=R=>r(u(v).id,R),Y((R,C)=>{J(x,u(v).name),Ue(k,1,`item-schedule ${R??""}`,"svelte-116uiqi"),J(S,C)},[()=>a(u(v)),()=>s(u(v))]),T(m,y)}),T(f,p)};z(c,f=>{e.routines.length===0?f(d):f(h,!1)})}T(n,l),ct()}yt(["click","keydown"]);var b3e=P('<div class="error svelte-1lo6hcg"><p> </p></div>'),w3e=P('<span class="badge badge-backlog svelte-1lo6hcg">Backlog</span>'),_3e=P('<span class="info-item svelte-1lo6hcg"><strong class="svelte-1lo6hcg">Day:</strong> </span>'),O3e=P('<span class="info-item svelte-1lo6hcg"><strong class="svelte-1lo6hcg">Day of Month:</strong> </span>'),x3e=P('<span class="info-item svelte-1lo6hcg"><strong class="svelte-1lo6hcg">Time:</strong> </span>'),k3e=P('<div class="detail-section svelte-1lo6hcg"><h4 class="svelte-1lo6hcg">Schedule</h4> <div class="schedule-info svelte-1lo6hcg"><span class="info-item svelte-1lo6hcg"><strong class="svelte-1lo6hcg">Frequency:</strong> </span> <!> <!> <!></div></div>'),S3e=P('<div class="detail-section svelte-1lo6hcg"><h4 class="svelte-1lo6hcg">Due Date</h4> <p> </p></div>'),T3e=P('<div class="detail-section svelte-1lo6hcg"><h4 class="svelte-1lo6hcg">Last Completed</h4> <p> </p></div>'),A3e=P('<span class="material-description svelte-1lo6hcg"> </span>'),C3e=P('<pre class="svelte-1lo6hcg"><code class="svelte-1lo6hcg"> </code></pre>'),E3e=P("<p> </p>"),P3e=P('<div class="material-content svelte-1lo6hcg"><!></div>'),I3e=P('<div class="material-content note-ref svelte-1lo6hcg"><span class="note-icon">ð</span> <span> </span></div>'),M3e=P('<div class="material-item svelte-1lo6hcg"><div class="material-header svelte-1lo6hcg"><span class="material-type svelte-1lo6hcg"> </span> <!></div> <!></div>'),R3e=P('<div class="detail-section svelte-1lo6hcg"><h4 class="svelte-1lo6hcg"> </h4> <div class="materials svelte-1lo6hcg"></div></div>'),D3e=P('<p class="history-notes svelte-1lo6hcg"> </p>'),N3e=P('<span class="history-duration svelte-1lo6hcg"> </span>'),L3e=P('<div class="history-item svelte-1lo6hcg"><span class="history-date svelte-1lo6hcg"> </span> <!> <!></div>'),Q3e=P('<div class="detail-section svelte-1lo6hcg"><h4 class="svelte-1lo6hcg"> </h4> <div class="history svelte-1lo6hcg"></div></div>'),$3e=P('<button class="btn btn-primary svelte-1lo6hcg"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg> Execute</button>'),F3e=P('<button class="btn btn-secondary svelte-1lo6hcg"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> Edit</button>'),z3e=P('<button class="btn btn-danger svelte-1lo6hcg">Confirm Delete</button> <button class="btn btn-secondary svelte-1lo6hcg">Cancel</button>',1),B3e=P('<button class="btn btn-danger-outline svelte-1lo6hcg">Delete</button>'),U3e=P('<div class="detail-content svelte-1lo6hcg"><div class="detail-section svelte-1lo6hcg"><div class="title-row svelte-1lo6hcg"><h3 class="svelte-1lo6hcg"> </h3> <div class="status-badges svelte-1lo6hcg"><span> </span> <!></div></div> <p class="purpose svelte-1lo6hcg"> </p></div> <div class="detail-section svelte-1lo6hcg"><h4 class="svelte-1lo6hcg">Description</h4> <div class="description svelte-1lo6hcg"><!></div></div> <!> <!> <!> <!> <div class="detail-section timestamps svelte-1lo6hcg"><span> </span> <span> </span></div> <div class="detail-actions svelte-1lo6hcg"><!> <!> <!></div></div>'),j3e=P('<div class="routine-detail svelte-1lo6hcg"><!></div>');function V3e(n,e){lt(e,!0);let t=j(!1);const r=le(()=>mo(e.routineId));function i(){u(r)&&e.onEdit?.(u(r))}function s(){e.onExecute?.(e.routineId)}function o(){if(!u(t)){b(t,!0);return}U5(e.routineId),e.onDelete?.(e.routineId),b(t,!1)}function a(){b(t,!1)}function l(m){const v=new Date(m);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(v)}function c(m){return m.materialType==="note_reference"&&m.noteId?Zn(m.noteId)?.title||m.noteId:null}const d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var h=j3e(),f=w(h);{var p=m=>{var v=b3e(),y=w(v),O=w(y);Y(()=>J(O,`Routine not found: ${e.routineId??""}`)),T(m,v)},g=m=>{var v=U3e(),y=w(v),O=w(y),_=w(O),x=w(_),k=A(_,2),S=w(k),E=w(S),R=A(S,2);{var C=X=>{var ie=w3e();T(X,ie)};z(R,X=>{u(r).type==="backlog"&&X(C)})}var I=A(O,2),D=w(I),Q=A(y,2),M=A(w(Q),2),N=w(M);Wh(N,{get text(){return u(r).description}});var B=A(Q,2);{var H=X=>{var ie=k3e(),ye=A(w(ie),2),pe=w(ye),de=A(w(pe)),we=A(pe,2);{var me=Be=>{var Se=_3e(),Re=A(w(Se));Y(()=>J(Re,` ${d[u(r).recurringSpec.dayOfWeek]??""}`)),T(Be,Se)};z(we,Be=>{u(r).recurringSpec.dayOfWeek!==void 0&&Be(me)})}var Ee=A(we,2);{var _e=Be=>{var Se=O3e(),Re=A(w(Se));Y(()=>J(Re,` ${u(r).recurringSpec.dayOfMonth??""}`)),T(Be,Se)};z(Ee,Be=>{u(r).recurringSpec.dayOfMonth&&Be(_e)})}var Ae=A(Ee,2);{var ze=Be=>{var Se=x3e(),Re=A(w(Se));Y(()=>J(Re,` ${u(r).recurringSpec.time??""}`)),T(Be,Se)};z(Ae,Be=>{u(r).recurringSpec.time&&Be(ze)})}Y(()=>J(de,` ${u(r).recurringSpec.frequency??""}`)),T(X,ie)},F=X=>{var ie=Ve(),ye=Ie(ie);{var pe=de=>{var we=S3e(),me=A(w(we),2),Ee=w(me);Y(_e=>J(Ee,_e),[()=>l(u(r).dueDate)]),T(de,we)};z(ye,de=>{u(r).dueDate&&de(pe)},!0)}T(X,ie)};z(B,X=>{u(r).recurringSpec?X(H):X(F,!1)})}var Z=A(B,2);{var $=X=>{var ie=T3e(),ye=A(w(ie),2),pe=w(ye);Y(de=>J(pe,de),[()=>l(u(r).lastCompleted)]),T(X,ie)};z(Z,X=>{u(r).lastCompleted&&X($)})}var W=A(Z,2);{var G=X=>{var ie=R3e(),ye=w(ie),pe=w(ye),de=A(ye,2);Tt(de,21,()=>u(r).supplementaryMaterials,we=>we.id,(we,me)=>{var Ee=M3e(),_e=w(Ee),Ae=w(_e),ze=w(Ae),Be=A(Ae,2);{var Se=Pe=>{var ae=A3e(),te=w(ae);Y(()=>J(te,u(me).metadata.description)),T(Pe,ae)};z(Be,Pe=>{u(me).metadata?.description&&Pe(Se)})}var Re=A(_e,2);{var He=Pe=>{var ae=P3e(),te=w(ae);{var re=Te=>{var Ne=C3e(),ce=w(Ne),Oe=w(ce);Y(()=>J(Oe,u(me).content)),T(Te,Ne)},ve=Te=>{var Ne=E3e(),ce=w(Ne);Y(()=>J(ce,u(me).content)),T(Te,Ne)};z(te,Te=>{u(me).materialType==="code"?Te(re):Te(ve,!1)})}T(Pe,ae)},Me=Pe=>{var ae=Ve(),te=Ie(ae);{var re=ve=>{var Te=I3e(),Ne=A(w(Te),2),ce=w(Ne);Y(Oe=>J(ce,Oe),[()=>c(u(me))]),T(ve,Te)};z(te,ve=>{u(me).materialType==="note_reference"&&ve(re)},!0)}T(Pe,ae)};z(Re,Pe=>{u(me).content?Pe(He):Pe(Me,!1)})}Y(()=>J(ze,u(me).materialType)),T(we,Ee)}),Y(()=>J(pe,`Supplementary Materials (${u(r).supplementaryMaterials.length??""})`)),T(X,ie)};z(W,X=>{u(r).supplementaryMaterials&&u(r).supplementaryMaterials.length>0&&X(G)})}var L=A(W,2);{var q=X=>{var ie=Q3e(),ye=w(ie),pe=w(ye),de=A(ye,2);Tt(de,21,()=>u(r).completionHistory.slice().reverse().slice(0,10),we=>we.id,(we,me)=>{var Ee=L3e(),_e=w(Ee),Ae=w(_e),ze=A(_e,2);{var Be=He=>{var Me=D3e(),Pe=w(Me);Y(()=>J(Pe,u(me).notes)),T(He,Me)};z(ze,He=>{u(me).notes&&He(Be)})}var Se=A(ze,2);{var Re=He=>{var Me=N3e(),Pe=w(Me);Y(ae=>J(Pe,`Duration: ${ae??""}s`),[()=>Math.round(u(me).metadata.durationMs/1e3)]),T(He,Me)};z(Se,He=>{u(me).metadata?.durationMs&&He(Re)})}Y(He=>J(Ae,He),[()=>l(u(me).completedAt)]),T(we,Ee)}),Y(()=>J(pe,`Completion History (${u(r).completionHistory.length??""})`)),T(X,ie)};z(L,X=>{u(r).completionHistory&&u(r).completionHistory.length>0&&X(q)})}var ue=A(L,2),oe=w(ue),fe=w(oe),be=A(oe,2),De=w(be),Le=A(ue,2),he=w(Le);{var se=X=>{var ie=$3e();ie.__click=s,T(X,ie)};z(he,X=>{e.onExecute&&X(se)})}var V=A(he,2);{var ne=X=>{var ie=F3e();ie.__click=i,T(X,ie)};z(V,X=>{e.onEdit&&X(ne)})}var ee=A(V,2);{var U=X=>{var ie=Ve(),ye=Ie(ie);{var pe=we=>{var me=z3e(),Ee=Ie(me);Ee.__click=o;var _e=A(Ee,2);_e.__click=a,T(we,me)},de=we=>{var me=B3e();me.__click=o,T(we,me)};z(ye,we=>{u(t)?we(pe):we(de,!1)})}T(X,ie)};z(ee,X=>{e.onDelete&&X(U)})}Y((X,ie)=>{J(x,u(r).name),Ue(S,1,`badge badge-${u(r).status??""}`,"svelte-1lo6hcg"),J(E,u(r).status),J(D,u(r).purpose),J(fe,`Created: ${X??""}`),J(De,`Updated: ${ie??""}`)},[()=>l(u(r).created),()=>l(u(r).updated)]),T(m,v)};z(f,m=>{u(r)?m(g,!1):m(p)})}T(n,h),ct()}yt(["click"]);var q3e=P('<div class="error-message svelte-85ct2x"> </div>'),H3e=P('<div class="form-group svelte-85ct2x"><label for="status" class="svelte-85ct2x">Status</label> <select id="status" class="svelte-85ct2x"><option>Active</option><option>Paused</option><option>Completed</option></select></div>'),Z3e=P('<div class="form-group svelte-85ct2x"><label for="dueDate" class="svelte-85ct2x">Due Date</label> <input id="dueDate" type="datetime-local" class="svelte-85ct2x"/></div>'),W3e=P("<option> </option>"),X3e=P('<div class="form-group svelte-85ct2x"><label for="dayOfWeek" class="svelte-85ct2x">Day of Week</label> <select id="dayOfWeek" class="svelte-85ct2x"></select></div>'),Y3e=P("<option> </option>"),G3e=P('<div class="form-group svelte-85ct2x"><label for="dayOfMonth" class="svelte-85ct2x">Day of Month</label> <select id="dayOfMonth" class="svelte-85ct2x"></select></div>'),K3e=P('<div class="schedule-config svelte-85ct2x"><div class="form-group svelte-85ct2x"><label for="frequency" class="svelte-85ct2x">Frequency</label> <select id="frequency" class="svelte-85ct2x"><option>Daily</option><option>Weekly</option><option>Monthly</option></select></div> <!> <!> <div class="form-group svelte-85ct2x"><label for="time" class="svelte-85ct2x">Time (optional)</label> <input id="time" type="time" class="svelte-85ct2x"/></div></div>'),J3e=P('<button type="button" class="btn btn-secondary svelte-85ct2x">Cancel</button>'),eNe=P('<form class="routine-form svelte-85ct2x"><!> <div class="form-content svelte-85ct2x"><div class="form-group svelte-85ct2x"><label for="name" class="svelte-85ct2x">Name <span class="required svelte-85ct2x">*</span></label> <input id="name" type="text" maxlength="20" placeholder="Short name (1-20 chars)"/> <span class="char-count svelte-85ct2x"> </span></div> <div class="form-group svelte-85ct2x"><label for="purpose" class="svelte-85ct2x">Purpose <span class="required svelte-85ct2x">*</span></label> <input id="purpose" type="text" maxlength="100" placeholder="One-sentence description (1-100 chars)"/> <span class="char-count svelte-85ct2x"> </span></div> <div class="form-group svelte-85ct2x"><label for="description" class="svelte-85ct2x">Instructions <span class="required svelte-85ct2x">*</span></label> <textarea id="description" rows="6" placeholder="Detailed instructions in markdown..."></textarea></div> <div class="form-row svelte-85ct2x"><div class="form-group svelte-85ct2x"><label for="type" class="svelte-85ct2x">Type</label> <select id="type" class="svelte-85ct2x"><option>Routine</option><option>Backlog</option></select></div> <!></div> <fieldset class="form-group svelte-85ct2x"><legend class="svelte-85ct2x">Schedule</legend> <div class="radio-group svelte-85ct2x"><label class="radio-option svelte-85ct2x"><input type="radio" class="svelte-85ct2x"/> <span>On-demand (no schedule)</span></label> <label class="radio-option svelte-85ct2x"><input type="radio" class="svelte-85ct2x"/> <span>One-time due date</span></label> <label class="radio-option svelte-85ct2x"><input type="radio" class="svelte-85ct2x"/> <span>Recurring</span></label></div></fieldset> <!> <!></div> <div class="form-actions svelte-85ct2x"><!> <button type="submit" class="btn btn-primary svelte-85ct2x"> </button></div></form>');function TD(n,e){lt(e,!0);const t=[];let r=et(e,"routine",3,null),i=j(Qt(r()?.name||"")),s=j(Qt(r()?.purpose||"")),o=j(Qt(r()?.description||"")),a=j(Qt(r()?.type||"routine")),l=j(Qt(r()?.status||"active")),c=j(Qt(r()?.recurringSpec?"recurring":r()?.dueDate?"one-time":"none")),d=j(Qt(r()?.recurringSpec?.frequency||"weekly")),h=j(Qt(r()?.recurringSpec?.dayOfWeek??1)),f=j(Qt(r()?.recurringSpec?.dayOfMonth??1)),p=j(Qt(r()?.recurringSpec?.time||"")),g=j(Qt(r()?.dueDate?.slice(0,16)||"")),m=j(null),v=j(!1);const y=le(()=>!!r()),O=le(()=>u(i).length>=1&&u(i).length<=20),_=le(()=>u(s).length>=1&&u(s).length<=100),x=le(()=>u(o).length>=1),k=le(()=>u(O)&&u(_)&&u(x)),S=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];async function E(Re){if(Re.preventDefault(),!(!u(k)||u(v))){b(m,null),b(v,!0);try{let He,Me;if(u(c)==="recurring"?(He={frequency:u(d)},u(d)==="weekly"?He.dayOfWeek=u(h):u(d)==="monthly"&&(He.dayOfMonth=u(f)),u(p)&&(He.time=u(p))):u(c)==="one-time"&&u(g)&&(Me=new Date(u(g)).toISOString()),u(y)&&r())B5({routineId:r().id,name:u(i),purpose:u(s),description:u(o),type:u(a),status:u(l),recurringSpec:u(c)==="recurring"?He:null,dueDate:u(c)==="one-time"?Me:null}),e.onSubmit?.(r().id);else{const Pe=z5({name:u(i),purpose:u(s),description:u(o),type:u(a),status:u(l),recurringSpec:He,dueDate:Me});e.onSubmit?.(Pe)}}catch(He){b(m,He instanceof Error?He.message:"Failed to save routine",!0)}finally{b(v,!1)}}}var R=eNe(),C=w(R);{var I=Re=>{var He=q3e(),Me=w(He);Y(()=>J(Me,u(m))),T(Re,He)};z(C,Re=>{u(m)&&Re(I)})}var D=A(C,2),Q=w(D),M=A(w(Q),2);let N;var B=A(M,2),H=w(B),F=A(Q,2),Z=A(w(F),2);let $;var W=A(Z,2),G=w(W),L=A(F,2),q=A(w(L),2);let ue;var oe=A(L,2),fe=w(oe),be=A(w(fe),2),De=w(be);De.value=De.__value="routine";var Le=A(De);Le.value=Le.__value="backlog";var he=A(fe,2);{var se=Re=>{var He=H3e(),Me=A(w(He),2),Pe=w(Me);Pe.value=Pe.__value="active";var ae=A(Pe);ae.value=ae.__value="paused";var te=A(ae);te.value=te.__value="completed",Zc(Me,()=>u(l),re=>b(l,re)),T(Re,He)};z(he,Re=>{u(y)&&Re(se)})}var V=A(oe,2),ne=A(w(V),2),ee=w(ne),U=w(ee);U.value=U.__value="none";var X=A(ee,2),ie=w(X);ie.value=ie.__value="one-time";var ye=A(X,2),pe=w(ye);pe.value=pe.__value="recurring";var de=A(V,2);{var we=Re=>{var He=Z3e(),Me=A(w(He),2);Un(Me,()=>u(g),Pe=>b(g,Pe)),T(Re,He)};z(de,Re=>{u(c)==="one-time"&&Re(we)})}var me=A(de,2);{var Ee=Re=>{var He=K3e(),Me=w(He),Pe=A(w(Me),2),ae=w(Pe);ae.value=ae.__value="daily";var te=A(ae);te.value=te.__value="weekly";var re=A(te);re.value=re.__value="monthly";var ve=A(Me,2);{var Te=We=>{var st=X3e(),it=A(w(st),2);Tt(it,21,()=>S,Sl,(Ct,bt,xt)=>{var mt=W3e(),Ge=w(mt);mt.value=mt.__value=xt,Y(()=>J(Ge,u(bt))),T(Ct,mt)}),Zc(it,()=>u(h),Ct=>b(h,Ct)),T(We,st)};z(ve,We=>{u(d)==="weekly"&&We(Te)})}var Ne=A(ve,2);{var ce=We=>{var st=G3e(),it=A(w(st),2);Tt(it,20,()=>Array.from({length:31},(Ct,bt)=>bt+1),Ct=>Ct,(Ct,bt)=>{var xt=Y3e(),mt=w(xt),Ge={};Y(()=>{J(mt,bt),Ge!==(Ge=bt)&&(xt.value=(xt.__value=bt)??"")}),T(Ct,xt)}),Zc(it,()=>u(f),Ct=>b(f,Ct)),T(We,st)};z(Ne,We=>{u(d)==="monthly"&&We(ce)})}var Oe=A(Ne,2),Qe=A(w(Oe),2);Zc(Pe,()=>u(d),We=>b(d,We)),Un(Qe,()=>u(p),We=>b(p,We)),T(Re,He)};z(me,Re=>{u(c)==="recurring"&&Re(Ee)})}var _e=A(D,2),Ae=w(_e);{var ze=Re=>{var He=J3e();He.__click=function(...Me){e.onCancel?.apply(this,Me)},T(Re,He)};z(Ae,Re=>{e.onCancel&&Re(ze)})}var Be=A(Ae,2),Se=w(Be);Y(()=>{N=Ue(M,1,"svelte-85ct2x",null,N,{invalid:u(i).length>0&&!u(O)}),J(H,`${u(i).length??""}/20`),$=Ue(Z,1,"svelte-85ct2x",null,$,{invalid:u(s).length>0&&!u(_)}),J(G,`${u(s).length??""}/100`),ue=Ue(q,1,"svelte-85ct2x",null,ue,{invalid:u(o).length>0&&!u(x)}),Be.disabled=!u(k)||u(v),J(Se,u(v)?"Saving...":u(y)?"Save Changes":"Create Routine")}),It("submit",R,E),Un(M,()=>u(i),Re=>b(i,Re)),Un(Z,()=>u(s),Re=>b(s,Re)),Un(q,()=>u(o),Re=>b(o,Re)),Zc(be,()=>u(a),Re=>b(a,Re)),ow(t,[],U,()=>u(c),Re=>b(c,Re)),ow(t,[],ie,()=>u(c),Re=>b(c,Re)),ow(t,[],pe,()=>u(c),Re=>b(c,Re)),T(n,R),ct()}yt(["click"]);var tNe=P('<section class="dashboard-section svelte-14y6vcj"><h2 class="section-title section-title-due svelte-14y6vcj">Due Now</h2> <div class="dashboard-cards svelte-14y6vcj"></div></section>'),nNe=P('<section class="dashboard-section svelte-14y6vcj"><h2 class="section-title section-title-upcoming svelte-14y6vcj">Upcoming</h2> <div class="dashboard-cards svelte-14y6vcj"></div></section>'),rNe=P('<span class="count svelte-14y6vcj"> </span>'),iNe=P('<span class="count backlog svelte-14y6vcj"> </span>'),sNe=P('<div class="routines-view svelte-14y6vcj"><div class="view-header svelte-14y6vcj"><h1 class="svelte-14y6vcj">Routines</h1> <button class="btn btn-primary svelte-14y6vcj"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> New Routine</button></div> <div class="dashboard-content svelte-14y6vcj"><!> <!> <section class="all-routines-section svelte-14y6vcj"><div class="section-header svelte-14y6vcj"><h2 class="section-title svelte-14y6vcj">All Routines</h2> <div class="tabs svelte-14y6vcj"><button>Routines <!></button> <button>Backlog <!></button></div></div> <div class="list-controls svelte-14y6vcj"><div class="search-box svelte-14y6vcj"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-14y6vcj"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg> <input type="text" placeholder="Search routines..." class="svelte-14y6vcj"/></div> <select class="svelte-14y6vcj"><option>All Status</option><option>Active</option><option>Paused</option><option>Completed</option></select></div> <div class="list-content svelte-14y6vcj"><!></div></section></div> <!></div>');function oNe(n,e){lt(e,!0);let t=j("closed"),r=j(null),i=j(null),s=j("routines"),o=j("active"),a=j("");const l=le(F5),c=le(()=>{const ye=new Set(u(l).map(pe=>pe.id));return XJ(7).filter(pe=>!ye.has(pe.id)&&pe.dueInfo?.type==="upcoming")}),d=le(()=>{let ye=th({status:u(o)==="all"?void 0:u(o),type:u(s)==="backlog"?"backlog":"routine"});if(u(a).trim()){const pe=u(a).toLowerCase();ye=ye.filter(de=>de.name.toLowerCase().includes(pe)||de.purpose.toLowerCase().includes(pe))}return ye}),h=le(()=>th({type:"routine",status:"active"}).length),f=le(()=>th({type:"backlog",status:"active"}).length),p=le(()=>u(t)!=="closed"),g=le(()=>{switch(u(t)){case"create":return"New Routine";case"edit":return"Edit Routine";case"detail":return"Routine Details";default:return""}}),m=le(()=>u(r)?mo(u(r)):null);function v(){b(t,"create"),b(r,null),b(i,null)}function y(ye){b(r,ye,!0),b(t,"detail"),b(i,null)}function O(ye){e.onExecuteRoutine?.(ye)}function _(ye){const pe=mo(ye);pe&&(b(i,pe,!0),b(r,ye,!0),b(t,"edit"))}function x(ye){b(i,ye,!0),b(t,"edit")}function k(ye){E()}function S(ye){b(r,ye,!0),b(t,"detail"),b(i,null)}function E(){b(t,"closed"),b(r,null),b(i,null)}var R=sNe(),C=w(R),I=A(w(C),2);I.__click=v;var D=A(C,2),Q=w(D);{var M=ye=>{var pe=tNe(),de=A(w(pe),2);Tt(de,21,()=>u(l),we=>we.id,(we,me)=>{SD(we,{get routine(){return u(me)},variant:"due",onStart:O,onEdit:_,onClick:y})}),T(ye,pe)};z(Q,ye=>{u(l).length>0&&ye(M)})}var N=A(Q,2);{var B=ye=>{var pe=nNe(),de=A(w(pe),2);Tt(de,21,()=>u(c),we=>we.id,(we,me)=>{SD(we,{get routine(){return u(me)},variant:"upcoming",onStart:O,onEdit:_,onClick:y})}),T(ye,pe)};z(N,ye=>{u(c).length>0&&ye(B)})}var H=A(N,2),F=w(H),Z=A(w(F),2),$=w(Z);let W;$.__click=()=>b(s,"routines");var G=A(w($));{var L=ye=>{var pe=rNe(),de=w(pe);Y(()=>J(de,u(h))),T(ye,pe)};z(G,ye=>{u(h)>0&&ye(L)})}var q=A($,2);let ue;q.__click=()=>b(s,"backlog");var oe=A(w(q));{var fe=ye=>{var pe=iNe(),de=w(pe);Y(()=>J(de,u(f))),T(ye,pe)};z(oe,ye=>{u(f)>0&&ye(fe)})}var be=A(F,2),De=w(be),Le=A(w(De),2),he=A(De,2),se=w(he);se.value=se.__value="all";var V=A(se);V.value=V.__value="active";var ne=A(V);ne.value=ne.__value="paused";var ee=A(ne);ee.value=ee.__value="completed";var U=A(be,2),X=w(U);y3e(X,{get routines(){return u(d)},onSelect:y,onExecute:O});var ie=A(D,2);h3e(ie,{get isOpen(){return u(p)},get title(){return u(g)},onClose:E,children:(ye,pe)=>{var de=Ve(),we=Ie(de);{var me=_e=>{TD(_e,{onSubmit:S,onCancel:E})},Ee=_e=>{var Ae=Ve(),ze=Ie(Ae);{var Be=Re=>{TD(Re,{get routine(){return u(i)},onSubmit:S,onCancel:E})},Se=Re=>{var He=Ve(),Me=Ie(He);{var Pe=ae=>{V3e(ae,{get routineId(){return u(m).id},onEdit:x,onExecute:O,onDelete:k})};z(Me,ae=>{u(t)==="detail"&&u(m)&&ae(Pe)},!0)}T(Re,He)};z(ze,Re=>{u(t)==="edit"&&u(i)?Re(Be):Re(Se,!1)},!0)}T(_e,Ae)};z(we,_e=>{u(t)==="create"?_e(me):_e(Ee,!1)})}T(ye,de)},$$slots:{default:!0}}),Y(()=>{W=Ue($,1,"tab svelte-14y6vcj",null,W,{active:u(s)==="routines"}),ue=Ue(q,1,"tab svelte-14y6vcj",null,ue,{active:u(s)==="backlog"})}),Un(Le,()=>u(a),ye=>b(a,ye)),Zc(he,()=>u(o),ye=>b(o,ye)),T(n,R),ct()}yt(["click"]);var aNe=P('<div class="error-text svelte-i730po"> </div>'),lNe=P('<div class="error-message svelte-i730po"> </div>'),cNe=P('<div class="loading-message svelte-i730po"><div class="loading-spinner svelte-i730po"></div> <span>Archiving webpage...</span></div>'),uNe=P(`<div class="modal-overlay svelte-i730po" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="modal-content svelte-i730po"><div class="modal-header svelte-i730po"><h3 id="modal-title" class="svelte-i730po"><span class="modal-icon svelte-i730po">ð</span> Archive Webpage</h3> <button class="close-btn svelte-i730po" aria-label="Close modal"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 4L12 12M4 12L12 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></button></div> <form class="import-form svelte-i730po"><div class="form-description svelte-i730po">Enter the URL of a webpage to archive. The page will be saved locally with
          images for offline reading.</div> <div class="form-group svelte-i730po"><label for="webpage-url" class="svelte-i730po">URL:</label> <div class="url-input-group svelte-i730po"><input id="webpage-url" type="url" placeholder="https://example.com/article"/> <button type="button" class="paste-btn svelte-i730po" title="Paste from clipboard"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 4V2.5C4 1.67157 4.67157 1 5.5 1H10.5C11.3284 1 12 1.67157 12 2.5V4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path><rect x="2" y="4" width="12" height="11" rx="1.5" stroke="currentColor" stroke-width="1.5"></rect></svg></button></div> <!></div> <!> <!> <div class="form-actions svelte-i730po"><button type="button" class="cancel-btn svelte-i730po">Cancel</button> <button type="submit" class="import-btn svelte-i730po"> </button></div></form></div></div>`);function dNe(n,e){lt(e,!0);let t=j(""),r=j(!1),i=j(null),s=j(null);tt(()=>{e.isOpen&&setTimeout(()=>{document.querySelector(".url-input")?.focus()},100)}),tt(()=>{e.isOpen||o()});function o(){b(t,""),b(i,null),b(s,null),b(r,!1)}function a(v){if(!v.trim())return"URL is required";try{const y=new URL(v);return["http:","https:"].includes(y.protocol)?null:"Only HTTP and HTTPS URLs are supported"}catch{return"Invalid URL format"}}function l(v){const y=v.target;b(t,y.value,!0),b(s,a(u(t)),!0)}async function c(v){v.preventDefault();const y=a(u(t));if(y){b(s,y,!0);return}b(r,!0),b(i,null);try{await Hne(u(t).trim()),e.onClose()}catch(O){console.error("Failed to import webpage:",O);let _="Failed to import webpage";O instanceof Error&&(O.message.includes("Failed to fetch")?_="Could not fetch the webpage. It may be blocked or unavailable.":O.message.includes("extract")?_="Could not extract article content. The page may not be a readable article.":_=O.message),b(i,_,!0)}finally{b(r,!1)}}function d(v){v.key==="Escape"?e.onClose():v.key==="Enter"&&!u(r)&&(v.preventDefault(),c(v))}function h(v){v.target===v.currentTarget&&e.onClose()}async function f(){try{const v=await navigator.clipboard.readText();v&&(b(t,v.trim(),!0),b(s,a(u(t)),!0))}catch{}}var p=Ve(),g=Ie(p);{var m=v=>{var y=uNe();y.__click=h,y.__keydown=d;var O=w(y),_=w(O),x=A(w(_),2);x.__click=function(...G){e.onClose?.apply(this,G)};var k=A(_,2),S=A(w(k),2),E=A(w(S),2),R=w(E);let C;R.__input=l;var I=A(R,2);I.__click=f;var D=A(E,2);{var Q=G=>{var L=aNe(),q=w(L);Y(()=>J(q,u(s))),T(G,L)};z(D,G=>{u(s)&&G(Q)})}var M=A(S,2);{var N=G=>{var L=lNe(),q=w(L);Y(()=>J(q,u(i))),T(G,L)};z(M,G=>{u(i)&&G(N)})}var B=A(M,2);{var H=G=>{var L=cNe();T(G,L)};z(B,G=>{u(r)&&G(H)})}var F=A(B,2),Z=w(F);Z.__click=function(...G){e.onClose?.apply(this,G)};var $=A(Z,2),W=w($);Y(G=>{C=Ue(R,1,"url-input svelte-i730po",null,C,{error:u(s)}),Tn(R,u(t)),R.disabled=u(r),I.disabled=u(r),Z.disabled=u(r),$.disabled=G,J(W,u(r)?"Archiving...":"Archive")},[()=>u(r)||!!u(s)||!u(t).trim()]),It("submit",k,c),T(v,y)};z(g,v=>{e.isOpen&&v(m)})}T(n,p),ct()}yt(["click","keydown","input"]);var hNe=P('<div class="detecting-content svelte-1lf6ypt"><div class="spinner svelte-1lf6ypt"></div> <p>Looking for legacy Flint vaults...</p></div>'),fNe=P('<div class="vault-progress-indicator svelte-1lf6ypt"> </div>'),pNe=P('<div class="current-vault-name svelte-1lf6ypt"> </div>'),gNe=P('<span class="phase-icon svelte-1lf6ypt">ð</span> Reading legacy data...',1),mNe=P('<span class="phase-icon svelte-1lf6ypt">ð</span> Converting format...',1),vNe=P('<span class="phase-icon svelte-1lf6ypt">ð¾</span> Creating new vault...',1),yNe=P('<span class="phase-icon svelte-1lf6ypt">â³</span> ',1),bNe=P('<span class="detail"> </span>'),wNe=P('<span class="detail"> </span>'),_Ne=P('<span class="detail"> </span>'),ONe=P('<div class="progress-details svelte-1lf6ypt"><!> <!> <!></div>'),xNe=P('<div class="progress-content svelte-1lf6ypt"><!> <!> <div class="progress-info svelte-1lf6ypt"><div class="progress-phase svelte-1lf6ypt"><!></div> <div class="progress-message svelte-1lf6ypt"> </div></div> <div class="progress-bar-container svelte-1lf6ypt"><div class="progress-bar svelte-1lf6ypt"></div></div> <!></div>'),kNe=P('<div class="stat-item svelte-1lf6ypt"><span class="stat-value svelte-1lf6ypt"> </span> <span class="stat-label svelte-1lf6ypt">EPUBs</span></div>'),SNe=P('<div class="warning-item svelte-1lf6ypt"><span class="warning-type svelte-1lf6ypt"> </span> <span class="warning-message svelte-1lf6ypt"> </span></div>'),TNe=P('<div class="warning-more svelte-1lf6ypt"> </div>'),ANe=P('<div class="warnings-section svelte-1lf6ypt"><h4 class="svelte-1lf6ypt"> </h4> <div class="warnings-list svelte-1lf6ypt"><!> <!></div></div>'),CNe=P('<div class="complete-content svelte-1lf6ypt"><div class="success-icon svelte-1lf6ypt"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1lf6ypt"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg></div> <h3 class="svelte-1lf6ypt"><!></h3> <div class="stats-grid svelte-1lf6ypt"><div class="stat-item svelte-1lf6ypt"><span class="stat-value svelte-1lf6ypt"> </span> <span class="stat-label svelte-1lf6ypt">Notes</span></div> <div class="stat-item svelte-1lf6ypt"><span class="stat-value svelte-1lf6ypt"> </span> <span class="stat-label svelte-1lf6ypt">Note Types</span></div> <div class="stat-item svelte-1lf6ypt"><span class="stat-value svelte-1lf6ypt"> </span> <span class="stat-label svelte-1lf6ypt">Workspaces</span></div> <!></div> <!></div>'),ENe=P('<div class="error-details svelte-1lf6ypt"> </div>'),PNe=P('<div class="error-details svelte-1lf6ypt"> </div>'),INe=P(`<div class="error-content svelte-1lf6ypt"><div class="error-icon svelte-1lf6ypt"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1lf6ypt"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div> <h3 class="svelte-1lf6ypt">Migration Failed</h3> <!> <p class="error-help svelte-1lf6ypt">Your original vaults have not been modified. Please contact support if the
            issue persists.</p></div>`),MNe=P('<button class="primary-button svelte-1lf6ypt">Open Vault</button>'),RNe=P('<button class="primary-button svelte-1lf6ypt">Close</button>'),DNe=P('<div class="modal-overlay svelte-1lf6ypt" role="dialog" aria-modal="true" aria-labelledby="migration-title"><div class="modal-container svelte-1lf6ypt"><div class="modal-header svelte-1lf6ypt"><h2 id="migration-title" class="svelte-1lf6ypt"><!></h2></div> <div class="modal-content svelte-1lf6ypt"><!></div> <div class="modal-footer svelte-1lf6ypt"><!></div></div></div>');function NNe(n,e){lt(e,!0);let t=j("detecting"),r=j(null),i=j(Qt([])),s=j(0),o=j(Qt([])),a=le(TT),l=le(()=>u(i)[u(s)]??null),c=le(()=>{const N={notes:0,noteTypes:0,workspaces:0,epubs:0,successCount:0,failureCount:0,totalErrors:[]};for(const B of u(o))if(B.success&&B.stats)N.notes+=B.stats.notes,N.noteTypes+=B.stats.noteTypes,N.workspaces+=B.stats.workspaces,N.epubs+=B.stats.epubs,N.successCount++;else{N.failureCount++;const H=u(i)[u(o).indexOf(B)],F=B.errors?.[0]?.message??"Unknown error";N.totalErrors.push({vault:H?.name??"Unknown",message:F})}return N});tt(()=>(d(),()=>{ph()}));async function d(){b(t,"detecting"),b(r,null);try{const N=await fke();if(b(i,N.filter(B=>!B.hasExistingMigration),!0),u(i).length===0){e.onCancel();return}await h()}catch(N){b(r,N instanceof Error?N.message:"Failed to detect vaults",!0),b(t,"error")}}async function h(){b(t,"progress"),b(o,[],!0),b(s,0);for(let B=0;B<u(i).length;B++){b(s,B,!0);const H=u(i)[B],F=await L0(H.path,H.name,H.syncDirectoryName);b(o,[...u(o),F],!0)}const N=u(o).some(B=>B.success);b(t,N?"complete":"error",!0)}function f(){ph(),e.onComplete()}function p(){ph(),e.onCancel()}function g(){return!u(a)||u(a).total===0?0:Math.round(u(a).current/u(a).total*100)}var m=DNe(),v=w(m),y=w(v),O=w(y),_=w(O);{var x=N=>{var B=Tr("Detecting Legacy Vaults...");T(N,B)},k=N=>{var B=Ve(),H=Ie(B);{var F=$=>{var W=Tr("Migrating Vaults...");T($,W)},Z=$=>{var W=Ve(),G=Ie(W);{var L=ue=>{var oe=Tr("Migration Complete");T(ue,oe)},q=ue=>{var oe=Tr("Migration Failed");T(ue,oe)};z(G,ue=>{u(t)==="complete"?ue(L):ue(q,!1)},!0)}T($,W)};z(H,$=>{u(t)==="progress"?$(F):$(Z,!1)},!0)}T(N,B)};z(_,N=>{u(t)==="detecting"?N(x):N(k,!1)})}var S=A(y,2),E=w(S);{var R=N=>{var B=hNe();T(N,B)},C=N=>{var B=Ve(),H=Ie(B);{var F=$=>{var W=xNe(),G=w(W);{var L=X=>{var ie=fNe(),ye=w(ie);Y(()=>J(ye,`Vault ${u(s)+1} of ${u(i).length??""}`)),T(X,ie)};z(G,X=>{u(i).length>1&&X(L)})}var q=A(G,2);{var ue=X=>{var ie=pNe(),ye=w(ie);Y(()=>J(ye,u(l).name)),T(X,ie)};z(q,X=>{u(l)&&X(ue)})}var oe=A(q,2),fe=w(oe),be=w(fe);{var De=X=>{var ie=gNe();T(X,ie)},Le=X=>{var ie=Ve(),ye=Ie(ie);{var pe=we=>{var me=mNe();T(we,me)},de=we=>{var me=Ve(),Ee=Ie(me);{var _e=ze=>{var Be=vNe();T(ze,Be)},Ae=ze=>{var Be=yNe(),Se=A(Ie(Be));Y(()=>J(Se,` ${(u(a)?.message||"Processing...")??""}`)),T(ze,Be)};z(Ee,ze=>{u(a)?.phase==="writing"?ze(_e):ze(Ae,!1)},!0)}T(we,me)};z(ye,we=>{u(a)?.phase==="transforming"?we(pe):we(de,!1)},!0)}T(X,ie)};z(be,X=>{u(a)?.phase==="extracting"?X(De):X(Le,!1)})}var he=A(fe,2),se=w(he),V=A(oe,2),ne=w(V),ee=A(V,2);{var U=X=>{var ie=ONe(),ye=w(ie);{var pe=_e=>{var Ae=bNe(),ze=w(Ae);Y(()=>J(ze,`${u(a).details.notes??""} notes`)),T(_e,Ae)};z(ye,_e=>{u(a).details.notes!==void 0&&_e(pe)})}var de=A(ye,2);{var we=_e=>{var Ae=wNe(),ze=w(Ae);Y(()=>J(ze,`${u(a).details.noteTypes??""} types`)),T(_e,Ae)};z(de,_e=>{u(a).details.noteTypes!==void 0&&_e(we)})}var me=A(de,2);{var Ee=_e=>{var Ae=_Ne(),ze=w(Ae);Y(()=>J(ze,`${u(a).details.epubs??""} EPUBs`)),T(_e,Ae)};z(me,_e=>{u(a).details.epubs!==void 0&&u(a).details.epubs>0&&_e(Ee)})}T(X,ie)};z(ee,X=>{u(a)?.details&&X(U)})}Y(X=>{J(se,u(a)?.message||"Starting migration..."),gn(ne,`width: ${X??""}%`)},[g]),T($,W)},Z=$=>{var W=Ve(),G=Ie(W);{var L=ue=>{var oe=CNe(),fe=A(w(oe),2),be=w(fe);{var De=_e=>{var Ae=Tr("Migration Successful!");T(_e,Ae)},Le=_e=>{var Ae=Tr();Y(()=>J(Ae,`Migrated ${u(c).successCount??""} of ${u(i).length??""} Vaults`)),T(_e,Ae)};z(be,_e=>{u(i).length===1?_e(De):_e(Le,!1)})}var he=A(fe,2),se=w(he),V=w(se),ne=w(V),ee=A(se,2),U=w(ee),X=w(U),ie=A(ee,2),ye=w(ie),pe=w(ye),de=A(ie,2);{var we=_e=>{var Ae=kNe(),ze=w(Ae),Be=w(ze);Y(()=>J(Be,u(c).epubs)),T(_e,Ae)};z(de,_e=>{u(c).epubs>0&&_e(we)})}var me=A(he,2);{var Ee=_e=>{var Ae=ANe(),ze=w(Ae),Be=w(ze),Se=A(ze,2),Re=w(Se);Tt(Re,17,()=>u(c).totalErrors.slice(0,5),Sl,(Pe,ae)=>{var te=SNe(),re=w(te),ve=w(re),Te=A(re,2),Ne=w(Te);Y(()=>{J(ve,u(ae).vault),J(Ne,u(ae).message)}),T(Pe,te)});var He=A(Re,2);{var Me=Pe=>{var ae=TNe(),te=w(ae);Y(()=>J(te,`+${u(c).totalErrors.length-5} more failures`)),T(Pe,ae)};z(He,Pe=>{u(c).totalErrors.length>5&&Pe(Me)})}Y(()=>J(Be,`Failed Vaults (${u(c).failureCount??""})`)),T(_e,Ae)};z(me,_e=>{u(c).totalErrors.length>0&&_e(Ee)})}Y(()=>{J(ne,u(c).notes),J(X,u(c).noteTypes),J(pe,u(c).workspaces)}),T(ue,oe)},q=ue=>{var oe=INe(),fe=A(w(oe),4);{var be=Le=>{var he=ENe(),se=w(he);Y(()=>J(se,u(r))),T(Le,he)},De=Le=>{var he=Ve(),se=Ie(he);{var V=ne=>{var ee=PNe(),U=w(ee);Y(()=>J(U,u(c).totalErrors[0].message)),T(ne,ee)};z(se,ne=>{u(c).totalErrors.length>0&&ne(V)},!0)}T(Le,he)};z(fe,Le=>{u(r)?Le(be):Le(De,!1)})}T(ue,oe)};z(G,ue=>{u(t)==="complete"?ue(L):ue(q,!1)},!0)}T($,W)};z(H,$=>{u(t)==="progress"?$(F):$(Z,!1)},!0)}T(N,B)};z(E,N=>{u(t)==="detecting"?N(R):N(C,!1)})}var I=A(S,2),D=w(I);{var Q=N=>{var B=MNe();B.__click=f,T(N,B)},M=N=>{var B=Ve(),H=Ie(B);{var F=Z=>{var $=RNe();$.__click=p,T(Z,$)};z(H,Z=>{u(t)==="error"&&Z(F)},!0)}T(N,B)};z(D,N=>{u(t)==="complete"?N(Q):N(M,!1)})}T(n,m),ct()}yt(["click"]);var LNe=P('<div class="results-header svelte-ojh11q">Recent</div>'),QNe=P('<button class="view-all-btn svelte-ojh11q"> </button>'),$Ne=P("<!> <!> <!>",1),FNe=P('<div class="no-results svelte-ojh11q"> </div>'),zNe=P('<div class="no-results svelte-ojh11q">No recent notes</div>'),BNe=P('<div class="search-results-container svelte-ojh11q"><!></div>'),UNe=P('<div class="empty-state svelte-ojh11q"><p class="svelte-ojh11q">Type to search your notes</p> <div class="keyboard-hints svelte-ojh11q"><span class="hint svelte-ojh11q"><kbd class="svelte-ojh11q">â</kbd><kbd class="svelte-ojh11q">â</kbd> Navigate</span> <span class="hint svelte-ojh11q"><kbd class="svelte-ojh11q">Enter</kbd> Select</span> <span class="hint svelte-ojh11q"><kbd class="svelte-ojh11q">Esc</kbd> Close</span></div></div>'),jNe=P('<div class="quick-search-overlay svelte-ojh11q"><div class="quick-search-modal svelte-ojh11q"><div class="search-input-wrapper svelte-ojh11q"><svg class="search-icon svelte-ojh11q" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg> <input type="text" class="search-input svelte-ojh11q" placeholder="Search notes..."/> <div class="shortcut-hint svelte-ojh11q"> </div></div> <!></div></div>');function VNe(n,e){lt(e,!0);let t=j(null);tt(()=>{e.isOpen&&u(t)&&setTimeout(()=>{u(t)?.focus()},10)});const i=navigator.platform.startsWith("Mac")?"â":"Ctrl";function s(f){if(f.key==="Escape"){f.preventDefault(),e.onClose();return}e.onKeyDown(f),f.key==="Enter"&&e.searchResults.length>0&&e.onClose()}function o(f){f.target===f.currentTarget&&e.onClose()}function a(f){e.onSearchResultSelect(f),e.onClose()}function l(){e.onViewAllResults(),e.onClose()}var c=Ve(),d=Ie(c);{var h=f=>{var p=jNe();p.__click=o,p.__keydown=S=>S.key==="Escape"&&e.onClose();var g=w(p);g.__click=S=>S.stopPropagation();var m=w(g),v=A(w(m),2);v.__input=S=>e.onSearchChange(S.target.value),v.__keydown=s,qt(v,S=>b(t,S),()=>u(t));var y=A(v,2),O=w(y),_=A(m,2);{var x=S=>{var E=BNe(),R=w(E);{var C=D=>{var Q=$Ne(),M=Ie(Q);{var N=Z=>{var $=LNe();T(Z,$)};z(M,Z=>{e.isShowingRecent&&Z(N)})}var B=A(M,2);AT(B,{get results(){return e.searchResults},onSelect:a,maxResults:8,get selectedIndex(){return e.selectedSearchIndex},get isLoading(){return e.isSearchingContent}});var H=A(B,2);{var F=Z=>{var $=QNe();$.__click=l;var W=w($);Y(()=>J(W,`View all ${e.searchResults.length??""} results (Enter)`)),T(Z,$)};z(H,Z=>{e.searchResults.length>8&&!e.isShowingRecent&&Z(F)})}T(D,Q)},I=D=>{var Q=Ve(),M=Ie(Q);{var N=H=>{var F=FNe(),Z=w(F);Y(()=>J(Z,`No matching notes found for "${e.searchQuery??""}"`)),T(H,F)},B=H=>{var F=zNe();T(H,F)};z(M,H=>{e.searchQuery.trim()?H(N):H(B,!1)},!0)}T(D,Q)};z(R,D=>{e.searchResults.length>0?D(C):D(I,!1)})}T(S,E)},k=S=>{var E=UNe();T(S,E)};z(_,S=>{e.searchQuery.trim()||e.searchResults.length>0?S(x):S(k,!1)})}Y(()=>{Tn(v,e.searchQuery),J(O,`${i}K`)}),T(f,p)};z(d,f=>{e.isOpen&&f(h)})}T(n,c),ct()}yt(["click","keydown","input"]);var qNe=kn('<svg class="check-icon svelte-1uzl4c3" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>'),HNe=P('<button type="button" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1uzl4c3"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> <span class="svelte-1uzl4c3">Preview Mode</span> <!></button>'),ZNe=kn('<svg class="check-icon svelte-1uzl4c3" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>'),WNe=P('<div class="menu-divider svelte-1uzl4c3"></div> <button type="button" class="menu-item svelte-1uzl4c3" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1uzl4c3"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg> <span class="svelte-1uzl4c3">Show in Finder</span></button>',1),XNe=P('<div class="actions-menu svelte-1uzl4c3" role="menu"><button type="button" class="menu-item svelte-1uzl4c3" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" class="svelte-1uzl4c3"><path d="M12 17v5"></path><path d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z"></path></svg> <span class="svelte-1uzl4c3"> </span></button> <button type="button" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1uzl4c3"><path d="M22 12h-6l-2 3h-4l-2-3H2"></path><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path></svg> <span class="svelte-1uzl4c3"> </span></button> <div class="menu-divider svelte-1uzl4c3"></div> <!> <button type="button" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1uzl4c3"><path d="M12 2v4"></path><path d="M12 18v4"></path><path d="m4.93 4.93 2.83 2.83"></path><path d="m16.24 16.24 2.83 2.83"></path><path d="M2 12h4"></path><path d="M18 12h4"></path><path d="m4.93 19.07 2.83-2.83"></path><path d="m16.24 7.76 2.83-2.83"></path></svg> <span class="svelte-1uzl4c3"> </span> <!></button> <!> <div class="menu-divider svelte-1uzl4c3"></div> <button type="button" role="menuitem"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1uzl4c3"><polyline points="21 8 21 21 3 21 3 8"></polyline><rect x="1" y="3" width="22" height="5"></rect><line x1="10" y1="12" x2="14" y2="12"></line></svg> <span class="svelte-1uzl4c3"> </span></button></div>');function YNe(n,e){lt(e,!0);let t=et(e,"visible",11,!1),r=et(e,"showPreviewMode",3,!0),i=et(e,"showShowInFinder",3,!1),s=j(void 0);function o(){e.isPinned?e.onUnpin():e.onPin(),e.onClose()}function a(){e.onAddToShelf(),e.onClose()}function l(){e.onTogglePreview(),e.onClose()}function c(){e.onToggleReview(),e.onClose()}function d(){e.isArchived?e.onUnarchive():e.onArchive(),e.onClose()}function h(){e.onShowInFinder?.(),e.onClose()}function f(O){O.preventDefault()}function p(O){u(s)&&!u(s).contains(O.target)&&e.onClose()}function g(O){O.key==="Escape"&&e.onClose()}tt(()=>{if(t())return document.addEventListener("mousedown",p,!0),document.addEventListener("keydown",g),()=>{document.removeEventListener("mousedown",p,!0),document.removeEventListener("keydown",g)}}),tt(()=>{if(t()&&u(s)){const O=u(s).getBoundingClientRect(),_=window.innerWidth,x=window.innerHeight;O.right>_&&(u(s).style.left=`${_-O.width-8}px`),O.bottom>x&&(u(s).style.top=`${x-O.height-8}px`)}});var m=Ve(),v=Ie(m);{var y=O=>{var _=XNe(),x=w(_);x.__click=o,x.__mousedown=f;var k=w(x),S=A(k,2),E=w(S),R=A(x,2);let C;R.__click=a,R.__mousedown=f;var I=A(w(R),2),D=w(I),Q=A(R,4);{var M=fe=>{var be=HNe();let De;be.__click=l,be.__mousedown=f;var Le=A(w(be),4);{var he=se=>{var V=qNe();T(se,V)};z(Le,se=>{e.isPreviewMode&&se(he)})}Y(()=>De=Ue(be,1,"menu-item svelte-1uzl4c3",null,De,{active:e.isPreviewMode})),T(fe,be)};z(Q,fe=>{r()&&fe(M)})}var N=A(Q,2);let B;N.__click=c,N.__mousedown=f;var H=A(w(N),2),F=w(H),Z=A(H,2);{var $=fe=>{var be=ZNe();T(fe,be)};z(Z,fe=>{e.isReviewEnabled&&fe($)})}var W=A(N,2);{var G=fe=>{var be=WNe(),De=A(Ie(be),2);De.__click=h,De.__mousedown=f,T(fe,be)};z(W,fe=>{i()&&fe(G)})}var L=A(W,4);let q;L.__click=d,L.__mousedown=f;var ue=A(w(L),2),oe=w(ue);qt(_,fe=>b(s,fe),()=>u(s)),Y(()=>{gn(_,`left: ${e.x??""}px; top: ${e.y??""}px;`),Pt(k,"fill",e.isPinned?"currentColor":"none"),J(E,e.isPinned?"Unpin Note":"Pin Note"),C=Ue(R,1,"menu-item svelte-1uzl4c3",null,C,{disabled:e.isOnShelf}),R.disabled=e.isOnShelf,J(D,e.isOnShelf?"On Shelf":"Add to Shelf"),B=Ue(N,1,"menu-item svelte-1uzl4c3",null,B,{active:e.isReviewEnabled}),J(F,e.isReviewEnabled?"Disable Review":"Enable Review"),q=Ue(L,1,"menu-item svelte-1uzl4c3",null,q,{danger:!e.isArchived}),J(oe,e.isArchived?"Unarchive Note":"Archive Note")}),T(O,_)};z(v,O=>{t()&&O(y)})}T(n,m),ct()}yt(["click","mousedown"]);var GNe=P('<div class="update-content svelte-t9y1g2" title="Downloading update..."><svg class="download-icon svelte-t9y1g2" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" class="svelte-t9y1g2"></path><polyline points="7 10 12 15 17 10" class="svelte-t9y1g2"></polyline><line x1="12" y1="15" x2="12" y2="3" class="svelte-t9y1g2"></line></svg> <span class="progress-text svelte-t9y1g2"> </span> <div class="progress-bar svelte-t9y1g2"><div class="progress-fill svelte-t9y1g2"></div></div></div>'),KNe=P('<button class="update-button svelte-t9y1g2" title="Click to install update and restart"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-t9y1g2"><polyline points="23 4 23 10 17 10" class="svelte-t9y1g2"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" class="svelte-t9y1g2"></path></svg> <span class="svelte-t9y1g2"> </span></button> <button class="dismiss-button svelte-t9y1g2" title="Dismiss"><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-t9y1g2"><line x1="18" y1="6" x2="6" y2="18" class="svelte-t9y1g2"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-t9y1g2"></line></svg></button>',1),JNe=P("<div><!></div>");function eLe(n,e){lt(e,!0);class t{#e=j("idle");get state(){return u(this.#e)}set state(p){b(this.#e,p,!0)}#t=j(0);get downloadProgress(){return u(this.#t)}set downloadProgress(p){b(this.#t,p,!0)}#r=j(null);get newVersion(){return u(this.#r)}set newVersion(p){b(this.#r,p,!0)}}const r=new t;function i(){window.api?.onUpdateChecking(()=>{r.state="checking"}),window.api?.onUpdateAvailable(f=>{r.newVersion=f.version}),window.api?.onUpdateNotAvailable(()=>{r.state="idle"}),window.api?.onUpdateDownloadProgress(f=>{r.state="downloading",r.downloadProgress=Math.round(f.percent)}),window.api?.onUpdateDownloaded(f=>{r.state="ready",r.newVersion=f.version}),window.api?.onUpdateError(f=>{console.error("Update error:",f.message),r.state="error",setTimeout(()=>{r.state="idle"},5e3)})}function s(){window.api?.installUpdate()}function o(){r.state="idle"}qr(()=>{i(),window.api?.checkForUpdates()}),Oo(()=>{window.api?.removeAllUpdateListeners()});const a=le(()=>r.state==="downloading"?`${r.downloadProgress}%`:""),l=le(()=>r.state==="downloading"||r.state==="ready");var c=Ve(),d=Ie(c);{var h=f=>{var p=JNe();let g;var m=w(p);{var v=O=>{var _=GNe(),x=A(w(_),2),k=w(x),S=A(x,2),E=w(S);Y(()=>{J(k,u(a)),gn(E,`width: ${r.downloadProgress??""}%`)}),T(O,_)},y=O=>{var _=Ve(),x=Ie(_);{var k=S=>{var E=KNe(),R=Ie(E);R.__click=s;var C=A(w(R),2),I=w(C),D=A(R,2);D.__click=o,Y(()=>J(I,`Update ${r.newVersion??""}`)),T(S,E)};z(x,S=>{r.state==="ready"&&S(k)},!0)}T(O,_)};z(m,O=>{r.state==="downloading"?O(v):O(y,!1)})}Y(()=>g=Ue(p,1,"update-widget svelte-t9y1g2",null,g,{ready:r.state==="ready"})),T(f,p)};z(d,f=>{u(l)&&f(h)})}T(n,c),ct()}yt(["click"]);var tLe=P('<div class="window-controls svelte-1yq3aid"><button class="window-control minimize svelte-1yq3aid" aria-label="Minimize" title="Minimize"><svg width="10" height="1" viewBox="0 0 10 1" class="svelte-1yq3aid"><rect width="10" height="1" fill="currentColor"></rect></svg></button> <button class="window-control maximize svelte-1yq3aid" aria-label="Maximize" title="Maximize"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-1yq3aid"><rect x="0.5" y="0.5" width="9" height="9" fill="none" stroke="currentColor" stroke-width="1"></rect></svg></button> <button class="window-control close svelte-1yq3aid" aria-label="Close" title="Close"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-1yq3aid"><path d="M1 1L9 9M9 1L1 9" stroke="currentColor" stroke-width="1.2"></path></svg></button></div>');function nLe(n,e){lt(e,!1);function t(){window.api?.windowMinimize()}function r(){window.api?.windowMaximize()}function i(){window.api?.windowClose()}b3();var s=Ve(),o=Ie(s);{var a=l=>{var c=tLe(),d=w(c);d.__click=t;var h=A(d,2);h.__click=r;var f=A(h,2);f.__click=i,T(l,c)};z(o,l=>{cc()||l(a)})}T(n,s),ct()}yt(["click"]);var rLe=P('<button class="floating-sidebar-toggle svelte-1waluzf" aria-label="Toggle sidebar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1waluzf"><rect x="3" y="3" width="18" height="18" rx="2" class="svelte-1waluzf"></rect><line x1="9" y1="3" x2="9" y2="21" class="svelte-1waluzf"></line></svg></button>'),iLe=P('<button><svg width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" class="svelte-1waluzf"><path d="M12 17v5" class="svelte-1waluzf"></path><path d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z" class="svelte-1waluzf"></path></svg></button>'),sLe=P('<button><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1waluzf"><path d="M22 12h-6l-2 3h-4l-2-3H2" class="svelte-1waluzf"></path><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z" class="svelte-1waluzf"></path></svg></button>'),oLe=P("<!> <!>",1),aLe=P('<button class="more-menu-button svelte-1waluzf" aria-label="More options"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-1waluzf"><circle cx="12" cy="5" r="2" class="svelte-1waluzf"></circle><circle cx="12" cy="12" r="2" class="svelte-1waluzf"></circle><circle cx="12" cy="19" r="2" class="svelte-1waluzf"></circle></svg></button>'),lLe=P('<div class="empty-editor svelte-1waluzf"><div class="empty-editor-content svelte-1waluzf"><h2 class="svelte-1waluzf">Select a note to edit</h2> <p class="svelte-1waluzf">Or create a new note with âN</p> <button class="create-note-btn svelte-1waluzf">Create Note</button></div></div>'),cLe=P('<div><!> <div class="right-sidebar-inner svelte-1waluzf"><!></div></div>'),uLe=P('<div class="sync-directory-selected svelte-1waluzf"><span class="sync-path svelte-1waluzf"> </span> <button class="sync-clear-btn svelte-1waluzf" title="Remove sync folder">â</button></div>'),dLe=P('<button class="modal-btn secondary svelte-1waluzf">Choose Folder...</button>'),hLe=P('<button type="button"><span class="template-icon svelte-1waluzf"> </span> <span class="template-name svelte-1waluzf"> </span> <span class="template-desc svelte-1waluzf"> </span></button>'),fLe=P('<label class="onboarding-option svelte-1waluzf"><input type="checkbox" class="svelte-1waluzf"/> <span class="option-icon svelte-1waluzf"> </span> <div class="option-text svelte-1waluzf"><span class="option-name svelte-1waluzf"> </span> <span class="option-desc svelte-1waluzf"> </span></div></label>'),pLe=P('<div class="modal-overlay svelte-1waluzf"><div class="modal create-vault-modal svelte-1waluzf"><h3 class="svelte-1waluzf">Create New Vault</h3> <div class="create-vault-scroll svelte-1waluzf"><input type="text" class="modal-input svelte-1waluzf" placeholder="Vault name"/> <div class="sync-directory-section svelte-1waluzf"><span class="sync-label svelte-1waluzf">Sync to folder (optional)</span> <!></div> <div class="template-section svelte-1waluzf"><span class="section-label svelte-1waluzf">Choose a template</span> <div class="template-options svelte-1waluzf"></div></div> <div class="onboarding-section svelte-1waluzf"><span class="section-label svelte-1waluzf">Include starter content (optional)</span> <div class="onboarding-options svelte-1waluzf"></div></div></div> <div class="modal-actions svelte-1waluzf"><button class="modal-btn cancel svelte-1waluzf">Cancel</button> <button class="modal-btn primary svelte-1waluzf">Create</button></div> <div class="modal-divider svelte-1waluzf"><span class="svelte-1waluzf">or</span></div> <button class="modal-btn secondary full-width svelte-1waluzf">Open Vault from Directory</button></div></div>'),gLe=P("<!> <!>",1),mLe=P('<p class="migration-message svelte-1waluzf"> </p> <div class="progress-bar-container svelte-1waluzf"><div class="progress-bar svelte-1waluzf"></div></div> <p class="migration-phase svelte-1waluzf"> </p>',1),vLe=P('<p class="migration-message svelte-1waluzf">Starting migration...</p> <div class="progress-bar-container svelte-1waluzf"><div class="progress-bar indeterminate svelte-1waluzf"></div></div>',1),yLe=P('<div class="migration-overlay svelte-1waluzf"><div class="migration-modal svelte-1waluzf"><div class="migration-icon svelte-1waluzf"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1waluzf"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2l5 0 2 3h9a2 2 0 0 1 2 2z" class="svelte-1waluzf"></path></svg></div> <h3 class="svelte-1waluzf"> </h3> <!></div></div>'),bLe=P('<div class="migration-overlay svelte-1waluzf"><div class="migration-modal error svelte-1waluzf"><div class="migration-icon error svelte-1waluzf"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1waluzf"><circle cx="12" cy="12" r="10" class="svelte-1waluzf"></circle><path d="m15 9-6 6" class="svelte-1waluzf"></path><path d="m9 9 6 6" class="svelte-1waluzf"></path></svg></div> <h3 class="svelte-1waluzf">Import Failed</h3> <p class="migration-error-message svelte-1waluzf"> </p> <button class="dismiss-button svelte-1waluzf">Dismiss</button></div></div>'),wLe=P('<div class="modal-overlay svelte-1waluzf"><div class="modal svelte-1waluzf"><h3 class="svelte-1waluzf"> </h3> <div class="workspace-form svelte-1waluzf"><div class="workspace-form-row svelte-1waluzf"><input type="text" class="icon-input svelte-1waluzf" placeholder="Icon" maxlength="2"/> <input type="text" class="modal-input flex-1 svelte-1waluzf" placeholder="Workspace name"/></div></div> <div class="modal-actions svelte-1waluzf"><button class="modal-btn cancel svelte-1waluzf">Cancel</button> <button class="modal-btn primary svelte-1waluzf"> </button></div></div></div>'),_Le=P('<div class="main-view svelte-1waluzf"><div class="app-layout svelte-1waluzf"><!> <div class="main-content svelte-1waluzf"><div class="safe-zone svelte-1waluzf"><!> <!> <div class="safe-zone-actions svelte-1waluzf"><!> <!></div> <!></div> <div><div><!></div></div></div> <!></div></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>',1);function OLe(n,e){lt(e,!0);const t=le(cs),r=le(yo),i=le(O5),s=le(dJ),o=le(h5),a=le(bl),l=le(()=>Object.fromEntries(u(r).map(ke=>[ke.id,ke]))),c=le(()=>u(s)?Hg(u(s)):"markdown"),d=le(()=>u(c)==="epub"),h=le(()=>u(c)==="pdf"),f=le(()=>u(c)==="webpage"),p=le(()=>u(c)==="deck");let g=j("");const m=le(cJ),v=le(uJ);let y=j(!1),O=j(!1),_=j(!1),x=j(!1),k=j(""),S=j(null),E=j("empty"),R=j(Qt(["welcome"])),C=j(!1),I=j(null),D=j(null);const Q=le(TT);let M=j(!1),N=j(0),B=j(null);const H=le(()=>An.rightSidebar.visible),F=le(()=>An.rightSidebar.width),Z=le(()=>An.rightSidebar.panelOpen&&An.rightSidebar.activePanel==="chat"),$=le(()=>An.rightSidebar.panelOpen&&An.rightSidebar.activePanel==="shelf");let W=j(!1),G=j(!1),L=j(Qt({x:0,y:0})),q=j(!1);async function ue(ke){await Cn.updateSettings({appearance:{...Cn.settings.appearance,fontSize:ke}})}function oe(){An.openPanel("shelf")}function fe(){An.toggleRightSidebar()}let be=j(null);const De=le(()=>u(be)??u(F));function Le(ke){b(be,ke,!0),he&&clearTimeout(he),he=setTimeout(()=>{An.setRightSidebarWidth(ke),b(be,null)},300)}let he=null;function se(){u(i)&&(uu.addItem(u(i).type,u(i).id),oe())}const V=le(()=>u(i)?uu.isOnShelf(u(i).type,u(i).id):!1),ne=le(()=>u(i)?iJ(u(i)):!1),ee=le(()=>u(s)?Dy(u(s).id)?.enabled??!1:!1);tt(()=>{u(s)&&b(q,!1)});function U(ke){const Ot=ke.currentTarget.getBoundingClientRect();b(L,{x:Ot.right-180,y:Ot.bottom+4},!0),b(G,!0)}function X(){u(i)&&Kp({type:u(i).type,id:u(i).id})}function ie(){u(i)&&Bv({type:u(i).type,id:u(i).id})}function ye(){b(q,!u(q))}function pe(){u(s)&&(u(ee)?MS(u(s).id):IS(u(s).id))}function de(){u(s)&&Ch(u(s).id)}function we(){u(s)&&yO(u(s).id)}let me=j(Qt([])),Ee=j(!1),_e=j(!1),Ae=null;function ze(){const ke=u(i)?.type==="note"?u(i).id:null;return u(t).filter(Ot=>!Ot.archived&&Ot.lastOpened&&Ot.id!==ke).sort((Ot,Gt)=>{const Nn=Ot.lastOpened?new Date(Ot.lastOpened).getTime():0;return(Gt.lastOpened?new Date(Gt.lastOpened).getTime():0)-Nn}).slice(0,8).map(Ot=>({note:Ot,score:0,titleMatches:[],contentMatches:[],matchedType:u(l)[Ot.type]}))}tt(()=>{if(Ae&&(clearTimeout(Ae),Ae=null),!u(g).trim()){u(M)?(b(me,ze(),!0),b(_e,!0)):(b(me,[],!0),b(_e,!1)),b(Ee,!1);return}b(_e,!1);const ke=fB(u(t),u(g),{noteTypes:u(l)});return b(me,ke,!0),Ae=setTimeout(async()=>{b(Ee,!0);try{const nt=await hge(u(t),u(g),{noteTypes:u(l),contentLoader:ns},fc);b(me,nt,!0)}finally{b(Ee,!1)}},150),()=>{Ae&&clearTimeout(Ae)}});function Be(ke){cn({type:ke.type,id:ke.id}),Dr({type:ke.type,id:ke.id}),Fn(null),b(g,""),b(M,!1)}function Se(ke){cn({type:"note",id:ke.id}),Dr({type:"note",id:ke.id}),Fn(null),b(g,""),b(M,!1)}function Re(ke){Se(ke)}function He(){b(M,!0)}function Me(){setTimeout(()=>{b(M,!1)},200)}function Pe(ke){ke.key==="Escape"&&(b(g,""),b(M,!1),b(N,0),ke.target?.blur());const nt=Math.min(u(me).length,8);((ke.metaKey||ke.ctrlKey)&&ke.key==="n"||ke.key==="ArrowDown")&&u(me).length>0&&(ke.preventDefault(),b(N,(u(N)+1)%nt)),((ke.metaKey||ke.ctrlKey)&&ke.key==="p"||ke.key==="ArrowUp")&&u(me).length>0&&(ke.preventDefault(),b(N,(u(N)-1+nt)%nt)),ke.key==="Enter"&&u(me).length>0&&(ke.preventDefault(),u(N)<nt?Re(u(me)[u(N)].note):u(g).trim()&&(Fn("search"),cn(null)))}async function ae(){const ke=await zs({title:""});cn({type:"note",id:ke}),Fn(null)}async function te(){const ke=await N5("");cn({type:"note",id:ke}),Fn(null)}function re(ke){Ch(ke)}function ve(ke){yO(ke)}function Te(ke){Fn(ke),ke&&cn(null),ke!=="types"&&mu(null)}async function Ne(){b(_,!1),await Ah()}function ce(){b(_,!1)}function Oe(ke){mu(ke)}function Qe(ke){Fn(null),mu(null)}async function We(ke){const nt=u(o).find(Ot=>Ot.id===ke);nt&&(ep(nt)?await st(nt):(await ru(ke),cn(null)))}async function st(ke){if(ke.legacyPath){b(C,!0),b(I,ke,!0),b(D,null);try{const nt=await L0(ke.legacyPath,ke.name);if(nt.success&&nt.vault)eJ(ke.id,nt.vault.docUrl,nt.vault.baseDirectory),await ru(ke.id),cn(null);else{const Ot=nt.errors?.[0]?.message??"Migration failed for unknown reason";b(D,Ot,!0),console.error("Migration failed:",nt.errors)}}catch(nt){b(D,nt instanceof Error?nt.message:String(nt),!0),console.error("Migration error:",nt)}finally{b(C,!1),b(I,null),ph()}}}function it(){b(D,null)}function Ct(){b(k,""),b(S,null),b(E,"empty"),b(R,["welcome"],!0),b(y,!0)}function bt(ke){u(R).includes(ke)?b(R,u(R).filter(nt=>nt!==ke),!0):b(R,[...u(R),ke],!0)}async function xt(){const ke=await gS();ke&&b(S,ke,!0)}async function mt(){if(u(k).trim()){b(y,!1);const ke=await gU(u(k).trim(),u(S)??void 0,{templateId:u(E),onboardingIds:u(R)});b(k,""),b(S,null),b(E,"empty"),b(R,["welcome"],!0),await ru(ke.id)}}async function Ge(){if(On())try{const ke=await window.api?.legacyMigration.browseForVault();if(!ke)return;b(y,!1);const nt=await window.api?.legacyMigration.detectLegacyVaultAtPath({vaultPath:ke,existingVaults:u(o).map(Ot=>({baseDirectory:Ot.baseDirectory}))});if(nt){b(C,!0),b(I,{id:"",name:nt.name,docUrl:"",archived:!1,created:new Date().toISOString(),legacyPath:nt.path},!0),b(D,null);try{const Ot=await L0(nt.path,nt.name);if(Ot.success&&Ot.vault)await Ah(),await ru(Ot.vault.id),cn(null);else{const Gt=Ot.errors?.[0]?.message??"Migration failed for unknown reason";b(D,Gt,!0),console.error("Migration failed:",Ot.errors)}}catch(Ot){b(D,Ot instanceof Error?Ot.message:String(Ot),!0),console.error("Migration error:",Ot)}finally{b(C,!1),b(I,null),ph()}}else b(D,"No valid vault found at the selected location")}catch(ke){b(D,ke instanceof Error?ke.message:String(ke),!0),console.error("Browse error:",ke)}}function Xe(){An.toggleLeftSidebar()}let ft=j(!1),at=j(null),pt=j(""),dt=j(""),_t=j(!1);function wt(){b(at,null),b(pt,""),b(dt,"ð"),b(ft,!0)}function Rt(){const ke=ki();ke&&(b(at,ke.id,!0),b(pt,ke.name,!0),b(dt,ke.icon,!0),b(ft,!0))}function Et(){u(pt).trim()&&(u(at)?v5(u(at),{name:u(pt).trim(),icon:u(dt)||"ð"}):TS({name:u(pt).trim(),icon:u(dt)||"ð"}),b(ft,!1))}function $t(){const ke=Gp(),nt=ki();if(ke.length>1&&nt){const Ot=ke.find(Gt=>Gt.id!==nt.id);Ot&&Ry(Ot.id),y5(nt.id)}}async function jt(){if(u(_t))return;const ke=document.createElement("input");ke.type="file",ke.accept=".pdf,.epub,application/pdf,application/epub+zip",ke.onchange=async()=>{const nt=ke.files?.[0];if(nt){b(_t,!0);try{const Ot=nt.name.toLowerCase().split(".").pop();Ot==="pdf"?await zQ(nt):Ot==="epub"&&await HQ(nt)}finally{b(_t,!1)}}},ke.click()}async function Kt(){if(!On())return;const ke=bl();if(!ke?.baseDirectory||!u(s)){ke?.baseDirectory&&await window.api?.showItemInFolder({path:ke.baseDirectory});return}const Ot=jr(u(s).type)?.name??"Note",Gt=`${ke.baseDirectory}/notes/${Ot}/${u(s).title}.md`;await window.api?.showItemInFolder({path:Gt})}function Zt(){document.querySelector(".note-title-input, .title-input, [data-title-input]")?.focus()}function Nt(ke){switch(ke){case"inbox":Fn("inbox"),cn(null);break;case"daily":Fn("daily"),cn(null),setTimeout(()=>{document.dispatchEvent(new CustomEvent("daily-view-focus-today"))},50);break;case"review":Fn("review"),cn(null);break;case"routines":Fn("routines"),cn(null);break;case"note-types":Fn("types"),cn(null);break;case"settings":Fn("settings"),cn(null);break}}function Yt(ke,...nt){switch(ke){case"new-note":ae();break;case"new-deck":te();break;case"import-file":jt();break;case"import-webpage":b(O,!0);break;case"new-vault":Ct();break;case"switch-vault":{document.querySelector("[data-vault-dropdown]")?.click();break}case"show-in-finder":Kt();break;case"show-debug-logs":On()&&window.api?.showLogsInFolder();break;case"find":An.leftSidebar.visible?document.getElementById("search-input")?.focus():(b(W,!0),b(M,!0));break;case"toggle-sidebar":Xe();break;case"focus-title":Zt();break;case"toggle-preview":b(q,!u(q));break;case"toggle-agent":An.togglePanel("chat");break;case"toggle-shelf":An.togglePanel("shelf");break;case"new-workspace":wt();break;case"edit-workspace":Rt();break;case"delete-workspace":$t();break;case"switch-workspace":typeof nt[0]=="string"&&Ry(nt[0]);break;case"toggle-pin":u(i)&&(u(ne)?ie():X());break;case"add-to-shelf":se();break;case"change-type":u(s)&&window.dispatchEvent(new CustomEvent("open-type-dropdown",{detail:{noteId:u(s).id}}));break;case"toggle-review":pe();break;case"archive-note":de();break;case"font-size-increase":if(u(d)||u(h))window.dispatchEvent(new CustomEvent("reader-zoom",{detail:{direction:"increase"}}));else{const Ot=Cn.settings.appearance.fontSize??16,Gt=Math.min(Ot+2,24);ue(Gt)}break;case"font-size-decrease":if(u(d)||u(h))window.dispatchEvent(new CustomEvent("reader-zoom",{detail:{direction:"decrease"}}));else{const Ot=Cn.settings.appearance.fontSize??16,Gt=Math.max(Ot-2,12);ue(Gt)}break;case"font-size-reset":u(d)||u(h)?window.dispatchEvent(new CustomEvent("reader-zoom",{detail:{direction:"reset"}})):ue(16);break;case"reader-prev":window.dispatchEvent(new CustomEvent("reader-navigate",{detail:{direction:"prev"}}));break;case"reader-next":window.dispatchEvent(new CustomEvent("reader-navigate",{detail:{direction:"next"}}));break;case"reader-zoom-increase":window.dispatchEvent(new CustomEvent("reader-zoom",{detail:{direction:"increase"}}));break;case"reader-zoom-decrease":window.dispatchEvent(new CustomEvent("reader-zoom",{detail:{direction:"decrease"}}));break;case"reader-zoom-reset":window.dispatchEvent(new CustomEvent("reader-zoom",{detail:{direction:"reset"}}));break;case"show-changelog":b(x,!0);break;case"check-updates":On()&&window.api?.checkForUpdates();break}}async function ln(){if(On())try{const ke=await window.api?.getAppVersion();if(!ke)return;const{version:nt,channel:Ot}=ke,Gt=Ot==="canary",Nn=Cn.getLastSeenVersion(Gt);Nn&&Nn!==nt&&b(x,!0),await Cn.updateLastSeenVersion(nt,Gt)}catch(ke){console.warn("Failed to check for upgrade:",ke)}}qr(()=>{let ke,nt;On()&&(ke=window.api?.onMenuNavigate(Nt),nt=window.api?.onMenuAction(Yt));function Ot(Nn){Nt(Nn.detail.view)}function Gt(Nn){Yt(Nn.detail.action)}return window.addEventListener("menu-navigate",Ot),window.addEventListener("menu-action",Gt),ln(),()=>{ke?.(),nt?.(),window.removeEventListener("menu-navigate",Ot),window.removeEventListener("menu-action",Gt)}}),tt(()=>{if(!On())return;const ke=u(s)!==null;window.api?.setMenuActiveNote(ke)}),tt(()=>{On()&&window.api?.setMenuActiveEpub(u(d))}),tt(()=>{On()&&window.api?.setMenuActivePdf(u(h))}),tt(()=>{if(!On())return;const ke=Gp(),nt=ki();nt&&window.api?.setMenuWorkspaces({workspaces:ke.map(Ot=>({id:Ot.id,name:Ot.name,icon:Ot.icon})),activeWorkspaceId:nt.id})});const Je=navigator.platform.startsWith("Mac"),ge=cc();function Ze(ke){ge?Jt(ke):ht(ke)}function ht(ke){const nt=Je?ke.metaKey:ke.ctrlKey;nt&&ke.shiftKey&&ke.key==="N"&&(ke.preventDefault(),ae()),nt&&ke.key==="k"&&(ke.preventDefault(),mn()),nt&&ke.key==="b"&&(ke.preventDefault(),Xe())}function Jt(ke){if(!ke.ctrlKey||!ke.shiftKey)return;const nt=ke.key.toLowerCase();if(nt==="n"){ke.preventDefault(),ae();return}if(nt==="d"){ke.preventDefault(),te();return}if(nt==="o"){ke.preventDefault(),document.querySelector("[data-vault-dropdown]")?.click();return}if(nt==="k"){ke.preventDefault(),mn();return}if(nt==="b"){ke.preventDefault(),Xe();return}if(nt==="t"){ke.preventDefault(),Zt();return}if(nt==="e"){ke.preventDefault(),Yt("toggle-preview");return}if(nt==="a"){ke.preventDefault(),Yt("toggle-agent");return}if(nt==="l"){ke.preventDefault(),Yt("toggle-shelf");return}if(nt>="1"&&nt<="6"){ke.preventDefault();const Ot=["inbox","daily","review","routines","note-types","settings"],Gt=parseInt(nt)-1;Gt>=0&&Gt<Ot.length&&Nt(Ot[Gt]);return}if(nt==="p"){ke.preventDefault(),Yt("toggle-pin");return}if(nt==="m"){ke.preventDefault(),Yt("change-type");return}}function mn(){An.leftSidebar.visible?document.getElementById("search-input")?.focus():(b(W,!0),b(M,!0))}var yn=_Le();It("keydown",Na,Ze);var Yn=Ie(yn),vr=w(Yn),Wi=w(vr);{let ke=le(()=>u(a)??null);T2e(Wi,{get activeSystemView(){return u(m)},get searchQuery(){return u(g)},get searchResults(){return u(me)},get searchInputFocused(){return u(M)},get selectedSearchIndex(){return u(N)},get isShowingRecent(){return u(_e)},get vaults(){return u(o)},get activeVault(){return u(ke)},onItemSelect:Be,onSystemViewSelect:Te,onCreateNote:ae,onCreateDeck:te,onCaptureWebpage:()=>{b(O,!0)},onSearchChange:nt=>{b(g,nt,!0),b(N,0)},onSearchFocus:He,onSearchBlur:Me,onSearchKeyDown:Pe,onSearchResultSelect:Re,onVaultSelect:We,onCreateVault:Ct,onToggleSidebar:Xe,onViewAllResults:()=>{Fn("search"),cn(null)}})}var pi=A(Wi,2),Vn=w(pi),To=w(Vn);{var Ao=ke=>{ur(ke,{text:"Toggle sidebar (âB)",position:"bottom",children:(nt,Ot)=>{var Gt=rLe();Gt.__click=Xe,T(nt,Gt)},$$slots:{default:!0}})};z(To,ke=>{An.leftSidebar.visible||ke(Ao)})}var Ll=A(To,2);eLe(Ll,{});var Hr=A(Ll,2),gi=w(Hr);{var Us=ke=>{var nt=oLe(),Ot=Ie(nt);{let Nn=le(()=>u(ne)?"Unpin":"Pin");ur(Ot,{get text(){return u(Nn)},position:"bottom",children:(qn,Vs)=>{var yr=iLe();let er;yr.__click=()=>u(ne)?ie():X();var Zr=w(yr);Y(()=>{er=Ue(yr,1,"safe-zone-button svelte-1waluzf",null,er,{active:u(ne)}),Pt(yr,"aria-label",u(ne)?"Unpin":"Pin"),Pt(Zr,"fill",u(ne)?"currentColor":"none")}),T(qn,yr)},$$slots:{default:!0}})}var Gt=A(Ot,2);{let Nn=le(()=>u(V)?"On Shelf":"Add to Shelf");ur(Gt,{get text(){return u(Nn)},position:"bottom",children:(qn,Vs)=>{var yr=sLe();let er;yr.__click=se,Y(()=>{er=Ue(yr,1,"safe-zone-button svelte-1waluzf",null,er,{"on-shelf":u(V)}),yr.disabled=u(V),Pt(yr,"aria-label",u(V)?"On Shelf":"Add to Shelf")}),T(qn,yr)},$$slots:{default:!0}})}T(ke,nt)};z(gi,ke=>{u(i)&&ke(Us)})}var Xa=A(gi,2);{var Mc=ke=>{ur(ke,{text:"More options",position:"bottom",children:(nt,Ot)=>{var Gt=aLe();Gt.__click=U,T(nt,Gt)},$$slots:{default:!0}})};z(Xa,ke=>{u(s)&&ke(Mc)})}var js=A(Hr,2);nLe(js,{});var Jo=A(Vn,2);let hf;var bm=w(Jo);let wm;var GU=w(bm);{var KU=ke=>{KCe(ke,{onClose:()=>Fn(null),onShowLegacyMigrationModal:()=>b(_,!0),onShowChangelog:()=>b(x,!0)})},JU=ke=>{var nt=Ve(),Ot=Ie(nt);{var Gt=qn=>{SAe(qn,{get searchResults(){return u(me)},get searchQuery(){return u(g)},get isSearchingContent(){return u(Ee)},onClose:()=>Fn(null),onSelect:Re})},Nn=qn=>{var Vs=Ve(),yr=Ie(Vs);{var er=mi=>{yCe(mi,{get selectedTypeId(){return u(v)},onTypeSelect:Oe,onNoteSelect:Qe})},Zr=mi=>{var qs=Ve(),Hs=Ie(qs);{var xr=ea=>{kIe(ea,{onNoteSelect:Se})},Ya=ea=>{var _m=Ve(),ar=Ie(_m);{var Fr=Ci=>{YDe(Ci,{})},ps=Ci=>{var ta=Ve(),ff=Ie(ta);{var ed=na=>{u3e(na,{})},td=na=>{var nd=Ve(),Kb=Ie(nd);{var Jb=rd=>{oNe(rd,{onExecuteRoutine:Om=>{const xm=mo(Om);xm&&(b(B,`Execute the routine "${xm.name}". First read the routine details using get_routine to understand the full instructions, then follow them to complete the routine.`),An.openPanel("chat"))}})},uj=rd=>{var Om=Ve(),xm=Ie(Om);{var dj=id=>{var pf=Ve(),ew=Ie(pf);{var tw=sd=>{qEe(sd,{get note(){return u(s)},onTitleChange:km=>dl(u(s).id,{title:km})})},fj=sd=>{var km=Ve(),pj=Ie(km);{var gj=od=>{$Pe(od,{get note(){return u(s)},onTitleChange:Sm=>dl(u(s).id,{title:Sm})})},mj=od=>{var Sm=Ve(),vj=Ie(Sm);{var yj=ad=>{eIe(ad,{get note(){return u(s)},onTitleChange:Tm=>dl(u(s).id,{title:Tm})})},bj=ad=>{var Tm=Ve(),wj=Ie(Tm);{var _j=ld=>{sIe(ld,{get note(){return u(s)},onNoteOpen:cd=>{cn({type:"note",id:cd}),Dr({type:"note",id:cd})},onTitleChange:cd=>dl(u(s).id,{title:cd}),onUnarchive:()=>ve(u(s).id)})},Oj=ld=>{xAe(ld,{get note(){return u(s)},get previewMode(){return u(q)},onTitleChange:cd=>dl(u(s).id,{title:cd}),onArchive:()=>re(u(s).id),onUnarchive:()=>ve(u(s).id)})};z(wj,ld=>{u(p)?ld(_j):ld(Oj,!1)},!0)}T(ad,Tm)};z(vj,ad=>{u(f)?ad(yj):ad(bj,!1)},!0)}T(od,Sm)};z(pj,od=>{u(h)?od(gj):od(mj,!1)},!0)}T(sd,km)};z(ew,sd=>{u(d)?sd(tw):sd(fj,!1)})}T(id,pf)},hj=id=>{var pf=lLe(),ew=w(pf),tw=A(w(ew),4);tw.__click=ae,T(id,pf)};z(xm,id=>{u(s)?id(dj):id(hj,!1)},!0)}T(rd,Om)};z(Kb,rd=>{u(m)==="routines"?rd(Jb):rd(uj,!1)},!0)}T(na,nd)};z(ff,na=>{u(m)==="inbox"?na(ed):na(td,!1)},!0)}T(Ci,ta)};z(ar,Ci=>{u(m)==="review"?Ci(Fr):Ci(ps,!1)},!0)}T(ea,_m)};z(Hs,ea=>{u(m)==="daily"?ea(xr):ea(Ya,!1)},!0)}T(mi,qs)};z(yr,mi=>{u(m)==="types"?mi(er):mi(Zr,!1)},!0)}T(qn,Vs)};z(Ot,qn=>{u(m)==="search"?qn(Gt):qn(Nn,!1)},!0)}T(ke,nt)};z(GU,ke=>{u(m)==="settings"?ke(KU):ke(JU,!1)})}var ej=A(pi,2);{var tj=ke=>{var nt=cLe();let Ot;var Gt=w(nt);yU(Gt,{side:"right",onResize:Le,minWidth:300,maxWidth:600});var Nn=A(Gt,2),qn=w(Nn);{var Vs=er=>{{let Zr=le(()=>u(B)??void 0);xD(er,{isOpen:!0,isExpanded:!0,onClose:()=>An.closePanel(),onToggleExpand:fe,onGoToSettings:()=>{Fn("settings"),An.closePanel()},get initialMessage(){return u(Zr)},onInitialMessageConsumed:()=>b(B,null),onSwitchToShelf:()=>An.openPanel("shelf")})}},yr=er=>{var Zr=Ve(),mi=Ie(Zr);{var qs=Hs=>{kD(Hs,{isOpen:!0,isExpanded:!0,onClose:()=>An.closePanel(),onToggleExpand:fe,onNavigate:(xr,Ya)=>{cn({type:xr,id:Ya}),Dr({type:xr,id:Ya}),Fn(null),An.closePanel()},onSwitchToChat:()=>An.openPanel("chat")})};z(mi,Hs=>{u($)&&Hs(qs)},!0)}T(er,Zr)};z(qn,er=>{u(Z)?er(Vs):er(yr,!1)})}Y(()=>{Ot=Ue(nt,1,"right-sidebar svelte-1waluzf",null,Ot,{resizing:u(be)!==null}),gn(nt,`--sidebar-width: ${u(De)??""}px`)}),T(ke,nt)};z(ej,ke=>{u(H)&&(u(Z)||u($))&&ke(tj)})}var jT=A(Yn,2);{var nj=ke=>{var nt=pLe();nt.__click=()=>b(y,!1),nt.__keydown=ar=>ar.key==="Escape"&&b(y,!1);var Ot=w(nt);Ot.__click=ar=>ar.stopPropagation();var Gt=A(w(Ot),2),Nn=w(Gt);Nn.__keydown=ar=>ar.key==="Enter"&&mt();var qn=A(Nn,2),Vs=A(w(qn),2);{var yr=ar=>{var Fr=uLe(),ps=w(Fr),Ci=w(ps),ta=A(ps,2);ta.__click=()=>b(S,null),Y(()=>{Pt(ps,"title",u(S)),J(Ci,u(S))}),T(ar,Fr)},er=ar=>{var Fr=dLe();Fr.__click=xt,T(ar,Fr)};z(Vs,ar=>{u(S)?ar(yr):ar(er,!1)})}var Zr=A(qn,2),mi=A(w(Zr),2);Tt(mi,21,()=>D0,ar=>ar.id,(ar,Fr)=>{var ps=hLe();let Ci;ps.__click=()=>b(E,u(Fr).id,!0);var ta=w(ps),ff=w(ta),ed=A(ta,2),td=w(ed),na=A(ed,2),nd=w(na);Y(()=>{Ci=Ue(ps,1,"template-card svelte-1waluzf",null,Ci,{selected:u(E)===u(Fr).id}),J(ff,u(Fr).icon),J(td,u(Fr).name),J(nd,u(Fr).description)}),T(ar,ps)});var qs=A(Zr,2),Hs=A(w(qs),2);Tt(Hs,21,()=>N0,ar=>ar.id,(ar,Fr)=>{var ps=fLe(),Ci=w(ps);Ci.__change=()=>bt(u(Fr).id);var ta=A(Ci,2),ff=w(ta),ed=A(ta,2),td=w(ed),na=w(td),nd=A(td,2),Kb=w(nd);Y(Jb=>{zo(Ci,Jb),J(ff,u(Fr).icon),J(na,u(Fr).name),J(Kb,u(Fr).description)},[()=>u(R).includes(u(Fr).id)]),T(ar,ps)});var xr=A(Gt,2),Ya=w(xr);Ya.__click=()=>b(y,!1);var ea=A(Ya,2);ea.__click=mt;var _m=A(xr,4);_m.__click=Ge,Un(Nn,()=>u(k),ar=>b(k,ar)),T(ke,nt)};z(jT,ke=>{u(y)&&ke(nj)})}var VT=A(jT,2);{let ke=le(()=>u(d)||u(h));CIe(VT,{get chatOpen(){return u(Z)},get shelfOpen(){return u($)},onToggleChat:()=>An.togglePanel("chat"),onToggleShelf:()=>An.togglePanel("shelf"),get autoHide(){return u(ke)}})}var qT=A(VT,2);{var rj=ke=>{var nt=gLe(),Ot=Ie(nt);{let Nn=le(()=>u(B)??void 0);xD(Ot,{get isOpen(){return u(Z)},isExpanded:!1,onClose:()=>An.closePanel(),onToggleExpand:fe,onGoToSettings:()=>{Fn("settings"),An.closePanel()},get initialMessage(){return u(Nn)},onInitialMessageConsumed:()=>b(B,null),onSwitchToShelf:()=>An.openPanel("shelf")})}var Gt=A(Ot,2);kD(Gt,{get isOpen(){return u($)},isExpanded:!1,onClose:()=>An.closePanel(),onToggleExpand:fe,onNavigate:(Nn,qn)=>{cn({type:Nn,id:qn}),Dr({type:Nn,id:qn}),Fn(null),An.closePanel()},onSwitchToChat:()=>An.openPanel("chat")}),T(ke,nt)};z(qT,ke=>{u(H)||ke(rj)})}var HT=A(qT,2);dNe(HT,{get isOpen(){return u(O)},onClose:()=>b(O,!1)});var ZT=A(HT,2);VNe(ZT,{get isOpen(){return u(W)},get searchQuery(){return u(g)},get searchResults(){return u(me)},get selectedSearchIndex(){return u(N)},get isShowingRecent(){return u(_e)},get isSearchingContent(){return u(Ee)},onClose:()=>{b(W,!1),b(g,""),b(M,!1),b(N,0)},onSearchChange:ke=>{b(g,ke,!0),b(N,0)},onSearchResultSelect:ke=>{Re(ke),b(W,!1),b(g,""),b(M,!1),b(N,0)},onKeyDown:Pe,onViewAllResults:()=>{Fn("search"),cn(null),b(W,!1)}});var WT=A(ZT,2);{var ij=ke=>{NNe(ke,{onComplete:Ne,onCancel:ce})};z(WT,ke=>{u(_)&&ke(ij)})}var XT=A(WT,2);ERe(XT,{get isOpen(){return u(x)},onClose:()=>b(x,!1)});var YT=A(XT,2);{var sj=ke=>{var nt=yLe(),Ot=w(nt),Gt=A(w(Ot),2),Nn=w(Gt),qn=A(Gt,2);{var Vs=er=>{var Zr=mLe(),mi=Ie(Zr),qs=w(mi),Hs=A(mi,2),xr=w(Hs),Ya=A(Hs,2),ea=w(Ya);Y(()=>{J(qs,u(Q).message),gn(xr,`width: ${u(Q).total>0?u(Q).current/u(Q).total*100:0}%`),J(ea,u(Q).phase)}),T(er,Zr)},yr=er=>{var Zr=vLe();T(er,Zr)};z(qn,er=>{u(Q)?er(Vs):er(yr,!1)})}Y(()=>J(Nn,`Importing "${u(I).name??""}"`)),T(ke,nt)};z(YT,ke=>{u(C)&&u(I)&&ke(sj)})}var GT=A(YT,2);{var oj=ke=>{var nt=bLe(),Ot=w(nt),Gt=A(w(Ot),4),Nn=w(Gt),qn=A(Gt,2);qn.__click=it,Y(()=>J(Nn,u(D))),T(ke,nt)};z(GT,ke=>{u(D)&&ke(oj)})}var KT=A(GT,2);{var aj=ke=>{{let nt=le(()=>!u(p)&&!u(d)&&!u(h)&&!u(f)),Ot=le(()=>!!bl()?.baseDirectory);YNe(ke,{get x(){return u(L).x},get y(){return u(L).y},get isPinned(){return u(ne)},get isOnShelf(){return u(V)},get isPreviewMode(){return u(q)},get isReviewEnabled(){return u(ee)},get isArchived(){return u(s).archived},get showPreviewMode(){return u(nt)},get showShowInFinder(){return u(Ot)},onClose:()=>b(G,!1),onPin:X,onUnpin:ie,onAddToShelf:se,onTogglePreview:ye,onToggleReview:pe,onArchive:de,onUnarchive:we,onShowInFinder:Kt,get visible(){return u(G)},set visible(Gt){b(G,Gt,!0)}})}};z(KT,ke=>{u(s)&&ke(aj)})}var lj=A(KT,2);{var cj=ke=>{var nt=wLe();nt.__click=()=>b(ft,!1),nt.__keydown=xr=>xr.key==="Escape"&&b(ft,!1);var Ot=w(nt);Ot.__click=xr=>xr.stopPropagation();var Gt=w(Ot),Nn=w(Gt),qn=A(Gt,2),Vs=w(qn),yr=w(Vs),er=A(yr,2);er.__keydown=xr=>xr.key==="Enter"&&Et();var Zr=A(qn,2),mi=w(Zr);mi.__click=()=>b(ft,!1);var qs=A(mi,2);qs.__click=Et;var Hs=w(qs);Y(xr=>{J(Nn,u(at)?"Edit Workspace":"New Workspace"),qs.disabled=xr,J(Hs,u(at)?"Save":"Create")},[()=>!u(pt).trim()]),Un(yr,()=>u(dt),xr=>b(dt,xr)),Un(er,()=>u(pt),xr=>b(pt,xr)),T(ke,nt)};z(lj,ke=>{u(ft)&&ke(cj)})}Y(()=>{hf=Ue(Jo,1,"scroll-container svelte-1waluzf",null,hf,{"no-scroll":u(d)||u(h)||u(p)}),wm=Ue(bm,1,"content-wrapper svelte-1waluzf",null,wm,{"full-width-content":u(d)||u(h)||u(p)})}),T(n,yn),ct()}yt(["click","keydown","change"]);var xLe=P('<div class="screenshot-wrapper svelte-18299xc"><div class="screenshot-background svelte-18299xc"></div> <div class="screenshot-window svelte-18299xc"><div class="traffic-lights svelte-18299xc"><div class="traffic-light close svelte-18299xc"></div> <div class="traffic-light minimize svelte-18299xc"></div> <div class="traffic-light maximize svelte-18299xc"></div></div> <div class="screenshot-content svelte-18299xc"><!></div></div></div>');function kLe(n,e){var t=xLe(),r=A(w(t),2),i=A(w(r),2),s=w(i);ic(s,()=>e.children),T(n,t)}var SLe=P('<div class="startup-error-banner svelte-jl6sf1"><span> </span> <button class="svelte-jl6sf1">Dismiss</button></div>'),TLe=P('<div class="app loading-state svelte-jl6sf1"><div class="loading-content svelte-jl6sf1"><div class="loading-spinner svelte-jl6sf1">ð¥</div> <p class="svelte-jl6sf1">Loading Flint...</p></div></div>'),ALe=P('<div class="app error-state svelte-jl6sf1"><div class="error-content svelte-jl6sf1"><h2 class="svelte-jl6sf1">Failed to Initialize</h2> <p class="svelte-jl6sf1"> </p> <button class="svelte-jl6sf1">Retry</button></div></div>'),CLe=P("<!> <!>",1);function ELe(n,e){lt(e,!0);let t=j(!1),r=j(null),i=j(Qt([])),s=j(null);const o=le(fJ);async function a(c){const d=KK();if(c.type==="open-vault"){let h;if(c.vaultId)h=d.find(f=>f.id===c.vaultId&&!f.archived);else if(c.vaultName){const f=c.vaultName.toLowerCase();h=d.find(p=>p.name.toLowerCase()===f&&!p.archived)}if(h)await ru(h.id),b(t,!0);else{const f=c.vaultId||c.vaultName;throw new Error(`Vault not found: ${f}`)}}else if(c.type==="import-directory"){if(!c.importPath)throw new Error("Import path is required");const h=c.importPath.split(/[\\/]/),f=h[h.length-1]||"Imported Notes",p=c.customVaultName||f,g=await pU(c.importPath,p);if(!g.success){const m=g.errors[0]?.message||"Import failed";throw new Error(m)}b(t,!0)}}qr(()=>{let c;async function d(){try{await Ah();const h=h5();if(b(t,h.length>0),!u(t)&&On())try{const f=await window.api?.legacyMigration.readLegacyVaultPaths();f&&f.length>0&&b(i,f,!0)}catch(f){console.warn("Failed to read legacy vault paths:",f)}On()&&(c=window.api?.onStartupCommand(async f=>{try{await a(f)}catch(p){console.error("Failed to handle startup command:",p),b(s,p instanceof Error?p.message:"Failed to execute startup command",!0)}}))}catch(h){console.error("Failed to initialize automerge:",h),b(r,h instanceof Error?h.message:"Failed to initialize",!0)}}return d(),()=>{c?.()}});function l(){b(t,!0)}tt(()=>{const c=Cn.settings.appearance.theme;c==="light"?document.documentElement.setAttribute("data-theme","light"):c==="dark"?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme")}),tt(()=>{const c=Cn.settings.appearance.font;let d;switch(c?.preset){case"serif":d='Georgia, "Times New Roman", Times, serif';break;case"monospace":d="'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace";break;case"custom":d=c.customFont?`"${c.customFont}", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif`:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';break;case"sans-serif":default:d='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';break}document.documentElement.style.setProperty("--font-editor",d)}),tt(()=>{const c=Cn.settings.appearance.fontSize??16;document.documentElement.style.setProperty("--font-editor-size",`${c}px`)}),tt(()=>{if(!On()){document.documentElement.setAttribute("data-platform","web");return}const d=Cn.settings.advanced.simulateWindowsPlatform?"windows":navigator.platform.includes("Mac")?"macos":navigator.platform.includes("Win")?"windows":"linux";document.documentElement.setAttribute("data-platform",d)}),kLe(n,{children:(c,d)=>{var h=CLe(),f=Ie(h);{var p=y=>{var O=SLe(),_=w(O),x=w(_),k=A(_,2);k.__click=()=>b(s,null),Y(()=>J(x,`Startup error: ${u(s)??""}`)),T(y,O)};z(f,y=>{u(s)&&y(p)})}var g=A(f,2);{var m=y=>{var O=TLe();T(y,O)},v=y=>{var O=Ve(),_=Ie(O);{var x=S=>{var E=ALe(),R=w(E),C=A(w(R),2),I=w(C),D=A(C,2);D.__click=()=>window.location.reload(),Y(()=>J(I,u(r))),T(S,E)},k=S=>{var E=Ve(),R=Ie(E);{var C=D=>{nSe(D,{onVaultCreated:l,get legacyVaults(){return u(i)}})},I=D=>{OLe(D,{})};z(R,D=>{u(t)?D(I,!1):D(C)},!0)}T(S,E)};z(_,S=>{u(r)?S(x):S(k,!1)},!0)}T(y,O)};z(g,y=>{u(o)?y(m):y(v,!1)})}T(c,h)}}),ct()}yt(["click"]);v3(ELe,{target:document.getElementById("app")});export{_h as _};
